Id,Title,Body,Tags,Score,ViewCount,CreationDate
"1245401","C# Assign a delegate based on a type - refactor help?","<p>I had a quick question. Something seems really wrong with this code. I want to take advantage of generics and delegates and quite possibly generic delegates if applicable. I am working with some code generated api's and the objects generated are very similiar. I see that they all implement an interface so I was to try to create one class with a few methods to handle the different scenarios. Here is some sample code. It just feels wrong on so many levels. Please tell me how I can make this code better. A little refactoring advice if you will. And by all means rip it to shreds. I want to code better and learn to do things correctly.</p>

<p>Thanks,
~ck in San Diego</p>

<pre><code>private delegate IsomeEntity DisplayDelegate(IsomeEntity display);

public IsomeEntity Display&lt;T&gt;()
{
    DisplayDelegate _del = null;
    IsomeEntity display = factory.CreateObject(typeof(T).Name);

    if (display.GetType() == typeof(ADisplayEntity))
        _del = ADisplayEntity;

    if (display.GetType() == typeof(BDisplayEntity))
        _del = BDisplayEntity;

    if (display.GetType() == typeof(CDisplayEntity))
        _del = CDisplayEntity;


    return _del(display);
}

public ADisplayEntity ADisplayEntity(IsomeEntity display)
{
    ADisplayEntity ade = display as ADisplayEntity;

    try
    {
        ADisplay o = new ADisplay();
        ADisplayEntity response = o.ADisplay(ade);
        return response;
    }
    catch (Exception ex)
    {
        Exception newEx;
        if (someExceptionHandler.HandleException(ex, this, out newEx))
            throw newEx;
    }

    return null;
}

public BDisplayEntity BDisplayEntity(IsomeEntity display)
{
    BDisplayEntity dde = display as BDisplayEntity;

    try
    {
        BDisplay o = new BDisplay();
        BDisplayEntity response = o.BDisplay(bde);
        return response;
    }
    catch (Exception ex)
    {
        Exception newEx;
        if (someExceptionHandler.HandleException(ex, this, out newEx))
            throw newEx;
    }

    return null;
}
</code></pre>
","<c#><generics><refactoring><delegates>","1","387","2009-08-07 15:24:18"
"7287","How do you test/change untested and untestable code?","<p>Lately I had to change some code on older systems where not all of the code has unit tests.<br />
Before making the changes I want to write tests, but each class created a lot of dependencies and other anti-patterns which made testing quite hard.<br />
Obviously, I wanted to refactor the code to make it easier to test, write the tests and then change it.<br />
Is this the way you'd do it? Or would you spend a lot of time writing the hard-to-write tests that would be mostly removed after the refactoring will be completed?</p>

<p>Any insights are welcome!</p>
","<unit-testing><refactoring><legacy>","4","366","2008-08-10 18:49:53"
"8549","Visual Studio refactoring: Remove method","<p>Is there any Visual Studio Add-In that can do the remove method refactoring?<br />
Suppose you have the following method:  </p>

<pre><code>Result DoSomething(parameters)  
{  
    return ComputeResult(parameters);  
}
</code></pre>

<p>Or the variant where Result is void.</p>

<p>The purpose of the refactoring is to replace all the calls to DoSomething with calls to ComputeResult or the expression that uses the parameters if ComputeResult is not a method call.</p>
","<visual-studio><refactoring><methods><remove>","3","1078","2008-08-12 06:22:06"
"15851","Refactoring away labeled loops","<p>After I was convinced that labeled breaks/continues are a total ""nono"" over <a href=""http://stackoverflow.com/questions/15481/java-coding-standard-best-practices-labeled-brakecontinue#15501"" rel=""nofollow"">here</a>, I need help to remove the label out of my code.</p>

<p>I have a square matrix and a vector that has the same length. The vector has already some values in it an depending on the values in the matrix the vector is changed in the loop.</p>

<p>I hope, the code-fragment is basically understandable </p>

<pre><code>vectorLoop:
for( int idx = 0; idx &lt; vectorLength; idx++) {
    if( conditionAtVectorPosition( v, idx ) ) continue vectorLoop;

    matrixLoop:
    for( rowIdx = 0; rowIdx &lt; n; rowIdx++ ) {
        if( anotherConditionAtVector( v, rowIdx ) ) continue matrixLoop;
        if( conditionAtMatrixRowCol( m, rowIdx, idx ) ) continue vectorLoop;
    }
    setValueInVector( v, idx );
}
</code></pre>

<p>please convince me, that there is a more readable/better version without the labels.</p>
","<java><refactoring><label>","9","920","2008-08-19 07:42:02"
"16167","Good refactoring support for C++","<p>The Visual Studio refactoring support  for C# is quite good nowadays (though not half as good as some Java IDE's I've seen already) but I'm really missing C++ support.</p>

<p>I have seen <a href=""http://www.devexpress.com/Products/Visual_Studio_Add-in/RefactorCPP/index.xml"" rel=""nofollow"">Refactor!</a> and am currently trying it out, but maybe one of you guys know a better tool or plugin?
<hr>
I've been working with <a href=""http://www.wholetomato.com/"" rel=""nofollow"">Visual Assist X</a> now for a week or two and got totally addicted. Thanks for the tip, I'll try to convince my boss to get me a license at work too.
<hr>
I've been bughunting for a few days since Visual Assist X kept messing up my Visual Studio after a few specific refactorings, It took me (and customer support) a week to hunt down but let's say for now that Visual Assist X is not a good combination with <a href=""http://bluemars.org/clipx/"" rel=""nofollow"">ClipX</a>.</p>
","<c++><visual-studio><refactoring>","17","8444","2008-08-19 13:39:29"
"19758","Tools for PHP code refactoring","<p>Are there any tools which support refactoring PHP code (renaming variables, extracting methods, finding method references, ...)? Thank you.</p>
","<php><refactoring>","40","13427","2008-08-21 12:45:26"
"20262","Refactoring for Testability on an existing system","<p>I've joined a team that works on a product. This product has been around for ~5 years or so, and uses ASP.NET WebForms. Its original architecture has faded over time, and things have become relatively disorganized throughout the solution. It's by no means terrible, but definitely can use some work; you all know what I mean.</p>

<p>I've been performing some refactorings since coming on to the project team about 6 months ago. Some of those refactorings are simple, Extract Method, Pull Method Up, etc. Some of the refactorings are more structural. The latter changes make me nervous as there isn't a comprehensive suite of unit tests to accompany every component. </p>

<p>The whole team is on board for the need to make structural changes through refactoring, but our Project Manager has expressed some concerns that we don't have adequate tests to make refactorings with the confidence that we aren't introducing regression bugs into the system. He would like us to write more tests first (against the existing architecture), then perform the refactorings. My argument is that the system's class structure is too tightly coupled to write adequate tests, and that using a more Test Driven approach while we perform our refactorings may be better. What I mean by this is not writing tests against the existing components, but writing tests for specific functional requirements, then refactoring existing code to meet those requirements. This will allow us to write tests that will probably have more longevity in the system, rather than writing a bunch of 'throw away' tests.</p>

<p>Does anyone have any experience as to what the best course of action is? I have my own thoughts, but would like to hear some input from the community.</p>
","<asp.net><refactoring><automated-tests>","5","398","2008-08-21 15:34:46"
"20420","Any ReSharper equivalent for Xcode?","<p>I'm a complete Xcode/Objective-C/Cocoa newbie but I'm learning fast and really starting to enjoy getting to grips with a new language, platform and paradigm.</p>

<p>One thing is though, having been using Visual Studio with R# for so long I've kind of been spoiled with the coding tools such as refactorings and completion etc and as far as I can tell Xcode has some fairly limited built in support for this stuff.</p>

<p>On that note, does anyone know if any add-ins or whatever are available for the Xcode environment which add coding helpers such as automatically generating implementation skeletons from a class interface definition etc? </p>

<p>I suspect there aren't but I suppose it can't help to ask.</p>
","<objective-c><xcode><osx><refactoring>","25","5882","2008-08-21 16:18:41"
"21857","When do you know it's time to rewrite an application","<p>This is humbling, but probably something most can relate to.  I am currently adding functionality to a PHP application I wrote for a client 2 years ago.  In the interest of full disclosure, this was the first ""real"" application I ever built from the ground up, in the sense that I actually met with clients to determine and write a spec.  I then built the application by myself, learning SQL as I went (I had some prior rudimentary PHP experience).</p>

<p>The client contacted me this week to make modifications to existing functionality as well as add new modules to the application.  I realize now that I did a poor job of modularizing the application from the start to make additions easier.  Currently, the code base is almost 20,000 lines of code (it is a fairly sophisticated, if narrow application).</p>

<p>I'm struggling with whether or not to ""rewrite"" the application to make future changes easier and more efficient.  I should point out that the nature of my agreement with the client is one in which I will be the only person making modifications in the future.  They will not seek another developer for this app.</p>

<p>The budding programmer in me always wants to do things in the cleanest and most efficient way in order to satisfy my own OCD, but I do intend to bill the client for any time I spend rewriting.  Morally, I feel fine with this because the initial rate that I charged them was low - they got a stable, working app which has been performing without any intervention from me for 2 years, and I got my first real development project on my resume.  My dilemma is about when to decide to rewrite an application for the sake of future development.</p>

<p>Please weigh in with your thoughts.  I'm sure I'm not the only one who has ever had this problem.</p>
","<php><mysql><refactoring><rewrite><billing>","67","2676","2008-08-22 05:47:10"
"23899","Best practices for refactoring classic ASP?","<p>I've got to do some significant development in a large, old, spaghetti-ridden ASP system. I've been away from ASP for a long time, focusing my energies on Rails development.</p>

<p>One basic step I've taken is to refactor pages into subs and functions with meaningful names, so that at least it's easy to understand @ the top of the file what's generally going on.</p>

<p>Is there a worthwhile MVC framework for ASP? Or a best practice at how to at least get business logic out of the views? (I remember doing a lot of includes back in the day -- is that still the way to do it?)</p>

<p>I'd love to get some unit testing going for business logic too, but maybe I'm asking too much?</p>

<h3>Update:</h3>

<p>There are over 200 ASP scripts in the project, some thousands of lines long ;) UGH!</p>

<p>We may opt for the ""big rewrite"" but until then, when I'm in changing a page, I want to spend a little extra time cleaning up the spaghetti.</p>
","<asp.net-mvc><coding-style><refactoring>","11","2059","2008-08-23 02:56:37"
"23787","Cleanest Way to Find a Match In a List","<p>What is the best way to find something in a list?  I know LINQ has some nice tricks, but let's also get suggestions for C# 2.0.  Lets get the best refactorings for this common code pattern.</p>

<p>Currently I use code like this:</p>

<pre><code>// mObjList is a List&lt;MyObject&gt;
MyObject match = null;
foreach (MyObject mo in mObjList)
{
    if (Criteria(mo))
    {
        match = mo;
        break;
    }
}
</code></pre>

<p>or</p>

<pre><code>// mObjList is a List&lt;MyObject&gt;
bool foundIt = false;
foreach (MyObject mo in mObjList)
{
    if (Criteria(mo))
    {
        foundIt = true;
        break;
    }
}
</code></pre>
","<c#><refactoring>","7","436","2008-08-23 00:22:24"
"27663","What kind of database refactoring tools are there?","<p>I am looking for something to integrate to my CI workflow.<br />
I've heard of dbdeploy (<a href=""http://dbdeploy.com/"">http://dbdeploy.com/</a>) but I'm looking for something else. The reason I don't like dbdeploy is I don't want to install java on my server.</p>

<p>I would prefer of course that the solution doesn't involve stringing some shell scripts together.</p>
","<database><refactoring>","12","3441","2008-08-26 09:55:44"
"28578","How can I merge my files when the folder structure has changed using Borland StarTeam?","<p>I'm in the process of refactoring some code which includes moving folders around, and I would like to regularly merge to keep things current. What is the best way to merge after I've moved folders around in my working copy?</p>
","<version-control><refactoring><merge><starteam>","2","447","2008-08-26 16:48:51"
"28796","What refactoring tools do you use for Python?","<p>I have a bunch of classes I want to rename.  Some of them have names that are small and that name is reused in other class names, where I don't want that name changed.  Most of this lives in Python code, but we also have some XML code that references class names.</p>

<p>Simple search and replace only gets me so far.  In my case, I want to rename AdminAction to AdminActionPlug and AdminActionLogger to AdminActionLoggerPlug, so the first one's search-and-replace would also hit the second, wrongly.</p>

<p>Does anyone have experience with Python refactoring tools ? Bonus points if they can fix class names in the XML documents too.</p>
","<python><refactoring>","24","5844","2008-08-26 18:26:51"
"15057","find orphaned methods in codebase","<p>I'm sure we've all seen it before...A code base that has been around for a year or two, and as features have been added and bugs fixed, we end up with pieces of code that aren't actually in use anymore.  I'm wondering if there is a way (especially in VS.NET with or without a third-party tool) to search the codebase and show me which methods are NEVER used anywhere else in the code?</p>

<p>The one challenge I can think of in regards to this type of utility would be the inability to map back when implicit type conversions are occuring.  But assuming that wasn't a problem, what are my options?</p>
","<.net><visual-studio><tools><refactoring>","8","768","2008-08-18 18:37:12"
"35233","Rewrite or repair?","<p>I'm sure you have all been there, you take on a project where there is a creaky old code base which is barely fit for purpose and you have to make the decision to either re-write it from scratch or repair what already exists.  </p>

<p>Conventional wisdom tends to suggest that you should never attempt a re-write from scratch as the risk of failure is very high.  So what did you do when faced with this problem, how did you make the decision and how did it turn out?</p>
","<refactoring><rewrite>","11","838","2008-08-29 20:27:11"
"40264","How many constructor arguments is too many?","<p>Let's say you have a class called Customer, which contains the following fields:</p>

<ul>
<li>UserName</li>
<li>Email</li>
<li>First Name</li>
<li>Last Name</li>
</ul>

<p>Let's also say that according to your business logic, all Customer objects must have these four properties defined.</p>

<p>Now, we can do this pretty easily by forcing the constructor to specify each of these properties.  But it's pretty easy to see how this can spiral out of control when you are forced to add more required fields to the Customer object.  </p>

<p>I've seen classes that take in 20+ arguments into their constructor and it's just a pain to use them.  But, alternatively, if you don't require these fields you run into the risk of having undefined information, or worse, object referencing errors if you rely on the calling code to specify these properties.</p>

<p>Are there any alternatives to this or do you you just have to decide whether X amount of constructor arguments is too many for you to live with?</p>
","<parameters><refactoring><constructor><coding-style>","24","4170","2008-09-02 18:44:31"
"48817","Where to find resources on Refactoring?","<p>Refactoring is the process of improving the existing system design without changing its behavior.</p>

<p>Besides Martin Fowler's seminal book ""<a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">Refactoring - Improving the design of existing code</a>"" and Joshua Kerievsky's book ""<a href=""http://rads.stackoverflow.com/amzn/click/0321213351"" rel=""nofollow"">Refactoring to Patterns</a>"", are there any good resources on refactoring?  </p>
","<design><refactoring>","7","459","2008-09-07 21:40:27"
"47437","Which is a better refactoring tool for a beginner (something easy to learn & use)?","<p>Resharper, RefactorPro, etc?</p>
","<refactoring>","1","220","2008-09-06 13:07:50"
"54264","Tracking Refactorings in a Bug Database","<p>Let's say you work someplace where every change to source code must be associated with a bug-report or feature-request, and there is no way to get that policy reformed.  In such an environment, what is the best way to deal with code refactorings (that is, changes that improve the code but do not fix a bug or add a feature)?</p>

<ul>
<li>Write up a bug-report and associate the refactoring with it.</li>
<li>Write up a feature-request and associate the refactoring with it.</li>
<li>Sneak in the refactorings while working on code that is associated with a bug-report/feature-request.</li>
<li>Just don't do any refactoring.</li>
<li>Other</li>
</ul>

<p>Note that all bug reports and feature descriptions will be visible to managers and customers.</p>
","<refactoring><bug-tracking>","4","179","2008-09-10 14:49:45"
"56764","Starting a new job focused on brownfield application refactoring & Agile","<p>I am starting a new job on Monday. The company has a home grown enterprise case management application written in ASP.NET/VB.NET. They are attempting to implement an Agile development process. They have gone so far as to get two people Scrum Master certified and hire an Agile coach. They are currently focused on 6-9 months of refactoring.</p>

<p>My question is what are some good approaches/tooling given this environment for becoming familiar with the code base and being productive as soon as I hit the ground? </p>
","<.net><vb.net><refactoring><brownfield>","3","182","2008-09-11 14:52:15"
"60100","In C# (or any language) what is/are your favourite way of removing repetition?","<p>I've just coded a 700 line class. Awful. I hang my head in shame.  It's as opposite to DRY as a British summer.</p>

<p>It's full of cut and paste with minor tweaks here and there.  This makes it's a prime candidate for refactoring.  Before I embark on this, I'd thought I'd ask when you have lots of repetition, what are the first refactoring opportunities you look for?</p>

<p>For the record, mine are probably using:</p>

<ol>
<li>Generic classes and methods</li>
<li>Method overloading/chaining.</li>
</ol>

<p>What are yours?</p>
","<c#><refactoring><coding-style><tips-and-tricks>","3","461","2008-09-12 22:39:33"
"68391","How to write a Rails mixin that spans across model, controller, and view","<p>In an effort to reduce code duplication in my little Rails app, I've been working on getting common code between my models into it's own separate module, so far so good.</p>

<p>The model stuff is fairly easy, I just have to include the module at the beginning, e.g.:</p>

<pre><code>class Iso &lt; Sale
  include Shared::TracksSerialNumberExtension
  include Shared::OrderLines
  extend  Shared::Filtered
  include Sendable::Model

  validates_presence_of   :customer
  validates_associated    :lines

  owned_by :customer

  def initialize( params = nil )
    super
    self.created_at ||= Time.now.to_date
  end

  def after_initialize
  end

  order_lines             :despatched

  # tracks_serial_numbers   :items
  sendable :customer

  def created_at=( date )
    write_attribute( :created_at, Chronic.parse( date ) )
  end
end
</code></pre>

<p>This is working fine, now however, I'm going to have some controller and view code that's going to be common between these models as well, so far I have this for my sendable stuff:</p>

<pre><code># This is a module that is used for pages/forms that are can be ""sent""
# either via fax, email, or printed.
module Sendable
  module Model
    def self.included( klass )
      klass.extend ClassMethods
    end

    module ClassMethods
      def sendable( class_to_send_to )
        attr_accessor :fax_number,
                      :email_address,
                      :to_be_faxed,
                      :to_be_emailed,
                      :to_be_printed

        @_class_sending_to ||= class_to_send_to

        include InstanceMethods
      end

      def class_sending_to
        @_class_sending_to
      end
    end # ClassMethods

    module InstanceMethods
      def after_initialize( )
        super
        self.to_be_faxed    = false
        self.to_be_emailed  = false
        self.to_be_printed  = false

        target_class = self.send( self.class.class_sending_to )
        if !target_class.nil?
          self.fax_number     = target_class.send( :fax_number )
          self.email_address  = target_class.send( :email_address )
        end
      end
    end
  end # Module Model
end # Module Sendable
</code></pre>

<p>Basically I'm planning on just doing an include Sendable::Controller, and Sendable::View (or the equivalent) for the controller and the view, but, is there a cleaner way to do this?  I 'm after a neat way to have a bunch of common code between my model, controller, and view.</p>

<p>Edit: Just to clarify, this just has to be shared across 2 or 3 models.</p>
","<ruby-on-rails><ruby><refactoring><dry>","5","6361","2008-09-16 01:00:29"
"68459","Refactoring and Source Control: How To?","<p>I am completely on board with the ideas behind TDD, Refactoring and Patterns however it does seem like there is a huge gaping whole in these ideas, mainly that they are great for dev teams of 1, but when you start refactoring code that 10 people are working on you start getting merge conflicts all over the place and most diff/merge software can't tell that you refactored a function into its own class.</p>

<p>How do you clean up your code, by refactoring, without causing major headaches for everyone on your team?</p>
","<version-control><refactoring><tdd>","2","421","2008-09-16 01:12:56"
"69107","Best Refactor to Handle Multiple jQuery Email Field Form Validation","<p>What is the best way to refactor the attached code to accommodate multiple email addresses?</p>

<p>The attached HTML/jQuery is complete and works for the first email address. I can setup the other two by copy/pasting and changing the code. But I would like to just refactor the existing code to handle multiple email address fields.</p>

<pre><code>&lt;html&gt;
&lt;head&gt;
    &lt;script src=""includes/jquery/jquery-1.2.6.min.js"" type=""text/javascript""&gt;&lt;/script&gt;
    &lt;script language=""javascript""&gt;
        $(document).ready(function() {
            var validateUsername = $('#Email_Address_Status_Icon_1');

            $('#Email_Address_1').keyup(function() {
                var t = this;
                if (this.value != this.lastValue) {
                    if (this.timer) clearTimeout(this.timer);
                    validateUsername.removeClass('error').html('Validating Email');

                    this.timer = setTimeout(function() {
                        if (IsEmail(t.value)) {
                            validateUsername.html('Valid Email');
                        } else {
                            validateUsername.html('Not a valid Email');
                        };
                    }, 200);

                    this.lastValue = this.value;
                }
            });
        });

        function IsEmail(email) {
            var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            if (regex.test(email)) return true;
            else return false;
        }  
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
        &lt;label for=""Email_Address_1""&gt;Friend #1&lt;/label&gt;&lt;/div&gt;
        &lt;input type=""text"" ID=""Email_Address_1""&gt;
        &lt;span id=""Email_Address_Status_Icon_1""&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;label for=""Email_Address_2""&gt;Friend #2&lt;/label&gt;&lt;/div&gt;
    &lt;input type=""text"" id=""Email_Address_2""&gt;
        &lt;span id=""Email_Address_Status_Icon_2""&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;label for=""Email_Address_3""&gt;Friend #3&lt;/label&gt;&lt;/div&gt;
    &lt;input type=""text"" id=""Email_Address_3""&gt;
        &lt;span id=""Email_Address_Status_Icon_3""&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
","<jquery><email><refactoring><form-validation>","0","4466","2008-09-16 03:12:33"
"72879","Refactoring in Ruby","<p>Are there any programs or IDEs that support refactoring for Ruby or RoR?</p>
","<ruby-on-rails><ruby><refactoring>","11","1304","2008-09-16 14:25:43"
"70124","How do you find your way around a new codebase","<p>You don't always get to talk to the original author or authors of the code you maintain. Sometimes when I work on an existing project I feel like a special forces operative behind enemy lines trying to figure out the lay of the land without the use of a map. When you are in this situation how do you get the code under control?
How do you:</p>

<ol>
<li>find out how things work </li>
<li>understand the mindset of the previous authors</li>
</ol>

<p>So many times I hear other developers say well this just needs to be rewritten that can't always be the answer. What is yours?</p>
","<refactoring>","15","1848","2008-09-16 07:40:19"
"78806","Refactor Mercilessly or Build One To Throw Away?","<blockquote>
  <p>Where a new system concept or new technology is used, one has to build a
  system to throw away, for even the best planning is not so omniscient as
  to get it right the first time. Hence <strong>plan to throw one away; you will, anyhow.</strong></p>
  
  <p>-- Fred Brooks, <a href=""http://en.wikipedia.org/wiki/The_Mythical_Man-Month""><em>The Mythical Man-Month</em></a> [Emphasis mine]</p>
</blockquote>

<p>Build one to throw away.  That's what they told me.  Then they told me that we're all <a href=""http://agilemanifesto.org/"">agile</a> now, so we should <a href=""http://c2.com/cgi/wiki?RefactorMercilessly"">Refactor Mercilessly</a>.  What gives?</p>

<p>Is it <strong>always</strong> better to refactor my way out of trouble?  If not, can anyone suggest a rule-of-thumb to help me decide when to stick with it, and when to give up and start over?</p>
","<refactoring>","11","994","2008-09-17 01:03:41"
"77193","How do you justify Refactoring work to your penny-pinching boss?","<p>You've just written a pile of code to deliver some important feature under pressure.  You've cut a few corners, you've mashed some code into some over-bloated classes with names like SerialIndirectionShutoffManager..</p>

<p>You tell your boss you're going to need a week to clean this stuff up.</p>

<p>""Clean what up?""</p>

<p>""My code - its a pigsty!""</p>

<p>""You mean there's some more bug fixing?""</p>

<p>""Not really, its more like..""</p>

<p>""You're gonna make it run faster?""</p>

<p>""Perhaps, buts thats not..""</p>

<p>""Then you should have written it properly when you had the chance.  Now I'm glad you're here, yeah, I'm gonna have to go ahead and ask you to come in this weekend.. ""</p>

<p>I've read Matin Fowler's book, but I'm not sure I agree with his advice on this matter:</p>

<ul>
<li>Encourage regular code reviews, so refactoring work is encouraged as a natural part of the development process.  </li>
<li>Just don't tell, you're the developer and its part of your duty. </li>
</ul>

<p>Both these methods squirm out of the need to communicate with your manager.</p>

<p>What do you tell your boss?</p>
","<refactoring>","13","1314","2008-09-16 21:14:11"
"94263","How to programmatically determine param name when constructing an ArgumentException?","<p>When constructing an ArgumentException, a couple of the overloads take a string that is the invalid argument's parameter name. I figure it would be nice to not have to remember to update this ctor param whenever I change the method's param name. Is there a simple way to do this using reflection?</p>

<p><strong>Update:</strong> thanks to the 2 respondents so far. You both answer the question well, but the solution still leaves me with a maintenance headache. (Okay, a <strong>tiny</strong> headache, but still...) To explain, if I were to <em>reorder</em> the params later -- or remove an earlier param -- I'd have to remember to change my exception-construction code again. Is there a way I can use something along the lines of</p>

<pre><code>Object.ReferenceEquals(myParam, &lt;insert code here&gt;)
</code></pre>

<p>to be sure I'm dealing with the relevant parameter? That way, the compiler would step in to prevent me badly constructing the exception.</p>

<p>That said, I'm starting to suspect that the ""simple"" part of the original question not that forthcoming. Maybe I should just put up with using string literals. :)</p>
","<.net><reflection><refactoring><duplication>","3","160","2008-09-18 16:39:04"
"91384","Unit testing for C++ code - Tools and methodology","<p>I'm working on a large c++ system that is has been in development for a few years now. As part of an effort to improve the quality of the existing code we engaged on a large long-term refactoring project.</p>

<p>Do you know a good tool that can help me write unit tests in C++? Maybe something similar to Junit or Nunit?</p>

<p>Can anyone give some good advice on the methodology of writing unit tests for modules that were written without unit testing in mind?</p>
","<c++><unit-testing><refactoring>","76","10004","2008-09-18 10:08:47"
"98426","How to Refactor to Generics from Class that Inherits from CollectionBase?","<p>I am working on an application that is about 250,000 lines of code.  I'm currently the only developer working on this application that was originally built in .NET 1.1.  Pervasive throughout is a class that inherits from CollectionBase.  All database collections inherit from this class.  I am considering refactoring to inherit from the generic collection List instead.  Needless to say, Martin Fowler's Refactoring book has no suggestions.  Should I attempt this refactor?  If so, what is the best way to tackle this refactor?</p>

<p>And yes, there are unit tests throughout, but no QA team.</p>
","<c#><generics><.net-3.5><.net-2.0><refactoring>","2","454","2008-09-19 00:46:25"
"98079","Can eclipse extract a second class in class file to its own file","<p>I often refactor code first by creating an inner class inside the class I'm working on--When I'm done, I move the entire thing into a new class file.  This makes refactoring code into the new class extremely easy because A) I'm only dealing with a single file, and B) I don't create new files until I have a pretty good idea of the name/names (Sometimes it ends up as more than one class).</p>

<p>Is there any way Eclipse can help me with the final move?  I should just be able to tell it what package I want the class in, it can figure out the filename from the class name and the directory from the package.</p>

<p>This seems like a trivial refactor and really obvious, but I can't figure out the keystrokes/gestures/whatever to make it happen.  I've tried dragging, menus, context menus, and browsing through the keyboard shortcuts.</p>

<p>Anyone know this one?</p>

<p>[edit] These are already ""Top Level"" classes in this file, not inner classes, and ""Move"" doesn't seem to want to create a new class for me. This is the hard way that I usually do it--involves going out, creating an empty class, coming back and moving.  I would like to do the whole thing in a single step.</p>
","<java><eclipse><refactoring>","11","2435","2008-09-18 23:43:53"
"100633","Why do you not declare several variables of the same type on the same line?","<p>Why is it bad practice to declare variables on one line?</p>

<p>e.g.</p>

<pre><code>private String var1, var2, var3
</code></pre>

<p>instead of: </p>

<pre><code>private String var1;
private String var2;
private String var3;
</code></pre>
","<language-agnostic><layout><refactoring>","6","1336","2008-09-19 09:06:16"
"102394","Sorting a dict on __iter__","<p>I am trying to sort a dict based on its key and return an iterator to the values from within an overridden iter method in a class. Is there a nicer and more efficient way of doing this than creating a new list, inserting into the list as I sort through the keys?</p>
","<python><optimization><refactoring>","3","416","2008-09-19 14:43:24"
"99474","how to handle code that is deemed dangerous to change, but stable?","<p>What is the best way to handle a big team that has access to a stable but no so pretty code, that is easy to introduce bugs into?</p>

<p>I'm looking for something along the lines of SVN locking the file(s). </p>
","<c++><svn><refactoring>","3","256","2008-09-19 03:57:34"
"100876","How do you refactor your old PHP code?","<p>I have recently gotten involved in a project where a web-based game uses an engine written in PHP.  The game works fine but could be more robust and have some more features - and the code is both old and fairly ugly.</p>

<p>The issue with this code (and much PHP code in general I suspect) is that it has evolved to where it is and isn't structured very nicely, has a lot of almost-identical cut/pasted pieces of code, and makes heavy use of globals even where functions are involved.  Not a single unit test anywhere, of course, and the code is hard coded to use a particular DB and relies on $_REQUEST strings from the web page that calls the code.</p>

<p>The right thing to do would be to pull out pieces of the code as sub-functions, tidy them up and add some unit tests to make sure it continues to work, adding a few mock objects along the way.  However, doing this entirely by hand is tedious and error-prone and I wonder how you do this - is there an IDE or tool that can help, for example?  I would like to have a tool that can help produce a function from a defined piece of code, suggest which variables should be parameters, by value or reference, automatically add $this-> references, etc.</p>

<p>Is this too much to ask, or is there a good solution?</p>

<p>Thanks!</p>
","<php><tools><refactoring>","5","617","2008-09-19 10:07:46"
"104380","Tips on refactoring an outdated database schema","<p>Being stuck with a legacy database schema that no longer reflects your data model is every developer's nightmare.  Yet with all the talk of refactoring code for maintainability I have not heard much of refactoring outdated database schemas.  </p>

<p>What are some tips on how to transition to a better schema without breaking all the code that relies on the old one?  I will propose a specific problem I am having to illustrate my point but feel free to give advice on other techniques that have proven helpful - those will likely come in handy as well.</p>

<p><hr /></p>

<p>My example:</p>

<p>My company receives and ships products.  Now a product receipt and a product shipment have some very different data associated with them so the original database designers created a separate table for receipts and for shipments.  </p>

<p>In my one year working with this system I have come to the realization that the current schema doesn't make a lick of sense.  After all, both a receipt and a shipment are basically a transaction, they each involve changing the amount of a product, at heart only the +/- sign is different.  Indeed, we frequently need to find the total amount that the product has changed over a period of time, a problem for which this design is downright intractable.  </p>

<p>Obviously the appropriate design would be to have a single Transactions table with the Id being a foreign key of either a ReceiptInfo or a ShipmentInfo table.  Unfortunately, the wrong schema has already been in production for some years and has hundreds of stored procedures, and thousands of lines of code written off of it.  How then can I transition the schema to work correctly?</p>
","<database><refactoring><schema><hints-and-tips>","13","1101","2008-09-19 18:36:14"
"101333","The ultimate MySQL legacy database nightmare","<p>Table1:
Everything including the kitchen sink. Dates in the wrong format (year last so you cannot sort on that column), Numbers stored as VARCHAR, complete addresses in the 'street' column, firstname and lastname in the firstname column, city in the lastname column, incomplete addresses, Rows that update preceeding rows by moving data from one field to another based on some set of rules that has changed over the years, duplicate records, incomplete records, garbage records... you name it... oh and of course not a TIMESTAMP or PRIMARY KEY column in sight.</p>

<p>Table2:
Any hope of normalization went out the window upon cracking this baby open. 
We have a row for each entry AND update of rows in table one. So duplicates like there is no tomorrow (800MB worth) and columns like Phone1 Phone2 Phone3 Phone4 ... Phone15 (they are not called phone. I use this for illustration) The foriegn key is.. well take guess. There are three candidates depending on what kind of data was in the row in table1</p>

<p>Table3:
Can it get any worse. Oh yes.
The ""foreign key is a VARCHAR column combination of dashes, dots, numbers and letters! if that doesn't provide the match (which it often doesn't) then a second column of similar product code should. Columns that have names that bear NO correlation to the data within them, and the obligatory Phone1 Phone2 Phone3 Phone4... Phone15. There are columns Duplicated from Table1 and not a TIMESTAMP or PRIMARY KEY column in sight.</p>

<p>Table4: was described as a work in progess and subject to change at any moment. It is essentailly simlar to the others.</p>

<p>At close to 1m rows this is a BIG mess. Luckily it is not my big mess. Unluckily I have to pull out of it a composit record for each ""customer"".</p>

<p>Initially I devised a four step translation of Table1 adding a PRIMARY KEY and converting all the dates into sortable format. Then a couple more steps of queries that returned filtered data until I had Table1 to where I could use it to pull from the other tables to form the composit. After weeks of work I got this down to one step using some tricks. So now I can point my app at the mess and pull out a nice clean table of composited data. Luckily I only need one of the phone numbers for my purposes so normalizing my table is not an issue. </p>

<p>However this is where the real task begins, because every day hundreds of employees add/update/delete this database in ways you don't want to imagine and every night I must retrieve the new rows.</p>

<p>Since existing rows in any of the tables can be changed, and since there are no TIMESTAMP ON UPDATE columns, I will have to resort to the logs to know what has happened. Of course this assumes that there is a binary log, which there is not!</p>

<p>Introducing the concept went down like lead balloon. I might as well have told them that their children are going to have to undergo experimental surgery. They are not exactly hi tech... in case you hadn't gathered...</p>

<p>The situation is a little delicate as they have some valuable information that my company wants badly. I have been sent down by senior management of a large corporation (you know how they are) to ""make it happen"".</p>

<p>I can't think of any other way to handle the nightly updates, than parsing the bin log file with yet another application, to figure out what they have done to that database during the day and then composite my table accordingly. I really only need to look at their table1 to figure out what to do to my table. The other tables just provide fields to flush out the record. (Using MASTER SLAVE won't help because I will have a duplicate of the mess.)</p>

<p>The alternative is to create a unique hash for every row of their table1 and build a hash table. Then I would go through the ENTIRE database every night checking to see if the hashs match. If they do not then I would read that record and check if it exists in my database, if it does then I would update it in my database, if it doesn't then its a new record and I would INSERT it. This is ugly and not fast, but parsing a binary log file is not pretty either.</p>

<p>I have written this to help get clear about the problem. often telling it to someone else helps clarify the problem making a solution more obvious. In this case I just have a bigger headache!</p>

<p>Your thoughts would be greatly appreciated.</p>
","<mysql><database><design><refactoring><binary-log>","7","1191","2008-09-19 12:06:30"
"101868","Rails-like Database Migrations?","<p>Is there any easy to install/use (on unix) database migration tools like Rails Migrations? I really like the idea, but installing ruby/rails purely to manage my database migrations seems overkill.</p>
","<ruby-on-rails><ruby><database><refactoring><migration>","16","1608","2008-09-19 13:36:28"
"105602","Need refactoring ideas for Arrow Anti-Pattern","<p>I have inherited a monster.</p>

<p>It is masquerading as a .NET 1.1 application processes text files that conform to Healthcare Claim Payment (ANSI 835) standards, but it's a monster.  The information being processed relates to healthcare claims, EOBs, and reimbursements.  These files consist of records that have an identifier in the first few positions and data fields formatted according to the specs for that type of record.  Some record ids are Control Segment ids, which delimit groups of records relating to a particular type of transaction.</p>

<p>To process a file, my little monster reads the first record, determines the kind of transaction that is about to take place, then begins to process other records based on what kind of transaction it is currently processing.  To do this, it uses a nested if.  Since there are a number of record types, there are a number decisions that need to be made.  Each decision involves some processing and 2-3 other decisions that need to be made based on previous decisions.  That means the nested if has a lot of nests.  That's where my problem lies.</p>

<p>This one nested if is 715 lines long.  Yes, that's right.  Seven-Hundred-And-Fif-Teen Lines.  I'm no code analysis expert, so I downloaded a couple of freeware analysis tools and came up with a McCabe Cyclomatic Complexity rating of 49.  They tell me that's a pretty high number.  High as in pollen count in the Atlanta area where 100 is the standard for high and the news says ""Today's pollen count is 1,523"".  This is one of the finest examples of the Arrow Anti-Pattern I have ever been priveleged to see.  At its highest, the indentation goes 15 tabs deep.</p>

<p>My question is, what methods would you suggest to refactor or restructure such a thing?</p>

<p>I have spent some time searching for ideas, but nothing has given me a good foothold.  For example, substituting a guard condition for a level is one method.  I have only one of those.  One nest down, fourteen to go.</p>

<p>Perhaps there is a design pattern that could be helpful.  Would Chain of Command be a way to approach this?  Keep in mind that it must stay in .NET 1.1.</p>

<p>Thanks for any and all ideas.</p>
","<refactoring><nested><anti-patterns><if-statement><arrow>","9","825","2008-09-19 21:02:31"
"106329","How do you programmatically identify the number of references to a method with C#","<p>I've recently inherited C# console application that is in need of some pruning and clean up.  Long story short, the app consists of a single class containing over 110,000 lines of code.  Yup, over 110,000 lines in a single class.  And, of course, the app is core to our business, running 'round the clock updating data used on a dynamic website.  Although I'm told my predecessor was ""a really good programmer"", it obvious he was not at all into OOP (or version control).</p>

<p>Anyway... while familiarizing myself with the code I've found plenty of methods that are declared, but never referenced.  It looks as if copy/paste was used to version the code, for example say I have a method called getSomethingImportant(), chances are there is another method called getSomethingImortant_July2007() (the pattern is functionName_[datestamp] in most cases).  It looks like when the programmer was asked to make a change to getSomethingImportant() he would copy/paste then rename to getSomethingImortant_Date, make changes to getSomethingImortant_Date, then change any method calls in the code to the new method name, leaving the old method in the code but never referenced.</p>

<p>I'd like to write a simple console app that crawls through the one huge class and returns a list of all methods with the number of times each method was referenced.  By my estimates there are well over 1000 methods, so doing this by hand would take a while.</p>

<p>Are there classes within the .NET framework that I can use to examine this code?  Or any other usefull tools that may help identify methods that are declared but never referenced?</p>

<p>(Side question:  Has anyone else ever seen a C# app like this, one reeeealy big class?  It's more or less one huge procedural process, I know this is the first I've seen, at least of this size.)</p>
","<c#><refactoring>","4","717","2008-09-19 23:15:18"
"114272","Are there any utilites that will help me refactor CSS","<p>I am working with some CSS that is poorly written to say the least. I am not a design/CSS expert, but I at least understand the <strong>C</strong> in CSS. While the built in CSS support inside of VS-2008 is far improved over previous versions, it still doesn't quite do what I am looking for.</p>

<p>I was wondering if anyone knew of a good program or utility that will help me to refactor and clean up my CSS much the way that ReSharper helps you with C#.</p>

<p>Some features that would be nice:</p>

<ul>
<li>Examine CSS files and determine ways to extract common styles like font-style, color, etc...  </li>
<li>Possible plugin to VS-2008 would be awesome!</li>
<li>Examine markup files and make some suggestions on improving the current use of classes and styles.</li>
</ul>
","<asp.net><css><refactoring>","24","2211","2008-09-22 11:07:05"
"116762","Best Practices: Storing a workflow state of an item in a database?","<p>I have a question about best practices regarding how one should approach storing complex workflow states for processing tasks in a database.  I've been looking online to no avail, so I figured I'd ask the community what they thought was best.</p>

<p>This question comes out of the same ""BoxItem"" example I gave in a prior question.  This ""BoxItem"" is being tracked in my system as various tasks are performed on it.  The task may take place over several days and with human interaction, so the state of the BoxItem must be persisted.  Who did the task (if applicable), and when the task was done must also be tracked.</p>

<p>At first, I approached this by adding three fields to the ""BoxItems"" table for every human-interactive task that needed to be done:</p>

<p>Is*TaskName*Complete</p>

<p>Date*TaskName*Complete</p>

<p>User*TaskName*Complete</p>

<p>This worked when the workflow was simple... but now that it has grown to a complex process (> 10 possible human interactions in the flow... about half of which are optional, and may or may not be done for the BoxItem, which resulted in me beginning to add ""Do*TaskName*"" fields as well for those optional tasks), I've found that what should've been a simple table now has 40 or so field devoted entirely to the retaining of this state information.</p>

<p>I find myself asking if there isn't a better way to do it... but I'm at a loss.</p>

<p>My first thought was to make a generic ""BoxItemTasks"" table which defined the tasks that may be done on a given box, but I still would need to save the Date and User information individually, so it didn't really help.</p>

<p>My second thought was that perhaps it didn't matter, and I shouldn't worry if this table has 40 or more fields devoted to state retaining... and maybe I'm just being paranoid.  But it feels like that's a lot of information to retain.</p>

<p>Anyways, I'm at a loss as far as what a third option might be, or if one of the two options above is actually reasonable.  I can see this workflow potentially getting even more complex in the future, and for each new task I'm going to need to add 3-4 fields just to support the tracking of it... it feels like it's spiraling out of control.</p>

<p>What would you do in this situation?</p>

<p>I should note that this is maintenance of an existing system, one that was built without an ORM, so I can't just leave it up to the ORM to take care of it.</p>

<p>EDIT:</p>

<p>Kev, are you talking about doing something like this:</p>

<h2>BoxItems</h2>

<p>(PK) BoxItemID</p>

<p>(Other irrelevant stuff)</p>

<h2>BoxItemActions</h2>

<p>(PK) BoxItemID</p>

<p>(PK) BoxItemTaskID</p>

<p>IsCompleted</p>

<p>DateCompleted</p>

<p>UserCompleted</p>

<h2>BoxItemTasks</h2>

<p>(PK) TaskType</p>

<p>Description (if even necessary)</p>

<p>Hmm... that would work... it would represent a need to change how I currently approach doing SQL Queries to see which items are in what state, but in the long term something like this looks like it would work better (without having to make a fundamental design change like the Serialization idea represents... though if I had the time, I'd like to do it that way I think.).</p>

<p>So is this what you were mentioning Kin, or am I off on it?</p>

<p>EDIT: Ah, I see your idea as well with the ""Last Action"" to determine the current state... I like it!  I think that might work for me... I might have to change it up a little bit (because at some point tasks happen concurrently), but the idea seems like a good one!</p>

<p>EDIT FINAL:  So in summation, if anyone else is looking this up in the future with the same question... it sounds like the serialization approach would be useful if your system has the information pre-loaded into some interface where it's queryable (i.e. not directly calling the database itself, as the ad-hoc system I'm working on does), but if you don't have that, the additional tables idea seems like it should work well!  Thank you all for your responses!</p>
","<database><database-design><refactoring><workflow>","7","3085","2008-09-22 18:56:12"
"117960","How to refactor in a branch without losing my mind?","<p>I refactor my and other people's code <strong>all the time</strong>.
When I work in a branch and not in Trunk, this sometimes results in some extremely painful merges, especially if I don't merge back to Trunk regularly (the code at the branch slowly shifts away from the Trunc, and when people modify Trunk I have to figure out manually how to apply this to the branch).</p>

<p>The solutions I know are either </p>

<ol>
<li>Constantly merge to and from Trunk - reduces painful merges, but then why work in a branch at all?</li>
<li>Whenever you need to refactor something, switch to Trunk, do the refactoring there and merge to your branch - I don't find this very practical, since the actual cost of switching environments for every refactoring is huge.</li>
</ol>

<p>What do you do?</p>
","<refactoring><branch>","5","440","2008-09-22 22:15:16"
"126894","Visual Studio 2005 - Refactor multiple attributes in same time?","<p>I use the right button>Refactor>Encapsultate field to have my accessor every time. The problem is when I create new class, I can have more than 10 attributes and it's long to do 1 by 1 every accessor. Is there a faster way to create them?</p>

<p>Thank you for your time.</p>
","<.net><visual-studio><refactoring>","2","1453","2008-09-24 12:42:50"
"124358","Reuse MVC arhitecture; Have two layers of UI : ASP.NET MVC and .NET Winforms","<p>Although my question might seem abstract I hope it's not. Suppose I develop an application, an ASP.NET MVC site and later I am tasked to build an Winforms client for this application how much and how can I reuse from the existing application?</p>

<p>I defined the models, I defined controllers and views. They all work well.</p>

<p>Now the boss comes asking for a Winforms client and I am hoping I can reuse the models and the controllers (provided I put them in different assemblies) and not reuse just the views (ASPX views).</p>

<p>Can this be done? How?</p>
","<asp.net><winforms><mvc><refactoring><reuse>","7","882","2008-09-23 22:39:08"
"134459","Refactoring global to local. Should they be static or not?","<p>I'm refactoring ""spaghetti code"" C module to work in multitasking (RTOS) environment.</p>

<p>Now, there are very long functions and many unnecessary global variables.</p>

<p>When I try to replace global variables that exists only in one function with locals, I get into dilemma. Every global variable is behave like local ""static"" - e.g. keep its value even you exit and re-enter to the function.</p>

<p>For multitasking ""static"" local vars are worst from global. They make the functions non reentered.</p>

<p>There are a way to examine if the function is relay on preserving variable value re-entrancing without tracing all the logical flow?</p>
","<c><refactoring><static><global-variables><rtos>","1","741","2008-09-25 16:46:58"
"135130","Semantic merge tool","<p>Background: In my job, we use SVN, C# and VisualStudio. Part of my task regularly involves global renames. Often I end up with a broken build after renaming something and then merging in changes.</p>

<p>The question: is there a solution out there that can look at my changes, notice the global rename and then apply that to the edit that others have made while merging them in?</p>

<p>Another way to get much the same effect would be some sort of refactor log and then apply that to the incoming edits.</p>

<p>The tool need not be perfect, even if it just noted any references in their edits that referred to something that I have edited would be valuable.</p>

<p><strong>Edit</strong> I'm aware of VS's refactor tools. What I'm looking for is something that will allow me to, after I have refactored my working copy, apply the same refactorings to other peoples edits that I now need to merge in.</p>

<p>The ideal solution would be to make sure there are no outstanding edits when I do the refactoring, but that would prevent anyone else from getting anything done for the next week or more. (Because they would have to sync every half hour or so for the next week)</p>
","<c#><refactoring><merge><devtools>","2","560","2008-09-25 18:37:26"
"140677","How often should you refactor?","<p>I had a discussion a few weeks back with some co-workers on refactoring, and I seem to be in a minority that believes ""Refactor early, refactor often"" is a good approach that keeps code from getting messy and unmaintainable. A number of other people thought that it just belongs in the maintenance phases of a project.</p>

<p>If you have an opinion, please defend it.</p>
","<refactoring>","34","1683","2008-09-26 16:59:24"
"140815","Are you a code neat freak?","<p>How do you handle ugly code? Are you a code neat freak? </p>

<ul>
<li>Do you feel that you have to clean up a file of source code before you can do anything useful? </li>
<li>Do you have the urge to refactor bad structure when you see it?</li>
</ul>

<p>I admit that I'm often tempted to clean up other people's code when I have to modify the code anyway. Bad code is a pet peeve of mine. </p>

<p>How about you?</p>

<p>EDIT: I've read the discussion about subjectivity in the comments, and that subjectivity should be avoided in SO because the goal is to have neutral questions about technicalities. I've already answered questions here about Landau-O notation, C++ declaration and definitions, network addresses and such. But I feel like I'm being forced to move everything that might be subjective off SO. I would like those who think SO must be cleansed from all subjectivity to think a bit about why a community succeeds. To my mind, it's a mixture of hard facts and softer topics. If you read the current SO topics you will find quite some subjective topics (like best books wanted etc.). People like the format for poll-like questions, too. Why not support them? Those who want a completely objective SO could get a switch that filters subjective-tagged topics out in the first place.</p>
","<refactoring>","12","925","2008-09-26 17:29:41"
"130913","What is the state of C++ refactor support in Eclipse?","<p>Is it at the state where it is actually useful and can do more than rename classes?</p>
","<c++><eclipse><refactoring>","16","3757","2008-09-25 01:08:34"
"143745","Refactoring ""include file hell""","<p>One thing that's really been making life difficult in getting up to speed on the codebase on an ASP classic project is that the include file situation is kind of a mess.  I sometimes find the function I was looking for being included in an include file that is totally unrelated.  Does anyone have any advice on how to refactor this such that one can more easily tell where a function is if they need to find it?</p>

<p><strong>EDIT:</strong> One thing I forgot to ask:  does vbscript have any kind of mechanism for preventing a file from being included twice?  Sorta like #ifndef's from C?</p>
","<asp-classic><vbscript><refactoring>","4","1427","2008-09-27 14:53:47"
"144392","Is there a tool that will look at my Java code, and suggest a good package structure?","<p>I have a large codebase, and I'd like to refactor the package structure so that classes which interact heavily go in the same package.</p>

<p>It seems that it should be possible to create a tool that could look at the interactions between classes, and then group together those classes that interact heavily.  These groupings might then suggest a good hierarchy for packages.</p>

<p>Does such a tool exist? (open source is preferred).</p>
","<java><refactoring>","3","493","2008-09-27 20:26:55"
"144734","When is it good (if ever) to scrap production code and start over?","<p>I was asked to do a code review and report on the feasibility of adding a new feature to one of our new products, one that I haven't personally worked on until now. I know it's easy to nitpick someone else's code, but I'd say it's in bad shape (while trying to be as objective as possible). Some highlights from my code review:</p>

<ul>
<li><p><strong>Abuse of threads:</strong> <code>QueueUserWorkItem</code> and threads in general are used <em>a lot</em>, and Thread-pool delegates have uninformative names such as <code>PoolStart</code> and <code>PoolStart2</code>. There is also a lack of proper synchronization between threads, in particular accessing UI objects on threads other than the UI thread.</p></li>
<li><p><strong>Magic numbers and magic strings</strong>: Some <code>Const</code>'s and <code>Enum</code>'s are defined in the code, but much of the code relies on literal values.</p></li>
<li><p><strong>Global variables</strong>: Many variables are declared global and may or may not be initialized depending on what code paths get followed and what order things occur in. This gets very confusing when the code is also jumping around between threads.</p></li>
<li><p><strong>Compiler warnings</strong>: The main solution file contains 500+ warnings, and the total number is unknown to me. I got a warning from Visual Studio that it couldn't display any more warnings.</p></li>
<li><p><strong>Half-finished classes</strong>: The code was worked on and added to here and there, and I think this led to people forgetting what they had done before, so there are a few seemingly half-finished classes and empty stubs.</p></li>
<li><p><strong>Not Invented Here</strong>: The product duplicates functionality that already exists in common libraries used by other products, such as data access helpers, error logging helpers, and user interface helpers.</p></li>
<li><p><strong>Separation of concerns</strong>: I think someone was holding the book upside down when they read about the typical ""UI -> business layer -> data access layer"" 3-tier architecture. In this codebase, the UI layer directly accesses the database, because the business layer is partially implemented but mostly ignored due to not being fleshed out fully enough, and the data access layer controls the UI layer. Most of the low-level database and network methods operate on a global reference to the main form, and directly show, hide, and modify the form. Where the rather thin business layer <em>is</em> actually used, it also tends to control the UI directly. Most of this lower-level code also uses <code>MessageBox.Show</code> to display error messages when an exception occurs, and most swallow the original exception. This of course makes it a bit more complicated to start writing units tests to verify the functionality of the program before attempting to refactor it.</p></li>
</ul>

<p>I'm just scratching the surface here, but my question is simple enough: Would it make more sense to take the time to refactor the existing codebase, focusing on one issue at a time, or would you consider rewriting the entire thing from scratch?</p>

<p><strong>EDIT</strong>: To clarify a bit, we do have the original requirements for the project, which is why starting over could be an option. Another way to phrase my question is: Can code ever reach a point where the cost of maintaining it would become greater than the cost of dumping it and starting over?</p>
","<refactoring><business><rewrite>","49","2446","2008-09-27 23:29:44"
"146124","What are the limitations of refactoring?","<p>I'm making a study on refactoring limitations on improving existing software architecture and I would be interested to hear your experiences where you have found refactoring to be not enough or still too immature to accomplish your goals.</p>
","<refactoring>","1","617","2008-09-28 15:46:16"
"147378","Options for refactoring bits of code away from native C++?","<p>So, one commonly heard comment when talking about performance is that you write your code with whatever language gets the job done fastest. If performance in specific areas is a problem, then rewrite those bits in C/C++.</p>

<p>But, what if you're starting with a native C++ app? What options do you have if you want to write the easy bits, or refactor the old bits, in a language like Python, Ruby, C#, or whatever? Keep in mind that transferring data between the native and other sides is a must. Being able to simply call a function written in an ""easier"" language, while passing C++ classes as data, would be beautiful.</p>

<p>We've got a crusty Win32 app that would benefit greatly if we could crank out new code, or refactor old code, in C# or something. Very little of it requires the complexity of C++, and dealing with the little fiddly bits is dragging down the programming process. </p>
","<c++><performance><refactoring><native>","2","388","2008-09-29 03:11:00"
"151369","Tools for refactoring table-based HTML layouts to CSS?","<p>Given an HTML page that has a complex table-based layout and many tags that are duplicated and wasteful, e.g.:</p>

<pre><code>td align=""left"" class=""tableformat"" width=""65%"" style=""border-bottom:1px solid #ff9600; border-right:1px solid #ff9600; background-color:#FDD69E"" nowrap etc.
</code></pre>

<p>Are there tools to aide the task of refactoring the page into a more compact form? For instance, a tool that automatically generates CSS styles and selectors? That converts tables into div layouts? </p>

<p>Just to give a sense of the order of the problem, the page I'm looking at is >8000 lines of HTML and JavaScript, which is 500Kb <em>not counting</em> images!  </p>

<p><hr /></p>

<p>Update: In re. ""give up and start from scratch"" comments. What does that mean, in the real world? Print out the page, scan it, set it as the background image in Dreamweaver, and start with that? Seriously? Would that really be more efficient than refactoring? </p>

<p><hr /></p>

<p>Update: I'm not denigrating ""trace it from scratch"" nor did I mean to imply that Dreamweaver is by any means my tool of choice. I'm just very surprised that refactoring a layout is considered to be an intractable problem. </p>
","<html><css><tools><table><refactoring>","5","844","2008-09-30 01:01:58"
"151498","Refactoring vs. Rewriting","<p>With legacy code, how do you know when it's best to rewrite over refactoring?</p>
","<refactoring><legacy>","2","984","2008-09-30 02:09:01"
"161975","Refactoring Code: When to do what?","<p>Ever since I started using .NET, I've just been creating Helper classes or Partial classes to keep code located and contained in their own little containers, etc. </p>

<p>What I'm looking to know is the best practices for making ones code as clean and polished as it possibly could be.</p>

<p>Obviously clean code is subjective, but I'm talking about when to use things (not how to use them) such as polymorphism, inheritance, interfaces, classes and how to design classes more appropriately (to make them more useful, not just say 'DatabaseHelper', as some considered this bad practice in the <a href=""http://stackoverflow.com/questions/114342/what-are-code-smells-what-is-the-best-way-to-correct-them"">code smells wiki</a>).</p>

<p>Are there any resources out there that could possibly help with this kind of decision making? </p>

<p>Bare in mind that I haven't even started a CS or software engineering course, and that a teaching resource is fairly limited in real-life.</p>
","<c#><vb.net><refactoring><coding-style>","13","1009","2008-10-02 12:19:00"
"162551","How to find unused/dead code in java projects","<p>What tools do you use to find unused/dead code in large java projects? Our product has been in development for some years, and it is getting very hard to manually detect code that is no longer in use. We do however try to delete as much unused code as possible.</p>

<p>Suggestions for general strategies/techniques (other than specific tools) are also appreciated.</p>

<p><strong>Edit:</strong> Note that we already use code coverage tools (Clover, IntelliJ), but these are of little help. Dead code still has unit tests, and shows up as covered. I guess an ideal tool would identify clusters of code wich have very little other code depending on it, allowing for docues manual inspection.</p>
","<java><tools><refactoring><dead-code>","77","27966","2008-10-02 14:22:52"
"162641","What tools and techniques do you use to find dead code in .NET?","<p>I've seen similar questions for <a href=""http://stackoverflow.com/questions/162551/how-to-find-unuseddead-code-in-java-projects"">java</a> and VB.NET, but nothing general for .NET, or specific to C# yet.</p>

<p>In the past, I've decorated methods with the Obsolete attribute (passing true so the compiler will issue an error, as described in <a href=""http://msdn.microsoft.com/en-us/library/aa664623.aspx"" rel=""nofollow"">MSDN</a>).</p>

<p>I'd be interested in seeing the suggestions of others (beyond tools like FxCop or ReSharper).</p>

<p>Edit: The reason for asking about tools other than FxCop or ReSharper is that I want to make sure I'm not missing out on other tools that would be helpful.</p>
","<c#><refactoring>","12","5207","2008-10-02 14:36:18"
"163071","Coupling, Cohesion and the Law of Demeter","<p>The <a href=""http://en.wikipedia.org/wiki/Law_of_Demeter"" rel=""nofollow"">Law of Demeter</a> indicates that you should only speak to objects that you know about directly.  That is, do not perform method chaining to talk to other objects.  When you do so, you are establishing improper linkages with the intermediary objects, inappropriately <a href=""http://en.wikipedia.org/wiki/Coupling_(computer_science)"" rel=""nofollow"">coupling</a> your code to other code.</p>

<p>That's bad.</p>

<p>The solution would be for the class you do know about to essentially expose simple wrappers that delegate the responsibility to the object it has the relationship with.</p>

<p>That's good.</p>

<p>But, that seems to result in the class having low <a href=""http://en.wikipedia.org/wiki/Cohesion_(computer_science)"" rel=""nofollow"">cohesion</a>.  No longer is it simply responsible for precisely what it does, but it also has the delegates that in a sense, making the code less cohesive by duplicating portions of the interface of its related object.</p>

<p>That's bad.</p>

<p>Does it really result in lowering cohesion?  Is it the lesser of two evils?</p>

<p>Is this one of those gray areas of development, where you can debate where the line is, or are there strong, principled ways of making a decision of where to draw the line and what criteria you can use to make that decision?</p>
","<oop><refactoring><coupling><law-of-demeter><cohesion>","29","2478","2008-10-02 15:40:11"
"164847","What is in your .vimrc?","<p>Vi and Vim allow for really awesome customization, typically stored inside a <code>.vimrc</code> file. Typical features for a programmer would be syntax highlighting, smart indenting and so on.</p>

<p><strong>What other tricks for productive programming have you got, hidden in your .vimrc?</strong></p>

<p>I am mostly interested in refactorings, auto classes and similar productivity macros, especially for C#.</p>
","<vim><refactoring><productivity><vimrc><hints-and-tips>","157","77920","2008-10-02 22:14:18"
"166431","Clearing a list","<p>I find it annoying that I can't clear a list. In this example:</p>

<pre><code>a = []
a.append(1)
a.append(2)

a = []
</code></pre>

<p>The second time I initialize a to a blank list, it creates a new instance of a list, which is in a different place in memory, so I can't use it to reference the first, not to mention it's inefficient.</p>

<p>The only way I can see of retaining the same pointer is doing something like the following:</p>

<pre><code>for i in range(len(a)):
    a.pop()
</code></pre>

<p>This seems pretty long-winded though, is there a better way of solving this?</p>
","<python><memory-management><refactoring><list>","7","426","2008-10-03 11:37:23"
"174193","Visual Studio: Is there a ""move class to different namespace"" refactoring?","<p>I'm doing some architectural cleanup that involves moving a bunch of classes into different projects and/or namespaces. Currently I'm moving the files by hand, building, and then manually adding <em>using Foo</em> statements as needed to resolve compilation errors. Anyone know of a smarter way of doing this? (We're a CodeRush and Refactor! shop, but I'd be interested to hear if Resharper has support for this)</p>
","<visual-studio><refactoring>","5","1774","2008-10-06 13:07:19"
"174356","Ways to ASSERT expressions at build time in C","<p>I'm tidying up some older code that uses 'magic numbers' all over the place to set hardware registers, and I would like to use constants instead of these numbers to make the code somewhat more expressive (in fact they will map to the names/values used to document the registers).</p>

<p>However, I'm concerned that with the volume of changes I might break the magic numbers. Here is a simplified example (the register set is more complex):</p>

<pre><code>const short mode0 = 0;
const short mode1 = 1;
const short mode2 = 2;

const short state0 = 0;
const short state1 = 4;
const short state2 = 8;
</code></pre>

<p>so instead of :</p>

<pre><code>set_register(5);
</code></pre>

<p>we have:</p>

<pre><code>set_register(state1|mode1);
</code></pre>

<p>What I'm looking for is a <strong>build time</strong> version of:</p>

<pre><code>ASSERT(5==(state1|mode1));
</code></pre>

<p><strong>Update</strong></p>

<p>@Christian, thanks for the quick response, I'm interested on a C / non-boost environment answer too because this is driver/kernel code.</p>

<p>@all, Thanks for the informative answers throughout</p>
","<c><refactoring><assert><static-assert><c-faq>","12","5870","2008-10-06 13:49:17"
"175437","Tool for finding package namespace conflicts in java code","<p>We have a number of projects that use the same and/or similar package names. Many or these projects will build jar files that are used by other projects. We have found a number of foo.util foo.db and foo.exceptions where the same class names are being used leading to name space conflicts. </p>

<p>Does anyone know of a tool that will search a set of java code bases and automatically find name space conflicts and ambiguous imports?</p>
","<java><tools><refactoring>","2","316","2008-10-06 17:58:46"
"176456","Refactoring an application","<p>If you had to fix and stabilize a MVC application, where would you start: the Model, Controller or View? The problems are spread equally throughout the application,  with bad programming practices that make it hard to add functionality.
The application is written in PHP if it makes a difference.</p>
","<mvc><refactoring><theory>","1","221","2008-10-06 22:27:15"
"178997","What would you do when you are about to add some new features to a large (and dirty) codebase which has virtually *NO* unit-testing code?","<p><a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">Martin Fowler</a> says that we should do refactoring before adding new features (given that the original program is not well-structured).</p>

<p>So we all want to refactor this <em>dirty</em> codebase, that's for sure. We also know that without unit-testing code it's very easy to introduce subtle bugs.</p>

<p>But it's a large codebase. Adding a complete suite of tests to it seems impracticable.</p>

<p>What would you do in this case?</p>
","<unit-testing><testing><refactoring>","7","580","2008-10-07 15:21:32"
"178458","Python, unit-testing and mocking imports","<p>I am in a project where we are starting refactoring some massive code base. One problem that immediately sprang up is that each file imports a lot of other files. How do I in an elegant way mock this in my unit test without having to alter the actual code so I can start to write unit-tests?</p>

<p>As an example: The file with the functions I want to test, imports ten other files which is part of our software and not python core libs.</p>

<p>I want to be able to run the unit tests as separately as possible and for now I am only going to test functions that does not depend on things from the files that are being imported.</p>

<p>Thanks for all the answers. </p>

<p>I didn't really know what I wanted to do from the start but now I think I know. </p>

<p>Problem was that some imports was only possible when the whole application was running because of some third-party auto-magic. So I had to make some stubs for these modules in a directory which I pointed out with sys.path</p>

<p>Now I can import the file which contains the functions I want to write tests for in my unit-test file without complaints about missing modules.</p>
","<python><unit-testing><refactoring><import>","10","1415","2008-10-07 13:34:42"
"181388","Re-factoring from Active Record to Data Mapper","<p>have you re-factored from an <a href=""http://martinfowler.com/eaaCatalog/activeRecord.html"" rel=""nofollow"">Active Record</a> to a <a href=""http://martinfowler.com/eaaCatalog/dataMapper.html"" rel=""nofollow"">Data Mapper</a> pattern? what conditions prompted the switch? i'm primarily interested in web based applications, but would like to know the challenges that accompany such a move in any environment.</p>
","<design-patterns><activerecord><refactoring><datamapper>","3","1865","2008-10-08 04:46:47"
"181605","Help refactor function that takes lots of arguments","<p>I was wondering if anyone would be able to help me refactor some code that I wrote a while ago.  I wrote a wrapper for a COM object that only excepted strings as input, so in good OOP practice I wrapped the string up in a function so that it was easier to build and call. </p>

<p>I was just wondering if anyone could think of a better way to do the following code.  </p>

<pre><code>   Public Function OpenTable(ByVal TablePath As String, Optional ByVal OpenAs As String = Nothing, _
            Optional ByVal Hide As Boolean = False, Optional ByVal AsReadOnly As Boolean = False, _
            Optional ByVal Interactive As Boolean = True, Optional ByVal Password As String = Nothing, _
            Optional ByVal NoIndex As Boolean = False, Optional ByVal ViewAutomatic As Boolean = True) As TableInfo

            If String.IsNullOrEmpty(TablePath) Then
                Throw New ArgumentNullException(""TablePath"", ""TablePath cannot be null or empty"")
            End If

            Dim Builder = New StringBuilder(""Open Table "")
            Builder.AppendFormat(""{0}{1}{2}"", ControlChars.Quote, TablePath, ControlChars.Quote)

            If (Not String.IsNullOrEmpty(OpenAs)) Then Builder.AppendFormat("" as {0} "", OpenAs)
            If (Hide) Then Builder.Append("" Hide "")
            If (AsReadOnly) Then Builder.Append("" ReadOnly "")
            If (Interactive) Then Builder.Append("" Interactive "")
            If (Not String.IsNullOrEmpty(Password)) Then Builder.AppendFormat("" Password {0} "", Password)
            If (NoIndex) Then Builder.Append("" NoIndex "")
            If (ViewAutomatic) Then Builder.Append("" View Automatic "")

            MyComApp.Do(Builder.ToString)

            Dim FileInfo = New IO.FileInfo(TablePath)
            Return New TableInfo(FileInfo.Name.Substring(0, InStrRev(FileInfo.Name, ""."") - 1))
        End Function
</code></pre>

<p>The amount of arguments that the function has to take is my biggest worry. This one is not too bad but there are some other functions that I may have to make in the future that will take a lot more arguments, so I'm mainly looking for better ways to build large argument functions.</p>

<p>Thanks.    </p>
","<vb.net><com><refactoring><wrapping>","1","290","2008-10-08 07:00:56"
"179538","Refactoring XSD Schemas","<p>I'm working in a project which needs to clean up some third party XSD Schemas and I want to do some refactoring of common elements in them.</p>

<p>There is any suitable tool to automate this? I tried by sfactor from XMLBeans but it doesn't work (it throws a weird exception which even Google can't answer!).</p>
","<xml><refactoring><xsd><xml-schema>","4","478","2008-10-07 17:32:47"
"186970","What ReSharper 4+ live templates for C# do you use?","<p>What ReSharper 4.0 templates for <strong>C#</strong> do you use?</p>

<p>Let's share these in the following format:</p>

<p><hr /></p>

<h2>[Title]</h2>

<p><em>Optional description</em>  </p>

<p><strong>Shortcut:</strong> shortcut<br />
<strong>Available in:</strong> [AvailabilitySetting]</p>

<pre><code>// Resharper template code snippet
// comes here
</code></pre>

<p><strong>Macros properties</strong> (if present):</p>

<ul>
<li><strong>Macro1</strong> - Value - EditableOccurence</li>
<li><strong>Macro2</strong> - Value - EditableOccurence</li>
</ul>

<p><hr /></p>

<ul>
<li>One macro per answer, please!</li>
<li>Here are some samples for <a href=""http://stackoverflow.com/questions/186970/what-resharper-40-templates-for-c-do-you-use#186978"">NUnit test fixture</a> and <a href=""http://stackoverflow.com/questions/186970/what-resharper-40-templates-for-c-do-you-use#186978"">Standalone NUnit test case</a> that describe live templates in the suggested format.</li>
</ul>
","<c#><templates><refactoring><resharper>","74","6406","2008-10-09 12:07:43"
"190781","make bad code good","<p>I got myself reading a article regarding changing the existing bad code into a good one.
For reference, this is the link to the article <a href=""http://www.javaworld.com/jw-03-2001/jw-0323-badcode.html?page=1"" rel=""nofollow"">http://www.javaworld.com/jw-03-2001/jw-0323-badcode.html?page=1</a></p>

<p>It broadly talked about the following</p>

<ul>
<li><p>Add comments</p></li>
<li><p>Re-Factoring Code</p>

<ul>
<li>Break large classes into smaller classes</li>
<li>Break large functions into smaller functions</li>
<li>Change code which is difficult to understand</li>
</ul></li>
<li>Use Layered architecture</li>
</ul>

<p>Seems good. Any addons to this list which you all may have come across ?</p>
","<refactoring><coding-style>","2","450","2008-10-10 10:44:37"
"197123","Renaming accessor/mutator methods in Eclipse?","<p>Is there any way to automatically rename accessor/mutator when a variable they get/set gets refactored -> renamed (Eclipse 3.4)?</p>
","<eclipse><refactoring><eclipse-3.4>","3","343","2008-10-13 09:41:11"
"198825","Best way to get rid of hungarian notation?","<p>Let's say you've inherited a C# codebase that uses one class with 200 static methods to provide core functionality (such as database lookups). Of the many nightmares in that class, there's copious use of Hungarian notation (the bad kind).</p>

<p>Would you refactor the variable names to remove the Hungarian notation, or would you leave them alone?</p>

<p>If you chose to change all the variables to remove Hungarian notation, what would be your method?</p>
","<coding-style><refactoring><hungarian-notation>","4","1447","2008-10-13 19:59:10"
"192464","Improving really bad systems","<p>How would you begin improving on a really bad system?</p>

<p>Let me explain what I mean before you recommend creating unit tests and refactoring. I could use those techniques but that would be pointless in this case.</p>

<p>Actually the system is so broken it doesn't do what it needs to do.</p>

<p>For example the system should count how many messages it sends. It mostly works but in some cases it ""forgets"" to increase the value of the message counter. The problem is that so many other modules with their own workarounds build upon this counter that if I correct the counter the system as a whole would become worse than it is currently. The solution could be to modify all the modules and remove their own corrections, but with 150+ modules that would require so much coordination that I can not afford it.</p>

<p>Even worse, there are some problems that has workarounds not in the system itself, but in people's head. For example the system can not represent more than four related messages in one message group. Some services would require five messages grouped together. The accounting department knows about this limitation and every time they count the messages for these services, they count the message groups and multiply it by 5/4 to get the correct number of the messages. There is absolutely no documentation about these deviations and nobody knows how many such things are present in the system now.</p>

<p>So how would you begin working on improving this system? What strategy would you follow?</p>

<p>A few additional things: I'm a one-men-army working on this so it is not an acceptable answer to hire enough men and redesign/refactor the system. And in a few weeks or months I really should show some visible progression so it is not an option either to do the refactoring myself in a couple of years.</p>

<p>Some technical details: the system is written in Java and PHP but I don't think that really matters. There are two databases behind it, an Oracle and a PostgreSQL one. Besides the flaws mentioned before the code itself is smells too, it is really badly written and documented.</p>

<p>Additional info:</p>

<p>The counter issue is not a synchronization problem. The counter++ statements are added to some modules, and are not added to some other modules. A quick and dirty fix is to add them where they are missing. The long solution is to make it kind of an aspect for the modules that need it, making impossible to forget it later. I have no problems with fixing things like this, but if I would make this change I would break over 10 other modules.</p>

<p>Update:</p>

<p>I accepted Greg D's answer. Even if I like Adam Bellaire's more, it wouldn't help me to know what would be ideal to know. Thanks all for the answers.</p>
","<refactoring><system>","12","429","2008-10-10 17:59:15"
"199627","Converting C source to C++","<p>How would you go about converting a reasonably large (>300K), fairly mature C codebase to C++?</p>

<p>The kind of C I have in mind is split into files roughly corresponding to modules (i.e. less granular than a typical OO class-based decomposition), using internal linkage in lieu private functions and data, and external linkage for public functions and data. Global variables are used extensively for communication between the modules. There is a very extensive integration test suite available, but no unit (i.e. module) level tests.</p>

<p>I have in mind a general strategy:</p>

<ol>
<li>Compile everything in C++'s C subset and get that working.</li>
<li>Convert modules into huge classes, so that all the cross-references are scoped by a class name, but leaving all functions and data as static members, and get that working.</li>
<li>Convert huge classes into instances with appropriate constructors and initialized cross-references; replace static member accesses with indirect accesses as appropriate; and get that working.</li>
<li>Now, approach the project as an ill-factored OO application, and write unit tests where dependencies are tractable, and decompose into separate classes where they are not; the goal here would be to move from one working program to another at each transformation.</li>
</ol>

<p>Obviously, this would be quite a bit of work. Are there any case studies / war stories out there on this kind of translation? Alternative strategies? Other useful advice?</p>

<p>Note 1: the program is a compiler, and probably millions of other programs rely on its behaviour not changing, so wholesale rewriting is pretty much not an option.</p>

<p>Note 2: the source is nearly 20 years old, and has perhaps 30% code churn (lines modified + added / previous total lines) per year. It is heavily maintained and extended, in other words. Thus, one of the goals would be to increase mantainability.</p>

<p>[For the sake of the question, assume that translation into <strong>C++</strong> is mandatory, and that leaving it in C is <strong>not</strong> an option. The point of adding this condition is to weed out the ""leave it in C"" answers.]</p>
","<c++><c><refactoring><legacy><program-transformation>","27","2277","2008-10-14 00:51:43"
"200457","Refactoring features in Visual Studio 2005 for VB","<p>Does anybody know a good and free add-in for Visual Studio 2005 to get refactoring features in VB?</p>

<p>Thanks in advance</p>
","<vb.net><visual-studio><refactoring><add-in>","4","506","2008-10-14 09:06:23"
"200757","How do you handle the tension between refactoring and the need for merging?","<p>Our policy when delivering a new version is to create a branch in our VCS and handle it to our QA team. When the latter gives the green light, we tag and release our product.  The branch is kept to receive (only) bug fixes so that we can create technical releases.  Those bug fixes are subsequently merged on the trunk.</p>

<p>During this time, the trunk sees the main development work, and is potentially subject to refactoring changes.</p>

<p>The issue is that there is a tension between the need to have a stable trunk (so that the merge of bug fixes succeed -- it usually can't if the code has been e.g. extracted to another method, or moved to another class) and the need to refactor it when introducing new features. </p>

<p>The policy in our place is to not do any refactoring before enough time has passed and the branch is stable enough. When this is the case, one can start doing refactoring changes on the trunk, and bug-fixes are to be manually committed on both the trunk and the branch.</p>

<p>But this means that developpers must wait quite some time before committing on the trunk any refactoring change, because this could break the subsequent merge from the branch to the trunk.  And having to manually port bugs from the branch to the trunk is painful.  It seems to me that this hampers development...</p>

<p>How do you handle this tension?</p>

<p>Thanks.</p>
","<version-control><refactoring><release><branch><merge>","16","638","2008-10-14 11:16:20"
"194241","Is there a key combination in Xcode to implement a Protocol?","<p>In Visual Studio if I define a class to implement an interface e.g.</p>

<pre><code>class MyObject : ISerializable {}
</code></pre>

<p>I am able to right click on ISerializable, select ""<em>Implement Interface</em>"" from the context menu and see the appropriate methods appear in my class definition.</p>

<pre><code>class MyObject : ISerializable {
    #region ISerializable Members
    public void GetObjectData(SerializationInfo info, 
                StreamingContext context)
    {
        throw new NotImplementedException();
    }
    #endregion
}
</code></pre>

<p>Is there anything anything like this functionality available in Xcode on the Mac? I would like to be able to automatically implement Protocols in this way. Maybe with the optional methods generated but commented out.</p>
","<objective-c><xcode><refactoring><code-generation>","14","4513","2008-10-11 16:00:13"
"204177","What tool to find code duplicates in C# projects?","<p>What tool would you recommend for finding code duplicates in C# code?</p>
","<c#><refactoring><code-duplication>","41","7119","2008-10-15 09:43:00"
"205426","How do you refactor?","<p>I was wondering how other developers begin refactoring. What is your first step? How this process (refactoring) differ if you refactor code which is not yours? Do you write tests while refactoring?</p>
","<unit-testing><refactoring>","16","891","2008-10-15 16:31:17"
"209478","Could I improve this method with duck typing?","<p>Hopefully I haven't misunderstood the meaning of ""duck typing"", but from what I've read, it means that I should write code based on how an object responds to methods rather than what type/class it is.</p>

<p>Here's the code:</p>

<pre><code>def convert_hash(hash)
  if hash.keys.all? { |k| k.is_a?(Integer) }
    return hash
  elsif hash.keys.all? { |k| k.is_a?(Property) }
    new_hash = {}
    hash.each_pair {|k,v| new_hash[k.id] = v}
    return new_hash
  else
    raise ""Custom attribute keys should be ID's or Property objects""
  end
end
</code></pre>

<p>What I want is to make sure that I end up with a hash where the keys are an integer representing the ID of an ActiveRecord object. I don't particularly enjoy having to iterate through the hash keys twice with <code>all?</code> to determine if I need to grab the ID's out.</p>

<p>Of course, I'll accept any other suggestions to improve this code as well :)</p>
","<ruby-on-rails><ruby><refactoring><duck-typing>","5","463","2008-10-16 17:15:38"
"210353","Remove repetitive, hard coded loops and conditions in C#","<p>I have a class that compares 2 instances of the same objects, and generates a list of their differences.  This is done by looping through the key collections and filling a set of other collections with a list of what has changed (this may make more sense after viewing the code below).  This works, and generates an object that lets me know what exactly has been added and removed between the ""old"" object and the ""new"" one.<br>
My question/concern is this...it is really ugly, with tons of loops and conditions.  Is there a better way to store/approach this, without having to rely so heavily on endless groups of hard-coded conditions? </p>

<pre><code>    public void DiffSteps()
    {
        try
        {
            //Confirm that there are 2 populated objects to compare
            if (NewStep.Id != Guid.Empty &amp;&amp; SavedStep.Id != Guid.Empty)
            {
                //&lt;TODO&gt; Find a good way to compare quickly if the objects are exactly the same...hash?

                //Compare the StepDoc collections:
                OldDocs = SavedStep.StepDocs;
                NewDocs = NewStep.StepDocs;
                Collection&lt;StepDoc&gt; docstoDelete = new Collection&lt;StepDoc&gt;();

                foreach (StepDoc oldDoc in OldDocs)
                {
                    bool delete = false;
                    foreach (StepDoc newDoc in NewDocs)
                    {
                        if (newDoc.DocId == oldDoc.DocId)
                        {
                            delete = true;
                        }
                    }
                    if (delete)
                        docstoDelete.Add(oldDoc);
                }

                foreach (StepDoc doc in docstoDelete)
                {
                    OldDocs.Remove(doc);
                    NewDocs.Remove(doc);
                }


                //Same loop(s) for StepUsers...omitted for brevity

                //This is a collection of users to delete; it is the collection
                //of users that has not changed.  So, this collection also needs to be checked 
                //to see if the permisssions (or any other future properties) have changed.
                foreach (StepUser user in userstoDelete)
                {
                    //Compare the two
                    StepUser oldUser = null;
                    StepUser newUser = null;

                    foreach(StepUser oldie in OldUsers)
                    {
                        if (user.UserId == oldie.UserId)
                            oldUser = oldie;
                    }

                    foreach (StepUser newie in NewUsers)
                    {
                        if (user.UserId == newie.UserId)
                            newUser = newie;
                    }

                    if(oldUser != null &amp;&amp; newUser != null)
                    {
                        if (oldUser.Role != newUser.Role)
                            UpdatedRoles.Add(newUser.Name, newUser.Role);
                    }

                    OldUsers.Remove(user);
                    NewUsers.Remove(user);
                }

            } 
        }
        catch(Exception ex)
        {
            string errorMessage =
                String.Format(""Error generating diff between Step objects {0} and {1}"", NewStep.Id, SavedStep.Id);
            log.Error(errorMessage,ex);
            throw;
        }
    }
</code></pre>

<hr>

<p>The targeted framework is 3.5.</p>
","<c#><refactoring><loops><condition>","7","965","2008-10-16 21:18:08"
"206811","Code standard refactoring on large codebase","<p>My studio has a large codebase that has been developed over 10+ years.  The coding standards that we started with were developed with few developers in house and long before we had to worry about any kind of standards related to C++.</p>

<p>Recently, we started a small R&amp;D project in house and we updated our coding conventions to be more suitable for our environment.  The R&amp;D work is going to be integrated into existing project code.  One major problem facing us is that we now have two standards for the two areas of work, and now the code bases will cross.  I don't want two standards at the studio, and I'm actually quite happy to move forward with a single standard.  (The 'how' of how we got into this situation isn't important -- just that we are and I had hoped that we wouldn't be.)</p>

<p>The problem is refactoring existing code.  I'm not very keen on having two code bases (one relatively small and one very large) looking different.  I am interested in doing some refactoring of one of the existing codebases to make it conform to the other standard.  The problem is, the smaller code base is (IMO) the more desireable standard.</p>

<p>I started looking around for a tool that could do large scale refactoring for me.  I'm not interested in rearranging and tightening code.  I'm interested in changing things like</p>

<pre><code>class my_class {}
....
class my_class A;
</code></pre>

<p>to</p>

<pre><code>class MyClass {}
....
class MyClass A;
</code></pre>

<p>Basically doing function/variable level renaming.  I'd prefer not to use something like Visual Assist because that will take a long time.  I have upwards of 10000 source/header files with hundreds of thousands of lines of code.  Using VA one class at a time would be a time killer and not worth the effort.</p>

<p>I did run across <a href=""http://www.inspirel.com/vera/"" rel=""nofollow"">Vera</a> in another post on SO.  That seems like it might do the job and do it well.   I'd like to know if anyone has specific experience using Vera for the situation that I'm in, or has any other recommendations for tools that might get the job done.  I think that it's important that this tool actually understand code structure so that we don't wind up just renaming variables in a search/replace manner because that will lead to subtle bugs if not done carefully.</p>

<p>EDIT:  While my example shows I'm going from using _ between names to camelcase type notation, it might be more beneficial for us to move the other way.  I'm really looking for a generic solution that will help with large scale renaming.</p>

<p>Thanks.</p>
","<c++><tools><refactoring>","3","733","2008-10-15 22:43:52"
"208468","Issues During ASP.NET MVC Upgrade from Preview 5 to Beta?","<p>What issues or refactoring did you have to do when you upgraded from ASP.NET MVC Preview 5 to the newly released <a href=""http://www.microsoft.com/downloads/details.aspx?familyid=a24d1e00-cd35-4f66-baa0-2362bdde0766&amp;displaylang=en&amp;tm"" rel=""nofollow"">Beta</a> version?</p>
","<asp.net-mvc><refactoring><upgrade><beta><known-issues>","9","6588","2008-10-16 13:07:35"
"206968","Where should I put ""ugliness""?","<p>Scenario: I have a function that I need to tweak in some way (example; make it work slightly different in different places). For some reason I end up having to add something ugly to the code, either in the function or at existing call sites. Assume that the sum total ""ugly"" is the same in both cases.</p>

<p>The question is which choice should I pick and why? </p>

<p>Should I encapsulate it so I don't need to look at it or should I extract it so that it doesn't add semantic trash to the function?</p>

<p>What would effect your choice? What about if:</p>

<ul>
<li>The function will ""never"" be called except from the current locations.</li>
<li>New calls to the function won't need the ""ugliness"".</li>
<li>The function is really clean and generic right now</li>
<li>The function is already a hack job.</li>
<li>you wrote the function</li>
<li>you didn't wright the function</li>
<li>etc.</li>
</ul>
","<language-agnostic><refactoring>","2","285","2008-10-16 00:06:37"
"207024","""Rename control"" in Delphi 7?","<p>Following up on <a href=""http://stackoverflow.com/questions/189893/is-there-any-way-to-get-code-folding-in-delphi-7"">this</a> question, I'm working on a large Delphi 7 codebase which was not written very nicely. </p>

<p>I'm looking at code like this, as a small example:</p>

<pre><code>  if FMode=mdCredit then begin
    Panel8.Caption:='Credit';
    SpeedButton3.Enabled:=false;
    SpeedButton4.Enabled:=false;
    SpeedButton5.Enabled:=false;
    SpeedButton5.Enabled:=false;
    SpeedButton6.Visible:=False;
    SpeedButton10.Visible:=False;
  end;
</code></pre>

<p>Followed by another 6 very similar blocks. The whole thing is in this style.
So I'm thinking that this would be much easier to read if the controls were named sensibly.</p>

<p>I could just use a global search and replace, but I'll run into problems when multiple forms use the same names, and also I'd have to be careful to change (eg) SpeedButton10 before SpeedButton1.</p>

<p>Is there some plugin which has the ability to perform a ""smart"" rename for me?</p>

<p><strong>Edit:</strong><br />
Sorry, I should have mentioned this before: I tried both GExperts and Castalia's ""Rename Component"" feature, but they both seem to be intended for use when adding the component to the form initially. </p>

<p>They don't do a search+replace in the code, or rename existing events (SpeedButtonXClick() -> cmdCreditClick()). </p>

<p>Have I missed something?</p>
","<delphi><refactoring>","2","975","2008-10-16 00:35:16"
"216394","C to C translator / C-code cleanup tool","<p>I wonder if there exist some free software that let me pass a C file and it outputs a more structured C-file.</p>

<p>I'm dealing with a short piece of C-Code that has been written long ago. I'd like to extract a clever algorithm from it, but working with the code itself is hard because it lacks everything that makes C-code readable. </p>

<p>Just a short example:</p>

<pre><code>node *first(node *p)
{
  node *aux=p;

  if (aux)
  do aux=aux-&gt;next;
  while(aux!=p &amp;&amp; (!aux-&gt;intersect || aux-&gt;intersect &amp;&amp; aux-&gt;visited));
  return aux;
}
</code></pre>

<p>What I'd like to get as an output would be something like this:</p>

<pre><code>node *first(node *p)
{
  node *aux=p;

  if (aux)
  {
    do 
    { 
      aux=aux-&gt;next;
    } 
    while( (aux!=p) &amp;&amp; (!aux-&gt;intersect || (aux-&gt;intersect &amp;&amp; aux-&gt;visited)));
  }
  return aux;
}
</code></pre>

<p>Does such an automatic code cleanup tool exist?</p>
","<c><refactoring><beautifier>","2","1287","2008-10-19 12:59:45"
"222511","Refactor To Eliminate Repetition In Lamba Expression","<p>These two methods exhibit repetition:  </p>

<pre><code>public static Expression&lt;Func&lt;Foo, FooEditDto&gt;&gt; EditDtoSelector()
{
    return f =&gt; new FooEditDto
    {
        PropertyA = f.PropertyA,
        PropertyB = f.PropertyB,
        PropertyC = f.PropertyC,
        PropertyD = f.PropertyD,
        PropertyE = f.PropertyE
    };
}

public static Expression&lt;Func&lt;Foo, FooListDto&gt;&gt; ListDtoSelector()
{
    return f =&gt; new FooDto
    {
        PropertyA = f.PropertyA,
        PropertyB = f.PropertyB,
        PropertyC = f.PropertyC
    };
}
</code></pre>

<p>How can I refactor to eliminate this repetition?</p>

<p>UPDATE: Oops, I neglected to mention an important point.  FooEditDto is a subclass of FooDto.</p>
","<c#><refactoring><lambda>","6","503","2008-10-21 16:22:04"
"224345","Is there a ""right"" way to do inheritance in JavaScript? If so, what is it?","<p>I have been trying to learn how to add testing to existing code -- currently reading reading <a href=""http://rads.stackoverflow.com/amzn/click/0131177052"" rel=""nofollow"">Working Effectively With Legacy Code</a>.  I have been trying to apply some of the principles in JavaScript, and now I'm trying to extract an interface.</p>

<p>In searching for creating interfaces in JavaScript, I can't find a lot -- and what I find about inheritance seems like their are several different ways.  (Some people create their own base classes to provide helpful methods to make it easier to do inheritance, some use functions, some use prototypes).</p>

<p>What's the right way?  Got a simple example for extracting an interface in JavaScript?</p>
","<javascript><oop><refactoring><interface>","7","1409","2008-10-22 03:03:00"
"224660","Incoming poplib refactoring using windows python 2.3","<p>Hi Guys could you please help me refactor this so that it is sensibly pythonic.</p>

<pre><code>import sys
import poplib
import string
import StringIO, rfc822
import datetime
import logging

def _dump_pop_emails(self):
    self.logger.info(""open pop account %s with username: %s"" % (self.account[0], self.account[1]))
    self.popinstance = poplib.POP3(self.account[0])
    self.logger.info(self.popinstance.getwelcome()) 
    self.popinstance.user(self.account[1])
    self.popinstance.pass_(self.account[2])
    try:
        (numMsgs, totalSize) = self.popinstance.stat()
        for thisNum in range(1, numMsgs+1):
            (server_msg, body, octets) = self.popinstance.retr(thisNum)
            text = string.join(body, '\n')
            mesg = StringIO.StringIO(text)                               
            msg = rfc822.Message(mesg)
            name, email = msg.getaddr(""From"")
            emailpath = str(self._emailpath + self._inboxfolder + ""\\"" + email + ""_"" + msg.getheader(""Subject"") + "".eml"")
            emailpath = self._replace_whitespace(emailpath)
            file = open(emailpath,""wb"")
            file.write(text)
            file.close()
            self.popinstance.dele(thisNum)
    finally:
        self.logger.info(self.popinstance.quit())

def _replace_whitespace(self,name):
    name = str(name)
    return name.replace("" "", ""_"")
</code></pre>

<p>Also in the _replace_whitespace method I would like to have some kind of cleaning routine which takes out all illegal characters which could cause processing.</p>

<p>Basically I want to write the email to the inbox directory in a standard way.</p>

<p>Am i doing something wrong here?</p>
","<python><email><refactoring><poplib>","1","426","2008-10-22 06:26:33"
"219395","refactoring stored procedure","<p>I have a stored procedure currently executing a complicated fetch that is frequently timing out when used. The proposed solution in my department has been to simply increase the timeout time length; which I don't really want to do. I'd like to refactor this sproc, but because it's so complicated and undocumented (yay legacy systems) I'm concerned my refactoring my not result in the same functionality executing more efficiently. Are there any strategies to use when refactoring a stored procedure to ensure the same functions are being performed in less time?</p>

<p>This is a Microsoft SQL Server 2005 stored procedure.</p>
","<performance><stored-procedures><refactoring>","2","523","2008-10-20 18:29:18"
"221186","What GNU tools for refactoring are there?","<p>How to refactor c source code that compiles with gcc, preferably a tool that can be used from the command line?</p>
","<tools><gcc><refactoring><software-tools><gnu>","6","3172","2008-10-21 08:43:36"
"228394","Automating code review and refactoring","<p>I'm trying to do automated code review and refactoring with a tool. Something in the lines of FxCop or ReSharper.</p>

<p>Looking for tool suggestions that meet these requirements:</p>

<ol>
<li>Low learning curve.</li>
<li>Targeted at C# (and maybe VB.NET).</li>
<li>Let's me easily add or customize rules (and understands entire CodeDOM).</li>
<li>Well documented.</li>
<li>FREE or dirt cheap. <em>Sorry, low exchange rate =)</em></li>
</ol>

<p>Manual code reviews will still be done. But the tool should be thorough enough to catch all the common boo boos before a senior developer does the manual review.</p>

<p>If you have stories to share about the tools that you have used/are using then that would be great, too.</p>

<p>Thanks.</p>

<p>EDIT:
Finally had some time to look into the suggestions more. StyleCop does NOT integrate with Visual Studio Express Edition which is what I'm using. ReSharper has a lot more features than what I require (which is purely to automate code reviews). I would say it's not a very focused tool for my purposes (and also the reason for it's price tag).
Still looking for other suggestions if any.</p>

<p>EDITDIT:
StyleCop does NOT integrate with Visual Studio Express but you can still set it up to run as part of your build in Visual Studio Express. Seems like the best solution for now.</p>
","<tools><refactoring><coding-style><code-review><devtools>","8","1603","2008-10-23 02:59:04"
"228978","How can I reduce duplication in constants?","<p>I have this Perl script with many defined constants of configuration files. For example:</p>

<pre><code>use constant  {
LOG_DIR                             =&gt; ""/var/log/"",
LOG_FILENAME                        =&gt; ""/var/log/file1.log"",
LOG4PERL_CONF_FILE                  =&gt; ""/etc/app1/log4perl.conf"",
CONF_FILE1                          =&gt; ""/etc/app1/config1.xml"",
CONF_FILE2                          =&gt; ""/etc/app1/config2.xml"",
CONF_FILE3                          =&gt; ""/etc/app1/config3.xml"",
CONF_FILE4                          =&gt; ""/etc/app1/config4.xml"",
CONF_FILE5                          =&gt; ""/etc/app1/config5.xml"",
};
</code></pre>

<p>I want to reduce duplication of ""/etc/app1"" and ""/var/log"" , but using variables does not work. Also using previously defined constants does not work in the same ""use constant block"". For example:</p>

<pre><code>use constant {
LOG_DIR                             =&gt; ""/var/log/"",
FILE_FILENAME                       =&gt; LOG_DIR . ""file1.log"" 
};
</code></pre>

<p>does not work.</p>

<p>Using separate ""use constant"" blocks does workaround this problem, but that adds a lot of unneeded code.</p>

<p>What is the correct way to do this?</p>

<p>Thank you.</p>
","<perl><refactoring><constants>","6","231","2008-10-23 08:40:41"
"229438","How to refactor: split a class into two which communicate via an interface","<p>I am just embarking on my first large-scale refactor, and need to split an (unfortunately large) class into two, which then communicate only via an interface. (My Presenter has turned out to be a Controller, and needs to split GUI logic from App logic). Using C# in VisualStudio 2008 and Resharper, what is the easiest way to achieve this? </p>

<p>What I am going to try is 
a) Collect the members for the new class and ""extract new class""
b) clean up the resulting mess
c) ""Extract Interface""
d) chase down any references to the class and convert them to interface references</p>

<p>but I have never done this before, and wonder whether anyone knows any good tips or gotchas before I start ripping everything apart... 
Thanks!</p>
","<visual-studio><visual-studio-2008><refactoring><resharper>","0","545","2008-10-23 11:45:02"
"230527","Telling bugs and features apart?","<p>Have you ever been in the situation when looking at the code you couldn’t tell if something is a bug or poorly implemented feature?  Or you simply didn’t dare to fix something that looked like a definite bug to you, but were not sure if anyone already relies on the functionality behaving in a certain way? </p>

<p>What are your best heuristics for telling bugs and features apart? Any good stories?</p>
","<debugging><refactoring><quality>","8","400","2008-10-23 16:58:51"
"230706","Explaining refactoring","<h3>Question</h3>

<p>My question is how can you teach the methods and importance of tidying-up and refactoring code?</p>

<h3>Background</h3>

<p>I was recently working on a code review for a colleague. They had made some modifications to a long-gone colleagues work. During the new changes, my colleague had tried to refactor items but gave up as soon as they hit a crash or some other problem (rather than chasing the rabbit down the hole to find the root of the issue) and so reimplemented the problem code and built more on top of that. This left the code in a tangle of workarounds and magic numbers, so I sat down with them to go through refactoring it.</p>

<p>I tried to explain how I was identifying the places we could refactor and how each refactoring can often highlight new areas. For example, there were two variables that stored the same information - why? I guessed it was a workaround for a bigger issue so I took out one variable and chased the rabbit down the hole, discovering other problems as we went. This eventually led to finding a problem where we were looping over the same things several times. This was due in no small part to the use of arrays of magic number sizes that obfuscated what was being done - fixing the initial ""double-variable"" problem led to this discovery (and others).</p>

<p>As I went on this refactoring journey with my colleague, it was evident that she wasn't always able to grasp why we made certain changes and how we could be sure the new functionality matched the original, so I took the time to explain and prove each change by comparing with earlier versions and stepping through the changes on paper. I also explained, through examples, how to tell if a refactoring choice was a bad idea, when to choose comments instead of code changes, and how to select good variable names.</p>

<p>I felt that the process of sitting together to do this was worthwhile for both myself (I got to learn a bit more about how best to explain things to others) and my colleague (they got to understand more of our code and our coding practices) but, the experience led me to wonder if there was a better way to teach the refactoring process.</p>

<h3>...and finally...</h3>

<p>I understand that what does or does not need refactoring, and how to refactor it are very subjective so I want to steer clear of that discussion, but I am interested to learn how others would tackle the challenge of teaching this important skill, and if others here have had similar experiences and what they learned from them (either as the teacher or the student).</p>
","<language-agnostic><refactoring><teaching>","6","441","2008-10-23 17:46:59"
"231288","Need help making Jython (dom4j) script more graceful :)","<p>I have started using Jython as it seems to be a excellent language, and has proved to be so far.</p>

<p>I am using dom4j to manipulate and retrieve data from the DOM of a bunch of HTML files I have on disk.  I have wrote the below script to check threw the DOM using Xpath for <strong>H1</strong> tags and grab text, if a <strong>H1</strong> tag is not present in the DOM it then searches for the <strong>title</strong> tag and grabs the text from that.</p>

<p>I am very new to Jython but I am sure there is way to perform the required task a lot more graceful than the below method, If I am right in thinking this, is there someone that can show me a better way to do it?</p>

<pre><code>elemHolder = dom.createXPath('//xhtml:h1')
elemHolder.setNamespaceURIs(map)
elem = elemHolder.selectSingleNode(dom)
if elem != None:
    h1 = elem.getText()
else:
    elemHolder = dom.createXPath('//xhtml:title')
    elemHolder.setNamespaceURIs(map)
    elem = elemHolder.selectSingleNode(dom)
    if elem != None:
    	title = elem.getText()
    else:
    	title = ""Page does not contain a H1 or title tag""
</code></pre>

<p>If anyone could help it would be great. Cheers</p>
","<jython><refactoring><dom4j>","0","168","2008-10-23 20:08:42"
"236676","Can this be refactored into nicey nice LINQ?","<p>I have an IList of type Breadcrumb which is just a lightweight class that has NavigationTitle, NavigationUrl and IsCurrent properties. It is cached on the webserver. I have a method that builds out the current breadcrumb trail up until the first Breadcrumb that has IsCurrent set to true... using the code below. Its very ugly and definitely a quick dirtbag willie solution, but I was curious, can this be easily refactored into LINQ? </p>

<pre><code>IList&lt;Breadcrumb&gt; crumbs = new List&lt;Breadcrumb&gt;();
bool foundCurrent = false;
for (int a = 0; a &lt; cachedCrumbs.Count; a++)
{
    crumbs.Add(crumbs[a]);
    if (foundCurrent)
    {
      break;
    }
    foundCurrent = (crumbs[a + 1] != null &amp;&amp; ((Breadcrumb)crumbs[a + 1]).IsCurrent);
}
</code></pre>
","<linq><refactoring>","1","391","2008-10-25 16:49:37"
"237601","SQL Server 2005: Wrapping Tables by Views - Pros and Cons","<h2>Background</h2>

<p>I am working on a legacy small-business automation system (inventory, sales, procurement, etc.) that has a single database hosted by SQL Server 2005 and a bunch of client applications. The main client (used by all users) is an MS Access 2003 application (ADP), and other clients include various VB/VBA applications like Excel add-ins and command-line utilities. </p>

<p>In addition to 60 or so tables (mostly in 3NF), the database contains about 200 views, about 170 UDFs (mostly scalar and table-valued inline ones), and about 50 stored procedures. As you might have guessed, some portion of so-called ""business logic"" is encapsulated in this mass of T-SQL code (and thus is shared by all clients). </p>

<p>Overall, the system's code (including the T-SQL code) is not very well organized and is very refactoring-resistant, so to speak. In particular, schemata of most of the tables cry for all kinds of refactorings, small (like column renamings) and large (like normalization). </p>

<p>FWIW, I have pretty long and decent application development experience (C/C++, Java, VB, and whatnot), but I am not a DBA. So, if the question will look silly to you, now you know why it is so. :-)</p>

<h2>Question</h2>

<p>While thinking about refactoring all this mess (in a peacemeal fashion of course), I've come up with the following idea: </p>

<ol>
<li><p>For each table, create a ""wrapper"" view that (a) has all the columns that the table has; and (b) in some cases, has some additional computed columns based on the table's ""real"" columns. </p>

<p>A typical (albeit simplistic) example of such additional computed column would be sale price of a product derived from the product's regular price and discount. </p></li>
<li><p>Reorganize all the code (both T-SQL and VB/VBA client code) so that only the ""wrapper"" views refer to tables directly. </p>

<p>So, for example, even if an application or a stored procedure needed to     insert/update/delete records from a table, they'd do that against the corresponding ""table wrapper"" view, not against the table directly. </p></li>
</ol>

<p>So, essentially this is about <strong>isolating all the tables by views from the rest of the system</strong>.</p>

<p>This approach seems to provide a lot of benefits, especially from maintainability viewpoint. For example:</p>

<ul>
<li><p>When a table column is to be renamed, it can be done without rewriting all the affected client code at once. </p></li>
<li><p>It is easier to implement derived attributes (easier than using computed columns). </p></li>
<li><p>You can effectively have aliases for column names. </p></li>
</ul>

<p>Obviously, there must be some price for all these benefits, but I am not sure that I am seeing all the catches lurking out there. </p>

<p>Did anybody try this approach in practice? What are the major pitfalls? </p>

<p>One obvious disadvantage is the cost of maintaining ""wrapper"" views in sync with their corresponding tables (a new column in a table has to be added to a view too; a column deleted from a table has to be deleted from the view too; etc.). But this price seems to be small and fair for making the overall codebase more resilient. </p>

<p>Does anyone know any other, stronger drawbacks?</p>

<p>For example, usage of all those ""wrapper"" views instead of tables is very likely to have some adverse performance impact, but is this impact going to be substantial enough to worry about it? Also, while using ADODB, it is very easy to get a recordset that is not updateable even when it is based just on a few joined tables; so, are the ""wrapper"" views going to make things substantially worse? And so on, and so forth... </p>

<p>Any comments (especially shared real experience) would be greatly appreciated. </p>

<p>Thank you!</p>

<p><hr /></p>

<p>P.S. I stepped on the following old article that discusses the idea of ""wrapper"" views: </p>

<p><a href=""http://www.craigsmullins.com/cnr_0299b.htm"" rel=""nofollow"">The Big View Myth</a></p>

<p>The article advises to avoid the approach described above. But... I do not really see any good reasons against this idea in the article. Quite the contrary, in its list of good reasons to create a view, almost each item is exactly why it is so tempting to create a ""wrapper"" view for each and every table (especially in a legacy system, as a part of refactoring process). </p>

<p>The article is really old (1999), so whatever reasons were good then may be no longer good now (and vice versa). It would be really interesting to hear from someone who considered or even tried this idea recently, with the latest versions of SQL Server and MS Access...</p>
","<sql><sql-server><database><refactoring>","7","2569","2008-10-26 05:14:33"
"237876","Refactoring ""to hit"" values for a game","<p>I'm making a game and one of the methods calculates a character's base hit numbers based on skill values. The method currently calculates each value individually, since each skill can be used at short, medium, and long range.</p>

<p>I originally thought I could combine the skills into a tuple and iterate over it, dynamically creating each hit number. But I don't know if it's actually possible, since I currently have each hit number assigned to it's own variable.</p>

<p>I also thought about creating a method for each range, and passing the tuple as an argument. I could create a new tuple or list with the resulting values and then assign them to the individual variables, but I don't see how it would be any better than do it this way, except that it won't look so copy &amp; pasted.</p>

<p>Here's what I currently have:</p>

<pre><code>    def calcBaseHitNumbers(self, dict):
        """"""Calculate character's base hit numbers depending on skill level.""""""

        self.skill_dict = dict

        self.rifle = self.skill_dict.get('CRM', 0)
        self.pistol = self.skill_dict.get('PST', 0)
        self.big_gun = self.skill_dict.get('LCG', 0)
        self.heavy_weapon = self.skill_dict.get('HW', 0)
        self.bow = self.skill_dict.get('LB', 0)
        #self.skill_tuple = (self.rifle, self.pistol, self.big_gun, self.heavy_weapon,
        #    self.bow)

#---Short range
##        for skill in self.skill_tuple:
##            self.base_hit_short = skill * 0.6
        self.charAttribs.bhCRM_short = self.rifle * 0.6
        self.charAttribs.bhPST_short = self.pistol * 0.6
        self.charAttribs.bhHW_short = self.heavy_weapon * 0.6
        self.charAttribs.bhLCG_short = self.big_gun * 0.6
        self.charAttribs.bhLB_short = self.bow * 0.6
#---Med range
        self.charAttribs.bhCRM_med = self.rifle * 0.3
        self.charAttribs.bhPST_med = self.pistol * 0.3
        self.charAttribs.bhHW_med = self.heavy_weapon * 0.3
        self.charAttribs.bhLCG_med = self.big_gun * 0.3
        self.charAttribs.bhLB_med = self.bow * 0.3
#---Long range
        self.charAttribs.bhCRM_long = self.rifle * 0.1
        self.charAttribs.bhPST_long = self.pistol * 0.1
        self.charAttribs.bhHW_long = self.heavy_weapon * 0.1
        self.charAttribs.bhLCG_long = self.big_gun * 0.1
        self.charAttribs.bhLB_long = self.bow * 0.1
</code></pre>

<p>How would you refactor this so it's more dynamic?</p>

<p><hr /></p>

<p><strong>Edit:</strong> I guess what I want to do is something like this:
Have a tuple (like the one I commented out) and iterate over it 3 times, each time making a new value (for each skill) based on the modifier for each particular range. The resulting value is then automatically assigned to it's respective variable.</p>

<p>In my head, it makes sense. But when I actually try to code it, I get lost. The problem, I think, is that this is the first ""real"" program I've written; all I've done before are small scripts.</p>

<p>This is only the 0.1 version of my program, so it's not critical to refactor it now. However, it seems very un-Pythonic to do this manually and I also want to ""future-proof"" this in case things change down the road.</p>
","<python><refactoring><game-development>","1","310","2008-10-26 11:08:32"
"232475","Is it possible use or require a Perl script without executing its statements?","<p>I need to add unit testing to some old scripts, the scripts are all basically in the following form:</p>

<pre><code>#!/usr/bin/perl

# Main code
foo();
bar();

# subs
sub foo {

}
sub bar {

}
</code></pre>

<p>If I try to 'require' this code in a unit test, the main section of the code will run, where as I want to be able to just test ""foo"" in isolation.</p>

<p>Is there any way to do this without moving foo,bar into a seperate .pm file?</p>
","<perl><testing><refactoring>","13","865","2008-10-24 04:21:19"
"239344","How could I improve this code ( C++ )","<p>I want your suggestion on the following pseudo-code . Please suggest how could I improve it,whether or not I could use some design patterns .</p>

<pre><code>
// i'm receiving a string containing : id operation arguments
data    = read(socket);
tokens  = tokenize(data,"" ""); // tokenize the string based on spaces
if(tokens[0] == ""A"") {
   if(tokens[1] == ""some_operation"") {
      // here goes code for some_operation , will use the remaining tokens as arguments for function calls
   }
   else if(tokens[1] == ""some_other_operation"") {
     // here goes code for some_other_operation , will use the remaining tokens
   }
   ...
   else {
     // unknown operation
   }
}
else if(tokens[0] == ""B"") {
   if(tokens[1] == ""some_operation_for_B"") {
     // do some operation for B
   }
   else if(tokens[1] == ""yet_another_operation"") {
     // do yet_another_operation for B
   }
   ...
   else {
     // unknown operation
   } 
}
</code></pre>

<p>I hope you get the point . The thing is I have a large number of <strong>id's</strong> and each has it's own <strong>operations</strong> , and I think it's kinda ugly to have 10 screens of code containing a lot of <strong>if's</strong> and <strong>else if's</strong>.</p>
","<c++><design-patterns><refactoring>","7","691","2008-10-27 08:41:45"
"233189","Eclipse: Relocating a git repo from project to workspace","<p>I've been working on an Eclipse plug-in project for a while now, and I've run into a situation where I need to split the project up to seperate the test cases from the plug-in package. I'm using git as version control.</p>

<p>To describe this simply, I'm versioning the old project like this:</p>

<pre><code>workspace/
  |
  +-- myplugin/
         |
         +-- .git/ &lt;-- Here be the git repository
         |
         +-- /* Source code, project stuff, etc. */
</code></pre>

<p>…and I'm in the situation where I need to work the plugin tests in a seperate project (so that jUnit won't be needed as a required bundle with the plugin). And I'd like the repository to version everything in the workspace. Like this:</p>

<pre><code>workspace/
  |
  +-- .git/ &lt;-- The repository should be relocated here instead…
  |
  +-- myplugin/
  |      |
  |      +-- /* Source code, project stuff, etc. */
  |
  +-- myplugin-test/
         |
         +-- /* Unit tests and stuff… */
</code></pre>

<p>Is there a simple way to do this without losing the history of the old project?</p>
","<eclipse><git><version-control><refactoring><relocation>","1","749","2008-10-24 11:44:48"
"241249","Coming up with time/staff required estimates for converting a desktop app into a client-server app","<p>My boss is bidding on a project to convert a desktop application into one that runs online as a client-server application. The original app has a little more than a quarter of a million lines of C++ (MFC) code that's not cleanly divided between engine and front-end.</p>

<p>I need to come up with estimates of how long it will take and how many people would be needed for such a project. We don't have anyone on staff capable of doing this project, and we don't have any Windows machines, so we'd have to subcontract/outsource.</p>

<p>Alternatively, what arguments can I use to convince my boss that this project is a bad idea?</p>
","<refactoring>","1","135","2008-10-27 20:17:06"
"242407","How to convince my boss to do refactoring?","<p>We (developers) think we should do large grand refactoring in our project, because:</p>

<ol>
<li>With long time (more than 1 year) bug fixing too much hard code/hard logic been involved.</li>
<li>Pickup one piece of code, nobody in this big team can confidentially tell you what will happen if you change that, because code are sticked together.</li>
<li>We are facing fidelity problems, that our software must give exactly same output for old input. In other side we have lots of new feature requirement. We want change code but every change may cause regression (fidelity) problem.</li>
</ol>

<p>We want refactoring code to simplify the complexity, but we don't know how to convince our boss and ourselves. They need some thing to prove that work will useful.</p>

<p>The software we are working on is really big and complex. And the refactoring we planed is not a days job by one or two man. We have a big test team and automatic test utility (not Unit Test) but even that can not cover all our input.</p>

<p>Currently we are counting/classing problems in code by review bugs and codes, we try to find a way to which one should be refactoring first, but we are not sure if it's helpful.</p>

<p>Thanks,
Trapped Developer in Large Complex Software</p>
","<language-agnostic><refactoring>","19","1069","2008-10-28 06:39:42"
"244439","Refactoring and concurrent development branches","<p>You have several maintenance branches for existing releases of your software. Some developers are making direct changes in the maintenance branches, and merging periodically into the trunk. Now comes an extensive refactoring in the trunk codeline, scheduled for an upcoming major release. But this makes the maintenance branches fundamentally incompatible with the code in the trunk, as they might depend on code that does not exist anymore, for example.</p>

<p>How do you deal with this situation in practise?</p>
","<svn><version-control><refactoring><branch>","23","1359","2008-10-28 19:07:20"
"244445","Best refactoring for the dreaded While (True) loop","<p>If, like me, you shiver at the site of a While (True) loop, then you too must have thought long and hard about the best way to refactor it away.  I've seen several different implementations, none really better than any other, such as the timer &amp; delegate combination.</p>

<p>So what's the best way you've come up with or seen to refactor the dreaded While (True) loop?</p>

<p><b>Edit</b>: As some comments mentioned, my intent was for this question to be an ""infinite loop"" refactoring, such as running a Windows style service where the only stop conditions would be OnStop or a fatal exception.</p>
","<refactoring><loops><while-loops>","6","2089","2008-10-28 19:08:57"
"249063","Cost of Rewriting a PHP application to Rails or Django","<p>I am wondering your thoughts on doing a complete software rewrite. We realized after not long after we completed our software app that the framework was not going to scale well over time. For the record the framework was decided well before I got to the project. We are soon facing the reality that we will have to rewrite the entire app in a new framework. We are currently using a php. I have read in numerous places that complete software re-writes often fail or are extremely painful and time consuming. Does anyone have experience in this? Do you think that it would be wise to look at rails or django even though non of the developers know either very well? Thanks, I look forward to any advice you might have.</p>
","<php><refactoring><rewrite>","6","633","2008-10-30 01:59:36"
"249827","Are there C++ free and fast (maybe standalone) refactoring tools for Windows?","<p>At the moment I am working in a pretty big project and I have been been asked to refactor some old code. Most of the refactoring is setting apart a big class into smaller components and functions.</p>

<p>I've searched and seen some other <a href=""http://stackoverflow.com/questions/16167/good-refactoring-support-for-c"">questions</a> related with the topic but I am not very happy with the proposed options. The problem with these is that</p>

<ul>
<li>Everybody here uses VS2005 in Windows and I am not very keen on using different editors for the same project.</li>
<li>The Reactor! plugin for VS2005 is just too slow to work with.</li>
<li>Reactor!Pro is not for free and I am not that sure it would work faster.</li>
</ul>

<p>I was just wondering if there is any lightweight standalone GUI-based free tool that does not make my computer work slower than a lame snail. It does not have to make 150 refactorings just the basics. Maybe I am asking for too much!</p>
","<c++><windows><visual-studio><refactoring><standalone>","4","1038","2008-10-30 11:12:01"
"250137","Refactoring static method / static field for Testing","<p>I have the following legacy code:</p>

<pre><code>public class MyLegacyClass
{
    private static final String jndiName = ""java:comp/env/jdbc/LegacyDataSource""

    public static SomeLegacyClass doSomeLegacyStuff(SomeOtherLegacyClass legacyObj)
    {
       // do stuff using jndiName
    }
}
</code></pre>

<p>This class is working in a J2EE-Container.</p>

<p>Now I would like to test the class outside of the container.</p>

<p>What is the best strategy?
Refactoring is basically allowed.</p>

<p>Accessing the LegacyDataSource is allowed (the test does not have to be a ""pure"" unit-test).</p>

<p>EDIT: Introducing additional runtime-frameworks is not allowed.</p>
","<java><testing><refactoring><static>","6","2267","2008-10-30 13:15:55"
"245963","Find unused code","<p>I have to refactor a large C# Application, and i found a lot of functions that are never used in the app. Is there a tool that can check for unused code, so i can remove all the unused functions?</p>
","<c#><.net><refactoring>","55","13565","2008-10-29 06:32:27"
"247149","Removing repeated conditions using polymorphism and the Factory pattern","<pre><code>&lt;?php
/**
 * My codebase is littered with the same conditionals over and over
 * again.  I'm trying to refactor using inheritance and the Factory
 * pattern and I've had some success but I'm now stuck.
 *
 * I'm stuck because I want to derive a new class from the one
 * returned by the Factory.  But I can't do that, so I'm obviously
 * doing something wrong somewhere else.
 */


/**
 * The old implementation was as follows.  There's if statements
 * everywhere throughout both LayoutView and ItemIndexView and
 * SomeOtherView.
 */
class LayoutView { }
class IndexView extends LayoutView { }
class SomeOtherView extends LayoutView { }

/**
 * Below is the new implementation.  So far I've managed to tidy
 * up LayoutView (I think I have anyway).  But now I'm stuck because
 * the way I've tidied it up has left me not knowing how to extend
 * it.
 *
 * For example's sake, let's say the conditions were relating to a
 * type of fish: salmon or tuna.
 */
abstract class LayoutView {
    protected function prepareHeader() { echo __METHOD__, ""\n""; }
    protected function prepareLeftHandSide() { echo __METHOD__, ""\n""; }
    protected function prepareFooter() { echo __METHOD__, ""\n""; }
    public function prepare() {
        $this-&gt;prepareHeader();
        $this-&gt;prepareLeftHandSide();
        $this-&gt;prepareFooter();
    }
}

class SalmonLayoutView extends LayoutView
{
    protected function prepareLeftHandSide() { echo __METHOD__, ""\n""; }
}

class TunaLayoutView extends LayoutView
{
    protected function prepareLeftHandSide() { echo __METHOD__, ""\n""; }
    protected function prepareFooter() { echo __METHOD__, ""\n""; }
}

class ViewFactory {
    public static function getLayoutView($fishType) {
        switch($this-&gt;$fishType) {
        case 'salmon':
            return new SalmonLayoutView();
            break;
        case 'tuna':
            return new TunaLayoutView();
            break;
        }
    }
}

/**
 * Now LayoutView has been cleaned up and the condition that was once
 * scattered through every LayoutView method is now in one place.
 */
$view = ViewFactory::getLayoutView( Config::getOption('fishtype') );
$view-&gt;prepare();

/**
 * Now here's where I'm stuck.  I want to effectively extend whatever
 * class $view is an instance of.
 *
 * The reason being, I wish to derive a view to show an index of
 * articles within the appropriate *LayoutView.  The IndexView code is
 * the same for Salmon and Tuna.
 *
 * I can do something like this:
 */

class SalmonIndexView extends SalmonLayoutView { }
class TunaIndexView extends TunaLayoutView { }

/**
 * But then I'll be writing the same IndexView code twice.  What I'd
 * like to do is something like this:
 */

$view = ViewFactory::getLayoutView( Config::getOption('fishtype') );
class IndexView extends get_class($view) { }

/**
 * But I'm pretty certain that's not possible, and even if it was
 * it seems very wrong.
 *
 * Can someone more experienced in refactoring and OO please let
 * me know where I've gone wrong and suggest a clean way to solve
 * this?
 */
</code></pre>
","<design-patterns><oop><php5><inheritance><refactoring>","0","321","2008-10-29 15:03:34"
"253621","Refactor traceListener code so it can be unit tested","<p>I have the following code:</p>

<pre><code>private static void WriteStartupInfo()
    {
        Settings settings = Settings.Default;
        TimeSpan interval = settings.CleanupInterval;
        TimeSpan span = settings.ExpiryTimeSpan;
        string url = settings.TeamFoundationServerUrl; 
        StringBuilder sb = new StringBuilder();
        sb.Append(String.Format(""CleanupInterval:{0}{1}"", interval,Environment.NewLine));
        sb.Append(String.Format(""ExpiryTimeSpan:{0}{1}"", span,Environment.NewLine));
        sb.Append(String.Format(""TeamFoundationServerUrl:{0}{1}"", url,Environment.NewLine));
        Trace.TraceInformation(sb.ToString());
    }
</code></pre>

<p>This needs to be tested. How do I unit test this ?</p>

<p>Is it as simple as removing trace listeners and adding a unit test trace listener ?</p>

<p>Any help will be greatly appreciated.</p>
","<c#><unit-testing><refactoring>","1","169","2008-10-31 14:06:58"
"255000","Forking open source PHP code, project classloader strategy","<p>I've been looking for a good PHP ORM tool to use, and I recently found a good ORM class in Kohana. It has a fairly good and simple ORM implementation. The problem is, the code is unreusable outside of the Kohana framework without a rewrite/refactor. It relies on the Kohana class loader and various framework loading strategies to even work in the first place. Further, the required classes aren't packaged into a single dependency directory, or even multiple directories. </p>

<p>When I do this rewrite, I intend to republish the code via sourceforge or something, and those guys can of course reuse it if they want.  So, should I just package the fileset needed into one directory, and make the appropriate classes do a require_once on any dependant classes, and 2 should I stick with the original class names that are project dependent (like Kohana_exception) even though it is pretty much unrelated to the Kohana project as a whole?</p>

<p>A second option would be to write another classloader that is a simplified version of the Kohana Framework classloader, and only cares about the ORM related stuff...</p>
","<php><open-source><refactoring><kohana>","1","342","2008-10-31 21:22:08"
"255509","How does TDD make refactoring easier?","<p>I've heard that projects developed using TDD are easier to refactor because the practice yields a comprehensive set of unit tests, which will (hopefully) fail if any change has broken the code. All of the examples I've seen of this, however, deal with refactoring implementation - changing an algorithm with a more efficient one, for example. </p>

<p>I find that refactoring architecture is a lot more common in the early stages where the design is still being worked out. Interfaces change, new classes are added &amp; deleted, even the behavior of a function could change slightly (I thought I needed it to do this, but it actually needs to do that), etc... But if each test case is tightly coupled to these unstable classes, wouldn't you have to be constantly rewriting your test cases each time you change a design? </p>

<p>Under what situations in TDD is it okay to alter and delete test cases? How can you be sure that altering the test cases don't break them? Plus it seems that having to synchronize a comprehensive test suite with constantly changing code would be a pain. I understand that the unit test suite could help tremendously during maintenance, once the software is built, stable, and functioning, but that's late in the game wheras TDD is supposed to help early on as well.</p>

<p>Lastly, would a good book on TDD and/or refactoring address these sort of issues? If so, which would you recommend?</p>
","<refactoring><tdd>","10","1006","2008-11-01 03:56:36"
"263342","When to call the gang of four? [When to use design patterns?]","<p>In <a href=""http://www.joelonsoftware.com/articles/GuerrillaInterviewing3.html"" rel=""nofollow"">The Guerilla Guide to Interviewing</a> Joel says that guys who want to get things done, but are not smart will do stupid things like using a visitor design pattern where a simple array would be sufficient.</p>

<p>I find it hard to detect, if the design pattern suggested by the <a href=""http://en.wikipedia.org/wiki/Gang_of_Four_(software)"" rel=""nofollow"">Gang of Four</a> should be applied.</p>

<p>Therefore, I would like some examples from Your work experience</p>

<ul>
<li>When is a simple approach (fixed size array) sufficient?</li>
<li>What is the minimum size of a piece of software that justifies the use of the GoF patterns?</li>
<li>When to refactor from simple-minded to GoF? Can this be done in a sensible way?</li>
</ul>
","<design-patterns><refactoring><software-design><gof>","11","1167","2008-11-04 20:40:11"
"258954","Java: Out with the Old, In with the New ","<p>Java is nearing version 7. It occurs to me that there there must be plenty of textbooks and training manuals kicking around that teach methods based on older versions of Java; where the methods taught, would have far better solutions now.</p>

<p>What are some boilerplate code situations, especially ones that you see people implement through force of habit, that you find yourself refactoring to utilize the latest versions of Java?</p>
","<java><refactoring><code-review><versioning><methodology>","55","3738","2008-11-03 15:15:22"
"270822","Extensible rule-based access pattern","<p>I control access to some of my static web resources with some PHP logic.  Because directory-based authorization through the webserver is not suitable or easily possible.</p>

<p>A combination of things determines whether access is granted or denied.  And these rules change from time to time.</p>

<p>In the beginning it was a simple regex path match, and a check of one session variable.  It's more complicated now as there's a few more variables involved.</p>

<p>I'm wondering how to go about refactoring this so it's quick and easy to change the rules.  When it was a simple ""if this AND this, then deliver, else 403.""  it was fine to do it in straight PHP.  Now the conditions are more complex and there's a couple levels of nesting each with common but slightly different conditions within.  This is all easy enough to refactor, but it's not the most intuitive and easy to update.</p>

<p>I'm thinking of one of two things.</p>

<ol>
<li><p>Establish classes for each of the top level of conditions and use a Strategy Factory to pick the right one authorize.  Derive them all from a base class containing the common bits and overload whatever's necessary.  I think this could still be prone to some shuffling around when some conditions change.</p></li>
<li><p>Make a simple engine that iterates a 2d array of ordered rules sort of like firewall rules.  Something like: <code>&lt;allow|deny&gt;, &lt;auth_group&gt;, &lt;path_regex&gt;, &lt;other vars&gt;</code></p></li>
</ol>

<p>I haven't fully thought this one through but it seems like it would be easier to update and also to read as a human.</p>

<p>What would you do?  Is there an established pattern or library I can use for this?</p>

<p>I faced this similar problem in another app some time ago.  Where I wanted an easy to update way of chaining rules and outcomes together based on several levels of conditions.  This isn't as complicated as that app, but I'd be interested to hear about patterns people use to solve this kind of problem.</p>
","<php><design-patterns><oop><refactoring><rule-engine>","3","467","2008-11-06 23:51:49"
"276856","Loops in Makefile","<p>I have a lot of assignments where I have to continually update a Makefile as I add more subsequently numbered C programs.  Is there a way to do this with a loop which iterates over the values 1.1, 1.2, 1.3, etc.?</p>

<pre><code>all: 1.1 1.2 1.3 1.4 1.5 1.6 1.7. 1.8 1.9

1.1: 1.1.o
    gcc -o 1.1 $(FLAGS) 1.1.o
1.1.o: 1.1.c
    gcc -c $(FLAGS) 1.1.c

1.2: 1.2.o
    gcc -o 1.2 $(FLAGS) 1.2.o
1.2.o: 1.2.c
    gcc -c $(FLAGS) 1.2.c

1.3: 1.3.o
    gcc -o 1.3 $(FLAGS) 1.3.o
1.3.o: 1.3.c
    gcc -c $(FLAGS) 1.3.c

1.4: 1.4.o
    gcc -o 1.4 $(FLAGS) 1.4.o
1.4.o: 1.4.c
    gcc -c $(FLAGS) 1.4.c

1.5: 1.5.o
    gcc -o 1.5 $(FLAGS) 1.5.o
1.5.o: 1.5.c
    gcc -c $(FLAGS) 1.5.c

1.6: 1.6.o
    gcc -o 1.6 $(FLAGS) 1.6.o
1.6.o: 1.6.c
    gcc -c $(FLAGS) 1.6.c

1.7: 1.7.o
    gcc -o 1.7 $(FLAGS) 1.7.o
1.7.o: 1.7.c
    gcc -c $(FLAGS) 1.7.c

1.8: 1.8.o
    gcc -o 1.8 $(FLAGS) 1.8.o
1.8.o: 1.8.c
    gcc -c $(FLAGS) 1.8.c

1.9: 1.9.o
    gcc -o 1.9 $(FLAGS) 1.9.o
1.9.o: 1.9.c
    gcc -c $(FLAGS) 1.9.c

clean:
    rm -f *.o
    rm -f 1.1 1.2 1.3 1.4 1.5 1.6 1.7. 1.8 1.9</code></pre>
","<refactoring><makefile>","4","8582","2008-11-10 01:38:14"
"280449","Refactoring solution needed","<p>I have a page on which I must load controls dynamically based on the user selection.
Let's say that I have something like this:</p>

<pre><code>public static readonly Dictionary&lt;string, string&gt; DynamicControls = new Dictionary&lt;string, string&gt;
        {
            { ""UserCtrl1"",  ""~/Controls/UserCtrl1.ascx"" },
            { ""UserCtrl2"",  ""~/Controls/UserCtrl2.ascx"" },
            { ""UserCtrl3"",  ""~/Controls/UserCtrl3.ascx"" },
            { ""UserCtrl4"",  ""~/Controls/UserCtrl4.ascx""}
};
</code></pre>

<p>Now let's say than on the page where the controls are loaded the code is something like this:</p>

<pre><code>protected void Page_Load(object sender, EventArgs e)
        {
            SomePanel.Controls.Add(GetControl());
        }        

        private Control GetControl()
        {
            string dynamicCtrl = CurrentItem.DynamicControl;
            string path = SomeClass.DynamicControls[dynamicCtrl];

            Control ctrl = null;            

            //TODO: find a better way to load the controls
            switch (dynamicCtrl)
            {
                case ""UserCtrl1"":
                    {
                        ctrl = (UserCtrl1)LoadControl(path);
                    }
                    break;
                case ""UserCtrl2"":
                    {
                        ctrl = (UserCtrl2)LoadControl(path);
                    }
                    break;
                case ""UserCtrl3"":
                    {
                        ctrl = (UserCtrl3)LoadControl(path);
                    }
                    break;
                default:
                    {
                        throw new ApplicationException(""Invalid dynamic control added."");
                    }                
            }

            return ctrl;
        }
</code></pre>

<p>The page has the required registered statements. Any idea how I can get rid of this ugly switch statement?</p>
","<c#><asp.net><refactoring>","0","181","2008-11-11 09:41:27"
"282758","Truncate a string nicely to fit within a given pixel width","<p>Sometimes you have strings that must fit within a certain pixel width. This function attempts to do so efficiently. Please post your suggestions or refactorings below :)</p>

<pre><code>function fitStringToSize(str,len) {
    var shortStr = str;
    var f = document.createElement(""span"");
    f.style.display = 'hidden';
    f.style.padding = '0px';
    document.body.appendChild(f);

    // on first run, check if string fits into the length already.
    f.innerHTML = str;
    diff = f.offsetWidth - len;

    // if string is too long, shorten it by the approximate 
    // difference in characters (to make for fewer iterations). 
    while(diff &gt; 0)
    {
        shortStr = substring(str,0,(str.length - Math.ceil(diff / 5))) + '&amp;hellip;';
        f.innerHTML = shortStr;
        diff = f.offsetWidth - len;
    }

    while(f.lastChild) {
        f.removeChild(f.lastChild);
    }
    document.body.removeChild(f);

    // if the string was too long, put the original string 
    // in the title element of the abbr, and append an ellipsis
    if(shortStr.length &lt; str.length)
    {
        return '&lt;abbr title=""' + str + '""&gt;' + shortStr + '&lt;/abbr&gt;';
    }
    // if the string was short enough in the first place, just return it.
    else
    {
        return str;
    }
}
</code></pre>

<p>UPDATE:
@some's solution below is much better; please use that. </p>

<p>Update 2:
Code now posted as a <a href=""https://gist.github.com/24261/7fdb113f1e26111bd78c0c6fe515f6c0bf418af5"" rel=""nofollow"">gist</a>; feel free to fork and submit patches :)</p>
","<javascript><text><reference><refactoring>","4","8220","2008-11-12 01:42:03"
"287274","Rewriting methods within a project","<p>As a growing dev team we are beginning to encounter the problem of rewriting functions that behave in similar/identical ways.</p>

<p>We are all guilty of failing to write documentation as time is a limiting factor, however the idea of gathering all current functions (duplicates and all) and using that list along with applied key words and the methods summary to identify current methods before we rewrite them has been suggested.</p>

<p>Now before I go and write a solution I just wanted to make sure there isn’t a perfectly good solution out there, I've already done the obvious and searched a little, but googling
Visual Studio + return function list and other variations surprisingly returns not a whole bunch.</p>

<p>Any suggestions would be much appreciated.</p>
","<visual-studio><refactoring>","1","74","2008-11-13 15:38:17"
"289743","Tool to refactor C# var to explicit type","<p>Our coding standards ask that we minimise the use of C# var (suggests limiting it's use to being in conjunction with Linq). However there are times when using generics where it's reasonably convenient e.g.</p>

<pre><code>Dictionary&lt;DateTime, Dictionary&lt;string, float&gt;&gt; allValues = ...
// ...
foreach (var dateEntry in allValue)
</code></pre>

<p>is easier to type </p>

<pre><code>foreach (KeyValue&lt;DateTime, Dictionary&lt;string, float&gt;&gt; dateEntry in allValue)
</code></pre>

<p>(and easier than remembering what the explicit type is in some cases). </p>

<p>Do any of the refactoring tools have the ability to convert the former to the latter. I've had a look at Resharper but it doesn't seem to do (indeed it's default suggestion is to go in the opposite direction).</p>
","<c#><refactoring>","5","1318","2008-11-14 10:44:26"
"284063","Using TryParse for Setting Object Property Values","<p>I'm currently refactoring code to replace Convert.To's to TryParse.</p>

<p>I've come across the following bit of code which is creating and assigning a property to an object.</p>

<pre><code>List&lt;Person&gt; list = new List&lt;Person&gt;();

foreach (DataRow row in dt.Rows)
{
     var p = new Person{ RecordID = Convert.ToInt32(row[""ContactID""]) };

     list.Add(p);
}
</code></pre>

<p>What I've come up with as a replacement is:</p>

<pre><code>var p = new Person { RecordID = Int32.TryParse(row[""ContactID""].ToString(), out RecordID) ? RecordID : RecordID };
</code></pre>

<p>Any thoughts, opinions, alternatives to what I've done?</p>
","<c#><exception><refactoring><tryparse>","3","974","2008-11-12 14:18:46"
"293006","How to divide a large Java project into smaller components","<p>We've trying to separate a big code base into logical modules. I would like some recommendations for tools as well as whatever experiences you might have had with this sort of thing. </p>

<p>The application consists of a server WAR and several rich-clients distributed in JARs. The trouble is that it's all in one big, hairy code base, one source tree of > 2k files war. Each JAR has a dedicated class with a <code>main</code> method, but the tangle of dependencies ensnares quickly. It's not all that bad, good practices were followed consistently and there are components with specific tasks. It just needs some improvement to help our team scale as it grows.</p>

<p>The modules will each be in a maven project, built by a parent POM. The process has already started on moving each JAR/WAR into it's own project, but it's obvious that this will only scratch the surface: a few classes in each app JAR and a mammoth ""legacy"" project with everything else. Also, there are already some unit and integration tests.</p>

<p>Anyway, I'm interesting in tools, techniques, and general advice to breaking up an overly large and entangled code base into something more manageable. Free/open source is preferred.</p>
","<java><tools><refactoring><recommendation>","5","2034","2008-11-15 20:17:58"
"299501","Need for refactoring?","<p>Why should companies invest in refactoring components, though it is not going to add any new feature to the product ?</p>

<p>I agree it is to clean the code, fix bugs and remove dead code - but what is the take ?? </p>
","<refactoring><software-engineering>","2","290","2008-11-18 17:37:06"
"299509","Refactor menu item for VB.NET projects in VS2008","<p>Is there any way to use the VS2008 built-in Refactoring functionality on VB.NET projects? </p>
","<vb.net><visual-studio-2008><refactoring>","1","1294","2008-11-18 17:39:32"
"296056","How fanatically do you eliminate Code Duplication?","<p>How fanatic are you about elimination of duplicate code?</p>

<p>Personally, whenever I see duplicate code, either in testing code or production, I tend to refactor the duplication away. The only exception I make are these:</p>

<ol>
<li>Sometimes the reduction in duplication is very minimal, because the newly refactored method have too many parameters to be actually useful / readable.</li>
<li>Sometimes, in test code, when several tests use the same piece of code that's not really a coherent flow I leave the duplication alone (but not always - depending on the dup size).</li>
</ol>
","<refactoring><code-duplication>","21","1323","2008-11-17 16:26:14"
"301085","Is there any formal definition for ""refactoring""?","<p>Anyone knows a way to define refactoring in a more formal way?</p>

<p>UPDATE.</p>

<blockquote>
  <p>A refactoring is a pair R = (pre; T) where pre is the precondition that
  the program must satisfy, and T is the program transformation.</p>
</blockquote>
","<refactoring><theory><program-transformation>","7","343","2008-11-19 05:38:41"
"302589","Refactoring for non OO languages","<p>Can anyone recommend a website, book, or simply a list of refactoring strategies for procedural languages as opposed to object oriented languages? </p>

<p>Everything I was able to find contained some strategies that could apply, most were useful only if working in an OO language. </p>
","<language-agnostic><books><refactoring><website><procedural>","4","271","2008-11-19 16:55:13"
"307619","JSON - Slashes and application type..refactoring","<p>My code works (yeah!) which sends json to a server.. would appreciate any thoughts on refactoring</p>

<p>1) My C# code sends this json to the server</p>

<p>{\""firstName\"":\""Bill\"",\""lastName\"":\""Gates\"",\""email\"":\""asdf@hotmail.com\"",\""deviceUUID\"":\""abcdefghijklmnopqrstuvwxyz\""}</p>

<p>Which I have to get rid of the slashes on the server side....not good.</p>

<p>2) I'm using application/x-www-form-urlencoded and probably want to be using application/json</p>

<pre><code>Person p = new Person();
            p.firstName = ""Bill"";
            p.lastName = ""Gates"";
            p.email = ""asdf@hotmail.com"";
            p.deviceUUID = ""abcdefghijklmnopqrstuvwxyz"";

            HttpWebRequest request = (HttpWebRequest)WebRequest.Create(targetUri + ""newuser.php"");
            request.Method = ""POST"";
            request.ContentType = ""application/x-www-form-urlencoded"";
            //TODO request.ContentType = ""application/json"";

            JavaScriptSerializer serializer = new JavaScriptSerializer();
            string s = serializer.Serialize(p);
            textBox3.Text = s;

            string postData = ""json="" + HttpUtility.UrlEncode(s);

            byte[] byteArray = Encoding.ASCII.GetBytes(postData);

            request.ContentLength = byteArray.Length;
            Stream dataStream = request.GetRequestStream();
            dataStream.Write(byteArray, 0, byteArray.Length);
            dataStream.Close ();

            WebResponse response = request.GetResponse();
            //textBox4.Text = (((HttpWebResponse)response).StatusDescription);
            dataStream = response.GetResponseStream ();

            StreamReader reader = new StreamReader(dataStream);
            string responseFromServer = reader.ReadToEnd ();
            textBox4.Text += responseFromServer;

            reader.Close ();
            dataStream.Close ();
            response.Close ();
</code></pre>

<p>PHP Code on Server:</p>

<pre><code>$inbound = $_POST['json'];

// this strips out the \
$stripped = stripslashes($inbound);

$json_object = json_decode($stripped);
echo $json_object-&gt;{'firstName'};
echo $json_object-&gt;{'lastName'};
echo $json_object-&gt;{'email'};
echo $json_object-&gt;{'deviceUUID'};
</code></pre>
","<c#><php><json><refactoring>","0","931","2008-11-21 02:12:07"
"311626","Duck type as syntactic sugar for reflection: Good or bad idea?","<p>I've been thinking lately, would it be a good form of syntactic sugar in languages like Java and C#, to include a ""duck"" type as a method parameter type?  This would look as follows:</p>

<pre><code>void myFunction(duck foo) {
   foo.doStuff();
}
</code></pre>

<p>This could be syntactic sugar for invoking doStuff() via reflection, or it could be implemented differently.  Foo could be any type.  If foo does not have a doStuff() method, this would throw a runtime exception.  The point is that you would have the benefits of the more rigid pre-specified interface paradigm (performance, error checking) when you want them, i.e. most of the time.  At the same time, you'd have a simple, clean-looking backdoor to duck typing, which would allow you to cleanly make changes not foreseen in the initial design without massive refactoring.  Furthermore, it would likely be 100% backwards compatible and mesh cleanly with existing language constructs.  I think this might help cut down on the overengineered just-in-case programming style that leads to confusing, cluttered APIs.  Do you believe that something like this would be a good or bad thing in static OO languages like C# and Java?</p>
","<refactoring><language-design><syntactic-sugar><duck-typing>","2","572","2008-11-22 18:34:53"
"317074","Best strategy to get coding prepared for unit testing","<p>I have a solution that is missing a lot of code coverage.  I need to refactor this code to decouple to begin to create unit tests.  What is the best strategy?  I am first thinking that I should push to decouple business logic from data access from businessobjects to first get some organization and then drill down from there.  Since many of the classes don't support single responsible principle, it's hard to begin testing them.</p>

<p>Are there are other suggestions or best practices from taking a legacy solution and getting it into shape to be ready for code coverage and unit testing?</p>
","<c#><unit-testing><refactoring><code-coverage>","4","419","2008-11-25 11:36:02"
"317679","Java: Code Refactoring/Optimization","<p>Please enlighten me:</p>

<p>Which one do you prefer? Why? [Readability? Memory concern? Some other issues?]</p>

<p><strong>1.</strong> </p>

<pre><code>String strSomething1 = someObject.getSomeProperties1();
strSomething1 = doSomeValidation(strSomething1);
String strSomething2 = someObject.getSomeProperties2();
strSomething2 = doSomeValidation(strSomething2);
String strSomeResult = strSomething1 + strSomething2;
someObject.setSomeProperties(strSomeResult);
</code></pre>

<p><strong>2.</strong></p>

<pre><code>someObject.setSomeProperties(doSomeValidation(someObject.getSomeProperties1()) + 
                             doSomeValidation(someObject.getSomeProperties2()));
</code></pre>

<p>If you would do it some other way, what would that be? Why would you do that way?</p>
","<java><optimization><refactoring><coding-style>","2","672","2008-11-25 15:19:27"
"318201","Realign namespace definitions with file structure","<p>Like all developers with OCD I try to organise my namespaces within our project so that they match where the file they are contained within sits of disk.</p>

<p>However after a pretty massive refactoring session within VS.NET I've moved files within projects and created new subfolders a plenty, leaving the refactoring of the namespaces to later believing that there must be a refactoring tool that will accomplish this for me once things have settled down. However I'm now not able to find such a tool!</p>

<p>Does anyone know of anyway to accomplish this automatically (ie. without me painstakingly going through 100s of files or even writing my own tool?).</p>
","<visual-studio><visual-studio-2008><tools><refactoring>","2","112","2008-11-25 17:26:49"
"318641","Multiple QMainWindow instances?","<p>The QMainWindow is the main window in a Qt application. So usually you'd have only one, but would it be possible at all to have multiple QMainWindow instances in your application? </p>

<p>I am working on integrating a Qt-based GUI application B into another Qt-based GUI application A. Both these applications have a QMainWindow, and I was considering as a first step to create a new QMainWindow that has both old QMainWindows on tabs. That way it would allow me to concentrate on wiring the backend of GUI B to the backend of A without having to change anything in the user interface itself. Is this a viable approach, or do you have other suggestions?</p>
","<c++><gui><qt><refactoring>","2","3439","2008-11-25 19:50:37"
"320919","Refactoring ""extreme"" SQL queries","<p>I have a business user who tried his hand at writing his own SQL query for a report of project statistics (e.g. number of tasks, milestones, etc.). The query starts off declaring a temp table of 80+ columns. There are then almost 70 UPDATE statements to the temp table over almost 500 lines of code that each contain their own little set of business rules. It finishes with a SELECT * from the temp table.</p>

<p>Due to time constraints and 'other factors', this was rushed into production and now my team is stuck with supporting it. Performance is appalling, although thanks to some tidy up it's fairly easy to read and understand (although the code smell is nasty).</p>

<p>What are some key areas we should be looking at to make this faster and follow good practice?</p>
","<sql><sql-server-2005><refactoring>","3","877","2008-11-26 14:41:31"
"320946","Replace Temp with Query","<p>The Replace Temp with Query refactoring method is recommended quite widely now but 
seems to be very inefficient for very little gain. </p>

<p>The method from the Martin Fowler's site gives the following example:</p>

<p>Extract the expression into a method. Replace all references to the temp with the expression. The new method can then be used in other methods.</p>

<pre><code>	double basePrice = _quantity * _itemPrice;
	if (basePrice &gt; 1000)
		return basePrice * 0.95;
	else
		return basePrice * 0.98;
</code></pre>

<p>becomes</p>

<pre><code>	if (basePrice() &gt; 1000)
		return basePrice() * 0.95;
	else
		return basePrice() * 0.98;


double basePrice() {
	return _quantity * _itemPrice;
}
</code></pre>

<p>Why is this a good idea? surely it means the calculation is needlessly repeated and you have the overhead of calling a function. I know CPU cycles
are cheap but throwing them away like this seems careless? </p>

<p>Am I missing something?</p>
","<refactoring>","4","304","2008-11-26 14:48:51"
"324825","Need help refactoring a simple jquery animation script","<p>I have a status message box (div box) positioned at the bottom of a web page using position: fixed; and bottom: 0;. Its height is initially 11px.</p>

<p>I want to allow users to double click it when there are more status messages than what can fit within the default hight, make it grow. If they double click it again or move the mouse away from the box, it should shrink again.</p>

<p>I am completely new to javascript and jquery, so bare with me. I manage to get this working exactly as I want, but it seems to me that it should be possible to write this more elegantly:</p>

<pre><code>&lt;script type=""text/javascript""&gt;
    $(document).ready(function() {
        $(""#footer"").dblclick(showStatusBar);
    });     
    function showStatusBar() {
        var footer = $(""#footer"");
        footer.unbind('dblclick', showStatusBar);
        footer.animate({ height: ""100px"" }, 200);
        footer.dblclick(hideStatusBar);
        footer.bind('mouseleave', hideStatusBar);
    }

    function hideStatusBar() {
        var footer = $(""#footer"");
        footer.unbind('mouseleave', hideStatusBar);
        footer.unbind('dblclick', hideStatusBar);
        footer.animate({ height: ""11px"" }, 200);            
        footer.dblclick(showStatusBar);
    }
&lt;/script&gt;
</code></pre>

<p>I played around with the <a href=""http://docs.jquery.com/Events/toggle#fnfn2fn3.2Cfn4.2C..."" rel=""nofollow"">toggle</a> event, but was unable to get it working. Input will be much appreciated.</p>

<p>Best regards, Egil.</p>
","<javascript><jquery><refactoring>","1","458","2008-11-27 23:54:27"
"326387","How to surround a code block with a using statement in ReSharper?","<p>I'm watching Stephen A Bohlen's excellent <a href=""http://www.summerofnhibernate.com/"" rel=""nofollow"">Summer of NHibernate</a> series, and have been watching him interact with CodeRush.  I've recently installed ReSharper (I'm a ReSharper newbie), and I'm trying to find some of the ReSharper productivity equivalents that Stephen is demonstrating (tangentially) with CodeRush.</p>

<p>As an example, he demonstrates highlighting a code block that looks like this:</p>

<pre><code>ISession session = GetSession();
session.xxx
</code></pre>

<p>and then turning it into </p>

<pre><code>using (ISession session = GetSession())
{
   session.xxx
}
</code></pre>

<p>He does this by highlighting the block he wants to <em>surround</em> with the using statement and then invoking some CodeRush template.  I've been unable to figure out how to do the equivalent thing with ReSharper.  I found the ReSharper Surround command (within the Code command), but when you select the <strong>using</strong> statement, it does surround your highlighted code block, but it does not seem <em>smart</em> enough to put the first line within the using clause.  That is, it results in:</p>

<pre><code>using () 
{
  ISession session = GetSession();
  session.xxx
}
</code></pre>

<p>which requires me to move the first line into the using clause.  Am I missing an easier way?</p>
","<visual-studio><visual-studio-2008><refactoring><resharper><coderush>","2","901","2008-11-28 18:29:17"
"323901","How to find duplicate rows in a join text file","<p>I have recently converted 10 JavaScript files into one file, which I then run a JavaScript compiler on. I just had a bug where I had reused a function name.</p>

<p>Is there a tool to check for duplicate rows/function names in the combined file?</p>

<p>Or should I create a little program?</p>
","<javascript><text><refactoring>","0","926","2008-11-27 14:26:51"
"330151","How much logic should you put in the UI class?","<p>I'm not sure if this has been asked or not yet, but how much logic should you put in your UI classes?</p>

<p>When I started programming I used to put all my code behind events on the form which as everyone would know makes it an absolute pain in the butt to test and maintain.  Overtime I have come to release how bad this practice is and have started breaking everything into classes.</p>

<p>Sometimes when refactoring I still have that feeling of ""where should I put this stuff"", but because most of the time the code I'm working on is in the UI layer, has no unit tests and will break in unimaginable places, I usually end up leaving it in the UI layer.</p>

<p>Are there any good rules about how much logic you put in your UI classes?  What patterns should I be looking for so that I don't do this kind of thing in the future?</p>
","<gui><refactoring>","4","358","2008-12-01 06:23:54"
"330220","Strategy for large scale refactoring","<p>I'm currently working in a piece of code where both logic and data access are present in the GUI classes. Obviously, I would like to improve on this situation.</p>

<p>The current current structure is basically:</p>

<ul>
<li>Big ball of mud</li>
</ul>

<p>The ultimate goal is to achieve a DDD-like structure:</p>

<ul>
<li>DAL</li>
<li>Domain model</li>
<li>Service layer</li>
<li>Presentation model</li>
<li>GUI</li>
</ul>

<p>So, how would you attack the problem?</p>

<ul>
<li>Big bang
<ul>
<li>Define the structure for the final state and push code to its ultimate home.</li>
</ul></li>
<li>Divide and conquer
<ul>
<li>Try to separate the big ball of mud in to two pieces. Repeat until done...</li>
</ul></li>
<li>Strangling
<ul>
<li>Strangle the classes (as described in <a href=""http://martinfowler.com/bliki/StranglerApplication.html"" rel=""nofollow"">http://martinfowler.com/bliki/StranglerApplication.html</a>)</li>
</ul></li>
</ul>
","<refactoring><legacy>","13","911","2008-12-01 07:26:11"
"334135","Refactoring a Hibernate entity into subclasses","<p>I have a class that is currently mapped as an entity in a database table using Hibernate. This class should be refactored into an abstract class containing some field common to all of its subclasses.</p>

<p>I'm using annotations for mapping hibernate entities/relationships classes.</p>

<p>I would like suggestions/variants on how to do this refactoring. </p>

<p>Also, some suggestions on how to move the data that is stored in the database (for the future abstract superclass) into one of the concrete subclasses.</p>
","<java><database><hibernate><refactoring>","4","3651","2008-12-02 14:40:17"
"342290","tool for detecting non-parametrized sql in java jdbc code","<p>I'm looking to inspect SQL statements in Java/jdbc code to ensure that the SQL to be executed is of acceptable quality. Neither PMD not Findbugs appears to have JDBC or sql rules. I could use p6spy to log the SQL and look at  that way, but this is manual. </p>

<p>I'm wondering if the strategy of of using PMD/Findbugs/etc to create a rule that any string passed to PreparedStatement where there is an ""="" or ""in"" has only parametrized vars on the compare side.</p>

<p>Has anyone done this? Or done this by other means?</p>
","<sql><jdbc><refactoring><p6spy><parameterization>","1","346","2008-12-04 22:12:45"
"342862","Refactoring a massive function into many files","<p>I've been trying to refactor a ""bit"" of code that I'd previously developed. Basically, the project was my response to not knowing how to use XSLT effectively, so I developed an XML transformation system in PHP. The program reads through the tags of an XML file and does something along these lines to convert it to HTML:</p>

<pre><code>private function getTemplate(...) {
    switch ($nodeName) {
        case ""a"" :
            // code here to generate a link tag
            break;
        case ""box"" :
            // code here to generate the divs and whatnot to create a box
            break;
        case ""ref"" :
            // look up an external reference file and include a bibliography
            break;
        default :
            // do the default thing
    }
}
</code></pre>

<p>That was all working great, except that I ended up with 26 branches to my switch, and that once switch block was over 1000 lines of code. Needless to say, it made maintenance slightly more difficult.</p>

<p>What I've done now is to pull the code of each branch out into its own file (named ""a.php"", ""box.php"", ""ref.php"" ...) and <code>include</code> that file each time:</p>

<pre><code>if (file_exists(""templates/$nodeName.php"")) {
    include ""templates/$nodeName.php"";
} else {
    // do the default thing
}
</code></pre>

<p>Again, this works, but benchmarking it shows that it has slowed down processing times by 50%. I'm assuming that this is because there's now up to 4000 <code>include</code>s being done now.</p>

<p>What I was considering was to put the code for each template into a function, and if the function hasn't been declared then include the file, and then run the function - the only problem with that is that the existing code has been written in the scope of the original function, using <code>$this</code>, etc.</p>

<p>Given that this code is not run in real time (eg: it merely processes the XML into static HTML files which are stored - it's not done on the fly), do you have any advice for me here?</p>
","<php><xml><refactoring><include>","1","282","2008-12-05 03:50:08"
"343654","C data structure to mimic C#'s List<List<int>>?","<p>I am looking to refactor a c# method into a c function in an attempt to gain some speed, and then call the c dll in c# to allow my program to use the functionality.</p>

<p>Currently the c# method takes a list of integers and returns a list of lists of integers.  The method calculated the power set of the integers so an input of 3 ints would produce the following output (at this stage the values of the ints is not important as it is used as an internal weighting value)</p>

<pre><code>1
2
3
1,2
1,3
2,3
1,2,3
</code></pre>

<p>Where each line represents a list of integers.  The output indicates the index (with an offset of 1) of the first list, not the value.  So 1,2 indicates that the element at index 0 and 1 are an element of the power set.</p>

<p>I am unfamiliar with c, so what are my best options for data structures that will allow the c# to access the returned data?</p>

<p>Thanks in advance</p>

<p><strong>Update</strong></p>

<p>Thank you all for your comments so far. Here is a bit of a background to the nature of the problem.</p>

<p>The iterative method for calculating the power set of a set is fairly straight forward.  Two loops and a bit of bit manipulation is all there is to it really.  It just get called..a lot (in fact billions of times if the size of the set is big enough).</p>

<p>My thoughs around using c (c++ as people have pointed out) are that it gives more scope for performance tuning.  A direct port may not offer any increase, but it opens the way for more involved methods to get a bit more speed out of it.  Even a small increase per iteration would equate to a measurable increase.</p>

<p>My idea was to port a direct version and then work to increase it.  And then refactor it over time (with help from everyone here at SO).</p>

<p><strong>Update 2</strong></p>

<p>Another fair point from jalf, I dont have to use list or equivelent.  If there is a better way then I am open to suggestions.  The only reason for the list was that each set of results is not the same size.</p>

<p><strong>The code so far...</strong></p>

<pre><code>public List&lt;List&lt;int&gt;&gt; powerset(List&lt;int&gt; currentGroupList)
{
    _currentGroupList = currentGroupList;
    int max;
    int count;

    //Count the objects in the group
    count = _currentGroupList.Count;
    max = (int)Math.Pow(2, count);

    //outer loop
    for (int i = 0; i &lt; max; i++)
    {
        _currentSet = new List&lt;int&gt;();

        //inner loop
        for (int j = 0; j &lt; count; j++)
        {              
            if ((i &amp; (1 &lt;&lt; j)) == 0)
            {
                _currentSetList.Add(_currentGroupList.ElementAt(j));                          
            }
        }
        outputList.Add(_currentSetList);
    }   
    return outputList;
}
</code></pre>

<p>As you can see, not a lot to it.  It just goes round and round a lot!</p>

<p>I accept that the creating and building of lists may not be the most efficient way, but I need some way of providing the results back in a manageable way.</p>

<p><strong>Update 2</strong></p>

<p>Thanks for all the input and implementation work.  Just to clarify a couple of points raised: I dont need the output to be in 'natural order', and also I am not that interested in the empty set being returned. </p>

<p>hughdbrown's implementation is intesting but i think that i will need to store the results (or at least a subset of them) at some point.  It sounds like memory limitiations will apply long before running time becomes a real issue.
Partly because of this, I think I can get away with using bytes instead of integers, giving more potential storage.</p>

<p>The question really is then:  Have we reached the maximum speed for this calcualtion in C#?  Does the option of unmanaged code provide any more scope.  I know in many respects the answer is futile, as even if we havled the time to run, it would only allow an extra values in the original set.</p>
","<c#><c><data-structures><refactoring>","5","11795","2008-12-05 12:22:47"
"345324","Best way to handle input and state changes for multiple states?","<p>I have an application that has multiple states, with each state responding to input differently.</p>

<p>The initial implementation was done with a big switch statement, which I refactored using the state pattern (at least, I think it's the state pattern.  I'm kind of new to using design patterns, so I tend to get them confused) -</p>

<pre><code>class App {

  public:
    static App * getInstance();
    void addState(int state_id, AppState * state) { _states[state_id] = state; }
    void setCurrentState(int state_id) { _current_state = _states[state_id]; }

  private:
    App()
    ~App();
    std::map&lt;int, AppState *&gt; _states;
    AppState * _current_state;
    static App * _instance;
}

class AppState {

  public:
    virtual void handleInput() = 0;
    virtual ~AppState();

  protected:
    AppState();

}
</code></pre>

<p>Currently, each state is polling the OS for input, and acting accordingly.  This means each concrete state has a huge switch statement with a case for each valid keypress.  Some cases call functions, and other cases issue state changes by using App::setCurrentState(newstate).  The catch is that a key that does something in one state may not do anything (or in rare circumstances, may do something different) in another state.</p>

<p>Okay, I think that's the pertinent background.  Here's the actual question(s) -</p>

<p>First, what's the best way to eliminate the huge switch statements in the concrete states?   <a href=""http://stackoverflow.com/questions/126409/ways-to-eliminate-switch-in-code#126475"">This question</a> suggests the command pattern, but I don't understand how I would use it here.  Can someone  help explain it, or suggest another solution?</p>

<p>As a side note, I've considered (and am not opposed to) the idea of letting the App class do the polling of the OS, and then pass inputs to _current_state->handleInput.  In fact, something tells me that I'll want to do this as part of the refactoring.  I just haven't done it yet.</p>

<p>Second, state changes are made by calling App::setCurrentState(newstate).  I realize that this is akin to using globals, but I'm not sure of a better way to do it.  My main goal is to be able to add states without modifying the App class.  Suggestions would be welcome here as well.</p>
","<design-patterns><refactoring>","1","253","2008-12-05 22:04:35"
"346105","How do I write message queue handling in an object-oriented way?","<p>If you had to write code that takes messages from a message queue and updates a table in a database, how would you go about structuring it in a good oo way. How would you structure it? The messages is XML data, one node per row in the table. The rows in the table could be updated, deleted or inserted.</p>
","<refactoring><messaging><oop>","0","488","2008-12-06 08:52:39"
"355531","Using git/mercurial on projects with continuous refactoring?","<p>I am trying to understand if I really have any case for using git/mercurial.</p>

<p>The projects I work are java and c# projects, usually with 5-20 people working towards
a common goal (the ""release""). Most of the developers are professional developers who 
refactor code <em>all of the time</em>. So where the typical linux kernel has a large number of
relatively independent changes in separate files, we have a constant flux of refactoring changes - 
often hitting  a <em>lot</em> of files and a <em>lot</em> of code. No-one's scared of changing code here.</p>

<p>Now with subversion we solve this by staying extremely close to SVN HEAD. Some of us even have
automated svn up's that trigger on the build server's jabber broadcast. Most of us have also learned 
(or learn really quickly) how to plan our work to stay close to SVN HEAD. If you're doing a major refactoring we 
incrementally bend the source tree in a new direction instead of going away for too long. Sometimes you just plan the 
refactoring operation and start off in the less contended areas.  After some years
of working this way it becomes second nature. Most of us simply never leave the ""comfort zone"" of being less than
2 hours away from svn head. The automated build and svn head is the project ""pulse"" and we like it.</p>

<p>Of course we branch off each release, but the number of backmerges from the release-branch back to trunk dwindle 
down quickly enough to be insignificant (we've got decent test coverage). Running off for days/weeks with private branches of the source sounds
like something we actively want to discourage, and it simply doesn't happen very frequently.</p>

<p>Both git and mercurial sound way cool, git slightly more so since I'm more a McGyver type than a James Bond type. 
But when it comes to building a case for actually switching, it feels like Linus and I are living on two different planets. 
Most of the time we <em>want</em> our teams to stay focused on HEAD. </p>

<p>How can GIT make my version control better ? How would GIT let me improve my process ? Am I a subversion dinosaur ?</p>
","<git><version-control><refactoring>","18","1472","2008-12-10 09:43:11"
"348562","Refactor this nested IF function that is wrapped in a try/catch","<p>I have a messy function that needs refactoring, it has too many nested IF's and it makes me nervous just to look at it!</p>

<p><b>Please ignore what the functions are doing, I'm more concerned with the structure/flow and how it can be refactored so it has less nested IF statements</b></p>

<p>The basic flow is as follows:</p>

<pre><code>public static void HandleUploadedFile(string filename)
{

      try
      {
    	if(IsValidFileFormat(filename)
    	{

    		int folderID = GetFolderIDFromFilename(filename);

    		if(folderID &gt; 0)
    		{

    			if(HasNoViruses(filename)
    			{

    				if(VerifyFileSize(filename)
    				{

    					// file is OK
    					MoveToSafeFolder(filename);

    				}
    				else
    				{
    					DeleteFile(filename);
    				}


    			}
    			else
    			{
    				DeleteFile(filename);
    			}


    		}
    		else
    		{
    			DeleteFile(filename);
    		}



    	}
    	else
    	{
    		DeleteFile(filename);
    	}
      }
      catch (Exception ex)
      {

      }
      finally
      {
    	// do some things
      }


}
</code></pre>
","<refactoring>","3","556","2008-12-08 02:47:15"
"356121","Refactor nested IF statement for clarity","<p>I want to refactor this mumbo jumbo of a method to make it more readible, it has way to many nested IF's for my liking.</p>

<p>How would you refactor this?</p>

<pre><code>public static void HandleUploadedFile(string filename)
{
  try
  {
    if(IsValidFileFormat(filename)
    {
      int folderID = GetFolderIDFromFilename(filename);
      if(folderID &gt; 0)
      {
        if(HasNoViruses(filename)
        {
          if(VerifyFileSize(filename)
          {
            // file is OK
            MoveToSafeFolder(filename);
          }
          else
          {
            DeleteFile(filename);
            LogError(""file size invalid"");
          }
        }
        else
        {
          DeleteFile(filename);
          LogError(""failed virus test"");
        }
      }
      else
      {
        DeleteFile(filename);
        LogError(""invalid folder ID"");
      }
    }
    else
    {
      DeleteFile(filename);
      LogError(""invalid file format"");
    }
  }
  catch (Exception ex)
  {
    LogError(""unknown error"", ex.Message);
  }
  finally
  {
    // do some things
  }
}
</code></pre>
","<refactoring><coding-style>","4","2558","2008-12-10 14:00:32"
"348867","asp.net mvc related, mainly a refactor question","<p>can anyone think of a better way to do this?</p>

<pre><code>	[AcceptVerbs(HttpVerbs.Post)]
	public ActionResult SaveAction()
	{
		NameValueDeserializer value = new NameValueDeserializer();

		// selected messages
		MemberMessageSaveAction[] messages = (MemberMessageSaveAction[])value.Deserialize(Request.Form, ""value"", typeof(MemberMessageSaveAction[]));

		// selected action
		MemberMessageAction action = (MemberMessageAction)Enum.Parse(typeof(MemberMessageAction), Request.Form[""action""]);

		// determine action
		if (action != MemberMessageAction.MarkRead &amp;&amp;
			action != MemberMessageAction.MarkUnRead &amp;&amp;
			action != MemberMessageAction.Delete)
		{
			// selected action requires special processing
			IList&lt;MemberMessage&gt; items = new List&lt;MemberMessage&gt;();

			// add selected messages to list
			for (int i = 0; i &lt; messages.Length; i++)
			{
				foreach (int id in messages[i].Selected)
				{
					items.Add(MessageRepository.FetchByID(id));
				}
			}

			// determine action further
			if (action == MemberMessageAction.MoveToFolder)
			{
				// folders
				IList&lt;MemberMessageFolder&gt; folders = FolderRepository.FetchAll(new MemberMessageFolderCriteria
				{
					MemberID = Identity.ID,
					ExcludedFolder = Request.Form[""folder""]
				});

				if (folders.Total &gt; 0)
				{
					ViewData[""messages""] = items;
					ViewData[""folders""] = folders;

					return View(""move"");
				}

				return Url&lt;MessageController&gt;(c =&gt; c.Index(""inbox"", 1)).Redirect();
			}
			else if (action == MemberMessageAction.ExportXml)
			{
				return new MemberMessageDownload(Identity.ID, items, MemberMessageDownloadType.Xml);
			}
			else if (action == MemberMessageAction.ExportCsv)
			{
				return new MemberMessageDownload(Identity.ID, items, MemberMessageDownloadType.Csv);
			}
			else
			{
				return new MemberMessageDownload(Identity.ID, items, MemberMessageDownloadType.Text);
			}
		}
		else if (action == MemberMessageAction.Delete)
		{
			for (int i = 0; i &lt; messages.Length; i++)
			{
				foreach (int id in messages[i].Selected)
				{
					MemberMessage message = MessageRepository.FetchByID(id);

					if (message.Sender.ID == Identity.ID || message.Receiver.ID == Identity.ID)
					{
						if (message.Sender.ID == Identity.ID)
						{
							message.SenderActive = false;
						}
						else
						{
							message.ReceiverActive = false;
						}

						message.Updated = DateTime.Now;

						MessageRepository.Update(message);

						if (message.SenderActive == false &amp;&amp; message.ReceiverActive == false)
						{
							MessageRepository.Delete(message);
						}
					}
				}
			}
		}
		else
		{
			for (int i = 0; i &lt; messages.Length; i++)
			{
				foreach (int id in messages[i].Selected)
				{
					MemberMessage message = MessageRepository.FetchByID(id);

					if (message.Receiver.ID == Identity.ID)
					{
						if (action == MemberMessageAction.MarkRead)
						{
							message.ReceiverRead = true;
						}
						else
						{
							message.ReceiverRead = false;
						}

						message.Updated = DateTime.Now;

						MessageRepository.Update(message);
					}
				}
			}
		}

		return Url&lt;MessageController&gt;(c =&gt; c.Index(""inbox"", 1)).Redirect();
	}
</code></pre>
","<asp.net-mvc><refactoring>","0","264","2008-12-08 07:46:19"
"349175","Formatting a data structure into a comma-separated list of arguments","<p>I need to convert a list (or a dict) into a comma-separated list for passing to another language.</p>

<p>Is there a nicer way of doing this than:</p>

<pre><code> result = ''
 args = ['a', 'b', 'c', 'd']

 i = 0
 for arg in args:
     if i != 0:    result += arg
     else:         result += arg + ', '
     i += 1

 result = 'function (' + result + ')
</code></pre>

<p>Thanks,
Dan</p>
","<python><refactoring><list>","6","578","2008-12-08 11:00:39"
"349655","Creating mdf file from sql script","<p>I've created a database in Visual Studio 2008 in an App_Data folder of a MVC Web Application project. This results in an mdf file for the database that can be explored in the Server Explorer tab. You can create a SQL script for changes you do to the database.</p>

<p>So I'm wondering how you run these sql change scripts to an mdf-file in Visual Studio 2008? Or am I forced to do this via the SQL Management Studio Express application?</p>
","<sql-server><database><visual-studio><refactoring>","2","3041","2008-12-08 14:10:10"
"357969","Combining CSS properties","<p>I am trying to combine some of my CSS and it is kind of an easy questions but I am kind of having some trouble, i have this code:</p>

<pre><code>h2.post-title, h2.post-title a{
    display:block;
    background-color:#000;
    padding:3px;
    color:#ffffff;
    text-decoration:none;
    text-transform:uppercase;
    font:lighter 130% Georgia, Arial;
}
</code></pre>

<p>Do I need to have both of those selectors there? The only time I will be using the <code>h2.post-title</code> it will be a link. Any suggestions, I tried removing the first one, but it made it HUGE.</p>

<p>Thoughts?</p>
","<css><xhtml><refactoring>","0","950","2008-12-10 23:17:08"
"349852","Best reflection of extract-interface refactoring in subversion","<p>I'm extracting an interface that I would like to retain the original name. The actual class will get a ""Impl"" suffix, in accordance with our naming conventions. I want to know how to best reflect that in subversion so that the history ""AppPropertiesImpl.java"" covers its life as ""AppProperties.java"". As for the new ""AppProperties.java"", I'm thinking it could be either a new file or a copy of the old. Any idea how to pull this off?</p>

<p>Here's what I have now:</p>

<p>AppProperties.java</p>

<pre><code>public class AppProperties {
    public static final CONSTANT_ONE = ""CONSTANT_ONE"";

    private String propertyOne;

    public String getPropertyOne() {
        return propertyOne;
    }

    public String setPropertyOne(String propertyOne) {
        this.propertyOne = propertyOne;
    }
}
</code></pre>

<p>And I want to end up with:</p>

<p>AppProperties.java</p>

<pre><code>public interface AppProperties {
    public static final CONSTANT_ONE = ""CONSTANT_ONE"";
    String getPropertyOne();
    String setPropertyOne(String propertyOne);
}
</code></pre>

<p>AppPropertiesImpl.java</p>

<pre><code>public class AppPropertiesImpl implements AppProperties {
    private String propertyOne;

    public String getPropertyOne() {
        return propertyOne;
    }

    public String setPropertyOne(String propertyOne) {
        this.propertyOne;
    }
}
</code></pre>
","<java><svn><refactoring>","0","294","2008-12-08 15:24:43"
"365387","Refactoring: When do you know it's time and when do you do it?","<p>When do you know it's time to refactor/review some piece of code ? And better yet, when do you do it?</p>

<p>Probably like others, I've found myself knowing that something needs a refactor/review but deadlines and management left no time for that. I'd also like to hear how you include code review in the general development process.</p>

<p>Lately I've found myself doing it before working on new features/code. For example, if I have to develop something new or change something in module X of an application, I do a code review on that module. I found it also helps me understand the module better so I can then make the changes more easily.</p>

<p>So when do you know it's time and when do you do it? And most of all how do you include it in the planning of a project?</p>
","<refactoring><project-planning>","5","341","2008-12-13 16:25:52"
"370353","Response, Result, Reply, which is best?","<p>I'm refactoring some client-server code and it uses the terms Response, Result &amp; Reply for the same thing (an answer from the server). And although its not really that important it's become hard to guess which word to use while writing new code, so I'd like to unify the three terms into one and do the appropriate refactoring, but I'm not sure which word is the ""best"", if there is such a thing.</p>

<p>Any suggestions based on precedence and standards towards naming for this case?</p>
","<refactoring><client-server><terminology>","1","138","2008-12-16 03:02:30"
"379487","Is there a refactoring tool for Eclipse better than the built in one?","<p>I know there is re-sharper for Visual Studio, but is there a really good refactoring tool for Eclipse that is better than the small amount of built in refactors?</p>

<p>Preferably something free.</p>

<p>(Update)</p>

<p>Looking to do things like take all string literals in a file and make them constants.<br />
Solve lots of PMD errors in some automated fashion.</p>
","<eclipse><refactoring>","6","1364","2008-12-18 22:09:40"
"379540","What do you consider before refactoring code?","<p>I've got an application that just shipped.  Since I wrote it, I've learned about amfphp and propel.  Both would be 'nice' to be used in the application but I can't say that it would be required at this point.</p>

<p>What types of things do you consider before you refactor code?</p>
","<propel><refactoring><amfphp>","4","339","2008-12-18 22:26:29"
"380709","help me refactor iteration over a generic collection","<p>I am working with a generic data structure, say <code>MyGeneric&lt;Type&gt;</code>.
There is a case where I have to iterate over all the values it holds </p>

<p>The code I am trying to do.</p>

<pre><code>for ( all the keys in myGeneric ) {
    // do lot of stuff here 
}
</code></pre>

<p>Now the generic can hold base type as double and string and it can hold some user-defined type also. 
There is a particular situation where I have to some specific work depending upon the type of the generic. </p>

<p>so the final code block looks something like this</p>

<pre><code>for( all the keys in myGeneric ) {
    if key is type foo then 
    	//do foo foo 
    else if key is of type bar 
    	//do bar bar 
}
</code></pre>

<p>Now, as complexity sensitive as I am I do not like to have an if condition in the for loop. 
So the next solution I did was </p>

<pre><code>if myGeneric is of type foo 
    call fooIterator(myGeneric) 
if myGenric is of type bar 
    call barItetrator(myGeneric)


function FooIterator() {
    // .....
    // foo work 
    //......
}

function BarItetrator() {
    // .....
    // bar work 
    //......
}
</code></pre>

<p>Then again when somebody sees my code then I am quite sure that they will shout where is the ""refactoring"".</p>

<p>What is the ideal thing to do in this situation ?</p>

<p>Thanks.</p>
","<c#><refactoring><generics>","2","160","2008-12-19 11:18:21"
"380885","Can you simplify this algorithm?","<p>One for the mathematicians. This has gone around the office and we want to see who can come up with a better optimised version.</p>

<pre><code>(((a+p) &lt;= b) &amp;&amp; (a == 0 || a &gt; 1) &amp;&amp; (b &gt;= p)) &amp;&amp; 
    ((b - (a + p) == 0) || (b - (a + p) &gt; 1))
</code></pre>

<p><strong>Edit</strong>: all data is positive int's</p>

<p><strong>Edit</strong>: Better == refactored for simplicity</p>
","<algorithm><refactoring>","24","2514","2008-12-19 12:52:19"
"384291","Code refactoring help - how to reorganize validations","<p>We have a web application that takes user inputs or database lookups to form some operations against some physical resources. The design can be simply presented as following diagram:</p>

<p>user input &lt;=> model object &lt;=> database storage</p>

<p>validations are needed with request coming from user input but NOT when coming from database lookup hits (since if a record exists, those attributes must have already been validated before). I am trying to refactoring the code so that the validations happen in the object constructor instead of the old way (a separate few validation routines)</p>

<p>How would you decide which way is better? (The fundamental difference of method 1 (the old way) and 2 is that validations in 1 are not mandatory and decoupled from object instantiation but 2 binds them and makes them mandatory for all requests)</p>

<p>Here are two example code snippets for design 1 and 2:</p>

<p>Method 1:</p>

<pre><code># For processing single request.
# Steps: 1. Validate all incoming data. 2. instantiate the object.
ValidateAttribures(request) # raise Exceptions if failed
resource = Resource(**request)
</code></pre>

<p>Method 2:</p>

<pre><code># Have to extract out this since it does not have anything to do with
# the object.
# raise Exceptions if some required params missing.
# steps: 1. Check whether its a batching request. 2. instantiate the object.
#           (validations are performed inside the constructor)
CheckIfBatchRequest(request) 
resource = Resource(**request) # raise Exceptions when validations failed
</code></pre>

<p>In a batch request:
Method 1:</p>

<pre><code># steps: 1. validate each request and return error to the client if any found.
#        2. perform the object instantiate and creation process. Exceptions are
#           captured.
#        3. when all finished, email out any errors.
for request in batch_requests:
    try:    
        ValidateAttribute(request)
    except SomeException, e:
        return ErrorPage(e)
errors = []
for request in batch_requests:
    try:
        CreatResource(Resource(**request), request)
    except CreationError, e:
        errors.append('failed to create with error: %s', e)
email(errors)
</code></pre>

<p>Method 2:</p>

<pre><code># steps: 1. validate batch job related data from the request.
#        2. If success, create objects for each request and do the validations.
#        3. If exception, return error found, otherwise, 
#           return a list of pairs with (object, request)
#        4. Do the creation process and email out any errors if encountered.
CheckIfBatchRequest(request)
request_objects = []
for request in batch_requests:
    try:
        resource = Resource(**request)
    except SomeException, e:
        return ErrorPage(e)
    request_objects.append((resource, request))
email(CreateResource(request_objects)) # the CreateResource will also need to be refactored.
</code></pre>

<p>Pros and Cons as I can see here are:</p>

<ol>
<li>Method 1 follows more close to the business logic. No redundant validations check when objects come from db lookup. The validation routines are better maintainable and read.</li>
<li>Method 2 makes easy and clean for the caller. Validations are mandatory even if from db lookup. Validations are less maintainable and read.</li>
</ol>
","<python><django><optimization><refactoring><web-applications>","0","272","2008-12-21 09:40:28"
"390289","What types of coding anti-patterns do you always refactor when you cross them?","<p>I just refactored some code that was in a different section of the class I was working on because it was a series of nested conditional operators (?:) that was made a ton clearer by a fairly simple switch statement  (C#). </p>

<p>When will you touch code that isn't directly what you are working on to make it more clear? </p>
","<refactoring><anti-patterns>","6","915","2008-12-23 22:48:02"
"388173","Tidier way of trying to import a module from multiple locations?","<p>Is there a way to tidy-up the following code, rather than a series of nested try/except statements?</p>

<pre><code>try:
    import simplejson as json
except ImportError:
    try:
        import json
    except ImportError:
        try:
            from django.utils import simplejson as json
        except:
            raise ""Requires either simplejson, Python 2.6 or django.utils!""
</code></pre>
","<python><refactoring><import>","7","307","2008-12-23 04:25:09"
"390834","How can I help junior members gain confidence in their ability to refactor code?","<p>I wanted to see what folks thought were the best way to help junior members gain confidence in their ability to refactor code.  I find that often junior developers simply follow the existing patterns and sense an aversion to break anything due to the perceived risk.  I am trying to get them to look at the requirements (new and existing) and have the code map onto the domain model versus ""tweaking"" or ""bending"" the existing code base to support new functionality.  Just wanted to see if there were any folks who have success here.  We are currently thinking about pushing more pair programming, TDD, code reviews etc., but wanted to check if there were other success stories...</p>
","<c#><refactoring>","8","394","2008-12-24 05:39:12"
"391033","How can I cut a large Rails application into smaller applications that work together?","<p>I have worked a bit with Django and I quite like its project/applications model : you can build a Django project by assembling one or more Django applications.  These applications can be autonomous, or some applications can be built on top of other applications.  An application can easily rely on another application's models, as well as its controllers (Django dudes call them ""views"") and even its views (""templates"" in Django-speak).</p>

<p>I am now working on a relatively large scale Ruby on Rails project, and I am surprised to see that there is apparently no easy way to do the same thing in Rails.  Basically, in Rails, one project = one application.  Our project has started off as a huge monolithic app, and we are now trying to figure out how to split it into smaller chunks.</p>

<p>For example, our current application allows us to manage partners and contracts (among other things).  I would like to have a ""Partners"" application which would manage our partners (address, contacts, etc.) and a ""Contracts"" application which would manage our contracts with our partners.  The ""Contracts"" application would rely on the ""Partners"" application (but to avoid a circular dependency, I would like the ""Partners"" app to have no knowledge of the ""Contracts"" app).</p>

<p>For now, I see the following as the main options:</p>

<ol>
<li>make these applications communicate through REST requests (each app would act as a Webservice): this is nice, but it seems to prohibit reusing other applications' views.  For example, if the ""Partners"" app has a nice page to show the details of a partner, and if I want to display that page, slightly modified, in the middle of the contract-details page, I see no other way to do this than to have the ""Contracts"" app ask the ""Partners"" app for the partner details through a REST request (it will get an object representation, not a view), then copy/paste the partner-details page's source code from the ""Partners"" app to the ""Contracts"" app.</li>
<li>turn these applications into plugins : not as nice, and a bit more difficult, but seems to allow model &amp; views reuse</li>
<li>use svn external to share some models from application to application: simple but ugly.</li>
</ol>

<p>Thanks for your advices.</p>
","<ruby-on-rails><deployment><refactoring><code-reuse><application>","7","657","2008-12-24 08:44:54"
"392201","Refactoring To Remove Static Methods Code Smell","<p>I have the current basic structure for each domain object that I need to create:</p>

<pre><code>class Model_Company extends LP_Model
{   
    protected static $_gatewayName = 'Model_Table_Company';
    protected static $_gateway;
    protected static $_class;

    public static function init()
    {
    	if(self::$_gateway == null)
    	{
    		self::$_gateway = new self::$_gatewayName();
    		self::$_class = get_class();
    	}
    }

    public static function get() 
    {
    	self::init();

    	$param = func_get_arg(0);

    	if($param instanceof Zend_Db_Table_Row_Abstract)
    	{
    		$row = $param;
    	}
    	elseif(is_numeric($param))
    	{
    		$row = self::$_gateway-&gt;find($param)-&gt;current();
    	}

    	return new self::$_class($row);
    }

    public static function getCollection()
    {
    	self::init();

    	$param = func_get_arg(0);

    	if($param instanceof Zend_Db_Table_Rowset_Abstract)
    	{
    		$rowset = $param;
    	}
    	elseif(!$param)
    	{
    		$rowset = self::$_gateway-&gt;fetchAll();
    	}

    	$array = array ();		

    	foreach ($rowset as $row)
    	{
    		$array[] = new self::$_class($row);
    	}

    	return $array;
    }
}
</code></pre>

<p>I initially tried to refactor the static methods into the parent LP_Model class only to learn finally what ""late static binding"" means in the php world. </p>

<p>I'm just wondering if anyone has suggestions on how to refactor this code so that I don't have to redeclare the same three functions in every domain object that I create?</p>
","<php><zend-framework><php5><refactoring><static-methods>","3","964","2008-12-24 20:47:02"
"404717","Is Refactoring by Compilation Errors Bad?","<p>I have been used to do some refactorings by introducing compilation errors. For example, if I want to remove a field from my class and make it a parameter to some methods, I usually remove the field first, which causes a compilation error for the class. Then I would introduce the parameter to my methods, which would break callers. And so on. This usually gave me a sense of security. I haven't actually read any books (yet) about refactoring, but I used to think this is a relatively safe way of doing it. But I wonder, is it really safe? Or is it a bad way of doing things?</p>
","<refactoring><compiler-errors>","9","669","2009-01-01 08:27:38"
"405095","ReSharper-like addon for the Flash IDE?","<p>Sometimes its necessary to code in AS2 to target Flash Player 8, so we're forced to write within the Flash IDE.</p>

<p>Any refactoring tools / plugins available for Actionscript?... 
<em>Within or without the Flash IDE, that's no problem, as long as it builds for Flash Player 8, AS2.</em></p>
","<flash><refactoring><actionscript-2>","0","272","2009-01-01 16:15:01"
"406446","Refactoring Fibonacci Algorithm","<p>I haven't used a statically typed language in many years and have set myself the task of getting up to speed with C#. I'm using my usual trick of following the fifteen exercises here <a href=""http://www.jobsnake.com/seek/articles/index.cgi?openarticle&amp;8533"" rel=""nofollow"">http://www.jobsnake.com/seek/articles/index.cgi?openarticle&amp;8533</a> as my first task.</p>

<p>I've just finished the second Fibonacci task which didn't take to long and works just fine but in my opinion looks ugly and I'm sure could be achieved in far fewer lines of more elegant code.</p>

<p>I usually like to learn by pair programming with someone who already knows what they're doing, but that option isn't open to me today, so I'm hoping posting here will be the next best thing.</p>

<p>So to all the C# Jedi's out there, if you were going to refactor the code below, what would it look like?</p>

<pre><code>using System;
using System.Collections;

namespace Exercises
{
	class MainClass
	{
		public static void Main(string[] args)
		{
			Console.WriteLine(""Find all fibinacci numbers between:"");
			int from = Convert.ToInt32(Console.ReadLine());
			Console.WriteLine(""And:"");
			int to = Convert.ToInt32(Console.ReadLine());
			Fibonacci fibonacci = new Fibonacci();
			fibonacci.PrintArrayList(fibonacci.Between(from, to));

		}
	}

	class Fibonacci
	{	
		public ArrayList Between(int from, int to)
		{				
			int last = 1;
			int penultimate = 0;
			ArrayList results = new ArrayList();
			results.Add(penultimate);
			results.Add(last);

			while(last&lt;to)
			{
				int fib = last + penultimate;
				penultimate = last;
				last = fib;
				if (fib&gt;from &amp;&amp; fib&lt;to) results.Add(fib.ToString());
			}
			return results;
		}

		public void PrintArrayList(ArrayList arrayList)
		{
			Console.WriteLine(""Your Fibonacci sequence:"");
			Console.Write(arrayList[0]);
			for(int i = 1; i&lt;arrayList.Count; i++)
			{
				Console.Write("","" + arrayList[i]);
			}
			Console.WriteLine("""");
		}

	}
}
</code></pre>

<p>Regards,</p>

<p>Chris</p>
","<c#><refactoring>","8","1851","2009-01-02 10:19:56"
"408530","C#: Refactoring a Reynolds number calculator","<p>I'm trying to learn some C# over the weekend and am following the 15 exercises found here: <a href=""http://www.jobsnake.com/seek/articles/index.cgi?openarticle&amp;8533"" rel=""nofollow"">http://www.jobsnake.com/seek/articles/index.cgi?openarticle&amp;8533</a></p>

<p>Yesterday I asked a similar question for the Fibonacci sequence and received some great responses which introduced me to elements of C# which I'd not encountered before: 
<a href=""http://stackoverflow.com/questions/406446/refactoring-fibonacci-algorithm"">http://stackoverflow.com/questions/406446/refactoring-fibonacci-algorithm</a></p>

<p>Today I would like to see how a C# Jedi would refactor the following code:</p>

<pre><code>static string Reynolds(int d, int v, int rho, int mu)
{
	int number = (d*v*rho) / mu;
	if (number &lt; 2100) return ""Laminar Flow"";
	else if (number &lt; 2100 &amp;&amp; number &lt; 4000) return ""Transient Flow"";
	else return ""Turbulent Flow"";
}
</code></pre>

<p>So more simple than yesterday, but is there any nice way to deal with the multiple conditionals?</p>

<p>Regards,</p>

<p>Chris</p>
","<c#><refactoring>","1","429","2009-01-03 03:01:33"
"410532","What's the best alternative to an out of control switch statement?","<p>I have inherited a project that has some huge switch statement blocks, some with 20 cases, what is a good way to rewrite these?</p>
","<c#><javascript><refactoring><switch-statement>","3","2070","2009-01-04 06:00:37"
"411547","Code Generator vs Code Refactoring","<p>How do you like your CRUD programs.  Code-generated, framework-driven, or manually written?</p>
","<refactoring>","3","524","2009-01-04 19:37:42"
"413292","Detecting Java Project Cruft","<p>I'm a NetBeans 6.5 user and am searching for a way of generating a list of methods/classes that are not used within a set project group.</p>

<p>I know I can right click on each method and select ""Find Usages"" but I'm looking for an automation to that process.</p>

<p>I'm willing to look at something that runs outside of netbeans, as long as it generates a list of cruft methods/classes.</p>

<p>Thanks.</p>
","<java><netbeans><refactoring>","8","399","2009-01-05 14:39:37"
"415240",".NET Class Refactoring Dilemma","<p>So I'm refactoring a legacy codebase I've inherited, and in the process I found a static class that encapsulates the logic for launching 3rd party applications. It essentially looks like this (shortened for brevity to only show one application):</p>

<pre><code>using System.IO;
using System.Configuration;
public static class ExternalApplications
{

   public string App1Path
   {
      get
      {
         if(null == thisApp1Path)
            thisApp1Path = Configuration.AppSettings.Get(""App1Path"");
         return thisApp1Path;
      }
   }
   private string thisApp1Path = null;

   public bool App1Exists() 
   {
      if(string.IsNullOrEmpty(App1Path))
         throw new ConfigurationException(""App1Path not specified."");
      return File.Exists(App1Path);
   }

   public void ExecuteApp1(string args) 
   {
       // Code to launch the application.
   }

}
</code></pre>

<p>It's a nice attempt to separate the external applications from the rest of the code, but it occurs to me that this could have been refactored further. What I have in mind is something like this:</p>

<pre><code>using System.IO;
public abstract class ExternalApplicationBase
{

   protected ExternalApplicationBase()
   {
      InitializeFromConfiguration();
   }

   public string Path { get; protected set; }

   public bool Exists() 
   {
      if(string.IsNullOrEmpty(this.Path))
         throw new ConfigurationException(""Path not specified."");
      return File.Exists(this.Path);
   }

   public virtual void Execute(string args)
   {
      // Implementation to launch the application
   } 

   protected abstract InitializeFromConfiguration();

}

public class App1 : ExternalApplicationBase
{

   protected virtual void InitializeFromConfiguration()
   {
      // Implementation to initialize this application from
      // the application's configuration file.
   }

 }

 public class App2 : ExternalApplicationBase
 {

   protected virtual void InitializeFromConfiguration()
   {
      // Implementation to initialize this application from
      // the application's configuration file.
   }

 }
</code></pre>

<p>My concerns are as follows:</p>

<ol>
<li><p>A class, interface, or other construct may already exist that does this, and I just haven't stumbled across it.</p></li>
<li><p>It may be overkill for what I want to do. Note, however, that the application uses at least three separate 3rd party applications that I have identified so far (and more are almost certain to pop up). </p></li>
<li><p>I'm not entirely comfortable with the name of the base class. It seems fuzzy, and not very informative (but I couldn't think of much better, given that Application is already well defined, reserved by the Framework, and would create a gross level of confusion were I to use it).</p></li>
<li><p>The idea is that I want to be able to keep the application configuration data (it's path and executable name) in the App.Config file, and check for its existence when my application starts up; when my software needs to launch the software, I want to do it through a single method call, and not have the code building command lines and trying to launch the software manually (as it currently does).</p></li>
</ol>

<p>So I'm sending out a request for help, guidance, and suggestions. Anything you can profer is greatly appreciated.</p>

<p>P.S. I'm asking this here because I work, as I frequently do, as a sole developer at my firm; I don't have anyone else to bounce these ideas off of. You guys have tons of experience with this stuff, and it would be foolish of me not to ask for your advice, so I hope you'll all bear with me. Thanks in advance!</p>
","<c#><.net><oop><refactoring>","3","231","2009-01-06 02:32:00"
"416345","is f(void) deprecated in modern C and C++","<p>I'm currently refactoring/tidying up some old C code used in a C++ project, and regularly see functions such as </p>

<pre><code>int f(void)
</code></pre>

<p>which I would tend to write a </p>

<pre><code>int f()
</code></pre>

<p>Is there any reason not to replace (void) with () throughout the codebase in order to improve consistency, or is there a subtle difference between the two that I am unaware of?  More specifically, if a virtual member function in C++ is described a </p>

<pre><code>virtual int f(void)
</code></pre>

<p>and a derived class includes a member function</p>

<pre><code>int f()
</code></pre>

<p>is this a valid override?  Additionally, am I likely to encounter any linker problems based on almost identical signatures?</p>
","<c++><c><refactoring><void>","25","2504","2009-01-06 12:34:40"
"421902","Any free/open source refactoring tools?","<p>Being that I'm a programmer, and <a href=""http://en.wikipedia.org/wiki/Larry_Wall#Virtues_of_a_programmer"">programmers are lazy</a>, I'm looking for a tool that can help me analyze code and refactor, decomposing conditionals mostly. I know that <a href=""http://stackoverflow.com/questions/6126/how-do-you-handle-huge-if-conditions"">products like Resharper and Refactor Pro! can do this</a>, but I was curious about FOSS alternatives.</p>

<p>A Google search turned this <a href=""http://www.aivosto.com/visustin.html"">nifty tool</a> that creates flowcharts, has anyone ever heard of any others like this?</p>

<p>Also, it would be nice if it could handle C#/VB.NET, but if not any ol' C-like language is good.</p>
","<open-source><tools><refactoring>","6","2537","2009-01-07 20:16:35"
"422745","Does any tool similar to NDepend exist for unmanaged C++ code?","<p>I have enjoyed the power of NDepend ( <a href=""http://www.ndepend.com/"" rel=""nofollow"">http://www.ndepend.com/</a> ) when writing C#, but in my C++ projects I have not found a comparable tool.</p>

<p>I use Visual Studio 2005, which has a class-view that covers some bases, but it is not powerful enough and doesn't work across project boundaries. I use Visual Assist X, which has some powerful refactoring tools, but it doesn't provide any sort of introspection facilities for code analysis. I understand that Visual Studio macros may be able to access the code tree, so perhaps a tool could be constructed from them, but this is really not something that sounds like what I want.</p>

<p>Any good tools that come close to NDepend for native C++ code?</p>
","<c++><tools><refactoring><code-review><ndepend>","4","1137","2009-01-08 00:21:45"
"422989","How would you refactor page members out of ASPX code?","<p>I have inherited a project that uses the following pattern for passing parameters from the code behind to the aspx page. I know this is wrong, but I am on the fence on the best way to refactor it.</p>

<p>Code Behind:</p>

<pre><code>using System;
using System.Web;

namespace BadPassing
{
    public partial class _Default : System.Web.UI.Page
    {
        private Random rnd = new Random(); //Is this bad?

        protected int numberOne; //this is bad
        protected int numberTwo; //this is bad

        protected void Page_Load(object sender, EventArgs e)
        {
            numberOne = rnd.Next(100);
            numberTwo = rnd.Next(100);
        }
    }
}
</code></pre>

<p>ASPX Page:</p>

<pre><code>&lt;%@ Page Language=""C#"" AutoEventWireup=""true"" CodeBehind=""Default.aspx.cs"" Inherits=""BadPassing._Default"" %&gt;

&lt;!DOCTYPE html PUBLIC ""-//W3C//DTD XHTML 1.0 Transitional//EN"" ""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd""&gt;

&lt;html xmlns=""http://www.w3.org/1999/xhtml"" &gt;
&lt;head runat=""server""&gt;
    &lt;title&gt;Bad Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id=""form1"" runat=""server""&gt;
    &lt;div&gt;
        &lt;a href=""http://www.google.com/search?q=&lt;%=this.numberOne %&gt;%2B&lt;%=this.numberTwo %&gt;""&gt;
            Add &lt;%=this.numberOne %&gt; and &lt;%=this.numberTwo %&gt; using google.
        &lt;/a&gt;
    &lt;/div&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>My understanding is that the numberOne and numberTwo are not thread-safe, and could cause incorrect behavior if two people loaded the page at the same time. Furthermore, if the page relied on numberOne and numberTwo to store values between postbacks, multiple simultaneous users would cause unexpected results.</p>

<p>Is my understanding of why this the above technique is so bad correct, and if so, how would you best refactor this code?</p>

<p>On a side note, is it incorrect to store stateless page-level services (like Random) as member variables of the page class?</p>
","<asp.net><refactoring>","0","193","2009-01-08 02:06:21"
"428183","Is this control of flow structure good practice?","<p>I want to re-write a method that has way too many nested <code>if</code> statements.</p>

<p>I came up with this approach and wanted your opinions:</p>

<pre><code>public void MyMethod()
{
   bool hasFailed = false;

   try
   {
      GetNewOrders(out hasFailed);

      if(!hasFailed)
          CheckInventory(out hasFailed);

      if(!hasFailed)
          PreOrder(out hasFailed);              

      // etc
   }
   catch(Exception ex)
   {
   }
   finally
   {
      if(hasFailed)
      {
           // do something
      }
   }
}
</code></pre>
","<refactoring><control-flow>","2","379","2009-01-09 14:15:58"
"428262","Help refactor this messed-up-nested-if of a method","<p>Ok I want some opinions how I can fix this mess of a method!</p>

<p>It has WAY to many nested 'if' statements.</p>

<p>But realize I have to know exactly where the method fails, currently in each of the respective 'else' clause I am logging the error (the failed 'if' condition').</p>

<p><b>Note: ignore any logic behind the things, please focus on the style and structure as I have made all the function names up etc.</b></p>

<p>Here is the skeleton structure:</p>

<pre><code>   public void MyMethod()
{

   try
   {
    bool tryAgain = false;

    string filename = DownloadFile();

    if( IsFileFormatOk(filename) )
    {

    	blah = GetBlah(filename);

    	if(blah.ID &gt; 0)
    	{

    		if(ImportFile(filename)
    		{

    			string username = GetUserFromFile(filename);

    			if(isValidUser(username))
    			{

    				// few more levels to go
    				//
    				//
    				//

    			}
    			else
    			{
    				LogError(filename, ...); // specific to this if statement
    				tryAgain = true;
    			}


    		}
    		else
    		{

    			LogError(filename, ...); // specific to this if statement
    			tryAgain = true;
    		}

    	}
    	else
    	{
    		LogError(filename, ...); // specific to this if statement
    		tryAgain = true;
    	}

    }
    else
    {
    	LogError(filename, ...); // specific to this if statement
    	tryAgain = true;
    }

   }
   catch
   {
   }
   finally
   {
    if(tryAgain)
    {
    	// blah
    }
   }


}
</code></pre>
","<refactoring><nested-if>","3","471","2009-01-09 14:38:00"
"432982","Is it feasible to convert a desktop based MFC C++ application to a web app","<p>I have a very large app, 1.5 million lines of C++, which is currently MFC based using the Document/View architecture.  The application includes a lot of 3d vector graphics, spreadsheets, and very many dialogs and Windows.  Within the constraints of the DVA it is fairly well written, in that there is no significant program logic in the user interface, and anything that can be done using the user interface can also be carried out programmatically using a COM/OLE Automation interface.</p>

<p>At the request of a number of users, I have been toying with the idea of creating a browser interface to the program, where the program itself runs on a server.  Thoughts so far are convert all the COM interfaces to DCOM and rewrite/port the UI to Java.  Initial experimentation shows that this will be a huge amount of work.</p>

<p>Anyone else out there got any ideas for an easier implmentation?  Anyone come across any refactoring or similar tools specifically to help this kind of a port?</p>
","<c++><web-development><mfc><refactoring>","3","2361","2009-01-11 14:07:41"
"424709","Using join points call(* *.*(..)), can I expose the arguments to the advice if available?","<p>With my aspect, I track the changes on certain collections by advising certain method calls on instances of <code>java.util.Set</code>, notably <code>add(Object)</code> and <code>remove(Object)</code>. Since the changes are not reflected in the collection itself, invocations of <code>Set.contains(Object)</code> or <code>Set.size()</code> return wrong results.</p>

<p>Therefore I want to intercept all method calls to instances of Set (except <code>add</code> and <code>remove</code>), and forward the calls to my up-to-date collection.</p>

<p>Of course I could define two advices, using different pointcuts, something like this:</p>

<pre><code>// matches Collection.size(), Collection.isEmpty(), ...
* around(Collection c) : call(* Collection.*()) &amp;&amp; target(c)
			&amp;&amp; !remove(/*...*/) &amp;&amp; !add(/*...*/) {
	if (notApplicable())
		return proceed(c);

	return proceed(getUpToDateCollection());
}

// matches Collection.contains(Object), ...
* around(Collection c, Object arg) : call(* Collection.*(*)) &amp;&amp; target(c) &amp;&amp; args(arg) 
			&amp;&amp; !remove(/*...*/) &amp;&amp; !add(/*...*/) {
	if (notApplicable())
		return proceed(c, arg);

	return proceed(getUpToDateCollection(), arg);
}
</code></pre>

<p>It works, but it's pretty ugly, the bodies of my advices being quite analogous. So I would like to ""combine"" them; effectively having a single advice that be woven for both pointcuts, much like this:</p>

<pre><code>* around(Object[] args): call(* Collection.*(..)) &amp;&amp; args(arr) {...}`
</code></pre>

<p>Is this possible at all? I have the feeling it's not, because in one of the pointcuts I expose the argument (and subsequently use it in the advice) and in the other there is no argument, so it seems impossible to bind the ""potential identifier"" in the enclosing advice... But I'm hoping that I've overlooked something and you might be able to point me in the right direction. Thanks!</p>
","<refactoring><aspectj><pointcuts>","0","117","2009-01-08 15:40:27"
"439574","What's the best way to refactor a method that has too many (6+) parameters?","<p>Occasionally I come across methods with an uncomfortable number of parameters.  More often than not, they seem to be constructors.  It seems like there ought to be a better way, but I can't see what it is.  </p>

<pre><code>return new Shniz(foo, bar, baz, quux, fred, wilma, barney, dino, donkey)
</code></pre>

<p>I've thought of using structs to represent the list of parameters, but that just seems to shift the problem from one place to another, and create another type in the process.</p>

<pre><code>ShnizArgs args = new ShnizArgs(foo, bar, baz, quux, fred, wilma, barney, dino, donkey)
return new Shniz(args);
</code></pre>

<p>So that doesn't seem like an improvement.  So what is the best approach?</p>
","<refactoring>","21","3236","2009-01-13 16:07:40"
"443912","What database tests should I write so that refactoring database is easy","<p>Are there any guidelines on writing database tests so that you can refactor database ""without fear"" while doing evolutionary database design?</p>

<p>What aspects of database should be put to test while developing it? Any example would be great.. </p>
","<database><refactoring><agile>","3","138","2009-01-14 17:28:33"
"446221","Is there any pattern or refactoring trick to split Enum and DBDictionary data duplicate","<p>We have a smelly code in our project. A lot of values which used in biz logic have 2 places where they stored:
we have dictionary tables (used in FK relations) in DB where we stored values e.x. 
MessageDirectionInfo:</p>

<p>0|Unknown</p>

<p>1|In</p>

<p>2|Out</p>

<p>and we have Enum with exactly same data:
MessageDirectionEnum{Unknown=0,In=1,Out=2}
And all over the code we have a lot of ""switch"" and ""if"" where enum used for conditional logic. But when we saving to DB - we should ""convert"" (which actually ""blind select"", case its selecting exact same data except result object type) Enum value to Dictionary class instance. I can understand that Enums is used to clear code logic and DB data used to reference in foreign keys, but actually i dont like this.</p>

<p>Is there any pattern to remove such behaviour or any way to clear some of this ""smelly way"" ?  Or maybe I'm just blind and this is the only clear way to get both benefits - DB FKs and clearer code logic with enums</p>
","<database><design-patterns><refactoring><enums>","3","296","2009-01-15 10:07:21"
"449145","CSS Refactoring tool?","<p>Does anyone know of CSS refactoring tools? Ideally, I would load all of my CSS and have the tool intelligently remove redundant declarations, merge classes, etc, without completely munging it all.</p>

<p><strong>Edit ~3 years later</strong>
I eventually ended up writing a tool to do this. Helium CSS, <a href=""https://github.com/geuis/helium-css"" rel=""nofollow"">https://github.com/geuis/helium-css</a>.</p>

<p>Its entirely written in javascript and runs cross-browser. See the readme for directions.</p>

<p>I got very frustrated trying to get any of the old solutions mentioned in the answers to either work, or work well. So I fixed the problem.</p>
","<css><refactoring>","20","3233","2009-01-16 00:55:58"
"453981","Do you refactor in small steps?","<p>Having read Fowler's ""Refactoring"" for a while, I still often catch myself thinking ""I should have done this in smaller steps."" -- even when I did not broke my code.</p>

<p>Refactoring in small steps is safe, but cost time. It's a trade off between speed and risk -- I try to be strategic in choosing the way how I am refactoring.</p>

<p>Nevertheless: Most the time I am doing refactorings in larger steps. If I took some of Fowler's ""Mechanics"" section and compare how I am working, I maybe find that I often leap two or five steps forward at once. This does not mean that I am a refactoring guru. My code maybe stay for 5 - 60 minutes broken or uncompilable.</p>

<p>Do you refactor in smaller steps and try to produce unbroken code in shorter frequencies? And: Are you successful in doing this?</p>
","<coding-style><refactoring>","5","318","2009-01-17 20:34:02"
"455271","How do you stop yourself from refactoring working but awful code?","<p>I have this problem.  I can't stop myself from refactoring existing code that works but is, in my opinion (and perhaps objectively), badly designed or contains other ""code smells"".  This can have a significant negative effect on my immediate productivity.  But ultimately will be a big maintenance boon.</p>

<p>If you also suffer from this ""affliction"", how do you restrain yourself?  Or at least manage the refactoring to avoid having to alter large chunks of existing code in order to make it maintainable for the long term.</p>
","<refactoring>","87","3249","2009-01-18 15:03:32"
"458253","unit testing, refactoring, IO","<p>You have a method on a class that has 2 parameters, one of which is a file path, the other is irrelevant.</p>

<pre><code>InterestingResult result = foo.Bar(irrelevant, filePathInfo);
</code></pre>

<p>In the spirit of having fast snappy unit tests, you find yourself considering refactoring this method to pull out the file path to remove the IO requirements of this test...most likely putting it into another method, so that now you would call </p>

<pre><code>string dataInFile = foo.GetDataInFile(filePathInfo);
InterestingResult result = foo.Bar(irrelevant, dataInFile);
</code></pre>

<p>Are you crazy?...or was this a good thing?</p>
","<c#><unit-testing><refactoring>","2","474","2009-01-19 16:42:10"
"461475","Code Smell? - Adjusting variables with +- 1","<p>I just wrote this method:</p>

<pre><code>private String getNameOfFileFrom(String path)
{
	int indexOfLastSeparator = path.lastIndexOf('/');
	if (indexOfLastSeparator &gt; -1)
	{
		return path.substring(indexOfLastSeparator + 1);
	}
	else
	{
		return path;
	}
}
</code></pre>

<p>The line that bothers me is:</p>

<pre><code>return path.substring(indexOfLastSeparator + 1);
</code></pre>

<p>Is that a bad practice to modify the expression inline like that? Suggestions on how to refactor to increase readability would be most welcome.</p>

<p>----Edit----
OK update after comments. Thanks everyone for answering :)
I am not looking to actually change the the value of the variable at all just the expression it is used it.</p>

<p>Another posted suggested I could break out that part of the expression as in the second code snippet below. Better/worse/no difference? :) I am starting to suspect I am being overly cautios here.</p>

<pre><code>return path.substring(indexOfLastSeparator + 1);
</code></pre>

<p>or</p>

<pre><code>int indexOfFirstCharInFileName = indexOfLastSeparator + 1;
return path.substring(indexOfFirstCharInFileName);
</code></pre>
","<language-agnostic><refactoring><code-smell>","4","673","2009-01-20 14:20:01"
"463593","Starting UnitTesting on a LARGE project","<p>Can anyone recommend some best-practices on how to tackle the problem of starting to UnitTest a large existing CodeBase?
The problems that I'm currently facing include:</p>

<ul>
<li>HUGE code base</li>
<li>ZERO existing UnitTests</li>
<li>High coupling between classes</li>
<li>Complex OM (not much I can do here - it's a complex business domain)</li>
<li>Lack of experience in writing UnitTests/TDD</li>
<li>Database dependency</li>
<li>External sources dependencies (Web services, WCF services, NetBIOS, etc)</li>
</ul>

<p>Obviously, I understand that I should start with refactoring the code, to make it less coupled, and more testable. However, doing such refactoring is risky without UnitTests (Chicken and Egg, anyone?).</p>

<p>On a side note, would you recommend starting the refactoring and writing test on the Domain classes, or on tier classes (logging, utilities, etc)?</p>
","<unit-testing><refactoring>","10","421","2009-01-20 23:54:39"
"464751","Class member order in source code","<p>This has been <a href=""http://stackoverflow.com/questions/308581/how-should-i-order-the-members-of-a-c-class"">asked before (question no. 308581)</a>, but that particular question and the answers are a bit C++ specific and a lot of things there are not really relevant in languages like Java or C#.</p>

<p>The thing is, that even after refactorization, I find that there is a bit of mess in my source code files. I mean, the function bodies are alright, but I'm not quite happy with the way the functions themselves are ordered. Of course, in an IDE like Visual Studio it is relatively easy to find a member if you remember how it is called, but this is not always the case.</p>

<p>I've tried a couple of approaches like putting public methods first but that the drawback of this approach is that a function at the top of the file ends up calling an other private function at the bottom of the file so I end up scrolling all the time.</p>

<p>Another approach is to try to group related methods together (maybe into regions) but obviously this has its limits as if there are many non-related methods in the same class then maybe it's time to break up the class to two or more smaller classes.</p>

<p>So consider this: your code has been refactored properly so that it satisfies all the requirements mentioned in <em>Code Complete</em>, but you would still like to reorder your methods for <strong>ergonomic purposes</strong>. What's your approach?</p>

<p>(Actually, while not exactly a technical problem, this is problem really annoys the hell out of me so I would be really grateful if someone could come up with a good approach)</p>
","<language-agnostic><refactoring><ergonomics>","6","871","2009-01-21 10:32:20"
"468090","How to restructure this code hierarchy (relating to the Law of Demeter)","<p>I've got a game engine where I'm splitting off the physics simulation from the game object  functionality. So I've got a pure virtual class for a physical body</p>

<pre><code>class Body
</code></pre>

<p>from which I'll be deriving various implementations of a physics simulation. My game object class then looks like</p>

<pre><code>class GameObject {
public:
   // ...
private:
   Body *m_pBody;
};
</code></pre>

<p>and I can plug in whatever implementation I need for that particular game. But I may need access to all of the <code>Body</code> functions when I've only got a <code>GameObject</code>. So I've found myself writing tons of things like</p>

<pre><code>Vector GameObject::GetPosition() const { return m_pBody-&gt;GetPosition(); }
</code></pre>

<p>I'm tempted to scratch all of them and just do stuff like</p>

<pre><code>pObject-&gt;GetBody()-&gt;GetPosition();
</code></pre>

<p>but this seems wrong (i.e. violates the Law of Demeter). Plus, it simply pushes the verbosity from the implementation to the usage. So I'm looking for a different way of doing this.</p>
","<c++><oop><game-development><refactoring><law-of-demeter>","3","443","2009-01-22 05:00:23"
"472473","Origin of the word Refactoring","<p>Code refactoring is the process of changing a computer program's internal structure without modifying its external behavior or existing functionality. </p>

<p>What is the origin of the word refactoring and why was it chosen to denote the above?</p>
","<refactoring><etymology>","4","297","2009-01-23 10:30:13"
"472547","Is design now a subset of refactoring?","<p>Looking at the cool new principles of software development:</p>

<ul>
<li><a href=""http://en.wikipedia.org/wiki/Agile%5FUnified%5FProcess"" rel=""nofollow"">Agile</a></li>
<li><a href=""http://en.wikipedia.org/wiki/You%5FAin%27t%5FGonna%5FNeed%5FIt"" rel=""nofollow"">You Ain't Gonna Need It</a></li>
<li><a href=""http://www.37signals.com/svn/archives2/less%5Fas%5Fa%5Fcompetitive%5Fadvantage%5Fmy%5F10%5Fminutes%5Fat%5Fweb%5F20.php"" rel=""nofollow"">Less As A Competitive Advantage</a></li>
<li><a href=""http://en.wikipedia.org/wiki/Behavior%5FDriven%5FDevelopment"" rel=""nofollow"">Behaviour-Driven Development</a></li>
<li><a href=""http://www.theregister.co.uk/2007/06/22/premature%5Foptimisation/"" rel=""nofollow"">The Evils Of Premature Optimization</a></li>
</ul>

<p>The New Way seems to be to dive in and write what you need to achieve the first iteration of scope objectives, and refactor as necessary to have elegant solutions. Your codebase grows incrementally, and never has a big planning/hierarchical design stage. That, to me, suggests that software design (worthy though it is) has been subsumed into refactoring, because that's where the elegant code comes from, not the incremental additions to functionality.</p>

<p>Am I wrong?</p>
","<design><language-agnostic><refactoring>","6","409","2009-01-23 11:03:52"
"472733","How would you tidy up this controller logic?","<p>I've got some logic in a controller that sets a status of an object if certain conditions are met:</p>

<pre><code>if params[:concept][:consulted_legal] == 0 &amp;&amp; params[:concept][:consulted_marketing] == 1
  @concept.attributes = {:status =&gt; 'Awaiting Compliance Approval'}
elsif params[:concept][:consulted_marketing] == 0 &amp;&amp; params[:concept][:consulted_legal] == 1 
  @concept.attributes = {:status =&gt; 'Awaiting Marketing Approval'}
elsif params[:concept][:consulted_marketing] == 0 &amp;&amp; params[:concept][:consulted_legal] == 0
  @concept.attributes = {:status =&gt; 'Awaiting Marketing &amp; Legal Approval'}
else
  @concept.attributes = {:status =&gt; 'Pending Approval'}
end
</code></pre>

<p>that I share between create and update actions. How would you go about refactoring this nastiness? Looking for best practices.</p>

<p>New to programming and keen to clean up my code. </p>

<p>TIA.</p>
","<ruby-on-rails><ruby><refactoring><controller>","2","310","2009-01-23 12:39:29"
"473087","String Benchmarks in C# - Refactoring for Speed/Maintainability","<p>I've been tinkering with small functions on my own time, trying to find ways to refactor them (I recently read Martin Fowler's book <em><a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">Refactoring: Improving the Design of Existing Code</a></em>).  I found the following function <code>MakeNiceString()</code> while updating another part of the codebase near it, and it looked like a good candidate to mess with.  As it is, there's no real reason to replace it, but it's small enough and does something small so it's easy to follow and yet still get a 'good' experience from.</p>

<pre><code>private static string MakeNiceString(string str)
        {
            char[] ca = str.ToCharArray();
            string result = null;
            int i = 0;
            result += System.Convert.ToString(ca[0]);
            for (i = 1; i &lt;= ca.Length - 1; i++)
            {
                if (!(char.IsLower(ca[i])))
                {
                    result += "" "";
                }
                result += System.Convert.ToString(ca[i]);
            }
            return result;
        }


static string SplitCamelCase(string str)
    {
        string[] temp = Regex.Split(str, @""(?&lt;!^)(?=[A-Z])"");
        string result = String.Join("" "", temp);
        return result;
    }
</code></pre>

The first function `MakeNiceString()` is the function I found in some code I was updating at work.  The purpose of the function is to translate **ThisIsAString** to **This Is A String**.  It's used in a half-dozen places in the code, and is pretty insignificant in the whole scheme of things. 

I built the second function purely as an academic exercise to see if using a regular expression would take longer or not.

Well, here are the results:

With 10 Iterations:

<blockquote>
<pre>
MakeNiceString took 2649 ticks
SplitCamelCase took 2502 ticks
</pre>

<p></blockquote></p>

<p>However, it changes drastically over the longhaul:</p>

<p>With 10,000 Iterations:</p>

<pre>
MakeNiceString took 121625 ticks
SplitCamelCase took 443001 ticks
</pre>

<p><hr /></p>

<h3>Refactoring <code>MakeNiceString()</code></h3>

<blockquote>
  <p>The process of refactoring <code>MakeNiceString()</code> started with simply removing the conversions that were taking place.  Doing that yielded the following results:</p>
</blockquote>

<pre>
MakeNiceString took 124716 ticks
ImprovedMakeNiceString took 118486
</pre>

<p>Here's the code after Refactor #1:</p>

<pre><code>private static string ImprovedMakeNiceString(string str)
        { //Removed Convert.ToString()
            char[] ca = str.ToCharArray();
            string result = null;
            int i = 0;
            result += ca[0];
            for (i = 1; i &lt;= ca.Length - 1; i++)
            {
                if (!(char.IsLower(ca[i])))
                {
                    result += "" "";
                }
                result += ca[i];
            }
            return result;
        }
</code></pre>

<h3>Refactor#2 - Use <code>StringBuilder</code></h3>

<blockquote>
  <p>My second task was to use <code>StringBuilder</code> instead of <code>String</code>.  Since <code>String</code> is immutable, unnecessary copies were being created throughout the loop.  The benchmark for using that is below, as is the code:</p>
</blockquote>

<pre><code>static string RefactoredMakeNiceString(string str)
        {
            char[] ca = str.ToCharArray();
            StringBuilder sb = new StringBuilder((str.Length * 5 / 4));
            int i = 0;
            sb.Append(ca[0]);
            for (i = 1; i &lt;= ca.Length - 1; i++)
            {
                if (!(char.IsLower(ca[i])))
                {
                    sb.Append("" "");
                }
                sb.Append(ca[i]);
            }
            return sb.ToString();
        }
</code></pre>

This results in the following Benchmark:

<blockquote>
<pre>
MakeNiceString Took:           124497 Ticks   //Original
SplitCamelCase Took:           464459 Ticks   //Regex
ImprovedMakeNiceString Took:   117369 Ticks   //Remove Conversion
RefactoredMakeNiceString Took:  38542 Ticks   //Using StringBuilder
</pre>

<p></blockquote></p>

<p>Changing the <code>for</code> loop to a <code>foreach</code> loop resulted in the following benchmark result:</p>

<pre><code>static string RefactoredForEachMakeNiceString(string str)
        {
            char[] ca = str.ToCharArray();
            StringBuilder sb1 = new StringBuilder((str.Length * 5 / 4));
            sb1.Append(ca[0]);
            foreach (char c in ca)
            {
                if (!(char.IsLower(c)))
                {
                    sb1.Append("" "");
                }
                sb1.Append(c);
            }
            return sb1.ToString();
        }
</code></pre>

<blockquote>
<pre>
RefactoredForEachMakeNiceString    Took:  45163 Ticks
</pre>

<p></blockquote></p>

<p>As you can see, maintenance-wise, the <code>foreach</code> loop will be the easiest to maintain and have the 'cleanest' look.  It is slightly slower than the <code>for</code> loop, but infinitely easier to follow. </p>

<h3>Alternate Refactor: Use Compiled <code>Regex</code></h3>

<p>I moved the Regex to right before the loop is begun, in hopes that since it only compiles it once, it'll execute faster.  What I found out (and I'm sure I have a bug somewhere) is that that doesn't happen like it ought to:</p>

<pre><code>static void runTest5()
        {
            Regex rg = new Regex(@""(?&lt;!^)(?=[A-Z])"", RegexOptions.Compiled);
            for (int i = 0; i &lt; 10000; i++)
            {
                CompiledRegex(rg, myString);
            }
        }
 static string CompiledRegex(Regex regex, string str)
    {
        string result = null;
        Regex rg1 = regex;
        string[] temp = rg1.Split(str);
        result = String.Join("" "", temp);
        return result;
    }
</code></pre>

<h3>Final Benchmark Results:</h3>

<blockquote>
  
</blockquote>

<pre>
MakeNiceString Took                   139363 Ticks
SplitCamelCase Took                   489174 Ticks
ImprovedMakeNiceString Took           115478 Ticks
RefactoredMakeNiceString Took          38819 Ticks
RefactoredForEachMakeNiceString Took   44700 Ticks
CompiledRegex Took                    227021 Ticks
</pre>

<p>Or, if you prefer milliseconds:</p>

<pre>
MakeNiceString Took                  38 ms
SplitCamelCase Took                 123 ms
ImprovedMakeNiceString Took          33 ms
RefactoredMakeNiceString Took        11 ms
RefactoredForEachMakeNiceString Took 12 ms
CompiledRegex Took                   63 ms
</pre>

<p>So the percentage gains are:</p>

<pre>
MakeNiceString                   38 ms   Baseline
SplitCamelCase                  123 ms   223% slower
ImprovedMakeNiceString           33 ms   13.15% faster
RefactoredMakeNiceString         11 ms   71.05% faster
RefactoredForEachMakeNiceString  12 ms   68.42% faster
CompiledRegex                    63 ms   65.79% slower
</pre>

<p>(Please check my math)</p>

<p>In the end, I'm going to replace what's there with the <code>RefactoredForEachMakeNiceString()</code> and while I'm at it, I'm going to rename it to something useful, like <code>SplitStringOnUpperCase</code>.</p>

<h3>Benchmark Test:</h3>

<p>To benchmark, I simply invoke a new <code>Stopwatch</code> for each method call:</p>

<pre><code>       string myString = ""ThisIsAUpperCaseString"";
       Stopwatch sw = new Stopwatch();
       sw.Start();
       runTest();
       sw.Stop();

     static void runTest()
        {

            for (int i = 0; i &lt; 10000; i++)
            {
                MakeNiceString(myString);
            }


        }
</code></pre>

<p><hr /></p>

<h3>Questions</h3>

<ul>
<li>What causes these functions to be so different 'over the long haul', and </li>
<li>How can I improve this function 
a) to be more maintainable or 
b) to run faster? </li>
<li>How would I do memory benchmarks on these to see which used less memory?</li>
</ul>

<p><hr /></p>

<p><strong>Thank you for your responses thus far. I've inserted all of the suggestions made by @Jon Skeet, and would like feedback on the updated questions I've asked as a result.</strong></p>

<blockquote>
  <p><strong>NB</strong>: This question is meant to explore ways to refactor string handling functions in C#. I copied/pasted the first code <code>as is</code>.  I'm well aware you can remove the <code>System.Convert.ToString()</code> in the first method, and I did just that.  If anyone is aware of any implications of removing the <code>System.Convert.ToString()</code>, that would also be helpful to know.</p>
</blockquote>
","<c#><string><refactoring><refactor-my-code>","5","1063","2009-01-23 14:33:38"
"473325","Moving business rules into model","<p>I asked a question earlier which elicited some great responses.</p>

<p><a href=""http://stackoverflow.com/questions/472733/how-would-you-tidy-up-this-controller-logic"">Here's the earlier question</a></p>

<p>On the back of some advice given there, I've tried moving the following controller logic</p>

<pre><code> if params[:concept][:consulted_legal] == 0 &amp;&amp; params[:concept][:consulted_marketing] == 1
  @concept.attributes = {:status =&gt; 'Awaiting Compliance Approval'}
elsif params[:concept][:consulted_marketing] == 0 &amp;&amp; params[:concept][:consulted_legal] == 1 
  @concept.attributes = {:status =&gt; 'Awaiting Marketing Approval'}
elsif params[:concept][:consulted_marketing] == 0 &amp;&amp; params[:concept][:consulted_legal] == 0
  @concept.attributes = {:status =&gt; 'Awaiting Marketing &amp; Legal Approval'}
else
  @concept.attributes = {:status =&gt; 'Pending Approval'}
end
</code></pre>

<p>into the model, as so:</p>

<pre><code>def set_status
if status.blank?
  if (consulted_legal == true) &amp;&amp; (consulted_marketing == true)
      status = ""Pending Approval""
  elsif (consulted_legal == true) &amp;&amp; (consulted_marketing == false)
    status = ""Awaiting Marketing Approval""
  elsif (consulted_legal == false) &amp;&amp; (consulted_marketing == true)
    status = ""Awaiting Legal Approval""
  elsif (consulted_legal == false) &amp;&amp; (consulted_marketing == false)
    status = ""Awaiting Marketing &amp; Legal Approval""
  end
end
true # Needs to return true for the update to go through    
  end
</code></pre>

<p>I am calling that from a before_save callback.</p>

<p>As a default, both the consulted_legal and consulted_marketing attributes are set to false and not null, which is why I am testing for == false or true here, instead of asking </p>

<pre><code>if consulted_legal?
</code></pre>

<p>for instance.</p>

<p>However, this logic doesn't seem to be working. If I inspect the object, status is not being set to anything, ever. Can anyone spot why this might be happening? Have I got how attributes are accessed wrong in models, for instance?</p>

<p>TIA</p>
","<ruby-on-rails><ruby><refactoring><model><controller>","1","223","2009-01-23 15:29:56"
"476728","C#: How do you make VSC# Express 2008 refactor the name of events when object is renamed?","<p>How do you make Visual Studio C# Express 2008 refactor the name of events when object is renamed?</p>

<p>Let's say I have an object named txtCars and it already has an event handler for on txtCarsTextChanged and I rename the object from txtCars to txtTrucks. Everything else is refactored but the event txtCarsTextChanged isn't. Is there a shortcut to make it all refactor or atleast along with the events, even on the form design.cs file without having to edit the event name and back in the form designer.cs file manually?</p>
","<c#><refactoring>","0","153","2009-01-24 21:59:33"
"478860","Merging C Callergraphs with Doxygen or determining union of all calls","<p>I have a collection of legacy C code which I'm refactoring to split the C computational code from the GUI. This is complicated by the heavily recursive mathematical core code being K&amp;R style declarations. I've already abandoned an attempt to convert these to ANSI declarations due to nested use of function parameters (just couldn't get those last 4 compiler errors to go).</p>

<p>I need to move some files into a pure DLL and determine the minimal interface to make public, which is going to require wrapper functions writing to publish a typed interface.</p>

<p>I've marked up the key source files with the Doxygen @callergraph markup so informative graphs are generated for individual functions. What I'd like to do beyond that is amalgamate these graphs so I can determine the narrowest boundary of functions exposed to the outside world.</p>

<p>The original header files are no use - they expose everything as untyped C functions.</p>

<p>There are hundreds of functions so simple inspection of the generated callergraphs is painful.</p>

<p>I'm considering writing some kind of DOT merge tool - setting DOT_CLEANUP=NO makes Doxygen leave the intermediate DOT files there rather then just retaining the png files they generated.</p>

<p>I'm not obsessed by this being a graphical solution - I'd be quite happy if someone could suggest an alternative analysis tool (free or relatively cheap) or technique using Doxygen's XML output to achieve the same goal.</p>

<p>A callergraph amalgamated at the file level does have a certain appeal for client documentation rather than a plain list :-)</p>
","<refactoring><code-analysis><doxygen><graphviz><call-graph>","3","800","2009-01-26 04:44:33"
"481813","How to simplify a null-safe compareTo() implementation?","<p>I'm implementing <code>compareTo()</code> method for a simple class such as this (to be able to use <code>Collections.sort()</code> and other goodies offered by the Java platform):</p>

<pre><code>public class Metadata implements Comparable&lt;Metadata&gt; {
    private String name;
    private String value;

// Imagine basic constructor and accessors here
// Irrelevant parts omitted
}
</code></pre>

<p>I want the <em>natural ordering</em> for these objects to be: 1) sorted by name and 2) sorted by value if name is the same; both comparisons should be case-insensitive. For both fields null values are perfectly acceptable, so <code>compareTo</code> must not break in these cases. </p>

<p>The solution that springs to mind is along the lines of the following (I'm using ""guard clauses"" here while others might prefer a single return point, but that's beside the point):</p>

<pre><code>// primarily by name, secondarily by value; null-safe; case-insensitive
public int compareTo(Metadata other) {
    if (this.name == null &amp;&amp; other.name != null){
        return -1;
    }
    else if (this.name != null &amp;&amp; other.name == null){
        return 1;
    }
    else if (this.name != null &amp;&amp; other.name != null) {
        int result = this.name.compareToIgnoreCase(other.name);
        if (result != 0){
            return result;
        }
    }

    if (this.value == null) {
        return other.value == null ? 0 : -1;
    }
    if (other.value == null){
        return 1;
    }

    return this.value.compareToIgnoreCase(other.value);
}
</code></pre>

<p>This does the job, but I'm not perfectly happy with this code. Admittedly it isn't <em>very</em> complex, but is quite verbose and tedious.</p>

<p>The question is, <strong>how would you make this less verbose</strong> (while retaining the functionality)? Feel free to refer to Java standard libraries or Apache Commons if they help. Would the only option to make this (a little) simpler be to implement my own ""NullSafeStringComparator"", and apply it for comparing both fields?</p>

<p><strong>Edits 1-3</strong>: Eddie's right; fixed the ""both names are null"" case above</p>
","<java><refactoring><comparison><null><compareto>","6","8346","2009-01-26 23:25:14"
"474613","How should I refactor my code to remove unnecessary singletons?","<p>I was confused when I first started to see anti-singleton commentary. I have used the singleton pattern in some recent projects, and it was working out beautifully. So much so, in fact, that I have used it many, many times.</p>

<p>Now, after running into some problems, reading <a href=""http://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons"">this</a> SO question, and especially <a href=""http://steve.yegge.googlepages.com/singleton-considered-stupid"" rel=""nofollow"">this</a> blog post, I understand the evil that I have brought into the world.</p>

<p>So: How do I go about <i>removing</i> singletons from existing code?</p>

<p>For example:<br />
In a retail store management program, I used the MVC pattern. My Model objects describe the store, the user interface is the View, and I have a set of Controllers that act as liason between the two. Great. Except that I made the Store into a singleton (since the application only ever manages one store at a time), and I also made most of my Controller classes into singletons (one mainWindow, one menuBar, one productEditor...). Now, most of my Controller classes get access the other singletons like this:</p>

<pre><code>Store managedStore = Store::getInstance();
managedStore.doSomething();
managedStore.doSomethingElse();
//etc.
</code></pre>

<p>Should I instead:</p>

<ol>
<li>Create one instance of each object and pass references to every object that needs access to them?
<li>Use globals?
<li>Something else?
</ol>

<p>Globals would still be bad, but at least they wouldn't be <a href=""http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/"" rel=""nofollow"">pretending</a>.</p>

<p>I see #1 quickly leading to horribly inflated constructor calls:</p>

<pre><code>someVar = SomeControllerClass(managedStore, menuBar, editor, sasquatch, ...)
</code></pre>

<p>Has anyone else been through this yet? What is the OO way to give many individual classes acces to a common variable without it being a global or a singleton? </p>
","<language-agnostic><refactoring><singleton>","13","1858","2009-01-23 21:21:48"
"475675","When is a function too long?","<p>35 lines, 55 lines, 100 lines, 300 lines? When you should start to break it apart? I'm asking because I have a function with 60 lines (including comments) and was thinking about breaking it apart.</p>

<pre><code>long_function(){ ... }
</code></pre>

<p>into:</p>

<pre><code>small_function_1(){...}
small_function_2(){...}
small_function_3(){...}
</code></pre>

<p>The functions are not going to be used outside of the long_function, making smaller functions means more function calls, etc.</p>

<p>When would you break apart a function into smaller ones? Why?</p>

<ol>
<li>Methods should do only one logical thing (think about functionality)</li>
<li>You should be able to explain the method in a single sentence</li>
<li>It should fit into the height of your display</li>
<li>Avoid unnecessary overhead (comments that point out the obvious...)</li>
<li>Unit testing is easier for small logical functions</li>
<li>Check if part of the function can be reused by other classes or methods</li>
<li>Avoid excessive inter-class coupling</li>
<li>Avoid deeply nested control structures</li>
</ol>

<p><strong>Thanks everyone for the answers</strong>, edit the list and vote for the correct answer I'll choose that one ;)</p>

<p>I am refactoring now with those ideas in mind :)</p>
","<function><refactoring><coding-style>","20","2332","2009-01-24 07:13:39"
"484489","Is there a way to programmatically extract an Interface?","<p>Say I have a .NET class like so:</p>

<pre><code>public class Person {
    public string Name { get; set; }
    public int Id { get; set; }
}
</code></pre>

<p>Visual Studio has a nifty refactoring tool called Extract Interface that will extract an <code>IPerson</code> interface, and have <code>Person</code> implement it. Is there a way to do that programmatically from outside of Visual Studio? I'd even take a shell script if it can't be done programmatically. </p>

<p>[EDIT]
In actuality, I would have up to 50 classes, each with dependencies on each other.</p>

<p>Reflection would work, but it would introduce another wrinkle into the whole thing. The classes are already generated by <code>xsd.exe</code>. So, if I understand it correctly, the steps I would need to take would be:</p>

<ol>
<li>Generate classes from <code>xsd.exe</code>.</li>
<li>Compile the classes on the fly so that I can use reflection. </li>
<li>Reflect over them, emit the interfaces, and edit the original classes to
implement said interfaces.</li>
</ol>

<p>Generally I'd be in favor of just ditching the interfaces and using the classes directly, but for various reasons I cannot.</p>
","<.net><visual-studio><refactoring>","3","899","2009-01-27 17:59:23"
"485567","Avoiding code repetition when using LINQ","<p>Ok so I have a number of methods that look like this:- which sorts a list by artist, album, year etc.</p>

<pre><code>        public void SortByAlbum(SortOrder sortOrder)
        {
           if (sortOrder == SortOrder.Ascending)
              _list = _list.OrderBy(x =&gt; x.Album).ToList();
           else if (sortOrder == SortOrder.Descending)
              _list = _list.OrderByDescending(x =&gt; x.Album).ToList();
        }
</code></pre>

<p>and this:</p>

<pre><code>        public void SortByArtist(SortOrder sortOrder)
        {
           if (sortOrder == SortOrder.Ascending)
              _list = _list.OrderBy(x =&gt; x.Artist).ToList();
           else if (sortOrder == SortOrder.Descending)
              _list = _list.OrderByDescending(x =&gt; x.Artist).ToList();
        }
</code></pre>

<p>Now obviously this isn't good code so it needs refactoring into one Sort() method but I just cant figure out how to do it in the simplest possible way. I don't care if it uses IComparer or LINQ.</p>

<p>I want it to look something like this:</p>

<pre><code>    public void Sort(SortOrder sortOrder, SortType sortType)
    {
        //implementation here
    }

    public enum SortType
    {
       Artist,
       Album,
       Year
    }
</code></pre>

<p>So whats the cleanest way to do this with no code repetition?</p>

<p>Thanks, Lee</p>
","<c#><.net><linq><refactoring>","5","2933","2009-01-27 22:16:24"
"488687","Refactoring a class in C++","<p>I have a class A which implements many functions. Class A is very stable.</p>

<p>Now I have a new feature requirement, some of whose functionality matches that implemented     by A. I cannot directly inherit my new class from class A, as that would bring lot of redundancy into my new class. </p>

<p>So, should i duplicate the common code in both the classes? </p>

<p>Or, should i create a new base class and move the common code to base class, and derive class A and the new class from it? But this will lead to changes in my existing class.</p>

<p>So, which would be a better approach? </p>
","<c++><refactoring>","4","397","2009-01-28 18:06:48"
"489420","How would you write this query?","<p>I'm looking to refactor the below query to something more readable and modifiable.  The first half is identical to the second, with the exception of the database queried from (table names are the same though.)</p>

<pre><code>  SELECT
    Column 1 AS c1,
    ...
    Column N AS cN
  FROM
    database1.dbo.Table1

UNION

  SELECT
    'Some String' as c1,
    ...
    NULL as cN
  FROM
    database1.dbo.Table2

UNION

  SELECT
    Column 1 AS c1,
    ...
    Column N AS cN
  FROM
    database2.dbo.Table1

UNION

  SELECT
    'Some String' as c1,
    ...
    NULL as cN
  FROM
    database2.dbo.Table2
</code></pre>

<p>This query is the definition of DRY and is calling to me to be re-written, but I have no idea how!</p>

<p><strong>EDIT</strong>: We can't use linq and we desire distinct results; I'm looking to make the query smaller in physical file size, not in results returned.</p>

<p><strong>EDIT</strong>: The database I'm querying off is a proprietary ERP database.  Restructuring it is not an option.</p>
","<sql><refactoring><rewrite>","1","358","2009-01-28 21:17:03"
"494397","Refactor SQL (workaround RIGHT OUTER JOIN)","<p>Since SQLite does not support RIGHT OUTER JOINS I pose the following challenge (read: invitation to do my work for me):</p>

<p>Refactor this query so it no longer utilises SQLite-unsupported constructs like RIGHT/FULL OUTER JOINs.</p>

<pre><code>SELECT     strings.*, translations.text
FROM         translations INNER JOIN
                      language ON translations.language_id = language.id RIGHT OUTER JOIN
                      strings ON translations.string_id = strings.id
WHERE     (language.handle = 'english')
</code></pre>

<p>I sense it can be achieved with subqueries or by pivoting the tables and performing a LEFT OUTER JOIN but my attempts have failed; my SQL's not what it used to be.</p>

<p>Here's a query builder outline showing the applicable schema: <a href=""http://dl.getdropbox.com/u/264612/sql-refactor.PNG"" rel=""nofollow"">http://dl.getdropbox.com/u/264612/sql-refactor.PNG</a></p>

<p>First to crack it gets an e-hug from dekz</p>
","<sql><query><sqlite><refactoring><outer-join>","2","650","2009-01-30 03:36:14"
"495208","How to externalize pieces of maven build file?","<p>I was faced to a problem how to version a configuration file in XML format. The easiest way is to write XSLT updates. Every release of the application has its own XSLT update. All these update files are small enough to be managable by the IDE, especially its <em>DIFF</em> tool.</p>

<p>Since the project is already been developed as Maven2 Java logical solution was to trigger these updates through maven build file.</p>

<p>This is how the section for applying a set of updates looks today:</p>

<pre><code>&lt;plugin&gt;
  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
  &lt;artifactId&gt;xml-maven-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
    &lt;execution&gt;
    &lt;phase&gt;compile&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;transform&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
  &lt;configuration&gt;
    &lt;transformationSets&gt;
      &lt;transformationSet&gt;
        &lt;dir&gt;config/xsltUpdates/input&lt;/dir&gt;
        &lt;stylesheet&gt;config/xsltUpdates/update1-8-3.xsl&lt;/stylesheet&gt;
        &lt;outputDir&gt;config/xsltUpdates/update1-8-3&lt;/outputDir&gt;
      &lt;/transformationSet&gt;
      &lt;transformationSet&gt;
         &lt;dir&gt;config/xsltUpdates/update1-8-3&lt;/dir&gt;
         &lt;stylesheet&gt;config/xsltUpdates/update1-8-9.xsl&lt;/stylesheet&gt;
         &lt;outputDir&gt;config/xsltUpdates/update1-8-9&lt;/outputDir&gt;
      &lt;/transformationSet&gt;
      &lt;transformationSet&gt;
        &lt;dir&gt;config/xsltUpdates/update1-8-9&lt;/dir&gt;
        &lt;stylesheet&gt;config/xsltUpdates/update1-9-0.xsl&lt;/stylesheet&gt;
        &lt;outputDir&gt;config/xsltUpdates/update1-9-0&lt;/outputDir&gt;
      &lt;/transformationSet&gt;
      &lt;transformationSet&gt;
        &lt;dir&gt;config/xsltUpdates/update1-9-0&lt;/dir&gt;
        &lt;stylesheet&gt;config/xsltUpdates/update1-10-0.xsl&lt;/stylesheet&gt;
        &lt;outputDir&gt;config/xsltUpdates/update1-10-0&lt;/outputDir&gt;
      &lt;/transformationSet&gt;
      &lt;transformationSet&gt;
        &lt;dir&gt;config/xsltUpdates/update1-10-0&lt;/dir&gt;
        &lt;stylesheet&gt;config/xsltUpdates/update1-10-0-1.xsl&lt;/stylesheet&gt;
        &lt;outputDir&gt;config/xsltUpdates/update1-10-0-1&lt;/outputDir&gt;
      &lt;/transformationSet&gt;
      &lt;transformationSet&gt;
        &lt;dir&gt;config/xsltUpdates/update1-10-0-1&lt;/dir&gt;
        &lt;stylesheet&gt;config/xsltUpdates/update1-10-0-2.xsl&lt;/stylesheet&gt;
        &lt;outputDir&gt;config/xsltUpdates/update1-10-0-2&lt;/outputDir&gt;
      &lt;/transformationSet&gt;
      &lt;transformationSet&gt;
        &lt;dir&gt;config/xsltUpdates/update1-10-0-2&lt;/dir&gt;
        &lt;stylesheet&gt;config/xsltUpdates/updateCurrent.xsl&lt;/stylesheet&gt;
        &lt;outputDir&gt;config/xsltUpdates/output&lt;/outputDir&gt;
      &lt;/transformationSet&gt;
    &lt;/transformationSets&gt;
  &lt;/configuration&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;net.sf.saxon&lt;/groupId&gt;
      &lt;artifactId&gt;saxon&lt;/artifactId&gt;
      &lt;version&gt;8.7&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/plugin&gt;
</code></pre>

<p>I would like to externalize information about transformationSet in some properties/xml file import. My pom.xml file will be cleaner and externalized info easier for maintenance.</p>

<p>How can I do that?</p>

<p>Can I use some iterating control statement inside the build file? Is there a way to import data from some external file?</p>
","<java><maven-2><refactoring><maven-plugin>","2","854","2009-01-30 11:25:53"
"495294","Refactor this Python code to iterate over a container","<p>Surely there is a better way to do this?</p>

<pre><code>results = []
if not queryset is None:
    for obj in queryset:
        results.append((getattr(obj,field.attname),obj.pk))
</code></pre>

<p>The problem is that sometimes queryset is None which causes an exception when I try to iterate over it. In this case, I just want result to be set to an empty list. This code is from a Django view, but I don't think that matters--this seems like a more general Python question.</p>

<p><strong>EDIT:</strong> I turns out that it was my code that was turning an empty queryset into a ""None"" instead of returning an empty list. Being able to assume that queryset is always iteratable simplifies the code by allowing the ""if"" statement to be removed. The answers below maybe useful to others who have the same problem, but cannot modify their code to guarantee that queryset is not ""None"".</p>
","<python><django><refactoring><iterator>","3","509","2009-01-30 12:02:34"
"501520","How to rename XIB/NIB files in Xcode 3?","<p>How do I rename XIB/NIB files in Xcode? There is no ""Refactor"" option, and right clicking and choosing ""Rename"" does not work correctly.</p>
","<xcode><refactoring>","2","2209","2009-02-01 20:31:07"
"502648","Is there any good tool to refactor Perl web code?","<p>i'm currently working on a perl web app LAMP style and recently stumbled upon this death maze of code left by some previous developer. He left so many magic numbers and weird logic that it's gives me a headache everytime i had to go through it.</p>

<p>I'm learning unit testing right now so i want to find some useful tool to refactor the code and write unit test along the way to make sure that i don't accidentally break anything.</p>

<p>Any recommendation for any good refactoring tool for LAMP perl?
Preferably free :)</p>

<p>Thanks.</p>
","<perl><software-tools><lamp><refactoring>","12","1090","2009-02-02 09:17:19"
"506934","How can I re-factor this code?","<p>I'm using the following function to map columns from a DataTable (passed from the data tier) to object properties. The function exists within the class I'm populating. The class has two methods: Load() which loads the object with values and LoadAll() which returns a collection of populated objects. I wanted to be able to use the same code to populate the current object or a new object. However I'm less than happy with the result, largely because of the duplication which is a bit of a maintenance nightmare.</p>

<pre><code>Private Function MapDataRowToProperties(ByVal dr As DataRow, ByVal target As Incident) As Incident
            If target.Equals(Me) Then
               Me.ID = Convert.ToInt32(dr.Item(""pkIncidentID""))
               Me.Description = dr.Item(""IncidentDetail"").ToString
               Me.Created = Convert.ToDateTime(dr.Item(""CreatedOn""))
               ...
               Return Me
           Else
              Dim NewIncident As New Incident
              NewIncident.ID = Convert.ToInt32(dr.Item(""pkIncidentID""))
              NewIncident.Description = dr.Item(""IncidentDetail"").ToString
              NewIncident.Created = Convert.ToDateTime(dr.Item(""CreatedOn""))
              ...
              Return NewIncident
           End If

    End Function
</code></pre>

<p>Note: I'm well aware of ORM tools which will do this for me and I normally use EntitySpaces, but for this project I am unable to do so.</p>
","<.net><vb.net><refactoring>","1","306","2009-02-03 12:39:59"
"507967","Tricks to avoid productivity ""rabbit holes""","<p>I find that I often descend into what I call ""rabbit holes"" as I learn about a new technology/language/method/etc.</p>

<p>These are the moments where you feel that in order to understand a detail of what you are working on, you start investigating and investigating and you end up in a related, but detached space.</p>

<p>For instance, I'm learning Ruby (and Rails), and the more and more I discover, the more I feel I need a much better understanding of system administration, and so on and so on until I realize that I've found myself reading about Lisp...</p>

<p>or I begin working on old code. I take a look and I work at it and next thing I know, I'm refactoring and eventually rewriting code, when really I should just be completing the task.</p>

<p>Anybody else? Or just me?</p>

<p>How do you avoid these time sinks and rabbit holes? How do you pull yourself out of ""refactor"" mode?</p>
","<refactoring><productivity>","2","436","2009-02-03 16:59:39"
"509283","What are the advantages of self-testing code vs separated tests?","<p>Personally, I've always put unit tests in a separate project just because that's how MSTest seems to be set up.  But I'm reading <em>Refactoring: Improving the Design of Existing Code</em> by Martin Fowler and he seems to be advocating not only putting them in the same project, but also putting them in the same class as the method they're testing.</p>

<p>I'm really honestly having trouble thinking of ways this is different from having the tests in a separate area from the code itself other than philosophical differences (are tests documentation or clutter?).</p>

<p>Are there any clearcut reasons to choose one over another?  Or is this mainly a philosophical difference?</p>

<p><strong>UPDATE</strong>:  I'm not necessarily convinced yet one way or another, but at least I have an idea what the arguments are.  I wish I could select everybody's answer, but I had to select just one.</p>
","<unit-testing><refactoring><tdd>","2","535","2009-02-03 22:45:32"
"498651","Goals of refactoring?","<p>What are the goals of refactoring code? Is it only to enhance the code structure? Is it to pave the way for future changes?</p>
","<refactoring><benefits>","8","550","2009-01-31 11:15:28"
"511211","Why does the extract method command in visual studio create static methods?","<p>Why does Visual Studio by default create a private static method when refactoring code and selecting extract method?</p>

<p>If I'm refactoring a non-static class and the method is only visible within the class why is it static?</p>

<p>Is there some performance benefit by calling a private static method within a non-static class compared to a non-static method within a non-static class? </p>

<p>Is it for readability to simply show that the method does not rely on any member variables of the class? </p>
","<c#><visual-studio><refactoring>","6","503","2009-02-04 12:54:51"
"511873","Refactor subqueries using GROUP BY/HAVING?","<p>I'm building a MySQL query to determine how many items from each of several categories appear in a given date range. My initial attempt looked like this:</p>

<pre><code>select Title, 
  (select count(*) from entries where CategoryID=1
    and Date &gt;= @StartDate and Date &lt;= @EndDate) as Cat1,
  (select count(*) from entries where CategoryID=2
   and Date &gt;= @StartDate and Date &lt;= @EndDate) as Cat2,
  (select count(*) from entries where CategoryID is null
   and Date &gt;= @StartDate and Date &lt;= @EndDate) as UnkownCategory
from entries
  where Date &gt;= @StartDate and Date &lt;= @EndDate
</code></pre>

<p>The table is quite large and I'd like to refactor the query to speed it up, but I'm not sure how - can this be rewritten using GROUP BY/HAVING statements or is there another way I'm missing?</p>

<p><strong>Edit</strong>: Sample result set - something like this:</p>

<pre><code>Title | Category 1 Total | Category 2 Total | Unknown Category Total
ABC     1                  3                  0
DEF     2                  7                  2
</code></pre>
","<sql><mysql><refactoring><query-optimization><refactor-my-code>","0","380","2009-02-04 15:36:17"
"517752","How do I use Eclipse Refactoring Tools and stay in sync with SVN through Subclipse?","<p>I have found that when I need to rename a Java class (and therefore the source file) or need to change the package name (and therefore move the source file[s]), I can either:</p>

<ol>
<li>Use the nice and useful Eclipse refactoring tools which is great since all the cascading tasks are done for me. However, I then have an uphill struggle with Subversion to replicate the changes back to the repo.</li>
<li>I can issue the renames/moves in Subversion first, update my local and then the refactoring tools in Eclipse don't work.</li>
</ol>

<p>Can anyone advise on a preferable procedure?</p>
","<eclipse><svn><refactoring><subclipse>","6","3622","2009-02-05 20:24:32"
"517780","Refactor ""using"" directives over an entire codebase?","<p>One of the things I love about Visual Studio 2008 is the ability to refactor and reorganize the ""using"" directives in source code files (this may have been in 2005 as well, I don't remember).</p>

<p>Specifically, I'm talking about how you can have it both reorganize the directives to be alphabetical (though with the core FCL libraries floating to the top) and removing any directives which don't need to be there (either never used or no longer used).</p>

<p>Is there any way to automate this refactoring (the sorting and trimming) across an entire old codebase? Either through all of the files in a solution or across multiple solution files.</p>
","<c#><visual-studio-2008><refactoring><using-directives>","3","486","2009-02-05 20:30:28"
"521281","Should I Refactor This Code?","<p>I am working on modifying a control on a existing site.  All controls from the site inherit form a base class.  I have a requirement to hide several links on the master page so I wrote this method on my control:</p>

<pre><code>private void HideCartLink (bool visible)
{
  Control control1 = Page.Master.FindControl( ""link1"" );
  control1.Visible = visible;

  Control control2 = Page.Master.FindControl( ""link2"" );
  control2.Visible = visible;
}
</code></pre>

<p>I then moved on to another control and I had to do the same thing. So I refactored my code and modified my base class with this:</p>

<pre><code>public void HideMasterPageControl (string controlName, bool visible)
{
    Control control = Page.Master.FindControl( controlName );
    control.Visible = visible;
}
</code></pre>

<p>and added this method on my controls:</p>

<pre><code>void CartLinkVisible(bool visible)
{
    ////hide cart link
    HideMasterPageControl(""link1"", visible);
    HideMasterPageControl(""link2"", visible);
}
</code></pre>

<p>Now I moved on to a third control and realized I have to do the same thing.</p>

<p>Should I refactor my code one more time so that my base class has a method that knows specifically which links to hide? Or should I leave my base class generic and let my controls decided what to hide?</p>

<p>I am not sure what the rule is here...</p>
","<c#><asp.net><refactoring>","0","267","2009-02-06 17:34:29"
"520599","Suggestion on book to read about refactoring?","<p>Will it be easy for a C++ developer to read <a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">Refactoring: Improving the Design of Existing Code</a></p>

<p>Is there any other book that I should read about refactoring?  Feel free to add any articles on refactoring.</p>
","<c++><refactoring>","0","454","2009-02-06 15:02:31"
"522334","Practical refactoring using unit tests","<p>Having just read the first four chapters of <a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">Refactoring:  Improving the Design of Existing Code</a>, I embarked on my first refactoring and almost immediately came to a roadblock.  It stems from the requirement that before you begin refactoring, you should put unit tests around the legacy code.  That allows you to be sure your refactoring didn't  change what the original code did (only <em>how</em> it did it).</p>

<p>So my first question is this:  how do I unit-test a method in legacy code?  How can I put a unit test around a 500 line (if I'm lucky) method that doesn't do just one task?  It seems to me that I would have to refactor my legacy code just to make it unit-testable.</p>

<p>Does anyone have any experience refactoring using unit tests?  And, if so, do you have any practical examples you can share with me?</p>

<p>My second question is somewhat hard to explain.  Here's an example:  I want to refactor a legacy method that populates an object from a database record.  Wouldn't I have to write a unit test that compares an object retrieved using the old method, with an object retrieved using my refactored method?  Otherwise, how would I know that my refactored method produces the same results as the old method?  If that is true, then how long do I leave the old deprecated method in the source code?  Do I just whack it after I test a few different records?  Or, do I need to keep it around for a while in case I encounter a bug in my refactored code?</p>

<p>Lastly, since a couple people have asked...the legacy code was originally written in VB6 and then ported to VB.NET with minimal architecture changes.</p>
","<unit-testing><refactoring><legacy-code>","7","616","2009-02-06 21:50:46"
"526133","Add shortcut methods or follow ActiveRecord semantics?","<p>Yet another argument with a friend of mine. Consider this code:</p>

<pre><code>class User &lt; ActiveRecord::Base
  has_many :groups
  def in_group?(group)
      groups.include?(group)
  end
end
class Group &lt; ActiveRecord::Base
  has_many :members
  def add_user(user)
      members &lt;&lt; user
  end
end
</code></pre>

<p>My opinion is that these methods add extra unnecessary complexity to the code and are hardly guessable — like why #in_group? but not #is_a_member_of?, or why #add_user but not #add_member, and so on. Coming from my 4 years experience with Rails and total 20 yrs programming experience, I'd better follow AR semantics and use User#groups.include?(group) and Group#members &lt;&lt; user. They are easily guessable and in case if I'll need some extra functionality, I can use callbacks for has_many :members and override User#groups.include? in the association extension module if that would be necessary.</p>

<p>However friend of mine argues that it is better to use shortcuts to creates ""points of abstractions"" and it is better to extend this code rather than using callbacks or overloads.</p>

<p>What do YOU think?</p>

<p><strong>P.S. just to be clear, I hate ""WHAT IF"" approach :)</strong></p>
","<ruby-on-rails><ruby><refactoring><associations><naming>","1","218","2009-02-08 18:07:18"
"527697","Refactoring ColdFusion 5 tag-based code into CFCs","<p>I feel the need to refactor my old CF5 based code into CFC's. We already have some code in  ColdSpring and Transfer but feel a large rewrite to ColdSpring and Transfer is pointless.</p>

<p>What tips, approaches and gotchas will I hit.</p>

<p>How can I make this easy?  </p>

<p>I don't mind keeping ColdSpring in the mix but Transfer is the bit I'm scared of with the size of the project.</p>

<p>edit: my code base has been going for 7-8 years and is vast. To describe it would be difficult, however I'm looking for generic suggestions on approaches</p>
","<coldfusion><refactoring><coldspring><transfer-orm>","2","173","2009-02-09 10:50:50"
"528911","Minimizing visibility in Java","<p>Does anyone know of an automated approach to refactoring code to minimize the visibility of classes, and their properties and methods? I'm trying to clean up an old API that has way too many public getters and setters to fit with JavaBean standards. An Eclipse plugin would be ideal, but any tool that could help would be great. </p>
","<java><refactoring>","3","160","2009-02-09 16:42:42"
"533769","Refactoring my DataTable search code","<p>I am using C# 2.0, and I can't help but think this isn't the most efficient way to search a collection (in this case a DataTable) for a value:</p>

<pre><code>bool found = false;
foreach (DataRow row in data.Rows)
{
    if (id == row[""rowID""])
    {
        found = true;
        break;
    }
}
if (!found)
{
    //Do stuff here
}
</code></pre>

<p>Can anyone think of a ""cleaner"" way to do this?</p>
","<c#><search><refactoring>","0","344","2009-02-10 19:21:29"
"534072","Should I separate Dispose logic into a partial class file?","<p>While refactoring some C# classes, I've run into classes that implement IDisposable.</p>

<p>Without thinking, I have created partial class files for each class that implements IDisposable interface.</p>

<p>E.g.) For Stamper.cs -> Stamper.cs + Stamper.Dispose.cs
where <strong>Stamper.cs</strong> contains actual logic for stamping 
and <strong>Stamper.Dispose.cs</strong> that contains dispose logic</p>

<pre><code>// Stamper.cs
public partial class Stamper
{
// actual logic
}

// Stamper.Dispose.cs
public partial class Stamper: IDisposable
{
// Implement IDisposable
}
</code></pre>

<p>When I looked at the code, Stamper.cs now looks a lot cleaner and readable (now about 52 lines instead of 100 lines where around 50 lines was simply a clean-up dispose code)</p>

<p>Am I going too far with this?</p>

<p><strong>*EDIT</strong>: Thanks folks for your opinions - I have decided to put two files together into one.
The Problem I had faced was that I was actually forgetting to update IDisposable implementation after updating actual logic.</p>

<p>Moreover there wasn't much problem navigating between method in the source code.
The first reason seems more than a reason enough to stick with one file solution in my specific case.</p>
","<c#><refactoring><idisposable><partial-classes>","1","363","2009-02-10 20:34:29"
"533858","Best Practices for Refactoring with local variables","<p>I've been spending some time refactoring my C# code, and I'm struck by how large my parameter lists are getting for local variables, especially when you start getting several levels deep and have to pass local variables from higher up the call stack.</p>

<p>As an example, I have some rather complex code that uses Linq to sql.  I instantiate a data context early in a procedure and use it throughout the procedure.  However, after refactoring, I find that i'm passing this DC throughout all my sub-methods, along with various other state variables.  </p>

<p>One solution, of course, is to make these local variables into member variables, but that makes the entire class non-thread safe, and when dealing with async i/o that means crippling things with locks and mutexes to make them safe.</p>

<p>What are your best practices when factoring in regards to local variables?  Do you give in and make them members? or do you carry around the state baggage?  Or do you do something else?</p>

<p>EDIT: I'm not sure what more detail you need.  I don't want to dump a bunch of code, because by it's nature in order to illustrate this I have to show a very complex set of procedures. </p>

<p>I have a number of local variables, such as a Linq to Sql DC, various stages of processing, various stages of updates of a lot of raw data processed and written to a database. </p>

<p>I thought about creating a state context and passing that, but it seems kind of hackish to me, although I suppose that's precisely what the Linq to SQL dc is.</p>
","<c#><refactoring>","2","388","2009-02-10 19:45:53"
"538239","Does the Eclipse Web Tools Project handle refactoring inside JSPs?","<p>I've installed the Web Tools Project for Eclipse version 3.4.  I've been trying to get refactoring working the way I think it should and have had no success.</p>

<p>I have one Java project that contains the Java classes for the jar that is put into the /WEB-INF/lib for a web site.  Another project (a Dynamic Web project) has the JSP files for the same site.  The Dynamic Web project is set up with the Java project as a required project in the build path.  I have also set the Project References option for the Dynamic Web project to refer to the Java Project.</p>

<p>If I use refactoring to change a method name in one of the Java classes, I would expect that references to that method in the JSPs would be renamed.  But it does not work.  References in the Java project that contains the class and other Java projects that use that class have the references changed are refactored, but not references to the method inside the JSPs.</p>

<p>I've been fiddling with it for days, trying different versions of Eclipse and WTP.  Deleting all my projects and files and setting them up again.  Nothing makes any difference.</p>

<p>Does this work for anyone else?  Is there something special I need to set to get this working? </p>
","<java><eclipse><jsp><refactoring><eclipse-wtp>","4","1348","2009-02-11 18:55:33"
"543087","Custom Class for dealing with embedding in Forms","<p>I have a custom class file in C# that I inherited and partially extended.  I am trying to <em>re factor</em> it now as I have just enough knowhow to know that with something like <em>generics</em>(I think) I could greatly condense this class.  </p>

<p>As an inexperienced solo dev I would greatly appreciate any direction or constructive critism any can provide.  </p>

<p>Don't be gentle!  I appreciate your time and have a blessed day!  I am preemptively sorry for the length.</p>

<pre><code>using System.Windows.Forms;
using DevExpress.XtraEditors;
using DevExpress.XtraTab;

namespace psWinForms
{
    public static class WinFormCustomHandling
    {
        public static void ShowXFormInControl(Form frm, 
            ref XtraTabPage ctl, FormBorderStyle style)
        {
            frm.TopLevel = false;
            frm.ControlBox = false;
            frm.Parent = ctl;
            frm.FormBorderStyle = style;
            frm.Left = 0;
            frm.Top = 0;
            frm.Width = ctl.Width + 4;
            frm.Dock = DockStyle.Fill;
            frm.Show();

            //IMPORTANT: .Show() fires a form load event
            frm.BringToFront();
        }

        public static void ShowXFormInControl(Form frm, 
            ref XtraPanel ctl, FormBorderStyle style)
        {
            frm.TopLevel = false;
            frm.ControlBox = false;
            frm.Parent = ctl;
            frm.FormBorderStyle = style;
            frm.Left = 0;
            frm.Top = 0;
            frm.Width = ctl.Width + 4;
            frm.Dock = DockStyle.Fill;
            frm.Show();
            //IMPORTANT: .Show() fires a form load event
            frm.BringToFront();

        }

        public static void ShowXFormInControl(XtraForm Xfrm, 
            ref XtraTabPage ctl, FormBorderStyle style)
        {
            Xfrm.TopLevel = false;
            Xfrm.ControlBox = false;
            Xfrm.Parent = ctl;
            Xfrm.FormBorderStyle = style;
            Xfrm.Left = 0;
            Xfrm.Top = 0;
            Xfrm.Width = ctl.Width + 4;
            Xfrm.Dock = DockStyle.Fill;
            Xfrm.Show();
            //IMPORTANT: .Show() fires a form load event
            Xfrm.BringToFront();

        }

        public static void ShowXFormInControl(XtraForm Xfrm, 
            ref XtraPanel ctl, FormBorderStyle style)
        {
            Xfrm.TopLevel = false;
            Xfrm.ControlBox = false;
            Xfrm.Parent = ctl;
            Xfrm.FormBorderStyle = style;
            Xfrm.Left = 0;
            Xfrm.Top = 0;
            Xfrm.Width = ctl.Width + 4;
            Xfrm.Dock = DockStyle.Fill;
            Xfrm.Show();
            //IMPORTANT: .Show() fires a form load event
            Xfrm.BringToFront();

        }

        public static void ShowFormInControl(Form frm, 
            ref Panel ctl, FormBorderStyle style)
        {
            {
                frm.TopLevel = false;
                frm.ControlBox = false;
                frm.Parent = ctl;
                frm.FormBorderStyle = style;
                frm.Left = 0;
                frm.Top = 0;
                frm.Width = ctl.Width + 4;
                frm.Dock = DockStyle.Fill;
                frm.Show();
                //IMPORTANT: .Show() fires a form load event
                frm.BringToFront();
            }
            //.SetBounds(ctl.Left, ctl.Top, ctl.Width, ctl.Height)
        }
        public static void ShowFormInControl(Form frm, 
            ref TabPage ctl, FormBorderStyle style)
        {
            {
                frm.TopLevel = false;
                frm.ControlBox = false;
                frm.Parent = ctl;
                frm.FormBorderStyle = style;
                frm.Left = 0;
                frm.Top = 0;
                frm.Width = ctl.Width + 4;
                frm.Dock = DockStyle.Fill;
                frm.Show();
                //IMPORTANT: .Show() fires a form load event
                frm.BringToFront();
            }
        }
        public static void ShowFormInControl(Form frm, 
            Panel ctl, FormBorderStyle style, FormWindowState state)
        {
            {
                frm.TopLevel = false;
                frm.ControlBox = false;
                frm.Parent = ctl;
                frm.FormBorderStyle = style;
                frm.Left = 0;
                frm.Top = 0;
                frm.Width = ctl.Width + 4;
                frm.WindowState = state;
                frm.Dock = DockStyle.Fill;
                frm.Show();
                //IMPORTANT: .Show() fires a form load event
                frm.BringToFront();
            }
            //.SetBounds(ctl.Left, ctl.Top, ctl.Width, ctl.Height)
        }
        public static void ShowFormInControl(Form frm, 
            TabPage ctl, FormBorderStyle style, FormWindowState state)
        {
            {
                frm.TopLevel = false;
                frm.ControlBox = false;
                frm.Parent = ctl;
                frm.FormBorderStyle = style;
                frm.Left = 0;
                frm.Top = 0;
                frm.Width = ctl.Width + 4;
                frm.WindowState = state;
                frm.Dock = DockStyle.Fill;
                frm.Show();
                //IMPORTANT: .Show() fires a form load event
                frm.BringToFront();
            }
        }
        public static void ShowFormInControl(Form frm, 
            ref Panel ctl, FormBorderStyle style, int left, int top)
        {
            {
                frm.TopLevel = false;
                frm.ControlBox = false;
                frm.Parent = ctl;
                frm.FormBorderStyle = style;
                frm.Left = left;
                frm.Top = top;
                frm.Width = ctl.Width + 4;
                frm.Dock = DockStyle.Fill;
                frm.Show();
                //IMPORTANT: .Show() fires a form load event
                //.Activate()
                frm.BringToFront();
            }
            //.SetBounds(ctl.Left, ctl.Top, ctl.Width, ctl.Height)
        }
        public static void ShowFormInControl(Form frm, 
            ref TabPage ctl, FormBorderStyle style, int left, int top)
        {
            {
                frm.TopLevel = false;
                frm.ControlBox = false;
                frm.Parent = ctl;
                frm.FormBorderStyle = style;
                frm.Left = left;
                frm.Top = top;
                frm.Width = ctl.Width + 4;
                frm.Dock = DockStyle.Fill;
                frm.Show();
                //IMPORTANT: .Show() fires a form load event
                //.Activate()
                frm.BringToFront();
            }
        }
        public static void ShowFormInControl(Form frm, 
            Panel ctl, FormBorderStyle style, int left, int top, string title)
        {
            {
                frm.TopLevel = false;
                frm.ControlBox = false;
                frm.Parent = ctl;
                frm.FormBorderStyle = style;
                frm.Left = left;
                frm.Top = top;
                frm.Width = ctl.Width + 4;
                frm.Text = title;
                frm.Dock = DockStyle.Fill;
                frm.Show();
                //IMPORTANT: .Show() fires a form load event
                frm.BringToFront();
            }
            //.SetBounds(ctl.Left, ctl.Top, ctl.Width, ctl.Height)
        }
        public static void ShowFormInControl(Form frm, 
            TabPage ctl, FormBorderStyle style, int left, int top, string title)
        {
            {
                frm.TopLevel = false;
                frm.ControlBox = false;
                frm.Parent = ctl;
                frm.FormBorderStyle = style;
                frm.Left = left;
                frm.Top = top;
                frm.Width = ctl.Width + 4;
                frm.Text = title;
                frm.Dock = DockStyle.Fill;
                frm.Show();
                //IMPORTANT: .Show() fires a form load event
                frm.BringToFront();
            }
        }
    }
}
</code></pre>

<p><hr /></p>

<p>I have the darnedest time posting code here and it turning out looking decent!</p>
","<c#><winforms><generics><.net-3.5><refactoring>","2","1032","2009-02-12 20:26:03"
"546487","Tools to identify code duplications","<p>I have being reading and tracking some questions on code reuse and I have this question:</p>

<p>Are there any tools to identify duplicate or similar code?</p>

<p>I have googled this a while ago and found nothing good.</p>
","<tools><refactoring><code-reuse><code-duplication><code-quality>","52","2030","2009-02-13 16:02:33"
"549369","How / if to refactor a Delphi program using only forms and data modules","<p>After years of coding Delphi programs as untestable code in forms and datamodules, including global variables, and the only classes are the forms themselves, containing all the code I need for the form UI itself.</p>

<p>How would I convert the code to a set of classes that do the actual work? would I need to stop using the datasources/datasets and do everything in classes? do I need an ORM?</p>

<p>There's usually <strong>zero</strong> need for reuse of the code in the forms, so does it make sense to convert the logic to classes?</p>
","<delphi><unit-testing><oop><refactoring><datamodel>","18","1111","2009-02-14 17:04:57"
"549158","How do you avoid duplicate unit tests when testing interactions on composites?","<p>Imagine a system of filters (maybe audio filters, or text stream filters).</p>

<p>A <code>Filter</code> base class has a <code>do_filter()</code> method, which takes some input, modifies it (perhaps), and returns that as output.</p>

<p>Several subclasses exist, built with TDD, and each has a set of tests which test them in isolation.</p>

<p>Along comes a composite class, of an unrelated type <code>Widget</code>, which has two members of different <code>Filter</code> types (<code>a</code> and <code>b</code>), which deal with quite different input - that is, certain input which would be modified by filter <code>a</code> is passed through unmodified by filter <code>b</code>, and vice versa. Its <code>process_data()</code> method calls each filter member's <code>do_filter()</code>.</p>

<p>While developing the composite class, there emerge tests that check the assumption that <code>Widget</code>'s filters aren't both processing the same data.</p>

<p>The problem is, these sort of tests look identical to the individual filter's test. Although there might be other tests, which test input which should be modified by both filters, many of the tests could almost be <em>copied and pasted</em> from each of the filter's tests, with only small modifications needed to have them test with <code>Widget</code> (such as calling <code>process_data()</code>), but the input data and the assert checks are identical.</p>

<p>This duplication smells pretty bad. But it seems right to want to test the components' interactions. What sort of options will avoid this sort of duplication?</p>
","<unit-testing><refactoring>","1","187","2009-02-14 14:06:45"
"551578","How to break multiple foreach loop?","<p>I have four foreach loops that iterate through the collections and based on a condition do something. Here is the code that I am writing now:</p>

<pre><code>boolean breakFlag = false;
String valueFromObj2 = null;
String valueFromObj4 = null;
for(Object1 object1: objects){
  for(Object2 object2: object1){
    //I get some value from object2
    valueFromObj2 = object2.getSomeValue();
    for(Object3 object3 : object2){
      for(Object4 object4: object3){
       //Finally I get some value from Object4.
       valueFromObj4 = object4.getSomeValue();
       //Compare with valueFromObj2 to decide either to break all the foreach loop
       breakFlag = compareTwoVariable(valueFromObj2, valueFromObj4 );
       if(breakFlag){break;}
      }//fourth loop ends here
      if(breakFlag){break;}
    }//third loop ends here
    if(breakFlag){break;}
  }//second loop ends here
  if(breakFlag){break;}
}//first loop ends here
</code></pre>

<p>The main object (objects in the code) comes from a third party provider SDK, so I cannot change anything on that portion. I want to ask the stackoverflow community if there is a better approach to break all the four foreach loop. Or if there is any other way to refactor this code to make it more readable and maintainable. Thanks.</p>
","<java><refactoring><foreach>","11","13041","2009-02-15 21:01:25"
"549985","Refactoring in model: what's going wrong?","<p>I'm currently trying to DRY up this initial verbose code:</p>

<pre><code>def planting_dates_not_nil?
    !plant_out_week_min.blank? || !plant_out_week_max.blank? || !sow_out_week_min.blank? || !sow_out_week_max.blank?
  end

  def needs_planting?(week)
    if !plant_out_week_min.blank? &amp;&amp; !plant_out_week_max.blank?
      (plant_out_week_min..plant_out_week_max).include? (week) 
    end
  end

  def needs_sowing?(week)
    if !sow_out_week_min.blank? &amp;&amp; !sow_out_week_max.blank?
      (sow_out_week_min..sow_out_week_max).include? (week)
    end 
  end

  def needs_harvesting?(week)
    if !harvest_week_min.blank? &amp;&amp; !harvest_week_max.blank?
      (harvest_week_min..harvest_week_max).include? (week) 
    end
  end
</code></pre>

<p>here's my intial attempt:</p>

<pre><code>  def tasks_for_week(week,*task_names)
    task_names.each do |task_name|
      to_do_this_week = []
        unless read_attribute(task_name).nil?
          if (read_attribute(""#{task_name}_week_min"")..read_attribute(""#{task_name}_week_max"")).include? (week)
            to_do_this_week &lt;&lt; task_name
          end
        end
      end
  end
</code></pre>

<p>However, when I run this code in the console as follows:</p>

<pre><code>p.tasks_for_week(Date.today.cweek, :plant_out, :sow_out])
</code></pre>

<p>I get an unexpected result...even though the plant does not need to be planted out, I still get an array of both task names returned ( [:plant_out, :sow_out]</p>

<p>Can anyone let me know how I'd clean this up and have the tasksforweek method return the expected results?</p>

<p>TIA</p>
","<ruby-on-rails><refactoring><models><refactor-my-code>","0","138","2009-02-14 23:29:36"
"558521","Evolution or Revolution to fix poorly written code","<p>I've done some work for a personal project of mine, and now I understand why people tell us to plan out all our interfaces and design <em>before</em> coding. I've got some good classes and already have some working code, but all in all the the organization (architecture) is somewhat of a mess, and I'm already saying ""If I did it again, I would do it like this..."". The question is, should I sketch out a plan of how I want my code to look, and refactor the existing code to the new model, or if I should take what works great, and write all new code for the deficient parts (basically starting from scratch with a fair amount of copy and paste from this project).</p>

<p>I've got git history I'm not sure I want to lose, but the task of slowly rewriting everything seems daunting. So the question I'm asking is: when refactoring a young project, should one use evolution or revolution to get it right the second time?</p>
","<refactoring>","6","283","2009-02-17 20:13:45"
"559042","Refactoring plug-in for Visual Studio 2003","<p>Are there any free refactoring tools available for Visual Studio 2003?  <a href=""http://www.jetbrains.com/resharper20/download/index.html"" rel=""nofollow"">ReSharper</a> seems to require a license key.</p>
","<visual-studio><plugins><refactoring><visual-studio-2003>","2","670","2009-02-17 22:36:59"
"559089","Should I use VS 2008 refactoring support or buy ReSharper?","<p>Should I use VS 2008 refactoring support or buy ReSharper?</p>

<p>What are some of really good things you can do using ReSharper that cannot be done using VS 2008 refactoring support?</p>
","<visual-studio-2008><tools><refactoring><resharper>","4","743","2009-02-17 22:50:31"
"560816","Advice on converting a design-by-accretion Flex project to Mate","<p>We have an internal Flex application which has been designed more through feature creep than by any kind of clear vision. It's basically a kind of CRM and reporting system which utilises quite a lot of Flex components (trees, graphs, custom components, datagrids - all sorts) and talks to a .NET webservice backend.</p>

<p>It was initially my first Flex project and has been written with the bodge, hope and repair kind of style you might expect from a prototype. However, it's now grown to the point where we'll be adding other (neophyte) developers, but it might not be impossible for one person (<em>sigh</em>, probably me) to rewrite the current snapshot in about a month. So, at this stage I'm thinking it might be a good idea to consider a new version implemented in the <a href=""http://mate.asfusion.com/"" rel=""nofollow"">Mate</a> framework.</p>

<p>I don't need advice on which framework to choose, what I <em>would</em> like is advice on how to go about refactoring the project. It seems like this will involve tearing everything down and pretty much starting again (which I'm not totally averse to), but does the framework have to be built in from the ground up? Are there any known and recommended methods of attacking this kind of problem?</p>
","<flex><architecture><refactoring><frameworks><mate>","2","142","2009-02-18 12:16:48"
"561401","Refactor my C# code - Switch statement","<p>I have the following code which I am are currently using .... Basically, this method assigns the correct boolean flag (TRUE/FALSE) for each Task. As more and more tasks need to be added .. I can see that the switch statement will have to grow to cater for every task.</p>

<p>There has to be an easier way ... to keep the method small.</p>

<p>Code: (forget naming convention, it has been changed for posting)</p>

<pre><code>public ClassStructure.User AssignTaskStatusToUser(ClassStructure.User,
                                                  List&lt;ClassStructure.Tasks&gt; TaskStatus)
{
    foreach (ClassStructure.Tasks data in TaskStatus)
    {
        string Task_CallID = data.Task_Call_ID;

        switch (Task_CallID)
        {
            case ClassStructure.Tasks_CallIDs_Strings.TASK1:
                User.TASK1 = data.Task_Flag;
                break;

            case ClassStructure.Tasks_CallIDs_Strings.TASK2:
                User.TASK2 = data.Task_Flag;
                break;

            case ClassStructure.Tasks_CallIDs_Strings.TASK3:
                User.TASK3 = data.Task_Flag;
                break;
        }
    }

    return User;
}
</code></pre>

<p>ClassStructure.Tasks_CallIDs_Strings = String Representation of the Tasks </p>

<p>data.Task_Flag = boolean</p>

<p>User.TASKX = boolean</p>

<p>Any feedback is welcome. I am sure there is an easy solution.</p>
","<c#><refactoring><switch-statement>","3","1524","2009-02-18 14:58:33"
"560904","Automatically deleting unused local variables from C source code","<p>I want to delete unused local variables from C file.
Example:</p>

<pre><code>int fun(int a , int b)
{
  int c,sum=0;
  sum=a + b;
    return sum;
}
</code></pre>

<p>Here the unused variable is 'c'.</p>

<p>I will externally have a list of all unused local variables.  Now using unused local variables which I have, we have to find local variables from source code &amp; delete.<br />
In above Example ""c"" is unused variable. I will be knowing it (I have code for that).
Here I have to find c &amp; delete it .</p>

<p><strong>EDIT</strong></p>

<p>The point is not to find unused local variables with an external tool. The point is to remove them from code given a list of them.</p>
","<c><automated-refactoring>","6","2843","2009-02-18 12:43:56"
"562462","When is it a good use of time to refactor string literals?","<p>I'm starting on a project where strings are written into the code most of the time.  Many strings might only be used in a few places but some strings are common throughout many pages.</p>

<p>Is it a good use of my time to refactor the literals into constants being that the app is pretty well established and runs well?  What would be the long-term benefits to doing so?</p>
","<string><refactoring><internationalization><constants><literals>","1","207","2009-02-18 19:23:59"
"561649","How to improve method for assigning grid permissions","<p>I've got an ASP.NET (VB.NET) page that has an <a href=""http://www.infragistics.com/"" rel=""nofollow"">Infragistics</a> grid on it. One of the columns is called 'status'.</p>

<p>When I load the grid, I'm setting permissions to the fields at the column level, granting user roles (ENUM 'UserTypes') read/only or read/write permissions. </p>

<p>Next I need to loop through each row and assign permissions based upon the value (ENUM StatusVals) in the field 'status' as well as the user role. </p>

<p>I've got all this working, but it seems clunky and I want to improve it. </p>

<p>Here's a snapshot of one of the methods in which I pass in a row, the record status for that row, and the user type and loop through the cells to assign the permissions and colors. The question is: is there a more elegant way to do this so that as I add to it, it doesn't become a beast? </p>

<pre><code>    Private Shared Sub SetDetailRowReadWrite_ByStatusVal(ByVal DetailRow As
 ig.UltraGridRow, ByVal sv As StatusVals, ByVal UserType As UserRoles)
    If sv = StatusVals.Pending _
        OrElse sv = StatusVals.Released _
        OrElse sv = StatusVals.Shipped _
        OrElse sv = StatusVals.Consolidated _
        OrElse sv = StatusVals.HOLD _
        OrElse sv = StatusVals.Cancelled _
        OrElse sv = StatusVals.PartialShipped Then

        For Each column As ig.UltraGridCell In DetailRow.Cells
            If column.Key = ""StatusVal"" Then
                column.Style.BackColor = Drawing.Color.LightGreen
                column.Style.ForeColor = Drawing.Color.Black

                If UserType = UserRoles.Fulfillment Then
                    SetFulfillmentStatusValEditPermission(sv, column)
                End If
            ElseIf Not (sv = StatusVals.Consolidated AndAlso UserType = UserRoles.Fulfillment) Then
                column.Style.BackColor = Drawing.Color.White
                column.AllowEditing = ig.AllowEditing.No
            End If
        Next

        LockSizesRow(DetailRow, UserType, sv)

    ElseIf sv = StatusVals.Incomplete AndAlso UserType = UserRoles.Fulfillment Then
        For Each c As ig.UltraGridCell In DetailRow.Cells
            c.AllowEditing = UltraWebGrid.AllowEditing.No
        Next
    End If
End Sub
</code></pre>
","<asp.net><design><refactoring>","0","82","2009-02-18 15:50:16"
"568751","Is it good practice to create once-used variables?","<p>A colleague of mine refactored this code:</p>

<pre><code>private void btnGeneral_Click(object sender, RoutedEventArgs e)
{
    Button button = (Button)e.OriginalSource;
    Type type = this.GetType();
    Assembly assembly = type.Assembly;
    string userControlFullName = String.Format(""{0}.{1}"", type.Namespace, button.Name);
    UserControl userControl = (UserControl)assembly.CreateInstance(userControlFullName);
}
</code></pre>

<p>to this code:</p>

<pre><code>private void btnGeneral_Click(object sender, RoutedEventArgs e)
{
    Button button = (Button)e.OriginalSource;
    Type type = this.GetType();
    Assembly assembly = type.Assembly;
    UserControl userControl = (UserControl)assembly.CreateInstance(String.Format(""{0}.{1}"", type.Namespace, button.Name));
}
</code></pre>

<p>saying that you don't need to create a variable if it is only going to be used once.</p>

<p>My response was that making once-used variables is good practice since it:</p>

<ul>
<li>functions as and reduces comments (it is clear what ""userControlFullName"" is)</li>
<li>makes code easier to read, i.e. more of your code ""reads like English""</li>
<li>avoids super-long statements by replacing parts of them with clear variable names</li>
<li>easier to debug since you can mouse over the variable name, and in the cases of e.g. PHP programming without debuggers, it is easier to echo out these variable names to get their values</li>
</ul>

<p>The arguments against this way ""more lines of code"", ""unnecessary variables"" are arguments to make life easier for the compiler but with no significant speed or resource savings.</p>

<p>Can anyone think of any situations in which one should not create once-used variable names?</p>
","<variables><refactoring><coding-style>","20","609","2009-02-20 08:41:08"
"573208","Django templates - Regrouping by a string parameter","<p>I have the following code in one of my Django templates that I want to refactor:</p>

<pre><code>{% ifequal sort_type ""set"" %} 
	{% regroup cards by set as grouped %}	
{% endifequal %}
{% ifequal sort_type ""rarity"" %} 
	{% regroup cards by rarity as grouped %}
{% endifequal %}
</code></pre>

<p>It does work, but it's really ugly and I want to make it more like this:</p>

<pre><code>{% regroup cards by sort_type as groupedcards %}
</code></pre>

<p>But this doesn't work (it just puts them all in a single group called None.) From the documentation, I think it might be trying a dictionary lookup (i.e., calling card[""set""] instead of card.set).</p>

<p>Is there a good way to do this in the template, or should I move the regrouping out into the Python code using itertools?</p>
","<django><google-app-engine><refactoring><django-templates>","0","564","2009-02-21 15:20:05"
"577083","Is there a point where cost of refactoring outweighs the cost of re-writing?","<p>We have some really shocking code touted as a next generation framework at my current place of employment.</p>

<p>Thing is, there is only one person of this opinion and that is the guy who wrote most of it. The rest of the department are of the impression it is badly coded, a pita to debug and just a bit naff in general.</p>

<p>The guy that wrote it has a pretty influential position with management so they are on that side of the camp.</p>

<p>We have highlighted (genuine) concerns to management but obviously they're not willing to put more time in to a project that doesn't directly contribute to the bottom line.</p>

<p>There are several applications deployed on this framework so any refactoring will need to encompass those applications.</p>

<p>The whole thing is so intertwined that we cant just rip out an implementation of a particular class and rewrite it that way so even simple changes to core api mean a large project.</p>

<p>It does however have 3 years in live deployment and many bug fixes, corner cases and boundary conditions catered for.</p>

<p>Do we rewrite in parts and try to refactor that in given that it would be several large projects, refactor over time which is likely to take another 3 years to get it in to shape or do we just rewrite our specific requirements on top of an existing framework?</p>
","<php><refactoring><frameworks><legacy>","8","276","2009-02-23 10:01:41"
"579454","Big class decomposition in Java","<p>I have just started to learn Java and is curious is it any good practice in Java for good object decomposition? Let me describe a problem. In big software project it's always a big classes like 'core' or 'ui' that tends to have a lot of methods and are intended as a mediators between smaller classes. For example, if user clicks a button on some window, this window's class sends a message to 'ui' class. This 'ui' class catches this message and acts accordingly by doing something with application user interface ( via calling method of one of it's member objects ) or by posting message to application 'core' if it's something like 'exit application' or 'start network connection'.</p>

<p>Such objects is very hard to break apart since they are a mere mediators between a lots of small application objects. But having a classes in application with hundreds and thousands of methods is not very handy, event if such methods are trivial task delegation from one object to another. C# solves such problem by allowing to break class implementation into multiple source files: you can divide god object any way you choose, and it will work.</p>

<p>Any practices by dividing such objects in Java?</p>
","<java><architecture><oop><refactoring>","4","1945","2009-02-23 21:33:05"
"581292","Does anyone know of any good PHP analysis & refactoring tools?","<p>At present we have a rather large (4k+ loc) function that we wish to decompose in to separate functions.</p>

<p>Some of it has been decomposed where there are relatively encapsulated side effects and these ones are the easy bits.</p>

<p>However we now have ~3k loc of intertwined nastyness. Some vars are passed to external functions by ref and all sorts.</p>

<p>So, is anyone aware of any php refactoring tools that allow you to determine state modifications and side effects of a particular piece of code (including new references to variables which may be stored as members and modified later).</p>

<p>We have thus far being doing this by stepping into the called functions with xdebug but this is extremely intensive and some of the call stacks get quite deep.</p>

<p>If no-one knows of any libraries that do this as-is, can anyone think of a way of implementing this robustly? (Shy of adding features to xdebug which is beyond the scope of our project :'( )</p>

<p>EDIT:
Also, I forgot to mention that this is legacy code so there are zero unit tests to verify behaviour.</p>
","<php><refactoring><analysis>","2","1275","2009-02-24 10:47:04"
"583646","Speed boost to adjacency matrix","<p>I currently have an algorithm that operates on an adjacency matrix of size n by m. In my algorithm, I need to zero out entire rows or columns at a time. My implementation is currently O(m) or O(n) depending on if it's a column or row.</p>

<p>Is there any way to zero out a column or row in O(1) time?</p>
","<performance><algorithm><refactoring>","3","693","2009-02-24 21:18:17"
"583708","How do you refactor a class that is constantly being edited?","<p>Over the course of time, my team has created a central class that handles an agglomeration of responsibilities and runs to over 8,000 lines, all of it hand-written, not auto-generated.</p>

<p>The mandate has come down. We need to refactor the monster class. The biggest part of the plan is to define categories of functionality into their own classes with a has-a relationship with the monster class.</p>

<p>That means that a lot of references that currently read like this:</p>

<pre><code>var monster = new orMonster();
var timeToOpen = monster.OpeningTime.Subtract(DateTime.Now);
</code></pre>

<p>will soon read like this:</p>

<pre><code>var monster = new Monster();
var timeToOpen = monster.TimeKeeper.OpeningTime.Subtract(DateTime.Now);
</code></pre>

<p>The question is: How on Earth do we coordinate such a change? References to ""orMonster"" litter every single business class. Some methods are called in literally thousands of places in the code. It's guaranteed that, any time we make such a chance, someone else (probably multiple someone elses) on the team will have code checked out that calls the .OpeningTime property</p>

<p>How do you coordinate such a large scale change without productivity grinding to a halt?</p>
","<language-agnostic><version-control><refactoring>","9","402","2009-02-24 21:35:55"
"589040","TFrame inheritance refactoring","<p>Yet another TFrame IDE-registered-component question from me.  Thanks for all the help, fellow programmers. : )</p>

<p>Playing around with Darrian's TFrame inheritance suggestion <a href=""http://stackoverflow.com/questions/382562/delphi-visual-component-moving-away-from-tframe-base/382607#382607"" rel=""nofollow"" title=""earlier TFrame question / comment"">here</a>:</p>

<p><strong>Specifics:</strong></p>

<p>Basically, I have a TFrame-based component that I've registered to the IDE, and it has worked wonderfully.  I'm now developing a few ""sister"" components which will share a great deal of the existing component's non-visual functionality and properties.  It makes sense, then, to move a lot of that to a parent/superclass which both the new and the old components can then inherit from.</p>

<p>What is the best way to ""refactor"" TFrame inheritance in this way?  (This may apply to TForm-class descendants too, not sure).  What are the caveats and things to watch out for?</p>

<p><strong>Example:</strong></p>

<p>I tried, for example, creating a new TFrame, with nothing on it, and calling that frame TMyBaseFrame.  Then modified the class definition of my existing component (Let's call it TMyFrameTreeView) to inherit from that rather than TFrame.</p>

<p>It compiled fine, but when I tried dropping it on a form, I got ""ClientHeight not found"" (or ""ClientHeight property not found""), and it wouldn't drop on the form.  Deleting ClientHeight and ClientWidth from the related DFM wreaked havoc, and they ended up replaced upon resizing anyway.  I noticed ExplicitHeight and ExplicitWidth in descendent classes, and am thinking that relates to property-value overrides from inherited values, but am not sure.  Recreating an entirely new frame via New -> Inherited Items, and then copying everything over, hasn't yielded great results yet either.</p>

<p><strong>Final Note</strong></p>

<p>I realize this could get messy quickly, with streaming DFM files and multiple generations of descendants, etc.... which is part of why I'm asking for the overall ""things to look out for"" conceptual aspect, but also giving a specific real-world <em>simpler</em> version of the problem as well (which seems to me, ought to be doable).</p>

<p>I've created a little test package to hack around in learning attempts, and am learning a great deal, but it's slow-going, and any guidance/insight from you Delphi ""Jedi Masters"" out there would be MOST appreciated.  : )  </p>

<p><br><br />
<strong>Answer update later:</strong></p>

<p>Both of the answers below were helpful.  As well, creating a ""Base Frame Class"" which has NO changes from the normal TFrame, and THEN inheriting from that before adding any properties, methods, etc. seems to stabilize the inheritance streaming tremendously.  Not sure why, but so far it has.</p>
","<delphi><inheritance><refactoring><custom-component><tframe>","2","960","2009-02-26 03:56:45"
"589175","How to refactor rapidly evolving code?","<p>I have some research code that's a real rat's nest, with code duplication everywhere, and clearly needs to be refactored.  However, the code base is evolving as I come up with new variations on the theme and fit them into the codebase.  The reason I've put off refactoring so long is because I feel like the minute I spend a few days coming up with good abstractions, seeing what design patterns fit where, etc., I'll want to try out some new unforeseen idea that makes my abstractions completely inadequate.  In other words, because of the rate at which the code is evolving, I really have no idea where abstraction lines belong, even though there is no shortage of (approximate) duplication and the general messiness of the code makes adding stuff to it a real pain.  What are some general best practices for coping with this kind of situation?</p>
","<coding-style><refactoring><code-duplication><evolution>","6","518","2009-02-26 05:02:20"
"590803","How much time do you spend on research / refactoring?","<p>Staying up-to-date is essential in the programming world as new technologies / methods etc.. are so quick to arrive (and depart). So how much time do you spend doing this? Does your employer allow you to do this on their time? Or do they expect that as a professional it is up to you to keep your skills up?</p>

<p>On a related subject, how much time do you spend refactoring your code? Do you find yourself having to push projects through the door using the same tired old codebase or do you make sure you have the time to maintain and update it accordingly? How easy do you find it to convince your employer that spanding x time refactoring will save twice that in maintainence time down the road?</p>
","<language-agnostic><refactoring><research><time-management>","4","401","2009-02-26 14:34:44"
"591228","Automatically refactor a loop into a recursive method?","<p>Do you know a tool that automatically refactors a method with a single loop into a recursive method, preferably in Java?</p>

<p>This is for teaching purposes.</p>
","<java><refactoring><recursion><loops>","3","857","2009-02-26 16:09:16"
"592350","What successful conversion/rewrite of software have you done?","<p>What successful conversion/rewrite have you done of software you were involved with? What where the languages and framework involved in the process? How large was the software in question? Finally what is the top one or two thing you learned from being involved with the process.</p>

<p>This is related to this <a href=""http://stackoverflow.com/questions/592354/what-failed-conversion-rewrite-of-sofware-have-you-done"">question</a></p>
","<refactoring><code-migration>","8","405","2009-02-26 20:43:05"
"592354","What failed conversion/rewrite of software have you done?","<p>What conversion/rewrite have you been involved with that failed? What where the languages and framework involved in the process? How large was the software in question? Finally what is the top one or two thing you learned from being involved with the process.</p>

<p>This is related to this <a href=""http://stackoverflow.com/questions/592350/what-successful-conversion-rewrite-of-sofware-have-you-done"">question</a>.</p>
","<refactoring><code-migration>","3","207","2009-02-26 20:44:54"
"593792","C++ Directory Restructuring","<p>I have a source code of about 500 files in about 10 directories. I need to refactor the directory structure - this includes changing the directory hierarchy or renaming some directories. </p>

<p>I am using svn version control. There are two ways to refactor: one preserving svn history (using svn move command) and the other without preserving. I think refactoring preserving svn history is a lot easier using eclipse CDT and SVN plugin (visual studio does not fit at all for directory restructuring). </p>

<p>But right now since the code is not released, we have the option to not preserve history.</p>

<p>Still there remains the task of changing the include directives of header files wherever they are included. I am thinking of writing a small script using python - receives a map from current filename to new filename, and makes the rename wherever needed (using something like sed). Has anyone done this kind of directory refactoring? Do you know of good related tools?</p>
","<c++><refactoring>","6","314","2009-02-27 06:59:57"
"594722","What standard optimization refactoring can I do to my Java application?","<p>I have a semi big Java application. It's written quite poorly and I suspect there are quite a lot of simple things I can do that will clean things up a bit and improve performance.</p>

<p>For example I recently found the</p>

<pre><code>String.matches(regex)
</code></pre>

<p>function used quite a lot in loops with the same regex. So I've replaced that with <a href=""http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html#matches%28java.lang.String,%20java.lang.CharSequence%29"" rel=""nofollow"">precompiled Patterns</a>. I use FindBugs (which is great BTW) but that didn't spot this problem and I'm limited on tools that I can use here at work.</p>

<p>Is there anything else simple like this that I should look at? </p>
","<java><optimization><refactoring><findbugs>","4","293","2009-02-27 13:27:13"
"597687","Changing Variable Names in Vim","<p>I am trying to read a lot of c/perl code through vim which contain many single letter variable names.  </p>

<p>It would be nice to have some command which could help me change the name of a variable to something more meaningful while I'm in the process of reading the code so that I could read the rest of it faster.<br />
Is there some command in vim which could let me quickly do this. </p>

<p>I dont think regexes would work cos<br />
1) the same single letter name might have different purposes in different scoping blocks<br />
2) the same combination of letters could part of another larger var name, or in a string or comment .. would not want to modify those  </p>

<p>Any known solutions??</p>
","<vim><variables><refactoring>","12","2068","2009-02-28 07:29:54"
"610350","Multiple Java projects and refactoring","<p>I have recently joined a project that is usiing multiple different projects. A lot of these projects are depending on each other, using JAR files of the other project included in a library, so anytime you change one project, you have to then know which other projest use it and update them too. I would like to make this much easier, and was thinking about merging all this java code into one project in seperate packages. Is it possible to do this and then deploy only some of the packages in a jar. I would like to not deploy only part of it but have been sassked if this is possible.</p>

<p>Is there a better way to handle this?</p>
","<java><refactoring><packages><packaging>","1","887","2009-03-04 12:35:47"
"609858","Code replication and refactoring","<p>I would like to hear opinions on small amounts of code replication within methods that
check for the same condition
e.g.</p>

<pre><code>While(condition){
...... do x 

}
</code></pre>

<p>Normally if there was any of this kind of replication I would refactor the code as it can make versioning a nightmare, what if the condition changes for example you have to change every instance, not a nice job to do. 
However what if the condition is relatively simple and is only used within say 3 methods is it wise to refactor,</p>

<p>So in summary where do people draw the line at refactoring code?</p>
","<refactoring>","0","360","2009-03-04 09:31:25"
"610588","When should I break a function?","<p>Its prudent to break a long function into a chief function and helper functions.</p>

<p>I know that the outside the module only chief function will be called, but its long length may prove to be intimidating.</p>

<p>Textbooks put a limit on the number of lines, but I feel that this is too rigid.</p>

<p>P.S. I am programming in Python and need to process incoming, messages. The function returns a tuple containing the message but in Python's internal data types.
So you can see somewhat independent code for each message type.</p>

<p><strong>Duplicate Question</strong></p>

<p><a href=""http://stackoverflow.com/questions/475675/when-is-a-function-too-long"">http://stackoverflow.com/questions/475675/when-is-a-function-too-long</a></p>
","<refactoring>","5","618","2009-03-04 13:41:09"
"614794","C/C++: Detecting superfluous #includes?","<p>I often find that the headers section of a file get larger and larger all the time but it never gets smaller. Throughout the life of a source file classes may have moved and been refactored and it's very possible that there are quite a few <code>#includes</code> that don't need to be there and anymore. Leaving them there only prolong the compile time and adds unnecessary compilation dependencies. Trying to figure out which are still needed can be quite tedious.</p>

<p>Is there some kind of tool that can detect superfluous #include directives and suggest which ones I can safely remove?<br />
Does lint do this maybe?</p>
","<c++><c><refactoring><include><dependencies>","49","7087","2009-03-05 13:43:53"
"614835","Best approach to separate and re-factor a large number of dependent classes","<p>I have a v-large number of hierarchical structures (or DTO's) that are shared across different business logic, application tiers, web service and WCF contracts. I want to refactor all of my code to split the structures into discreet business domain areas.</p>

<p>Two questions:</p>

<ol>
<li><p>Are there any tools that can help me do this (given that I want class A, list all of the dependencies)?</p></li>
<li><p>Is there a case for duplicating DTO's in different application domains to allow them to evolve independently? The idea of a fixed Canonical Business Model is pure fiction!</p></li>
</ol>
","<.net><refactoring><code-reuse><dto>","1","144","2009-03-05 13:52:31"
"615614","At what point does refactoring become not worth it?","<p>Say you have a program that currently functions the way it is supposed to. The application has very poor code behind it, eats up a lot of memory, is unscalable and would take major rewriting to implement any changes in functionality.</p>

<p>At what point does refactoring become less logical then a total rebuild?</p>
","<refactoring><scalability><maintainability><rebuild>","9","490","2009-03-05 16:46:31"
"617646","Is this wrapper for PDO 'good code' ? Are there any potential problems?","<p>I built this class to work with PDO, to make SQL queries 'easier' and less to worry about. </p>

<p>Here are my thoughts</p>

<ul>
<li>Should it be more like class DB extends PDO?</li>
<li>Is the query method too big? Should it be split into private methods which are called.. is this what is known as <em>loose coupling</em>?</li>
<li>Is my way for detecting a SELECT query too ugly for it's own good? </li>
<li>What other problems are evident? As I am sort of learning-as-I-go, I'm sure I could have overlooked a lot of potential problems.</li>
</ul>

<p>Thank you</p>

<p>` 

<pre><code> class Db
 {
    private static $_instance = NULL;


    private function __construct() {

    	// can not call me
    }

    private function __clone() {

    	// no!
    }

    public static function getInstance() {

    	if (!self::$_instance)
    	{

    		try {

    			self::$_instance = new PDO('mysql:host=' . CONFIG_MYSQL_SERVER . ';dbname=' . CONFIG_MYSQL_DATABASE, CONFIG_MYSQL_USERNAME, CONFIG_MYSQL_PASSWORD);;
    			self::$_instance-&gt; setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    		} catch(PDOException $e) {

    			trigger_error($e-&gt;getMessage());

    		}

    	}

    	return self::$_instance;


    }



    public static function query($query /*string*/, $bindings = NULL)
    {

    	$queryPortion = substr($query,0, 6);

    	try {

    		if ($bindings) {

    				$prepared = self::getInstance()-&gt;prepare($query);

    				foreach($bindings as $binding=&gt;$data) { // defaults to string

    					if (!is_array($data)) {
    						$prepared-&gt;bindParam($binding, $data); 

    					} else {

    						switch(count($data)) {

    							case 1:
    								$prepared-&gt;bindParam($binding, $data['value']);
    								break;							

    							case 2:
    								$prepared-&gt;bindParam($binding, $data['value'], $data['dataType']);
    								break;

    							case 3:
    								$prepared-&gt;bindParam($binding, $data['value'], $data['dataType'], (int)$data['length']);
    								break;							

    							default:
    								trigger_error('An error has occured with the prepared statement bindings.');
    								return false;
    								break;
    						}
    					}

    				}

    				$prepared-&gt;execute();

    				return $prepared-&gt;fetchAll(PDO::FETCH_ASSOC);


    		} else if (String::match($queryPortion, 'select')) { // if this is a select query

    			$rows = self::getInstance()-&gt;query($query);

    			return $rows-&gt;fetchAll(PDO::FETCH_ASSOC);

    		} else {

    			return self::getInstance()-&gt;exec($query);

    		}


    	} 
    	catch(PDOException $e)
    	{
    		trigger_error($e-&gt;getMessage());
    	}


    }

    public static function getLastInsertId()
    {
    	try {
    		self::getInstance()-&gt;lastInsertId();
    	  }
    	catch(PDOException $e)
    	{
    		trigger_error($e-&gt;getMessage());
    	}

    }

    public static function disconnect()
    {
    	// kill PDO object
    	self::$_instance = NULL;

    }
 }
</code></pre>
","<php><refactoring><pdo>","5","3274","2009-03-06 03:55:41"
"619131","How do YOU factor your Domain (namespaces), in Domain Driven Design?","<p>How do YOU factor your Domain (namespaces), in Domain Driven Design?</p>

<p>I have been moving to the following concept:</p>

<pre><code>Project.Entity
  Project.Entity.Abstracts
  Project.Entity.Entities
  Project.Entity.Extensions
  Project.Entity.Immutables
  Project.Entity.Interfaces
  Project.Entity.Repositories
</code></pre>

<p>For example, I have an entity in a CMS called ""Content"".  So, I would create a project called Project.Content, and factor the classes to look like:</p>

<pre><code>interface IContent
class Content : IContent

interface IContentRepository
class ContentRepository : IContentRepository
</code></pre>

<p>This ""Content"" Entity model would have its own namespace.</p>

<p>But, I am finding it does not scale well in a large Enterprise environment with well over a dozen projects (try 18) of ""Entity"" models.  I end up with a solution with over a dozen projects, some of which only have 2 or 3 classes (i.e. UrlRewriter).  Also, I find myself referencing other projects just for their Interfaces.  I feel like this is poluting my domain; while not concret references, it's sometimes difficult to keep from circular references.</p>

<p>So, I fall back to the ""Layer"" concept at times...</p>

<p>I am wanting to know how other DDD experts are factoring Enterprise-size applications.  Please feel free to recommend books and articles.  </p>

<p>And thanks in advance!</p>
","<refactoring><domain-driven-design>","3","309","2009-03-06 14:55:01"
"621078","Implementing empty iterators","<p>I have this code: </p>

<pre><code>    public IEnumerable&lt;int&gt; Iterator {
        get { if (false) yield return -1; }
    }
</code></pre>

<p>It is fairly ugly, but when you try to refactor it to: </p>

<pre><code>    public IEnumerable&lt;int&gt; Iterator {
        get { return null; }
    }
</code></pre>

<p>The following code breaks: </p>

<pre><code>foreach (var item in obj.Iterator) {
}
</code></pre>

<p>How would you go about cleaning this up? </p>
","<c#><refactoring><iterator>","0","195","2009-03-07 01:11:31"
"625030","Refactoring fun: dealing with complicated state","<p>Let's say we have a web app out there that is supposed to have a user fill out a form, and then it creates a ticket in the backend workflow engine. This form is going to continue to be the portal for the customer to view what's going on. Some forms go straight to ticket creation; others have to get approved by someone else before generating a ticket, and they can also be denied. This thing sends out emails, tracks answers to the questions of the form, tracks any uploaded attachments, and also logs ""updates"" as various actions are made to change the state of the form.</p>

<p>The business logic to decide what all to do when the form is first submitted or saved is starting to get hairy and I'm looking on ways to refactor it. I've started to look at state/strategy patterns, but it seems like all the logic just needs to get lumped together in one place eventually anyway. Plus, with all the dependencies on answers/attachments/log entries, it makes it complicated to inject mocks into because it has so much that it has to track.</p>

<p>Here's a pseudocode-ish layout of the form object's ""save"" functionality, simplified down...it's starting to get nasty and I'm trying to see if I can make it cleaner somehow.</p>

<pre><code>if(this.isvalid)
{
    if(isNewForm &amp;&amp; !this.needsApproval) //just created, so start up a ticket
    {
    	CreateTicket();
    }

    if(!isNewForm &amp;&amp; justApproved) //pulled from the DB earlier, and was just approved
    {
    	CreateTicket();
    }

    if(!isNewForm &amp;&amp; justDenied) //pulled from the DB earlier, and was just denied
    {
    	this.needsApproval = false;
    	this.closed = true;
    }

    if(isNewForm)
    {
    	SendNewFormEmail();
    	if(this.NeedsApproval)
    	{
    		SendNeedsApprovalEmail();
    	}

    	this.CommentEntries.Add(""Request submitted."");
    }
    else if(justApproved)
    {
    	SendApprovalEmail();
    	this.CommentEntries.Add(""Request approved."");
    }
    else if(justDenied)
    {
    	SendDenialEmail();
    	this.CommentEntries.Add(""Request denied."");
    }	

    this.Save();

    this.Answers.Save();
    this.Attachments.Save();
    this.CommentEntries.Save();
}
</code></pre>
","<refactoring>","0","143","2009-03-09 04:35:51"
"626910","How do I make this class more reusable? (specific example inside)","<p>I've got a method which currently takes an IList as a parameter, where UserBO is similar to the following:</p>

<pre><code>public class UserBO {
    public string Username { get; set; }
    public string Password { get; set; }
    public string Pin { get; set; }
}

public class SomeClass {
    // An example method giving the basic idea of what I need to do
    public void WriteUsers(IList&lt;UserBO&gt; users) {
        // Do stuff with users
        for (var user in users) {
            Console.WriteLine(String.Format(User: {0}: {1}, users.Username, Hash(users.Pin)); // Now needs to optionally be users.Password
        }
    }

    private string Hash(string pin) {
        return // Hashed Pin
    }
}
</code></pre>

<p>This method then uses the Username/Pin pairs to create some XML used by another program (we'll use the above method as an example).</p>

<p>The thing is, now I need to be able to produce the same code except using the Password field instead of the Pin field (there's a good reason for having both fields).</p>

<p>Instead of just creating another method with a similar name, I'd prefer to refactor the code so as to remove the BO specific code from this class entirely, and make it so that the decision about what class/members to use are made not in the method itself but the code calling it.</p>

<p>One option would be to pass an IDictionary and use the Linq ToDictionary method to create a dictionary on the fly in the calling code. This would however lose the ordering of the items (which would be nice but not essential to keep). I could use an IList or something, but that would be more difficult to convert the IList into.</p>

<p>Does anybody have any good suggestions of how to do this?</p>

<p>P.S. If anybody has a better idea of how to title this post, feel free to have a go at it.</p>
","<c#><.net><refactoring>","1","185","2009-03-09 16:09:07"
"630804","Passing data object to Factory in PHP","<p>Please help me to implement Factory design pattern for the task.</p>

<p>I working on scheduled message sending web application.
User can specify his own scheduled sending plan, and messages will be delivered when it have to.
User can choose only one of 3 reccuring types: monthly, weekly, daily.
For this 3 reccuring types algorithm is similar:
1) choose send date and time(for first delivery)
2) choose option in ""repeat every X months/weeks/days"" depending on reccuring type
3) specify end by type(date or by occurences limit)</p>

<p>Weekly scheduler is a little bit different.
It has one more feature - week days for repeating(ex: repeat every Mon, Fri)</p>

<pre><code>class SchedulerFactory {
    public function create($type) {
        switch ($type) {
            case ""monthly"" :
                $Scheduler = new MonthlyScheduler();
    	break;
            case ""weekly"" :
                $Scheduler = new WeeklyScheduler();
    	break;
            case ""daily"":
                $Scheduler = new DailyScheduler();
    	break;
            default:
                return null;
        }
    }
}
</code></pre>

<p>Setter methods:</p>

<pre><code>$SendScheduler-&gt;setSendDateAndTime(""{$day}.{$month}.{$year}"", time());

switch($end_by_type) {
 case 'by_date':
     $SendScheduler-     &gt;setEndByDate(""{$end_by_date_day}.{$end_by_date_month}.{$end_by_date_year}"");
    break;
case 'by_occurences_limit':
    $SendScheduler-&gt;setOccurencesLimit($occurences_quantity);
    break;  				
}

$SendScheduler-&gt;addTaskOccuringEvery($RepeatEveryMonth);// repeat every X months/weeks/days depending on type

// only for weekly type
$SendScheduler-&gt;setWeekDayForRepeating($week_day); // repeat every Mon, Fri
</code></pre>

<p>I want to use Factory pattern for object construction(Is it the best match?), and don't know how can I pass all this parameters(not just $type, but all other) for object construction.</p>

<p>Should I create wrap them in single data object, and create method ""setOptions"" in the SchedulerFactory class and pass this data object to ""create"" construction method through getter?</p>

<p>Maybe creating of such setter method in Factory class is violation of Factory design pattern principles? I didn't see an examples like this before, so I'm a bit confused now.</p>

<p>If I'm going in absolutely wrong direction, please let me know.
What solution would you recommend for this task?</p>

<p>Thanks, in advance</p>
","<php><refactoring><factory>","0","496","2009-03-10 15:34:03"
"630215","Readability of nested AJAX callback functions","<p>Please help me to refactore this Javascript code.
There is big form for scheduled message sending(send date, reccurence type, end by date/qauntity, credits system - need to count total cost of scheduled sending plan in runtime).
I'm writing Javascript validator for this form.</p>

<p>There is an validation algorithm
1) check if send date time is not in past moment
2) check if ""end by date"" field time is greater then first send date time
3) validate total cost of schedule plan</p>

<p>(There about 6 steps, but I just write here 3 of them - I think it will be enough to grasp the problem)</p>

<p>""Save scheduled plan"" button has a javascript listener on ""click"" event. This listener calls this function:</p>

<pre><code>ScheduledValidator.checkIfSendDateTimeIsNotInPast(params, form);
</code></pre>

<p>Here is it its declaration:</p>

<pre><code>ScheduledValidator.checkIfSendDateTimeIsNotInPast = function (params, form) {
var conn = new Ext.data.Connection();

conn.request({
	url: CONST.BASE_URL + 'url',
	params: params,
	callback: function (options, success, response) {
		response = Ext.util.JSON.decode(response.responseText);
		if (response.success == false) {
			// display error messages
		} else { 
ScheduledValidator.checkIfEndDateIsGreaterThatSendDate(params, form);
		}
	}
});
</code></pre>

<p>}</p>

<p>We have nested request later:</p>

<pre><code>ScheduledValidator.checkIfEndDateIsGreaterThatSendDate = function (params, form) {
var conn = new Ext.data.Connection();

conn.request({
	url: CONST.BASE_URL + 'url2',
	params: params,
	messageForm: form,
	callback: function (options, success, response) {
		response = Ext.util.JSON.decode(response.responseText);
		if (response.success == false) {
			// display error messages
		} else {
			ScheduledValidator.validateTotalCost(params, form);
		}
	}
});
}
</code></pre>

<p>and one more here:</p>

<pre><code>ScheduledValidator.validateTotalCost = function (params, form) {
...
</code></pre>

<p>I don't like in that approach, that it is quite hard to understand the algorithm at first glance.
Maybe it is not good, to make many(about 6) nested AJAX queries for validation of single form?
Maybe it should be merged to the single request and after that we will do all the validation activities at server side?
How should I refactor this code?</p>
","<javascript><refactoring><extjs><readability>","1","852","2009-03-10 13:41:31"
"644230","Converting a pthreaded program to MPI?","<p>I understand the differences between a multithreaded program and a program relying on inter-machine communication.  My problem is that I have a nice multithreaded program written in 'C' that works and runs really well on an 8-core machine.  There is now opportunity to port this program to a cluster to gain access to more cores.  Is it worth the effort to rip out the pthread stuff and retrofit MPI (which I've never used) or are we better off recoding the whole thing (or most of it) from scratch?  Assume we are ""stuck"" with C so a wholesale change of language isn't an option.</p>
","<c><refactoring><pthreads><cluster-computing>","0","314","2009-03-13 19:23:18"
"646653","Premature refactoring?","<p>We have all heard of <a href=""http://en.wikipedia.org/wiki/Program_optimization#When_to_optimize"" rel=""nofollow"">premature optimization</a>, but what do you think about premature refactoring? Is there any such thing in your opinion? Here is what I am getting at.</p>

<p>First off, reading Martin Fowler's seminal work <a href=""http://refactoring.com/"" rel=""nofollow"">""Refactoring""</a> quite literally changed my life in regards to programming. </p>

<p>One thing that I have noticed, however, is that if I start refactoring a class or framework too quickly, I sometimes find myself coded into a corner so-to-speak. Now, I suspect that the issue is not really refactoring per se, but maybe premature/poor design decisions/assumptions.</p>

<p>What are your thoughts, insights and/or opinions on this issue? Do you have any advice or common anti-patterns related to this issue?</p>

<p><strong>EDIT:</strong></p>

<p>From reading your answers and reflecting on this issue more, I think I have come to the realization that my problem in this case is really an issue of ""premature design"" and not necessarily ""premature refactoring"". I have been guilty of assuming a design and refactoring in that direction to early in the coding process. A little patience on my part  to maintain a level of design agnosticism and focus on refactoring towards clean code would keep me from heading down these design rabbit trails.</p>
","<design><refactoring><anti-patterns>","8","506","2009-03-14 20:22:35"
"648821","Software Rewrite-vs-Running Cost Analaysis","<p>The IT department I work in as a programmer revolves around a 30+ year old code base (Fortran and C). The code is in a poor condition partially as a result of 30+ years of ad-hoc poorly thought out changes but I also suspect a lot of it has to do with the capabilities of the programmers who made the changes (and who incidentally are still around).</p>

<p>The business that depends on the software operates 363 days a year and 20 hours a day. Unfortunately there are numerous outages. This is the first place I have worked where there are developers on call to apply operational code fixes to production systems. When I was first, there was actually a copy of the source code and development tools on the production servers so that on the fly changes could be applied; thankfully that practice has now been stopped.</p>

<p>I have hinted a couple of times to management that the costs of the downtime, having developers on call, extra operational staff, unsatisifed customers etc. are costing the business a lot more in the medium, and possibly even short term, than it would to launch a whole hearted effort to re-write/refactor/replace the whole thing (the code base is about 300k lines).</p>

<p>Ideally they'd be some external consultancy that could come in and run the rule over the quality of the code and the costs involved to keep it running vs rewrite/refactor/replace it. The question I have is how should a business go about doing that kind of cost analysis on software AND be able to have confidence in that analysis? The first IT consultants down the street may claim to be able to do the analysis but how could management be made to feel comfortable with it over what they are being told by internal staff?</p>
","<refactoring><business>","5","461","2009-03-15 23:44:16"
"647873","How to do effective refactoring using VS Studio 2005/2008","<p>I am looking for experience/tools to improve refactoring techniques using VS Studio 2005/2008.<br/>
Currently I only use standard refactor menu choices:<br/>
Rename...<br/>
Extract Method...<br/>
Encapsulate Field...<br/>
<img src=""http://img208.imageshack.us/img208/5852/vsrefactor.gif"" alt=""alt text"" /></p>
","<.net><visual-studio><refactoring><resharper>","1","274","2009-03-15 14:16:26"
"654905","Legacy Code Nightmare","<p>I've inherited a project where the class diagrams closely resemble a spider web on a plate of spaghetti. I've written about 300 unit tests in the past two months to give myself a safety net covering the main executable.</p>

<p>I have my library of agile development books within reach at any given moment:</p>

<ul>
<li><em>Working Effectively with Legacy Code</em></li>
<li><em>Refactoring</em></li>
<li><em>Code Complete</em></li>
<li><em>Agile Principles Patterns and Practices in C#</em></li>
<li>etc.</li>
</ul>

<p>The problem is everything I touch seems to break something else.
The UI classes have business logic and database code mixed in. There are mutual dependencies between a number of classes. There's a couple of god classes that break every time I change any of the other classes. There's also a mutant singleton/utility class with about half instance methods and half static methods (though ironically the static methods rely on the instance and the instance methods don't).</p>

<p>My predecessors even thought it would be clever to use all the datasets backwards. Every database update is sent directly to the db server as parameters in a stored procedure, then the datasets are manually refreshed so the UI will display the most recent changes.</p>

<p>I'm sometimes tempted to think they used some form of weak obfuscation for either job security or as a last farewell before handing the code over.</p>

<p>Is there any good resources for detangling this mess? The books I have are helpful but only seem to cover half the scenarios I'm running into.</p>
","<refactoring><legacy-code>","16","1276","2009-03-17 16:06:12"
"654313","Can this snippet of Javascript be simplified more with jQuery?","<p>I have the following snippet of Javascript, which is just attaching an onclick to a button and then updating the text of an em tag underneath it.  I'm slowly trying to educate myself and work with jQuery more as I've found to like the syntax a lot more and for some tasks, it's more of a pleasure to work with.</p>

<p>Some of the best examples I've found have come from Stackoverflow, so I come once again, to see how this could refactored and improved with jQuery; any thoughts?</p>

<pre><code>$$('em.green').each(function(em) { 
  em.up('button').onclick = function() { 
    em.update('Saving...') 
  }; 
});
</code></pre>

<p>Thanks!</p>
","<javascript><jquery><refactoring><prototypejs>","2","207","2009-03-17 13:44:26"
"655122","Doing a run-around of existing application to make database changes, good idea?","<p>We have an existing ""legacy"" app written in C++/powerbuilder running on Unix with it's own Sybase databases. For complex organizational(existing apps have to go through lot of red-tape to be modified) and code reasons(no re-factoring has been done in yrs so the code is spaghetti), so  it's difficult to get modifications done to this application. Hence I am considering writing a new modern, maybe grails, based web app to do some ""admin"" type things directly into the database. For example to add users, or to add ""constraint rows"". </p>

<p>What does the software community think of this approach of doing a run-around of the existing app like this? Good idea? Tips and hints?</p>
","<c++><architecture><grails><refactoring>","3","144","2009-03-17 16:56:08"
"655364","How would you refactor this to make it nicer?","<p>How would you refactor something like this?</p>

<pre><code>protected void btnAdd_Click(object sender, EventArgs e)
{
    try
    {
        string username = txtUsername.Text.Trim().ToLower();
        string password = txtPassword.Text.Trim().ToLower();
        string email = txtEmail.Text.Trim().ToLower();
        string status = ddlStatus.SelectedValue.Trim();

        IUser user = UserFactory.getInstance().createUser(username, password, email,status);

        if (user.save())
        {
            jsMsgBox(""Successfully added new user"");
            Response.Redirect(ConfigurationManager.AppSettings[""AdminLink""], true);
        }
        else
        {
            jsMsgBox(""An error was encountered while trying to add a new user."");
        }
    }
    catch (Exception ex)
    {
        jsMsgBox(""An Error was encountered while trying to add a new user."");
        lblInfo.Text = ex.Message;
        lblInfo.Visible = true;
    }
}

protected void btnUpdate_Click(object sender, EventArgs e)
{
    try
    {
        string username = txtUsername.Text.Trim().ToLower();
        string password = txtPassword.Text.Trim().ToLower();
        string email = txtEmail.Text.Trim().ToLower();
        int userPK = Int32.Parse(txtUserPK.Text.ToString());
        string status = ddlStatus.SelectedValue.Trim();

        IUser user = UserFactory.getInstance().createUser(userPK, username, password, email,status);

        if (user.save())
        {
            jsMsgBox(""Successfully updated selected users information."");
            Response.Redirect(ConfigurationManager.AppSettings[""AdminLink""], true);
        }
        else
        {
            jsMsgBox(""An error was encountered while trying to update the selected users information."");
        }
    }
    catch (Exception ex)
    {
        jsMsgBox(""An Error was encountered while trying to update the selected users information."");
        lblInfo.Text = ex.Message;
        lblInfo.Visible = true;
    }
}
</code></pre>

<p>Take care</p>
","<c#><asp.net><refactoring>","2","481","2009-03-17 17:56:21"
"657645","Refactoring and Test Driven Development","<p>I'm Currently reading two excellent books ""Working Effectively with Legacy Code"" and ""Clean Code"". </p>

<p>They are making me think about the way I write and work with code in completely new ways but one theme that is common among them is test driven development and the idea of smothering everything with tests and having tests in place before you make a change or implement a new piece of functionality. </p>

<p>This has led to two questions: </p>

<p>Question 1:
If I am working with legacy code. According to the books I should put tests in place to ensure I'm not breaking anything. Consider that I have a method 500 lines long. I would assume I'll have a set of equivalent testing methods to test that method. When I split this function up, do I create new tests for each new method/class that results?</p>

<p>According to ""Clean Code"" any test that takes longer than 1/10th of a second is a test that takes too long. Trying to test a 500 long line legacy method that goes to databases and does god knows what else could well take longer than 1/10th of a second. While I understand you need to break dependencies what I'm having trouble with is the initial test creation.</p>

<p>Question 2:
What happens when the code is re-factored so much that structurally it no longer resembles the original code (new parameters added/removed to methods etc). It would follow that the tests will need re-factoring also? In that case you could potentially altering the functionality of the system while the allowing the tests to keep passing? Is re-factoring tests an appropriate thing to do in this circumstance?</p>

<p>While its ok to plod on with assumptions I was wondering whether there are any thoughts/suggestions on such matters from a collective experience.</p>
","<unit-testing><refactoring><testing>","4","240","2009-03-18 10:09:47"
"659117","What's a good way to structure variable nested loops?","<p>Suppose you're working in a language with variable length arrays (e.g. with <code>A[i]</code> for all <code>i</code> in <code>1..A.length</code>) and have to write a routine that takes <code>n</code> (<code>n : 1..8</code>) variable length arrays of items in a variable length array of length <code>n</code>, and needs to call a procedure with every possible length <code>n</code> array of items where the first is chosen from the first array, the second is chosen from the second array, and so forth.  </p>

<p>If you want something concrete to visualize, imagine that your routine has to take data like:</p>

<pre><code>[ [ 'top hat', 'bowler', 'derby' ], [ 'bow tie', 'cravat', 'ascot', 'bolo'] ... ['jackboots','galoshes','sneakers','slippers']]
</code></pre>

<p>and make the following procedure calls (in any order):</p>

<pre><code>try_on ['top hat', 'bow tie', ... 'jackboots']
try_on ['top hat', 'bow tie', ... 'galoshes']
 :
try_on ['derby','bolo',...'slippers']
</code></pre>

<p>This is sometimes called a chinese menu problem, and for fixed <code>n</code> can be coded quite simply (e.g. for <code>n</code> = 3, in pseudo code)</p>

<pre><code>procedure register_combination( items : array [1..3] of vararray of An_item)
    for each i1 from items[1]
        for each i2 from items[2]
            for each i3 from items[3]
                register( [ii,i2,i3] )
</code></pre>

<p>But what if <code>n</code> can vary, giving a signature like:</p>

<pre><code>procedure register_combination( items : vararray of vararray of An_item)
</code></pre>

<p>The code as written contained an ugly case statement, which I replaced with a much simpler solution.  But I'm not sure it's the best (and it's surely not the only) way to refactor this.</p>

<p>How would you do it?  Clever and surprising are good, but clear and maintainable are better--I'm just passing through this code and don't want to get called back.  Concise, clear <em>and</em> clever would be ideal.</p>

<p>Edit: I'll post my solution later today, after others have had a chance to respond.</p>

<p>Teaser: I tried to sell a recursive solution, but they wouldn't go for it, so I had to stick to writing fortran in a HLL.</p>

<p>The answer I went with, posted below.</p>
","<language-agnostic><refactoring><coding-style><nested-loops>","1","1410","2009-03-18 16:48:07"
"660879","Refactor XAML code with binding","<p>I try to refactor such XAML by introducing new user control:</p>

<pre><code>&lt;Window ...&gt;
  &lt;ComboBox ItemsSource=""{Binding Greetings}"" /&gt;
&lt;/Window&gt;
</code></pre>

<p>After adding a control I have</p>

<p>ControlA XAML:</p>

<pre><code>&lt;UserControl ...&gt;
  &lt;ComboBox ItemsSource=""{Binding Items}"" /&gt;
&lt;/UserControl&gt;
</code></pre>

<p>ControlA C#:</p>

<pre><code>public static readonly DependencyProperty ItemsProperty =
  WpfUtils.Property&lt;IEnumerable, ControlA&gt;(""Items"");

public IEnumerable Items { get; set; }
</code></pre>

<p>New Window XAML:</p>

<pre><code>&lt;Window ...&gt;
  &lt;uc:ControlA Items=""{Binding Greetings}"" /&gt;
&lt;/Window&gt;
</code></pre>

<p>After this I see nothing in ComboBox. What is wrong here?</p>
","<wpf><binding><refactoring><usercontrols>","0","493","2009-03-19 02:35:31"
"664644","Whats a good name for a base class for Movie and Episode?","<p>I've been refactoring Media Browser and have started to define a proper inheritance model for our domain objects</p>

<p>so I have </p>

<pre><code>BaseItem
-&gt; Video
--&gt; &lt;Need a name for this&gt;
---&gt; Episode
---&gt; Movie
-&gt; Folder
--&gt; Season
</code></pre>

<p>Essentially tv show episodes and movies have some attributes in common (like actor or director listings) so I need a name for this common base class. </p>

<p>I don't want to chuck this in the Video base class, cause thing like mpegs that you record on your camera have no actors or directors so they are simply Videos ... </p>

<p>Any help with a name would be much appreciated..   </p>
","<language-agnostic><refactoring>","1","206","2009-03-20 01:11:29"
"663295","Refactoring of very combine code","<p>I now have to refactor some code, it's basically one method(its around 1000 lines of code) that does a lot of calculations and have a lot of variables. I'm not sure how to refactor it. 
Does code like</p>

<pre><code>...
calculateSth(param1,param2,param3,param4,param5, params6);
calculateSthElse(param1,param2,param3);
...
</code></pre>

<p>look good?</p>

<p>I could introduce parameter objects, but those objects would only be used as params to some method, so it would look like this</p>

<pre><code>...
calculateSth(calculateSthObject);
calculateSthElse(calculateSthElseObject);
...
</code></pre>

<p>or I could put everything in one big object and make it</p>

<pre><code>...
calculateSth(calculateObject);
calculateSthElse(calculateObject);
...
</code></pre>

<p>however in that solution I would have to pull out everything that is needed in private methods on the beginning of the method and set at the end, and it would be a lot of harder to find out what values are used in private methods.  Around half of variables are needed as output.</p>

<p>How would you do it?</p>

<p>P.S. Calculations are not trivial, so doing things like </p>

<pre><code>calculateObject.setMagicValue4((calculateObject.getMagicValue() * calculateObject.getMagicValue2() / calculateObject.getMagicValue3()) 
</code></pre>

<p>would only make it hard to read.</p>
","<design><language-agnostic><refactoring>","1","97","2009-03-19 17:54:20"
"665032","Possible to port legacy servlet to framework one component at a time?","<p>I have heard that you can run an ASP.NET application and ASP.NET mvc application side by side so that you can port existing code over one piece at a time. I was wondering if you could do this with a java framework?</p>

<p>I have a legacy servlet application that I am currently in the process of refactoring. I am thinking about turning it into a jsp application incrementally as this is relatively easy to accomplish ( can call jsps from servlet ). I was wondering if I could maybe take it one step further and instead of porting to jsps, port directly to a framework, like struts / jsf / tapestry / whatever. Is this sort of thing possible? I would need to ensure that it would be done in a side-by-side one component at a time way.</p>

<p>Are there any resources that deal with this specific issue?</p>

<p>Thanks.</p>
","<java><mvc><refactoring><frameworks>","0","77","2009-03-20 04:53:13"
"665748","Renaming database fields","<p>I have a database in which the main table has a really badly named primary key field which I want to rename. This primary key field is referenced by about 20 other tables and about 15 stored procedures.</p>

<p>What is the easiest way to rename this field everywhere it is referenced throughout the database?</p>
","<sql-server><sql-server-2005><refactoring>","0","159","2009-03-20 11:27:25"
"665563","Find unused classes in a Java Eclipse project","<p>I have a large Eclipse project in which there exist several classes which, although they ceased to be used anywhere, were never marked @Deprecated.</p>

<p>How can I easily find all of these?</p>
","<java><eclipse><refactoring>","17","8584","2009-03-20 10:09:23"
"669081","Too big data objects","<p>Recently, I have identified very strong code smell in one of the project, I'm working for.</p>

<p>Especially, in its cost counting feature. To count the total cost for some operation, we have to pass many kind of information to the ""parser class"".</p>

<p>For example:</p>

<ul>
<li>phone numbers  </li>
<li>selected campaigns  </li>
<li>selected templates  </li>
<li>selected contacts  </li>
<li>selected groups  </li>
<li>and about 2-4 information types more</li>
</ul>

<p>Before refactoring there were all this parameters were passed through constructor to the Counter class(8 parameters, you can image that..).</p>

<p>To increase readability I have introduced a Data class, named CostCountingData with readable getters and setters to all this properties.</p>

<p>But I don't think, that that code became much readable after this refactoring:</p>

<pre><code>$cost_data = new CostCountingData();
$cost_data-&gt;setNumbers($numbers);
$cost_data-&gt;setContacts($contacts);
$cost_data-&gt;setGroups($groups);
$cost_data-&gt;setCampaigns($campaigns);
$cost_data-&gt;setUser($user);
$cost_data-&gt;setText($text);
$cost_data-&gt;setTotalQuantity($total_quantity);

$CostCounter = new TemplateReccurentSendingCostCounter($cost_data);  
$total_cost = $CostCounter-&gt;count();
</code></pre>

<p>Can you tell me whether there is some problem with readability of this code snippet?
Maybe you can see any code smells and can point me at them..</p>

<p>The only idea I have how to refactore this code, is to split this big data object to several, consisting related data types. But I'm not sure whether should I do this or not..</p>

<p>Whay do you think about it?</p>
","<php><refactoring>","0","177","2009-03-21 10:16:09"
"669957","How should I approach migrating data from a ""bad"" database design to a usable design?","<p>The current project I inherited mainly revolves around one unnormalized table.  There are some attempts at normalization but the necessary constraints weren't put in place. </p>

<p>Example: In the Project table, there is a client name (among other values) and there is also a clients table which just contains client names [no keys anywhere].  The clients table is just used as a pool of values to offer the user when adding a new project.  There isn't a primary key on the clients table or a foreign key.</p>

<p>""Design patterns"" such as this is common through the current state of the database and in the applications that use it.  The tools I have my disposal are SQL Server 2005, SQL Server Management Studio, and Visual Studio 2008.  My initial approach has been to manually determine which information needs normalization and running Select INTO queries.  Is there a better approach than a case by case or anyway this could be automated?</p>

<p><strong>Edit:</strong>
Also, I've discovered that a ""work order number"" isn't an IDENTITY (autonumber, unique) field and they are generated sequentially and are unique to each work order.  There are also some gaps in the existing numbering but all are unique.  Is the best approach for this writing a store procedure to generate dummy rows before migrating?</p>
","<sql><sql-server><refactoring><rdbms><normalization>","7","294","2009-03-21 20:38:22"
"673554","How can I refactor C++ source code using emacs?","<p>I'm interested mostly in C++ and method/class name/signature automatic changes.</p>
","<c++><emacs><refactoring>","17","5830","2009-03-23 14:21:48"
"678033","How to avoid code duplication between similar ISRs?","<p>I have two interrupt service routines (ISR) which basically do the exact same
thing but each handles an interrupt from a different device (although the same type of device). Therefore, the logic is the same but they access different CPU registers and memory locations.</p>

<p>As a simple example consider the following code:</p>

<pre><code>extern volatile unsigned int dev1_rx_buffer;
extern volatile unsigned int dev2_rx_buffer;

volatile unsigned char data;

void __attribute__((__interrupt__)) _dev1_interrupt(void)
{
    /* Clear interrupt flag */
    dev1.IF = 0;

    if (dev1.IS_FULL) {
         /* Read data from device */
         data = dev1_rx_buffer;
    } else {
         /* do something else using registers of device 1 */
    }
    /* More stuff using registers of device 1 */
}

void __attribute__((__interrupt__)) _dev2_interrupt(void)
{
    /* Clear interrupt flag */
    dev2.IF = 0;

    if (dev2.IS_FULL) {
         /* Read data from device */
         data = dev2_rx_buffer;
    } else {
         /* do something else using registers of device 2 */
    }
    /* More stuff using registers of device 2 */
}
</code></pre>

<p>How can I avoid the code duplication with the restrictions that apply to ISRs
(i.e. I cannot pass parameters to the ISRs and function calls should be avoided
because of their overhead).</p>

<p>I have thought of writing a template from which to generate the two ISRs using a higher level scripting language, but I'd prefer a solution using only C or C preprocessor macros.</p>
","<c><refactoring><embedded>","0","202","2009-03-24 15:48:50"
"683168","How do I 'refactor' SQL Queries?","<p>I have several MS Access queries (in views and stored procedures) that I am converting to SQL Server 2000 (T-SQL).  Due to Access's limitations regarding sub-queries, and or the limitations of the original developer, many views have been created that function only as sub-queries for other views.</p>

<p>I don't have a clear business requirements spec, except to 'do what the Access application does', and half a page of notes on reports/CSV extracts, but the Access application doesn't even do what I suspect is required properly.  </p>

<p>I, therefore, have to take a bottom up approach, and 'copy' the Access DB to T-SQL, where I would normally have a better understanding of requirements and take a top down approach, creating new queries to satisfy well defined requirements.</p>

<p>Is there a method I can follow in doing this?  Do I spread it all out and spend a few days 'grokking' it, or do I continue just copying the Access views and adopt an evolutionary approach to optimising the querying?</p>
","<sql><sql-server><tsql><database-design><refactoring>","0","343","2009-03-25 19:52:18"
"690738","Should “Action” delegate be refactored out into a new method?","<p>I have a following method</p>

<pre><code>    private void SetProcessDocumentStatus(string status)
    {
        var setStatusWith = new Action&lt;string&gt;(
            statusValue =&gt; processDocumentStatusLabel.Text = statusValue);
        if (processDocumentStatusLabel.InvokeRequired)
            processDocumentStatusLabel.Invoke(
                (MethodInvoker)(() =&gt; setStatusWith(status)));
        else
            setStatusWith(status);
    }
</code></pre>

<p>From the above code, I am encapsulating action into <code>setStatusWith</code>.
Should that action be refactored into another method as follows?</p>

<pre><code>    private void SetProcessDocumentStatusWith(string status)
    {
        processDocumentStatusLabel.Text = status;
    }

    private void SetProcessDocumentStatus(string status)
    {
        if (processDocumentStatusLabel.InvokeRequired)
            processDocumentStatusLabel.Invoke(
                (MethodInvoker)(() =&gt; SetProcessDocumentStatusWith(status)));
        else
            SetProcessDocumentStatusWith(status);
    }
</code></pre>

<p>I am wondering if “Action” delegate should be used sparingly in code.</p>
","<.net><generics><refactoring>","1","215","2009-03-27 17:35:13"
"691921","How can I refactor these 2 methods into 1?","<p>I am trying to refactor some Entity Framework code where I have a Products entity and related entities for the Product's series, family, brand, etc.  The series, family, and brand entities all have the same basic structure with an Id and Text property.  </p>

<p>The two methods below are very similar and should be able to be refactored to a single method, but I'm not sure how to dynamically pass in which entity I'm querying from.  In this case I need to be able to pass in db.ProductFamilies, or db.ProductSeriesSet.  Any ideas how to make these 2 become 1?</p>

<p>Thanks!</p>

<pre><code>    public DTOs.ProductCollection GetFamily(int id)
    {
        using (Entities db = new Entities())
        {
            var fam = (from collection in db.ProductFamilies.Include(""Product"")
                        .Include(""Product.Stuff1"")
                        .Include(""Product.Stuff2"")
                       where collection.Id == id
                       select collection).FirstOrDefault();
            return ProductCollectionEFToProductCollectionDTO(fam, true);
        }
    }

    public DTOs.ProductCollection GetSeries(int id)
    {
        using (Entities db = new Entities())
        {
            var ser = (from collection in db.ProductSeriesSet.Include(""Product"")
                        .Include(""Product.Stuff1"")
                        .Include(""Product.Stuff2"")
                       where collection.Id == id
                       select collection).FirstOrDefault();
            return ProductCollectionEFToProductCollectionDTO(ser, true);
        }
    }
</code></pre>
","<c#><asp.net><entity-framework><.net-3.5><refactoring>","2","168","2009-03-28 00:53:59"
"693070","How can you find unused functions in Python code?","<p>So you've got some legacy code lying Python around in a fairly hefty project. How can you find and delete dead functions?</p>

<p>I've seen these two references: <a href=""http://stackoverflow.com/questions/245963"">Find unused code</a> and <a href=""http://stackoverflow.com/questions/11532"">Tool to find unused functions in php project</a>, but they seem C# and PHP specific, respectively.</p>

<p>Is there a Python tool that'll help you find functions that aren't referenced anywhere else in the source code (notwithstanding reflection/etc.)?</p>

<p>Thank you.</p>
","<python><tools><refactoring><dead-code>","9","1697","2009-03-28 16:42:42"
"698000","Factory class knows too much","<p><strong>UPDATED</strong> I've updated the example to better illustrate my problem.  I realised it was missing one specific point - namely the fact that the <code>CreateLabel()</code> method always takes a label type so the factory can decide what type of label to create.  Thing is, it might need to obtain more or less information depending on what type of label it wants to return.</p>

<p>I have a factory class that returns objects representing labels to be sent to a printer.</p>

<p>The factory class looks like this:</p>

<pre><code>public class LargeLabel : ILabel
{
    public string TrackingReference { get; private set; }

    public LargeLabel(string trackingReference)
    {
        TrackingReference = trackingReference;
    }
}

public class SmallLabel : ILabel
{
    public string TrackingReference { get; private set; }

    public SmallLabel(string trackingReference)
    {
        TrackingReference = trackingReference;
    }
}

public class LabelFactory
{
    public ILabel CreateLabel(LabelType labelType, string trackingReference)
    {
        switch (labelType)
        {
            case LabelType.Small:
                return new SmallLabel(trackingReference);
            case LabelType.Large:
                return new LargeLabel(trackingReference);
        }
    }
}
</code></pre>

<p>Say that I create a new label type, called CustomLabel.  I want to return this from the factory, but it needs some additional data:</p>

<pre><code>public class CustomLabel : ILabel
{
    public string TrackingReference { get; private set; }
    public string CustomText { get; private set; }

    public CustomLabel(string trackingReference, string customText)
    {
        TrackingReference = trackingReference;
        CustomText = customText;
    }
}
</code></pre>

<p>This means my factory method has to change:</p>

<pre><code>public class LabelFactory
{
    public ILabel CreateLabel(LabelType labelType, string trackingReference, string customText)
    {
        switch (labelType)
        {
            case LabelType.Small:
                return new SmallLabel(trackingReference);
            case LabelType.Large:
                return new LargeLabel(trackingReference);
            case LabelType.Custom:
                return new CustomLabel(trackingReference, customText);
        }
    }
}
</code></pre>

<p>I don't like this because the factory now needs to cater for the lowest common denominator, but at the same time the CustomLabel class <em>needs</em> to get a custom text value.  I could provide the additional factory method as an override, but I want to enforce the fact that the CustomLabel needs the value, otherwise it'll only ever be given empty strings.</p>

<p>What is the correct way to implement this scenario?</p>
","<c#><design-patterns><refactoring><factory>","1","602","2009-03-30 16:40:30"
"700868","What was your coolest SQL optimization, on a slow performing query?","<p>Just speaking to a colleague of mine. He was walking with a hop in his step, on the way to the coffee machine.</p>

<p>I asked him ""what's with the 'swarmy' walk?"", he said, ""I just reduced a two hour long query down to 40 seconds! It feels so good"".</p>

<p>He altered a stored procedure, that was using cursors and introduced a temp table, that was refactored from the original dataset - I will email him soon, to get more info on actual implemetation.</p>

<p>But ultimately, he was buzzing.</p>

<p>Question is, what SQL, that sticks in your mind and has made you buzz, whilst optimising slow performing queries?</p>
","<sql><performance><refactoring>","4","531","2009-03-31 13:11:36"
"704062","Are there any open source command line tools to refactor java code?","<p>I use vim as my editor but I would like to get some of the same power of the IDE's for java when it comes to refactoring. Are there any commandline tools for refactoring java? I could probably hack something together using perl or vim scripting but if there is something already out there I'd rather use that.</p>
","<java><command-line><refactoring><automated-refactoring>","6","1372","2009-04-01 04:22:48"
"705366","Can I rename a dataset in the VS 2005 properties window and have this refactor through my code?","<p>I tried the above but when I attempted to rebuild I received errors as the compiler couldn't find the dataset by it's old name. </p>

<p>I know it might be lazy, but I'm used to being able to rename an item in it's properties window and have the refactoring happen silently behind the scenes for me. Is there a way I can do the same thing with a dataset or should I use the find and replace function (along with a fair bit of double checking). My project isn't especailly big so find-replace-check won't take to long but I might need to do it on bigger projects in future</p>

<p>G</p>

<p><B>EDIT:</B> Attempting the below solution gives the following error<br />
    The file 'DataSet.cs' could not be refactored. The current object is auto-generated and only supports renaming through the DataSet Designer. </p>
","<visual-studio><visual-studio-2005><refactoring><dataset><rename>","0","531","2009-04-01 12:56:01"
"708164","Java refactoring tools","<p>I make very heavy use of the Java code refactoring tools provided by Eclipse (extract interface, rename method, etc.). Does anyone knows of other similar tools (preferably Eclipse plugins) that can perform Java code refactorings that are not available in Eclipse by default, or that can perform the same refactorings better?</p>

<p>I'm aware of various Eclipse plugins that can identify code in need of refactoring (e.g. FindBugs, UCDetector), but I'm looking for tools that can actually do the refactoring.</p>
","<java><eclipse><refactoring><jdt>","7","3641","2009-04-02 03:23:38"
"708907","DevExpress Refactor Pro vs JetBrains ReSharper","<p>In my department, we are currently using ReSharper 4.0 and deciding whether to upgrade to 4.5 upon its release next week. I personally am a huge fan of ReSharper however a number of my colleagues have pointed out that they have been using a plug in from DevExpress called Refactor Pro that performs similar functionality.</p>

<p><a href=""http://www.devexpress.com/Refactor"" rel=""nofollow"">http://www.devexpress.com/Refactor</a><br />
<a href=""http://www.jetbrains.com/resharper/beta.html"" rel=""nofollow"">http://www.jetbrains.com/resharper/beta.html</a></p>

<p>Has anyone previously compared these tools and hold any strong views on which tool would give us the greatest increase in productivity and why?</p>
","<refactoring><resharper>","6","3854","2009-04-02 09:05:36"
"712105","""messy-polymorphism"" anti-pattern","<p>In fairly large Ruby application, we have a situation where a given object is identified by a couple of things: name and id, say. Each of these value types serves a somewhat different purpose and so are not exactly equivalent (id and name persist in different places). So we wind-up with a variety of values being passed around the application (ids, names and objects). This situation seems like a problem to at least some degree since we've already been bitten by bugs which involved not being clear what type should be passed to a given function. I actually recall seeing similar problem code in a number of applications over the years, though I again never gave a specific name to it. </p>

<p>Ruby, as a typeless language, does not allow classical type-based polymorphic functions in the way that C++ does. As a work around, a colleague has often resorted code of this sort:</p>

<pre><code>  def initialize starting_value
    if starting_post.kindof? Foo
      @starting_id = get_id_from_foo starting_value
    elsif starting_post.kindof? Bar
      @starting_id = get_id_from_bar starting_value
    else
      raise ""illegal type""
    end
  end
</code></pre>

<p>The proliferation of this code around our code-base (not just initializers) results in what I would call ""messy-polymorphism"". It often works but sometimes creates very puzzling situations. </p>

<p>I have three questions about this. </p>

<ul>
<li>Is there a formal name for this as an
anti-pattern? ""Messy Interface?"", ""Messy Polymorphism?"" or something else?</li>
<li>How bad to do people think this is? </li>
<li>Is there a systematic way to refactor
this? The challenge that we have with
ordinary refactoring that many tests we're created use this 
loose-typing and thus we would have to change both
the tests and the implementations
simultaneously and so wouldn't have the scaffold effect of ordinary test-based
refactoring. I am think that one could actually ""strengthen"" this loose polymorphism, 
and abstract-out the code into a function rather than immediate rip it out. But would 
this be a good idea?</li>
</ul>
","<ruby><refactoring><tdd><polymorphism><anti-patterns>","3","371","2009-04-03 00:09:53"
"711823","Refactoring Model Methods in Ruby On Rails","<p>A common idiom that my camp uses in rails is as follows:</p>

<pre><code>def right_things(all_things, value)
    things = []
    for thing in all_things
       things &lt;&lt; thing if thing.attribute == value
    end
    return things
end
</code></pre>

<p>how can I make this better/faster/stronger?</p>

<p>thx</p>

<p>-C</p>
","<ruby-on-rails><ruby><refactoring><methods>","4","417","2009-04-02 22:11:35"
"722487","Visual studio : Remove and sort using except the System reference","<p>When I use the option : Organize Usings -> Remove and sort from Visual Studio 2008 I would like to clear all unused references but to keep some like System; Is there an option I can set to do that ?</p>
","<visual-studio-2008><refactoring>","2","579","2009-04-06 17:46:52"
"720836","ASP C# How to program neat GUI code","<p>For about a few months i'm programming ASP C#. I always program a lot code in the events and in the load event i check the querystring for valid data. This is some sample code i have in one of my projects:</p>

<pre><code>protected void Page_Load(object sender, EventArgs e)
{
    if (Controller.Manual == null)
    {
        Response.Redirect(""login.aspx"");
    }

    lblLocation.Text = ""&lt;a href='viewdocument.aspx'&gt;"" + Controller.Manual.Title + ""&lt;/a&gt;"";

    if (Request.QueryString[""gchap""] != null)
    {
        if (Controller.IsNumeric(Request.QueryString[""gchap""].ToString()))
        {
            genchap = Convert.ToInt32(Request.QueryString[""gchap""]);

            FillGeneralList();

            SetChapterTitle();
        }
    }
    if (Request.QueryString[""qchap""] != null)
    {
        if (Controller.IsNumeric(Request.QueryString[""qchap""].ToString()))
        {
            qualchap = Convert.ToInt32(Request.QueryString[""qchap""]);

            FillQualityList();

            SetChapterTitle();
        }
    }

    // Check document Id is set (did)
    if (Request.QueryString[""did""] != null)
    {
        if (Controller.IsNumeric(Request.QueryString[""did""].ToString()))
        {
            docId = Convert.ToInt32(Request.QueryString[""did""]);

            DetermineView();
        }
    }

}
</code></pre>

<p>I know there must be a way to accomplish this on a more neat way. And this is just the load event. On other events, like click and onchange events i have similar code. I think this is spaghetti code and not well-arranged. So can you tell me how i can arrange my code?</p>

<p>EDIT:</p>

<p>What i want to know is, is there a more neat way to, let's say, fill a listbox? And where do i check whether a querystring value has valid data? Where do i check whether the (input/querystring) data is a number? And where should you put the code that validates the Querystring? Also in the load event?</p>
","<c#><gui><refactoring><refactor-my-code>","2","960","2009-04-06 09:49:58"
"725331","Strategies for migrating medium-sized code base from Java 1.4.2 to Java 5","<p>I'm in the process of reviewing a code base (~20K LOC) and trying to determine how to migrating it from 1.4.2 to 5. Obviously, it's not an overnight project and the suggestion which I have received is to write new code against Java 5 and migrate the old code in a piece-meal fashion. Also, I'm no expert in the new features in Java 5 (i.e. I know of them, but have never written any for production use). </p>

<p>My questions:</p>

<ol>
<li><p>What features of Java 5 are typically used in production code? (i.e. generics, auto-boxing, etc.) Are there features to be avoided / not considered to be best-practices?</p></li>
<li><p>What are the best refactoring strategies which I can use migrate a code base of this size? (i.e. make changes to classes one at a time only when a class is edited, etc.) Objective - reduce risk on the code base. Limitation - resources to do refactoring.</p></li>
</ol>

<p>Any advice is appreciated - thanks in advance.</p>

<p><B>UPDATE - a year too late, but better late than never? =)</B></p>

<p>Thank you for all of the comments - lots of great points of view. In the life of a software developer, there's always going to be the projects you strive to finish but never get around to because of something more ""urgent"". </p>

<p>With respect to the use of Java 5 (at that time), it was something which was required in the client's production environment, so that was why we did not use Java 6.</p>

<p>I found that the stronger typing for collections, enums and unboxing of primitives were the features I tend to apply the most, both to old and new code. The refactoring was fairly straight-forward, but code comprehension improved significantly and standards became easier to enforce. The ones I had the most trouble with was the generics; I think it's a concept which I still haven't had a chance to fully grasp and appreciate yet, so it was difficult for me to find previous cases where the application of generics was appropriate. </p>

<p>Thanks again to everyone who contributed to this thread and apologies for the late follow up.</p>
","<java><refactoring><migration>","3","1027","2009-04-07 12:01:48"
"726725","Refactoring classes that use global variables","<p>I'm working on some classes that get part of their configuration from global variables, e.g.</p>

<pre><code>class MyClass {
    public void MyClass(Hashtable&lt;String, String&gt; params) {
        this.foo = GlobalClass.GLOBALVAR.get(""foo"");
        this.bar = GlobalClass.GLOBALVAR.get(""bar"");
        this.params = params;
    }
}
</code></pre>

<p>This is bad for a couple of reasons, GLOBALVAR talks to a database to get some of the variables and this makes it really hard to make unit tests. The other problem is that I have many (dozens) of classes that inherit from MyClass, so I can't easily change the constructor signature.</p>

<p>My current solution is to create an additional default constructor and setter methods for <code>params</code>, <code>foo</code> and <code>bar</code>.</p>

<pre><code>class MyClass {
     // Other code still here for backwards compatibility.
     public void MyClass() {
         // Do nothing much.
     }
     public void setParams(Hashtable&lt;String, String&gt; params) {
         this.params = params;
     }
     public void setFoo(Foo foo) {
         this.foo = foo;
     }
     public void setBar(Bar bar) {
         this.bar = bar;
     }
}
</code></pre>

<p>Any ideas on a good way to refactor this, besides the way I did it? My other thought would be to use a factory method, but I'm afraid I'll run into polymorphic substitution problems.</p>
","<java><refactoring><global-variables>","2","481","2009-04-07 17:15:53"
"727547","Searching For Non Final Static Variables in Eclipse","<p>I am programming in Java in Eclipse. I was wondering if there is a way to search for all non final static variables in my code base.</p>

<p>For example:</p>

<pre><code>private static int MY_VAR = 0;
</code></pre>

<p>But not:</p>

<pre><code>public static final int MY_CONSTANT = 1;
</code></pre>
","<java><eclipse><refactoring>","2","219","2009-04-07 20:53:28"
"726851","Where is the correct place to put the code that writes a DataTable to XML when it needs to reference the parent DataGridView?","<p>I've got a DataGridView using a DataTable as it's DataSource. I'm allowing the user to alter the visibility, order (and width though that's not relevant to this question) of the DataGridView columns, but not the underlying DataTable. This means I don't have to recreate the DataTable every time the user makes a change to the view.</p>

<p>The user can export the DataTable to an XML file and I'd like the output to reflect what's on the screen.  I originally had the following:</p>

<pre><code>dataTable.WriteXml(saveFileDialog.FileName, XmlWriteMode.WriteSchema);
</code></pre>

<p>But this (obviously) writes all of the columns in the DataTable to file including the invisible ones in the order they're defined.</p>

<p>I've got the following code in the export button handler method. I know that it's in the wrong place, but I'm stumped as it needs to reference the DataGridView.</p>

<pre><code>private void export_Click(object sender, EventArgs e)
{
    // Show the SaveFileDialog.
    var saveFileDialog = new SaveFileDialog();
    saveFileDialog.Title = Properties.Resources.TSaveLibrary;
    saveFileDialog.Filter = Properties.Resources.TXMLFilter;
    if (saveFileDialog.ShowDialog() == DialogResult.OK)
    {
        using (XmlWriter writer = XmlWriter.Create(saveFileDialog.FileName))
        {
            writer.WriteStartDocument();
            writer.WriteRaw(""\n"");
            writer.WriteStartElement(""Library"");
            writer.WriteRaw(""\n"");

            // Find the visible columns and put them in display order
            var dcCollection = new List&lt;string&gt;();
            DataGridViewColumn dc = dataGridView.Columns.GetFirstColumn(DataGridViewElementStates.Visible);
            while (dc != null)
            {
                if (dc.Visible)
                {
                    dcCollection.Add(dc.Name);
                }
                dc = dataGridView.Columns.GetNextColumn(dc, DataGridViewElementStates.Visible, DataGridViewElementStates.None);
            }

            // Write the data
            foreach (DataRow dr in dataTable.Rows)
            {
                writer.WriteRaw(""  "");
                writer.WriteStartElement(dataTable.TableName);
                writer.WriteRaw(""\n"");

                foreach (string colName in dcCollection)
                {
                    writer.WriteRaw(""    "");
                    writer.WriteElementString(colName, dr[colName].ToString());
                    writer.WriteRaw(""\n"");
                }

                writer.WriteRaw(""  "");
                writer.WriteEndElement();
                writer.WriteRaw(""\n"");
            }

            writer.WriteEndElement();
            writer.WriteRaw(""\n"");
            writer.WriteEndDocument();
        }
    }
}
</code></pre>

<p>Any suggestions on how I can refactor this code?</p>
","<c#><xml><winforms><refactoring>","0","305","2009-04-07 17:42:37"
"728747","How to use TDD when the fix involves changing the method under test's signature?","<p>I'm trying to get my head around TDD methodology and have run into - what I think is - a chicken-and-egg problem: what to do if a bug fix involves the changing of a method's signature.</p>

<p>Consider the following method signature: </p>

<pre><code>string RemoveTokenFromString (string delimited, string token)
</code></pre>

<p>As the name suggests, this method removes all instances of a <code>token</code> from <code>delimited</code> and returns the resultant string. </p>

<p>I find later that this method has a bug (e.g. the wrong bits are being removed from the string). So I write a test case describing the scenario where the bug occurs and make sure that the test fails.</p>

<p>When fixing the bug, I find that the method needs more information to be able to do its job properly - and this bit of information can only be sent in as a parameter (the method under test is part of a static class).</p>

<p>What do I do then? If I fix the bug, this compels me to change the unit test - would that be 'correct' TDD methodology?  </p>
","<unit-testing><refactoring><tdd><methodology>","5","231","2009-04-08 06:25:21"
"735473","Can you refactor out a common functionality from these two methods?","<p>I have two methods that basically converts underlying checkboxes' text or tag as CSV strings.<br /></p>

<p>These two methods</p>

<ul>
<li>GetSelectedTextAsCsv()</li>
<li>GetTagAsCsv()</li>
</ul>

<p>differ only by which <em>property</em> to extract value from <code>SelectedCheckBoxes</code>, which is of type <code>IList&lt;CheckBox&gt;</code></p>

<pre><code>    public string GetSelectedTextAsCsv()
    {
        var buffer = new StringBuilder();
        foreach (var cb in SelectedCheckBoxes)
        {
            buffer.Append(cb.Text).Append("","");
        }
        return DropLastComma(buffer.ToString());
    }

    public string GetTagAsCsv()
    {
        var buffer = new StringBuilder();
        foreach (var cb in SelectedCheckBoxes)
        {
            buffer.Append(cb.Tag).Append("","");
        }
        return DropLastComma(buffer.ToString());
    }
</code></pre>

<p>I was trying to extract a method that returns a <code>Func&lt;T, TResult&gt;</code> but not sure how I can pull that off.
My poor attempt was like the following but I cannot figure out how to extract the property portion as shown in the comment within <code>ConvertToCsv()</code></p>

<pre><code>    public Func&lt;T, string&gt; ConvertToCsv&lt;T&gt;()
    {
        return propertyName =&gt;
        {
            var buffer = new StringBuilder();
            foreach (var checkBox in SelectedCheckBoxes)
            {
                buffer.Append(
                    /* How can you abstract this portion? like following? */ 
                    checkBox.propertyName
                ).Append("","");
            }
            return DropLastComma(buffer.ToString());
        };
    }
</code></pre>

<p>If I am on a wrong track, would you please advise me on how I can refactor above code to use a common method?</p>

<p><strong>[UPDATE 1]</strong> Here is the combination of both Brian and Jon's answers</p>

<pre><code>    public string ConvertToCsv&lt;T&gt;(Func&lt;CheckBox, T&gt; getValue)
    {
        var stringValues = SelectedCheckBoxes.Select(
            cb =&gt; getValue(cb).ToString()).ToArray();
        return string.Join("","", stringValues);
    }

    public string GetSelectedTextAsCsv()
    {
        return ConvertToCsv(cb =&gt; cb.Text);
    }

    public string GetTagAsCsv()
    {
        return ConvertToCsv(cb =&gt; cb.Tag);
    }
</code></pre>

<p><strong>[UPDATE 2]</strong> version 2</p>

<pre><code>    public string GetAsCsv&lt;T&gt;(Func&lt;CheckBox, T&gt; getValue)
    {
        return string.Join("","", SelectedCheckBoxes.Select(
            cb =&gt; getValue(cb).ToString()).ToArray());
    }

    public string GetSelectedTextAsCsv()
    {
        return GetAsCsv(cb =&gt; cb.Text);
    }

    public string GetTagAsCsv()
    {
        return GetAsCsv(cb =&gt; 
            cb.Tag == null ? string.Empty : cb.Tag.ToString());
    }
</code></pre>

<p><strong>[UPDATE 3]</strong> Made the parameter of <code>GetAsCsv()</code> as a closed generic of CheckBox and string</p>

<blockquote>
  <p><code>Func&lt;CheckBox, T&gt;</code> to <code>Func&lt;CheckBox, string&gt;</code>. </p>
</blockquote>

<p>That allowed me to make <code>GetAsCsv()</code> even simpler and more readable.</p>

<pre><code>private string GetAsCsv(Func&lt;CheckBox, string&gt; getValue)
{
    return string.Join("","", SelectedCheckBoxes.Select(getValue).ToArray());
}
</code></pre>
","<c#><.net><refactoring><csv>","7","397","2009-04-09 18:55:25"
"738160","ASP.NET MVC Views don't see any classes after massive refactoring","<p>My project went through a name change, which led to using ReSharper to change the name of namespaces throughout the solution. Everything compiles just fine, but my ASP.NET MVC views are no longer seeing any inherited classes. I've changed the namespace imports in web.config and everything, and I'm certain that the classes exist. They work if I refer to the fully-qualified class name (Name.Space.ClassName).</p>

<p>Why is this happening and how can I fix it?</p>

<p>EDIT: More detail:</p>

<p>Before refactoring, I had custom view page, master page, and user control classes:</p>

<blockquote>
  <p>SalesWeb.Mvc.Views.SalesWebViewPage<br />
  SalesWeb.Mvc.Views.SalesWebMasterPage<br />
  SalesWeb.Mvc.Views.SalesWebUserControl</p>
</blockquote>

<p>After refactoring:</p>

<blockquote>
  <p>Wasabi.SalesPortal.Mvc.Views.SalesPortalViewPage<br />
  Wasabi.SalesPortal.Mvc.Views.SalesPortalMasterPage<br />
  Wasabi.SalesPortal.Mvc.Views.SalesPortalUserControl</p>
</blockquote>

<p>In web.config, before refactoring:</p>

<pre><code>&lt;configuration&gt;
    &lt;system.web&gt;
        ...
        &lt;pages ...&gt;
            ...
            &lt;namespaces&gt;
                ...
                &lt;add namespace=""SalesWeb.Mvc.Views"" /&gt;
            &lt;/namespaces&gt;
        &lt;/pages&gt;
    &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre>

<p>After:</p>

<pre><code>&lt;configuration&gt;
    &lt;system.web&gt;
        ...
        &lt;pages ...&gt;
            ...
            &lt;namespaces&gt;
                ...
                &lt;add namespace=""Wasabi.SalesPortal.Mvc.Views"" /&gt;
            &lt;/namespaces&gt;
        &lt;/pages&gt;
    &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre>

<p>I've also changed the Inherits attribute on each of my views, master pages, and user controls. However, when attempting to visit the MVC application, it complains that <strong>SalesPortalMasterPage</strong> cannot be found, although I'm absolutely certain that it exists because I don't have any problems when referring to it as <strong>Wasabi.SalesPortal.Mvc.Views.SalesPortalMasterPage</strong>.</p>
","<c#><asp.net-mvc><refactoring><namespaces>","0","237","2009-04-10 16:28:03"
"737906","Extracting an Event (tabControl_DrawItem) to Class Library","<p>I have the following code under a TabConttrols DrawItem event that I am trying to extract into a class file.  I am having trouble since it is tied to an event.  Any hints or pointers would be greatly appreciated. </p>

<pre><code>        private void tabCaseNotes_DrawItem(object sender, DrawItemEventArgs e)
    {
        TabPage currentTab = tabCaseNotes.TabPages[e.Index];
        Rectangle itemRect = tabCaseNotes.GetTabRect(e.Index);
        SolidBrush fillBrush = new SolidBrush(Color.Linen);
        SolidBrush textBrush = new SolidBrush(Color.Black);
        StringFormat sf = new StringFormat
                              {
                                  Alignment = StringAlignment.Center,
                                  LineAlignment = StringAlignment.Center
                              };

        //If we are currently painting the Selected TabItem we'll
        //change the brush colors and inflate the rectangle.
        if (System.Convert.ToBoolean(e.State &amp; DrawItemState.Selected))
        {
            fillBrush.Color = Color.LightSteelBlue;
            textBrush.Color = Color.Black;
            itemRect.Inflate(2, 2);
        }

        //Set up rotation for left and right aligned tabs
        if (tabCaseNotes.Alignment == TabAlignment.Left || tabCaseNotes.Alignment == TabAlignment.Right)
        {
            float rotateAngle = 90;
            if (tabCaseNotes.Alignment == TabAlignment.Left)
                rotateAngle = 270;
            PointF cp = new PointF(itemRect.Left + (itemRect.Width / 2), itemRect.Top + (itemRect.Height / 2));
            e.Graphics.TranslateTransform(cp.X, cp.Y);
            e.Graphics.RotateTransform(rotateAngle);
            itemRect = new Rectangle(-(itemRect.Height / 2), -(itemRect.Width / 2), itemRect.Height, itemRect.Width);
        }

        //Next we'll paint the TabItem with our Fill Brush
        e.Graphics.FillRectangle(fillBrush, itemRect);

        //Now draw the text.
        e.Graphics.DrawString(currentTab.Text, e.Font, textBrush, (RectangleF)itemRect, sf);

        //Reset any Graphics rotation
        e.Graphics.ResetTransform();

        //Finally, we should Dispose of our brushes.
        fillBrush.Dispose();
        textBrush.Dispose();
    }
</code></pre>
","<c#><winforms><events><refactoring><tabcontrol>","0","150","2009-04-10 14:59:59"
"739694","Tools for keeping unit tests organised and named correctly","<p>I have been trying to clean up the naming and organisation conventions of our projects' unit and integration tests. We are using C#, NUnit, Visual Studio and Resharper.</p>

<p>It seems that if there is one best practice for unit test organisation it is that the layout and naming of the test classes and namespaces should mirror those of the code under test. As a consequence the file structure will also be replicated.</p>

<p>Wouldn't it be nice to have a tool that could automatically enforce and help refactor code to conform to these conventions? Does a tool like this exist?</p>

<p>For example, it would be simple for Resharper to recognise that OrderTest is a test fixture for the Order class. It could then ensure that the Order class exists and that it is in the same namespace. If the Order class underwent refactoring and was renamed, the OrderTest class should also be renamed.</p>
","<c#><unit-testing><tools><naming><refactoring>","4","242","2009-04-11 07:40:23"
"739498","How do I refactor chained methods?","<p>Starting with this code:</p>

<pre><code> new Person(""ET"").WithAge(88)
</code></pre>

<p>How can it be refactored to:</p>

<pre><code> new Person(""ET"", 88)
</code></pre>

<p>What sequence of refactorings needs to be performed to complete the transformation?</p>

<p>Why?  Because there could be hundreds of these, and I wouldn't want to introduce errors by doing it manually.</p>

<p>Would you say a drawback with fluent interfaces is they can't easily be refactored?</p>

<p>NOTE: I want to do this automatically without hand typing the code. </p>
","<refactoring><fluent-interface>","3","176","2009-04-11 04:07:01"
"739749","How do I refactor a WinForms application?","<p>I'm going to bugfix a WinForms application (.NET 2.0) in the near future. Looking through the source code I find large code files (more than 2000 lines) most of them are generated dialogs with lots of code-behind.</p>

<p>Has anyone tips for me to share? Any war stories or best-practices for bug fixing or refactoring WinForms applications?</p>
","<.net><winforms><refactoring><legacy-code>","2","236","2009-04-11 08:18:56"
"743451","How do you decide which parts of the code shall be consolidated/refactored next?","<p>Do you use any metrics to make a decision which parts of the code (classes, modules, libraries) shall be consolidated or refactored next? </p>
","<refactoring><consolidation>","1","76","2009-04-13 09:35:43"
"745167","How do I refactor multiple similar methods of this sort into a single method?","<p>Suppose I have a number of related classes that all have a method like this:</p>

<pre><code>protected override OnExecute()
{
    this.constructorParm.BoolProperty = !this.constructorParm.BoolProperty;
}
</code></pre>

<p>The type of <code>constructorParm</code> may change (it may also be a <code>static</code> <code>Setting</code>), and the specific property will certainly change, but the type of the property will always be <code>bool</code>.</p>

<p>Suppose further that I've decided it's silly to have 8 different classes that all do the exact same thing on an implementation level- toggle a bool value.  Especially when they're all related on a semantic level also (they all derive from the same <code>Command</code> abstract base class, which is where <code>OnExecute()</code> comes from).</p>

<p>How to I parameterize the property that I want to toggle without parameterizing the actual toggle operation itself?  For example, I know I can do something like this (uncompiled):</p>

<pre><code>internal class CommandX
{
    Action doExecute = null;
    public CommandX(Action executeAction) { this.doExecute = executeAction; }
    protected override OnExecute() { this.doExecute(); }
}

// elsewhere
var b = new CommandX(() =&gt; {target.BoolProperty = !target.BoolProperty;});
</code></pre>

<p>but how I can I capture the toggling behavior in the class, while still accepting the writable property as a parameter?  (If I pass the toggling in as a parameter, then I'm just making an over-complicated delegate.)</p>

<p>(I can't just pass the property in b/c <code>bool</code> is a value type, so I'd just be toggling a copy.  I can't pass it in by ref, of course, b/c properties can't be passed by ref.  I feel like there's got to be something stupid and obvious that I'm just really missing here.  :) )</p>

<h2><strong>Context</strong></h2>

<p>The reason I'm doing such a simple thing in an indirect manner is actually due to the use of the GoF Command pattern in winforms.  The core functionality <code>Command</code>s are more complex, but this small subset of <code>Command</code>s essentially just toggles a property that will raise PropertyChanged events elsewhere.  Instead of having all these commands in separate classes, I wanted to fold them into one because they're so simple.</p>
","<c#><refactoring><properties>","0","220","2009-04-13 20:00:53"
"744880","How can I improve this Rails code?","<p>I'm writing a little browser game as a project to learn RoR with and I'm quite new to it.</p>

<p>This is a little method that's called regularly by a cronjob.</p>

<p>I'm guessing there should be some way of adding elements to the potions array and then doing a bulk save at the end, I'm also not liking hitting the db each time in the loop to get the number of items for the market again.</p>

<pre><code>def self.restock_energy_potions
  market = find_or_create_market

  potions = EnergyPotion.find_all_by_user_id(market.id)

  while (potions.size &lt; 5)
    potion = EnergyPotion.new(:user_id =&gt; market.id)
    potion.save
    potions = EnergyPotion.find_all_by_user_id(market.id)
  end    
end
</code></pre>
","<ruby-on-rails><ruby><refactoring>","4","259","2009-04-13 18:23:54"
"745857","Do you find cyclomatic complexity a useful measure?","<p>I've been playing around with measuring the cyclomatic complexity of a big code base.</p>

<p>Cyclomatic complexity is the number of linearly independent paths through a program's source code and there are lots of free tools for your language of choice.</p>

<p>The results are interesting but not surprising.   That is, the parts I know to be the hairiest were in fact the most complex (with a rating of > 50).  But what I am finding useful is that a concrete ""badness"" number is assigned to each method as something I can point to when deciding where to start refactoring.</p>

<p>Do you use cyclomatic complexity?  What's the most complex bit of code you found? </p>
","<refactoring><metrics><code-metrics><cyclomatic-complexity>","28","2325","2009-04-14 00:02:02"
"749360","Refactoring method that binds controls to LINQ","<p>I have a function that binds LINQ results to the controls on my form.  The below code works but I just can't get over the feeling I should be slapped for the copy/paste aspect.  Can someone help me with what i need to do to deodorize this?</p>

<p>Thank You!</p>

<pre><code>private void BindDataToForm()
    {
        // Bind data to form
        CaseNotesDataContext db = new CaseNotesDataContext();
        Table&lt;CN_MaintItem&gt; caseNotesItems = db.GetTable&lt;CN_MaintItem&gt;();

        // For each object
        var contactType = from cType in caseNotesItems
                          where cType.CategoryID == 2
                          select cType.ItemDescription;
        chkContactType.DataSource = contactType;

        var contactLocation = from cLocation in caseNotesItems
                          where cLocation.CategoryID == 3
                          select cLocation.ItemDescription;
        lkuContactLocation.Properties.DataSource = contactLocation;

        var contactMethod = from cMethod in caseNotesItems
                          where cMethod.CategoryID == 4
                          select cMethod.ItemDescription;
        lkuContactMethod.Properties.DataSource = contactMethod;

        var contactWith = from cWith in caseNotesItems
                          where cWith.CategoryID == 5
                          select cWith.ItemDescription;
        chkContactWith.DataSource = contactWith;

        var domains = from d in caseNotesItems
                          where d.CategoryID == 6
                          select d.ItemDescription;
        chkDomains.DataSource = domains;
    }
</code></pre>
","<c#><.net><winforms><linq><refactoring>","0","160","2009-04-14 21:02:35"
"758961","C style logic and refactoring","<p>I love languages that evaluate a single expression both as a value and as a boolean value.  For example A = 1 evaluates to true, and so does 1.  If this practice is very common to the developers in my think tank, is it wrong not to refactor out these expressions, assuming no side effects?</p>

<p>I have a long standing discussion at work talking about code smells, but this logic complexity is <em>why</em> I like C so well.  It will be tough for me to switch to Java for example, which does not allow this effect (false != 0).</p>

<p>Any thoughts?</p>
","<c#><refactoring><agile><code-smell>","1","151","2009-04-17 03:59:00"
"760961","Refactoring WinForm ClickNCode to MVP Passive View","<p>I'm attempting to refactor an existing Winform application to use the MVP Passive View pattern. The application's UI, business logic and data storage code have been freely intermingled for years. It looks like it either started out with separate layers or someone attempted to separate it into layers. In any case the layer boundaries weren't respected.</p>

<p>Since the forms directly manipulate the domain objects and the data source(and vice versa), my first task is to create presenter/controller objects and delegate those responsibilities.</p>

<p>The application is a .NET 1.1 app and I'm developing in VS.NET 2003 with a rather limited refactoring add-in. I used a test generator for the existing code to create the boiler plate unit tests then went through and hand edited each test. Granted, this winds up testing what the code does, not necessarily what it's suppose to do. For new classes I'm doing TDD.</p>

<p><strong>Any tips, resources, pitfalls to look out for with a refactoring effort of this scale?</strong></p>

<p>A couple of resources I already have at my disposal:</p>

<ul>
<li>Collection of programming books; <em>Refactoring</em>, <em>PEAA</em>, <em>WELC</em></li>
<li>The internet (obviously)</li>
<li>Large quantities of caffeinated beverages</li>
</ul>

<p>Update:
As an example what steps would you take to turn this:</p>

<pre><code>    private void OneOfManyFormEventHandlers(object sender, System.EventArgs e)
	{
		string LocalVariable;
		decimal AnotherLocal;
		if (!this._SomeDomainObject.SomeMethod(ClassField, out LocalVariable, out AnotherLocal))
		{
			MessageBox.Show(""An error occurred calling method"");
			return;
		}

		this.FormControl.Value = LocalVariable;
		this.AnotherFormContorl.Value = AnotherLocal;

		this.AnotherPrivateMethod();
	}
</code></pre>

<p>Into this:</p>

<pre><code>    private void OneOfManyFormEventHandlers(object sender, System.EventArgs e)
    {
         this.FormPresenter.DoSomething();
    }
</code></pre>
","<c#><winforms><refactoring><mvp>","5","1152","2009-04-17 15:46:40"
"768025","API to programmatically refactor Java code","<p>Do you know an API to programmatically refactor Java code.</p>

<p>Preferably:</p>

<ul>
<li>easy to use</li>
<li>support for rich refactorings</li>
</ul>
","<java><api><refactoring>","7","509","2009-04-20 12:20:09"
"767401","How do I break this down into Unit Tests?","<p>I have a method that is called on an object to perform some business logic and add it to the database.</p>

<p>The object is a Transaction, and part of the business logic requires searching the databses for related accounts and history items on the account.</p>

<p>There are then a series of comparisons and operations that need to bring back information from the account and apply it to the transaction before the transaction is then passed on to other people and written to the database.</p>

<p>The only way I can think of for testing this currently is within the test to create an account and the relevant history information, then to construct a transaction for each different scenario and capture the information written to the DB for the transaction and information being passed on, however this feels like its testing way too much in one test.  Each scenario would be performed in a separate unit test, with the test construction refactored out into separate methods, but the actual piece of code targetted by the test is over 500 lines long.</p>

<p>I guess this question is more about refactoring than unit testing, but in this case they go hand in hand.</p>

<p>If anyone has any advice (good or bad) then I'd be glad to hear it.</p>

<p>EDIT:</p>

<p>Pseudo code:</p>

<pre><code>Find account for transaction 
Do validation on transaction codes and values 
Update transaction with info from account 
Get related history from account Handle different transaction codes and values (6 different combinations, each with different logic) 
Update the transaction again with new account info (resulting from business logic) 
Send transaction to clients
</code></pre>
","<unit-testing><refactoring>","2","187","2009-04-20 08:32:18"
"767437","Tool to refactor boolean expressions","<p>I'm looking for a tool to refactor boolean expression. I've got expressions like</p>

<pre><code>a1 =&gt; (b1 &lt;=&gt; c or d) AND 
a2 =&gt; (b2 &lt;=&gt; c or d) AND
a2 =&gt; (b2 &lt;=&gt; c or d)
</code></pre>

<p>The tool should be able to simplify expressions, e.g. extract the sub expression ""c or d"" in the example above. Is there a free computer algebra system which can do this?</p>

<p>Currently I think of refactoring the expressions manually an prove the equivalence with a little haskell quickcheck script.</p>
","<refactoring><boolean-logic><boolean-expression>","4","536","2009-04-20 08:43:37"
"768183","Pluses and minuses of using Factories in a Rails test suite?","<p>I'm currently looking at a hefty Rails test suite.  It's nothing I can get into specifics about, but the run time for the entire suite (unit/functional/some integration) can run upward of 5 minutes.</p>

<p>We're completely reliant on fixtures and are we're not mocking and stubbing as much as we should be.</p>

<p>Our next few sprints are going to be completely focused on the test suite, both improving coverage, writing better tests and most importantly writing more efficient tests.</p>

<p>So aside from more mocking and stubbing within our tests, we're considering replacing our fixtures with most likely Factory Girl.  I see a lot of happy folks doing similar situations but haven't been able to find a good resource on any minuses of moving to a factory.  I have seen some slower benchmarks when using benchmarks from various resources but cannot find a definitive this why factories are good and this is why you might not want to use them.</p>

<p>Can anyone educate me on why or why I shouldn't be using factories?</p>

<p>Thanks!</p>
","<ruby-on-rails><ruby><testing><refactoring><factories>","2","493","2009-04-20 13:12:56"
"773633","How to refactor, fix and optimize this character replacement function in java","<p>While tuning the application, I found this routine that strips XML string of CDATA tags and replaces certain characters with character references so these could be displayed in a HTML page. </p>

<p>The routine is less than perfect; it will leave trailing space and will break with StringOutOfBounds exception if there is something wrong with the XML.</p>

<p>I have created a few unit tests when I started working on the routing, but the present functionality can be improved, so these serve more of a reference.</p>

<p>The routine needs refactoring for sanity reasons. But, the real reason I need to fix this routine is to improve a performance. It has become a serious performance bottleneck in the application.</p>

<pre><code>package engine;

import junit.framework.Assert;
import junit.framework.TestCase;

public class StringFunctionsTest extends TestCase {

    public void testEscapeXMLSimple(){
    	final String simple = ""&lt;xml&gt;&lt;SvcRsData&gt;a&lt;![CDATA[&lt;sender&gt;John &amp; Smith&lt;/sender&gt;]]&gt;&lt;/SvcRsData&gt;&lt;/xml&gt; "";		
    	final String expected = ""&lt;xml&gt;&lt;SvcRsData&gt;a&amp;#60;sender&amp;#62;John &amp;#38; Smith&amp;#60;/sender&amp;#62;&lt;/SvcRsData&gt;&lt;/xml&gt; "";
    	String result = StringFunctions.escapeXML(simple);
    	Assert.assertTrue(result.equals(expected));
    }

    public void testEscapeXMLCDATAInsideCDATA(){
    	final String stringWithCDATAInsideCDATA = ""&lt;xml&gt;&lt;SvcRsData&gt;a&lt;![CDATA[&lt;sender&gt;John &lt;![CDATA[Inner &amp; CD ]]&gt;&amp; Smith&lt;/sender&gt;]]&gt;&lt;/SvcRsData&gt;&lt;/xml&gt; "";		
    	final String expected = ""&lt;xml&gt;&lt;SvcRsData&gt;a&amp;#60;sender&amp;#62;John &amp;#60;![CDATA[Inner &amp;#38; CD &amp; Smith&lt;/sender&gt;]]&gt;&lt;/SvcRsData&gt;&lt;/xml&gt; "";
    	String result = StringFunctions.escapeXML(stringWithCDATAInsideCDATA);		
    	Assert.assertTrue(result.equals(expected));
    }

    public void testEscapeXMLCDATAWithoutClosingTag(){		
    	final String stringWithCDATAWithoutClosingTag = ""&lt;xml&gt;&lt;SvcRsData&gt;a&lt;![CDATA[&lt;sender&gt;John &amp; Smith&lt;/sender&gt;&lt;/SvcRsData&gt;&lt;/xml&gt; "";
    	try{
    		String result = StringFunctions.escapeXML(stringWithCDATAWithoutClosingTag);
    	}catch(StringIndexOutOfBoundsException exception){
    		Assert.assertNotNull(exception);
    	}	
    }

    public void testEscapeXMLCDATAWithTwoCDATAClosingTags(){		
    	final String stringWithCDATAWithTwoClosingTags = ""&lt;xml&gt;&lt;SvcRsData&gt;a&lt;![CDATA[&lt;sender&gt;John Inner &amp; CD ]]&gt;&amp; Smith&lt;/sender&gt;]]&gt;bcd &amp; efg&lt;/SvcRsData&gt;&lt;/xml&gt; "";		
    	final String expectedAfterSecondClosingTagNotEscaped = ""&lt;xml&gt;&lt;SvcRsData&gt;a&amp;#60;sender&amp;#62;John Inner &amp;#38; CD &amp; Smith&lt;/sender&gt;]]&gt;bcd &amp; efg&lt;/SvcRsData&gt;&lt;/xml&gt; "";
    	String result = StringFunctions.escapeXML(stringWithCDATAWithTwoClosingTags);
    	Assert.assertTrue(result.equals(expectedAfterSecondClosingTagNotEscaped));
    }

    public void testEscapeXMLSimpleTwoCDATA(){
    	final String stringWithTwoCDATA = ""&lt;xml&gt;&lt;SvcRsData&gt;a&lt;![CDATA[&lt;sender&gt;John &amp; Smith&lt;/sender&gt;]]&gt;abc&lt;sometag&gt;xyz&lt;/sometag&gt;&lt;sometag2&gt;&lt;![CDATA[&lt;recipient&gt;Gorge &amp; Doe&lt;/recipient&gt;]]&gt;&lt;/sometag2&gt;&lt;/SvcRsData&gt;&lt;/xml&gt; "";		
    	final String expected = ""&lt;xml&gt;&lt;SvcRsData&gt;a&amp;#60;sender&amp;#62;John &amp;#38; Smith&amp;#60;/sender&amp;#62;abc&lt;sometag&gt;xyz&lt;/sometag&gt;&lt;sometag2&gt;&amp;#60;recipient&amp;#62;Gorge &amp;#38; Doe&amp;#60;/recipient&amp;#62;&lt;/sometag2&gt;&lt;/SvcRsData&gt;&lt;/xml&gt; "";
    	String result = StringFunctions.escapeXML(stringWithTwoCDATA);
    	Assert.assertTrue(result.equals(expected));
    }

    public void testEscapeXMLOverlappingCDATA(){
    	final String stringWithTwoCDATA = ""&lt;xml&gt;&lt;SvcRsData&gt;a&lt;![CDATA[&lt;sender&gt;John &amp; &lt;![CDATA[Smith&lt;/sender&gt;]]&gt;abc&lt;sometag&gt;xyz&lt;/sometag&gt;&lt;sometag2&gt;&lt;recipient&gt;Gorge &amp; Doe&lt;/recipient&gt;]]&gt;&lt;/sometag2&gt;&lt;/SvcRsData&gt;&lt;/xml&gt; "";		
    	final String expectedMess = ""&lt;xml&gt;&lt;SvcRsData&gt;a&amp;#60;sender&amp;#62;John &amp;#38; &amp;#60;![CDATA[Smith&amp;#60;/sender&amp;#62;abc&lt;sometag&gt;xyz&lt;/sometag&gt;&lt;sometag2&gt;&lt;recipient&gt;Gorge &amp; Doe&lt;/recipient&gt;]]&gt;&lt;/sometag2&gt;&lt;/SvcRsData&gt;&lt;/xml&gt; "";
    	String result = StringFunctions.escapeXML(stringWithTwoCDATA);
    	Assert.assertTrue(result.equals(expectedMess));
    }

}
</code></pre>

<p><hr /></p>

<p>This is the function:</p>

<pre><code>package engine;

public class StringFunctions {

    public static String escapeXML(String s) {
    	StringBuffer result = new StringBuffer();
    	int stringSize = 0;
    	int posIniData = 0, posFinData = 0, posIniCData = 0, posFinCData = 0;
    	String stringPreData = """", stringRsData = """", stringPosData = """", stringCData = """", stringPreCData = """", stringTempRsData = """";
    	String stringNewRsData = """", stringPosCData = """", stringNewCData = """";
    	short caracter;

    	stringSize = s.length();
    	posIniData = s.indexOf(""&lt;SvcRsData&gt;"");
    	if (posIniData &gt; 0) {
    		posIniData = posIniData + 11;
    		posFinData = s.indexOf(""&lt;/SvcRsData&gt;"");
    		stringPreData = s.substring(0, posIniData);
    		stringRsData = s.substring(posIniData, posFinData);
    		stringPosData = s.substring(posFinData, stringSize);
    		stringTempRsData = stringRsData;
    		posIniCData = stringRsData.indexOf(""&lt;![CDATA["");
    		if (posIniCData &gt; 0) {
    			while (posIniCData &gt; 0) {
    				posIniCData = posIniCData + 9;
    				posFinCData = stringTempRsData.indexOf(""]]&gt;"");
    				stringPreCData = stringTempRsData.substring(0,
    						posIniCData - 9);
    				stringCData = stringTempRsData.substring(posIniCData,
    						posFinCData);
    				stringPosCData = stringTempRsData.substring(
    						posFinCData + 3, stringTempRsData.length());

    				stringNewCData = replaceCharacter(stringCData);
    				stringTempRsData = stringTempRsData.substring(
    						posFinCData + 3, stringTempRsData.length());
    				stringNewRsData = stringNewRsData + stringPreCData
    						+ stringNewCData;
    				posIniCData = stringTempRsData.indexOf(""&lt;![CDATA["");
    			}
    		} else {
    			stringNewRsData = stringRsData;
    		}
    		stringNewRsData = stringNewRsData + stringPosCData;
    		s = stringPreData + stringNewRsData + stringPosData;
    		stringSize = s.length();
    	}

    	for (int i = 0; i &lt; stringSize; i++) {
    		caracter = (short) s.charAt(i);
    		if (caracter &gt; 128) {
    			result.append(""&amp;#"");
    			result.append(caracter);
    			result.append(';');
    		} else {
    			result.append((char) caracter);
    		}
    	}
    	return result.toString();

    }

    private static String replaceCharacter(String s) {
    	StringBuffer result = new StringBuffer();
    	int stringSize = s.length();
    	short caracter;

    	for (int i = 0; i &lt; stringSize; i++) {

    		caracter = (short) s.charAt(i);
    		if (caracter &gt; 128 || caracter == 34 || caracter == 38
    				|| caracter == 60 || caracter == 62) {
    			result.append(""&amp;#"");
    			result.append(caracter);
    			result.append(';');
    		} else {
    			result.append((char) caracter);
    		}
    	}
    	return result.toString();

    }

}
</code></pre>
","<java><string><optimization><refactoring><char>","0","194","2009-04-21 17:16:12"
"773500","Are private methods in general a code smell?","<p>In the sense that a code smell is an indicator of a potential need for refactoring are private methods a code smell?</p>

<p>I was looking at some of my own code and it dawned on me that many of my public methods don't actually do anything other than consolidate private methods of the same class. Furthermore, none of the private methods relied on any member variables.</p>

<p>This got me thinking and I started looking through other classes. Everywhere I looked was the same pattern: private methods with little or no dependence on data in the class they were defined in.</p>

<p>It struck me that these private methods didn't really belong to the classes they were in. Of course extracting them to new classes would mean making them public so there was no point to them being private in the first place.</p>

<p>Is this universal to all private methods or have I just not looked long enough to find private methods that look like they belong in the class their in?</p>

<p>Update:</p>

<p>Judging from the responses the general consensus on this site seems to be that they are not. I was curious if there were some who disagreed. I stumbled across a <a href=""http://c2.com/cgi/wiki?MethodsShouldBePublic"">debate</a> on c2.com that brings up some interesting counterpoints.</p>

<p>In any case it seems that by themselves private methods don't really indicate any particular opportunity for refactoring. Thanks for all the input.</p>
","<language-agnostic><refactoring><code-smell>","15","1471","2009-04-21 16:32:49"
"776683","How can I make this Xaml a Template?","<p>Without using code, how can I turn this into a Template?</p>

<p>I have about 10 of these, and my code is getting huge. It is working perfectly, I am just looking for ways to clean up the code, I am just not familiar enough with templating and resourcing animations and triggers to do this.</p>

<p>Thanks in advance.</p>

<pre><code>	&lt;RadioButton Width=""35"" Height=""35"" Content=""RadioButton"" Visibility=""Visible"" IsChecked=""False"" Margin=""2.5,2.5,2.5,2.5"" Template=""{DynamicResource RadioTemplate}"" &gt;
		&lt;RadioButton.Resources&gt;
			&lt;ControlTemplate x:Key=""RadioTemplate"" TargetType=""{x:Type RadioButton}""&gt;
				&lt;BulletDecorator Background=""Transparent""&gt;
					&lt;BulletDecorator.Bullet&gt;
						&lt;StackPanel&gt;
							&lt;Image Width=""Auto"" Height=""Auto"" Source=""..\Content\img.png"" Stretch=""Fill"" /&gt;
						&lt;/StackPanel&gt;
					&lt;/BulletDecorator.Bullet&gt;
				&lt;/BulletDecorator&gt;
			&lt;/ControlTemplate&gt;
		&lt;/RadioButton.Resources&gt;
		&lt;RadioButton.BitmapEffect&gt;
			&lt;OuterGlowBitmapEffect x:Name=""imageGlow"" GlowColor=""#FFeeba00"" Opacity=""1"" GlowSize=""0"" /&gt;
		&lt;/RadioButton.BitmapEffect&gt;
		&lt;RadioButton.Triggers&gt;
			&lt;EventTrigger RoutedEvent=""ToggleButton.Checked""&gt;
				&lt;BeginStoryboard&gt;
					&lt;Storyboard&gt;
						&lt;DoubleAnimation Storyboard.TargetName=""imageGlow"" Storyboard.TargetProperty=""GlowSize"" From=""0"" To=""10"" Duration=""0:0:.15"" AutoReverse=""False"" /&gt;
					&lt;/Storyboard&gt;
				&lt;/BeginStoryboard&gt;
			&lt;/EventTrigger&gt;
			&lt;EventTrigger RoutedEvent=""ToggleButton.Unchecked""&gt;
				&lt;BeginStoryboard&gt;
					&lt;Storyboard&gt;
						&lt;DoubleAnimation Storyboard.TargetName=""imageGlow"" Storyboard.TargetProperty=""GlowSize"" From=""10"" To=""0"" Duration=""0:0:.15"" AutoReverse=""False"" /&gt;
					&lt;/Storyboard&gt;
				&lt;/BeginStoryboard&gt;
			&lt;/EventTrigger&gt;
		&lt;/RadioButton.Triggers&gt;
	&lt;/RadioButton&gt;
</code></pre>
","<wpf><templates><xaml><refactoring>","0","1020","2009-04-22 11:10:49"
"778553","Guess this goto label","<p>I was about to refactor this following VB6 code (written by someone else).</p>

<pre><code>Public Function GetValue(ID As Long) As Boolean
	On Error GoTo eh

	'' ... DAL Logic...

eh_Exit:
  On Error GoTo 0
  Exit Function
eh:
  Resume eh_Exit
End Function
</code></pre>

<p>What do you think the original author's intention was for the label <code>eh</code>?<br /><br /></p>

<p>Probably Just ""eh, something happened?""...</p>

<p>I want to make it readable without me having to think about it just like now...</p>
","<refactoring><label><goto>","0","251","2009-04-22 18:26:59"
"784003","C# Linq Code Refactoring","<p>The code below is what I currently have and works fine.  I feel that I could do more of the work I am doing in Linq instead of C# code.  </p>

<p>Is there is anyone out there who can accomplish the same result with more Linq code and less C# code. </p>

<pre><code>    public List&lt;Model.Question&gt; GetSurveyQuestions(string type, int typeID)
    {
        using (eMTADataContext db = DataContextFactory.CreateContext())
        {
            List&lt;Model.Question&gt; questions = new List&lt;Model.Question&gt;();
            List&lt;Linq.Survey_Question&gt; survey_questions;
            List&lt;Linq.Survey&gt; surveys = db.Surveys
                                          .Where(s =&gt; s.Type.Equals(type) &amp;&amp; s.Type_ID.Equals(typeID))
                                          .ToList();

            if (surveys.Count &gt; 0)
            {                   
                survey_questions = db.Survey_Questions
                                     .Where(sq =&gt; sq.Survey_ID == surveys[0].ID).ToList();

                foreach (Linq.Survey_Question sq in survey_questions)
                {
                    Model.Question q = Mapper.ToBusinessObject(sq.Question);
                    q.Status = sq.Status;
                    questions.Add(q);                        
                }
            }
            else
            {
                questions = null;
            }
            return questions;
        }
    }
</code></pre>

<p>Here is my Mapper function from my Entity to Biz Object</p>

<pre><code>  internal static Model.Question ToBusinessObject(Linq.Question q)
        {
            return new Model.Question
            {
                ID = q.ID,
                Name = q.Name,
                Text = q.Text,
                Choices = ToBusinessObject(q.Question_Choices.ToList())                
            };            
  }
</code></pre>

<p>I want my mapper funciton to map the Question Status like so.</p>

<pre><code> internal static Model.Question ToBusinessObject(Linq.Question q)
    {
        return new Model.Question
        {
            ID = q.ID,
            Name = q.Name,
            Text = q.Text,
            Choices = ToBusinessObject(q.Question_Choices.ToList()),
            Status = q.Survey_Questions[?].Status
        };
    }
</code></pre>

<p><strong>?</strong> the issue is this function does not know which survey to pull the status from.</p>

<p>Instead of creating the biz object then setting the Status property in a foreach loop like so</p>

<pre><code> foreach (Linq.Survey_Question sq in survey_questions)
{
    Model.Question q = Mapper.ToBusinessObject(sq.Question);
    q.Status = sq.Status;
    questions.Add(q);                        
}
</code></pre>

<p>I would like to somehow filter the <code>EntitySet&lt;Survey_Question&gt;</code> in the q object above in the calling method, such that there would only be one item in the q.Survey_Questions[?] collection. </p>

<p>below is my database schema and business object schema
<img src=""http://i41.tinypic.com/1051n28.png"" alt=""alt text"" />
<img src=""http://i43.tinypic.com/awua2v.png"" alt=""alt text"" /></p>
","<c#><linq><refactoring>","1","516","2009-04-23 23:38:59"
"785667","Python tool that suggests refactorings","<p>When digging into legacy Python code and writing Python code myself, I often use <a href=""http://www.logilab.org/857"" rel=""nofollow"">pylint</a>. I'm also using <a href=""http://clonedigger.sourceforge.net/"" rel=""nofollow"">Clone Digger</a>. I've recently started to use <a href=""http://rope.sourceforge.net/"" rel=""nofollow"">rope</a>, which is a library for automated refactoring.</p>

<p>But I'm looking for something else than rope. I would prefer a tool that just makes suggestions about possible refactorings: names the refactoring, optionally provides a short description of it (great for learning purposes), highlights the code section and lets me do the refactoring myself. Is there such a tool?</p>
","<python><refactoring>","9","1100","2009-04-24 12:41:02"
"787861","Typical C with C Preprocessor refactoring","<p>I'm working on a refactoring tool for C with preprocessor support...
I don't know the kind of refactoring involved in large C projects and I would like to know what people actually do when refactoring C code (and preprocessor directives)</p>

<p>I'd like to know also if some features that would be really interesting are not present in any tool and so the refactoring has to be done completely manually... I've seen for instance that Xref could not refactor macros that are used as iterators (don't know exactly what that means though)...</p>

<p>thanks</p>
","<c><refactoring>","2","1123","2009-04-24 23:50:00"
"788848","Resharper change object to interface","<p>I have an upgraded 3rd party library and there used to be an object called Foo and now its an interface called IFoo</p>

<p>what is the best way to change all usages and declarations of Foo to IFoo</p>

<p>i tried doing Find / Replace but this also affected FooBar to IFooBar (which i dont want)</p>

<p>thoughts?</p>
","<c#><visual-studio><refactoring>","2","123","2009-04-25 12:46:52"
"788856","Find / Replace all files in namespace or folder","<p>I know I can do a find /replace by searching: </p>

<ul>
<li>Current Document</li>
<li>Current Project</li>
<li>Current Solution</li>
</ul>

<p>Is there any way to do this by searching the current namespace or current folder?</p>
","<c#><visual-studio><refactoring>","0","244","2009-04-25 12:49:58"
"790703","Tricks to refactor a piece of code with many branches (if/then/else)","<p>I'm having a hard time trying to refactor some pieces of code with many branches. There are many if/then/else blocks, some of them are nested.</p>

<p>Are there any tricks that can be used to refactor the code without wasting a lot of time trying to understand every minor aspect of the functionality first?</p>

<p>For now I'm basically using boolean algebra (De Morgan's laws). I'm trying to modify the conditions in if statements so I could pop up small code snippets outside if/then/else blocks. This helps somehow, but the code still remains branched. I know at some point I will eventually have to break the biggies into smaller class methods, but this is complicated because the code contains calls to many other class methods and has a lot of local-scope variables, so I will have to deal with passing many arguments to new methods. I wonder If I could use some other tricks to improve the code quality before I start breaking it into distinct smaller pieces (class methods).</p>
","<language-agnostic><refactoring>","2","440","2009-04-26 11:50:13"
"795102","ruby loop refactor","<p>I have a loop that looks like this</p>

<pre><code>def slow_loop(array)
 array.each_with_index do |item, i|
   next_item = array[i+1]
   if next_item &amp;&amp; item.attribute == next_item.attribute
     do_something_with(next_item)
   end
 end
end
</code></pre>

<p>aside from changing the way do_something_with is called, how can i make this perform better?</p>

<p>thx,</p>

<p>-C</p>

<p>p.s.</p>

<p>Since it appears that this is an 'O(n)' operation, there is apparently no performance to be gained here, so the answer i chose is one that uses a ruby method that already encapsulates this operation. thanks for your help everybody</p>
","<ruby><arrays><refactoring>","1","318","2009-04-27 20:16:15"
"794485","How to refactor tightly coupled classes?","<p>I'm trying to refactor a big tightly coupled application and trying to make it more maintainable and flexible.</p>

<p>I've got many unit tests, so I'm hoping to refactor step by step.</p>

<p>Which Design &amp; Refactoring Patterns should I consider implementing / applying to accomplish this task ?</p>

<p>I can think of some :</p>

<ul>
<li><a href=""http://sourcemaking.com/refactoring/extract-interface"" rel=""nofollow"">Extract Interface</a> </li>
<li><a href=""http://sourcemaking.com/refactoring/extract-method"" rel=""nofollow"">Extract Method</a></li>
<li><a href=""http://en.wikipedia.org/wiki/Dependency%5Finjection"" rel=""nofollow"">Dependency Injection</a></li>
</ul>

<p>Also feel free to share your own experience and best practices for this kind of refactoring job.</p>

<p><strong>UPDATE</strong> </p>

<p>I'm carrying out this refactoring <a href=""http://stackoverflow.com/questions/794038"">because of the reasons explained in this question</a>. Basically I can't implement a plugin system without extracting an couple of interfaces and those interfaces are highly coupled which requires separated the application in 40+ DLLs to just compile without circular referencing problem. </p>
","<.net><design-patterns><refactoring><coupling>","2","794","2009-04-27 17:31:05"
"794171","What is the optimal trade off between refactoring and increasing the call stack?","<p>I'm looking at refactoring a lot of large (1000+ lines) methods into nice chunks that can then be unit tested as appropriate.</p>

<p>This started me thinking about the call stack, as many of my rafactored blocks have other refactored blocks within them, and my large methods may well have been called by other large methods.</p>

<p>I'd like to open this for discussion to see if refactoring can lead to call stack issues.  I doubt it will in most cases, but wondered about refactored recursive methods and whether it would be possible to cause a stack overflow without creating an infinite loop?</p>
","<callstack><refactoring>","0","109","2009-04-27 15:59:20"
"798243","Metrics for measuring successful refactoring","<p>Are there objective metrics for measuring code refactoring? </p>

<p>Would running findbugs, CRAP or checkstyle before and after a refactoring be a useful way of checking if the code was actually improved rather than just changed?</p>

<p>I'm looking for trends we can capture that can help us improve the code review process without wasting time on code that gets changed for simple personal preference. </p>
","<language-agnostic><refactoring><agile>","4","545","2009-04-28 14:25:28"
"798389","Python tool that builds a dependency diagram for methods of a class","<p>I'm digging into a huge legacy Python class that has a lot of methods. I eventually break complex ones into smaller pieces so the amount of methods increases even more. I wonder if there is a tool that can scan the Python code and build some kind of dependency diagram for its methods.</p>

<p>I define method <code>x()</code> to be a dependency of method <code>y()</code> if <code>x()</code> is called at least once in <code>y()</code>.</p>

<p>I could use such a tool to isolate (if possible) subsets of class methods that have no external dependencies (all their dependencies are methods from the same subset).</p>

<p>I'm planning to move some functionality into other classes and I think that such an approach would help me to decide which parts to extract from the initial huge class.</p>

<p>Edit: I would really like a command-line tool.</p>
","<python><tools><refactoring>","13","1244","2009-04-28 14:54:26"
"802339","Do you look at which variables a method uses before refactoring a large class into smaller ones?","<p>I am interested in exploring the idea that the relationship between methods and the member varialbes they use can give a hint to how the class could be broken up into smaller pieces. The idea is that a group of variables will be closely related to one responsibility and should be contained in one class according to SRP.</p>

<p>For a trivial example, a class such as:</p>

<pre><code>public class Rectangle {
  private int width; 
  private int height;
  private int red,green,blue;
  public int area() { return width * height; }
//just an example, didn't check the api.
  public Color color () { return new Color (red, green, blue); } 
}
</code></pre>

<p>Should be refactored into:</p>

<pre><code>public class Rectangle {
  private Dimension size;
  private Color color;
  ...
}
</code></pre>

<p>Because the break down would be:</p>

<p>Area: width, height
Color: red, green, blue</p>

<p>Since these variables are used in the same method they are clearly related and could be made into a class of its own. I know this example might be too trivial but bear with me and try and think bigger here. If other methods also use these variables they are most likely also related and could also be moved into the new class.</p>

<p>Just for fun I created a little <a href=""http://willcodejavaforfood.com/vu.html"" rel=""nofollow"">plugin for Eclipse</a> that tries to do this. It will have a break down on methods->variables, variables->methods and also tries to group methods together after which variables they use either directly or indirectly. </p>

<p>Is this something that you do when coding, and is it actually helpful?</p>
","<java><refactoring><eclipse-plugin><code-smell>","3","232","2009-04-29 13:20:31"
"807594","Refactoring an enable/disable button toggle function","<p>I have the following simple function:</p>

<pre><code>    private	void EnableDisable941ScheduleBButton()
	{
		if (this._uosDepositorFrequency.Value != null)
			this._btnScheduleB.Enabled = ((int)this._uosDepositorFrequency.Value ==	0);
	}
</code></pre>

<p>It's a member of a Winform class which I'm trying to split into a passive view and presenter. It's obvious there is business logic tangled together with UI wiring. I'm just not sure of the best way to separate them.</p>

<p>To give a little context, the function is called from three locations in the form. _uosDepositorFrequency is a radiobutton group with only two buttons.</p>

<p>Any ideas?</p>

<p>Update:</p>

<p>Ok, maybe it isn't as obvious as I thought. The business rule states that if an employer makes semiweekly deposits (_uosDepositorFrequency.Value = 0) they are required to fill out a Schedule B form.</p>
","<c#><refactoring>","1","336","2009-04-30 15:44:46"
"809945","Refactoring with Lambda's and Delegates","<p>I've just installed VS2008 and have run into a problem that I'm sure can be solved with either lambda's or delegates (or a combination!).</p>

<pre><code>    private string ReadData(TcpClient s, string terminator)
    {
        // Reads a byte steam into a string builder until either data is unavailable or the terminator has not been reached
        var sb = new StringBuilder();
        do
        {
            var numBytesRead = s.GetStream().Read(byteBuff, 0, byteBuff.Length);
            sb.AppendFormat(""{0}"", Encoding.ASCII.GetString(byteBuff, 0, numBytesRead));
        } while (s.GetStream().DataAvailable &amp;&amp; !sb.ToString().Contains(terminator));

        return sb.ToString();
    }
</code></pre>

<p>The problem is, sometimes I need to check if the string contains either of two different values. Sometimes I may need to check it for three values.</p>

<p>So what I propose, is to change "" !sb.ToString().Contains(terminator)"" to a function that is passed into the method. </p>

<p>I could write my different functions such as:</p>

<pre><code>private bool compare1(string s, string t) {
    return s.contains(t)
}

private bool compare2(string s, string t1, string t2) {
    return (s.compare(t1) or s.compare(t2)
}

// etc...
</code></pre>

<p>Then when I want to compare with 3 different values, create a delegate to one of these functions, then pass that to the ReadData() method.</p>

<p>I'm very clueless when it comes to delegates, and I'm not sure if this seems like the right place for a lambda but something is telling me it is.</p>

<p>The calling code is this:</p>

<pre><code>            // Enter username .
        if (HasData(s,""login:""))
            SendData(s, switchUser + TelnetHelper.CRLF);
</code></pre>

<p>HasData is identical to ReadData, but returns a bool instead of a string (which I'd also like to factor out into one method using some trickery - but that's a secondary question - feel free to answer that though.</p>

<p>Just for reference:</p>

<pre><code>     private bool HasData(TcpClient s, string terminator)
    {
        // Reads a byte steam into a string builder until either data is unavailable or the terminator has not been reached
        var sb = new StringBuilder();
        do
        {
            var numBytesRead = s.GetStream().Read(byteBuff, 0, byteBuff.Length);
            sb.AppendFormat(""{0}"", Encoding.ASCII.GetString(byteBuff, 0, numBytesRead));
        } while (s.GetStream().DataAvailable &amp;&amp; !sb.ToString().Contains(terminator));

        return sb.ToString().Contains(terminator);
    }
</code></pre>
","<c#><.net><refactoring><delegates><lambda>","1","496","2009-05-01 02:20:58"
"810313","What is the reason behind JSLint saying there are ""too many var statements""","<p>JSLint (with the onevar flag turned on) is flagging some javascript code that I have with the following:</p>

<pre>Problem at line 5 character 15: Too many var statements.</pre>

<p>I am happy to fix these errors, but I'd like to know, am I doing it for performance or because it is just a bad practice and has a greater potential to introduce bugs in my javascript code.  What is the reason behind the onevar flag?</p>

<p>I did look at the JSLint docs for the <a href=""http://www.jslint.com/lint.html#var"" rel=""nofollow"">var keyword</a> but it doesn't specifically talk about why multiple var statements in the same function are bad.</p>

<p>Here is an attempt at an example.  Explain how the code will benefit from only having 1 var statement:</p>

<pre><code>function Test(arg) {
   var x = arg + 1,
       y = cache.GetItem('xyz');
   if (y !== null) {
      // This is what would cause the warning in JSLint
      var request = ajaxPost(/* Parameters here */);

   }
}
</code></pre>
","<javascript><refactoring><jslint>","30","4848","2009-05-01 05:42:24"
"816391","Python: avoiding pylint warnings about too many arguments","<p>I want to refactor a big Python function into smaller ones. For example, consider this following code snippet:</p>

<pre><code>x = x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9
</code></pre>

<p>Of course, this is a trivial example. In practice, the code is more complex. My point is that it contains many local-scope variables that would have to be passed to the extracted function, which could look like:</p>

<pre><code>def mysum(x1, x2, x3, x4, x5, x6, x7, x8, x9):
    x = x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9
    return x
</code></pre>

<p>The problem is that pylint would trigger a warning about too many arguments.
I could avoid the warning by doing something like:</p>

<pre><code>def mysum(d):
    x1 = d['x1']
    x2 = d['x2']
    ...
    x9 = d['x9']
    x = x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9
    return x

def mybigfunction():
    ...
    d = {}
    d['x1'] = x1
    ...
    d['x9'] = x9
    x = mysum(d)
</code></pre>

<p>but this approach loos ugly to me, it requires writing a lot of code that is even redundant.</p>

<p>Is there a better way to do it?</p>
","<python><refactoring><pylint>","3","2207","2009-05-03 05:13:02"
"823498","Refactoring strategy for the class which generates specific text file","<p>I am a TDD noob and I don't know how to solve the following problem.
I have pretty large class which generates text file in a specific format, for import into the external system. I am going to refactor this class and I want to write unit tests before. </p>

<p>How should these tests look like? Actually the main goal - do not break the structure of the file. But this does not mean that I should compare the contents of the file before and after? </p>
","<c#><unit-testing><refactoring><tdd>","1","115","2009-05-05 05:44:33"
"827774","Refactoring of a large C++ function","<p>At work we have a legacy process written in Visual C++ that basically consists of a single 5000 line function. In essence the program is just one big case statement with similar cut-and-pasted code handling a fair amount of the logic for case. Obviously we would like to refactor this code to extract these cases out into separate functions (or objects) and to eliminate any cut-and-pasted code.</p>

<p>My question is - are there any suggestions for going about a refactoring effort of this size? Are there any automated tools that could streamline the process?</p>
","<visual-c++><refactoring>","4","483","2009-05-06 02:30:40"
"828236","Is it possible to refactor this Java code?","<p>I have a simple code below:</p>

<pre><code>import java.util.ArrayList;

public class BoidList extends ArrayList
{
  synchronized public Boid GetBoid( int idx_ ) throws ArrayIndexOutOfBoundsException
  {
    if( idx_ &lt;  super.size() &amp;&amp;
        idx_ &gt;= 0 )
    {
      return (Boid) super.get(idx_);
    }
    else
    {
      throw new ArrayIndexOutOfBoundsException();
    }
  }
  synchronized public void RemoveBoid( int idx_ ) throws ArrayIndexOutOfBoundsException
  {
    if( idx_ &lt;  super.size() &amp;&amp;
        idx_ &gt;= 0 )
    {
      super.remove(idx_);
    }
    else
    {
      throw new ArrayIndexOutOfBoundsException();
    }    
  }
}
</code></pre>

<p>There's a lot of similarity between the 2 methods, yet they do two different things. Is it possible to refactor this?</p>
","<java><refactoring>","0","428","2009-05-06 06:07:13"
"828624","How to refactor these 2 similar methods into one?","<p>I've seen some samples of using 'T' to make a method reuseable for generic collections of different classes, but I've never really gotten into it or understood the samples. </p>

<p>I wonder if it would be possible to put the 2 methods below into one and what the downsides of doing this would be (performance-wise).</p>

<p>Anyone?           </p>

<pre><code>        [NonAction]
        public List&lt;SelectListItem&gt; ToSelectList(IEnumerable&lt;Department&gt; departments, string defaultOption)
        {
            var items = departments.Select(d =&gt; new SelectListItem() { Text = d.Code + "" - "" + d.Description, Value = d.Id.ToString() }).ToList();
            items.Insert(0, new SelectListItem() { Text = defaultOption, Value = ""-1"" });
            return items;
        }

        [NonAction]
        public List&lt;SelectListItem&gt; ToSelectList(IEnumerable&lt;Function&gt; functions, string defaultOption)
        {
            var items = functions.Select(f =&gt; new SelectListItem() { Text = f.Description, Value = f.Id.ToString() }).ToList();
            items.Insert(0, new SelectListItem() { Text = defaultOption, Value = ""-1"" });
            return items;
        }
</code></pre>

<p><hr /></p>

<p><strong>SOLUTION</strong></p>

<p>The solution that I used:</p>

<p><em>usage</em></p>

<pre><code>var departmentItems = departments.ToSelectList(d =&gt; d.Code + "" - "" + d.Description, d =&gt; d.Id.ToString(), "" - "");
var functionItems = customerFunctions.ToSelectList(f =&gt; f.Description, f =&gt; f.Id.ToString(), "" - "");
</code></pre>

<p><em>with</em></p>

<pre><code> public static class MCVExtentions
    {
        public static List&lt;SelectListItem&gt; ToSelectList&lt;T&gt;(this IEnumerable&lt;T&gt; enumerable, Func&lt;T, string&gt; text, Func&lt;T, string&gt; value, string defaultOption)
        {
            var items = enumerable.Select(f =&gt; new SelectListItem() { Text = text(f), Value = value(f) }).ToList();
            items.Insert(0, new SelectListItem() { Text = defaultOption, Value = ""-1"" });
            return items;
        }
    }
</code></pre>
","<c#><generics><refactoring>","5","468","2009-05-06 08:36:53"
"828764","Why do we Refactor?","<p>I would like to know the reasons that we do refactoring and justify it. I read a lot of people upset over the idea of refactoring. <a href=""http://codebetter.com/blogs/jeremy.miller/archive/2008/05/15/why-do-we-refactor.aspx"" rel=""nofollow"">Refactoring was variously described</a> as:</p>

<ol>
<li><p>A result of insufficient upfront
design.</p></li>
<li><p>Undisciplined hacking</p></li>
<li><p>A dangerous activity that needlessly risked destabilizing
working code</p></li>
<li><p>A waste of resources.</p></li>
</ol>

<p><b>What are the responsible reasons that lead us to refactor our code? </B></p>

<p>I also found a similar question here <a href=""http://stackoverflow.com/questions/140677/how-often-should-you-refactor"">how-often-should-you-refactor</a>, it doesn't provide the reason for refactoring. </p>
","<refactoring>","7","952","2009-05-06 09:15:11"
"829598","What's the best way to consume webservices in Classic ASP?","<p>We have a three-tier architecture consisting of Classic ASP Frontend, VB COM+ Objects and MSSql Database.</p>

<p>We are going to replace the VB COM by ASP.NET Webservice layer soon but we are not in the position to replace the Classic ASP with new .NET code (yet) and we're therefore going to need a way to <strong>consume webservices in Classic ASP</strong>...</p>

<p>We know it's possible but unsure what the best way is to do this...</p>

<p>Can we return VBScript RecordSets in a webservice call? (All of our Classic ASP Frontend uses Recordsets at the moment). If not what would the easiest way to use consume the results?</p>

<p>Are there any libraries / classes that make it easier?</p>

<p>All advice, links, code examples and comments are welcome!</p>
","<web-services><asp-classic><refactoring>","1","1028","2009-05-06 13:36:09"
"833682","Where can I find information on Authentication and Authorization in the context of Domain Driven Design?","<p>I'm trying to do things the DDD (domain driven design) way. And boy do I struggle. In all books I read, Authentication is of no concern and not mentioned!</p>

<p>I've written my own Authentication and Membership Service which are responsible for registering and logging in users, creating salted passwords etc. I do not use .NET's Membership Provider but do rely on Forms Authentication.</p>

<p>I've implemented a User model that holds the Username, E-Mail, PasswordHash, ApprovalStatus etc.</p>

<p>Now I guess the rest of the domain model shouldn't concern itself with the Users. I have a class Person that is used to model Persons and their associated data. As such it can be used to model personal data from users and from non-users. An object of type Company works with Persons, not Users. And an Activity is assigned to a Person, not a User.</p>

<p>The question, how do I relate the Person model to the User model? I don't really want a reference to each other in either of the two models. Should I create some Relationship model called PersonUser and create an additional service that retrieves the person object for the currently authenticated user?</p>
","<asp.net-mvc><refactoring><domain-driven-design><data-modeling><separation-of-concerns>","1","397","2009-05-07 09:27:29"
"835696","What's a good practice for dividing up presenters in a MVP interface pattern that have grown too large?","<p>One problem that I have frequently run into lately is the problem of my presenter classes growing too large.  Usually, I can chop up a regular large class without skipping a beat.  But the presenters sometimes are a little more difficult to pare down, without making the code harder to follow.  </p>

<p>Especially when the page starts filling up with CRUD oriented controls.  Sometimes I divide out controls, but if they are affected by other controls the coordination logic is complex in it's own right.  Sometimes I divide out list or grid data retrieval, but sometimes that can have similar pitfalls.</p>

<p>Are there any techniques, or rules of thumb, or common areas that you refactor out of your presenters?</p>

<p>Any advice?</p>

<p>Thanks!</p>
","<refactoring><user-interface><code-smell><mvp>","2","936","2009-05-07 16:25:19"
"840567","Is it worth refactoring Swing code to conform to coding standards?","<p>Code generated for swing always fails when it comes to code quality.  Inevitably, there's one method that builds the entire interface, and there's anonymous event handling code that calls member methods.</p>

<p>Does anyone have some nuggets on transforming this monstrous code to well organized code.</p>

<p>Is it worth going without a GUI builder tool, for the sake of code quality.</p>

<p>Thanks</p>
","<java><swing><refactoring><code-quality>","4","342","2009-05-08 16:03:18"
"840689","How would you refactor this smelly code? (Logging, Copy and Paste, .Net 3.5)","<p>I've got code like this:</p>

<pre><code>Logger logger = new Logger();
System.Diagnostics.Stopwatch stopWatch = new System.Diagnostics.Stopwatch();
logger.LogInformation(""Calling SomeObject.SomeMethod at "" + DateTime.Now.ToString());
stopWatch.Start();
// This is the method I'm interested in.
SomeResponse response = someObject.SomeMethod(someParam);
stopWatch.Stop();
logger.LogInformation(""SomeObject.SomeMethod returned at "" + DateTime.Now.ToString());
logger.LogInformation(""SomeObject.SomeMethod took "" + stopWatch.ElapsedMilliseconds + "" milliseconds."");
</code></pre>

<p>I need to wrap similar code around a lot more objects and their methods to do some performance profiling.  I'm not allowed to use 3rd party plugins or software, etc.  </p>

<p>I'd really rather not write this same code around all of these method calls this all of this logging code.  How would you refactor this to eliminate some of my coding effort?</p>

<p>If I'm not being very clear, please ask questions in the comments and I will try to clarify.</p>

<p>Thanks for any help!!</p>
","<c#><.net><.net-3.5><refactoring>","9","485","2009-05-08 16:29:27"
"841134","lots of boolean flag inputs to a class","<p>I have a dialog that displays various things depending on state of the application, security for the current user etc.
I am currently passing in several boolean flags and then enabling and/or hiding UI components depending on these flags.Eg:</p>

<pre><code>new MyDialog(showOptionsTable, allowFooInput, allowBarInput, isSuperUser)
</code></pre>

<p>Initially this started out as a couple of flags and that was fine. But now with changing requirements, it has evolved into an input of five boolean flags.</p>

<p>What is the best practices way of handling behavior like this? Is this something that I should subclass depending on how the dialog should look?</p>
","<java><refactoring>","4","1221","2009-05-08 18:20:04"
"846136","Refactoring DAL Code to Support Stored Procedures (C#)","<pre><code>    private static readonly string dataProvider = ConfigurationManager.AppSettings.Get(""Provider"");
    private static readonly DbProviderFactory factory = DbProviderFactories.GetFactory(dataProvider);
    private static readonly string connectionString = ConfigurationManager.ConnectionStrings[dataProvider].ConnectionString;
    /// &lt;summary&gt;
    /// Executes Update statements in the database.
    /// &lt;/summary&gt;
    /// &lt;param name=""sql""&gt;Sql statement.&lt;/param&gt;
    /// &lt;returns&gt;Number of rows affected.&lt;/returns&gt;
    public static int Update(string sql)
    {
        using (DbConnection connection = factory.CreateConnection())
        {
            connection.ConnectionString = connectionString;

            using (DbCommand command = factory.CreateCommand())
            {
                command.Connection = connection;
                command.CommandText = sql;

                connection.Open();
                return command.ExecuteNonQuery();
            }
        }
    }
</code></pre>

<p>I need help in re-writing this so that it'll work with stored procedures. (Pass in sproc name and params)
Does anyone have any idea how i should go about doing this?
Edit: The area I'm having problems with is trying to figure out ways to fill in params.</p>

<p>Thanks</p>
","<c#><refactoring><data-access-layer>","0","1700","2009-05-10 21:24:31"
"849590","Where do I put dependency creation for a Presenter class in a Passive View architecture?","<p>I've just refactored out a new domain class from a presenter class but I can't figure out where to instantiate it.</p>

<p>This is part of a larger ongoing refactoring effort with a poorly maintained legacy project.</p>

<p>The Presenter is currently being created by the view's OnLoad event and the view is passed as a parameter in the constructor. All public methods in the presenter are parameterless and return void. They communicate with the view using public properties of the view.</p>

<p>The view, being essentially a humble form depends entirely on the presenter for everything.</p>

<p>This is the typical Passive View pattern and I'd like to continue to adhere to it. Which brings me to my dilemma. I need to create an instance of my new domain object for the presenter to use. </p>

<ul>
<li>If I pass it through the constructor then the view has to create it and gains an unnecessary dependency.</li>
<li>If I create it anywhere within the presenter, I can't replace it with a mock object in my unit tests.</li>
<li>If I make it a public property of the presenter then I introduce a creation order dependency on the presenter methods where it is used and I still haven't solved what external class gets responsibility for creating it.</li>
</ul>

<p>I am not currently using any dependency injection frameworks. While I'm interested it using one in the future the source code is still much to fragile to introduce a third party framework into the mix.</p>

<p>I'm open to any suggestions.</p>
","<c#><refactoring><dependency-injection><mvp>","3","271","2009-05-11 19:14:42"
"849675","Refactoring PostgreSQL SProcs","<p>with a moderate PostgreSQL installation we accumulated quite a few stored procedures/functions and types. </p>

<p>Now in the lowest level composite type (i.e. 3 types are built with it and a myriad functions reference any of those types) one element of the type is of <strong>wrong type</strong> (i.e. smallint instead of bigint), thus handling it is identical, only the range is different.</p>

<ol>
<li>How do I know all types depending on
a type (pg_catalog.pg_type seems
insufficient)?</li>
<li>How can I know all
functions depending on a type (as
arguments and locally scoped vars)?</li>
<li>Can I refactore a composite type
(maybe change smallint to bigint)
without dropping/rebuilding every
single function depending on it?</li>
<li>Is there any kind of
automation/tool/best practice for
such a refactoring?</li>
</ol>

<p>I know its 4 questions in one, but atm this is kind of frustrating and any help would be appreciated!
Many Thanks!</p>
","<postgresql><refactoring><user-defined-functions>","0","233","2009-05-11 19:32:32"
"849557","In C# how many lines before a class should be consider to be refactored?","<p>A good rule of thumb by is that I intelligently refactor any method over 50 lines.</p>

<p>The count does not include comments and white space but actual code.  The reason I also say intelligently is there are plenty of times where a class over 50 lines is acceptable and cannot or should not be changed.</p>

<p>I do not have a rule of thumb for classes.  Generally I don't check classes to see if they should be refactored.  </p>

<p>On my currently project I have just about complete a class that is almost 4000 lines long.  However no methods over 50, and most of the lines and methods are private and not acting on any data outside of the class.</p>

<p>What is the rule of thumb for refactoring classes?  </p>
","<c#><refactoring><class>","3","1159","2009-05-11 19:06:18"
"854013","Ant exec refactoring","<p>I've this code in my build.xml:</p>

<pre><code>    &lt;exec executable=""cmd"" osfamily=""winnt""&gt;
        &lt;arg value=""/c""/&gt;
        &lt;arg value=""xsltproc\bin\xsltproc.exe""/&gt;
        &lt;arg value=""--xinclude""/&gt;
        &lt;arg value=""-o""/&gt;
        &lt;arg value=""dist/html/main.html""/&gt;
        &lt;arg value=""xsl/html/docbook.xsl""/&gt;
        &lt;arg value=""xml/main.xml""/&gt;
    &lt;/exec&gt;
    &lt;exec executable=""xsltproc"" osfamily=""unix""&gt;
        &lt;arg value=""--xinclude""/&gt;
        &lt;arg value=""-o""/&gt;
        &lt;arg value=""dist/html/main.html""/&gt;
        &lt;arg value=""xsl/html/docbook.xsl""/&gt;
        &lt;arg value=""xml/main.xml""/&gt;
    &lt;/exec&gt;
</code></pre>

<p>the  sequence is the same... I'm wondering about how refactoring this small fragment in order to keep it DRY. </p>
","<ant><refactoring>","5","1256","2009-05-12 17:56:54"
"856115","Should one test internal implementation, or only test public behaviour?","<p>Given software where ...</p>

<ul>
<li>The system consists of a few subsystems</li>
<li>Each subsystem consists of a few components</li>
<li>Each component is implemented using many classes</li>
</ul>

<p>... I like to write automated tests of each subsystem or component.</p>

<p>I don't write a test for each internal class of a component (except inasmuch as each class contributes to the component's public functionality and is therefore testable/tested from outside via the component's public API).</p>

<p>When I refactor the implementation of a component (which I often do, as part of adding new functionality), I therefore don't need to alter any existing automated tests: because the tests only depend on the component's public API, and the public APIs are typically being expanded rather than altered.</p>

<p>I think this policy contrasts with a document like <a href=""http://www.agilealliance.org/system/article/file/995/file.pdf"" rel=""nofollow"">Refactoring Test Code</a>, which says things like ...</p>

<ul>
<li>""... unit testing ...""</li>
<li>""... a test class for every class in the system ...""</li>
<li>""... test code / production code ratio ... is ideally considered to approach a ratio of 1:1 ...""</li>
</ul>

<p>... all of which I suppose I disagree with (or at least don't practice).</p>

<p><strong>My question is, if you disagree with my policy, would you explain why? In what scenarios is this degree of testing insufficient?</strong></p>

<p>In summary:</p>

<ul>
<li>Public interfaces are tested (and retested), and rarely change (they're added to but rarely altered)</li>
<li>Internal APIs are hidden behind the public APIs, and can be changed without rewriting the test cases which test the public APIs</li>
</ul>

<p><hr /></p>

<p>Footnote: some of my 'test cases' are actually implemented as data. For example, test cases for the UI consist of data files which contain various user inputs and the corresponding expected system outputs. Testing the system means having test code which reads each data file, replays the input into the system, and asserts that it gets the corresponding expected output.</p>

<p>Although I rarely need to change test code (because public APIs are usually added to rather than changed), I do find that I sometimes (e.g. twice a week) need to change some existing data files. This can happens when I change the system output for the better (i.e. new functionality improves existing output), which might cause an existing test to 'fail' (because the test code only tries to assert that output hasn't changed). To handle these cases I do the following:</p>

<ul>
<li>Rerun the automated test suite which a special run-time flag, which tells it to not assert the output, but instead to capture the new output into a new directory</li>
<li>Use a visual diff tool to see which output data files (i.e. what test cases) have changed, and to verify that these changes are good and as expected given the new functionality</li>
<li>Update the existing tests by copying new output files from the new directory into the directory from which test cases are run (over-writing the old tests)</li>
</ul>

<p><hr /></p>

<p>Footnote: by ""component"", I mean something like ""one DLL"" or ""one assembly"" ... something that's big enough to be visible on an architecture or a deployment diagram of the system, often implemented using dozens or 100 classes, and with a public API that consists of only about 1 or a handful of interfaces ... something that may be assigned to one team of developers (where a different component is assigned to a different team), and which will therefore according to <a href=""http://en.wikipedia.org/wiki/Conway%27s%5FLaw"" rel=""nofollow"">Conway's Law</a> having a relatively stable public API.</p>

<p><hr /></p>

<p>Footnote: The article <em><a href=""http://www.rbsc.com/pages/myths.html"" rel=""nofollow"">Object-Oriented Testing: Myth and Reality</a></em> says,</p>

<blockquote>
  <p><strong>Myth: Black box testing is sufficient.</strong>
  If you do a careful job of test case
  design using the class interface or
  specification, you can be assured that
  the class has been fully exercised.
  White-box testing (looking at a
  method's implementation to design
  tests) violates the very concept of
  encapsulation. </p>
  
  <p><strong>Reality: OO structure matters, part
  II.</strong> Many studies have shown that
  black-box test suites thought to be
  excruciatingly thorough by developers
  only exercise from one-third to a half
  of the statements (let alone paths or
  states) in the implementation under
  test. There are three reasons for
  this. First, the inputs or states
  selected typically exercise normal
  paths, but don't force all possible
  paths/states. Second, black-box
  testing alone cannot reveal surprises.
  Suppose we've tested all of the
  specified behaviors of the system
  under test. To be confident there are
  no unspecified behaviors we need to
  know if any parts of the system have
  not been exercised by the black-box
  test suite. The only way this
  information can be obtained is by code
  instrumentation. Third, it is often
  difficult to exercise exception and
  error-handling without examination of
  the source code.</p>
</blockquote>

<p>I should add that I'm doing whitebox functional testing: I see the code (in the implementation) and I write functional tests (which drive the public API) to exercise the various code branches (details of the feature's implementation).</p>
","<unit-testing><refactoring><automated-tests><integration-testing><code-coverage>","19","2220","2009-05-13 04:52:49"
"855936","Best practices for developing refactor friendly code","<p>Being a Java developer in an agile development cycle, I have learnt that it is essential to make sure I design my classes in a manner that I can refactor them easily without much of a pain. I want to know, what are the best practices that you follow in your daily design/development cycle that helps you to perform refactoring easily.<br>
For example, I know that I should hide the implementation details behind an interface. So that event if I am changing the implementation tomorrow, I am not disturbing the client code which consumes this APIs. Similarly I should use “factory design pattern” wherever possible so that the change of implementation classes can be controlled from one factory class rather than find out all the places and change them.<br>
Similarly I would like to know what all best practices that you are following which will help me.</p>
","<design-patterns><refactoring><resources>","4","378","2009-05-13 03:33:41"
"857204","How do I get Delphi 2009s (Refactor) Extract Interface to work?","<p>I am trying to use Delphi 2009's refactoring to extract an interface from a class. The class looks something like this:</p>

<pre><code>Type
  TMyClass = class(TObject)
  private
    FPrivateVar: Integer;
  public
    procedure MyPublicProc(Value: String); 
    function MyPublicFunc(Value: String): String;
  end;
</code></pre>

<p>If I place the cursor in the public section, right click and select Refactoring|Extract interface, there is a slight pause then... nothing. What am I doing something wrong?</p>
","<delphi><ide><refactoring><delphi-2009>","0","321","2009-05-13 10:31:44"
"857213","Replacing all usages of a method (Introduce Indirection)","<p>I am generally not very fond of refactoring tools. No need to get into details. Still, I occasionally try out new versions. Here is what I was trying to do while evaluating resharper 4.5 :</p>

<p>I needed to replace all usages of a method with a wrapper method (to be created) but I could not. I usually suck at noticing an obvious feature, is this the case? If resharper does not have this feature, do you know such tools?</p>

<p>Edit 2: Sample has been improved to include instance method calls.
Edit:
Here is a simple case to play.</p>

<pre><code>    static void Main(string[] args)
    {
        while(true)
        {
            if (Console.ReadKey().Key == ConsoleKey.Escape)
            {
                Thread.Sleep(10);
                if (Quiting()) break;
            }
            Console.Beep(250, 50);
        }
    }

    static bool Quiting()
    {
        if (Console.In.Peek() &gt; 0)
        {
            Console.Beep(250, 150);
            return false;
        }
        return true;
    }
</code></pre>

<p>What I need is something like: (Edit2: added an instance sample)</p>

<pre><code>    private static StringBuilder _builder = new StringBuilder();

    static void Main(string[] args)
    {
        while(true)
        {
            var key = Console.ReadKey();
            if (key.Key == ConsoleKey.Escape)
            {
                Thread.Sleep(10);
                if (Quiting()) break;
            }
            _builder.Append("" ("").Append(key.KeyChar).Append("") "");
            Beep(250, 50);
        }
    }

    static bool Quiting()
    {
        if (Console.In.Peek() &gt; 0)
        {
            Beep(250, 150);
            _builder.Append('@');
            return false;
        }
        return true;
    }

    static void Beep(int frequency, int duration)
    {
        // finally cursor ends up here
        Console.Beep(250, 50);
    }
</code></pre>

<p>Console.Beep calls are refactored. Next lets refactor StringBuilder.Append(char) :</p>

<pre><code>class Program
{
    private static StringBuilder _builder = new StringBuilder();

    static void Main(string[] args)
    {
        while(true)
        {
            var key = Console.ReadKey();
            if (key.Key == ConsoleKey.Escape)
            {
                Thread.Sleep(10);
                if (Quiting()) break;
            }
            _builder.Append("" ("").AppendUpper(key.KeyChar).Append("") "");
            Beep(250, 50);
        }
    }

    static bool Quiting()
    {
        if (Console.In.Peek() &gt; 0)
        {
            Beep(250, 150);
            _builder.AppendUpper('n');
            return false;
        }
        return true;
    }

    static void Beep(int frequency, int duration)
    {
        // finally cursor ends up here
        Console.Beep(250, 50);
    }
}

static class StringBuilderExtensions
{
    public static StringBuilder AppendUpper(this StringBuilder builder, char c)
    {
        return builder.Append(char.ToUpper(c));
    }
}
</code></pre>

<p>Selecting from usages and maybe omitting common parameters (such as 250 above) or common instance parameters for non-extension statics shall make this feature more valuable. Hopefully, this clears up the question.</p>
","<c#><refactoring><resharper>","1","522","2009-05-13 10:35:15"
"860690","What refactoring tools do you use for .NET?","<p>Do you use any of the refactoring tools like DevExpress' Refactor Pro? Which tool do you use and why?</p>

<p>I'm looking for recommendations. Ideally I'd like open source tool that works with VB and C# inside VS2005 and VS2008. If I had to narrow down my list of ideals, I would purchase something for VS2008. Not sure on the language choice, probably VB for now.</p>
","<.net><visual-studio><refactoring>","10","2729","2009-05-13 22:13:39"
"862142","What do you do with redundant code?","<p>I have a class, which is part of a code library project that was written for a particular purpose that is no longer required. So the question is what do you do with code like this? Do you simply delete it, or do you leave it in bearing in mind that future developers may come across it and not realise that they can disregard it or do you have some sort of archive system, is there a recognised ""pattern"" that is in use...</p>
","<refactoring>","6","516","2009-05-14 08:14:59"
"863169","How to refactor multiple similar Linq queries?","<p>Suppose I have the two following Linq queries I want to refactor:</p>

<pre><code>var someValue1 = 0;
var someValue2= 0;
var query1 = db.TableAs.Where( a =&gt; a.TableBs.Count() &gt; someValue1 )
                  .Take( 10 );
var query2 = db.TableAs.Where( a =&gt; a.TableBs.First().item1 == someValue2)
                  .Take( 10 );
</code></pre>

<p>Note that only the Where parameter changes. There is any way to put the query inside a method and pass the Where parameter as an argument?</p>
","<c#><.net><linq><linq-to-sql><refactoring>","3","336","2009-05-14 12:55:28"
"865258","How and How often do you refactor your code?","<p>My question vaguely relates to <a href=""http://stackoverflow.com/questions/140677/how-often-should-you-refactor"">this one</a>. However,  it doesn't address the techniques or practices.</p>

<p>I am reading <em>The Pragmatic Programmer</em> and it strongly advocates refactoring code as often as you can. However, it doesn't go into detail about how to do that and how often. How do you guys go about refactoring your code, and how often do you refactor?</p>
","<programming-languages><refactoring><coding-style>","7","504","2009-05-14 19:37:56"
"865313","php code smell detector","<p>Regarding the php code smell detector at <a href=""http://c2.com/cgi/wiki?DetectingCodeSmellsInPhp"" rel=""nofollow"">http://c2.com/cgi/wiki?DetectingCodeSmellsInPhp</a></p>

<p>When I open it in my web browser, I get an error, but when I open it in my IDE, I don't. </p>

<p>How to correct it?</p>
","<php><refactoring><automated-refactoring>","2","655","2009-05-14 19:46:41"
"865350","How to refactor multiple similar Linq-To-Sql queries?","<p><strong>Read before downvoting or closing:</strong> This almost exact duplicate of a <a href=""http://stackoverflow.com/questions/863169/how-to-refactor-multiple-similar-linq-queries"">previous question of mine</a> exists with the solely purpose to rephrase the previous question to the Linq-To-Sql scope. All answers contained in the previous question are valid for the Linq scope, but are invalid in the Linq-To-SQL scope.</p>

<p>Suppose I have the two following Linq-To-SQL queries I want to refactor:</p>

<pre><code>var someValue1 = 0;
var someValue2= 0;
var query1 = db.TableAs.Where( a =&gt; a.TableBs.Count() &gt; someValue1 )
              .Take( 10 );
var query2 = db.TableAs.Where( a =&gt; a.TableBs.First().item1 == someValue2)
              .Take( 10 );
</code></pre>

<p>Note that only the Where parameter changes. There is any way to put the query inside a method and pass the Where parameter as an argument?</p>

<p>All the solutions posted in the <a href=""http://stackoverflow.com/questions/863169/how-to-refactor-multiple-similar-linq-queries"">previous question</a> have been tried and failed in runtime when I try to enumerate the result.</p>

<p>The exception thrown was: ""Unsupported overload used for query operator 'Where'""</p>
","<c#><.net><linq-to-sql><refactoring>","3","176","2009-05-14 19:51:05"
"868113","Collaborative RegEx Development","<p>I'm looking for Collaborative RegEx website or software, where one can submit several cases of ""match"" and ""shouldn't match"" then other might refactor the regex. Like refactormycode.com but with a RegEx twist. And this way it's possible to see which code performs faster and is actually correct based on the given match tests.</p>

<p>This can be really useful as a website where anyone can edit (like a wiki) or within a team.</p>

<p>I've been thinking about this and make a lot of sense to me. Is there any website / software like this? If not, well, Why not?</p>
","<regex><refactoring><collaboration>","10","374","2009-05-15 11:18:13"
"871238","What should I keep in mind in order to refactor huge code base?","<p>I'm going to refactor certain parts in a huge code base (18000+ Java classes). Goal is to be able to extract lower layers as independent libraries to be reused in other projects that currently use duplicate of this code base. Especially one part is of interest to be refactored into a framework independent of business logic. Ultimately I would like the code to have a clean architectural layering.</p>

<p>I've looked at the code with a tool called Structure 101 for java and found lots (!) of architectural layering issues where lower layers are referencing upper layers.</p>

<p>I don't want to simply start messing with the code but try to come up with a reasonable strategy to go about this problem. What things should I keep in mind?</p>

<p>I'm thinking about at least taking small steps. I'm also thinking about have unit tests in place, but that requires creating them, since there are none.</p>

<p>Any thoughts on this?</p>
","<java><architecture><refactoring><layer>","9","396","2009-05-15 23:15:20"
"870036","Is it good idea to use Factory method design pattern for managing different class versions in C#?","<p>The code bellow is the small starting point for a new way ( for me ) of writing and managing code. Before I loose several weeks and probably state at the end that yes it was stupid idea I thought it would be better to ""stress test it"" here first. </p>

<p>So here is the idea. Each time there are dependencies of the type when Client ( Envoker) classs uses  Server ( class providing some services - called Controller in the example bellow ) the Client would use a static method to a ""stub"" with name which will be generic enough so that this name would not have to change - for example CreateDynamicTextBox() or RunProcedureGetDataSet() and will pass a configuration object according to which the factory will provide the requested version of the Server class , so each time when there is a stable enough version of Server when new functionalities must be added to it ( or the logic of it should be changed ) and new Server class version will be written. The proposed benefit will be preservation of the flow via the generic method and the passing of the ""setting"" object. </p>

<p>Is this a bad idea ?! If yes why? Anything positive in this approach ?!</p>

<pre><code>using System;


namespace ControllerFactory
{
  class ClientEnvoker
  {
    static void Main ( string[] args )
    {

      Console.WriteLine ( "" START "" );
      ClientEnvoker objClientEnvoker = new ClientEnvoker ();

      ControllerFactory objControllerFactory = new ControllerFactory ();

      Console.WriteLine ( "" RUN METHOD 1 WITH CONTROLLER 1 WITH CONFIG 1 "" );
      objControllerFactory.GenericMethodName ( ControllerFactory.CFSetter.First );

      Console.WriteLine ( "" RUN METHOD 2 WITH CONTROLLER 2 WITH CONFIG 2 "" );
      objControllerFactory.GenericMethodName ( ControllerFactory.CFSetter.Second );

      Console.WriteLine ( "" RUN METHOD 3 WITH CONTROLLER 3 WITH CONFIG 3 "" );
      objControllerFactory.GenericMethodName ( ControllerFactory.CFSetter.Second );

      Console.WriteLine ( "" END HIT A KEY TO EXIT "" );
      Console.ReadLine ();

    } //eof method 

  } //eof class 


  class ControllerFactory
  {
    public enum CFSetter : int
    {
      First = 1,
      Second = 2 , 
      Third = 3
    }

    public void GenericMethodName ( CFSetter objCFSetter )
    {
      Controller c = this.FactoryMethod ( objCFSetter );
      c.ConcreteMethod ();
    } //eof method 

    public Controller FactoryMethod ( CFSetter objCFSetter )
    {
      Controller controllerReturn = null;
      switch (objCFSetter)
      {
        case CFSetter.First:
          controllerReturn = new Controller1 ();
          break;
        case CFSetter.Second:
          controllerReturn = new Controller2 ();
          break;
        case CFSetter.Third:
          controllerReturn = new Controller3 ();
          break;
        default:
          controllerReturn = new Controller1 ();
          break;
      }
      return controllerReturn;
    }

  } //eof class

  #region Controllers
  public abstract class Controller
  {
    public abstract void ConcreteMethod ();
  }


  public class Controller1 : Controller
  {

    public override void ConcreteMethod ()
    {
      Console.WriteLine ( ""Controller1 screams according to version 1 logic"" );
    }
  } //eof class 

  public class Controller2 : Controller
  {

    public override void ConcreteMethod ()
    {
      Console.WriteLine ( ""Controller2 screams according to version 2 logic"" );
    }
  } //eof class 


  public class Controller3 : Controller
  {

    public override void ConcreteMethod ()
    {
      Console.WriteLine ( ""Controller3 screams according to version 3 logic"" );
    }
  } //eof class 

  #endregion Controllers



} //eof namespace
</code></pre>
","<c#><design-patterns><refactoring>","0","273","2009-05-15 17:50:44"
"878361","Refactoring large old ASP.Net solution","<p>i am in middle of refactoring old asp.net code (some of it is from frontpage era) and am wanting to move all the references to the ""$Resources:resources, ”  from aspx pages to Page_Render in code behind file of each page.</p>

<p>Main purpose of this excersie is to support localization, as we have grown to other internaltional regions. There are about 70 odd aspx pages and each page contains 5 to 10) labels, literals etc with most of them don't have ID tag. :) </p>

<p>How should i go about doing this massive task productively and if there are any tools/tips ppl have for me. I have already spent 5 days on it and it is not even half done :(</p>

<p>K</p>
","<refactoring><asp.net-2.0>","0","113","2009-05-18 15:40:08"
"880410","Static/strong typing and refactoring","<p>It seems to me that the most invaluable thing about a static/strongly-typed programming language is that it helps refactoring: if/when you change any API, then the compiler will tell you what that change has broken.</p>

<p>I can imagine writing code in a runtime/weakly-typed language ... but I can't imagine refactoring without the compiler's help, and I can't imagine writing tens of thousands of lines of code without refactoring.</p>

<p>Is this true?</p>
","<refactoring><strong-typing><static-typing><weak-typing>","4","449","2009-05-19 00:17:44"
"878461","More fine grained sorting of methods using Eclipse Ganymede: Is there a good plugin available?","<p>These are the options we have out of the box:</p>

<p><img src=""http://i39.tinypic.com/2ptnqxl.png"" alt=""alt text"" /></p>

<p>I would like a more fine grained sorting when it comes to methods. I would like to:</p>

<ol>
<li>Have all methods with a name which does not start with <strong>get</strong>, <strong>is</strong> or <strong>set</strong> first.</li>
<li>Then have the accessor methods (with names starting with get, is or set).</li>
</ol>

<p>Individually the methods in <code>[1]</code> and <code>[2]</code> above could be sorted in alphabetical order. Apart from my devision of normal methods into two parts I like the existing sort order. </p>

<p>I find this order (with the accessor methods last) better as I'm more likely to find the non-accessor methods interesting when I'm maintaining a class and I need to fix a bug etc.</p>

<p>Is there a plugin I could use? If there is none, would it be hard to create this kind of plugin myself? (I have never created a Eclipse plugin.)</p>
","<eclipse><refactoring><eclipse-plugin>","1","245","2009-05-18 16:00:23"
"880101","Tips for merging large changes between branches","<p>To learn Doxygen, I created a branch and modified the 
source file comments of a slow-moving project. However, 
that project has since had large changes, splitting a 
large file into several smaller files:</p>

<pre><code>big_file.c -&gt; big_file.c file_a.[ch] file_b.[ch]
</code></pre>

<p>I want to do the same on my branch. Obviously, I can
duplicate my branch's large_file.c as file_a.[ch], etc. 
and merge by hand, deleting the irrelevant portions.
However, I was wondering if there were less error-prone 
ways to do this.</p>
","<git><version-control><refactoring>","2","183","2009-05-18 22:19:14"
"881340","How to modularize a (large) Java App?","<p>I have a rather large (several MLOC) application at hand that I'd like to split up into more maintainable separate parts. Currently the product is comprised of about 40 Eclipse projects, many of them having inter-dependencies. This alone makes a continuous build system unfeasible, because it would have to rebuild very much with each checkin. </p>

<p>Is there a ""best practice"" way of how to</p>

<ul>
<li>identify parts that can immediately be separated</li>
<li>document inter-dependencies visually</li>
<li>untangle the existing code</li>
<li>handle ""patches"" we need to apply to libraries (currently handled by putting them in the classpath before the actual library)</li>
</ul>

<p>If there are (free/open) tools to support this, I'd appreciate pointers.</p>

<p>Even though I do not have any experience with Maven it seems like it forces a very modular design. I wonder now whether this is something that can be retrofitted iteratively or if a project that was to use it would have to be layouted with modularity in mind right from the start.</p>

<p><strong>Edit 2009-07-10</strong></p>

<p>We are in the process of splitting out some core modules using <a href=""http://ant.apache.org/ivy"" rel=""nofollow"">Apache Ant/Ivy</a>. Really helpful and well designed tool, not imposing as much on you as maven does. </p>

<p>I wrote down some more general details and personal opinion about why we are doing that on my blog - too long to post here and maybe not interesting to everyone, so follow at your own discretion: <a href=""http://www.danielschneller.com/2009/07/modularizing-software-with-antivy-and.html"" rel=""nofollow"">www.danielschneller.com</a></p>
","<java><maven-2><refactoring><modularity>","12","1729","2009-05-19 07:03:26"
"882433","Avoiding duplicate code in input validation","<p>Suppose you have a subsystem that does some kind of work. It could be anything. Obviously, at the entry point(s) to this subsystem there will be certain restrictions on the input. Suppose this subsystem is primarily called by a GUI. The subsystem needs to check all the input it recieves to make sure it's valid. We wouldn't want to FireTheMissles() if there was invalid input. The UI is also interested in the validation though, because it needs to report what went wrong. Maybe the user forgot to specify a target or targetted the missles at the launchpad itself. Of course, you can just return a null value or throw an exception, but that doesn't tell the user SPECIFICALLY what went wrong (unless, of course, you write a separate exception class for each error, which I'm fine with if that's the best practice). </p>

<p>Of course, even with exceptions, you have a problem. The user might want to know if input is valid BEFORE clicking the ""Fire Missles!"" button. You could write a separate validation function (of course IsValid() doesn't really help much because it doesn't tell you what went wrong), but then you'll be calling it from the button click handler and again from the FireTheMissles() function (I really don't know how this changed from a vague subsystem to a missle-firing program). Certainly, this isn't the end of the world, but it seems silly to call the same validation function twice in a row without anything having changed, especially if this validation function requires, say, computing the hash of a 1gb file. </p>

<p>If the preconditions of the function are clear, the GUI can do its own input validation, but then we're just duplicating the input validation logic, and a change in one might not be reflected in the other. Sure, we may add a check to the GUI to make sure the missle target is not within an allied nation, but then if we forget to copy it to the FireTheMissles() routine, we'll accidentally blow up our allies when we switch to a console interface. </p>

<p>So, in short, how do you achieve the following:</p>

<ol>
<li>Input validation that tells you not just that something went wrong, but what specifically went wrong.</li>
<li>The ability to run this input validation without calling the function which relies on it.</li>
<li>No double validation.</li>
<li>No duplicate code.</li>
</ol>

<p>Also, and I just thought of this, but error messages should not be written in the FireTheMissles() method. The GUI is responsible for picking appropriate error messages, not the code the GUI is calling.</p>
","<refactoring><user-interface><input-validation>","3","381","2009-05-19 12:26:01"
"893844","move from form to user control","<p>I have a bunch of Forms that I embed in tabpages(<em>some are embedded two and three layers deep</em>) that I now suspect are giving me trouble.  I have been told that User Control's are the better approach.  </p>

<ul>
<li><p>Now I am wondering how I
canaccomplish this as quick as
possible.</p></li>
<li><p>Is it as simple as copy and paste?</p></li>
<li>Has anyone ever done something like
this?</li>
</ul>

<p>I have about 40 forms that I embedd that would need to be moved and not a lot of time to do it so any help is greatly appreciated.</p>

<h2>EDIT 1</h2>

<p>This is how I embed forms:</p>

<pre><code>        public static void ShowFormInContainerControl(Control ctl, Form frm)
    {
        frm.TopLevel = false;
        frm.FormBorderStyle = FormBorderStyle.None;
        frm.Dock = DockStyle.Fill;
        frm.Visible = true;
        ctl.Controls.Add(frm);
    }

        public static void DockControl(this Control control, UserControl userControl)
    {
        userControl.Dock = DockStyle.Fill;
        control.Controls.Clear();
        control.Controls.Add(userControl);
    }
</code></pre>
","<winforms><usercontrols><refactoring>","1","811","2009-05-21 16:36:32"
"893908","What should come first -- the design pattern or the code?","<p>I'm starting on a fresh new project--should I look at my spec and decide which design patterns to apply, or just come up with a general idea of organization and allow the patterns to emerge organically through refactoring?</p>

<p>In your experience, which technique will be most productive and have a greater chance of leading to clean elegant code?</p>

<p>I'm also wondering if there are design patterns out there that aren't defined by the GoF, but could be just as valuable?  If so, what are some useful resources for informing myself about these?</p>
","<design><design-patterns><architecture><refactoring>","11","363","2009-05-21 16:52:23"
"896669","Visual studio refactoring - move class to assembly","<p>I'm looking for the simplest (and most complete) mechanism to move a class from one to another assembly with reference (dependency) fixing capability.I know some manual ways to do that like :
 - use built-in move rename, then cutpaste, multiple save ... 
 - use resharper rename namespace, cutpaste , the same as above </p>

<p>but with the problem is the same with those : in a web environment (namely ASP.Net) almost all of the references (for user controls for example, let's suppose with assembly name in their path for a virtual path provider scenario) are coded a string references (not to mention the configuration files and other external reference sources) - unfortunately even resharper doesn't found all. Other problem is with the designer files - you know they're generated on at least save action accordingly to the specifications in control and sometimes they're somehow mixed with the rename action I mean here's the old there's the new assembly name etc.</p>

<p>Thanks in advance,
  Nicolai</p>
","<asp.net><visual-studio><class><refactoring><rename>","2","550","2009-05-22 07:01:37"
"900105","How do you prevent classes becoming 'dependency magnets' and God classes?","<p>In virtually every project I've ever worked on, there will be one or two classes with the following properties:</p>

<ul>
<li>Extremely large with many many members and methods.</li>
<li>Many other classes inheriting from this class.</li>
<li>Many other classes otherwise depending on this class.</li>
</ul>

<p>Bad design, you might say.  But in all cases, this wasn't the case at design time. The classes just grew organically over time and became the proverbial 'God class'.  This has been such an invariant of my experience with large software projects that I have to ask:</p>

<ul>
<li>Is it possible to foresee likely dependency magnets and design software in such a way that the chance of such classes manifesting themselves is less likely?  If so, specifically, how?</li>
<li>Or, does it simply require ruthless refactoring as time goes by?</li>
<li>Or, is there some technical solution or design pattern which can mitigate the problems caused by such classes?</li>
<li>Or, a combination of all three?</li>
</ul>

<p>Tips, experience and ideas welcomed!</p>
","<design><design-patterns><refactoring><software-engineering>","9","506","2009-05-22 21:39:29"
"901772","Rails: Keeping user spoofing checks DRY","<p>In a fit of unoriginality, I'm writing a blog application using Ruby on Rails. My <code>PostsController</code> contains some code that ensures that the logged in user can only edit or delete their own posts.</p>

<p>I tried factoring this code out into a private method with a single argument for the flash message to display, but when I did this and tested it by editing another author's post, I got an <code>ActionController::DoubleRenderError</code> - ""Can only render or redirect once per action"".</p>

<p>How can I keep these checks <a href=""http://en.wikipedia.org/wiki/Don%27t%5Frepeat%5Fyourself"" rel=""nofollow"">DRY</a>? The obvious approach is to use a before filter but the <code>destroy</code> method needs to display a different flash.</p>

<p>Here's the relevant controller code:</p>

<pre><code>before_filter :find_post_by_slug!, :only =&gt; [:edit, :show]

def edit

  # FIXME Refactor this into a separate method
  if @post.user != current_user
    flash[:notice] = ""You cannot edit another author’s posts.""
    redirect_to root_path and return
  end
  ...
end

def update 
  @post = Post.find(params[:id])

  # FIXME Refactor this into a separate method
  if @post.user != current_user
    flash[:notice] = ""You cannot edit another author’s posts.""
    redirect_to root_path and return
  end
  ...
end

def destroy
  @post = Post.find_by_slug(params[:slug])

  # FIXME Refactor this into a separate method
  if @post.user != current_user
    flash[:notice] = ""You cannot delete another author’s posts.""
    redirect_to root_path and return
  end
  ...
end

private
def find_post_by_slug!
  slug = params[:slug]
  @post = Post.find_by_slug(slug) if slug
  raise ActiveRecord::RecordNotFound if @post.nil?
end
</code></pre>
","<ruby-on-rails><ruby><refactoring>","1","498","2009-05-23 15:45:34"
"901788","Should I use a framework or write my own MVC?","<p>I have a project that is currently all over the place and i'm thinking of making it MVC.</p>

<p>The problem is that the system is currently being used and I can not change the interface (It's in frames :s) Also there are certain things that I will need to handle myself such as password generation, login and user levels.</p>

<p>I already have the model side down of the MVC so I am wondering is it worth using a framework like Zend Framework or CakePHP or just to code my own View and Controllers to work around this problem?</p>

<p>I am going to have to work this in slowly and I'm not sure if i will be able to do that if I use one of the ready made frameworks.</p>
","<php><mvc><zend-framework><cakephp><refactoring>","4","997","2009-05-23 15:56:49"
"910423","Which is faster? Comparison or assignment?","<p>I'm doing a bit of coding, where I have to write this sort of code:</p>

<pre><code>if( array[i]==false )
    array[i]=true;
</code></pre>

<p>I wonder if it should be re-written as</p>

<pre><code>array[i]=true;
</code></pre>

<p>This raises the question: are comparisions faster than assignments?</p>

<p>What about differences from language to language? (contrast between java &amp; cpp, eg.)</p>

<p><em>NOTE: I've heard that ""premature optimization is the root of all evil."" I don't think that applies here :)</em></p>
","<performance><optimization><refactoring>","5","648","2009-05-26 12:28:41"
"915073","Use ""convert to auto property"" on multiple properties at once","<p>I find myself using Resharper's ""convert to auto property"" refactoring a lot to remove pre C# 3.0 boilerplate code.  </p>

<p>Is there a way I can apply this to <strong>all properties in a single class</strong> at once?</p>
","<visual-studio-2008><c#-3.0><refactoring><resharper>","4","512","2009-05-27 10:42:19"
"917828","Bulk Refactoring C#","<p>I want to be able to refactor 500 projects at the same time.</p>

<p>I have about 20 solutions and I don't have a master solution with everything because I haven't <a href=""http://stackoverflow.com/questions/414309/generate-solution-file-from-list-of-csproj"">figured out a way to auto generate it</a>.  </p>

<p>Any suggestions?</p>

<p>Thanks</p>

<p><strong>Edit</strong></p>

<p>I've tried slnTools from codeplex to generate a solution and visual studio pretty much took down the entire operating system.  Not sure if it was the solution not being generated properly or if it was just a limitation of Windows / Visual Studio.</p>
","<c#><visual-studio><refactoring>","3","262","2009-05-27 20:19:57"
"922561","Flatten conditional as a refactoring","<p>Consider:</p>

<pre><code>if (something) {
    // Code...
}
</code></pre>

<p>With CodeRush installed it recommended doing:</p>

<pre><code>if (!something) {
    return;
}
// Code...
</code></pre>

<p>Could someone explain how this is better? Surely there is no benefit what so ever.</p>
","<refactoring><coderush>","1","302","2009-05-28 18:51:02"
"930823","Order of Methods within any Class","<p>I'm still very new to programming and I want to write the cleanest code possible.</p>

<p>This may sound like a silly question, but what order should I put my methods in? Functionally of course it doesn't matter, but layout it makes a huge difference. So say we have the following code in one class:</p>

<pre><code>-(void)testCreateProjectWithStartDate {
    [self setUpTestCreateProjectWithStartDate];
    ...
}

-(void)setUpTestCreateProjectWithStartDate {
    testMOC = [self setUpInMemoryStore];
    [self mockOutXMLStoreForInMemoryStore];
}

- (NSManagedObjectContext *)setUpInMemoryStore {
    ...
    NSPersistentStoreCoordinator *coordMock = [self pscMock];
    ...
}

- (NSPersistentStoreCoordinator *)pscMock {
    ...
}

-(void)mockOutXMLStoreForInMemoryStore {
    ...
}
</code></pre>

<p>Do I have the methods ordered in the order that they are called? What if a method is called from two places within a class? </p>

<p>This code snippet looks a complete mess to me - it's very confusing to have to skip about as much as this just to figure out what is a very simple flow.</p>

<p>What order of methods would make more sense?</p>
","<refactoring><conventions>","1","509","2009-05-30 23:04:36"
"941720","Creating and executing a Merge Replication programatically","<p>Let me preface this by saying I now realize how stupid I am and was.  I have been developing  for 1 year (to the day) and this was the first thing I wrote.  I now have come back to it and I can't make heads or tails of it.  It worked at one point on a very simple app but that was a while ago.</p>

<p>Specifically I am having problems with <code>LocalDBConn</code> which uses <code>out</code> but for the life of me I can't remember why.</p>

<p>Guidance, pointer's, refactoring, slaps up side the head are ALL welcome and appreciated!</p>

<pre><code>public class MergeRepl
{
            // Declare nessesary variables
    private string subscriberName;
    private string publisherName;
    private string publicationName;
    private string subscriptionDbName;
    private string publicationDbName;
    private MergePullSubscription mergeSubscription;
    private MergePublication mergePublication;
    private ServerConnection subscriberConn;
    private ServerConnection publisherConn;
    private Server theLocalSQLServer;
    private ReplicationDatabase localRepDB;

    public MergeRepl(string subscriber, string publisher, string publication, string subscriptionDB, string publicationDB)
    {
        subscriberName = subscriber;
        publisherName = publisher;
        publicationName = publication;
        subscriptionDbName = subscriptionDB;
        publicationDbName = publicationDB;

        //Create connections to the Publisher and Subscriber.
        subscriberConn = new ServerConnection(subscriberName);
        publisherConn = new ServerConnection(publisherName);


        // Define the pull mergeSubscription
        mergeSubscription = new MergePullSubscription
                                {
                                    ConnectionContext = subscriberConn,
                                    DatabaseName = subscriptionDbName,
                                    PublisherName = publisherName,
                                    PublicationDBName = publicationDbName,
                                    PublicationName = publicationName
                                };

        // Ensure that the publication exists and that it supports pull subscriptions.
        mergePublication = new MergePublication
                               {
                                   Name = publicationName,
                                   DatabaseName = publicationDbName,
                                   ConnectionContext = publisherConn
                               };

        // Create the local SQL Server instance
        theLocalSQLServer = new Server(subscriberConn);
        // Create a Replication DB Object to initiate Replication settings on local DB
        localRepDB = new ReplicationDatabase(subscriptionDbName, subscriberConn);

        // Check that the database exists locally
        CreateDatabase(subscriptionDbName);
    }

    public void RunDataSync()
    {
        // Keep program from appearing 'Not Responding'
        ///// Application.DoEvents();

        // Does the needed Databases exist on local SQLExpress Install
        /////CreateDatabase(""ContactDB"");

        try
        {
                 //  Connect to the Subscriber
                 subscriberConn.Connect();

            // if the Subscription exists, then start the sync
                 if (mergeSubscription.LoadProperties())
                 {
                     // Check that we have enough metadata to start the agent
                     if (mergeSubscription.PublisherSecurity != null || mergeSubscription.DistributorSecurity != null)
                     {
                         //  Synchronously start the merge Agent for the mergeSubscription
                         //  lblStatus.Text = ""Data Sync Started - Please Be Patient!"";
                         mergeSubscription.SynchronizationAgent.Synchronize();
                     }
                     else
                     {
                         throw new ApplicationException(""There is insufficient metadata to synchronize the subscription."" +
                             ""Recreate the subscription with the agent job or supply the required agent properties at run time."");
                     }
                 }
                 else
                 {
                     // do something here if the pull mergeSubscription does not exist
                     // throw new ApplicationException(String.Format(""A mergeSubscription to '{0}' does not exist on {1}"", publicationName, subscriberName));
                     CreateMergeSubscription();
                 }
        }
        catch (Exception ex)
        {
            // Implement appropriaate error handling here
            throw new ApplicationException(""The subscription could not be synchronized.  Verify that the subscription has been defined correctly."", ex);
            //CreateMergeSubscription();
        }
        finally
        {
            subscriberConn.Disconnect();
        }
    }

    public void CreateMergeSubscription()
    {
        // Keep program from appearing 'Not Responding'
        // Application.DoEvents();

        try
        {

            if (mergePublication.LoadProperties())
            {
                if ((mergePublication.Attributes &amp; PublicationAttributes.AllowPull) == 0)
                {
                    mergePublication.Attributes |= PublicationAttributes.AllowPull;
                }

                // Make sure that the agent job for the mergeSubscription is created.
                mergeSubscription.CreateSyncAgentByDefault = true;

                // Create the pull mergeSubscription at the Subscriber.
                mergeSubscription.Create();

                Boolean registered = false;

                // Verify that the mergeSubscription is not already registered.
                foreach (MergeSubscription existing in mergePublication.EnumSubscriptions())
                {
                    if (existing.SubscriberName == subscriberName
                        &amp;&amp; existing.SubscriptionDBName == subscriptionDbName
                        &amp;&amp; existing.SubscriptionType == SubscriptionOption.Pull)
                    {
                        registered = true;
                    }
                }
                if (!registered)
                {
                    // Register the local mergeSubscription with the Publisher.
                    mergePublication.MakePullSubscriptionWellKnown(
                        subscriberName, subscriptionDbName,
                        SubscriptionSyncType.Automatic,
                        MergeSubscriberType.Local, 0);
                }
            }
            else
            {
                // Do something here if the publication does not exist.
                throw new ApplicationException(String.Format(
                    ""The publication '{0}' does not exist on {1}."",
                    publicationName, publisherName));
            }
        }
        catch (Exception ex)
        {
            // Implement the appropriate error handling here.
            throw new ApplicationException(String.Format(""The subscription to {0} could not be created."", publicationName), ex);

        }
        finally
        {
            publisherConn.Disconnect();
        }
    }

    /// &lt;summary&gt;
    /// This will make sure the needed DataBase exists locally before allowing any interaction with it.
    /// &lt;/summary&gt;
    /// &lt;param name=""whichDataBase""&gt;The name of the DataBase to check for.&lt;/param&gt;
    /// &lt;returns&gt;True if the specified DataBase exists, False if it doesn't.&lt;/returns&gt;
     public void CreateDatabase(string whichDataBase)
    {
        Database db;
        LocalDBConn(whichDataBase, out theLocalSQLServer, out localRepDB, out db);


        if (!theLocalSQLServer.Databases.Contains(whichDataBase))
        {
            //Application.DoEvents();
            // Create the database on the instance of SQL Server.
            db = new Database(theLocalSQLServer, whichDataBase);
            db.Create();

        }

        localRepDB.Load();
        localRepDB.EnabledMergePublishing = false;
        localRepDB.CommitPropertyChanges();

        if (!mergeSubscription.LoadProperties())
        {
            CreateMergeSubscription();
        }

    }

    private void LocalDBConn(string databaseName, out Server server, out ReplicationDatabase replicationDatabase, out Database db)
    {
        db = server.Databases[replicationDatabase.Name];
    }

    /// &lt;summary&gt;
    /// Checks for the existince of the Publication.  If there is one it verify's Allow Pull is set
    /// &lt;/summary&gt;
    /// &lt;returns&gt;True if Publication is present. False if not.&lt;/returns&gt;
    public bool CheckForPublication()
    {
        // If LoadProperties() returns TRUE then the Publication exists and is reachable
        if (mergePublication.LoadProperties())
            return true;

        if ((mergePublication.Attributes &amp; PublicationAttributes.AllowPull) == 0)
        {
            mergePublication.Attributes |= PublicationAttributes.AllowPull;
        }

        return false;
    } // end CheckForPublication()

    /// &lt;summary&gt;
    /// Checks for the existence of a Subscription.
    /// &lt;/summary&gt;
    /// &lt;returns&gt;True if a Subscription is present.  False if not&lt;/returns&gt;
    public bool CheckForSubscription()
    {
        // Check for the existence of the Subscription
        return mergeSubscription.IsExistingObject;
    } // end CheckForSubscription()
}
</code></pre>

<h2>Edit 1</h2>

<p>Opps, I forgot the specific errors.  On <code>server</code> and <code>replicationDatabase</code> I am getting a <em>""Out parameter might not be initialized before accessing""</em></p>

<pre><code>        private void LocalDBConn(string databaseName, out Server server, out ReplicationDatabase replicationDatabase, out Database db)
    {
        db = server.Databases[replicationDatabase.Name];
    }
</code></pre>
","<c#><.net><winforms><refactoring><replication>","2","1588","2009-06-02 20:26:08"
"943545","How to refactor this Ruby (controller) code?","<p>This is the code in my reports controller, it just looks so bad, can anyone give me some suggestions on how to tidy it up?</p>

<pre><code># app\controller\reports_controller.rb

 @report_lines  = []
   @sum_wp, @sum_projcted_wp, @sum_il, @sum_projcted_il, @sum_li,@sum_gross_profit ,@sum_opportunities = [0,0,0,0,0,0,0]    
 date = @start_date

 num_of_months.times do
    wp,projected_wp, invoice_line,projected_il,line_item, opp = Report.data_of_invoicing_and_delivery_report(@part_or_service,date)
    @sum_wp += wp
    @sum_projcted_wp +=projected_wp
    @sum_il=invoice_line
    @sum_projcted_il +=projected_il
    @sum_li += line_item
    gross_profit = invoice_line - line_item
    @sum_gross_profit += gross_profit
    @sum_opportunities += opp
    @report_lines &lt;&lt; [date.strftime(""%m/%Y""),wp,projected_wp ,invoice_line,projected_il,line_item,gross_profit,opp]
    date = date.next_month
 end
</code></pre>

<p>I'm looking to use some method like</p>

<pre><code>@sum_a,@sum_b,@sum_c += [1,2,3]
</code></pre>
","<ruby-on-rails><ruby><refactoring><refactor-my-code><automated-refactoring>","0","243","2009-06-03 07:49:33"
"942723","How to refactor a trigger that uses the inserted and deleted tables, to move common code to a stored procedure","<p>I have a trigger that will be dynamically created, as it will be attached to a view that is also dynamically generated.  I don't want my stored procedure to have the entire trigger within it, so I would like to move most of it to a stored procedure, but I won't know the fields in the inserted and deleted tables.</p>

<p>The trigger is about 90 lines long, and the only part I really need to be different between triggers is:</p>

<pre><code>DECLARE @DEBUG bit = 1
DECLARE @EntityName nvarchar(128) = 'Lot'
	SELECT * INTO #MYINSERTED FROM INSERTED
	SELECT * INTO #MYDELETED FROM DELETED
</code></pre>

<p>If I could move the rest of it to a stored procedure then that would be great.</p>

<p>The problem with just passing in the @DEBUG and @EntityName and using #MYINSERTED and #MYDELETED in the stored procedure then I would have a problem if two people are inserting or updating the same view at the same time.</p>

<p>The best bet would be to pass a table variable to remove any concurrency issues but I am not certain the best way to do that.</p>

<p>Thank you.</p>
","<sql-server><sql-server-2008><stored-procedures><refactoring><triggers>","1","595","2009-06-03 01:40:28"
"944091","How to do massive search and replace in emacs?","<blockquote>
  <p><strong>Possible Duplicate:</strong><br />
  <a href=""http://stackoverflow.com/questions/270930/using-emacs-to-recursively-find-and-replace-in-text-files-not-already-open"">Using Emacs to recursively find and replace in text files not already open</a>  </p>
  
  <p>Duplicate: <a href=""http://stackoverflow.com/questions/270930/using-emacs-to-recursively-find-and-replace-in-text-files-not-already-open"">using-emacs-to-recursively-find-and-replace-in-text-files-not-already-open</a></p>
</blockquote>

<p>I need to to regexp search and replace on a list of files.
Is there an emacs command (command combo) for that?
Or maybe you have a better way to do c++ refactoring on linux?</p>
","<c++><emacs><refactoring>","1","451","2009-06-03 10:42:14"
"949312","How do I refactor Perl code that uses Template Toolkit with DBI to take advantage of FastCGI?","<h2>Background</h2>

<p>Below is a typical piece of Perl code (<em>sample.pl</em> for the sake of discussion) that grabs submitted form data using CGI, passes the form data to DBI which will then retrieve the required rows from MySQL and then hands the results over to Template Toolkit to render into a HTML document for display.</p>

<p>Code listing for <em>sample.pl</em> :</p>

<pre><code>#!/usr/bin/perl
use strict;
use CGI;
use DBI:
use Template;

#Grab submitted form data
my $cgi = CGI-&gt;new();
my $idFromSomewhere= $cgi-&gt;param('id');

my $driver   = ""mysql"";
my $server   = ""localhost:3306"";
my $database = ""test"";
my $url      = ""DBI:$driver:$database:$server"";
my $user     = ""apache"";
my $password = """";

#Connect to database
my $db_handle = DBI-&gt;connect( $url, $user, $password ) 
    or die $DBI::errstr;

#SQL query to execute
my $sql = ""SELECT * FROM tests WHERE id=?"";

#Prepare SQL query
my $statement = $db_handle-&gt;prepare($sql)
        or die ""Couldn't prepare query '$sql': $DBI::errstr\n"";

#Execute SQL Query
$statement-&gt;execute($idFromSomewhere)
    or die ""Couldn't execute query '$sql': $DBI::errstr\n"";

#Get query results as hash
my $results = $statement-&gt;fetchall_hashref('id');

$db_handle-&gt;disconnect();
my $tt = Template-&gt;new();

#HTML output template
my $input = 'template.html';
my $vars = {
    tests =&gt; $results,
};

#Process template and output as HTML
$tt-&gt;process($input, $vars)
    or die $tt-&gt;error();
</code></pre>

<p>For better performance and scalability, web hosts providing shared servers, such as Dreamhost, strongly recommend that all production Perl script support FastCGI. The FastCGI documentation is pretty clear on how to modify existing Perl code to support FastCGI. The simple code below is often given as an example: </p>

<pre><code>use FCGI;
while (FCGI::accept &gt;= 0)
{    
   #Run existing code.
}
</code></pre>

<p><strong><em>What's not so clear is where and what to put in the while loop.</em></strong></p>

<h2>Sub Questions</h2>

<p><strong>A.</strong>
Should the code in sample.pl be simply wrapped around the existing code like so:</p>

<pre><code>while (FCGI::accept &gt;= 0)
{    
    #Grab submitted form data
    my $cgi = CGI-&gt;new();
    ...
    ...
    #Process template and output as HTML
    $tt-&gt;process($input, $vars)
    or die $tt-&gt;error();
}
</code></pre>

<p><strong>B.</strong>
Or is there more to it? For instance, should the code that handles the cgi, database and template be refactored into their own subs?</p>

<p><strong>C.</strong>
Should DBI->connect() and $db_handle->disconnect() be called inside or outside the FCGI while loop and what are the performance implications?</p>

<p><strong>D.</strong>
Should $tt->process() be called inside or outside the FCGI while loop?</p>
","<perl><refactoring><fastcgi><dbi>","6","1354","2009-06-04 08:42:19"
"949825","Is this possible with Visual Studio snippets?","<p>I use a modified form of TODO comment (SteveC_TODO) that allows me to group my own todos together in the task list.</p>

<p>Yesterday I thought it would be nice to modify the refactoring snippets to add a todo comment to the usual NotImplemented exception. I modified the Method Stub - Body snippet to this</p>

<pre><code>$signature$
{
  //SteveC_TODO: implement $end$$signature$
  throw new $Exception$();
}
</code></pre>

<p>but this results in the todo comment having the full method signature. It serves the purpose but I would prefer the comment to only use the name from the method signature and be of the form</p>

<pre><code>//SteveC_TODO: implement CoolMethod
</code></pre>

<p>rather than of the form</p>

<pre><code>//SteveC_TODO: implement private void CoolMethod(object o)
</code></pre>

<p>Does anyone know of a way that I can do this? I presume that the arguments passed to refactoring snippets are fixed but perhaps there is a way to parse the $signature$ argument to extract just the name. Anyone know if that might be possible?</p>
","<visual-studio><refactoring><code-snippets>","2","212","2009-06-04 10:49:23"
"955084","How to cast an interface to its sub interface?","<p>imagine you have the following interfaces:</p>

<pre><code>public interface IInterfaceA : IInterfaceX
{
    //
    // declarations
    //
}

public interface IInterfaceB : IInterfaceX
{
    //
    // declarations
    //
}

public interface IInterfaceC : IInterfaceX
{
    //
    // declarations
    //
}
</code></pre>

<p>Now I want to replace the following three methods which perform almost the same with a single function:</p>

<pre><code>class SomeClass
{
    IInterfaceA myVarA;
    IInterfaceB myVarB;
    IInterfaceC myVarC;

    void SomeMethodA(IInterfaceX someVarX)
    {
        myVarA = (IInterfaceA)someVarX;
    }

    void SomeMethodB(IInterfaceX someVarX)
    {
        myVarB = (IInterfaceB)someVarX;
    }

    void SomeMethodC(IInterfaceX someVarX)
    {
        myVarC = (IInterfaceC)someVarX;
    }
}
</code></pre>

<p>I thought about something like:</p>

<pre><code>void SomeMethod(IInterfaceX targetVar, IInterfaceX someVarX)
{
    //
    // here's my problem
    //
    targetVar = (CastIDontKnowHowToPerform)someVarX;
}
</code></pre>

<p>which is used sth. like</p>

<pre><code>SomeMethod(myVarA, someVarX);        
SomeMethod(myVarB, someVarX);        
SomeMethod(myVarC, someVarX);
</code></pre>

<p>So my questions are:</p>

<ul>
<li><p>Is it possible what I want to get?</p></li>
<li><p>How to perform this cast I don't know how to perform?</p></li>
<li><p>Perhaps a design pattern is more appropriate</p></li>
</ul>

<p>I'm just looking for the best way to refactor those three functions by replacing them by a single one.</p>

<p>Things I've tried so far:
I used things like object.GetType() and object.GetType().GetInterfaces() which works well to <strong>get</strong> the type of an object or its interface(s) but none to <strong>set</strong> the type of an object to its interface.</p>

<p>Hope you can help me...</p>

<p>Regards,</p>

<p>Inno</p>

<p><strong>[EDIT]</strong>
Ah, damn it... after clicking ""Ask your question"" and having a short look at it this seems to a be typical case for a generic function (or a template in C++-term).
<strong>[/EDIT]</strong></p>
","<c#><.net><refactoring>","0","209","2009-06-05 09:48:52"
"956827","Removing logic from partial views in ASP.NET MVC","<p>I am aware that views should not have code in them but in a project I am working on I have a lot of logic in the views. </p>

<p>My home page has </p>

<pre><code>&lt;% Html.RenderPartial(""SearchResults""); %&gt;
</code></pre>

<p>Now in the partial view I have an aweful lot of logic like this;</p>

<pre><code>&lt;div id=""RestaurantsList""&gt;
&lt;%if (Model.restaurantsList.Count() &gt; 0)
{
    foreach (var item in Model.restaurantsList)
    { %&gt;
        &lt;% Html.RenderPartial(""SearchResult"", item); %&gt;

    &lt;%
    } %&gt;
&lt;%
}
else
{
    Html.RenderPartial(""NoResults"");

} %&gt;
</code></pre>

<p></p>

<p>Now I could make the home controller return a different view based on the list being empty but I don't really want that as the Index view has a few things that I want displayed no matter if there are results or not.</p>

<p>The only other thing I can think of here is to encapsualte this in a helper method like Html.SearchResults. But then I would need the helper to call the renderPartial for each search result also. That doesn't seem like clean seperation of concerns.</p>

<p>I would still have to have the first if statement in the partial view though.</p>

<p>How would you best handle this?</p>
","<asp.net-mvc><refactoring><partial-views>","5","451","2009-06-05 16:25:50"
"961316","Refactoring repeated If statement blocks","<p>I have some code that I'm trying to rewrite. The code is designed to be ""generic"", in that it can be used by many different callers that require different ""work flows"". It goes something like this:</p>

<pre><code>string globalA;
int globalB;
bool globalC;
// Lots more globals in various shapes and forms

void TheOneAndOnlyMethod(XmlBasedConfig config) {

    // Set all of the globals based on XML configuration
    // ...

    if (globalA.Length &gt; 0)
        // Do something relating to functionality 'a'
    }

    if (globalB &gt; 0) {
        // Do something relating to functionality 'b'
    }

    if (globalC) {
        // You get the idea
    }
}
</code></pre>

<p>Some callers will have globalA and globalB set, therefore doing whatever is in the related if blocks. Other callers will have a myriad of other settings to do whatever they need to do. Callers are basically just an XML file with settings.</p>

<p>Maintaining/modifying this code is a <strong>big</strong> pain. I know there must be a cleaner, simpler, less <em>brain-exploding</em> way to do this!   </p>
","<refactoring><code-smell>","1","213","2009-06-07 06:15:03"
"962998","Sorting a string that could contain either a time or distance","<p>I have implemented a sorting algorithm for a custom string that represents either time or distance data for track &amp; field events.  Below is the format</p>

<p>'10:03.00 - Either ten minutes and three seconds or 10 feet, three inches</p>

<p>The result of the sort is that for field events, the longest throw or jump would be the first element while for running events, the fastest time would be first.  Below is the code I am currently using for field events.  I didn't post the <code>running_event_sort</code> since it is the same logic with the greater than/less than swapped.  While it works, it just seems overly complex and needs to be refactored.  I am open to suggestions.  Any help would be great. </p>

<pre><code>event_participants.sort!{ |a, b| Participant.field_event_sort(a, b) }

class Participant
def self.field_event_sort(a, b)
  a_parts = a.time_distance.scan(/'([\d]*):([\d]*).([\d]*)/)
  b_parts = b.time_distance.scan(/'([\d]*):([\d]*).([\d]*)/)

  if(a_parts.empty? || b_parts.empty?)
    0
  elsif a_parts[0][0] == b_parts[0][0]
    if a_parts[0][1] == b_parts[0][1]
      if a_parts[0][2] &gt; b_parts[0][2]
        -1
      elsif a_parts[0][2] &lt; b_parts[0][2]
        1
      else
        0
      end
    elsif a_parts[0][1] &gt; b_parts[0][1]
      -1
    else
      1
    end  
  elsif a_parts[0][0] &gt; b_parts[0][0] 
    -1
  else
    1
  end
end
end
</code></pre>
","<ruby><algorithm><sorting><refactoring>","4","287","2009-06-07 23:05:32"
"965926","How should I rewrite a very large compound if statement in C#?","<p>In my C# code, I have an if statement that started innocently enough:</p>

<pre><code>if((something == -1) &amp;&amp; (somethingelse == -1) &amp;&amp; (etc == -1)) {
    // ...
}
</code></pre>

<p>It's growing. I think there must be 20 clauses in it now.</p>

<p>How <em>should</em> I be handling this?</p>
","<c#><refactoring><structure><if-statement><guard-clause>","11","2864","2009-06-08 17:04:53"
"969024","How to avoid hardcoded field names in HQL, Hibernate?","<p>Suppose that I have the following HQL:</p>

<pre><code>String hql = ""select e.aField from MyEntity as e"";
</code></pre>

<p>If I want to refactor and change the name of the <code>MyEntity</code>'s member variable <code>aField</code> to something else, I also have to change all occurrences in the whole code in Strings. If I forget to change one hql string the code breaks.</p>

<p>How can I avoid this from happening?</p>
","<hibernate><query><refactoring><hql><hard-coding>","1","852","2009-06-09 09:16:31"
"971577","Refactoring or Rewriting Monolithic PHP Spaghetti Codebase","<p>I've inherited a really poorly designed PHP spaghetti code project.  It's been gaining a good bit of traffic recently and is starting to have performance issues on top of the poor monolithic code base.  Its maxing out performance on a chunky 16GB dedicated machine when it really shouldn't be.  </p>

<p>I'm planning on doing some performance tweaks right off the bat to help the performance issue, but this still won't really help the horrible code base.  The team is small but expecting to grow very soon.</p>

<p>I've read Joel's article on <a href=""http://www.joelonsoftware.com/articles/fog0000000069.html"" rel=""nofollow"">the troubles of doing a complete rewrite</a> and see the concerns.  But how bad does the code base have to be before you consider a rewrite? </p>

<p>There is PHP handling logic interjected into what one would usually consider a ""view"".  Even worse, in some places SQL statements are in these same files!  The only real separation of presentation and logic are a few PHP scripts that serve as function libraries.  These scripts do most of the ORM stuff... if you can even call it that.  Trying to slowly refractor this seems like a nightmare.</p>

<p>Open to your thoughts and opinions... however not interested in hearing, ""Run away, Run away!"".</p>
","<php><performance><architecture><rewrite><refactoring>","15","652","2009-06-09 17:56:59"
"971863","When do you refactor code?","<p>Do you do it when you’re in the code doing something else?</p>

<p>When your manager approves it? (Seems this never happens)</p>

<p>I guess some of this depends on the impact of the changes. If I change the code and it affects nothing outside of the class, to me that is low impact.</p>

<p>What does it become a design change? When it effect X object or X projects?</p>

<p>I’m just curious how others teams tackle this...</p>
","<refactoring>","11","523","2009-06-09 18:58:54"
"972818","What's a good way to refactor a growing number of javascript/jquery functions?","<p>I'm working on a project where we are doing a lot of custom javascript and especially jquery, on an mvc style project.</p>

<p>The only problem is that I keep adding more and more global functions/variables and they are piling up.  I've got a few files but I'm unsure how to split some of the stuff up into separate files. </p>

<p>I've thought about composing some of these function and global variables into objects, but the object syntax in javascript seems a little awkward to me (because of the absence of classic classes).  Though if I had a good example to follow maybe I could come around.</p>

<p>How do you deal with a project where the global javascript functions and variables start piling up like this?</p>
","<javascript><jquery><refactoring><object><global-variables>","3","266","2009-06-09 22:27:19"
"974171","What simplest avoidable ugly code issue?","<p>My first thoughts are too many lines of code in a method. In most cases it's easy to break something apart into multiple methods at least. </p>

<p>I have many more, but that seems to be one of the simplest to avoid. It really bugs me to see a method with 1000 lines of code, this also seems to be a common problem. Anything where you need to scroll up/down is IMO should be begging you break it apart.</p>

<p>But having a list issues could help a lot of new developers learn to identify problems and provide some good practices.</p>
","<refactoring>","1","296","2009-06-10 07:39:29"
"977474","Programming Language Properties that facilitate refactoring?","<p>What are common traits/properties of programming languages that facilitate (simplify) the development of widely automated source code analysis and re-engineering (transformation) tools?</p>

<p>I am mostly thinking in terms of programming language features that make it easier to develop static analysis and refactoring tools (i.e. compare Java vs. C++, the former of which has better support for refactoring).</p>

<p>In other words, a programming language that would be explicitly designed to provide support for automated static analysis and refactoring right from the beginning, what characteristics would it preferably feature?</p>

<p>For example, for <a href=""http://en.wikipedia.org/wiki/Ada_(programming_language)"" rel=""nofollow"">Ada</a>, there's the <a href=""http://en.wikipedia.org/wiki/Ada_Semantic_Interface_Specification"" rel=""nofollow"">ASIS</a>:</p>

<blockquote>
  <p>The Ada Semantic Interface Specification (ASIS) is a layered, open architecture providing vendor-independent access to the Ada Library Environment. It allows for the static analysis of Ada programs and libraries.
  ASIS, the Ada Semantic Interface Specification, is a library that gives applications access to the complete syntactic and semantic structure of an Ada compilation unit. This library is typically used by tools that need to perform some sort of static analysis on an Ada program.</p>
  
  <p><a href=""http://www.adaic.org/standards/asis.html"" rel=""nofollow"">ASIS information:</a> ASIS provides a standard way for tools to extract data that are best collected by an Ada compiler or other source code analyzer. Tools which use ASIS are themselves written in Ada, and can be very easily ported between Ada compilers which support ASIS. Using ASIS, developers can produce powerful code analysis tools with a high degree of portability. They can also save the considerable expense of implementing the algorithms that extract semantic information from the source program. For example, ASIS tools already exist that generate source-code metrics, check a program's conformance to coding styles or restrictions, make cross-references, and globally analyze programs for validation and verification. </p>
</blockquote>

<p>Also see, <a href=""http://www.sigada.org/WG/asiswg/ASIS_FAQ.html"" rel=""nofollow"">ASIS FAQ</a></p>

<p>Can you think of other programming languages that provide a similarly comprehensive and complete interface to working with source code specifically for analysis/transformation purposes?</p>

<p>I am thinking about specific implementation techniques to provide the low level hooks, for example core library functions that provide a way to inspect an AST or ASG at runtime.</p>
","<refactoring><language-features><language-design><automated-refactoring>","3","719","2009-06-10 18:48:07"
"976557","Refactored SQL projection?","<p>I don't like having the same thing defined in two places, if I can avoid it.</p>

<p>I realize the two queries below are dealing with two different tables, but those tables hold basically the same kind of data (distinct predicates warrant the two queries), and I think of the two projections below as ""the same thing defined in two places"".</p>

<p>When/if I modify these queries later, to include different columns, I'm sure I'll always want the projections to remain identical.</p>

<p>Given that, and without using dynamic SQL, and without '*' in any projection (not permitted in my production environment), can I define the ""columnset"" once and use it in both queries?</p>

<pre><code>SELECT columnA
	, columnB
	, columnC
FROM Data

SELECT columnA
	, columnB
	, columnC
FROM DataArchive
</code></pre>
","<sql><refactoring><refactoring-databases>","0","474","2009-06-10 16:02:24"
"980072","condense SQL in mySQL","<p>How can I simplify this code in MySQL?</p>

<pre><code>SELECT name,
  MAX(IF(to_days(thedate) - to_days('2009-06-13') = 0, price, '')) AS date1,
  MAX(IF(to_days(thedate) - to_days('2009-06-13') = 1, price, '')) AS date2,
  MAX(IF(to_days(thedate) - to_days('2009-06-13') = 2, price, '')) AS date3,
  MAX(IF(to_days(thedate) - to_days('2009-06-13') = 3, price, '')) AS date4,
  MAX(IF(to_days(thedate) - to_days('2009-06-13') = 4, price, '')) AS date5,
  MAX(IF(to_days(thedate) - to_days('2009-06-13') = 5, price, '')) AS date6,
  MAX(IF(to_days(thedate) - to_days('2009-06-13') = 6, price, '')) AS date7,
AVG(price),SUM(price)
FROM `personals`
WHERE personal_id = '1234'
GROUP BY name
</code></pre>

<p>So that the number of dates calculated are dynamic?</p>
","<sql><mysql><refactoring><complexity>","1","161","2009-06-11 09:00:45"
"981308","Splitting up a class into sub-classes","<p>I've got a business logic layer class containing access methods for each table in a database. As there are quite a few tables now I'd like to restructure it to group the methods by entity (for easier access when coding). So, from this:</p>

<pre><code>BLL.Database MyDB = new BLL.Database();
BLL.Entity.User MyUser = Database.UserGetById(42);
</code></pre>

<p>to this:</p>

<pre><code>BLL.Database MyDB = new BLL.Database();
BLL.Entity.User MyUser = Database.User.GetById(42);
</code></pre>

<p>I'd like the class to remain non-static if possible, with all the classes 'partial' too (to allow me to add additional methods to the main generated class). What are my options for achieving this? Here's the current layout:</p>

<pre><code>namespace BLL
{
    public partial class Database
    {
    	// private members..
    	// constructor

    	#region User
    	public IQueryable&lt;BLL.Entity.User&gt; UserGetAll()
    	{
    		// ...
    	}

    	public BLL.Entity.User UserGetById(int UserId)
    	{
    		// ...
    	}

    	public void UserSave(ref BLL.Entity.User user)
    	{
    		// ...
    	}

    	public void UserDelete(int userId)
    	{
    		// ...
    	}
    	#endregion

    	// More sets of methods for other entities in database here..
    }
}
</code></pre>

<p>Is this feasible?</p>

<pre><code>namespace BLL
{
    public partial class Database
    {
    	private _User;
    	public User
    	{
    		if (_User == null)
    		{
    			_User = new User();
    		}
    		return _User;
    	}

    	// Other data access classes here..
    }

    public partial class User
    {
    	public IQueryable&lt;BLL.Entity.User&gt; GetAll()
    	{
    		// ...
    	}

    	// GetById, Save &amp; Delete methods here..
    }
}
</code></pre>

<p>Thanks.</p>
","<c#><design><class><refactoring>","0","169","2009-06-11 14:05:26"
"983748","Daunting task of refactoring 5000 line CSS. Any tips?","<p>I've just been assigned the task to refactor a huge 5000 line CSS file... but here's the worst part - I also need to make it IE6 compatible. Any CSS gurus have suggestions of tools, or possibly tips (common pitfalls) for use in my monolithic expedition? Cheers.</p>
","<css><refactoring>","4","500","2009-06-11 21:17:09"
"985026","Python shortcuts","<p>Python is filled with little neat shortcuts.</p>

<p>For example:</p>

<pre><code>self.data = map(lambda x: list(x), data)
</code></pre>

<p>and (although not so pretty)</p>

<pre><code>tuple(t[0] for t in self.result if t[0] != 'mysql' and t[0] != 'information_schema')
</code></pre>

<p>among countless others.</p>

<p>In the irc channel, they said ""too many to know them all"". </p>

<p>I think we should list some here, as i love using these shortcuts to shorten &amp; refctor my code. I'm sure this would benefit many.</p>
","<python><shortcut><refactoring>","3","2685","2009-06-12 04:39:21"
"987950","Class library modification / migration","<p>I have 3 class libraries. A BBL, a DAL, and a DATA (about 15 datasets). Currently 4 [major] applications utilize the functionality in these DLL's. I'm rewriting one of those applications and I need to (1) Use some of the existing functionality in the libraries (2) Change some of it (3) Add new functionality (4) Add new datasets.</p>

<p>I'm back and forth about the best way to do this, while keeping my risks at a minimum. Some thoughts..</p>

<p>1) Use the existing projects and don't make any modifications, only additions
2) Make new libraries, bring over the code I can use, and make additions as needed
3) Implement partial classes in the existing projects</p>

<p>Eventually all 4 applications will use the newest functionality, but it will be a slow migration; so the old code can't be depricated yet.</p>

<p>Any thoughts?</p>
","<.net><class><dll><refactoring><class-library>","0","40","2009-06-12 17:28:43"
"988396","Strongly typed calls into web.config without duplicating the property names?","<p>I searched here for the answer.  I'm sorry if this has been asked before (as I suspect it has).</p>

<p><strong>Summary:</strong> How can I have strongly typed calls into my web.config without duplicating the property names?</p>

<p><hr /></p>

<p><strong>Details:</strong> In my code, I try to minimize string usage, and I don't like defining something twice.</p>

<p>Complementing both of these wonts is my restriction of AppSettings usage (and its strings) to one class, which I reference throughout the project.  The AppSettings class exposes public properties:</p>

<pre><code>    12   public static string DateFormatString {
    13       get {
    14           return ConfigurationManager.AppSettings[""DateFormatString""];
    15       }
    16   }
</code></pre>

<p>How can I keep this class and prevent the duplication (lines 12 &amp; 14) of the property name?</p>

<p>Alternatively, what other solution might you recommend?</p>
","<c#><asp.net><refactoring><string><strong-typing>","1","1014","2009-06-12 18:56:40"
"992381","Rename a class in Xcode: Refactor... is grayed out (disabled). Why?","<p>Why is <strong>Refactor...</strong> grayed out (disabled) in Xcode?</p>

<p>I'd like to rename a class.</p>
","<iphone><xcode><refactoring>","26","13653","2009-06-14 07:43:30"
"996534","ListBox.DisplayMember = [String] Can I somehow workaround it to be other than string in .NET?","<p>The question is asked with respect to an Object DataSource. So Consider that I have a class </p>

<pre><code>public class Customer{

    public String name;
    public int age;

    public Customer(String name, int age) {
         this.name = name;
         this.age = age;
    }
}
</code></pre>

<p>And I have databound a list box to a list of these objects. So I say </p>

<pre><code>listBox.DisplayMember = ""name"";
</code></pre>

<p>But my question is that when I refactor my Customer class's name to </p>

<pre><code>public String fullName;
</code></pre>

<p>the DisplayMember still stays at ""name"". This will fail. So it decreases my ability to refactor domain objects. Is there any way around for this?</p>
","<.net><data-binding><refactoring><strong-typing>","1","1067","2009-06-15 14:48:14"
"996201","Code reuse and refactoring","<p>What's best practice for reuse of code versus copy/paste?</p>

<p>The problem with reuse can be that changing the reused code will affect many other pieces of functionality.</p>

<p>This is good &amp; bad : good if the change is a bugfix or useful enhancement. Bad if other reusing code unexpectedly becomes broken because it relied on the old version (or the new version has a bug).</p>

<p>In some cases it would seem that copy/paste is better - each user of the pasted code has a private copy which it can customize without consequences.</p>

<p>Is there a best practice for this problem; does reuse require watertight unit tests?</p>
","<design><refactoring><code-reuse>","6","960","2009-06-15 13:45:46"
"1000929","Refactoring Really Seems to Have Vanished from my Xcode","<p>I've read the similar (ok, almost identical) thread here as well as on the Apple iPhone Dev forums. I've looked carefullly at the referenced links. I have tried everything but nothing I do has brought refactoring back to life in XCode. Sigh.</p>

<p>I took a working, 100% Cocoa Touch project (ie, Pragmatic Programmers - Coding in Objective-C 2.0 - Movie Player) and tried to select and refactor an ivar. Nothing. Nada.</p>

<p>This is very odd, since about a month ago it was working. In fact, on a project that mixed C++ with Obj-C.</p>

<p>Should I resort to reinstalling XCode? Seems a bit like overkill, no?</p>

<p>Anyway, very frustrating.</p>

<p>Any guidance would be most appreciated.</p>

<p>Cheers,</p>

<p>Doug</p>
","<xcode><refactoring>","0","214","2009-06-16 11:37:02"
"1000171","Java: De-deprecated-ing Tools","<p>Once a method is marked as deprecated, are there any tools which replace these methods with non-deprecated workarounds ?</p>
","<java><tools><refactoring><deprecated>","4","317","2009-06-16 08:26:13"
"1002845","Redunancy elimination in ASP.NET MVC Actions","<p>Is this action too redundant - is there a better way to simplify it?</p>

<pre><code>[Authorize, AcceptVerbs(HttpVerbs.Post)]
public ActionResult ChangePassword(string oldPassword, string newPassword, string confirmPassword)
{
    var oldPasswordValidationResults = _validatorProvider.Validate&lt;IStringLengthValidator&gt;(oldPassword);
    oldPasswordValidationResults.Where(r =&gt; !r.Passed)
                                .Each(r =&gt; ModelState.AddModelError(""OldPassword"", ""Please enter your old password.""));


    var newPasswordValidationResults = _validatorProvider.Validate&lt;IStringLengthValidator&gt;(newPassword);
    newPasswordValidationResults.Where(r =&gt; !r.Passed)
                                .Each(r =&gt; ModelState.AddModelError(""NewPassword"", ""Please enter a new password.""));

    if (!ModelState.IsValid)
        return View();

    if (newPassword != confirmPassword)
        ModelState.AddModelError(""ConfirmPassword"", ""The passwords do not match."");

    if (!ModelState.IsValid)
        return View();

    if (!_userMembershipService.ChangePassword(oldPassword, newPassword))
        ModelState.AddModelError(""_FORM"", ""Unable to change your password."");

    if (!ModelState.IsValid)
        return View();

    return View(""ChangePasswordSuccessful"");
}
</code></pre>

<p>All of these seem to me to have a code smell...</p>

<pre><code>if (!ModelState.IsValid)
    return View();
</code></pre>
","<c#><asp.net-mvc><refactoring>","0","190","2009-06-16 17:19:21"
"1004866","Do I need to test helper/setup methods?","<p>So I have a helper method that looks something like the following:</p>

<pre><code>private D GetInstanceOfD(string param1, int param2)
{
    A a = new A();
    B a = new B();
    C c = new C(a,b, param1);

    return new D(c, param2);
}
</code></pre>

<p>It's just a convenient helper method for which I can call to grab a particular object that I need rather then to remember which dependencies I need to hook up to get the object I require.</p>

<p>My first question here is: should methods like these be tested? The only reason I can think of to want to test these type of methods would be to make sure that the correct dependencies are used and are set up correctly.</p>

<p>If the answer to the first question is yes, my second is: how? I am currently using NUnit and RhinoMocks and am trying to work out how this method has to be refactored to be testable (well, and whether something like this should be tested!); dependency injection obviously would not work here as this method actually creates the dependencies!</p>

<p>Or is using this method bad practice and I should be doing something like the following:</p>

<pre><code>D d = new (new C(new A(), new B(), ""string""), 1024);
</code></pre>
","<unit-testing><refactoring>","3","122","2009-06-17 02:48:55"
"1004872","Would you have a factory for these methods. Static method on type or in factory?","<p>Sorry for the bad title I just didn't know how to word it right.</p>

<p>Say I have a class called Table and these three methods:</p>

<pre><code>//Creates a new table in underlying provider and returns new Table object.
CreateNew(string Name); 
//Opens the table in provider and returns new Table object.
OpenTable(string Path);
//Same action as above just on a collection, and returns a IList&lt;Table&gt;
OpenTables(IList&lt;string&gt; path);
</code></pre>

<p>At the current time I am using something like this, where all the methods are static on the type:</p>

<pre><code>Table tab = Table.OpenTable(""SomePath"");
Table tab = Table.CreateNew(""DummyTableName"");
</code></pre>

<p>You get the idea.</p>

<p>However I was wondering if these really should be in a factory.  Something like this:</p>

<pre><code> TableFactory factory = new TableFactory();
 Table tab = factory.CreateNew(""DummyTableName"");
 Table tab = factory.OpenTable(""SomePath"");
</code></pre>

<p>The factory wouldn't be static as that would make other code that uses a factory hard to test</p>

<p>What do you think?</p>
","<c#><refactoring>","0","124","2009-06-17 02:52:31"
"1016255","How much information hiding is necessary when doing code refactoring?","<p>How much information hiding is necessary?  I have boilerplate code before I delete a record, it looks like this:</p>

<pre><code>    public override void OrderProcessing_Delete(Dictionary&lt;string, object&gt; pkColumns)
    {
        var c = Connect();


        using (var cmd = new NpgsqlCommand(""SELECT COUNT(*) FROM orders WHERE order_id = :_order_id"", c)
            { Parameters = { {""_order_id"", pkColumns[""order_id""]} } } )
        {
            var count = (long)cmd.ExecuteScalar();

            // deletion's boilerplate code...
            if (count == 0) throw new RecordNotFoundException();
            else if (count &gt; 1) throw new DatabaseStructureChangedException();
            // ...boiler plate code
        }



        // deleting of table(s) goes here...
    }
</code></pre>

<p>NOTE: boilerplate code is code-generated, including the ""using (var cmd = new NpgsqlCommand( ... )""</p>

<p>But I'm seriously thinking to refactor the boiler plate code, I wanted a more succint code.  This is how I envision to refactor the code (made nicer with extension method (not the sole reason ;))</p>

<pre><code>    using (var cmd = new NpgsqlCommand(""SELECT COUNT(*) FROM orders WHERE order_id = :_order_id"", c)
        { Parameters = { {""_order_id"", pkColumns[""order_id""]} } } )
    {
              cmd.VerifyDeletion(); // [EDIT: was ExecuteWithVerification before]
    }
</code></pre>

<p>I wanted the executescalar and the boilerplate code to goes inside the extension method.</p>

<p>For my code above, does it warrants code refactoring / information hiding? Is my refactored operation looks too opaque?</p>
","<refactoring><information-hiding>","1","185","2009-06-19 03:42:21"
"1018975","How can I make this LINQ query cleaner?","<p>I have recently written a LINQ query to get a <code>Dictionary</code> containing the last 6 month's placement amounts.</p>

<p>It is returning a <code>Dictionary</code> of Month string - Decimal Amount pairs.</p>

<p>It seems kind of cludgey.  Any of you LINQ masters out there able to help me refactor this to make a bit cleaner?</p>

<pre><code>/// &lt;summary&gt;
/// Gets the last 6 months of Placement History totalled by Month 
/// for all Agencies
/// &lt;/summary&gt;
/// &lt;returns&gt;&lt;/returns&gt;
public Dictionary&lt;string, decimal&gt; getRecentPlacementHistory()
{
    var placementHistoryByMonth = new Dictionary&lt;string, decimal&gt;();

    using (DemoLinqDataContext db = new DemoLinqDataContext())
    {
        for (int i = 0; i &lt; 6; i++)
        {
            Decimal monthTotal = 
              (from a in db.Accounts
               where 
                 (a.Date_Assigned.Value.Month == DateTime.Now.AddMonths(-i).Month &amp;&amp;
                  a.Date_Assigned.Value.Year == DateTime.Now.AddMonths(-i).Month)
               select a.Amount_Assigned).Sum();
            String currentMonth = DateTime.Now.AddMonths(-i).ToString(""MMM"");

            placementHistoryByMonth.Add(currentMonth, monthTotal);
        }
        return placementHistoryByMonth;
    }
}
</code></pre>
","<c#><linq><linq-to-sql><refactoring>","1","498","2009-06-19 16:54:17"
"1020664","How to refactor usage of an iterator","<p>I have some code i'd like to refactor that uses a C# iterator (ie IEnumerable).  Unfortunately, I can't see to quite figure out the best way to allow other functions to work with the iterator without causing it to restart the iterator.</p>

<p>For example:</p>

<pre><code>NewLineEnumerator nle = new NewLineEnumerator();

while (bytesRead &gt; 0)
{
  var nlenum = nle.Process(inputData, bytesRead);
  foreach (string block in nlenum)
  {
    DoSomething(nlenum);
  }
}

void DoSomething(IEnumerable&lt;string&gt; myiter)
{
  foreach (var s in myiter)
  {
     // myiter is restarted, and begins at the start of the iterator again
  }
}
</code></pre>

<p>You might be asking why i would want to do this.  The reason is that I have a stream of data, surrounded by ""command blocks"".  Depending on the command, I send it to a different subfunction to process.  So I want to keep iterating where i left off in the stream either at the start, or at the end.</p>

<p>Any suggestions here?</p>
","<c#><refactoring><iterator>","0","139","2009-06-20 00:57:37"
"1024074","Can a test class become a ""God object""?","<p>I'm working on a backend for an open source Python ORM.  The library includes a set of 450 test cases for each backend, all lumped into one giant test class.</p>

<p>To me, that sounds like a lot for one class, but I've never worked on a project that <em>has</em> 450 test cases (I believe this library has ~2000 test cases not including the test cases for each backend).  Am I correct in feeling this is a bit on the high end (given that there's not really any magic number above which you should break something up), or is it just not as big a deal for a test class to have so many tests?</p>

<p>And even if that's not too many test cases, how would one go about refactoring an overly large test class?  Most of my knowledge about refactoring is around making sure that tests are in place for the code that's being refactored.  I've never had to deal with a situation where it's the tests themselves that need to be refactored.</p>

<p><strong>EDIT</strong>:  Previously, I had said that these were unit tests, which isn't quite true.  These are more appropriately termed integration tests.</p>
","<language-agnostic><testing><refactoring><tdd><orm>","5","264","2009-06-21 14:48:17"
"1025116","Using bash command line, how to add ""import package.name.*;"" to many java files?","<p>I'm thinking of using find or grep to collect the files, and maybe sed to make the change, but what to do with the output? Or would it be better to use ""argdo"" in vim?</p>

<p>Note: this question is asking for command line solutions, not IDE's.  Answers and comments suggesting IDE's will be calmly, politely and serenely flagged. :-)</p>
","<bash><vim><command-line><refactoring><sed>","2","723","2009-06-22 00:22:02"
"1025844","What is refactoring and what is only modifying code?","<p>I know that refactoring is ""changing the structure of a program so that the functionality is not changed"". I was talking with some of the guys I'm working with on my final year project at university and I was surprised that they have a much more <em>expansive</em> (for want of a better word) view of refactoring. I consider refactoring to be things like extracting methods and renaming classes. They also suggested things like changing data structures (like a Java <code>LinkedList</code> to an <code>ArrayList</code>), changing algorithms (using merge sort instead of bubble sort), and even rewriting large chunks of code as refactoring. I was quite sure that they were wrong, but I wasn't able to give a good reason why because what they were suggesting did change the program (and presumably make it better) without changing its behaviour. Am I right, and more importantly, why?</p>
","<refactoring>","6","463","2009-06-22 07:15:57"
"1026623","In C# 3.5, How do you pass which method to call on an object as a parameter","<p>I have two methods in C# 3.5 that are identical bar one function call, 
 in the snippet below, see clientController.GetClientUsername vs clientController.GetClientGraphicalUsername </p>

<pre><code>    private static bool TryGetLogonUserIdByUsername(IGetClientUsername clientController, string sClientId, out int? logonUserId)
    {
        string username;
        if (clientController.GetClientUsername(sClientId, out username))
        {
		   // ... snip common code ...
        }

        return false;
    }

    private static bool TryGetLogonUserIdByGraphicalUsername(IGetClientUsername clientController, string sClientId, out int? logonUserId)
    {
        string username;
        if (clientController.GetClientGraphicalUsername(sClientId, out username))
        {
		   // ... snip common code ...
        }

        return false;
    }
</code></pre>

<p>Is there a way (delegates, lamda's ?) that I can pass in which method on clientController I want to call?</p>

<p>Thanks!</p>
","<c#><.net-3.5><delegates><refactoring>","5","840","2009-06-22 11:21:43"
"1027812","Rails Best Practices for Refactoring Dynamic Behavior","<p>I have developed contingent country-state select dropdowns, and I'd like to factor out this behavior to an Address model so that I don't have to copy the dynamic behavior (more or less split between view and controller) each and every time I want the user to be able to enter a full address.</p>

<p>Basically I'm trying to dip my toes a little deeper into DRY. But I'm not sure exactly where to embed the behaviors. Do I use the model or the helper to build the necessary forms? Most importantly: where and how can I invoke the dynamic behavior for updating lists of states? Do I need an Address controller, or could it all be done from within the model?</p>

<p>In other words, what I've got now in the view is something like:</p>

<pre><code>  # _refine.html.erb
      &lt;tr&gt;
        &lt;td&gt;
        &lt;%= label_tag :dest_country, 'Country: ' %&gt;&lt;/td&gt;&lt;td&gt;
          &lt;%= select_tag :dest_country, 
            options_for_select(Carmen::country_names 
                      &lt;&lt; 'Select a country', 
                :selected =&gt; 'Select a country'), 
            {:include_blank =&gt; true,
            :id =&gt; 'country_select',                              
            :style =&gt; 'width: 180px',
            :onchange =&gt; remote_function(
              :url =&gt; {:action =&gt; 'update_state_select'},
              :with =&gt; ""'country='+value"")} %&gt;
        &lt;/td&gt;      
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;div id=""state_select_div""&gt;
            &lt;td&gt;&lt;%= label_tag :dest_state, 'State: &amp;nbsp&amp;nbsp' %&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%= select_tag :dest_state, 
                        options_for_select(Carmen::states('US').collect{
                                |s| [s[0],s[0]]} &lt;&lt; ['Select a state'], 
                                :selected =&gt; 'Select a state'), 
                                {:style =&gt; 'width: 180px'} %&gt;&lt;/td&gt;
          &lt;/div&gt;      
      &lt;/tr&gt;
</code></pre>

<p>The update method is in the controller:</p>

<pre><code># search_controller.rb

def update_state_select
  # puts ""Attempting to update states""
  states = []
  q = Carmen::states(Carmen::country_code(params[:country]))
  states = q unless q.nil? 
  render :update do |page|
    page.replace_html(""state_select_div"",
    :partial =&gt; ""state_select"",
    :locals =&gt; {:states =&gt; states }
  )
 end
end
</code></pre>

<p>Finally, I've got a partial which is dropped in with the proper names or a blank text field:</p>

<pre><code># _state_select.html.erb
&lt;% unless states.empty? or states.nil? %&gt;
      &lt;%= label_tag :dest_state, 'Select a state'  %&gt;
 &lt;br/&gt; &lt;%= select_tag :dest_state, 
                     options_for_select(states.collect{|s| [s[0],s[0]]}  
                         &lt;&lt; ['Select a state'], 
                       :selected =&gt; 'Select a state'), 
                       {:style =&gt; 'width: 180px'} %&gt;
 &lt;% else %&gt;
   &lt;%= label_tag :dest_state, 'Please enter state/province' %&gt;&lt;br /&gt;
   &lt;%= text_field_tag :dest_state %&gt;
&lt;% end %&gt;
</code></pre>

<p>Now, what I'd like to do is to be able to associate an address through the model (say, Person has_one :address) and within the form for creating a new person, be able to use something like</p>

<pre><code> &lt;%= label_tag :name, 'What's your name?' %&gt;
 &lt;%= text_field_tag :name %&gt;
 &lt;%= label_tag :address, 'Where do you live?' %&gt;
 &lt;%= address_fields_tag :address %&gt;
</code></pre>

<p>Which could generate the appropriate drop-downs, dynamically coupled together, the results of which would be accessible through Person.address.country and Person.address.state. </p>

<p>Thanks in advance!</p>
","<ruby-on-rails><ruby><mvc><refactoring><dry>","2","1064","2009-06-22 15:22:20"
"1027904","Java Reflection and the pain in Refactoring","<p>Java Reflection provides a mechanism to introspect an Object at runtime. No second thoughts, this is a great feature, but it breaks all the Refactoring conventions!</p>

<p>There is no easy way (other than <code>File Search</code>) even in modern IDE's to know which attribute is referenced and where. This makes Refactorings much more complex (tiresome!) and error prone.</p>

<p>To be frank, it's not just the <code>Reflection API</code>; <code>Hibernate mapping files (hbm.xml)</code> and <code>JSP files</code> both refer to the attributes as String and when you refactor your attribute name, then you have to manually change in all these places.</p>

<p>Worse, the changes in Hibernate mapping files or JSP files result in runtime errors.</p>

<p>I am interested in knowing how other programmers handle this in Java. Are there some tools? I use Eclipse/IBM RAD as main development platform. Normally we use a <code>constant</code> to define the attribute and use it whenever possible but its not always possible.</p>

<p>I would also be interested how other languages handle this!</p>
","<java><language-agnostic><reflection><refactoring>","6","1061","2009-06-22 15:41:06"
"1029483","Will ""Working Effectively with Legacy Code"" help someone working with an app ported from VB6 to VB.NET?","<p>I would like to refactor a large legacy application originally written in VB6 and subsequently ported to .NET.  In order to do this with confidence, I want to have unit tests around the existing code so I can compare before and after.  What's the easiest and most effective way of doing this?</p>

<p>There's a book called ""<em>Working Effectively with Legacy Code</em>"" that looks like it might help me.  However, it looks like it only deals with object-oriented languages and VB6 is not necessarily OO.  Can this book still help me?  I'm hoping someone who's read it can vouch for it.</p>

<p>Specifically, this application uses no classes other than the forms themselves.  It accesses the db directly from the forms, and not consistently.  There were several people working on this project all using their own styles with no standards whatsoever.</p>

<p>Final Edit:
As I said, this project has been ported to VB.NET.  However, it's only ported in the sense that it compiles under VS2008.  All of the coding concepts are VB6.</p>
","<refactoring><legacy><vb6-migration>","6","507","2009-06-22 21:25:33"
"1028679","Tools for refactoring C# public fields into properties","<p>I have a lot of C# code that uses public fields, and I would like to convert them to properties.</p>

<p>I have Resharper, and it will do them one by one, but this will take forever.</p>

<p>Does anyone know of an automated refactoring tool that can help with this?</p>
","<c#><.net><refactoring><automated-refactoring><public-fields>","2","592","2009-06-22 18:16:54"
"1029711","MFC: OnInitialUpdate function of a CFormView-derived class","<p>My CFormView-derived class is structured as follows:</p>

<pre><code>class FormViewClass : public CFormView
{
    	...
    	FormViewClass();
    	void Initialize();
    	virtual void OnInitialUpdate();
    	...
};
</code></pre>

<p>Ideally, I would like to call the Initialize() function in the body of the constructor as follows:</p>

<pre><code>FormViewClass::FormViewClass()
{
        ...
    	// originally I want to call Initialize function here
    	Initialize();
        ...
}
</code></pre>

<p>However, since I want this function to be responsible for all the initialization of this class when being created, and it contains MFC objects initializations such as combobox, edit control, checkbox control, radio button control, etc., should I be instead calling the Initialize() function here as I thought:</p>

<pre><code>void FormViewClass::OnInitialUpdate()
{
    // Should I call Initialize function instead here?
    Initialize();
}
</code></pre>

<p>Currently I have non-MFC memory and object initialization in the constructor (hence calling Iniitalize() helper function in the constructor) and MFC object iniitalization in the OnIniitalUpdate() handler function. It would be great to hear your thoughts about it so that I can refactor the code properly. Thanks in advance.</p>
","<c++><mfc><refactoring><initialization>","2","918","2009-06-22 22:26:45"
"1030388","How to overcome the anti-pattern ""Big Ball of Mud""?","<p>What causes a computer program to turn into a <a href=""http://en.wikipedia.org/wiki/Big%5Fball%5Fof%5Fmud"">Big Ball of Mud</a>?  Is it possible to recover from this anti-pattern?  Are there proven refactoring methods that can be applied?</p>
","<design-patterns><refactoring><howto><anti-patterns><recovery>","8","1034","2009-06-23 02:31:46"
"1040242","Java Code Refactoring: Best beginner's books","<p>I am a java programmer. I recently have embarked on a refactoring project and so wanted to get some suggestions on any good books out there which can provide fast and practical insights for the same. I haven't done any refactoring projects before, and neither do I have much knowledge of design patterns yet, so some beginner level book is what I am looking for.</p>

<p>Thanks!</p>
","<java><books><refactoring>","1","1803","2009-06-24 18:55:06"
"1042210","How can I write a Visual Studio macro to perform an Extract Class refactoring?","<p><strong>I'm trying to build a macro for Visual Studio 2008 that behaves thusly:</strong> (Extract Class Macro)</p>

<p>I highlight some text in the currently open document and call the Macro (using a keybinding or whatever).</p>

<p>The macro runs ""Project.AddClass"" for the current active project, allowing me to specify the Class name.</p>

<p>The macro adds the text I originally had highlighted in the other document into the newly-created class file, and removes the text from the original file.</p>

<p>The text is added to the new file inside the new class body, i.e. inside the opening and closing braces.</p>

<p>I've been tinkering with it, but I can't get a handle to the created class document.</p>

<p>Any help will be much appreciated.</p>
","<visual-studio><refactoring><macros>","3","665","2009-06-25 04:37:34"
"1042332","Replacement of Delphi IDE ""Sync Edit"" in Visual Studio","<p>There is a feature in Delphi IDE (Borland Developer Studio 2006) which allows to edit some variable in ""sync mode"". For example if you have a code snippet like this:
<a href=""http://i42.tinypic.com/2qdo8sz.png"" rel=""nofollow"">2qdo8sz.png</a></p>

<p>You can select the text you want to modify (in this case the complete procedure) and start editing a variable name. It will be edited at all the places (except string literals):
<a href=""http://i39.tinypic.com/dzvyi9.png"" rel=""nofollow"">dzvyi9.png</a></p>

<p>It is different from refactoring since the scope of change is limited. Its simple and fast. I loved this facility.</p>

<p>Now I have started using Visual Studio for past some time and miss something like this. Please can you suggest anything to achieve the same effect in Visual Studio?</p>
","<visual-studio><delphi><refactoring><productivity>","3","328","2009-06-25 05:37:09"
"1045059","Assign Excel Range to a Javascript Array","<p>I'm working on some code to export a DataTable to Excel, and I'm trying to make it as fast as possible. Right now, I'm looping through each row and each column for each row (nested for loops). When I've got a large DataTable, this process can take some time. Can I assign a range of cells to an array in Javascript instead of looping through the columns?</p>

<p>Here's a sample of what I'm doing.</p>

<pre><code>for (var rowIndex = 0; rowIndex &lt; json.worksheets.raw.rows.count; rowIndex++) {
    row = rowIndex + 2;
    for (var columnIndex = 0; columnIndex &lt; json.worksheets.raw.rows.values[rowIndex].length; columnIndex++) {
    	column = columnIndex + 1
    	XLWorksheet.Cells(row, column) = json.worksheets.raw.rows.values[rowIndex][columnIndex];
    }
}
</code></pre>

<p>I get the JSON data using an AJAX call to a web service in my ASP.NET project.</p>
","<javascript><excel><refactoring>","0","1049","2009-06-25 17:02:33"
"1052931","Testing for ImportErrors in Python","<p>We're having a real problem with people checking in code that doesn't work because something's been refactored.  Admittedly, this is partly because our developers don't really have any good tools for finding these kinds of mistakes easily.</p>

<p>Are there any tools to help find ImportErrors in Python?  Of course, the correct answer here is ""you should use your unit tests for that.""  But, I'm in legacy code land (at least by Michael Feathers's definition), so our unit tests are something we're working on heavily.</p>

<p>In the meantime, it would be nice to have some sort of tool that will walk through each directory and import each file within it just to find any scripts that have ImportErrors (like say if a file or class has been renamed recently).  I suppose this wouldn't be <em>terribly</em> difficult to write myself, but are there any programs that are already written to do this?  </p>
","<python><unit-testing><refactoring><continuous-integration><importerror>","1","129","2009-06-27 14:41:37"
"1055576","Non-member non-friend functions vs private functions","<p>Herb Sutter has said that the most object oriented way to write methods in C++ is using non-member non-friend functions. Should that mean that I should take private methods and turn them into non-member non-friend functions? Any member variables that these methods may need can be passed in as parameters.</p>

<p>Example (before):</p>

<pre><code>class Number {
 public:
  Number( int nNumber ) : m_nNumber( nNumber ) {}
  int CalculateDifference( int nNumber ) { return minus( nNumber ); }
 private:
  int minus( int nNumber ) { return m_nNumber - nNumber; }
  int m_nNumber;
};
</code></pre>

<p>Example (after):</p>

<pre><code>int minus( int nLhsNumber, int nRhsNumber ) { return nLhsNumber - nRhsNumber; }
class Number {
 public:
  Number( int nNumber ) : m_nNumber( nNumber ) {}
  int CalculateDifference( int nNumber ) { return minus( m_nNumber, nNumber ); }
 private:
  int m_nNumber;
};
</code></pre>

<p>Am I on the right track? Should all private methods be moved to non-member non-friend functions? What should be rules that would tell you otherwise?</p>
","<c++><refactoring>","6","948","2009-06-28 19:33:51"
"1057425","Is excessive use of this in C++ a code smell","<p>I'm dealing with a large code base that uses the following construct throughout</p>

<pre><code>class MyClass
{
public:
  void f(int x);
private:
  int x;
};


void MyClass::f(int x)
{
'
'
  this-&gt;x = x;
'
'
}
</code></pre>

<p>Personally, I'd always used and hence prefer the form</p>

<pre><code>class MyClass
{
public:
  void f(int x);
private:
  int _x;
};


void MyClass::f(int x)
{
'
'
  _x = x;
'
'
}
</code></pre>

<p>The reasons I prefer the latter are that it is more succinct (less code = fewer potential bugs), and that I don't like having multiple variables of the same name in scope at the same time where I can avoid it.  That said, I am seeing the former usage more and more often these days.  Is there any upside to second approach that I am unaware of? (e.g. effect on compile time, use with templated code, etc...)  Are the advantages of either approach significant enough merit a refactor to the other?  Reason I ask, that while I don't like the second approach present in the code, the amount of effort and associated risk of introducing further bugs don't quite merit a refactor.</p>
","<c++><this><code-smell><refactoring>","5","1348","2009-06-29 09:35:45"
"1060793","Passing Files as Parameters","<p>I have created an example to introduce my question.</p>

<pre><code>public class Algorithm
{
    // This is the best, but circumstances prevent me from doing this.
    /*public static void computeSomething(Data data)
    {
    	// Compute some stuff
    }*/

    public static void computeSomething(DataFileReader reader) throws IOException
    {
    	// Compute some stuff.
    }

    public static void computeSomething(File file) throws IOException, DataFormatException
    {
    	DataFileReader = DataFileReaderFactory.newDataFileReader(file);

    	// Compute some stuff.
    }
}

public class DataFileReaderFactory
{
    private enum FileExtension { XML, UNSUPPORTED_EXTENSION }

    private static final String XMLExtension = "".xml"";

    public static DataFileReader newDataFileReader(File file) throws DataFormatException
    {
    	switch(computeFileExtension(file))
    	{
    		case XML :	return new XMLFileReader(file);

    		default :	throw new DataFormatException();
    	}
    }

    private static FileExtension computeFileExtension(File file)
    {
    	if(file.getName().endsWith(XMLExtension))
    		return FileExtension.XML;
    	else
    		return FileExtension.UNSUPPORTED_EXTENSION;
    }
}
</code></pre>

<p>So, I would like to know if I should define my interface to take <em>Files</em>, or my own file readers, which ensure that the data is in a valid format.  Obviously, I would like to be able to take the data itself as a <em>Data</em> object, but I am limited in this regard.  The reason has to do with the data being very large and me having to serialize it for multiple objects.  In this case, it is more practical to send a path to the data rather than the data itself.</p>

<p>Anyhow, in regards to the question, I am leaning toward the method which takes an instance of Java's <em>File,</em> as it seems more general, but I want hear your advice.  Thanks!</p>
","<java><file><oop><refactoring><parameter-passing>","1","278","2009-06-29 22:00:39"
"1060483","Dependency Injection in C++","<p>How do I implement dependancy injection in C++ explicitly without using frameworks or reflection?</p>

<p>I could use a factory to return a auto_ptr or a shared_ptr. Is this a good way to do it?</p>
","<c++><refactoring><dependency-injection>","4","1550","2009-06-29 20:53:19"
"1060526","unit tests in C++","<p>Is okay to break all dependencies using interfaces just to make a class testable? It involves significant overhead at runtime because of many virtual calls instead of plain method invocations.</p>

<p>How does test driven development work in real world C++ applications? I read Working Effectively With Legacy Code and fond it quite useful but do not get up to speed practising TDD.</p>

<p>If I do a refactoring it occurs very often that I have to completely rewite unit test because of massive logic changes. My code changes very often change the fundamental logic of the processing of data. I do not see a way to write unit tests which do not have to change in a large refactoring.</p>

<p>May be someone can point me to an open source c++ application wich is using TDD to learn by example.</p>
","<c++><unit-testing><refactoring>","5","393","2009-06-29 20:59:35"
"1065106","C#: How would you suggest to refactor these classes? (Interfaces, Aggregation or anything else)","<p>Having the following classes, in two different assemblies:</p>

<pre><code>class Member
{
    public string Label {get;set;}
    // Lots of other fields...

    public double Thickness {get;set;}
    public double Width {get;set;}
    public double Length {get;set;}
    public double GetVolume ()
    {
        return Thickness * Width * Length;
    }

    // Other methods
}

class OtherMember
{
    public string CompositeLabel {get;set;}
    // Lots of other fields (not related to other class: Member)

    public double Thickness {get;set;}
    public double Width {get;set;}
    public double Length {get;set;}
    public double GetVolume ()
    {
        return Thickness * Width * Length;
    }

    // Other methods
}
</code></pre>

<p>I want to refactor the Thickness, Width, Length properties and the GetVolume method to another class (Dimensions?) as to DRY...</p>

<p>I could then have a field/property in those classes to give access to a Dimensions instance.</p>

<p>Is this a good way to go?</p>

<p>I've read succinctly about having interfaces instead of concrete classes, should I inherit from an interface?</p>

<p>Also, what about immutability?</p>

<p>I feel I'm often lost about getting my domain classes right. Does anyone have some advice on this?</p>
","<c#><refactoring><interface><model>","1","474","2009-06-30 18:05:24"
"1071856","When should one try to eliminate a switch statement?","<p>I've come across a switch statement in the codebase I'm working on and I'm trying to figure out how to replace it with something better since <a href=""http://c2.com/cgi/wiki?SwitchStatementsSmell"" rel=""nofollow"">switch statements are considered a code smell</a>. However, having read through <a href=""http://stackoverflow.com/questions/126409/ways-to-eliminate-switch-in-code"">several</a> posts on stackoverflow about <a href=""http://stackoverflow.com/questions/374239/why-doesnt-python-have-a-switch-statement#374290"">replacing</a> <a href=""http://stackoverflow.com/questions/561401/refactor-my-c-code-switch-statement"">switch</a> <a href=""http://stackoverflow.com/questions/338206/switch-statement-with-strings-in-java"">statements</a> I can't seem to think of an effective way to replace this particular switch statement.</p>

<p>Its left me wondering if this particular switch statement is ok and if there are particular circumstances where switch statements are considered appropriate.</p>

<p>In my case the code (slightly obfuscated naturally) that I'm struggling with is like this:</p>

<pre><code>private MyType DoSomething(IDataRecord reader)
{
    var p = new MyType
                {
                   Id = (int)reader[idIndex],
                   Name = (string)reader[nameIndex]
                }

    switch ((string) reader[discountTypeIndex])
    {
        case ""A"":
            p.DiscountType = DiscountType.Discountable;
            break;
        case ""B"":
            p.DiscountType = DiscountType.Loss;
            break;
        case ""O"":
            p.DiscountType = DiscountType.Other;
            break;
    }

    return p;
}
</code></pre>

<p>Can anyone suggest a way to eliminate this switch? Or is this an appropriate use of a switch? And if it is, are there other appropriate uses for switch statements? I'd really like to know where they are appropriate so I don't waste too much time trying to eliminate every switch statement I come across just because they are considered a smell in some circumstances.</p>

<p><strong>Update:</strong> At the suggestion of <a href=""http://stackoverflow.com/questions/1071856/when-should-one-try-to-eliminate-a-switch-statement/1071879#1071879"">Michael</a> I did a bit of searching for duplication of this logic and discovered that someone had created logic in another class that effectively made the whole switch statement redundant. So in the context of this particular bit of code the switch statement was unnecessary. However, my question is more about the appropriateness of switch statements in code and whether we should always try to replace them whenever they are found so in this case I'm inclined to accept the answer that this switch statement is appropriate.</p>
","<c#><refactoring><switch-statement>","9","917","2009-07-01 23:45:53"
"1072199","Java: refactoring static constants","<p>We are in the process of refactoring some code.  There is a feature that we have developed in one project that we would like to now use in other projects.  We are extracting the foundation of this feature and making it a full-fledged project which can then be imported by its current project and others.  This effort has been relatively straight-forward  but we have one headache.  </p>

<p>When the framework in question was originally developed, we chose to keep a variety of constant values  defined as static fields in a single class.  Over time this list of static members grew.  The class is used in very many places in our code.  In our current refactoring, we will be elevating some of the members of this class to our new framework, but leaving others in place.   Our headache is in extracting the foundation members of this class to be used in our new project, and more specifically, how we should address those extracted members in our existing code.    </p>

<p>We know that we can have our existing Constants class subclass this new project's Constants class and it would inherit all of the parent's  static members.  This would allow us to effect the change without touching the code that uses these members to change the class name on the static reference.   However, the tight coupling inherent in this choice doesn't feel right.</p>

<p>before: </p>

<pre><code>public class ConstantsA {
  public static final String CONSTANT1 = ""constant.1"";
  public static final String CONSTANT2 = ""constant.2"";
  public static final String CONSTANT3 = ""constant.3"";
}
</code></pre>

<p>after:</p>

<pre><code>public class ConstantsA  extends ConstantsB { 
  public static final String CONSTANT1 = ""constant.1"";
}

public class ConstantsB {
  public static final String CONSTANT2 = ""constant.2"";
  public static final String CONSTANT3 = ""constant.3"";
}
</code></pre>

<p>In our existing code branch, all of the above would be accessible in this manner:</p>

<pre><code>ConstantsA.CONSTANT2
</code></pre>

<p>I would like to solicit arguments about whether this is 'acceptable' and/or what the best practices are.  </p>
","<java><design><refactoring>","3","830","2009-07-02 02:47:26"
"1078418","Improving quality of code in CakePHP","<p>I have been using CakePHP for a few weeks now and its been an great experience. I've managed to port a site surprisingly quickly and I've even added a bunch of new features which I had planned but never got around to implementing.</p>

<p>Take a look at the following two controllers, they allow a user to add premium status to one of the sites linked to their account. They don't feel very 'cakey', could they be improved in any way?</p>

<p>The PremiumSites controller handles the signup process and will eventually have other related things such as history.</p>

<p><code></p>

<pre><code>class PremiumSitesController extends AppController {

    var $name = 'PremiumSites';

    function index() {
    	$cost = 5;

    	//TODO: Add no site check

    	if (!empty($this-&gt;data)) {
    		if($this-&gt;data['PremiumSite']['type'] == ""1"") {
    			$length = (int) $this-&gt;data['PremiumSite']['length'];
    			$length++;
    			$this-&gt;data['PremiumSite']['upfront_weeks'] = $length;
    			$this-&gt;data['PremiumSite']['upfront_expiration'] = date('Y-m-d H:i:s', strtotime(sprintf('+%s weeks', $length)));
    			$this-&gt;data['PremiumSite']['cost'] = $cost * $length;
    		} else {
    			$this-&gt;data['PremiumSite']['cost'] = $cost;
    		}

    		$this-&gt;PremiumSite-&gt;create();
    		if ($this-&gt;PremiumSite-&gt;save($this-&gt;data)) {
    			$this-&gt;redirect(array('controller' =&gt; 'paypal_notifications', 'action' =&gt; 'send', $this-&gt;PremiumSite-&gt;getLastInsertID()));
    		} else {
    			$this-&gt;Session-&gt;setFlash('Please fix the problems below', true, array('class' =&gt; 'error'));
    		}
    	}

    	$this-&gt;set('sites',$this-&gt;PremiumSite-&gt;Site-&gt;find('list',array('conditions' =&gt; array('User.id' =&gt; $this-&gt;Auth-&gt;user('id'), 'Site.is_deleted' =&gt; 0), 'recursive' =&gt; 0)));
    }

}
</code></pre>

<p></code></p>

<p>PaypalNotifications controller handles the interaction with Paypal.</p>

<p><code></p>

<pre><code>class PaypalNotificationsController extends AppController {

    var $name = 'PaypalNotifications';

    function beforeFilter() {
    	parent::beforeFilter();
    	$this-&gt;Auth-&gt;allow('process');
    }

    /**
     * Compiles premium info and send the user to Paypal
     * 
     * @param integer $premiumID an id from PremiumSite 
     * @return null
     */
    function send($premiumID) {

    	if(empty($premiumID)) {
    		$this-&gt;Session-&gt;setFlash('There was a problem, please try again.', true, array('class' =&gt; 'error'));
    		$this-&gt;redirect(array('controller' =&gt; 'premium_sites', 'action' =&gt; 'index'));
    	}

    	$data = $this-&gt;PaypalNotification-&gt;PremiumSite-&gt;find('first', array('conditions' =&gt; array('PremiumSite.id' =&gt; $premiumID), 'recursive' =&gt; 0));

    	if($data['PremiumSite']['type'] == '0') {
    		//Subscription
    		$paypalData = array(
    			'cmd' =&gt; '_xclick-subscriptions',
    			'business'=&gt; '',
    			'notify_url' =&gt; '',
    			'return' =&gt; '',
    			'cancel_return' =&gt; '',
    			'item_name' =&gt; '',
    			'item_number' =&gt; $premiumID,
    			'currency_code' =&gt; 'USD',
    			'no_note' =&gt; '1',
    			'no_shipping' =&gt; '1',
    			'a3' =&gt; $data['PremiumSite']['cost'],
    			'p3' =&gt; '1',
    			't3' =&gt; 'W',
    			'src' =&gt; '1',
    			'sra' =&gt; '1'
    		);

    		if($data['Site']['is_premium_used'] == '0') {
    			//Apply two week trial if unused
    			$trialData = array(
    				'a1' =&gt; '0',
    				'p1' =&gt; '2',
    				't1' =&gt; 'W',
    			);
    			$paypalData = array_merge($paypalData, $trialData);
    		}
    	} else {
    		//Upfront payment

    		$paypalData = array(
    			'cmd' =&gt; '_xclick',
    			'business'=&gt; '',
    			'notify_url' =&gt; '',
    			'return' =&gt; '',
    			'cancel_return' =&gt; '',
    			'item_name' =&gt; '',
    			'item_number' =&gt; $premiumID,
    			'currency_code' =&gt; 'USD',
    			'no_note' =&gt; '1',
    			'no_shipping' =&gt; '1',
    			'amount' =&gt; $data['PremiumSite']['cost'],
    		);
    	}

    	$this-&gt;layout = null;
    	$this-&gt;set('data', $paypalData);
    }

    /**
     * IPN Callback from Paypal. Validates data, inserts it
     * into the db and triggers __processTransaction()
     * 
     * @return null
     */
    function process() {
    	//Original code from http://www.studiocanaria.com/articles/paypal_ipn_controller_for_cakephp
    	//Have we been sent an IPN here...
    	if (!empty($_POST)) {
    		//...we have so add 'cmd' 'notify-validate' to a transaction variable
    		$transaction = 'cmd=_notify-validate';
    		//and add everything paypal has sent to the transaction
    		foreach ($_POST as $key =&gt; $value) {
    			$value = urlencode(stripslashes($value));
    			$transaction .= ""&amp;$key=$value"";
    		}
    		//create headers for post back
    		$header = ""POST /cgi-bin/webscr HTTP/1.0\r\n"";
    		$header .= ""Content-Type: application/x-www-form-urlencoded\r\n"";
    		$header .= ""Content-Length: "" . strlen($transaction) . ""\r\n\r\n"";
    		//If this is a sandbox transaction then 'test_ipn' will be set to '1'
    		if (isset($_POST['test_ipn'])) {
    			$server = 'www.sandbox.paypal.com';
    		} else {
    			$server = 'www.paypal.com';
    		}
    		//and post the transaction back for validation
    		$fp = fsockopen('ssl://' . $server, 443, $errno, $errstr, 30);
    		//Check we got a connection and response...
    		if (!$fp) {
    			//...didn't get a response so log error in error logs
    			$this-&gt;log('HTTP Error in PaypalNotifications::process while posting back to PayPal: Transaction=' .
    				$transaction);
    		} else {
    			//...got a response, so we'll through the response looking for VERIFIED or INVALID
    			fputs($fp, $header . $transaction);
    			while (!feof($fp)) {
    				$response = fgets($fp, 1024);
    				if (strcmp($response, ""VERIFIED"") == 0) {
    					//The response is VERIFIED so format the $_POST for processing
    					$notification = array();

    					//Minor change to use item_id as premium_site_id
    					$notification['PaypalNotification'] = array_merge($_POST, array('premium_site_id' =&gt; $_POST['item_number']));
    					$this-&gt;PaypalNotification-&gt;save($notification);

    					$this-&gt;__processTransaction($this-&gt;PaypalNotification-&gt;id);
    				} else
    					if (strcmp($response, ""INVALID"") == 0) {
    						//The response is INVALID so log it for investigation
    						$this-&gt;log('Found Invalid:' . $transaction);
    					}
    			}
    			fclose($fp);
    		}
    	}
    	//Redirect
    	$this-&gt;redirect('/');
    }

    /**
     * Enables premium site after payment
     * 
     * @param integer $id uses id from PaypalNotification
     * @return null
     */
    function __processTransaction($id) {
    	$transaction = $this-&gt;PaypalNotification-&gt;find('first', array('conditions' =&gt; array('PaypalNotification.id' =&gt; $id), 'recursive' =&gt; 0));
    	$txn_type = $transaction['PaypalNotification']['txn_type'];

    	if($txn_type == 'subscr_signup' || $transaction['PaypalNotification']['payment_status'] == 'Completed') {
    		//New subscription or payment
    		$data = array(
    			'PremiumSite' =&gt; array(
    				'id' =&gt; $transaction['PremiumSite']['id'],
    				'is_active' =&gt; '1',
    				'is_paid' =&gt; '1'
    			),
    			'Site' =&gt; array(
    				'id' =&gt; $transaction['PremiumSite']['site_id'],
    				'is_premium' =&gt; '1'
    			)
    		);

    		//Mark trial used only on subscriptions
    		if($txn_type == 'subscr_signup') $data['Site']['is_premium_used'] = '1';

    		$this-&gt;PaypalNotification-&gt;PremiumSite-&gt;saveAll($data);

    	} elseif($txn_type == 'subscr-cancel' || $txn_type == 'subscr-eot') {
    		//Subscription cancellation or other problem
    		$data = array(
    			'PremiumSite' =&gt; array(
    				'id' =&gt; $transaction['PremiumSite']['id'],
    				'is_active' =&gt; '0',
    			),
    			'Site' =&gt; array(
    				'id' =&gt; $transaction['PremiumSite']['site_id'],
    				'is_premium' =&gt; '0'
    			)
    		);

    		$this-&gt;PaypalNotification-&gt;PremiumSite-&gt;saveAll($data);
    	}


    }

    /**
     * Used for testing
     * 
     * @return null
     */
    function index() {
    	$this-&gt;__processTransaction('3');
    }
}
</code></pre>

<p></code></p>

<p>/views/paypal_notifications/send.ctp</p>

<p>Sends the user to Paypal along with all the necessary data</p>

<p><code></p>

<pre><code>echo ""&lt;html&gt;\n"";
echo ""&lt;head&gt;&lt;title&gt;Processing Payment...&lt;/title&gt;&lt;/head&gt;\n"";
echo ""&lt;body onLoad=\""document.form.submit();\""&gt;\n"";
echo ""&lt;center&gt;&lt;h3&gt;Redirecting to paypal, please wait...&lt;/h3&gt;&lt;/center&gt;\n"";

echo $form-&gt;create(null, array('url' =&gt; 'https://www.sandbox.paypal.com/cgi-bin/webscr', 'type' =&gt; 'post', 'name' =&gt; 'form'));

foreach ($data as $field =&gt; $value) {
    //Using $form-&gt;hidden sends in the cake style, data[PremiumSite][whatever]
    echo ""&lt;input type=\""hidden\"" name=\""$field\"" value=\""$value\""&gt;"";
}

echo $form-&gt;end();

echo ""&lt;/form&gt;\n"";
echo ""&lt;/body&gt;&lt;/html&gt;\n"";
</code></pre>

<p></code></p>
","<php><cakephp><refactoring>","11","1468","2009-07-03 08:43:48"
"1089825","What to do with over-complicated inherited code","<p>Ever since I gained experience at a software house I have found it difficult to tolerate code not neatly structured, without any form of architecture or beauty or clarity whether or not it works i.e. does what its supposed to do. </p>

<p>I find I am always caught up in refactoring code like this sometimes ""at my own expense"" is where my comfort v productivity dilemma is. </p>

<p>What is the quickest way to deal with badly written code you inherit in your experience? Write yours or encapsulate / refactor what's there, time consumingly?  </p>
","<refactoring>","9","429","2009-07-07 00:25:28"
"1090005","how to make sure there is exactly one event handler in C#","<p>Sometimes I want to attach an event handler but I'm not sure if I've done it already to that object.  My workaround is to remove it using -= then add it using += .  Is there a better way?</p>

<p>Edit: The reason I want to make sure not to do it twice (or more) is that if I do, it will get fired twice (or more)</p>
","<c#><refactoring><event-handling>","1","453","2009-07-07 01:51:29"
"1090791","Avoiding web service god classes","<p>I have a complex RIA client that communicates with a WCF SOAP web service, the second <em>a</em> being the operative word.  This has resulted in a dreaded god class containing 131 [OperationContract] methods so far and even more private methods.</p>

<p>Personally, I don't have a problem with this; I use search and the navigation features of Visual Studio to very easily find my way around the class.  The other developers, however, are suffering due to this.  They're the sorts that slowly scroll around looking for things (it's annoying to watch).  I #regioned the class up into sections, but I'm the only one that seems to enjoy the benefits of this (they're of the seemingly-more-common #region-hating camp).</p>

<p>So, to be nice to the other programmers, and maybe enjoy some resultant benefits I'm unaware of, I want to refactor the monster.  Here's the options I see available:</p>

<h2>Option 1: Fragment the web service into separate services</h2>

<p>What I don't like about this is it would break my client code.  I would have to rewrite it to use the new proxy classes.  Additionally, I would also have more WCF configuration to maintain (yuck!).  Also, there might be custody battles for where shared private methods should belong.</p>

<h2>Option 2: Use partial classes</h2>

<p>This idea seems appealing to me.  What I would do with this approach is have each source file (not <em>too</em> many of them) represent a functional division of the web service.  For example:</p>

<pre><code>MyService.svc.cs
MyService.AccountManagement.svc.cs
MyService.Preferences.svc.cs
MyService.MediaManagement.svc.cs
</code></pre>

<p>I worry a bit about this approach, because at a former company when I raised this as a possibility, one developer said it was a bad idea due to some nebulous ""there are issues with partial classes"" reason.  I never got a better explanation than this, but I took his word for it.</p>

<h2>Option 3: Something I haven't considered</h2>

<p>I assume that it's not uncommon for a complex web service to create god classes such as these, so there must be some good practice approaches I'm unaware of.  What techniques do y'all use to make your web service classes easier on the eyes?</p>

<h1>Update</h1>

<p>Thanks everyone for your input.  I wish I could accept more than one answer.</p>

<p>I've read through your answers, discussed things with the development team, and for now, we're simply going to reorganize the service into partial classes.  I'll leave comments on the other suggestions to explain why I'm not taking those approaches, at least for now.  You all have given me some valuable things to think about for future development.</p>
","<.net><wcf><soap><refactoring>","4","495","2009-07-07 07:12:38"
"1092702","Some sort of site-wide CSS inspector","<p>I work at a site that passed through some face lifts. In time the CSS files became pretty massive, as the CSS for the old designs was not deleted when no longer needed.</p>

<p>I was wondering if there is some kind of tool that allows me to spider the entire site(or the source files) and check which css rules are no longer used. </p>

<p>I know that there are tools to do this at page level, but are there tools that allow this at site-wide level?</p>
","<web-development><tools><refactoring>","2","93","2009-07-07 14:34:04"
"1098585","Mass Renaming of Tables and Stored Procedures","<p>I need to rename all of my tables, stored procedures and obviously the code within each stored procedure that was referencing the old table names. </p>

<p>Why is the best way to do this?</p>

<p>Some methods I have considered:</p>

<p>SP_Rename - Gets half the job done. However this doesn't change the code within the SP itself</p>

<p>In addition to RedGates' Refactor, I found this set of tools here <a href=""http://www.easysqltools.com/EasySQLSmartRename.aspx"" rel=""nofollow"">http://www.easysqltools.com/EasySQLSmartRename.aspx</a> which does the exact same thing (I get the feeling their version is based on Refactor because the UI looks almost exactly the same) which runs in SSMS Express which happens to be the version I run. 15 day trial should be more than enough for most purposes.</p>
","<sql-server><sql-server-2005><stored-procedures><refactoring><naming>","3","1017","2009-07-08 14:51:12"
"1104984","Surrounding Ruby methods with code","<p>I have a great number of methods like this:</p>

<pre><code>def enableMotors
  @posIface.Lock 1
  @posIface.data.cmdEnableMotors = 1
  @posIface.Unlock
end

def goTo (pos)
  @posIface.Lock 1
  @posIface.data.cmdVelocity.pos = pos
  @posIface.Unlock
end
</code></pre>

<p>I would like to create functionality to :before_filter and :after_filter or any other way I can keep this code as DRY as possible. 
I dont want to depend on Rails or other heavy stuff only for this. </p>
","<ruby><refactoring>","1","81","2009-07-09 16:25:39"
"1104543","Does it exist: Repeated Code Finder?","<p>In the near future, I will be inheriting a somewhat large project.  I've been making some small updates to it recently, and noticed that parts of it could use some refactoring, since there are methods that perform the same operation with a small difference.  </p>

<p>I was wondering if there is a tool that will take a bunch of source code and find similar blocks of code so that they could be identified for possible refactoring.  It would be great if there was fuzzy searching present, so that it could identify similar operation (other than just chucks of code repeated verbatim).</p>

<p>I don't expect the program to refactor the code itself, just identify potential repetition.</p>

<p>My platform is C#, but any solution would be helpful</p>
","<language-agnostic><tools><refactoring><dry><code-reuse>","12","516","2009-07-09 15:14:50"
"1107036","Condensing this code","<p>I have the following code I want to run, but the problem is $this->type is set when the class is created by specifying either petition, proposal, or amendment. As you can see my $sql statement is a UNION of all three, and I want to specify which table (pet,prop,or amend) each row of data comes from.</p>

<pre><code>public function userProposals() {
    $username = User::getUsername();
    $sql = ""SELECT * FROM petition WHERE author = '$username'
    UNION SELECT * FROM proposition WHERE author = '$username'
    UNION SELECT * FROM amendment WHERE author = '$username'"";
    $query = mysql_query($sql);
    $state = User::userState();

    while ($row = mysql_fetch_assoc($query)) { // $this-&gt;type needs to specify pet,prop,amend
        echo ""
        &lt;tr&gt;
            &lt;td&gt;$row[id]&lt;/td&gt;
            &lt;td&gt;&lt;a href='viewproposal.php?type=$this-&gt;type&amp;id=$row[id]'&gt;$row[title]&lt;/a&gt;&lt;/td&gt;
            &lt;td&gt;$this-&gt;type&lt;/td&gt;
            &lt;td&gt;$state&lt;/td&gt;
        &lt;/tr&gt;"";
    }
}
</code></pre>

<p>As you can see, $this->type will only say one of the three. To get my function work how i wanted to, I did this (which I feel is too long &amp; there must be a shorter way).</p>

<pre><code>public function userProposals() {
    $username = User::getUsername();
    $state = User::userState();
    $sql = ""SELECT * FROM petition WHERE author = '$username'"";
    $query = mysql_query($sql);
    while ($row = mysql_fetch_assoc($query)) {
        echo ""
        &lt;tr&gt;
            &lt;td&gt;$row[id]&lt;/td&gt;
            &lt;td&gt;&lt;a href='viewproposal.php?type=petition&amp;id=$row[id]'&gt;$row[title]&lt;/a&gt;&lt;/td&gt;
            &lt;td&gt;Petition&lt;/td&gt;
            &lt;td&gt;$state&lt;/td&gt;
        &lt;/tr&gt;"";
    }
    $sql = ""SELECT * FROM proposition WHERE author = '$username'"";
    $query = mysql_query($sql);
    while ($row = mysql_fetch_assoc($query)) {
        echo ""
        &lt;tr&gt;
            &lt;td&gt;$row[id]&lt;/td&gt;
            &lt;td&gt;&lt;a href='viewproposal.php?type=proposition&amp;id=$row[id]'&gt;$row[title]&lt;/a&gt;&lt;/td&gt;
            &lt;td&gt;Proposition&lt;/td&gt;
            &lt;td&gt;$state&lt;/td&gt;
        &lt;/tr&gt;"";
    }
    $sql = ""SELECT * FROM amendment WHERE author = '$username'"";
    $query = mysql_query($sql);
    while ($row = mysql_fetch_assoc($query)) {
        echo ""
        &lt;tr&gt;
            &lt;td&gt;$row[id]&lt;/td&gt;
            &lt;td&gt;&lt;a href='viewproposal.php?type=amendment&amp;id=$row[id]'&gt;$row[title]&lt;/a&gt;&lt;/td&gt;
            &lt;td&gt;Amendment&lt;/td&gt;
            &lt;td&gt;$state&lt;/td&gt;
        &lt;/tr&gt;"";
    }
}
</code></pre>
","<php><sql><refactoring>","1","150","2009-07-09 23:57:44"
"1110836","What is the best way to refactor database procedures?","<p>I need to understand and clarify some T-SQL stored procedures that contain important business logic.  Does anyone know of any tools, tips, tricks, or hints that can be used for unit testing so I can refactor this sql without breaking it?</p>
","<database><unit-testing><tsql><stored-procedures><refactoring>","2","128","2009-07-10 17:20:15"
"1111709","How to find data table column reference in stored procedures","<p>I have changed a column name in a table in my SQL Server 2005 database.  I also have a rather large collection of stored procedures that may or may not be referencing that column.  Is there a way to find what stored procedures are referencing that column without actually going through each stored procedure and search for it manually?  Is there a way to automatically find what stored procedures will now break or something?  I do not have access to such SQL refactoring tools like RedGate's SQL Refactor.</p>

<p>Thanks!</p>
","<sql-server-2005><stored-procedures><refactoring><automation><schema>","4","5195","2009-07-10 20:08:27"
"1113844","jQuery advice: How can I improve this function for scrolling elements into view?","<p>I've created a function that scrolls a given child element into view within its parent.  It goes as follows:</p>

<pre><code>function keepScrolledOver( elem )
{
	frame = elem.parent();

	var scrollPos = frame.scrollTop();
	var offset = elem.attr( ""offsetTop"" );

	// If the element is scrolled too high...
	if( offset &lt; scrollPos )
	{
		frame.scrollTop( offset );
		// frame.attr( ""scrollTop"", offset );
	}

	// If the element is scrolled too low...
	else
	{
		var frameHeight = frame.height();
		var offsetBottom = offset + elem.height();
		var scrollBottom = scrollPos + frameHeight;


		if( offsetBottom &gt; scrollBottom )
		{
			// frame.attr( ""scrollTop"", offsetBottom );
			if( frameHeight &lt; offsetBottom )
				frame.scrollTop( offsetBottom - frameHeight );
				// frame.attr( ""scrollTop"", offsetBottom - frameHeight );
		}
	}
}
</code></pre>

<p>So far, for my Firefox web app (Firefox is all I've tested it on thus far, I mean), this works great.  Only issue is that for elements scrolled too low it always tends to scroll just a tiny bit past the target element rather than right up to its end.  I'm not sure if element padding has something to do with or else if my maths just suck.</p>

<p>Anyone have any brilliant ideas on how to improve this?</p>
","<javascript><jquery><firefox><refactoring><scrolling>","1","1202","2009-07-11 14:38:36"
"1115716","Emacs and Java change propagation and errors notification","<p>Emacs and Java change propagation</p>

<p>Hi,</p>

<p>I'm mostly used to code in IDE like Eclipse but I wanted to try emacs. Because I keep hearing about how much better it is than big IDE like Eclipse and Visual Studio.
So I was looking at what emacs provides for Java (with the JDEE extension) but it doesn't seem as complete as Eclipse.</p>

<p>One of the most important thing I look for in a Java editor is change propagation and error notification. For example if I rename a class, I want to be able to have all the declarations of this class renamed automatically. And if I delete a method, I want to be able to see all the place where this creates errors. </p>

<p>I didn't find those things in emacs, and this is a showstopper for me, I can't see how I could work on big projects without those features.</p>

<p>So my question is : those features don't exist or is it just me that haven't looked at the right place?</p>
","<java><emacs><refactoring>","2","240","2009-07-12 10:14:59"
"1118751","Is there any equivalent in VS for ""Type Hierarchy View"" as with eclipse?","<p>I want to see which classes are implement from a particular Interface. I know this is possible with the Eclipse by saying ""Type Hierarchy View"". Is is possible in VS 2008?</p>

<p>I guess that it may be possible with Resharper. But without it, is it possible? Any workarounds? </p>

<p>Thanks</p>
","<visual-studio><visual-studio-2008><ide><refactoring>","0","328","2009-07-13 10:38:21"
"1121569","Django and SQL question: Reduce number of database hits","<p>For one of my clients, I am generating a clients list from the Django Admin. It splits the clients by status: current, acquired, and past.</p>

<p>Currently, the view code for that list is as follows:</p>

<pre><code>def clients_list(request):
current_clients = Client.objects.all().filter(status='current')[:10]
acquired_clients = Client.objects.all().filter(status='acquired')[:10]
past_clients = Client.objects.all().filter(status='past')[:10]

return render_to_response('clients/list.html', {
	'current_clients': current_clients,
	'acquired_clients': acquired_clients,
	'past_clients': past_clients
})
</code></pre>

<p>Now, I know this isn't ideal as it hits the database three times when I'm pretty sure there's a way to do it with only one query. Is it possible to refactor this code so that it only hits the database once and uses Python to split the result into those three variables? Or am I just stressing too much over a trivial part of my application?</p>

<p>Thanks,</p>

<p>Matt</p>
","<sql><django><refactoring>","0","282","2009-07-13 19:29:58"
"1123809","Should a software Service be completely standalone or can/should it be part of a larger component?","<p>I am in the process of refactoring 4 disparate software components that pretty much do the same thing into a single service (not a web service - necessarily or even likely). 3 are written in C++ while the last and most important is written in Java. The rest of the system is written in Java and therefore I will not be refactoring the C++ code and using JNI especially as the components currently written in C++ are scheduled to be replaced with Java components in <em>a</em> foreseeable future. </p>

<p>The component which is currently implemented in Java is actually a subcomponent of a larger component. Therefore when the larger/wrapping component wishes to use the subcomponent (being refactored into a service) it simply calls intra-process Java methods. If I refactor that subcomponent into a separate service the original wrapping component will lose the benefit it currently has of in process method invocation.</p>

<p>Should I then add a thread to the original/wrapping component to act as the service gateway or should I completely refactor out the code into a standalone service.</p>

<p>I hope that I have been sufficiently clear...</p>
","<java><refactoring><service><soa>","0","64","2009-07-14 06:43:01"
"1127098","Mass change datatype and rename of dependent store procedure variables","<p>I am in the process of optimising my database and I was thinking of changing the datatype for some columns from DATETIME to SMALLDATETIME on my tables.</p>

<p>Is there a system stored procedure that returns both the contents/code of a store procedure and the dependent table which will then allow me to do a join on a filtered list of tables?</p>

<p>Cheers!</p>

<p>EDIT1:</p>

<p>Im looking to programatically rename the stored procedures not track dependencies!</p>
","<sql-server><sql-server-2005><metadata><rename><refactoring-databases>","1","583","2009-07-14 18:20:55"
"1132206","Ideas to improve/enrich a WebForms application by adding ASP.NET MVC elements to it","<p>I'm currently present with the following situation.</p>

<p>We have a huge enterprise application written with WebForms. Refactoring it or completely rewriting it is out of the question. So I'm not talking about migration WebForms -> MVC.</p>

<p>However, I understand one can technically add MVC functionality to coexist with the rest of the project. I was asked to present MVC concepts for a team so that we can consider how it could become (or not) of use to us.</p>

<p>After careful thinking I do not see any ways or reasons to add MVC elements to a WebForms project since it will become a strange breed then.</p>

<p>Maybe there are certain not exactly obvious possibilities to add value to a WebForms project with MVC framework? Has anybody thought about it?</p>
","<asp.net><asp.net-mvc><refactoring>","3","129","2009-07-15 15:40:50"
"1135022","How to refactor these overloaded class constructors? (C#)","<p>I don't want to replicate code across overloaded constructors as below. How do I refactor it?</p>

<pre><code>/// &lt;summary&gt;
/// Represents a pseudo-random number generator, a device that
/// produces a sequence of numbers that are normally distributed.
/// &lt;/summary&gt;
public class NormalDeviate : UniformDeviate
{
    double mean;
    double standardDeviation;
    double storedValue = 0d;

    /// &lt;summary&gt;
    /// Initializes a new instance of the &lt;see cref=""NormalDeviate""/&gt; class.
    /// &lt;/summary&gt;
    /// &lt;param name=""mean""&gt;The mean.&lt;/param&gt;
    /// &lt;param name=""standardDeviation""&gt;The standard deviation.&lt;/param&gt;
    /// &lt;param name=""seed""&gt;The seed.&lt;/param&gt;
    public NormalDeviate(double mean, double standardDeviation, ulong seed)
        : base(seed)
    {
        this.mean = mean;
        this.standardDeviation = standardDeviation;
    }

    /// &lt;summary&gt;
    /// Initializes a new instance of the &lt;see cref=""NormalDeviate""/&gt; class.
    /// &lt;/summary&gt;
    /// &lt;param name=""mean""&gt;The mean.&lt;/param&gt;
    /// &lt;param name=""standardDeviation""&gt;The standard deviation.&lt;/param&gt;
    public NormalDeviate(double mean, double standardDeviation)
        : base()
    {
        this.mean = mean;
        this.standardDeviation = standardDeviation;
    }
}
</code></pre>
","<c#><.net><refactoring>","2","307","2009-07-16 01:41:12"
"1134231","SQL Refactoring - Unique Names to UniqueIdentifiers","<p>I am in the midst of refactoring my database to support an upgrade to our web-based tool.</p>

<p>Imagine that I have four tables: Milestones, Categories, Skills, and PayRates.  Under the old schema, each of these tables only listed a name, and that name was the key for the table.</p>

<p>Under the new schema, each table has not only a name, but also a generated uniqueidentifier that serves as the key for the table.</p>

<p>Now, also imagine that I have a table Tasks, where each Task consists of a name, a Milestone, a Category, a Skill, and a PayRate, and each of these is selected from their respective tables.  Under the old schema, this table only stored names.  Under the new schema, this table will store the IDs for the four tables instead of the names, like the following:</p>

<pre>
TaskID  TaskName  MilestoneID  CategoryID  SkillID  RateID
</pre>

<p>where TaskID is a generated uniqueidentifier for that Task.</p>

<p>Each of these tables currently contains data that needs to be transferred from the old schema to the new schema.  I can assume that names of each of the four components of Tasks, and the names of Tasks themselves, are unique in the old schema.</p>

<p>My question is, what is the simplest query to move the data from the old schema into the new one?</p>

<p>This is being done to support storing two separate lists of Milestones, Tasks, etc. in the same database.</p>
","<sql><refactoring>","0","80","2009-07-15 21:37:22"
"1138139","How to make Visual Studio perform refactoring on views/pages as well?","<p>Suppose I have a model and a view that display this model properties.</p>

<pre><code>public class UserModel
{
    public string UserName { get; set; }
    .................
}
</code></pre>

<p>somewhere in a view...</p>

<pre><code>&lt;%= Model.UserName %&gt;
</code></pre>

<p>Now I rename one of the properties (say, UserName => FullUserName), VS will suggest to perform refactoring meaning project-wide renaming of references to this property. It will really work everywhere in code except in the views.</p>

<p>Why? There is a setting to have the views compiled at the project build. Why won't it perform simple little refactoring there as well?</p>

<p>Is there any way to persuade it to?</p>
","<asp.net-mvc><visual-studio><refactoring>","4","90","2009-07-16 14:45:42"
"1137480","(Visual) C++ project dependency analysis","<p>I have a few large projects I am working on in my new place of work, which have a complicated set of statically linked library dependencies between them.  </p>

<p>The libs number around 40-50 and it's really hard to determine what the structure was initially meant to be, there isn't clear documentation on the full dependency map.</p>

<p>What tools would anyone recommend to extract such data?  </p>

<p>Presumably, in the simplest manner, if did the following:</p>

<ol>
<li><p>define the set of paths which correspond to library units</p></li>
<li><p>set all .cpp/.h files within those to belong to those compilation units</p></li>
<li><p>capture the 1st order #include dependency tree </p></li>
</ol>

<p>One would have enough information to compose a map - refactor - and recompose the map, until one has created some order.</p>

<p>I note that <a href=""http://www.ndepend.com"">http://www.ndepend.com</a> have something nice but that's exclusively .NET unfortunately.</p>

<p>I read something about Doxygen being able accomplish some static dependency analysis with configuration; has anyone ever pressed it into service to accomplish such a task?</p>
","<c++><visual-c++><refactoring>","7","2592","2009-07-16 13:12:39"
"1140509","How to Find All Callers of a Function in C++?","<p>I'm refactoring some code in C++, and I want to deprecate some old methods. My current method for finding all of the methods looks like this:</p>

<ol>
<li>Comment out the original method in the source file in which I'm working.</li>
<li>Try to compile the code.</li>
<li>If a compiler error is found, then make a note comment out the call and try to recompile.</li>
<li>Once the compile has completed successfully, I've found all of the calls.</li>
</ol>

<p>This totally sucks. I've also tried grepping source for the name of the function calls, but I sometimes run into problems with functions of the same name with different arguments, so my compilation makes the C++ compiler resolve the names for me. I've found <a href=""http://stackoverflow.com/questions/171970/how-can-i-find-the-method-that-called-the-current-method"">this question</a> for C#, but my code base is entirely implemented in C++. </p>

<p>Is there a better way to find all of the callers of a class method or function in C++? I'm using GCC on Unix systems, but cross-platform solutions would be superlative. </p>
","<c++><c><tools><refactoring><function>","6","2055","2009-07-16 21:46:05"
"1140527","Design Pattern for building an object from a more complex object","<p>I'm in the middle of refactoring some code on my current project, and I'd like some input on if any design pattern exists for the following scenario.</p>

<p>I have a class which executes some logic and returns an object containing the results of said logic; Let's call this the Result object.  The state information contained in the Result object is constructed based on a more complex object, the Intermediary object.  </p>

<p>Now the code which populates the Result object from the Intermediary object already exists, but since I'm refactoring I want to make this cleaner.  I was thinking of creating a separate class, maybe called ResultBuilder, which has a static execute method which takes Intermediary as input and spits out Result as output.</p>

<p>Is there a design pattern which is equivalent to the ""ResultBuilder"" class?  Is there a better way of going about constructing a Result object from an Intermediary object?</p>
","<java><design-patterns><refactoring>","2","303","2009-07-16 21:49:50"
"1142388","Better way to extract phone number and reformat?","<p>Phone number data in various formats (I've chosen these because the data coming in is unreliable and not in expected formats):</p>

<pre><code>+1 480-874-4666
404-581-4000
(805) 682-4726
978-851-7321, Ext 2606
413- 658-1100
(513) 287-7000,Toll Free (800) 733-2077
1 (813) 274-8130
212-363-3200,Media Relations: 212-668-2251.
323/221-2164
</code></pre>

<p>My Ruby code to extract all the digits, remove any leading 1's for the USA country code, then use the first 10 digits to create the ""new"" phone number in a format desired:</p>

<pre><code>  nums = phone_number_string.scan(/[0-9]+/)
  if nums.size &gt; 0
    all_nums = nums.join
    all_nums = all_nums[0..0] == ""1"" ? all_nums[1..-1] : all_nums
    if all_nums.size &gt;= 10
      ten_nums = all_nums[0..9]
      final_phone = ""#{ten_nums[0..2]}-#{ten_nums[3..5]}-#{ten_nums[6..9]}""
    else
      final_phone = """"
    end
    puts ""#{final_phone}""
  else
    puts ""No number to fix.""
  end
</code></pre>

<p>The results are <strong>very good</strong>!</p>

<pre><code>480-874-4666
404-581-4000
805-682-4726
978-851-7321
413-658-1100
513-287-7000
813-274-8130
212-363-3200
323-221-2164
</code></pre>

<p><strong>But, I think there's a better way. Can you refactor this to be more efficient, more legible, or more useful?</strong></p>
","<ruby><refactoring><refactor-my-code>","1","901","2009-07-17 10:01:35"
"1141858","How do I refactor repetitive SQL update queries?","<p>I have 3 tables. </p>

<pre><code>1. Users 4 Cols
UserID - User - RealName - Flags

2. UsersGroups 2 Cols
UserID - GroupID

3. Groups 3 Cols
GroupID - Group - Flags
</code></pre>

<p>and I want to set the flags on the <code>User</code> table for <code>User = 'Administrator'</code> and apply the same to the <code>Group</code> table.</p>

<p>I have the following SQL that works, but I also have several flags that I have to apply using bitwise operators.</p>

<p>I've found my code to be really repetitive, so was wondering if anyone could suggest some refactoring that would not affect the performance.</p>

<p>Code:</p>

<pre><code>--- SET FLAG 1  	
UPDATE User
SET User.Flags = User.Flags | 2048
WHERE User.Value = 'Administrator'

UPDATE dbo.Group
SET dbo.Group.Flags = 
    (Select e.Flags FROM dbo.User p INNER JOIN dbo.UserInGroup pe ON p.UserID = pe.UserID
    INNER JOIN dbo.Group e ON e.GroupID = pe.GroupID
    WHERE p.Value = 'Administrator') | 2048

FROM dbo.User p INNER JOIN dbo.UserInGroup pe ON p.UserID = pe.UserID
INNER JOIN dbo.Group e ON e.GroupID = pe.GroupID
WHERE p.Value = 'Administrator'

-- SET FLAG 2   	
UPDATE User
SET User.Flags = User.Flags | 512
WHERE User.Value = 'Administrator'

UPDATE dbo.Group
SET dbo.Group.Flags = 
    (Select e.Flags FROM dbo.User p INNER JOIN dbo.UserInGroup pe ON p.UserID = pe.UserID
    INNER JOIN dbo.Group e ON e.GroupID = pe.GroupID
    WHERE p.Value = 'Administrator') | 512

FROM dbo.User p INNER JOIN dbo.UserInGroup pe ON p.UserID = pe.UserID
INNER JOIN dbo.Group e ON e.GroupID = pe.GroupID
WHERE p.Value = 'Administrator'
</code></pre>
","<sql><sql-server><tsql><refactoring>","0","228","2009-07-17 07:35:35"
"1143586","In Need of Refactoring in Order to Improve Testability","<p>I'm testing a simple DAO layer with mockito but I found a problem, basically a hard to test interface and I was wondering if you could give me some insight...</p>

<p>This is the method I want to test:</p>

<pre><code>public Person getById(UserId id) {
    final Person person = new PersonImpl();

    gateway.executeQuery(GET_SQL + id.getUserId(), new ResultSetCommand(){
      public int work(ResultSet rs) throws SQLException {
        if(rs.next()){
          person.getName().setGivenName(rs.getString(""name""));
          person.getName().setFamilyName(rs.getString(""last_name""));
        }
        return 0;
      }
    });
    return person;
  }
</code></pre>

<p>I use a DatabaseGateway that is my interface between java code and SQL, and that method accepts an anonymous class, this is the method executeQuery of the gateway:</p>

<pre><code> public int executeQuery(String sql, ResultSetCommand cmd) {
    try{
      Connection cn =  createConnection();
      PreparedStatement st = cn.prepareStatement(sql);
      int result = cmd.work(st.executeQuery());
      cn.close();
      return result;
    }catch(Exception e){
      throw new RuntimeException(""Cannot Create Statement for sql "" + sql,e);
    }
  }
</code></pre>

<p>The thing is that, because of that anonymous class, It's getting harder to test PersonDAO.</p>

<p>I can refactor the whole code, even remove the anonymous class if someone suggest a better design (I'm sure there's a simpler one, but I just can't seem to find it).</p>

<p>Thanks everyone for the suggestions.</p>

<p>PD: if you need further information, feel free to ask</p>

<p><hr /></p>

<p><strong>EDIT: Test that's hard to do</strong></p>

<pre><code>public void testGetPersonById(){
    DatabaseGateway gateway = mock(DatabaseGateway.class);
    when(gateway.executeQuery(anyString(),any(ResultSetCommand.class)));
    PersonDAO person_dao = new PersonDAOImpl(gateway);

    Person p = person_dao.getById(new UserId(Type.viewer,""100""));
  }
</code></pre>

<p>See? ResultCommand is part of the mock, and I'm interested in testing that code too... should I do a separate test for that specific command?</p>
","<java><unit-testing><design><refactoring><mocking>","1","245","2009-07-17 14:18:06"
"1144543","jQuery table row builder","<p>There is a maintanble approach to build DOM with jQuery? 
Take a look at the append method of this code...</p>

<pre><code>$.getJSON(""api/test"", function(data) {
    $.each(data, function () {
        $(""#tests"").append($('&lt;tr&gt;&lt;td&gt;&lt;input type=""radio"" name=""' + this[""name""] + '""/&gt;&lt;td&gt;' + this[""name""] + '&lt;/td&gt;&lt;td&gt;' + this[""descr""] + '&lt;/td&gt;&lt;/tr&gt;'));
    });
});
</code></pre>

<p>I think (or at least I hope) there's a better way. Can you refactor this to be more legible?</p>
","<jquery><refactoring>","0","1247","2009-07-17 17:05:45"
"1147307","NetBeans refactoring Hibernate mapping files","<p>When I do a refactoring such as renaming a field in netbeans, the hibernate mapping files are updated accordingly.
This could have bean a good thing if the whole files were not completely reformatted. So I would rather not have this feature.
Is there a way to disallow the modification of hibernate mapping files by netbeans?</p>
","<hibernate><netbeans><refactoring>","2","425","2009-07-18 11:22:41"
"1151050","Clean up repetitive setup and cleanup Java(JDBC) code","<p>I've too many methods that repeatedly do something like</p>

<pre><code>Statement stmt = null;
ResultSet rstmt = null;
try {
    stmt = conn.createStatement();
    rstmt = stmt.executeQuery(...);
    while (rstmt.next()) {
    	//handle rows
    }


} catch (SQLException e) {
    //handle errors

} finally {
    try {rstmt.close();} catch (SQLException ex) {}
    try {stmt.close();} catch (SQLException ex) {}
}
</code></pre>

<p>This setup/teardown/cleanup of statements and resultsets is repetive and hides the interesting pieces of code.</p>

<p>Is there any pattern or idiom for handling this(without introducing any external framework) ?</p>
","<java><jdbc><refactoring>","5","784","2009-07-19 22:26:17"
"1153265","How to make Ruby's N ends look better?","<p>As I write some scripts, I usually reach a point where my code looks like this :</p>

<pre><code>          end
        end
      end
    end
  end
end
</code></pre>

<p>I don't know about you, but this look very ugly to me. Can something be done about this?</p>
","<ruby><syntax><refactoring><coding-style>","2","222","2009-07-20 12:21:40"
"1155947","Extract Method with continue","<p>We're refactoring a long method; it contains a long <code>for</code> loop with many <code>continue</code> statements.  I'd like to just use the <strong>Extract Method</strong> refactoring, but Eclipse's automated one doesn't know how to handle the conditional branching.  I don't, either.</p>

<p>Our current strategy is to introduce a <code>keepGoing</code> flag (an instance variable since we're going to want to <strong>extract method</strong>), set it to false at the top of the loop, and replace every continue with setting the flag to true, then wrapping all the following stuff (at different nesting levels) inside an <code>if (keepGoing)</code> clause.  Then perform the various extractions, then replace the <code>keepGoing</code> assignments with early returns from the extracted methods, then get rid of the flag.</p>

<p>Is there a better way?</p>

<p><strong>Update</strong>: In response to comments - I can't share the code, but here's an anonymized excerpt:</p>

<pre><code>private static void foo(C1 a, C2 b, C3 c, List&lt;C2&gt; list, boolean flag1) throws Exception {
	for (int i = 0; i &lt; 1; i++) {
		C4 d = null;
		Integer e = null;
		boolean flag2 = false;
		boolean flag3 = findFlag3(a, c);
		blahblahblah();
		if (e == null) {
			if (flag1) {
				if (test1(c)) {
					if (test2(a, c)) {
						Integer f = getF1(b, c);
						if (f != null)
							e = getE1(a, f);
						if (e == null) {
							if (d == null) {
								list.add(b);
								continue;
							}
							e = findE(d);
						}
					} else {
						Integer f = getF2(b, c);
						if (f != null)
							e = getE2(a, f);
						if (e == null) {
							if (d == null) {
								list.add(b);
								continue;
							}
							e = findE(d);
						}
						flag2 = true;
					}
				} else {
					if (test3(a, c)) {
						Integer f = getF2(b, c);
						if (f != null)
							e = getE2(a, f);
						if (e == null) {
							if (d == null) {
								list.add(b);
								continue;
							}
							e = findE(d);
						}
						flag2 = true;
					} else {
						if (d == null) {
							list.add(b);
							continue;
						}
						e = findE(d);
						flag2 = true;
					}
				}
			}
			if (!flag1) {
				if (d == null) {
					list.add(b);
					continue;
				}
				e = findE(d);
			}
		}
		if (e == null) {
			list.add(b);
			continue;
		}
		List&lt;C2&gt; list2 = blahblahblah(b, list, flag1);
		if (list2.size() != 0 &amp;&amp; flag1) {
			blahblahblah();
			if (!otherTest()) {
				if (yetAnotherTest()) {
					list.add(b);
					continue;
				}
				blahblahblah();
			}
		}
	}
}
</code></pre>
","<java><refactoring>","2","317","2009-07-20 21:04:20"
"1160132","refactor help - strategy pattern","<p>The object here is to update the UI. I normally do this on the client however this application uses the code behind. Anyways my question is I am trying to clean up these if else statements and I thought the strategy pattern may be appropriate. I don't need everything done for me but if you could give me a couple pointers to get going. Do I create an interface first and then each strategy implement the interface? Are generics helpful here? What types of methods should be in the interface? Any thing to get me going would be very much appreciated.</p>

<pre><code>if (someObject.Status == 'A') {
                    btnRecordCall.Enabled = false;
                    btnAddMailOrStatusAction.Enabled = false;
                    btnPayments.Enabled = false;
                    btnAddressMaint.Enabled = false;
                    btnFilter.Enabled = false;
                    btnAddCoverage.Enabled = false;
                    btnPolicyForms.Enabled = false;
                    lblIsArchived.Text = ""********** THIS CLAIM HAS BEEN ARCHIVED **********"";
                } else if (someObject.Status == 'D') {
                    btnRecordCall.Enabled = false;
                    btnAddMailOrStatusAction.Enabled = false;
                    btnPayments.Enabled = false;
                    btnAddressMaint.Enabled = false;
                    btnFilter.Enabled = false;
                    btnAddCoverage.Enabled = false;
                    btnPolicyForms.Enabled = false;
                    lblIsArchived.Text = ""- De-archive Request Pending"";
                } else {
                    btnRecordCall.Enabled = true;
                    btnAddMailOrStatusAction.Enabled = true;
                    btnPayments.Enabled = true;
                    btnAddressMaint.Enabled = true;
                    btnFilter.Enabled = true;
                    btnAddCoverage.Enabled = true;
                    btnPolicyForms.Enabled = true;
                    lblIsArchived.Text = """";
                }
</code></pre>

<p>Thanks,
~ck</p>
","<design-patterns><refactoring><strategy-pattern>","2","371","2009-07-21 15:56:36"
"1160857","What is the worst code you've had to refactor, and how did you deal with it?","<blockquote>
  <p><strong>Possible Duplicates:</strong><br />
  <a href=""http://stackoverflow.com/questions/268119/whats-the-worst-piece-of-code-you-have-come-across"">Whats the worst piece of code you have come across?</a><br />
  <a href=""http://stackoverflow.com/questions/466058/examples-of-some-of-the-worst-code-youve-had-to-manage"">Examples of some of the worst code you&rsquo;ve had to manage?</a>  </p>
</blockquote>

<p><a href=""http://stackoverflow.com/users/recent/12943"">This</a> mess reminded of some of the stuff I've had to work on.  I was wondering if anyone else had nasty refactoring war stories and especially if you found unique or helpful solutions.</p>
","<refactoring>","3","647","2009-07-21 18:24:15"
"1162967","What do YOU use ReSharper for?","<p>I'm in the middle of an ASP.NET MVC project and recently installed the free trial of ReSharper 4.5. Immediately I realized the benefits, simply because of the refactoring it wanted me to do.</p>

<p>Things like inverting if statements to reduce nesting, changing some of my if/else statements that were returning Views to ?/?? operators - drastically reduced the number of lines of code in my app.</p>

<p>The capability of performing a null reference check from a single click, removing unused directives/variables or removing redundant code (calling .ToString() when it wasn't necessary). Or, that it can see into my views to let me know I'm accessing a property that no longer exists, makes solution-wide renames more thorough... really saves a lot of time.</p>

<p><strong><em>But I get the feeling that I'm only seeing the tip of the iceberg.</em></strong> So I ask this:</p>

<p>What do <strong>YOU</strong> use ReSharper for? Anything beyond the immediate benefits I described above?</p>
","<asp.net-mvc><refactoring><automation><resharper>","8","1490","2009-07-22 03:46:48"
"1164650","How to update all C/C++ identifier names in a project","<p>After frequently coming across recommendation not to use leading and double underscores in C/C++ identifiers I decided to fix all our sources once and for all. What I need to do now is convert <code>_Identifier</code> to <code>Identifier_</code>.</p>

<p>Should I use a specialized tool for this task of regular expressions will do for this job? In latter case what is the pattern to match C/C++ identifier?</p>
","<c++><c><regex><refactoring>","4","559","2009-07-22 11:32:19"
"1166664","How do I change and/or move a class that has been serialized?","<p>I've got a class in my project and I want to move and rename that class to somewhere else in the project's namespace. I tried simply moving it, but then the program won't deserialize any settings saved under <code>Properties.Settings.Default</code> for that setting. Is there a way I can move it without losing all of the user's settings?</p>
","<c#><serialization><refactoring><settings>","1","86","2009-07-22 16:55:42"
"1168195","avoid type repetition in class member initializer?","<p>Is there any way to avoid the repetition of the type in this kind of declaration of a class member?</p>

<pre><code>Dictionary&lt;string, int&gt; myDict = new Dictionary&lt;string, int&gt;();
</code></pre>
","<c#><refactoring>","1","105","2009-07-22 20:56:27"
"1172040","What is the most elegant way to implement GetTextAfterMarker()","<p>Here is another old function I have from my C# 1 days, what would be a more elegant way to write it:</p>

<pre><code>//method: gets the text in a string in front of a marker, if marker is not there, then return empty string
//example: GetTextAfterMarker(""documents/jan/letter043.doc"",""/"") returns ""documents""
//example: GetTextAfterMarker(""letter043.doc"",""/"") returns """"
//rank:8
public static string GetTextAfterMarker(string line, string marker)  {
    string r = """";

    int pos = line.IndexOf(marker);
    if(pos != -1) {
        r = line.Substring(pos+(marker.Length),line.Length-pos-(marker.Length));
    } else {
        r = """";
    }

    return r;
}
</code></pre>
","<c#><string><refactoring>","0","78","2009-07-23 14:10:51"
"1172216","How can I refactor this C# code using Split()?","<p>How can I refactor this so that <strong>numberOfItems</strong> doesn't have to be declared as a variable?</p>

<pre><code>//method: gets the text in a string in front of a marker, if marker is not there, then return empty string
//example: GetTextAfterMarker(""documents/jan/letter043.doc"",""/"") returns ""letter043.doc""
//example: GetTextAfterMarker(""letter043.doc"",""/"") returns """"
//example: GetTextAfterMarker(""letter043.doc"",""."") returns ""doc""
public static string GetTextAfterMarker(string line, string marker)
{
    int numberOfItems = line.Split(new string[] { marker }, StringSplitOptions.None).Count();

    string result = line.Split(new string[] { marker }, StringSplitOptions.None)[numberOfItems-1];
    return line.Equals(result) ? string.Empty : result;
}
</code></pre>
","<c#><string><refactoring>","0","307","2009-07-23 14:37:21"
"1172611","Open Sourcing a Framework: Ok, I bought the concept, now what?","<p>(Note to moderators: I did my homework, and I know <a href=""http://stackoverflow.com/questions/411180/what-is-involved-in-open-sourcing-proprietary-software"">there is a very similar question</a>, I'm putting on a different perspective. Please be somewhat more lenient to me. Yes, I'm asking for forgiveness not permission :])</p>

<p>In the past year, I wrote an application in order to deliver as my grad thesis. Its fine, and it works with some interesting aspects long forgotten in Web Applications (like chains or responsibility) for a very interesting environment (<a href=""http://www.projectzero.org/"" rel=""nofollow"">IBM's ProjectZero</a>).</p>

<p>That said, I am just not willing to let this code rot. As such, I am planning to work on it and release as an open source framework. The application in itself is very specific and its likely to benefit from the fork, but I'd like to tailor it for a more general audience, so its best to fork the framework and let the application alone (for a while).</p>

<p>Although this one looks fine in theory, I'd like to ask you to help me with the big picture: Which aspects/milestones/tasks would you consider in order to fork a given codebase into a self-contained framework?</p>

<p>Is there any link and/or ideas? Consider there are mainly three aspects:
 - Legal Aspects (licenses for each dependency, et al);
 - Community Aspects (its interesting to gather and keep a community around it);
 - Code Aspects (writing tests, rewriting docs, things like that)</p>

<p>Thank you.</p>
","<open-source><refactoring><publishing><guidelines><codebase>","1","56","2009-07-23 15:30:52"
"1173143","PHP Refactoring Tools","<p>I find it amazing how difficult it is to find a decent refactoring tool for PHP.</p>

<p>What do you guys use (and how can I get it)?</p>

<p>Thanks!!</p>

<p><strong>Edit:</strong> I'm on Linux but Windows suggestions would help the Googlers</p>
","<php><refactoring>","4","474","2009-07-23 17:01:58"
"1174573","How to refactor a class with overloaded constructors","<p>I have a class with overloaded constructor (C#) It can be initialized in few ways, and some parameters are optional - so in result - there is a confusing bunch of constructors</p>

<pre><code>new Object(StrA, StrB, ObjA)
new Object(StrA, StgB, ObjB, StrC)
new Object(StrA, StrB, ObjA, StrD)
new Object(StrA, StrB, ObjB, StrC, StrD)
new Object(StrA, StrB, StrE, ObjA)
new Object(StrA, StrB, StrE, ObjB)
new Object(StrA, StrB, StrE, ObjA, StrC)
new Object(StrA, StrB, StrE, ObjB, StrC, StrD)
</code></pre>

<p>I see a two ways to improve situation 
a) create a structure to hold optional parameters</p>

<pre><code>new Config(StrA, StrB, StrD, StrE) 
new Object(Config, ObjA)
new Object(Config, ObjB, StrC)
</code></pre>

<p>b) set optional parameters as properties</p>

<pre><code>A = new Object(ObjA)
A.StrA = some;
A.StrB = some;
A.StrD = some;
A.StrE = some;
</code></pre>

<p>Which is the best way? </p>

<p>And is such code refactoring necessary - the previous code maintainer says that ""while intellisense used, complexity of constructor doesn't matter - it always possible to check tips and select the correct one""</p>
","<c#><.net><refactoring><constructor>","3","539","2009-07-23 21:23:45"
"1175481","What are some class names that would signal a need for refactoring?","<p>I came across a few articles like <a href=""http://www.bright-green.com/blog/2003%5F02%5F25/naming%5Fjava%5Fclasses%5Fwithout%5Fa.html"" rel=""nofollow"">this one</a>, which suggest that some words should never be used as part of a class name. When a class has one of those words in the name, it means the code should be refactored or redesigned.</p>

<p>Example:</p>

<p><strong>Manager</strong></p>

<p>Reason: Since almost all classes ""manage"" something and the meaning of ""Manager"" is very broad, people can put a lot of responsibilities to a ""Manager"" class while still being able to claim the class does ""only one thing"". As a result, naming a class with ""Manager"" does not say much about what the class actually does. The article mentioned earlier, <a href=""http://www.bright-green.com/blog/2003%5F02%5F25/naming%5Fjava%5Fclasses%5Fwithout%5Fa.html"" rel=""nofollow"">""Naming Java Classes Without a 'Manager' ""</a>, showed this point:</p>

<blockquote>
  <p>For instance, take a class named ""UrlManager"" - you cannot tell whether it pool URLs, manipulates URLs or audits the use of them. All the name tells you is that this is not a URL, but it does somehow work with them. On the other hand, the name ""UrlBuilder"" gives a much better picture of what the class does.</p>
</blockquote>

<p>Another example:</p>

<p><strong>Helper</strong></p>

<p>Reason: A class name like ""ThreadHelper"" makes people wonder why it's needed and why it cannot just be part of the ""Thread"" class. Is it actually an adapter or a decorator? If so, name it that way. Is class ""Thread"" taking too much responsibility already? If so, refactor and give the new class a meaningful name. ""Helper"" says nothing about what it's doing or how it's helping.</p>

<p>What are other words in a class name that would signal a need for refactoring or redesign and should be avoided? Why?</p>

<p>Edit: I would think those words are used a lot since</p>

<ul>
<li>they generally have broad meanings</li>
<li>they can fit in almost all contexts</li>
<li>they stop designers thinking about better designs or names</li>
<li>people believe it's OK to use them</li>
</ul>

<p>The book <em><a href=""http://rads.stackoverflow.com/amzn/click/0132350882"" rel=""nofollow"">Clean Code</a></em> listed more but no reasons were given:</p>

<blockquote>
  <p>Avoid words like Manager, Processor, Data, or Info in the name of a class.</p>
</blockquote>

<p>It would be great if someone could provide possible reasons for them.</p>

<blockquote>
  <p>Related questions:</p>
  
  <p><a href=""http://stackoverflow.com/questions/38019/whats-the-best-approach-to-naming-classes"">What’s the best approach to naming classes?</a></p>
</blockquote>
","<design><refactoring><naming>","10","932","2009-07-24 02:24:15"
"1175043","How to refactor this Python code?","<pre><code>class MainPage(webapp.RequestHandler):
  def get(self):
    user = users.get_current_user()
    tasks_query = Task.all()
    tasks = tasks_query.fetch(1000)
    if user:
      url = users.create_logout_url(self.request.uri)
    else:
      url = users.create_login_url(self.request.uri)
    template_values = {
      'tasks': tasks,
      'url': url
      }
    path = os.path.join(os.path.dirname(__file__), 'index.html')
    self.response.out.write(template.render(path, template_values))

class Gadget(webapp.RequestHandler):
  def get(self):
    user = users.get_current_user()
    tasks_query = Task.all()
    tasks = tasks_query.fetch(1000)
    if user:
      url = users.create_logout_url(self.request.uri)
    else:
      url = users.create_login_url(self.request.uri)
    template_values = {
      'tasks': tasks,
      'url': url
      }
    path = os.path.join(os.path.dirname(__file__), 'gadget.xml')
    self.response.out.write(template.render(path, template_values))
</code></pre>
","<python><google-app-engine><refactoring>","0","479","2009-07-23 23:26:11"
"1174754","Better way to move NSView bounds with player?","<p>Currently writing a roguelike to learn more about Objective-C/Cocoa. I'm really enjoying it so far and I've learned tons. </p>

<p>This code moves the <code>origin</code> of the view's <code>bounds</code>, so that it follows the player as he moves. The code works perfect, I was just asking if there was a better way than using four <code>for</code>'s.</p>

<p>I've also seen in some cases that it's better to do things separately instead of all in one, especially where drawing and <code>nsbezierpath</code> is concerned, why is that?</p>

<p><strong>Edit</strong>: People were having trouble figuring out exactly what I'm doing, so I'm going to break it down as much as I can.</p>

<p>The <code>view</code> is a 30x30 grid (0-29,0-29) of tiles, 20x20 each. The map can be as big or small as needs to be.</p>

<p>First, you get the <code>[player_ location]</code>, along with the <code>origin</code> of the <code>bounds</code> for the <code>view</code>. It's divided by <code>20</code> because the tile size is <code>20,</code> so when it's at <code>(1,2)</code>, it's actually at <code>(20,40)</code>. The only reason I do this is to make it easier to manipulate (It's easier to count in units of 1 as opposed to 20). The four <code>for</code>'s go through and check that the <code>[player_ location]</code> is within <code>15</code> tiles of the center (<code>bounds + 15</code>) of the <code>view</code>. If the player is moving towards one of the edges of the screen, and <code>bounds.x/y + 30</code> is less than the height of the current map/width, it moves the <code>origin</code> so that the player is still centered and displayed on the map. </p>

<p>The code works perfect, and I moved the <code>setbounds</code> to after the <code>for</code>'s happen, and there's only one. It isn't being left in <code>drawRect</code>, I just had it here to try and figure out what I needed to do. It's now in it's own place and is only called when the player actually moves. </p>

<p>Here's the new code:</p>

<pre><code>- (void)keepViewCentered
{
	NSPoint pl = [player_ location];
	NSPoint ll;
	NSPoint location = [self bounds].origin;
	ll.x = location.x / 20;
	ll.y = location.y / 20;
	for ( pl.y = [player_ location].y; pl.y &gt;= ll.y + 15 &amp;&amp; ll.y + 30 &lt; [currentMap_ height]; ll.y++ )
	{
		location.y = ll.y * 20;
	}
	for ( pl.x = [player_ location].x; pl.x &gt;= ll.x + 15 &amp;&amp; ll.x + 30 &lt; [currentMap_ width]; ll.x++ )
	{
		location.x = ll.x * 20;
	}
	for ( pl.y = [player_ location].y; pl.y &lt;= ll.y + 15 &amp;&amp; ll.y &gt;= 0; ll.y-- )
	{
		location.y = ll.y * 20;
	}
	for ( pl.x = [player_ location].x; pl.x &lt;= ll.x + 15 &amp;&amp; ll.x &gt;= 0; ll.x-- )
	{
		location.x = ll.x * 20;
	}
	[self setBoundsOrigin: location];
}
</code></pre>

<p>Here are pictures of it in action!</p>

<p>Figure 1: This is the player at 1,1. Nothing special. 
<img src=""http://sneakyness.com/stackoverflow/SRLbounds1.png""></p>

<p>Figure 2: The 3 gold pieces represent how far the player can move before the view's bounds.origin will move to stay centered on the player. Although irrelevant, notice that the player cannot actually see the gold. Turns out programming field of vision is a field of much debate and there are several different algorithms you can use, none of which don't have downsides, or have been ported to Objective-C. Currently it's just a square. See through walls and everything.
<img src=""http://sneakyness.com/stackoverflow/SRLbounds2.png""></p>

<p>Figure 3: The view with a different bounds.origin, centered on the player. 
<img src=""http://sneakyness.com/stackoverflow/SRLbounds3.png""></p>
","<objective-c><cocoa><game-development><refactoring><nsview>","0","750","2009-07-23 22:03:53"
"1177861","How to approach refactoring a class? (VB.Net)","<p>I recently started a project and needed to do some integration with LDAP via DirectoryServices.  I've done this in other apps so I went into one of them to see how I did it -- why reinvent the wheel right?  Well, while this wheel works, it was developed years ago and kinda smells (it's wooden, firmly attached to the previous vehicle, hard to repair and produces a potentially bumpy ride).</p>

<p>So I thought to myself, this is the perfect time to refactor this puppy and make it more portable, reusable, reliable, easier to configure etc.  Now that's fine and dandy, but then I started feeling a tad overwhelmed regarding to where to start.  Should it be a separate library?  How should it be configured?  Should it use IoC? DI?</p>

<p>So my [admittedly subjective] question is this -- given a relatively small, but quite useful class like the one below, what is a good approach to refactoring it? What questions do you ask and how do you decide what to implement or not implement?  Where do you draw the line regarding configuration flexibility?  </p>

<p>[Note:  Please don't bash this code too much okay?  It was written a long time ago and has functioned perfectly well baked into an in house application.]</p>

<pre><code>Public Class AccessControl

Public Shared Function AuthenticateUser(ByVal id As String, ByVal password As String) As Boolean
    Dim path As String = GetUserPath(id)
    If path IsNot Nothing Then
        Dim username As String = path.Split(""/"")(3)
        Dim userRoot As DirectoryEntry = New DirectoryEntry(path, username, password, AuthenticationTypes.None)
        Try
            userRoot.RefreshCache()
            Return True
        Catch ex As Exception
            Return False
        End Try
    Else
        Return False
    End If
End Function

Private Shared Function GetUserPath(ByVal id As String) As String
    Dim root As DirectoryEntry = New DirectoryEntry(""LDAP://XXXXX/O=YYYY"", String.Empty, String.Empty, AuthenticationTypes.None)
    Dim searcher As New DirectorySearcher
    Dim results As SearchResultCollection
    Dim result As SearchResult
    Try
        With searcher
            .SearchRoot = root
            .PropertiesToLoad.Add(""cn"")
            .Filter = String.Format(""cn={0}"", id)
            results = .FindAll()
        End With
        If results.Count &gt; 0 Then
            result = results(0)
            Return result.Path.ToString()
        Else
            Return Nothing
        End If
    Catch ex As Exception
        Return Nothing
    End Try
End Function

Public Shared Function GetUserInfo(ByVal id As String) As UserInfo
    Dim root As DirectoryEntry = New DirectoryEntry(""LDAP://XXXXX/O=YYYY"", String.Empty, String.Empty, AuthenticationTypes.None)
    Dim searcher As New DirectorySearcher
    Dim results As SearchResultCollection
    Dim props() As String = {""id"", ""sn"", ""mail"", ""givenname"", ""container"", ""cn""}
    Try
        With searcher
            .SearchRoot = root
            .PropertiesToLoad.AddRange(props)
            .Filter = String.Format(""cn={0}"", id)
            results = .FindAll()
        End With
        If results.Count &gt; 0 Then
            Dim properties As PropertyCollection = results(0).GetDirectoryEntry().Properties
            Dim user As New UserInfo(properties(""id"").Value)
            user.EmailAddress = properties(""mail"").Item(0).ToString
            user.FirstName = properties(""givenname"").Item(0).ToString
            user.LastName = properties(""sn"").Item(0).ToString
            user.OfficeLocation = properties(""container"").Item(0).ToString
            Return user
        Else
            Return New UserInfo
        End If
    Catch ex As Exception
        Return Nothing
    End Try
End Function

Public Shared Function IsMemberOfGroup(ByVal id As String, ByVal group As String) As Boolean
    Dim root As DirectoryEntry = New DirectoryEntry(""LDAP://XXXXX/O=YYYY"", String.Empty, String.Empty, AuthenticationTypes.None)
    Dim searcher As New DirectorySearcher
    Dim results As SearchResultCollection
    Dim result As SearchResult
    Dim props() As String = {""cn"", ""member""}
    Try
        With searcher
            .SearchRoot = root
            .PropertiesToLoad.AddRange(props)
            .Filter = String.Format(""cn={0}"", group)
            results = .FindAll()
        End With
        If results.Count &gt; 0 Then
            For Each result In results
                Dim members As PropertyValueCollection = result.GetDirectoryEntry().Properties(""member"")
                Dim member As String
                For i As Integer = 0 To members.Count - 1
                    member = members.Item(i).ToString
                    member = member.Substring(3, member.IndexOf("","") - 3).ToLowerInvariant
                    If member.Contains(id.ToLowerInvariant) Then Return True
                Next
            Next
        End If
        Return False
    Catch ex As Exception
        Return False
    End Try
End Function

Public Shared Function GetMembersOfGroup(ByVal group As String) As List(Of String)
    Dim groupMembers As New List(Of String)
    Dim root As DirectoryEntry = New DirectoryEntry(""LDAP://XXXXX/O=YYYY"", String.Empty, String.Empty, AuthenticationTypes.None)
    Dim searcher As New DirectorySearcher
    Dim results As SearchResultCollection
    Dim result As SearchResult
    Dim props() As String = {""cn"", ""member""}
    Try
        With searcher
            .SearchRoot = root
            .PropertiesToLoad.AddRange(props)
            .Filter = String.Format(""cn={0}"", group)
            results = .FindAll()
        End With
        If results.Count &gt; 0 Then
            For Each result In results
                Dim members As PropertyValueCollection = result.GetDirectoryEntry().Properties(""member"")
                Dim member As String
                For i As Integer = 0 To members.Count - 1
                    member = members.Item(i).ToString
                    member = member.Substring(3, member.IndexOf("","") - 3).ToLowerInvariant
                    groupMembers.Add(member)
                Next
            Next
        End If
    Catch ex As Exception
        Return Nothing
    End Try
    Return groupMembers
End Function

End Class
</code></pre>

<p><strong>Clarifications:</strong><br />
- there is a separate class for user (simple poco)<br />
- there isn't a group class since all that's used right now is the list of ids, could be useful to add though</p>
","<vb.net><.net-2.0><refactoring>","3","598","2009-07-24 13:57:33"
"1178399","How do I create a Null Object in C#","<p>Martin Fowler's Refactoring discusses creating Null Objects to avoid lots of </p>

<pre><code>if (myObject == null)
</code></pre>

<p>tests. 
What is the right way to do this? My attempt violates the ""virtual member call in constructor"" rule.
Here's my attempt at it:</p>

<pre><code>    public class Animal
    {
        public virtual string Name { get; set; }
        public virtual string Species { get; set; }
        public virtual bool IsNull 
        { 
            get { return false; }
        }
    }

    public sealed class NullAnimal : Animal
    {
        public override string Name
        {
            get{ return ""NULL""; }
            set { ; }
        }
        public override string Species
        {
            get { return ""NULL""; }
            set { ; }
        }
        public override bool IsNull
        {
            get { return true; }
        }
    }
</code></pre>
","<c#><patterns><refactoring>","4","1535","2009-07-24 15:24:59"
"1179466","Refactoring Derived Classes' Methods to Common Base Class' Method? (C#)","<p>In my project I have a few functions in derived classes that are the same except for one section that is different in each.</p>

<p>I want to pull the method up to the base class.</p>

<p>The functions look like this:</p>

<pre><code>func(parameters)
{
//COMMON BITS

if      (someVar == ""value1"")  { htmlFilename = line; }
else if (someVar == ""value2"") { subVideoLink = line; }
else if (someVar == ""value3"") { linksH2HeadingWritten = true; }

//COMMON BITS
}
</code></pre>

<p>where the center lines of the different functions all look like above but have different values for ""someVar"" and different variables in the ""variable = line;"" format.</p>

<p>This is the generalized form:</p>

<pre><code>if (someVar == ""CommandName"") { variable = line; }
</code></pre>

<p>The idea I had was to send the function a <code>Dictionary&lt;string CommandName, ref string&gt;</code>...  however it seems I can't make a Dictionary with ref string in it...</p>

<p>I would then remove the boolean cases of the 'variable' by replacing them with string versions with values of ""true"" or ""false"".</p>

<p>Is there a better way to do this?</p>
","<c#><refactoring>","0","312","2009-07-24 18:48:51"
"1180846","one liner for conditionally replacing dictionary values","<p>Is there a better way to express this using list comprehension? Or any other way of expressing this in one line?</p>

<p>I want to replace each value in the original dictionary with a corresponding value in the col dictionary, or leave it unchanged if its not in the col dictionary.</p>

<pre><code>col = {'1':3.5, '6':4.7}
original = {'1':3, '2':1, '3':5, '4':2, '5':3, '6':4}
for entry in col.iteritems():
    original[entry[0]] = entry[1]
</code></pre>
","<python><refactoring><dictionary><list-comprehension>","0","342","2009-07-25 01:00:20"
"1185993","Refactoring Form to State Pattern?","<p>I want to refactor some code.</p>

<p>Basically the code I want to refactor is a Form (using System.Windows.Forms;)</p>

<p>The way it is setup now, depending on which radio button you selected it shows a different layout for the window: different labels, buttons, etc.  Not always a big difference, but different.  This is a lot of conditional statement junk all over the place.  I wanted instead to refactor it with the State pattern.  There are three main states.</p>

<p>I'm not sure the best way to do this.  Right now the IState interface has a DoAction() method which does some action particular to the unique State, and a DrawForm() method which re-draws the form  based on the current State...  However, to do the DrawForm(), the State classes need to be able to access the Form's member variables.  That's what threw me for a loop.  I didn't really want to expose them. </p>

<p>Is there a better way to do this?</p>
","<c#><design-patterns><refactoring>","2","569","2009-07-27 00:44:57"
"1185235","Callbacks in ObjC+Cocoa","<p>I'm relatively new to Cocoa/ObjC. Could someone please help me change my code to use asynchronous network calls? Currently it looks like this (fictional example):</p>

<pre><code>// Networker.m
-(AttackResult*)attack:(Charactor*)target {
    // prepare attack information to be sent to server
    ServerData *data = ...;
    id resultData = [self sendToServer:data];
    // extract and return the result of the attack as an AttackResult
}

-(MoveResult*)moveTo:(NSPoint*)point {
    // prepare move information to be sent to server
    ServerData *data = ...;
    id resultData = [self sendToServer:data];
    // extract and return the result of the movement as a MoveResult
}


-(ServerData*)sendToServer:(ServerData*)data {
    // json encoding, etc
    [NSURLConnection sendSynchronousRequest:request ...]; // (A)
    // json decoding
    // extract and return result of the action or request
}
</code></pre>

<p>Notice that for each action (attack, move, etc), the Networker class has logic to convert to and from ServerData. It is unacceptable to expect the other classes in my code to deal with this ServerData.</p>

<p><strong>I need to make line A an asynchronous call.</strong> It seems that the correct way to do this is to use [NSURLConnection connectionWithRequest:...delegate:...] implementing a callback to do the post-processing. This is the only way I can think to do it:</p>

<pre><code>//Networker.m
-(void)attack:(Charactor*)target delegate:(id)delegate {
    // prepare attack information to be sent to server
    ServerData *data = ...;
    self._currRequestType = @""ATTACK"";
    self._currRequestDelegate = delegate;
    [self sendToServer:data];
    // extract and return the result of the attack
}

-(void)moveTo:(NSPoint*)point delegate:(id)delegate {
    // prepare move information to be sent to server
    ServerData *data = ...;
    self._currRequestType = @""MOVE"";
    self._currRequestDelegate = delegate;
    [self sendToServer:data];
    // extract and return the result of the movement
}


-(void)sendToServer:(ServerData*)data {
    // json encoding, etc
    [NSURLConnection connectionWithRequest:...delegate:self] // (A)
}

- (void)connectionDidFinishLoading:(NSURLConnection *)connection {
    //json decoding, etc
    switch( self._currRequestType ) {
        case @""ATTACK"": {...} // extract and return the result of the attack in a callback
        case @""MOVE"": {...} // extract and return the result of the move in a callback
    }
}
</code></pre>

<p>However, this is very ugly and not thread safe. <strong>What is the proper way to do this?</strong></p>

<p>Thanks,</p>
","<iphone><objective-c><cocoa><events><refactoring>","1","644","2009-07-26 18:40:51"
"1186339","Large Amounts of Setup Code: Does it indicate a problem and what stratergies exist to deal with it","<p>A part of my project interacts with iTunes using COM. The goal of the test in question is to verify that my object asks the iTunes API to export all of the album artwork for a collection of tracks to a file.</p>

<p>I have successfully written a test which can prove my code is doing this, however to accomplish that I have had to stub out a chunk of the iTunes implementation, while thiis is to be expected in a unit test I am concerned at the ratio of stub setup code vs. code doing actual testing</p>

<p>My questions:</p>

<ol>
<li>Is the fact that there is more stub setup code then acting code indicitive of another underlying problem in my code></li>
<li>There is a lot of setup code and I don't believe repeating it per test is a good idea. What is the best way to refactor this code so that this setup code is seperate from, but available to other tests that need to utilise the stubs.</li>
</ol>

<p>This seams like the kind of question that might have been asked before, so I applagise in advance if I have created a duplicate</p>

<p>For reference, here is the complete unit test that I am concerned about</p>

<pre><code>[Fact]
    public void Add_AddTrackCollection_AsksiTunesToExportArtForEachTrackInCollectionToAFile()
    {
        var trackCollection = MockRepository.GenerateStub&lt;IITTrackCollection&gt;(null);
        var track = MockRepository.GenerateStub&lt;IITTrack&gt;(null);
        var artworkCollection = MockRepository.GenerateStub&lt;IITArtworkCollection&gt;(null);
        var artwork = MockRepository.GenerateMock&lt;IITArtwork&gt;(null);
        var artworkCache = new ArtworkCache();
        trackCollection.Stub&lt;IITTrackCollection, int&gt;(collection =&gt; {return collection.Count; }).Return(5);
        trackCollection.Stub&lt;IITTrackCollection, IITTrack&gt;(collection =&gt; { return trackCollection[0]; }).IgnoreArguments().Return(track);
        track.Stub&lt;IITTrack, IITArtworkCollection&gt;(stub =&gt; { return stub.Artwork; }).Return(artworkCollection);
        artworkCollection.Stub&lt;IITArtworkCollection, int&gt;(collection =&gt; { return collection.Count; }).Return(1);
        artworkCollection.Stub&lt;IITArtworkCollection, IITArtwork&gt;(collection =&gt; { return artworkCollection[0]; }).IgnoreArguments().Return(artwork);
        artwork.Expect&lt;IITArtwork&gt;(stub =&gt; { stub.SaveArtworkToFile(null); }).IgnoreArguments().Repeat.Times(trackCollection.Count-1);
        artwork.Replay();
        artworkCache.Add(trackCollection);
        artwork.VerifyAllExpectations();

        //refactor all the iTunes fake-out that isn't specific to this test into it's own method and call that from ctor.
</code></pre>
","<unit-testing><refactoring>","3","121","2009-07-27 03:52:57"
"1190105","Good examples when teaching refactoring?","<p>I'm running a refactoring code dojo for some coworkers who asked how refactoring and patterns go together, and I need a sample code base.  Anyone know of a good starting point that isn't to horrible they can't make heads or tails of the code, but can rewrite their way to something useful?</p>
","<refactoring>","11","1074","2009-07-27 19:23:57"
"1194709","Refactoring C++ in Eclipse CDT","<p>I've installed the Galileo release (Eclipse 3.5/CDT 5.1) in hopes of utilizing the better refactoring support mentioned in </p>

<p><a href=""http://stackoverflow.com/questions/130913/what-is-the-state-of-c-refactor-support-in-eclipse"">http://stackoverflow.com/questions/130913/what-is-the-state-of-c-refactor-support-in-eclipse</a> </p>

<p>However I do not see all the mentioned refactoring options listed.  I don't see any plug-ins related to refactoring on </p>

<p><a href=""http://download.eclipse.org/tools/cdt/releases/galileo"">http://download.eclipse.org/tools/cdt/releases/galileo</a></p>

<p>Attempts to add the plugin directly from the refactoring site fails <a href=""http://ifs.hsr.ch/cdtrefactoring/updatesite/"">http://ifs.hsr.ch/cdtrefactoring/updatesite/</a> due to outdated dependencies, so I'm assuming the newest release should have the latest refactoring abilities.</p>

<p>Am I correct in this?</p>

<p>How do others refactor in Eclipse CDT?  Do people use other tools/plugins?</p>
","<c++><refactoring><eclipse-cdt>","8","2613","2009-07-28 14:58:34"
"1194993","What is this RegEx statement doing?","<p>I don't claim to be a RegEx guru at all, and I am a bit confused on what this statement is doing. I am trying to refactor and this is being called on a key press and eating a lot of CPU.</p>

<pre><code>Regex.Replace(_textBox.Text, ""(?&lt;!\r)\n"", Environment.NewLine);
</code></pre>

<p>Thanks.</p>
","<c#><.net><regex><refactoring>","0","121","2009-07-28 15:44:46"
"1195331","How to find a mentor/code reviewer for freelancer?","<p>About 6 moths ago I switched to fulltime <b>freelance</b> job. Before that I worked in enterprise environment with highly professional craftsmen :)</p>

<p>I'm striving in improving my skills in Object Oriented Design and software architecture.</p>

<p>I read lots of books about <b>OOD</b>, <b>T.D.D</b>., <b>patterns</b>(implementation, design, architectural).
I like to research interesting open-source projects with beautiful design.</p>

<p>The only problem I have is that I don't have enough feedback on my code.</p>

<p>Recently I've started to participating in some small <b>Open source</b> <a href=""http://pear.php.net/"" rel=""nofollow"">PEAR</a> project, my patches were accepted, but I don't think it is very quality/useful feedback.</p>

<p>I'm not a fun of <a href=""http://refactormycode.com/"" rel=""nofollow"">http://refactormycode.com/</a> because it can be useful only for implementation patterns or some small refactorings, which is not what I mostly need.</p>

<p>My ideas:</p>

<ul>
<li>choose very hard task at some open source project, so it won't be so easy for your patches to be accepted.</li>
<li>Take my laptop and go to familiar developers, which I appreciate in that desired area to ask what they about my code.</li>
</ul>

<p>What do you think about it?</p>

<p>What should I do to solve this problem?</p>
","<open-source><oop><refactoring><code-review><code-analysis>","2","189","2009-07-28 16:47:35"
"1204438","How can I make this massive Ruby if/elsif statement more compact and cleaner?","<p>The following if/elsif statement is clearly a behemoth. The purpose of it is to change the phrasing of some text based on if certain data has been filled in by the user. I feel like there's got to be a better way to do this without taking up 30+ lines of code, but I'm just not sure how since I'm trying to customize the text pretty significantly based on the data available.</p>

<pre><code>if !birthdate.blank? &amp;&amp; !location.blank? &amp;&amp; !joined.blank? &amp;&amp; !death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born on #{birthdate.strftime(""%A, %B %e, %Y"")} in #{location}. #{sex} passed away on #{death.strftime(""%B %e, %Y"")} at the age of #{calculate_age(birthdate, death)}. #{sex} was a member of #{link_to user.login, profile_path(user.permalink)}'s family for #{distance_of_time_in_words(joined,death)}.&lt;/p&gt;""
elsif !birthdate.blank? &amp;&amp; !location.blank? &amp;&amp; !joined.blank? &amp;&amp; death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born on #{birthdate.strftime(""%A, %B %e, %Y"")} in #{location} and is #{time_ago_in_words(birthdate)} old. #{sex} has been a member of #{link_to user.login, profile_path(user.permalink)}'s family for #{time_ago_in_words(joined)}.&lt;/p&gt;""
elsif birthdate.blank? &amp;&amp; !location.blank? &amp;&amp; !joined.blank? &amp;&amp; !death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born in #{location}. #{sex} passed away on #{death.strftime(""%B %e, %Y"")}. #{sex} was a member of #{link_to user.login, profile_path(user.permalink)}'s family for #{distance_of_time_in_words(joined,death)}.&lt;/p&gt;""
elsif birthdate.blank? &amp;&amp; !location.blank? &amp;&amp; !joined.blank? &amp;&amp; death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born in #{location}. #{sex} has been a member of #{link_to user.login, profile_path(user.permalink)}'s family for #{time_ago_in_words(joined)}.&lt;/p&gt;""
elsif birthdate.blank? &amp;&amp; location.blank? &amp;&amp; !joined.blank? &amp;&amp; !death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was a member of #{link_to user.login, profile_path(user.permalink)}'s family for #{distance_of_time_in_words(joined,death)}. #{sex} passed away on #{death.strftime(""%B %e, %Y"")}.&lt;/p&gt;""
elsif birthdate.blank? &amp;&amp; location.blank? &amp;&amp; !joined.blank? &amp;&amp; death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} has been a member of #{link_to user.login, profile_path(user.permalink)}'s family for #{time_ago_in_words(joined)}.&lt;/p&gt;""
elsif !birthdate.blank? &amp;&amp; location.blank? &amp;&amp; !joined.blank? &amp;&amp; !death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born on #{birthdate.strftime(""%A, %B %e, %Y"")}. #{sex} passed away on #{death.strftime(""%B %e, %Y"")} at the age of #{calculate_age(birthdate, death)}. #{sex} was a member of #{link_to user.login, profile_path(user.permalink)}'s family for #{distance_of_time_in_words(joined,death)}.&lt;/p&gt;""
elsif !birthdate.blank? &amp;&amp; location.blank? &amp;&amp; !joined.blank? &amp;&amp; death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born on #{birthdate.strftime(""%A, %B %e, %Y"")} and is #{time_ago_in_words(birthdate)} old. #{sex} has been a member of #{link_to user.login, profile_path(user.permalink)}'s family for #{time_ago_in_words(joined)}.&lt;/p&gt;""
elsif !birthdate.blank? &amp;&amp; !location.blank? &amp;&amp; joined.blank? &amp;&amp; !death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born on #{birthdate.strftime(""%A, %B %e, %Y"")} in #{location}. #{sex} passed away on #{death.strftime(""%B %e, %Y"")} at the age of #{calculate_age(birthdate, death)}. #{sex} was a member of #{link_to user.login, profile_path(user.permalink)}'s family.&lt;/p&gt;""
elsif !birthdate.blank? &amp;&amp; !location.blank? &amp;&amp; joined.blank? &amp;&amp; death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born on #{birthdate.strftime(""%A, %B %e, %Y"")} in #{location} and is #{time_ago_in_words(birthdate)} old. #{sex} is a member of #{link_to user.login, profile_path(user.permalink)}'s family.&lt;/p&gt;""
elsif !birthdate.blank? &amp;&amp; location.blank? &amp;&amp; joined.blank? &amp;&amp; !death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born on #{birthdate.strftime(""%A, %B %e, %Y"")}. #{sex} passed away on #{death.strftime(""%B %e, %Y"")} at the age of #{calculate_age(birthdate, death)}. #{sex} was a member of #{link_to user.login, profile_path(user.permalink)}'s family.&lt;/p&gt;""
elsif !birthdate.blank? &amp;&amp; location.blank? &amp;&amp; joined.blank? &amp;&amp; death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born on #{birthdate.strftime(""%A, %B %e, %Y"")} and is #{time_ago_in_words(birthdate)} old. #{sex} is a member of #{link_to user.login, profile_path(user.permalink)}'s family.&lt;/p&gt;""
elsif birthdate.blank? &amp;&amp; !location.blank? &amp;&amp; joined.blank? &amp;&amp; !death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born in #{location}. #{sex} passed away on #{death.strftime(""%B %e, %Y"")}. #{sex} was a member of #{link_to user.login, profile_path(user.permalink)}'s family.&lt;/p&gt;""
elsif birthdate.blank? &amp;&amp; !location.blank? &amp;&amp; joined.blank? &amp;&amp; death.blank?
  ""&lt;p class='birthinfo'&gt;#{name} was born in #{location}. #{sex} is a member of #{link_to user.login, profile_path(user.permalink)}'s family.&lt;/p&gt;""
else
  ""&lt;p class='birthinfo'&gt;#{name} is a member of #{link_to user.login, profile_path(user.permalink)}'s family.&lt;/p&gt;""
end
</code></pre>
","<ruby><refactoring>","4","510","2009-07-30 04:21:57"
"1206062",".NET Code refactorings, what is your best practice?","<p>What are your .NET code-refactoring best practices?</p>
","<.net><refactoring>","1","320","2009-07-30 11:41:58"
"1207232","Find completely commented files","<p>In a solution with lots of files and projects - how would you find all completely commented files? I assume that every line of code starts with // (<strong>EDIT:</strong> or is empty) in such files.</p>

<p>I am using VS 2008, C#, ReSharper is available.<br />
I know, normally such files should not exist - that's what a source safe is for ...</p>
","<visual-studio><refactoring>","0","99","2009-07-30 15:06:26"
"1209866","What Visual Studio add-ins do you use for C++ refactoring?","<p>I have just started using Visual Assist X for C++ refactoring in Visual Studio 2008. It is quite good, but IMO, not to the same level as what ReSharper has for C#. I am wondering what people are using for C++ refactoring, especially for larger code base.</p>

<p>Here are the add-ins that I have tried so far:
* Visual Assist X
* Refactor! Pro</p>

<p>Meanwhile, does anyone know if Visual Studio 2010 will have any real C++ refactoring tool built in?</p>

<p>Many Thanks!</p>

<p>Minyu</p>
","<c++><refactoring><visual-studio-addins><tool-advice>","11","6812","2009-07-30 23:05:20"
"1209237","Using old code to verify results in unit tests","<p>Lets says I'm replacing an over complicated method with a much simpler implementation that I believe does the same thing.</p>

<p>Would it make sense for me to copy the old code into a class with my unit tests so I can assert the result of both is the same?</p>

<p>Thanks</p>
","<unit-testing><testing><refactoring><tdd>","1","117","2009-07-30 20:40:25"
"1211584","How to fundamentally re-architect a system whilst preserving functional behaviour?","<p>I have inherited an ASP.NET application that is a disaster architecturally, however it works and it is in live production use. In order to enhance the application in the future I need to totally re-architect it, but I need to preserve the existing front-end functionality - the changes that are being asked of me are more backend integration than front-end functional or user interaction.</p>

<p>The basic issue is this - the bulk of the business logic is in stored procs (and the rest is in UI codebehind files) - there is no business domain model of which to speak. I need to refactor logic out of the database (and down from the UI) into code, but the behaviour of the application is fundamentally bound up in these stored procs. So the question is this - how do you go about a complete re-architecting of this kind? </p>

<p>I understand refactoring in small steps, I've read fowler etc. I am really looking for practical advice from people who have been through a similar process.</p>

<p>Thanks!</p>

<p><strong>Edit</strong>
I should have said, ideally I want to re-engineer iteratively, during a multiple release cycle.</p>
","<architecture><refactoring><re-engineering>","0","182","2009-07-31 09:33:55"
"1215207","refactoring multiple if-else conditionals in a method","<p>I am in the process of refactoring my existing code. It actually works fine, but it is a bit cluttered with multiple if-else conditionals checking the value of one variable and change the value of a second variable to an updated value taken from a fixed enumeration structure.</p>

<pre><code>else if (var1 == 'valueX')
{
	if (var2 == MyEnum.A)
		var2 = MyEnum.B;
	else if (var2 == MyEnum.B)
		var2 = MyEnum.C;
	else if (var2 == MyEnum.C)
		var2 = MyEnum.D;
	else if (var2 == MyEnum.D)
		var2 = MyEnum.A;
}

else if (....)
{
..similar block of conditionals
}
</code></pre>

<p>I am a bit confused as to what is the best way to refactor and clean-up this code. Would you suggest the use of a switch perhaps? Or something more elegant?</p>

<p>Thanks in advance!</p>
","<java><refactoring><conditional>","2","1325","2009-07-31 22:37:28"
"1219115","Refactoring Windows Forms Application","<p>I am developing a windows forms application.  It was basically evovled with a mix of BDUP and prototyping.  </p>

<p>I have about 1500 lines of code (excluding IDE generated partial class... 1465 to be exact) in the form and the form has 6 tabs (9 subtabs).  Does not have more than 10 controls in each form so multiple form solution would be an overkill.</p>

<p>I have a set of entity classes that when serialized give me an XML representation that I store in an XML file.  I've encapsulated this with a Repository pattern so I could move the storage to a database in future.  The form uses the entity classes (for save/edit) and the Repo factory (add, retrieve and save).</p>

<p>Now, my problem is that much of the 1500 lines of code deals with interaction between UI elements (making a choice in a Combo disables some elements, or displays different items in a grid, handle tab transitions (next/back buttons), loading menus (each distinct item in the xml file repository becomes a menu item), new/edit mode etc (I've three distinct sets of new/edit on the same form).</p>

<ol>
<li>What would be best approach here to move the element interaction out? Let's say, I may decide to make it web-based UI in future.</li>
<li>More importantly what are the composite refactorings I can apply?</li>
<li>What patterns I should refactor to / towards?</li>
</ol>

<p>Thanks for helping out.</p>

<p>Note:  I'm reading Refactoring to Patterns...  Specifically I wanted to have a ""howto""/tips on Refactoring to MVC... </p>
","<winforms><refactoring>","0","184","2009-08-02 15:49:48"
"1219815","Python: prefer several small modules or one larger module?","<p>I'm working on a Python web application in which I have some small modules that serve very specific functions: <code>session.py</code>, <code>logger.py</code>, <code>database.py</code>, etc. And by ""small"" I really do mean small; each of these files currently includes around 3-5 lines of code, or maybe up to 10 at most. I might have a few imports and a class definition or two in each. I'm wondering, is there any reason I should or shouldn't merge these into one module, something like <code>misc.py</code>?</p>

<p>My thoughts are that having separate modules helps with code clarity, and later on, if by some chance these modules grow to more than 10 lines, I won't feel so bad about having them separated. But on the other hand, it just seems like such a waste to have a bunch of files with only a few lines in each! And is there any significant difference in resource usage between the multi-file vs. single-file approach? (Of course I'm nowhere near the point where I should be worrying about resource usage, but I couldn't resist asking...)</p>

<p>I checked around to see whether this had been asked before and didn't see anything specific to Python, but if it's in fact a duplicate, I'd appreciate being pointed in the right direction.</p>
","<python><refactoring><module>","6","367","2009-08-02 20:49:23"
"1221553","Can you refactor this?","<p>Can you refactor this ?</p>

<pre><code>private void ClearUserDataFields()
{
   var textBoxes = this.Controls.OfType&lt;TextBox&gt;();
   foreach (var txtBoxControl in textBoxes)
   {
       txtBoxControl.Text = String.Empty;
   }
}
</code></pre>

<p>Isn't there anyway to do this in one LOC ?</p>
","<c#><.net><asp.net><refactoring><lambda>","0","246","2009-08-03 10:12:56"
"1221279","Log usage of database tables, functions, stored procedures, views etc","<p>I work on a system that is based on a SQL server database that has a lot of years of development on it. It is not huge in data volume (a few GB) but it has a lot of complexity (hundreds of tables, hundreds of stored procedures).</p>

<p>I want to start by cleaning out the stuff that isn't used any more. We have a weekly/monthly/quarterly/annual cycle that will mean that some stuff will not be used for a year. However, if there is a short list of things that have not been used for a few months, we might be able to decide by inspection if they are still useful.</p>

<p>My intention is to start logging access to all the database objects. I've got some ideas but what I'd like is a log that I can turn into a list of things that aren't being used. I've a few ideas but I'd like some expert help.</p>

<p><em>edit</em> : I'd also like to clear up that I can I would like to see the access to the tables/views as well as the stored procs and functions. </p>
","<sql-server><database><database-design><logging><refactoring-databases>","1","290","2009-08-03 08:49:04"
"1223521","How use refactoring tools when you have multiple visual studio solutions?","<p>We have two visual studio solutions for our product: one for our reusable components (Core.sln) and one for our product (Product.sln). Projects from the Product solution have references (file references) to assemblies of our core.</p>

<p>When working in one solution, the refactoring features will not refractor in the other solution. Renaming a method in a core class renames it in the Core solution but not in the Product solution. </p>

<p>Is there a way to benefit from refactoring tools when using multiple solutions? Do commercial refactoring products (Resharper, Code Rush) have the same limitation?</p>
","<c#><visual-studio><refactoring>","2","181","2009-08-03 17:20:31"
"1224450","Is it possible to use a Strategy pattern for data structure with no common ancestor?","<p>I have two data structure classes (this is a simplified version of my code) <br /></p>

<ul>
<li>Animal: Has one property  “int Age” </li>
<li>Person: Has one property “DateTime Birthday”</li>
</ul>

<p>What I am trying to accomplish is to compile “Uploading” (persisting to database), which is common across all different data structure classes.
So mainly my goal is to have a small Upload method that looks like <br /></p>

<pre><code>   foreach (TypeName typeName in Enum.GetValues(typeof(TypeName)))
   {
      IDataPopulator populator = 
            new DataFactory().CreateDataPopulator(typeName);
         populator.Populate(string.Empty);
   }
</code></pre>

<p>But the problem is that, <code>populator</code> returns an object instances of different types, which I am having trying to encapsulate since they have no common properties.
(IDataPopulator.TResult Populate(string data) in the code below)</p>

<p>Is there a way to get around this? Or does Strategy pattern not fit for this kind of scenario? </p>

<p>Here is the code I’ve been working with</p>

<pre><code>public class Program
{
    public static void Main()
    {
        foreach (TypeName typeName in Enum.GetValues(typeof(TypeName)))
        {
            IDataPopulator populator = new DataFactory().CreateDataPopulator(typeName);
            populator.Populate(string.Empty);
        }
    }
}

public enum TypeName { Person, Animal }
public class Person { public DateTime Birthday { get; set; } }
public class Animal { public int Age { get; set; } }

public interface IDataPopulator
{
    TResult Populate(string data);
}

class AnimalDataPopulator : IDataPopulator
{
    public Animal Populate(string data)
    {
        // create an instance of Animal using data
    }
}

class PersonDataPopulator : IDataPopulator
{
    public Person Populate(string data)
    {
        // create an instance of Person using data
    }
}

public class DataFactory
{
    public IDataPopulator CreateDataPopulator(TypeName typeName)
    {
        switch (typeName)
        {
            case TypeName.Person:
                return new PersonDataPopulator();
            case TypeName.Animal:
                return new AnimalDataPopulator();
            default:
                throw new ArgumentOutOfRangeException(""typeName"");
        }
    }
}

public class UploadContext
{
    private readonly IUploader _Uploader;
    public UploadContext(IUploader uploader) { _Uploader = uploader; }
    public void Upload() { _Uploader.Upload(); }
}

public interface IUploader
{
    void Upload();
}

class PersonUploader : IUploader
{
    private Person _Person;
    public PersonUploader(Person person) { _Person = person; }
    public void Upload()
    {
        Console.WriteLine(""Uploading person..."");
    }
}
class AnimalUploader : IUploader
{
    private Animal _Animal;
    public AnimalUploader(Animal animal) { _Animal = animal; }
    public void Upload()
    {
        Console.WriteLine(""Uploading animal..."");
    }
}
</code></pre>
","<c#><design-patterns><refactoring><strategy-pattern>","0","324","2009-08-03 20:29:43"
"1226745","Delphi 2009 refactoring error","<p>I use Delphi2009. When using Refactoring -> Change Params every time when I try to add new parameter to routine, when I setup new parameter and click “Refactor” I get an error:</p>

<p><img src=""http://img518.imageshack.us/img518/6672/delphief.jpg"" alt=""alt text"" /></p>

<p>(NOTE: imageshack sometimes has problems, so sometimes you may not see this image).</p>

<p>Do you know any workaround?</p>
","<delphi><refactoring><delphi-2009>","1","589","2009-08-04 10:28:09"
"1229169","Using properties in switch statement cases?","<p>I have a switch statement in one class that generates Command objects, based on if a certain line in a code file matches the particular code for that Command object.  </p>

<p>like this:</p>

<pre><code>switch (line):
{
   case ""#CODE1"":
      return new Command1();
   case ""#CODE2"":
      return new Command2();
}
</code></pre>

<p>I want to turn it into something like this:</p>

<pre><code>switch (line):
{
   case Command1.Code:
      return new Command1();
   case Command2.Code:
      return new Command2();
}
</code></pre>

<p>I tried it by creating a public static property of Command1, but the compiler complains...</p>

<p>Is there a way to do something along this intent, that the compiler won't complain about?</p>
","<c#><.net><refactoring><switch-statement>","1","509","2009-08-04 18:35:59"
"1229440","How many tables/sprocs/functions in a database is too many?","<p>I'm interested in database refactoring. I deal with several databases that don't have a large amount of data, just a few GB with at most a few hundred thousand rows. However, they have hundreds -- sometimes many hundreds -- of tables, views, sprocs and functions. In some places a divide-and-rule strategy using schemas has been implemented which has helped some problems of seeing ownership/usage of tables. However, it hasn't really helped object coupling.</p>

<p>We all read that <a href=""http://www.eaipatterns.com/SharedDataBaseIntegration.html"" rel=""nofollow"">integration via shared database</a> isn't A Good Thing, but we also know that it is, at least for a while , a very productive thing as everything is in the database. We just don't apply the <a href=""http://en.wikipedia.org/wiki/Single%5Fresponsibility%5Fprinciple"" rel=""nofollow"">Single Responsibility Principle</a> to databases like we do to objects.</p>

<p><em>Edit</em>: I should add that I have no database performance issues. The tables are not large, the biggest has only a few hundred thousand rows. There is no real database performance issue; except when the database schema/logic/implementation is grotesquely inefficient (say requiring a cursor to do a sproc execution for each row in a result set in order to pre-process data for a report). Before you say I should change these, that is the whole point: I can't because the database is no longer in a state where the impact of changes can be assessed.</p>

<p>Clearly at some point you say ""Enough!"" and divide into multiple databases connected by messages, ETL, application tiers etc etc</p>

<p>The question is: how many is too many? What is the absolute upper limit of the number of sprocs/tables/functions that you can have before you go insane?</p>
","<sql-server><database-design><refactoring><refactoring-databases>","3","601","2009-08-04 19:28:37"
"1229208","regex for that excludes matches within quotes","<p>I'm working on this pretty big re-factoring project and I'm using intellij's find/replace with regexp to help me out.</p>

<p>This is the regexp I'm using:</p>

<pre><code>\b(?&lt;!\.)Units(?![_\w(.])\b
</code></pre>

<p>I find that most matches that are not useful for my purpose are the matches that occur with strings within quotes, for example: ""units""</p>

<p>I'd like to find a way to have the above expression not match when it finds a matching string that's between quotes... </p>

<p>Thx in advance, this place rocks!</p>
","<java><regex><jsp><refactoring><intellij-idea>","1","348","2009-08-04 18:43:27"
"1231506","PHP IDE with extract function like Eclipse Java Refactor->Extract Method","<p>Is there any (free or cheap) IDE, which can extract part from a function as another function?</p>
","<php><eclipse><ide><refactoring>","0","629","2009-08-05 06:27:15"
"1233086","What does refactoring mean to you?","<p>bit of a subjective question but - I'm not looking for a definition, I'm more interested in what it means to you?  What does refactoring mean to you?</p>
","<language-agnostic><refactoring>","8","350","2009-08-05 12:57:32"
"1235719","C# refactor this messy code!","<p>I am basically creating a flat View Model for a Timesheet page (ASP.NET MVC) that has a grid for the days of the week. The WorkTime properties should either be an existing WorkTime from the database or null if there is no existing one.</p>

<p>There will only ever be 1 week displayed (Saturday to Friday). and I have the individual properties there so that the syntax in my view should be simpler.</p>

<pre><code>+------+-----+-----+-----+-----+-----+-----+-----+
| Desc | Sat | Sun | Mon | Tue | Wed | Thu | Fri |
+------+-----+-----+-----+-----+-----+-----+-----+
|______|_____|_____|_____|_____|_____|_____|_____|
|______|_____|_____|_____|_____|_____|_____|_____|
|______|_____|_____|_____|_____|_____|_____|_____|
|______|_____|_____|_____|_____|_____|_____|_____|
</code></pre>

<p>All of the dates that come from and are persisted to the database have no Time element (all midnight hour) and the Saturday to Friday DateTime properties are all set already.</p>

<p>The properties I am setting</p>

<pre><code>public WorkTime SaturdayWorkTime { get; private set; }
public WorkTime SundayWorkTime { get; private set; }
public WorkTime MondayWorkTime { get; private set; }
public WorkTime TuesdayWorkTime { get; private set; }
public WorkTime WednesdayWorkTime { get; private set; }
public WorkTime ThursdayWorkTime { get; private set; }
public WorkTime FridayWorkTime { get; private set; }
</code></pre>

<p>Current iteration...</p>

<pre><code>public DateTime Saturday { get; private set; }
public DateTime Sunday { get; private set; }
public DateTime Monday { get; private set; }
public DateTime Tuesday { get; private set; }
public DateTime Wednesday { get; private set; }
public DateTime Thursday { get; private set; }
public DateTime Friday { get; private set; }

_workTimes = _workTimeRepository.GetByWorkAssignmentID(WorkAssignment.ID, Saturday, Friday);
SaturdayWorkTime = GetWorkTimeForDay(DayOfWeek.Saturday);
SundayWorkTime = GetWorkTimeForDay(DayOfWeek.Sunday);
MondayWorkTime = GetWorkTimeForDay(DayOfWeek.Monday);
TuesdayWorkTime = GetWorkTimeForDay(DayOfWeek.Tuesday);
WednesdayWorkTime = GetWorkTimeForDay(DayOfWeek.Wednesday);
ThursdayWorkTime = GetWorkTimeForDay(DayOfWeek.Thursday);
FridayWorkTime = GetWorkTimeForDay(DayOfWeek.Friday);
</code></pre>

<p>with this helper method...</p>

<pre><code>private WorkTime GetWorkTimeForDay(DayOfWeek dow)
{
    return _workTimes.FirstOrDefault(x =&gt; x.Date.DayOfWeek == dow);
}
</code></pre>
","<c#><refactoring>","1","509","2009-08-05 20:59:59"
"1242266","Converting bytes to GB in C#?","<p>I was refactoring some old code and came across the following line of code to convert bytes to GB.</p>

<pre><code>decimal GB = KB / 1024 / 1024 / 1024;
</code></pre>

<p>Is there a better way to refactor the following piece of code?</p>

<p><b>Update</b></p>

<p>I meant to say bytes to Gigabytes.  I gave wrong information. </p>
","<c#><refactoring>","5","5241","2009-08-07 00:27:37"
"1244077","C# Generics Refactoring","<p>I am trying to refactor a piece of code which seems easily refactorable but is proving difficult.  There are two method which seem very similar and I feel should be refactored:-</p>

<pre><code>public class MyClass
{
    private void AddBasicData(Receiver receiver)
    {
        var aHelper = new AHelper();
        var bHelper = new BHelper();
        var cHelper = new CHelper();
        receiver.ObjA = aHelper.GetBasic();
        receiver.ObjB = bHelper.GetBasic();
        receiver.ObjC = cHelper.GetBasic();
    }

    private void AddExistingData(Receiver receiver)
    {
        var aHelper = new AHelper();
        var bHelper = new BHelper();
        var cHelper = new CHelper();
        receiver.ObjA = aHelper.GetExisting();
        receiver.ObjB = bHelper.GetExisting();
        receiver.ObjC = cHelper.GetExisting();
    }
}
</code></pre>

<p>The reference code for this class is here...</p>

<pre><code>public class AHelper : Helper&lt;A&gt; 
{
}

public class BHelper : Helper&lt;B&gt; 
{
}

public class CHelper : Helper&lt;C&gt; 
{
}

public class Helper&lt;T&gt; : IHelper&lt;T&gt; where T : IMyObj
{
    public T GetBasic()
    {
       ...
    }

    public T GetExisting()
    {
       ...
    } 
}

public interface IHelper&lt;T&gt;
{
    T GetBasic();
    T GetExisting();
}

public class A : IMyObj {}
public class B : IMyObj {}
public class C : IMyObj {}

public interface IMyObj {}

public class Receiver
{
    public A ObjA { get; set; }
    public B ObjB { get; set; }
    public C ObjC { get; set; }
}
</code></pre>

<p>My first attempt was to refactor like this...</p>

<pre><code>public class MyClass
{
    private void AddBasicData(Receiver receiver)
    {
        Func&lt;Helper&lt;IMyObj&gt;, IMyObj&gt; func = x =&gt; x.GetBasic();
        AddData(receiver, func);
    }

    private void AddExistingData(Receiver receiver)
    {
        Func&lt;Helper&lt;IMyObj&gt;, IMyObj&gt; func = x =&gt; x.GetExisting();
        AddData(receiver, func);
    }

    private void AddData(Receiver receiver, Func&lt;Helper&lt;IMyObj&gt;, IMyObj&gt; func)
    {
        var aHelper = new AHelper();
        var bHelper = new BHelper();
        var cHelper = new CHelper();
        receiver.ObjA = func(aHelper);
        receiver.ObjB = func(bHelper);
        receiver.ObjC = func(cHelper);
    }
}
</code></pre>

<p>The problem with this is objects like <code>new AHelper()</code> is not assignable to <code>Helper&lt;IMyObj&gt;</code> :-(</p>

<p>Can anyone see how this could be nicely refactored?</p>

<p>Thanks in advance </p>

<p>Russell</p>
","<c#><generics><refactoring>","6","306","2009-08-07 10:43:01"
"1247835","When should you not refactor?","<p>We all know that refactoring is good and I love it as much as the next guy, but do you have real cases where is better <em>not</em> to refactor ? </p>

<p>Something like time critical stuff or synchronization? Technical or human reasons are equally welcome. Real cases scenarios and experiences a plus.</p>

<p><em>Edit</em> : from the answers thus far, it looks like the only reason not to refactor is money. My question is mostly relative to something like this: suppose you would like to perform ""extract method"", but if you add the additional function call, you will make the code slightly less faster and hinder a very strict synchronization. Just to give you an idea of what I mean.</p>

<p>Another reason I sometimes heard is that ""others used to the current code layout will get annoyed by your changes"". Of course, I doubt this is a good reason.</p>
","<refactoring>","7","814","2009-08-08 03:01:15"
"1258989","Refactoring: Nested class or separate classes?","<p>I'm currently doing some refactoring (+ adding new features) to some of our framework classes. The situation is that we have a single (god-like) class which does a bunch of logic we'd like to split up. The class represents something like a validation rule for fiscal codes. So it does validation of the names of the person, birthdate etc..</p>

<p>What I am going to do is to split it up in single rules, basically a rule which validates the person's firstname against the fiscal code, another one for the birthdate and so on. For the programmer at the end it looks nearly the same. Instead of invoking the huge constructor of the FiscalCode rule, he'll do something like <code>FiscalCode.GetRules(...)</code> and pass the parameters here. The <code>GetRules(...)</code> will then internally construct the single rules and pass them back as an array. That's perfectly fine and correct for us.</p>

<p>So much for your background. Now my question is the following. The FiscalCode class (which is our current mighty god-class) has a lot of utility methods which will be needed by more of the single ""rule classes"" I'm going to create. What I know is that I will somehow still need the FiscalCode class, for doing the <code>GetRules(...)</code> thing (this is to remain constant somehow for the programmers, not that they have to do a completely new thing).</p>

<p>I have two options which come to my mind:</p>

<ol>
<li>Create my new rule classes and access the public static utility methods of the FiscalCode class</li>
<li>Create my new rule classes as inner nested classes of the FiscalCode class s.t. I have already access the utility methods (and therefore no need for exposing my utility methods)</li>
</ol>

<p>I have already a favorite, but I'd like to hear the opinion of some of you first.</p>

<p>Thx</p>
","<c#><refactoring><nested-class>","1","394","2009-08-11 08:05:21"
"1264944","Refactoring domain logic that accesses repositories in a legacy system","<p>I am working with a legacy system that has an <em>anemic domain model</em>.</p>

<p>The domain has the following entity classses: <code>Car</code>, <code>CarType</code>, <code>CarComponent</code>, <code>CarComponentType</code>.</p>

<p>For each of these, there is a separate repository. There is also a number of services that access these repositories and contain basically all logic.</p>

<p>I need to implement a method that determines if a <code>CarComponentType</code> can be discontinued by the vendor. The logic is as follows: a component can be discontinued only if there are no existing cars with that component today.</p>

<p>Initially, I implemented this in a service class.</p>

<pre><code>public boolean canBeDiscontinued(CarComponentType carComponentType) {
    List&lt;Car&gt; cars = carRepository.getCarsWithComponent(carComponentType);
    return cars.isEmpty();
}
</code></pre>

<p>This works - but this logic is used from several other places in the code. It might grow, and it looks like something that could fit <em>inside</em> the <code>CarComponentType</code> class instead:</p>

<pre><code>public boolean canBeDiscontinued() {
    List&lt;Car&gt; cars = carRepository.getCarsWithComponent(this);
    return cars.isEmpty();   
}
</code></pre>

<p>However, I can't put it there, since it needs to access the repository (and as I understand it is a very serious antipattern for entities to be aware of the data access layer). When loading a component type I can't load all cars of that type since that could be thousands of objects. We are not using any ORM, so making a lazy loaded collection for not only be bulky but also very error-prone.</p>

<p>Is it more appropriate to actually have this method in a service class as I first did? Is it not important? Is there another alternative? Should I start refactoring from another starting point?</p>

<p>There is a similar question <a href=""http://stackoverflow.com/questions/596285/in-domain-driven-design-would-it-be-a-violation-of-ddd-to-put-calls-to-other-obj"">here</a>. But my question relates to Java, so I don't think that solution is applicable in my case. Also, sorry in advance for using cars and components as my domain model. :)</p>
","<java><design><refactoring><repository><domain-driven-design>","7","470","2009-08-12 08:31:52"
"1268424","create an interface from a huge class using resharper","<p>I have a very big class with lots of methods, is it possible to build an interface from this class using resharper?</p>
","<interface><resharper><refactoring>","2","455","2009-08-12 20:06:03"
"1269264","How to refactor this sql query","<p>I have a lengthy query here, and wondering whether it could be refactor?</p>

<pre><code>Declare @A1 as int
Declare @A2 as int
...
Declare @A50 as int

SET @A1 =(Select id from table where code='ABC1')
SET @A2 =(Select id from table where code='ABC2')
...
SET @A50 =(Select id from table where code='ABC50')

Insert into tableB
Select 
Case when @A1='somevalue' Then 'x' else 'y' End,
Case when @A2='somevalue' Then 'x' else 'y' End,
..

Case when @A50='somevalue' Then 'x' else 'y' End
From tableC inner join ......
</code></pre>

<p>So as you can see from above, there is quite some redundant code. But I can not think of a way to make it simpler.</p>

<p>Any help is appreciated.</p>
","<tsql><query><refactoring>","0","98","2009-08-12 23:24:45"
"1269472","Help me refactor this loop","<p>I am working on the redesign of an existing class.  In this class about a 400-line while loop that does most of the work.  The body of the loop is a minefield of if statements, variable assignments and there is a ""continue"" in the middle somewhere.  The purpose of the loop is hard to understand.</p>

<p>In pseudocode, here's where I'm at the redesign:</p>

<pre><code>/* Some code here to create the objects based on config parameters   */
/* Rather than having if statements scattered through the loop I     */
/* create instances of the appropriate classes.  The constructors     */
/* take a database connection.                                       */

FOR EACH row IN mySourceOfData
  int p = batcher.FindOrCreateBatch( row );
  int s = supplierBatchEntryCreator.CreateOrUpdate( row, p );
  int b = buyerBatchEntryCreator.CreateOrUpdate( row, p );
  mySouceOfData.UpdateAsIncludedInBatch( p, s, b);
NEXT
/* Allow things to complete their last item */
mySupplierBatchEntry.finish();
myBuyerBatchEntry.finish();
myBatcher.finish();

/* Some code here to dispose of things */

RETURN myBatch.listOfBatches();
</code></pre>

<p>Inside FindOrCreateBatch() it figures out using some rules if a new batch needs to be created or if an existing one can be used.  The different implementations of this interface will have different rules for how it finds them, etc.  The return value is the surrogate key (id) from the database of the payment batch that it found or created.  This id is required by following processes that take p as a parameter.</p>

<p>This is an improvement over where I started, but I have an uneasy feeling about the class containing this loop. </p>

<ol>
<li>It doesn't seem to a be a domain object, it's more of a ""Manager"" or ""Controller"" type class.</li>
<li>It seems to be getting inbetween batcher and supplierBatchEntryCreator (and the other classes). At the moment only an int is passed, but if that changes all three classes need to change.  This seems like a Law of Dementer violation.</li>
</ol>

<p>Any suggestions, or is this ok?  The actual language is java.</p>
","<refactoring><law-of-demeter>","0","188","2009-08-13 00:40:09"
"1273197","A more efficient way to work with DataSets","<p>I have the following code, repeated on each <code>Form</code>, as part of the Update process.  When the page loads the <code>BLL</code> returns a <code>DataSet</code>, say </p>

<pre><code>_personInfo = ConnectBLL.BLL.Person.GetPerson(personID);
</code></pre>

<p>I store that <code>DataSet</code> in a <code>Form</code> level variable which I then use to check against for changes during the Validate/Update process.  I pass a row at a time(<em>though there is never more then one row</em>) to a <code>Function</code> that takes the value in a control and compares it to its corresponding column value in the <code>DataSet</code>.  If it finds it different then it sets that column = to the new value and adds the name to a <code>List</code> of what's changed.</p>

<pre><code>// Load Person info
        using (var tmpPersonDT = tmpPersonDS.Tables[0])
        {
            if (tmpPersonDT.Rows.Count &gt; 0)
            {
                foreach (DataRow row in tmpPersonDT.Rows)
                {
                    CheckPersonData(row);
                }

            }
        }

// Snippet of the CheckPersonData() that is being called....
    if (!object.Equals(row[""ResidencyCountyID""], lkuResidenceCounty.EditValue))
    {
        row[""ResidencyCountyID""] = lkuResidenceCounty.EditValue;
        _whatChanged.Add(""ResidencyCounty"");
    }

if (!object.Equals(row[""ResponsibilityCountyID""], lkuResponsibleCounty.EditValue))
{
    row[""ResponsibilityCountyID""] = lkuResponsibleCounty.EditValue;
    _whatChanged.Add(""ResponsibilityCounty"");
}

if (!object.Equals(row[""HispanicOriginFlag""], chkHispanic.EditValue))
{
    row[""HispanicOriginFlag""] = chkHispanic.EditValue;
    _whatChanged.Add(""HispanicOriginFlag"");
}

if (!object.Equals(row[""CitizenFlag""], chkCitizen.EditValue))
{
    row[""CitizenFlag""] = chkCitizen.EditValue;
    _whatChanged.Add(""CitizenFlag"");
}

if (!object.Equals(row[""VeteranFlag""], chkVeteran.EditValue))
{
    row[""VeteranFlag""] = chkVeteran.EditValue;
    _whatChanged.Add(""VeteranFlag"");
}
</code></pre>

<p><strong>What I am trying to get an answer to, is this really the most efficient way of going about this?</strong>  </p>

<p>If nothing else I would like to create a function to do the comparing instead of repeating 30 times(per form varies) but I can't quite figure that out.  I thought maybe I could use row[].ItemArray but that only has the values.  I would have to <em>KNOW</em> ahead of time what order the items were in and bank on them not changing.... </p>

<p>Am I missing something obvious for working with <strong>DataSets/DataTables</strong> in a <strong>CRUD app</strong>?</p>

<p><hr /></p>

<p><a href=""http://stackoverflow.com/questions/1273197/a-more-effecient-way-to-work-with-datasets/1276314#1276314""><strong><em>juliandewitt's</em></strong> post below is fantastic!</a> </p>

<p>I just, now, need some direction on how to use that in the above. Any links that anyone can point me to would be appreciated. Even better if you can post an example. </p>

<p>Are there any drawbacks to using DataRows like that?</p>
","<c#><.net><winforms><refactoring><dataset>","2","1165","2009-08-13 16:46:31"
"1273686","Refactor help c#","<p>I have several hundred lines of code like this:</p>

<pre><code>if (c.SomeValue == null || c.SomeProperty.Status != 'Y')
{
    btnRecordCall.Enabled = false;
}

if (c.SomeValue == null || (c.SomeProperty.Status != 'Y' &amp;&amp;
    c.SomeOtherPropertyAction != 'Y'))
{
    btnAddAction.Enabled = false;
}

if (c.SomeValue == null || c.SomeProperty.Processing != 'Y')
{
    btnProcesss.Enabled = false;
}
</code></pre>

<p>How can I refactor this correctly? I see that the check 'c.SomeValue == null' is being called every time, but it is included with other criteria. How can I possibly eliminate this duplicate code?</p>
","<c#><design-patterns><refactoring>","2","260","2009-08-13 18:15:09"
"1274995","Is there a better way to do this LINQ statement block?","<p>I'm relatively new with LINQ, but I'm going to be getting into it a lot more. Is the following a practical application of LINQ, or is there a better way to do something like this?</p>

<pre><code>Public Shared Function GetItems(ByVal itemsList As List(Of OrderItem), 
 ByVal whichForm As ItemsFor, ByVal formID As Integer) As List(Of OrderItem)
	Dim items As New List(Of OrderItem)
	Select Case whichForm
		Case ItemsFor.MfrCredit
			Dim query = From oi As OrderItem In itemsList _
Where oi.ManufacturerCreditID = formID Select oi
			items = query
		Case ItemsFor.CustomerCredit
			Dim query = From oi As OrderItem In itemsList _
 Where oi.CustomerCreditID = formID Select oi
			items = query
		Case ItemsFor.Invoice
			Dim query = From oi As OrderItem In itemsList _
 Where oi.InvoiceID = formID Select oi
			items = query
		Case ItemsFor.PurchaseOrder
			Dim query = From oi As OrderItem In itemsList _
 Where oi.PurchaseOrderID = formID Select oi
			items = query
		Case ItemsFor.Quote
			Dim query = From oi As OrderItem In itemsList _
 Where oi.QuoteID = formID Select oi
			items = query
		Case ItemsFor.StockingOrder
			Dim query = From oi As OrderItem In itemsList _
 Where oi.StockingOrderID = formID Select oi
			items = query
	End Select
	Return items
End Function
</code></pre>

<p>I was thinking if I could get the property name somehow as an object I could just do one LINQ statement, but I'm not sure exactly how...</p>

<p>Thanks!</p>
","<asp.net><vb.net><linq><refactoring>","1","131","2009-08-13 22:33:02"
"1274749","Who makes tools auto documenting/analysing legacy code and which is better?","<p>Who else makes tools like Scitools Understand C++ and which is better?</p>

<p>Looking for the most complete auto documentation tools for Ada, C, C++ and Fortran.  For analysis of tool migration effort, to aid to in pruning dead code and identifying essential functionality.</p>

<p>Pete</p>
","<refactoring><reverse-engineering><documentation-generation><legacy-code>","3","199","2009-08-13 21:36:46"
"1277349","Turn off Visual Studio suggestions when using Resharper?","<p>I just started playing with ReSharper and I think I know why ppl love it now :)</p>

<p>I'm using Vs2008 TS and noticed I have <strong>in editor 2 suggestions currently</strong>:<br />
one, standard coming from VS, and second from ReSharper...</p>

<p>Eg when I entere something like:</p>

<pre><code>int a = CalculateMe ( 10 );
</code></pre>

<p>(<strong>Note:</strong> CalculateMe method is not defined yet)<br />
So, I can see VS's ""option to generate method stub (shift + Alt + F10"" and,<br />
and RS's 'create methods CalculateMe')</p>

<p>I would like to see only ReSharper suggestions (turn off VS's) - is it possible?</p>
","<visual-studio-2008><refactoring><resharper>","3","747","2009-08-14 11:21:35"
"1278466","Refactoring help with Ifs","<p>I've been working on this code for awhile and for some reason all the if's are driving me crazy along with a bunch of repeated code.
Is there a nicer more cleaner way to do this?</p>

<pre><code>public Program(string[] args)
    {
        try
        {
            WriteToLogFile(""Starting ImportTask"");
            if (args.Length == 0)
            {
                Import(DateTime.Now,DateTime.Now);
                MarkRecordsAsDeleted();
            }
            else if (args.Length == 1)
            {
                DateTime dateToImport;
                bool isValidDate = DateTime.TryParse(args[0], out dateToImport);
                if (isValidDate)
                {
                    Import(dateToImport,dateToImport);
                    MarkRecordsAsDeleted();
                }
                else
                    WriteToLogFile(String.Format(""The Import date specified was invalid. - {0}"", args[0]));
            }
            else if (args.Length == 2)
            {
                DateTime importStartDate;
                bool isValidStartDate = DateTime.TryParse(args[0], out importStartDate);
                DateTime importEndDate;
                bool isValidEndDate = DateTime.TryParse(args[0], out importEndDate);
                if (isValidStartDate &amp;&amp; isValidEndDate)
                {
                    if (importStartDate &gt; importEndDate)
                    {
                        WriteToLogFile(String.Format(""Invalid date range provided. Start date = {0} End date {1}"",importStartDate,importEndDate));
                        return;
                    }
                    Import(importStartDate, importEndDate);
                    MarkRecordsAsDeleted();
                }
                else
                    WriteToLogFile(String.Format(""The Import date specified was invalid. - {0}"", args[0]));
            }
            else
            {
                WriteToLogFile(""Invalid Command Line Parameters Specified"");
            }

        }
        catch (Exception ex)
        {
            WriteToLogFile(""Error in Import Process = "" + ex.StackTrace);
        }
    }
</code></pre>
","<refactoring><.net-2.0>","1","103","2009-08-14 15:16:51"
"1282708","ASP.NET MVC: Ugly code needs refactoring (returning three values)","<p>I've been brooding over a design issue (smelly code kinda thing) for a couple days now. Maybe you can help.</p>

<p>I have a ""Login"" Method in my RegistrationService, and currently it looks simplified like this:
<code></p>

<pre><code>public Boolean Login(String username, String password, 
                     out String successRedirectUrl, 
                     out IValidationDictionary validationResults)
{
    successRedirectUrl = """";
    if (!Validator.IsValid(username) || !Validator.IsValid(password)) return false;

    // Other logic
    // Distributed login requests etc.
    // Build Redirect Url if login was successful etc.
}
</code></pre>

<p></code></p>

<p>Okay, let me explain above code. The method's main return value (Boolean) is supposed to tell the caller whether or not the login request was successful. Now, IF it was successful, I need to redirect the user to a different Url (thus, the ""out"" parameter successRedirectUrl). If it was NOT successful, I need to tell the user in the view what was wrong - thus the ValidationDictionary (Modelstate).</p>

<p>This code is really ugly and hard to maintain though. I thought of getting rid of the Boolean return type (returning the successRedirectUrl directly and checking on the caller side if it is empty) but I felt things became even more unclear.</p>

<p>Any idea how to do this better?</p>

<p>Thank you!</p>
","<c#><asp.net-mvc><refactoring>","2","236","2009-08-15 19:57:33"
"1282728",".NET Adding a range of characters to a list","<p>I would like to ask if there is a more elegant way to do this:</p>

<pre><code>List&lt;char&gt; unallowed = new List&lt;char&gt;();

for (char c = '\u0000'; c &lt;= '\u0008'; c++) {
    unallowed.Add(c);
}

for (char c = '\u000B'; c &lt;= '\u000C'; c++) {
    unallowed.Add(c);
}

// And so on...
</code></pre>

<p>I have to add to the list a few contiguous ranges of Unicode characters and the only thing that I can think of to refactor the code above is to create my own method to avoid typing the for cycles repeatedly. And I'm not even too sure it's worth it.</p>
","<c#><.net><list><refactoring>","2","459","2009-08-15 20:10:06"
"1295812","Keyboard Shortcut for Smart Tag in Refactor!","<p>I am trying to get Refactor! for ASP.NET, CodeRush Xpress and Resharper play together.  I installed Resharper, then CodeRush Xpress and then Refactor! for ASP.NET.</p>

<p>I can't seem to get any menu options for Refactor! or CodeRush.  The bracket highlighting is working so I know that it is loading, but the smart tag will not appear (the three dots in a box below selected text).</p>

<p>Is there a keyboard shortcut for that?  Anyone have any ideas why I can't get them to work well together?  I have been able to in the past and I know others have too. (Here are some answers <a href=""http://stackoverflow.com/questions/372738/coderush-and-resharper-do-they-work-together"">here</a> show that.)</p>
","<visual-studio><resharper><add-in><refactoring><coderush>","0","344","2009-08-18 18:56:01"
"1299885","Removing tightly coupled code","<p>Forgive me if this is a dupe but I couldn't find anything that hit this exact question.</p>

<p>I'm working with a legacy application that is very tightly coupled.  We are pulling out some of the major functionality because we will be getting that functionality from an external service.</p>

<p>What is the best way to begin removing the now unused code?  Should I just start at the extreme base, remove, and refactor my way up the stack?  During lunch I'm going to go take a look at <a href=""http://rads.stackoverflow.com/amzn/click/0131177052"" rel=""nofollow"">Working Effectively with Legacy Code</a>.</p>
","<refactoring><legacy-code><coupling>","3","519","2009-08-19 13:21:43"
"1301736","Can you rewrite this snippet without goto","<p>Guys, I have the following code that is inside a big while loop that iterates over a tree. This is as fast as I can get this routine but I have to use a goto. I am not fundamentally against goto but if I can avoid them I would like to. (I am not trying to start a flame war, please.)</p>

<p>The constraints: </p>

<ol>
<li>The <code>current=current-&gt;child()</code> is expensive (it's a <code>shared_ptr</code>) so I'd like to minimize the use of that operation at all cost.</li>
<li>After the operation <code>current</code> should be the last child it found.</li>
<li><code>cnt</code> must count each child it encounters.</li>
<li>cnt++ will be replaced by some other operation (or several operations) and should only appear once :)</li>
</ol>

<p>the code:</p>

<pre><code>insideloopy:
cnt++;
if ( current-&gt;hasChild() )
{
    current = current-&gt;child();
    goto insideloopy;
}
</code></pre>

<p><strong>Edit:</strong> Sorry guys, originally forgot to mention cnt++ should only appear once. It will be some kind of operation on the node, and should thus only be there one time. I'm also trying to avoid making that another function call.</p>
","<c++><refactoring><goto>","3","598","2009-08-19 18:19:21"
"1306361","Thread-safety refactoring","<p>I am trying to make a Java application thread-safe. Unfortunately, it was originally designed for a single-user mode and all the key classes are instantiated as singletons. To make matters worse, there is a whole bunch of interfaces working as constants containers and numerous static fields.<br />
What would be considered as a good practice in this case?  </p>

<ul>
<li>There is a single entry point, so I could synchronize that and just use pooling (sort of), but if the calls take more than a minute on average, all other threads in the queue would have to wait for a long time...  </li>
<li>Since the test code coverage is not quite optimal and I can't be sure if I overlooked something, some hints about bad implementation patterns (similar to those stated above) in this area would be useful.  </li>
<li>I know the best thing would be to rewrite the whole structure, but this isn't an option.</li>
</ul>
","<java><refactoring><thread-safety>","0","184","2009-08-20 13:54:06"
"1308927","Refactor methods invoking delgates with different parameter signatures","<p>Is there a pattern that I could apply to refactor this code? The only difference between the two methods is that that one method takes an extra parameter and passes it to the delegate?</p>

<p>I found out that delegates cannot take overloaded method signatures. How could I add one more level of indirection? :)</p>

<pre><code>public static void ProcessFolder(
    ProcessFolderDelegate processFolderDelegate
)
{
    using (var esb = ExchangeService.GetExchangeServiceBinding())
    {
    	var contactFolder = FolderService.GetPublicFolder(esb,  
    	    Properties.Settings.Default.ExchangePublicFolderName);
    	processFolderDelegate(esb, contactFolder);
    }
}

public static void ProcessContact(  
    ProcessContactDelegate processContactDelegate,  
    Contact contact  //extra param
)
{
    using (var esb = ExchangeService.GetExchangeServiceBinding())
    {
    	var contactFolder = FolderService.GetPublicFolder(esb,  
    	    Properties.Settings.Default.ExchangePublicFolderName);
    	processContactDelegate(esb, contactFolder, contact); //extra param
    }
}
</code></pre>
","<c#><refactoring><delegates>","1","187","2009-08-20 21:24:34"
"1312275","What do you do with atrocious code?","<p>What do you do when you're assigned to work on code that's 
atrocious and antiquated to the point where it's almost incomprehensible?  </p>

<p>For example: hardware interface code, mixed with logic, AND user interface code, ALL in the same functions?</p>

<p>We see bad code all the time, but what do you actually do about it?</p>

<ul>
<li>Do you try to refactor it? </li>
<li>Try to make it OO if it's not? </li>
<li>Or do you try to make some sense of it, make the necessary changes and move on?</li>
</ul>
","<refactoring>","15","1072","2009-08-21 14:24:50"
"1314208","Writing a new refactoring plugin for Eclipse?","<p>Is there any good documentation on implementing new refactorings in Eclipse? Specifically, I'd like to access the AST for a Java class, make some non-trivial changes, and save the result back to the source file.</p>

<p>So far, the only documentation I've found is (1) the source code for the existing refactorings and (2) a few articles on the LTK and Java AST:</p>

<ul>
<li><a
href=""http://www.eclipse.org/articles/Article-LTK/ltk.html"" rel=""nofollow"">Eclipse
LKT</a></li>
<li><a
href=""http://www.eclipse.org/articles/article.php?file=Article-JavaCodeManipulation_AST/index.html"" rel=""nofollow"">Eclipse
Java AST</a></li>
</ul>

<p>Are there any other articles or tutorials that I should read?</p>
","<java><eclipse><plugins><refactoring>","12","1763","2009-08-21 21:01:04"
"1320229","css refactoring tool","<p>i have taken over a website that has tons of css files and lots of inline css as well.  Is there any tool that can show me a visualization of how this stuff is organized as i have a strong feeling that.  Many pages are bringing in more css than necessary</p>

<p>Also, i want to remove all the inline formatting as well into css files.  Is there any refactoring tool that does even this by itself?</p>
","<css><refactoring>","1","261","2009-08-24 02:30:36"
"1319967","Which namespace does a factory class belong?","<p>I have a factory class, <code>DocumentLoaderFactory</code>, which simply returns an instance that implements an interface, <code>IDocumentLoader</code>.</p>

<p>All implementation resides under the following namespace</p>

<blockquote>
  <p>Skim.Ssms.AddIn.ActiveFileExplorer.Loader</p>
</blockquote>

<p>But what I am wondering is, which namespace does <code>DocumentLoaderFactory</code> belong?
I have placed the factory class under the <code>*.Loader</code> namespace for now, but it is being used from a user control (<code>ActiveFileWindow</code>) of the parent namespace, <code>Skim.Ssms.AddIn.ActiveFileExplorer</code> as shown below.</p>

<p>What would be pros &amp; cons of placing the factory method within <code>*.Loader</code> or it's parent namespace?  I would like to make a decision <em>depending on</em> pros/cons.</p>

<p><br />
<br />
Here is the layout of my project
<img src=""http://farm4.static.flickr.com/3497/3849884013%5Fc1f1cf495c%5Fo.png"" alt=""alt text"" /></p>
","<.net><design-patterns><oop><refactoring><factory>","4","286","2009-08-24 00:25:09"
"1320447","Can this API be improved?","<p>In our CORE library we offer this class as a 20,000 line abstraction. 
Can you see anything wrong with the way this is designed?</p>

<p>Note1: This class has a SharpZipLib backing.</p>

<p>Note2: SharpZipLib is approximately 20K lines. </p>

<pre><code>public static class Compression
{
    public static Byte[] CompressBytes(Byte[] input);
    public static Byte[] CompressBytes(Byte[] input, Format format);
    public static Byte[] CompressBytes(Byte[] input, Format format, Level level);

    public static Byte[] DecompressBytes(Byte[] input);
    public static Byte[] DecompressBytes(Byte[] input, Format format);

    public static String CompressString(String input);
    public static String CompressString(String input, Format format);
    public static String CompressString(String input, Format format, Level level);

    public static String DecompressString(String input);
    public static String DecompressString(String input, Format format);

    public static void CompressFile(String input_file_path, String output_file_path);
    public static void CompressFile(String input_file_path, String output_file_path, Format format);
    public static void CompressFile(String input_file_path, String output_file_path, Format format, Level level);

    public static void DecompressFile(String input_file_path, String output_file_path);
    public static void DecompressFile(String input_file_path, String output_file_path, Format format);

    public static void CompressFolder(String input_folder_path, String output_file_path);
    public static void CompressFolder(String input_folder_path, String output_file_path, Format format);
    public static void CompressFolder(String input_folder_path, String output_file_path, Format format, Level level);

    public static void DecompressFolder(String input_file_path, String output_file_path);
    public static void DecompressFolder(String input_file_path, String output_file_path, Format format);
}
</code></pre>
","<c#><api><refactoring>","3","395","2009-08-24 04:11:41"
"1321331","Replace Multiple String Elements in C#","<p>Is there a better way of doing this... </p>

<pre><code>MyString .Trim().Replace(""&amp;"", ""and"").Replace("","", """").Replace(""  "", "" "")
         .Replace("" "", ""-"").Replace(""'"", """").Replace(""/"", """").ToLower();
</code></pre>

<p>I've extended the string class to keep it down to one job but is there a quicker way?</p>

<pre><code>public static class StringExtention
{
    public static string clean(this string s)
    {
        return s.Replace(""&amp;"", ""and"").Replace("","", """").Replace(""  "", "" "")
                .Replace("" "", ""-"").Replace(""'"", """").Replace(""."", """")
                .Replace(""eacute;"", ""é"").ToLower();
    }
}
</code></pre>
","<c#><asp.net-mvc><refactoring>","12","5255","2009-08-24 09:25:04"
"1324331","In your opinion what is more readable: ?? (operator) or use of if's","<p>I have a method that will receive a <code>string</code>, but before I can work with it, I have to convert it to <code>int</code>.  Sometimes it can be <code>null</code> and I have to change its value to <code>""0""</code>. Today I have:</p>

<pre><code>public void doSomeWork(string value)
{
   int SomeValue = int.Parse(value ?? ""0""); //it can throw an exception(i know)
}
</code></pre>

<p>I did it, but my boss asked me to refactor it to:</p>

<pre><code>public void doSomeWork(string value)
{
    if(string.IsNullOrEmpty(value))
        value = ""0"";
    int SomeValue = int.Parse(value);
}
</code></pre>

<p>in your opinion what is the best option?</p>
","<c#><refactoring><coalesce><null-coalescing-operator>","2","296","2009-08-24 19:42:49"
"1327362","Code refactoring with python decorators?","<p>I'm actually struggling with some piece of code. I do know that it can be refactored, but I can't find the nice-smart-elegant solution.</p>

<p>Here are two functions (much more functions of that kind are in my code):</p>

<pre><code>def fooA(param1, param2):
    if param2 == True:
       code_chunk_1

    fooA_code  #uses only param1

    if param2 == True:
       code_chunk_2


def fooB(param1, param2):
    if param2 == True:
       code_chunk_1

    fooB_code  #uses only param1

    if param2 == True:
       code_chunk_2
</code></pre>

<p>My first idea was to use this decorator:</p>

<pre><code>def refactorMe(func):
    def wrapper(*args):
        if args[-1]:
            code_chunk_1

        func(*args)

        if args[-1]:
            code_chunk_2

    return wrapper
</code></pre>

<p>And finally:</p>

<pre><code>@refactorMe
def fooA(param1, param2):
    fooA_code  #uses only param1

@refactorMe
def fooB(param1, param2):
    fooB_code  #uses only param1
</code></pre>

<p>Unfortunately, I'm not happy with this solution:</p>

<ul>
<li>This decorator is ""intrusive"" and specific to the fooA &amp; fooB functions</li>
<li>param2 is not used anymore in the fooA &amp; fooB body, but we must keep it in the function signature</li>
</ul>

<p>Perhaps I'm not using the decorator for its initial purpose?</p>

<p>Is there any other way to refactor the code?</p>

<p>Thanks a lot!</p>
","<python><refactoring><decorator>","4","431","2009-08-25 10:24:23"
"1327879","How can I refactor this rails code - a key/value model","<p>I have the following models:</p>

<pre><code>class FieldEntryValue &lt; ActiveRecord::Base
  belongs_to :field_entry
end
</code></pre>

<p>and</p>

<pre><code>class FieldEntry &lt; ActiveRecord::Base
  belongs_to :field
  belongs_to :media
  has_many :field_entry_values, :dependent =&gt; :destroy
  accepts_nested_attributes_for :field_entry_values, :allow_destroy =&gt; true
end
</code></pre>

<p>The <code>FieldEntriesController</code> has the following methods:</p>

<pre><code>  def new
    @field_entry = FieldEntry.new
    session[:media_id] = params[:media_id]
    session[:field_id] = params[:field_id]
    @field_entry.field = Field.find(params[:field_id])
    generate_fields(true)
    respond_to do |format|
      format.html # new.html.erb
      format.xml  { render :xml =&gt; @field_entry }
    end
  end

  def create
    @field_entry = FieldEntry.new(params[:field_entry])
    @field_entry.media_id = session[:media_id]
    @field_entry.field_id = session[:field_id]
    generate_fields(false)
    respond_to do |format|
      if @field_entry.save
        flash[:notice] = 'FieldEntry was successfully created.'
        format.html { redirect_to(@field_entry) }
        format.xml  { render :xml =&gt; @field_entry, :status =&gt; :created, :locati$
      else
        format.html { render :action =&gt; ""new"" }
        format.xml  { render :xml =&gt; @field_entry.errors, :status =&gt; :unprocess$
      end
    end
  end

  def generate_fields(do_build)
    @ftype = @field_entry.field.field_type.name
    if @ftype == 'string'
      @field_entry.field_entry_values.build if do_build
      @field_entry.field_entry_values[0].key='name'
    elsif @ftype == 'url'
      2.times{ @field_entry.field_entry_values.build } if do_build
      @field_entry.field_entry_values[0].key='name'
      @field_entry.field_entry_values[1].key='url'
    elsif @ftype == 'imdb'
      1.times{ @field_entry.field_entry_values.build } if do_build
      @field_entry.field_entry_values[0].key='value'
    end
  end
</code></pre>

<p>And I have a partial that is loaded by new and edit:</p>

<pre><code>&lt;% form_for(@field_entry) do |f| %&gt;
  &lt;%= f.error_messages %&gt;

  &lt;% f.fields_for :field_entry_values do |fv_f| %&gt;
    &lt;p&gt;
    &lt;%= fv_f.label :key %&gt;&lt;br /&gt;
    &lt;%= fv_f.text_field :value %&gt;
    &lt;/p&gt;
  &lt;% end %&gt;

  &lt;p&gt;
    &lt;%= f.submit 'Save' %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>The view should show a variable count fields depending on the type and with a given attribute key as label and value for the data.</p>

<p>For the type string as an example I need a label ""Name"" (that should be the key) and value </p>

<p>This works mostly except <code>""fv_f.label :key""</code> shows the string key and not the value of the key-field.</p>

<ol>
<li><p>How can I show the value of <code>@field_entry.field_entry_values.key</code> as label in the view?</p></li>
<li><p>How can I make the Controller better/shorter. As an example, do I really need to set       <code>@field_entry.field_entry_values[0].key='name'</code> in the new and the create method to to get it displayed in the view and saved in the database?</p></li>
</ol>

<p>thanx for suggestions ;) I am a Rails newby I hope I did it not too wrong ;)</p>
","<ruby-on-rails><refactoring>","0","313","2009-08-25 12:10:58"
"1329138","How to make Databinding type safe and support refactoring","<p>When I wish to bind a control to a property of my object, I have to provide the name of the property as a string.  This is not very good because:</p>

<ol>
<li>If the property is removed or
renamed, I don’t get a compiler
warning. </li>
<li>If a rename the property
with a refactoring tool, it is
likely the data binding will not be
updated. </li>
<li>I don’t get an error until
runtime if the type of the property
is wrong, e.g. binding an integer to
a date chooser.</li>
</ol>

<p>Is there a design-pattern that gets round this, but still has the ease of use of data-binding?</p>

<p>(This is a problem in WinForm, Asp.net and WPF and most likely lots of other systems)</p>

<p>I have now found ""<a href=""http://stackoverflow.com/questions/301809/workarounds-for-nameof-operator-in-c-typesafe-databinding"">workarounds for nameof() operator in C#: typesafe databinding</a>"" that also has a good starting point for a solution.</p>

<p>If you are willing to use a post processor after compiling your code, <a href=""http://code.google.com/p/notifypropertyweaver/"" rel=""nofollow"">notifypropertyweaver</a> is well worth looking at.</p>

<hr>

<p>Anyone knows of a good solution for WPF when the bindings are done in XML rather then C#?</p>
","<c#><.net><data-binding><refactoring><type-safety>","42","6276","2009-08-25 15:44:01"
"1330535","Can this JavaScript be optimized?","<p>This JS will be executed on pages with a lot of fields. Can you see anyway to improve the speed of this code? If so, can you explain what you found?</p>

<pre><code>var _TextInputs = null;
function GetTextInputs()
{
    if (_TextInputs == null)
    {
        _TextInputs = jq('input[type=text]');
    }

    return _TextInputs;
}

var _Spans = null;
function GetSpans()
{
    if (_Spans == null)
    {
        _Spans = jq('span');
    }

    return _Spans;
}


function UpdateRate(ratefield, name)
{
    GetTextInputs().filter('[' + name + ']').each(function()
    {
        this.value = FormatCurrencyAsString(FormatCurrencyAsFloat(ratefield.value));
        CalculateCharge(name.replace('Rate', ''), jq(this).attr(name));
    });
}

function CalculateCharge(name, activity_id)
{
    var inputs = GetTextInputs();
    var bill_field = inputs.filter('[' + name + 'Bill=' + activity_id + ']');
    var rate_field = inputs.filter('[' + name + 'Rate=' + activity_id + ']');
    var charge_field = GetSpans().filter('[' + name + 'Charge=' + activity_id + ']'); 

    charge_field.text(FormatCurrencyAsString(FormatCurrencyAsFloat(bill_field.val()) * FormatCurrencyAsFloat(rate_field.val())));
}
</code></pre>
","<javascript><jquery><performance><refactoring>","2","246","2009-08-25 19:48:06"
"1333133","How do you convince your manager that your project needs a huge refactoring?","<p>I have joined a rails project as a contractor. The project has been going for more than a year. The code is written by about 10 different developers and most of them are contractors as well. They have different code style. Some of them came from Java. The code has horrible scores with metric_fu. Many functions are very long (100 - 300 lines). Some functions have insane amount of logical branches, loops, and recursions. Each request generates a ton of sql queries. Performance is very bad. Many obsolete code that are never used but never got the chance to be cleaned up. The core architecture is plain wrong or over engineered. Code coverage is only about 25%. Views and partials are chaotic and terrible to read and understand.</p>

<p>The manager is in a position trying to satisfy the CEO by continuously adding new features, however newer features are increasingly hard to get implemented correctly without breaking something else. He knows the code is bad, but doesn't want to put too much effort in fixing them as refactoring will take too long.</p>

<p>As a contractor / developer, what is a good way to clear this situation and convenience the Manager or CEO to partition some time for refactoring? </p>

<p><strong>Related Questions</strong></p>

<p><a href=""http://stackoverflow.com/questions/38144/how-can-i-convince-skeptical-management-and-colleagues-to-allow-refactoring-of-aw"">How can I convince skeptical management and colleagues to allow refactoring of awful code?</a></p>

<p><a href=""http://stackoverflow.com/questions/737671/how-to-refactor-on-a-budget"">How to refactor on a budget</a></p>

<p><a href=""http://stackoverflow.com/questions/497234/dealing-with-illogical-managers"">Dealing with illogical managers</a></p>
","<ruby-on-rails><ruby><refactoring>","6","566","2009-08-26 08:19:37"
"1339629","Visual Basic 6 public variables to properties","<p>i`m working on the legacy project in VB6 with huge object all with public variables.
I want to convert these public variables to private variable/property combinations.
Is there some tools with which i can do these conversion?(optimally all variables in class at once)</p>

<p>Thanks</p>
","<class><properties><vb6><refactoring>","2","463","2009-08-27 08:22:49"
"1339215","How to make this method non-recursive?","<p>Hey. This example is pretty specific but I think it could apply to a broad range of functions.
It's taken from some online programming contest.</p>

<p>There is a game with a simple winning condition. Draw is not possible. Game cannot go on forever because every move takes you closer to the terminating condition. The function should, given a state, determine if the player who is to move now has a winning strategy.
In the example, the state is an integer. A player chooses a non-zero digit and subtracts it from the number: the new state is the new integer. The winner is the player who reaches zero.</p>

<p>I coded this:</p>

<pre><code>from Memoize import Memoize

@Memoize
def Game(x):
    if x == 0: return True
    for digit in str(x):
        if digit != '0' and not Game(x-int(digit)):
            return True
    return False
</code></pre>

<p>I think it's clear how it works. I also realize that for this specific game there's probably a much smarter solution but my question is general. However this makes python go crazy even for relatively small inputs. Is there any way to make this code work with a loop?</p>

<p>Thanks</p>

<p>This is what I mean by translating into a loop:</p>

<pre><code>def fac(x):
    if x &lt;= 1: return x
    else: return x*fac(x-1)

def fac_loop(x):
    result = 1
    for i in xrange(1,x+1):
        result *= i
    return result

## dont try: fac(10000)
print fac_loop(10000) % 100 ## works
</code></pre>
","<python><recursion><refactoring>","2","966","2009-08-27 06:33:42"
"1342556","How can I separate SQL from my PHP?","<p>Following Uncle Bob's avice in <a href=""http://books.google.com/books?id=dwSfGQAACAAJ&amp;dq=clean+code&amp;ei=kr-WSvCrM56SygTatojQBw"" rel=""nofollow"">Clean Code</a>, I'd like to have no SQL in my PHP code. Presently I'm making use of Prepared Statements and I've factored my database access code into model classes. </p>

<p>My initial thought is to break out my SQL into separate SQL files and then load them at runtime.  Since this involves more disk IO (my gut feeling), I'm wondering if anyone has suggestions on doing it another way.</p>

<p>Also, I'm interested to know if anyone's tried this and what dividends (if any it pays off).</p>

<p>Thank you.</p>
","<php><sql><refactoring>","2","427","2009-08-27 17:28:40"
"1344801","Converting enum into a class hierarchy","<p>Let's say I am writing a class in Cocoa to act as a proxy to a server. To represent the current state of the connection, consider the enumeration:</p>

<pre><code>enum
{
    MyConnectionStatusDisconnected = 0,
    MyConnectionStatusConnecting,
    MyConnectionStatusConnected,
    MyConnectionStatusCount
};
typedef NSUInteger MyConnectionStatus;
</code></pre>

<p>I may have it live in my proxy class like so:</p>

<pre><code>@interface ServerProxy : NSObject
{
    MyConnectionStatus connectionStatus;
}
</code></pre>

<p>That's fine, but what if I want to figure out a user-readable interpretation of the connection status? I might have a static function like this:</p>

<pre><code>+(NSString*)statusStringForInt:(MyConnectionStatus)status;
</code></pre>

<p>At this point I'm quickly leaving the realm of object-oriented programming.</p>

<p><strong>What would be the best way to refactor this enum into a class hierarchy?</strong></p>
","<objective-c><cocoa><design-patterns><refactoring>","0","301","2009-08-28 02:54:59"
"1355101","Test -> Code -> Refactor, when should we start a refactoring?","<p>The TDD circle is:</p>

<pre><code>""Write failing Test"" -&gt; ""Write Code to fit a Test"" -&gt; ""Refactor""
</code></pre>

<p>At ""Coding"" step we are assumed to write code as simple as possible, just to fix a failing test. We should not write complex code until it is really required.</p>

<p>The next step is Refactor. Should we refactor just written code? I think there is no real sence, as we should be happy with code as far as tests are passing. </p>

<p>Probably Refactoring activity should be forced by some thing, like Code writing is foced by failing Tests. Here some possible factors:</p>

<ol>
<li>The next test to be written requires some changes in system (refactoring)</li>
<li>Performance is bad. We need to improve it without breaking the functionality</li>
<li>Code review reveals that the code written is hard to understand.</li>
</ol>

<p>What other reasons you see to start the Refactoring?</p>

<p>Also, is this scheme correct:</p>

<pre><code>""Write failing Test"" -&gt; ""Code"" -&gt; ""Refactor"" -&gt; ""Write failing Test""
</code></pre>

<p>or may be it should be seen as</p>

<pre><code>""Write failing Test"" -&gt; ""Code/Refactor"" -&gt; ""Write failing Test""
+
""External factor (like bad performance)"" -&gt; ""Refactor"".
</code></pre>
","<refactoring><tdd>","2","607","2009-08-30 22:33:54"
"1355818","Renaming packages in Eclipse","<p>In Eclipse's ""Package Explorer"", let's say I have a list of packages like this:</p>

<ul>
<li>com.dog</li>
<li>com.cat</li>
<li>com.frog</li>
</ul>

<p>If I want to rename the ""com"" part of the package structure to be ""animal"", then I could select each package (above) and perform a refactor > rename.</p>

<p>If I have many packages that start with ""com"", that process may take a while.  Is there an easy way to rename the ""com"" package name without having to individually rename each package in the Package Explorer? or removing those packages from the build path before renaming?</p>

<p>I tried going to the ""Navigator"" pane where it displays the folders in a tree structure but I am not given the rename capability.</p>
","<java><eclipse><refactoring>","13","9203","2009-08-31 04:42:58"
"1357732","JPA reference refactoring","<p>I refactor some classes from standard SQL to JPA/ORM usage. In most cases the Objects have a ""real"" reference but sometimes the references to other objects are only given by an unchecked database id reference (no foreign key, just simple a string with a reference to another table id). </p>

<p>The code looks like:</p>

<pre><code>@Entity
public final class myEntity implements Serializable {
    @Id
    @GeneratedValue(generator = ""system-uuid"")
    @GenericGenerator(name = ""system-uuid"", strategy = ""uuid"")
    @Column(name = ""ID"")
    private String id;

    @OneToOne
    @JoinColumn(name = ""OBJREF"", nullable = false)
    private otherObject objReference; /* Nice object reference */

    @Column(name = ""OTHEROBJREF"")
    private String otherObjReference; /* Damn db reference used by legacy code */
}
</code></pre>

<p>How should I deal with the otherObjReference? The attribute is used by legacy systems which need the static getter/setter construct with a String! If I stay with the ID I'll have problems with JPA queries and I can't simply assign an object and persist it.</p>

<p>I thought about making the String transient and work with @PrePersist and @PreLoad to load an ""real"" object reference so I can work with both. But in those methods I've no access to the EntityManager (and the persistence shouldn't be the task of this pojo in this case... it smells like bad design if I'll load references here).</p>

<p>Because the ""otherObjReference"" is private, I can also use getters and setters to load data from my real reference. But other layers work with the objects, so they'll fail when they call a getOtherObjReference() method because they've no db connection to load the object.</p>
","<java><jpa><refactoring>","2","516","2009-08-31 14:28:33"
"1360360","MS Access - Query Refactoring Assistance","<p>I have a page in one of my client's websites that generates an extensive report pulling data from numerous tables throughout the website's MS Access database. One of the unfortunate architectural issues of the website is the existence of two nearly identical tables that represent the same ""type"" of data, but one is an ""old"" version and the other is a ""new"" version. When the report is generated I need to perform some aggregate operations on the two similar tables. The initial query joined these tables into the rest of the data and called the appropriate aggregate functions on the joined tables. Soon I realized that a join would not work because the two tables do not necessarily have the same row count, thus causing the aggregate function to improperly group the rows from both tables...</p>

<p>Were this MSSQL or MySQL I would probably create a VIEW containing the composite data from both tables, but unfortunately I'm stuck in MS Access where such ""novel"" concepts do not exist... The solution I was able to come up with works, but has got to be some of the ugliest SQL I have ever seen. Basically, I create a SQL query including all of the appropriate columns from multiple joined tables and one of the two similar tables. Then I create a second SQL query containing all of the same fields and join the other similar table. Finally, I <code>UNION</code> the two queries and wrap them into a subquery within the <code>FROM</code> clause of an outer query.</p>

<p>The end result is a massive query with a ton of duplicate selects that I included only because of the need to aggregate data from the two similar tables. I really would like to refactor the query into something less awful, but I'm not sure where to start... Any advice?</p>

<pre><code>SELECT contractid,
	pholderid,
	policyholdername,
	policyholdercity,
	policyholderstate,
	vehicleyear,
	vehiclemake,
	vehiclemodel,
	Iif(claimmileage &gt; vehiclemileage, claimmileage, vehiclemileage)                       AS mileage,
	clientname,
	contracttype,
	contractmonths,
	wholesaleprice,
	begindate,
	cancelleddate,
	cancelledalphatotal,
	paiddate,
	voided,
	Sum(claimscost)                                                                        AS totalclaimscost,
	Sum(claimscount)                                                                       AS totalclaimscount,
	DateAdd('m', contractmonths, begindate)                                                AS expirationdate,
	Iif(paiddate IS NOT NULL AND contractmonths &gt; 0,
	   Iif(voided = true,
		   Iif(cancelleddate IS NOT NULL,
			   Iif(((cancelleddate - begindate) / (364.25 / 12)) &gt;= contractmonths,
				   1,
				   ((cancelleddate - begindate) / (364.25 / 12)) / contractmonths),
			   Iif(((Date() - begindate) / (364.25 / 12)) &gt;= (contractmonths),
				   1,
				   ((Date() - begindate) / (364.25 / 12)) / contractmonths)),
		   ((Date() - begindate) / (364.25 / 12)) / contractmonths),
	   0)                                                                                   AS earnedfactor,
	(earnedfactor * wholesaleprice)                                                         AS earnedpremium,
	Iif(voided = true, 0, (wholesaleprice - earnedpremium))                                 AS unearnedpremium,
	Iif(voided = true AND cancelledalphatotal IS NOT NULL,  cancelledalphatotal, 0)         AS refund,
	Iif(earnedpremium &gt; 0,totalclaimscost / earnedpremium, 0)                               AS lossratio
   FROM     (SELECT contracts.id                     AS contractid,
		  policyholders.id                 AS pholderid,
		  policyholders.firstname
			+ ' '
			+ policyholders.lastname       AS policyholdername,
		  policyholders.city               AS policyholdercity,
		  policyholders.state              AS policyholderstate,
		  vehicles.yr                      AS vehicleyear,
		  vehicles.make                    AS vehiclemake,
		  vehicles.model                   AS vehiclemodel,
		  vehicles.mileage                 AS vehiclemileage,
		  clients.coname                   AS clientname,
		  contracttypes.name               AS contracttype,
		  coverageavailable.contractmonths AS contractmonths,
		  contracts.contractwholesalecost  AS wholesaleprice,
		  contracts.begindate              AS begindate,
		  contracts.cancelledon            AS cancelleddate,
		  contracts.cancelledalphatotal    AS cancelledalphatotal,
		  contracts.paidon                 AS paiddate,
		  contracts.voided                 AS voided,
		  Sum(Iif(claims.totalrepaircost IS NULL,0,claims.totalrepaircost))                              AS claimscost,
		  Count(claims.id)                    AS claimscount,
		  Max(Iif(claims.currentmileage IS NULL,0,claims.currentmileage))                              AS claimmileage
   FROM   claims
		  RIGHT JOIN (coverageavailable
					  INNER JOIN ((((policyholders
									 INNER JOIN clients
									   ON policyholders.clientid = clients.id)
									INNER JOIN contracts
									  ON policyholders.id = contracts.policyholderid)
								   INNER JOIN vehicles
									 ON contracts.vehicleid = vehicles.id)
								  INNER JOIN contracttypes
									ON contracts.contracttypeid = contracttypes.id)
						ON coverageavailable.id = contracts.termid)
			ON claims.policyholderid = policyholders.id
   WHERE  contractmonths &gt; 0
		  AND contracts.begindate IS NOT NULL
		  AND contracttypes.id &lt;&gt; 3
   GROUP BY contracts.id,
	 policyholders.id,
	 policyholders.firstname,
	 policyholders.lastname,
	 policyholders.city,
	 policyholders.state,
	 vehicles.yr,
	 vehicles.make,
	 vehicles.model,
	 vehicles.mileage,
	 clients.coname,
	 contracttypes.name,
	 coverageavailable.contractmonths,
	 contracts.contractwholesalecost,
	 contracts.begindate,
	 contracts.cancelledon,
	 contracts.paidon,
	 contracts.voided,
	 contracts.cancelledalphatotal
	   UNION
	   SELECT contracts.id                     AS contractid,
		  policyholders.id                 AS pholderid,
		  policyholders.firstname
			+ ' '
			+ policyholders.lastname       AS policyholdername,
		  policyholders.city               AS policyholdercity,
		  policyholders.state              AS policyholderstate,
		  vehicles.yr                      AS vehicleyear,
		  vehicles.make                    AS vehiclemake,
		  vehicles.model                   AS vehiclemodel,
		  vehicles.mileage                 AS vehiclemileage,
		  clients.coname                   AS clientname,
		  contracttypes.name               AS contracttype,
		  coverageavailable.contractmonths AS contractmonths,
		  contracts.contractwholesalecost  AS wholesaleprice,
		  contracts.begindate              AS begindate,
		  contracts.cancelledon            AS cancelleddate,
		  contracts.cancelledalphatotal    AS cancelledalphatotal,
		  contracts.paidon                 AS paiddate,
		  contracts.voided                 AS voided,
		  Sum(Iif(claim.inspector1paidout IS NULL,0,claim.inspector1paidout))
				   + Sum(Iif(claim.inspector2paidout IS NULL,0,claim.inspector2paidout))
				   + Sum(Iif(claim.mechanicpaidout IS NULL,0,claim.mechanicpaidout))
				   + Sum(Iif(claim.partdealerpaidout IS NULL,0,claim.partdealerpaidout))                              AS claimscost,
		  Count(claim.id)                    AS claimscount,
		  Max(Iif(claim.mileage IS NULL,0,claim.mileage))                              AS claimmileage
   FROM   claim
		  RIGHT JOIN (coverageavailable
					  INNER JOIN ((((policyholders
									 INNER JOIN clients
									   ON policyholders.clientid = clients.id)
									INNER JOIN contracts
									  ON policyholders.id = contracts.policyholderid)
								   INNER JOIN vehicles
									 ON contracts.vehicleid = vehicles.id)
								  INNER JOIN contracttypes
									ON contracts.contracttypeid = contracttypes.id)
						ON coverageavailable.id = contracts.termid)
			ON claim.contractid = contracts.id
   WHERE  contractmonths &gt; 0
		  AND contracts.begindate IS NOT NULL
		  AND contracttypes.id &lt;&gt; 3
   GROUP BY contracts.id,
	 policyholders.id,
	 policyholders.firstname,
	 policyholders.lastname,
	 policyholders.city,
	 policyholders.state,
	 vehicles.yr,
	 vehicles.make,
	 vehicles.model,
	 vehicles.mileage,
	 clients.coname,
	 contracttypes.name,
	 coverageavailable.contractmonths,
	 contracts.contractwholesalecost,
	 contracts.begindate,
	 contracts.cancelledon,
	 contracts.paidon,
	 contracts.voided,
	 contracts.cancelledalphatotal)
GROUP BY contractid,
		pholderid,
		policyholdername,
		policyholdercity,
		policyholderstate,
		vehicleyear,
		vehiclemake,
		vehiclemodel,
		vehiclemileage,
		clientname,
		contracttype,
		contractmonths,
		wholesaleprice,
		begindate,
		cancelleddate,
		cancelledalphatotal,
		paiddate,
		voided,
		Iif(claimmileage &gt; vehiclemileage, claimmileage, vehiclemileage)
ORDER BY clientname,
		begindate DESC
</code></pre>

<p>Hopefully all that makes at least some sense...</p>
","<sql><query><ms-access><refactoring>","0","150","2009-09-01 03:16:51"
"1365409","Refactored methods and binary compatibility in Java","<p>When refactoring methods it is easy to introduce binary incompabilities (with previous versions of the code) in Java. </p>

<p>Consider changing a method to widen the type of its parameter to a parent interface:</p>

<pre><code> void doSomething(String x);

 // change it to

 void doSomething(CharSequence c);
</code></pre>

<p>All the code that uses this method will continue to compile without changes, but it does require a re-compile (because the old binaries will fail with a MethodNotFoundError).</p>

<p>How about pulling a method up into a parent class. Will this require a re-compile?</p>

<pre><code>// before
public class B extends A{
    protected void x(){};
}

// after
public class A {
    public void x(){};
}
public class B extends A{}
</code></pre>

<p>The method has been moved from B to the parent A. It has also changed visibility from protected to public (but that is not a problem).</p>

<p>Do I need to maintain a ""binary compatibility wrapper"" in B, or will it continue to work (automatically dispatch to the parent class)?</p>

<pre><code> // do I need this ?
 public class B extends A{
     // binary compatibility wrapper
     public void x(){ super.x(); }
 }
</code></pre>
","<java><refactoring><binary-compatibility>","4","229","2009-09-02 01:01:26"
"1364946","What is the highest Cyclomatic Complexity of any function you maintain? And how would you go about refactoring it?","<p>I was doing a little exploring of a legacy system I maintain, with <a href=""http://www.ndepend.com/"" rel=""nofollow"">NDepend</a> (great tool check it out), the other day. My findings almost made me spray a mouthful of coffee all over my screen. The top 3 functions in this system ranked by descending cyclomatic complexity are:</p>

<ol>
<li>SomeAspNetGridControl.CreateChildControls (CC of 171!!!) </li>
<li>SomeFormControl.AddForm (CC of 94)</li>
<li>SomeSearchControl.SplitCriteria (CC of 85)</li>
</ol>

<p>I mean 171, wow!!! Shouldn't it be <a href=""http://stackoverflow.com/questions/20702/whats-your-a-good-limit-for-cyclomatic-complexity"">below 20</a> or something? So this made me wonder. What is the most complex function you maintain or have refactored? And how would you go about refactoring such a method?</p>

<p><strong>Note:</strong> The CC I measured is over the code, not the IL.</p>
","<refactoring><cyclomatic-complexity>","2","836","2009-09-01 22:23:16"
"1368973","Find redundant pages, files, stored procedures in legacy applications","<p>I have several horrors of old ASP web applications. Does anyone have any easy ways to find what scripts, pages, and stored procedures are no longer needed? (besides the stuff in ""old___code"", ""delete_this"", etc ;-)</p>
","<sql-server><asp-classic><refactoring><legacy-code>","0","96","2009-09-02 17:05:32"
"1370826","Excract JPanel into new class in NetBeans","<p>This is similar to <a href=""http://stackoverflow.com/questions/691890/reusing-a-jpanel-in-netbeans-gui-designer"">this</a> question, except the code is already written.</p>

<p>I have </p>

<pre><code>JFrame
  JTabbedPane
    JPanel X
      &lt;...&gt;
    JPanel Y
      &lt;...&gt;
    JPanel Z
      &lt;...&gt;
</code></pre>

<p>all defined in the same class, but I want to move each panel into its own .java file. I really don't want to manually copy-paste from the underlying .form and .java files if I don't have to. Each panel is mostly decoupled from the others already, which is why I want to create separate files for each.</p>

<p>What is the best way to split this into four separate classes (1 JFrame, 3 JPanels) using NetBeans so that it will move all of its autogenerated code correctly? </p>
","<java><gui><netbeans><refactoring>","0","296","2009-09-03 00:14:54"
"1371940","Unit testing: Is it a good practice to have assertions in setup methods?","<p>In unit testing, the setup method is used to create the objects needed for testing.</p>

<p>In those setup methods, I like using assertions: I know what values I want to see in those
objects, and I like to document that knowledge via an assertion.</p>

<p>In a recent post on <a href=""http://stackoverflow.com/questions/1368900/unit-testing-is-it-bad-form-to-have-unit-test-calling-other-unit-tests"">unit tests calling other unit tests</a> here on stackoverflow, the general feeling seems to be that unit tests should <em>not</em> call other tests:
The answer to that question seems to be that you should refactor your setup, so
that test cases do not depend on each other.</p>

<p>But there isn't much difference in a ""setup-with-asserts"" and a 
unit test calling other unit tests.</p>

<p>Hence my question: Is it good practice to have assertions in setup methods? </p>

<p>EDIT:</p>

<p>The answer turns out to be: this is not a good practice in general. If the setup results need to be tested, it is recommended to add a separate test method with the assertions (the answer I ticked); for documenting intent, consider using Java asserts.</p>
","<unit-testing><refactoring><fixtures><assertions>","7","538","2009-09-03 07:38:15"
"1372059","Advantages/Disadvantages of Refactoring Tools","<p>what are the advantages and disadvantages of refactoring tools, in general?</p>
","<language-agnostic><refactoring>","3","647","2009-09-03 08:10:22"
"1374435","How to find references when refactoring rails application with textmate?","<p>I have been practicing TDD in C# for several years now and recently have moved to Ruby on Rails full time. I am continuing the practice of TDD with RSpec. My question is regarding the process of finding references while refactoring. In Visual Studio I was addicted to Resharper's ""find all references"" when renaming or replacing methods. </p>

<p>How do test driven practitioners in ruby find references to methods when replacing/renaming/etc?</p>

<p>I realize because ruby is a dynamic language a ""find all references"" IDE function would not  work, so any I am looking for a shift in thinking as much as a simple solution.</p>

<p>Thanks 
- Lee</p>
","<ruby-on-rails><ruby><refactoring><tdd><textmate>","2","362","2009-09-03 16:17:07"
"1375337","When you're the new guy and you keep seeing dumb things - do you refactor them?","<p>Do you refactor when you see things like this?  Or do you just plug your nose and move on?</p>

<pre><code>    public Collection&lt;DataValidationRuleBase&gt; GetFieldValidationRules(String key)
    {
        Collection&lt;DataValidationRuleBase&gt; found = null;
        try
        {
            this.mRules.TryGetValue(key, out found);
        }
        catch (ArgumentException ex)
        {
            //log the error
            Log.Error(ExceptionHandling.BuildExceptionMessage(ex));
            return null;
        }
        return found;
    }
</code></pre>
","<refactoring><social>","0","552","2009-09-03 19:08:06"
"1376459","What are Database Smells? What is the easiest way to correct them?","<p>Scott W. Ambler has put up a good list of <a href=""http://www.agiledata.org/essays/databaseRefactoringSmells.html"" rel=""nofollow"">basic database smell</a>s. 
It would be good to see how these can be corrected, what database refactorings can be applied as a remedy and if any smells are missing from the list.</p>

<p>For ""ground rules"" when replying, take a look at question on <a href=""http://stackoverflow.com/questions/114342/what-are-code-smells-what-is-the-best-way-to-correct-them"">programming smells</a> if you please.</p>
","<database><code-smell><refactoring-databases>","10","692","2009-09-03 23:18:25"
"1374755","Refactoring an If else tree","<p>I have an if else tree that is going to grow as I add additional items for it to maintain and I'm looking at the best way to write it for maintainability I'm starting with this code </p>

<pre><code>private void ControlSelect()
{

    if (PostingType == PostingTypes.Loads &amp;&amp; !IsMultiPost)
    {
    	singleLoadControl.Visible = true;
          singleTruckControl.Visible = false;
          multiTruckControl.Visible = false;
          multiLoadControl.Visible = false;
    }
    else if (PostingType == PostingTypes.Trucks &amp;&amp; !IsMultiPost)
    {
    	singleLoadControl.Visible = false;
          singleTruckControl.Visible = true;
          multiTruckControl.Visible = false;
          multiLoadControl.Visible = false;
    }
    else if (PostingType == PostingTypes.Loads &amp;&amp; IsMultiPost)
    {
    	singleLoadControl.Visible = false;
          singleTruckControl.Visible = false;
          multiTruckControl.Visible = false;
          multiLoadControl.Visible = true;
    }
    else if (PostingType == PostingTypes.Trucks &amp;&amp; IsMultiPost)
    {
    	singleLoadControl.Visible = false;
        singleTruckControl.Visible = false;
          multiTruckControl.Visible = true;
        multiLoadControl.Visible = false;
    }
}
</code></pre>

<p>and thinking of re-factoring it to something like this</p>

<pre><code>private void ControlSelect()
{
    List&lt;UserControl&gt; controlList = GetControlList();

      string visableControl = singleLoadControl.ID;
      if (PostingType == PostingTypes.Loads &amp;&amp; !IsMultiPost)
      {
        visableControl = singleLoadControl.ID;
      }
      else if (PostingType == PostingTypes.Trucks &amp;&amp; !IsMultiPost)
      {
        visableControl = singleTruckControl.ID;
      }
      else if (PostingType == PostingTypes.Loads &amp;&amp; IsMultiPost)
      {
        visableControl = multiLoadControl.ID;
      }
      else if (PostingType == PostingTypes.Trucks &amp;&amp; IsMultiPost)
      {
        visableControl = multiTruckControl.ID;
      }

      foreach (UserControl userControl in controlList)
      {
        userControl.Visible = (userControl.ID == visableControl);
      }
}

private List&lt;UserControl&gt; GetControlList()
{
    List&lt;UserControl&gt; controlList = new List&lt;UserControl&gt;
      {
        singleLoadControl,
            multiTruckControl,
            singleTruckControl,
            multiLoadControl
      };
      return controlList;
}
</code></pre>

<p>I take a performance hit but I can manage all of my controls is a single place</p>

<p>my other thought was to make each selected control block it own method, something like this</p>

<pre><code>private void SetSingleLoadControlAsSelected()
{
      singleLoadControl.Visible = true;
      singleTruckControl.Visible = false;
      multiTruckControl.Visible = false;
      multiLoadControl.Visible = false;
}
</code></pre>

<p>I don't take a performance hit but I'm maintaining the controls in multiple location</p>

<p>I'm leaning for option one just because I like maintainability aspect of it.</p>
","<c#><.net><refactoring>","6","745","2009-09-03 17:12:11"
"1378703","How to refactor global variables out of your code","<p>The discussion around global variables and their misuse seems to hold a a certain dogmatic tone to it. I am not here to dispute the ""globals are bad"" concept as it makes sense to me why they are bad. However I was wondering if people had some interesting code snippets that demonstrate exactly how to effectively refactor higher scoped variables and objects out of the code. In this question I am looking for examples or patterns of generic but useful solutions to the ""I need to use a global variable here because it is easy"" problem.  </p>

<p>Here is a hypothetical and perhaps contrived example. I am using the global variable to keep track of the parameters sent to a function. And then if there is a failure that happens further down the chain I could go back and call the function again using parameters from the global variable.</p>

<pre><code>public var myGlobalState:Object = new Object();


public function addPerson (name:String, person:Object, personCount:int, retryCount:int):void
{
   myGlobalState = null; // clear out old values

   myGlobalState = new Object();
   myGlobalState.name = name;
   myGlobalState.person = person;
   myGlobalState.personCount = personCount;
   myGlobalState.retryCount = retryCount;

   person.userId = personCount + 1;
   person.name = name;

   savePerson(person);

}

public function savePerson (person:Object):void
{
  // Some code that attempts to save the person object properties to a database...
  // process returns a status code for SUCCESS of FAILURE

  // CODE TO SAVE TO DATABASE ....

  // Return status code ... 

 if (status == ""fail"")
 {
   // Retry at least once by calling the addPerson function again 

   if (myGlobalState.retryCount &lt; 3)
   {
     addPerson (myGlobalState.name, person, myGlobalState.personCount, myGlobalState.retryCount);
   }

 }

}
</code></pre>
","<refactoring><global>","1","436","2009-09-04 11:32:07"
"1378741","Refactoring With Reflection","<p>I have several methods that populate a SQLCommand objects parameter collection from an object like this</p>

<pre><code>if (!String.IsNullOrEmpty(SearchObj.FirstName))
{
    command.AddParameter(Fields.FirstName, SearchObj.FirstName);
}
if (!String.IsNullOrEmpty(SearchObj.LastName))
{
    command.AddParameter(Fields.LastName, SearchObj.LastName);
}
if (!String.IsNullOrEmpty(SearchObj.EmailAddress))
{
    command.AddParameter(Fields.EmailAddress, SearchObj.EmailAddress);
}
if (SearchObj.JobRoleId &gt; -1)
{
    command.AddParameter(Fields.JobRoleId, SearchObj.JobRoleId);
}
</code></pre>

<p>This can get messy as the object can have up to about 20 properties. Is there anyway using reflection to loop through each of these properties and add them all to the Sqlcommand objects Parameter collection? Bearing in mind it treats strings different to ints in that it only adds a string if its not null or empty and it only adds an int if its greater than -1.</p>

<p>I've not used much reflection before, so a point in the right direction would be great.</p>

<p>Thanks</p>
","<asp.net><reflection><refactoring>","0","74","2009-09-04 11:38:29"
"1380806","Changing company name...do we change namespaces?","<p>We plan on changing our company name sometime soon. All of our namespaces, projects etc use XYZ.ComponentName.</p>

<p>My question to you would be should we change our namespaces? Change all the old components to ABC.ComponentName? Leave the old ones but any new development becomes ABC.ComponentName? Just stick with the old name?</p>
","<namespaces><refactoring>","13","657","2009-09-04 18:23:21"
"1385869","Refactoring a whole project's variable and parameter names","<p>I have inherited a large C# project where all the variable and parameter names are <code>written_like_this</code>.</p>

<p>Is there some easy way or tool I could use to rename them all automatically with no more than say 10 mouse clicks. So that the above example would become <code>writtenLikeThis</code> (i.e. camel case). And instance variables _<code>writtenLikeThis</code>.</p>

<p>It would also need to update the XMLDoc comments as well.</p>

<p>I could probably knock something up with a Regex, but only if I'm not rewriting a wheel.</p>

<p>Thanks.</p>
","<c#><refactoring>","1","289","2009-09-06 15:03:26"
"1388469","Is there a working C++ refactoring tool?","<p>Does anybody know a fully featured refactoring tool for C++ that works reliably with large code bases (some 100.000 lines)?</p>

<p>I tried whatever i can find again and again over the last years: SlickEdit, Eclipse CDT. They all were not at all usable. </p>

<p><strong>SUMMARY</strong>:
I took time and evaluated ""Visual Assist X"" as well as ""Refactor for C++"". Both have some impressing features, but both as well are far from perfect. Extracting a large block of code usually is not done satisfying without manual modifications - and therefore does not pay off.</p>

<p>""Visual Assist X"" has nice features such as much more complete autocompletition etc. But it leads to so much flickering and slows down much at certain points.</p>

<p>By my opinion therefore the answer is: ""No, there is no production ready refactoring tool for C++""</p>
","<c++><refactoring>","72","10127","2009-09-07 09:38:02"
"1388259","Cleaning up PHP, and cleaning up unnecessary code","<p>I'm still new to certain PHP functions.
Is there any way I can clean up the following code, because I know all of this is just unnecessary, and it's giving me a headache.
Everything after the if statement is the same for each set of code.</p>

<pre><code>    if($class == ""2""){if ($posts &gt;= 1){
$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1,points=points+25,tpoints=tpoints+25  WHERE `users`.`friendid`='$friend'"";
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());
if (!mysql_query($sql)) {die('Error: ' . mysql_error());} echo """";}
else {$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1 WHERE `users`.`friendid` = '$friend'"";
mysql_query($sql) or die(mysql_error());
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());}}


if($class == ""3""){if ($posts &gt;= 2){
$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1,points=points+25,tpoints=tpoints+25 WHERE `users`.`friendid`='$friend'"";
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());
if (!mysql_query($sql)) {die('Error: ' . mysql_error());} echo """";}
else {$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1 WHERE `users`.`friendid` = '$friend'"";
mysql_query($sql) or die(mysql_error());
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());}


if($class == ""4""){if ($posts &gt;= 3){
$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1,points=points+25,tpoints=tpoints+25 WHERE `users`.`friendid`='$friend'"";
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());
if (!mysql_query($sql)) {die('Error: ' . mysql_error());} echo """";}
else {$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1 WHERE `users`.`friendid` = '$friend'"";
mysql_query($sql) or die(mysql_error());
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());}}


if($class == ""5""){if ($posts &gt;= 4){
$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1,points=points+25,tpoints=tpoints+25 WHERE `users`.`friendid`='$friend'"";
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());
if (!mysql_query($sql)) {die('Error: ' . mysql_error());} echo """";}
else {$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1 WHERE `users`.`friendid` = '$friend'"";
mysql_query($sql) or die(mysql_error());
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());}}


if($class == ""6""){if ($posts &gt;= 5){
$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1,points=points+25,tpoints=tpoints+25 WHERE `users`.`friendid`='$friend'"";
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());
if (!mysql_query($sql)) {die('Error: ' . mysql_error());} echo """";}
else {$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1 WHERE `users`.`friendid` = '$friend'"";
mysql_query($sql) or die(mysql_error());
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());}}


if($class == ""7""){if ($posts &gt;= 6){
$sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1,points=points+25,tpoints=tpoints+25 WHERE `users`.`friendid`='$friend'"";
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error());
if (!mysql_query($sql)) {die('Error: ' . mysql_error());} echo """";}
else { $sql = ""UPDATE users SET posts=posts+1,tposts=tposts+1 WHERE `users`.`friendid` = '$friend'"";
mysql_query($sql) or die(mysql_error());
$insert = ""INSERT INTO proofs ( `ID` ,`friendid` ,`bulletinid`)VALUES('', '$friend' , '$binfo');"";
mysql_query($insert) or die(mysql_error()); }}}}}}
</code></pre>
","<php><refactoring><function>","0","276","2009-09-07 08:42:16"
"1389443","DRY unique objects in Django","<p>I want to ensure an object is unique, and to throw an error when a user tries to save it (e.g. via the admin) if not? By unique, I mean that some of the object's attributes might hold the same values as those of other objects, but they can't ALL be identical to another object's values.</p>

<p>If I'm not mistaken, I can do this like so:</p>

<pre><code>class Animal(models.Model):
    common_name = models.CharField(max_length=150)
    latin_name = models.CharField(max_length=150)
    class Meta:
        unique_together = (""common_name"", ""latin_name"")
</code></pre>

<p>But then each time I refactor the model (e.g. to add a new field, or to change the name of an existing field), I also have to edit the list of fields in the parenthesis assigned to <strong>unique_together</strong>. With a simple model, that's OK, but with a substantial one, it becomes a real hassle during refactoring.</p>

<p>How can I avoid having to repeat typing out the list of field names in the <strong>unique_together</strong> parenthesis? Is there some way to pass the list of the model's fields to a variable and to assign that variable to <strong>unique_together</strong> instead?</p>
","<django-models><refactoring><dry>","5","571","2009-09-07 13:31:14"
"1396166","refactoring and removing case statements when circling over an enum structure","<p>An enum structure declared in its own class is a member variable to the business logic class. That enum basically represents the state of that other class.</p>

<p>Although I have revisited the issue several times, replacing, or getting rid of those case statements proves quite frustrating to me.</p>

<p>Several business logic methods simple iterate over the enum and change the state of that class by assigning another value of the same enum, and other properties.</p>

<pre><code>    public enum MyEnum{ A,B,C,D }
</code></pre>

<p>The business logic class has this enum as a member:</p>

<pre><code>    public class BusinessLogic {
             private MyEnum CurrentSelection;
             private int propertyX;
             private int propertyY;

        public void operation1(){
            	switch(CurrentSelection){
            	case A: {alter propertyX this way; break;}
            	case B: {alter propertyY this way; break;}
            	case C: {alter propertyX that way; break;}
            	case D: {alter propertyY that way; break;}
            	}

            }

            public void operation2(){
            	switch(CurrentSelection){
            	case A: {CurrentSelection=MyEnum.B; break;}
            	case B: {CurrentSelection=MyEnum.C; break;}
            	....etc
            	}
            }

            public void operation3(){
            	switch(CurrentSelection){
            	case A: {CurrentSelection=MyEnum.D; break;}
            	case B: {CurrentSelection=MyEnum.A; break;}
            	....etc
            	}
            }
}
</code></pre>

<p>Another client class will instatiate the business logic class, initialing its properties and then using its operation methods.</p>

<p>What I have successfully done (with help from SO) is encapsulate the operation methods into a command pattern structure so I can call the operations without any case statements. (<a href=""http://stackoverflow.com/questions/1386673/trouble-making-polymorphism-defeat-those-switch-case-statements"">here</a>).</p>

<p>I guess my trouble is how to encapsulate the case statements in my business logic class. I suspect that I would need polymorphism and the appropriate data structures.</p>

<p>The refactoring experts suggest each case statement should be an implementation of a common interface. But if I have 3 methods iterating over a 4-member enum that means I'd probably need 3 interfaces with 4 implementations each, giving me 12 classes (plus 3 interfaces). Wouldn't that be a class overload? The logic is working fine with those 3 methods as they are, but the issue are the repeating switch/case statements.</p>

<p>Is there a way to refactor those switch statements but avoid a myriad of other classes in the name of polymorphism? Would it be possible to factor out the iterate-over-the-enum part? Or just the cases (where the logic is) should be refactored?</p>

<p>Many thanks in advance.</p>

<p><hr /></p>

<p>As a first step I removed those methods completely my having them implement a simple interface:</p>

<pre><code>public interface Command {
void execute();
</code></pre>

<p>}</p>

<p>So, its operation method implemented the command interface:</p>

<pre><code>public class Operation1 implements Command {
            private void doOperation1(){
                	switch(CurrentSelection){
                	..all the cases here
                	}

                }

        public void execute() {
    	doOperation1();
    }

}
</code></pre>

<p>As I see this, it will buy my a cleaner business logic class, but the trail of the switch cases will remain, right?</p>
","<java><design-patterns><refactoring><polymorphism><switch-statement>","1","863","2009-09-08 20:26:44"
"1397388","linking methods from an enum to member variables of client class","<p>The following enum structure performs certain operations while remaining agnostic to the client class (for encapsulation reasons)</p>

<pre><code>    public enum MyEnum implements Commands{
    A{
    	public int method1(int varY) {			
    		return varY+2;
    	}

    	public MyEnum method2(){
                       return MyEnum.B;
              }

             //...other methods implementing Commands interface
    },
    B{

    	public int method1(int varX) {
    		return varX-2;
    	}


               public MyEnum method2(){
                       return MyEnum.C;
              }

    	//...other methods implementing Commands interface
    },
    C{

    	public int method1(int varY) {
    		return varY-2;
    	}

    	public MyEnum method2(){
                        return MyEnum.D;
               }


              //...other methods implementing Commands interface
    },
    D{

    	public int method1(int varX) {
    		return varX+2;
    	}

    	public MyEnum method2(){
                      return MyEnum.A;
                 }


             //...other methods implementing Commands interface
    }
</code></pre>

<p>The client class</p>

<pre><code>    public class Client {
    private int varX;
    private int varY;
    private MyEnum enum;

    MyEnum getEnum(){
    	return enum;
    }

    int varX(){
    	return varX;
    }

    int getVarY(){
    	return varY;
    }

    public Client(int varX, int varY, MyEnum enum){
    	this.varX = varX;
    	this.varY = varY;
    	this.enum = enum;
    }

    public void performMethod1(MyEnum enum){		
    	varX = getEnum().method1(getVarX()); //???
    	varY = getEnum().method1(getVarY()); //???
    }

     public void performMethod2(...){
                enum = getEnum().method2();
      }
}
</code></pre>

<p>My question is how to link the specific implementations of method1() belonging to MyEnum.A and MyEnum.C so that they operate on Client class member varY, and the method1() implementations of MyEnum.B and MyEnum.D to operate only on Client class member variable varX.</p>

<p>For example within a main() method:</p>

<pre><code>Client aClient = new Client(aVarX, aVarY, anEnum);    
aClient.performMethod1(aClient.getEnum());
</code></pre>

<p>So, depending in the current enum state, the above statement should operate only on varX or varY and change the state on aClient.</p>

<p>Let's say for: </p>

<pre><code>aClient.performMethod1(MyEnum.A);
</code></pre>

<p>The state of <strong>aClient</strong> represented by <strong>varY</strong> should be changed to <strong>varY+2</strong>. varX should remain unchanged.</p>

<p>As you can see by the simple naming convention, at this time varX in MyEnum is not linked to varX in Client class in any way. My thoughts lean toward the type of the variables. Since I am working with primitives (int) there is no way to distinguish.. </p>

<p>Would you recommend I create different custom types for each of the varX and varY (wrap them somehow?) in Client class?</p>

<p>I hope I am not too verbose with the question. Please let me know in case I am not being clear with it. Many thanks.</p>
","<java><design-patterns><refactoring><enums><encapsulation>","0","190","2009-09-09 03:21:47"
"1398855","Which one will be faster","<p>Just calculating sum of two arrays with slight modification in code</p>

<pre><code>int main()

{

    int a[10000]={0};	//initialize something
    int b[10000]={0};	//initialize something

    int sumA=0, sumB=0;

    for(int i=0; i&lt;10000; i++)
    {
    	sumA += a[i];
    	sumB += b[i];
    }
        printf(""%d %d"",sumA,sumB);

}
</code></pre>

<p>OR</p>

<pre><code>int main()

{

    int a[10000]={0};	//initialize something
    int b[10000]={0};	//initialize something

    int sumA=0, sumB=0;

    for(int i=0; i&lt;10000; i++)
    {
    	sumA += a[i];

    }

        for(int i=0; i&lt;10000; i++)
    {		
    	sumB += b[i];
    }
        printf(""%d %d"",sumA,sumB); 
}
</code></pre>

<p>Which code will be faster.</p>
","<c++><c><refactoring><performance>","0","543","2009-09-09 10:36:56"
"1405738","Wrapping Booleans in Objects","<p>I have some code that I want to refactor. I have lots of methods that take multiple arguments of the same type, for example:</p>

<pre><code>public void foo(String name, String street, boolean b1, boolean b2) { ... }
</code></pre>

<p>and so on. Because the different objects can only be distinguished by name I would like to wrap them in Objects (Enums) so I can make <strong>use of the typesystem</strong> of the language (Java in this case). </p>

<pre><code>public class Name {
    private String value;
    public String getValue() { return value; }
    // ...
}
</code></pre>

<p>Like this I could force calling code to pass in Objects of a certain type. That would assure that it would not accidentally mix up the order of the method parameters and thus <strong>not produce unexpected behaviour at runtime</strong>:</p>

<pre><code>foo(new Name(""John""), new Street(""Broadway""), new B1(true), new B2(false);
</code></pre>

<p>This makes <strong>refactoring a lot safer</strong>, you can carry the object through the system as long as you want, the data inside it, the string is safe at all times. <strong>Only when you need it</strong>, you get it by calling getValue().</p>

<p>Now, for the Objects that wrap strings, it is pretty straightforward, as there are lots of states instances can be in. </p>

<p><strong>But how about the boolean wrappers?</strong> These are either TRUE or FALSE. The implementation just looks, well, a bit funny:</p>

<pre><code>public enum Quanto {

    YES() {
        protected boolean isQuanto() {
            return true;
        }
    },
    NO() {
        protected boolean isQuanto() {
            return false;
        }
    };

    protected abstract boolean isQuanto();

}
</code></pre>

<p>Even stranger I find what the calling code looks like:</p>

<pre><code>public void doStuff(Quanto quanto) {
    if(quanto.isQuanto()) {
        // ...
    }
}
</code></pre>

<p>Technically it does not matter of course, but it just doesn't feel right... Have you found ""better"" ways of dealing with this?</p>

<p><strong>EDIT:</strong> What also displeases me is the fact that there are more values thinkable than <strong>YES</strong> and <strong>NO</strong> in the above example, say <strong>MAYBE</strong>...?!</p>

<p>Thanks!</p>
","<java><design><refactoring>","4","145","2009-09-10 14:48:58"
"1409523","Hibernate - How to persist a new item in a Collection without loading the entire Collection","<p>I ahve asked this on the Hibernate forums but no one seems to have been able to provide an answer so I am trying here! Thanks chaps!</p>

<p>I have a collection in my model that contains a set of 'previous versions' of my root domain object. The previous versions are therefore 'immutable' and we will never want to update them, and only want to add past versions as they arise. Also the 'versioned' domain object is fairly complex and causes heavy database access to retrieve.</p>

<p>When I have a new version of one of these objects I want to save it with the others without loading the entire set. The Advanced FAQ has some advice on this:</p>

<blockquote>
  <p>Why does Hibernate always initialize a collection when I only want to add or remove an element?</p>
  
  <p>Unfortunately the collections API defines method return values that may only be computed by hitting the database. There are three exceptions to this: Hibernate can add to a <code>&lt;bag&gt;</code>, <code>&lt;idbag&gt;</code> or <code>&lt;list&gt;</code> declared with <code>inverse=""true""</code> without initializing the collection; the return value must always be true.</p>
  
  <p>If you want to avoid extra database traffic (ie. in performance critical code), refactor your model to use only many-to-one associations. This is almost always possible. Then use queries in place of collection access.</p>
</blockquote>

<p>I am new to all of this and am not 100% sure on how to refactor your model to use only many-to-one associations. Can anyone please give me an example of point me to a tutorial so that I can learn how this will resolves my issue?</p>

<p>Thanks</p>

<p>Ori</p>
","<hibernate><refactoring>","3","3016","2009-09-11 07:42:33"
"1414093","Should I refactor my Django object model?","<p>For reasons it's not worth getting into, the object Model of the django application I am working on is now ""wrong"" insofar as a number of relations that are 1 to Many are represented as Many to Many.  The application functions correctly and is most of the way through QA.  It has never been deployed.</p>

<p>My design OCD makes me want to refactor it to correct the problem  The only good time to do it is now, before it goes into production, but it's still not that good a time as QA would have to be redone and the project would slip.</p>

<p>Are there any good engineering reasons to do the refactoring?  This is a tool which will have a user base numbered in the tens rather than the tens of thousands and the database is unlikely to grow to significant size in the short to medium, probably even the long term.  I strongly doubt performance is going to be a factor.</p>
","<django><design><django-models><refactoring>","0","94","2009-09-12 02:38:32"
"1414988","Refactoring List<Foo> to FooList","<p>I have a number of collections of classes which I need to refactor into new classes. I'm using Java with either Eclipse or Netbeans. Currently I create the new class FooList with a delegate List&lt;Foo&gt; and then follow all the places where the code fails to compile. Is there a way to do this without breaking the code (and preferably a single operation)?</p>

<p><strong>EDIT</strong> I have the following type of construct:</p>

<pre><code>public static List&lt;Foo&gt; Bar.createFooList(String s)
</code></pre>

<p>and <code>List&lt;Foo&gt;</code> gets used frequently elsewhere and it makes sense as a business object <code>FooList</code>. I have done this manually by:</p>

<pre><code>public class FooList {
    private List&lt;Foo&gt; fooList;
    public FooList(String s) {
        createList(s);
    }
    private void createList(String s) {//...}
    public int size() {return fooList.size();}
}
</code></pre>

<p>FooList will also have methods beyond List. For example the present:</p>

<pre><code>Bar.normalize(List&lt;Foo&gt; fooList);
</code></pre>

<p>would then become</p>

<pre><code>fooList.normalize();
</code></pre>

<p>Where another function needs the methods of List I used the Source|Generate Delegate Methods option in Eclipse to generate those methods in FooList (as with size() above).</p>

<p>I can see the attraction @JonSkeet of implementing List&lt;Foo&gt; but I can't see how to change all my code automatically.</p>
","<java><list><collections><refactoring>","1","288","2009-09-12 12:22:03"
"1419913","How to (visual studio 2008 / Resharper) refactor / automate mixin pattern","<p>I have Visual Studio 2008 with Resharper, does anyone know if there is any refactorings available that let you say create a class and use a member variable as a mixin?</p>

<p>As a basic example, alot of the time you might want to implement a particular interface and use 95% of the underlying code of an already existing object (such as a list), is there any way to easily hook up those methods automatically?  (Assume the class i want to use functionality from is SEALED and inheriting from it and overriding methods is not an option.</p>

<pre><code>class CustomList : IList&lt;string&gt;
{
    List&lt;string&gt; m_list

    void Add(string val){  m_list.Add(val) }
    void Delete(string val){  m_list.Delete(val) }
    ....etc
}
</code></pre>
","<visual-studio-2008><refactoring><resharper>","1","189","2009-09-14 06:10:56"
"1424797","Refactoring: Gridview Export to CSV file","<p>These routines (vb.net) allow you to dump a gridview to CSV, even if there are templated controls in the cells.  It works, but I'm not thrilled with it.  </p>

<p>What improvements should I make and why?</p>

<pre><code>Private Shared Function CsvFormatted(ByVal t As String) As String
    If t.Contains("","") Then
        t = """""""" + t + """"""""
    End If
    Return t.Replace(""\&amp;nbsp;"", """")

End Function

Private Shared Function GetCellText(ByVal cell As DataControlFieldCell) As String
    If cell.Controls.Count = 0 Then
        Return CsvFormatted(cell.Text)
    Else
        For Each current In cell.Controls
            If TypeOf current Is Label Then
                Return CsvFormatted(TryCast(current, Label).Text)
            ElseIf TypeOf current Is TextBox Then
                Return CsvFormatted(TryCast(current, TextBox).Text)
            ElseIf TypeOf current Is LinkButton Then
                Return CsvFormatted(TryCast(current, LinkButton).Text)
            ElseIf TypeOf current Is ImageButton Then
                Return CsvFormatted(TryCast(current, ImageButton).AlternateText)
            ElseIf TypeOf current Is HyperLink Then
                Return CsvFormatted(TryCast(current, HyperLink).Text)
            ElseIf TypeOf current Is DropDownList Then
                Return CsvFormatted(TryCast(current, DropDownList).SelectedItem.Text)
            ElseIf TypeOf current Is CheckBox Then
                Return CsvFormatted(If(TryCast(current, CheckBox).Checked, ""True"", ""False""))
            End If
        Next
    End If
    Return """"
End Function

Public Shared Sub ExportGridViewToCSV(ByVal grid As GridView, ByVal fileName As String)
    HttpContext.Current.Response.Clear()
    HttpContext.Current.Response.Buffer = True
    HttpContext.Current.Response.AddHeader(""content-disposition"", ""attachment;filename="" + fileName)
    HttpContext.Current.Response.Charset = """"
    HttpContext.Current.Response.ContentType = ""application/text""
    Dim sb As New StringBuilder()
    For k As Integer = 0 To grid.Columns.Count - 1
        grid.Columns(k).Visible = True
        'add separator
        sb.Append(grid.Columns(k).HeaderText + "",""c)
    Next
    'append new line
    sb.Append(vbCr &amp; vbLf)
    For i As Integer = 0 To grid.Rows.Count - 1
        For k As Integer = 0 To grid.Columns.Count - 1
            grid.Columns(k).Visible = True
            'add separator
            sb.Append(GetCellText(grid.Rows(i).Cells(k)) + "",""c)
        Next
        'append new line
        sb.Append(vbCr &amp; vbLf)
    Next
    HttpContext.Current.Response.Output.Write(sb.ToString())
    HttpContext.Current.Response.Flush()
    HttpContext.Current.Response.End()
End Sub
</code></pre>
","<asp.net><vb.net><gridview><refactoring>","1","776","2009-09-15 02:12:08"
"1427509","Refactoring a method which is calling others methods that throws Exception","<p>I have several (more than 20) methods (<code>getXXX()</code>) that may throw an exception (a <code>NotCalculatedException</code>) when they are called.</p>

<p>In another method, I need to access the results given by these methods. For the moment, I have an horrible code, which looks like:</p>

<pre><code>public void myMethod() {
    StringBuffer sb = new StringBuffer();
    // Get 'foo' result...
    sb.append(""foo = "");
    try {
        sb.append(getFoo());
    } catch (NotCalculatedException nce) {
        sb.append(""not calculated."");
    }
    // Get 'bar' result...
    sb.append(""\nbar = "");
    try {
        sb.append(getBar());
    } catch (NotCalculatedException nce) {
        sb.append(""not calculated."");
    }
    ...
}
</code></pre>

<p><strong>Without modifying the <code>getXXX</code> methods</strong> (thus they must keep their <code>throws NotCalculatedException</code>), how would you refactor / simplify <code>myMethod()</code> to make it looks better?</p>

<p><em>Please note that this project is still using Java 1.4 :(</em></p>

<p><hr/></p>

<p><strong>EDIT</strong></p>

<p>I <strong>cannot</strong> put all the <code>getXXX()</code> methods in the <code>try { ... }</code> block, as the StringBuffer will be incomplete if one method throws a <code>NotCalculatedException</code>.</p>

<pre><code>public void myMethod() {
    StringBuffer sb = new StringBuffer();
    try {
        sb.append(""foo = "");
        sb.append(getFoo());
        sb.append(""\nbar = "");
        sb.append(getBar());
    } catch (NotCalculatedException nce) {
        sb.append(""not calculated."");
    }
    ...
}
</code></pre>

<p>In others words, if <code>getFoo()</code> throws a <code>NotCalculatedException</code>, I want to have this kind of output :</p>

<pre><code>foo = not calculated
bar = xxx
...
</code></pre>

<p>If I put everything in one single <code>try { ... }</code>, I will have that output, which I don't want to get:</p>

<pre><code>foo = not calculated
</code></pre>
","<java><refactoring>","2","196","2009-09-15 14:23:18"
"1432485","Coding Katas for practicing the refactoring of legacy code","<p>I've gotten quite interested in coding katas in recent months. I believe they are a great way to hone my programming skills and improve the quality of the code I write on the job.</p>

<p>There are numerous places where Katas can be found. like..</p>

<p><a href=""http://codekata.pragprog.com/"" rel=""nofollow"">http://codekata.pragprog.com/</a></p>

<p><a href=""http://schuchert.wikispaces.com/Katas"" rel=""nofollow"">http://schuchert.wikispaces.com/Katas</a></p>

<p><a href=""http://www.codingdojo.org/cgi-bin/wiki.pl?KataCatalogue"" rel=""nofollow"">http://www.codingdojo.org/cgi-bin/wiki.pl?KataCatalogue</a></p>

<p>I've found these to be excellent repositories of Katas... my attempts at some of them have been been immensely rewarding.</p>

<p>However, I feel that all the Kata's I've seen so far have one short coming. None of them seem to allow me to practice refactoring bad code. It's great learning how to write clean code the first time around...but in my current job, I don't have too many opportunities to write new code. Rather I'm often battling against legacy code and trying to figure out how to refactor modules, eliminate dependencies, and reduce coupling.</p>

<p>As such, I'm on the look out for a couple Katas that I can use to hone my skills of refactoring legacy code and turning it into clean code.</p>

<p>Does anyone know of any that already exist? I know I get a lot of practice at it while I'm at work...but I'd like to hone my skills to the point where I'm able to quickly see how to break apart dependencies and separate concerns in classes that do far too much.</p>
","<refactoring><legacy-code><code-kata>","42","1536","2009-09-16 11:50:17"
"1433741","What is a good ratio of refactoring time versus development time?","<p>I'm trying to build a plan on how we could spend more time refactoring. So I wanted to compare with the industry standards but I have hard time to find studies or metrics on that.</p>

<p>I feel that 20% of dev time spent on refactoring seems a good ratio, but I don't have anything to show for it.</p>

<p>In my mind, for 100% or dev time:</p>

<ul>
<li>50% is spent writing code, debugging, etc...</li>
<li>30% is spent writing unit-tests</li>
<li>20% is spent refactoring code</li>
</ul>

<p>So around 1 line of code for 2 written end up being in the shipped product.
Obviously design time, documentation time, etc is integrated in these percentages.</p>

<p>What is an industry standard? As a rule of thumb, what is your team using?
Thanks,
Olivier</p>
","<unit-testing><refactoring><time>","5","828","2009-09-16 15:33:21"
"1436259","How to refactor long Front Controller?","<p>I am using a Front Controller to send the user through a series of pages with questions.  Pretty much everything must be dynamic as the pages, the questions, and everything else is set in the admin interface and stored in the database.</p>

<p>I am tracking the user's progress through the database by storing a unique identifier in the session and storing the current page the user is on in the database so I can figure out the next page to send them to.</p>

<p>The thing is, there are a lot of special cases to check for. Right now the controller is over 300 lines long and the code is poorly written and I'm the one who wrote it.  Plus, I am going to need to add a lot more to this system in the upcoming weeks such as user-generated content and different pages to show depending on where the user is coming from.</p>

<p>I can see that this controller is going to become a big mess fast if I don't organize it well.  </p>

<p>What are some good ways or ideas to refactor this?</p>
","<php><refactoring><front-controller>","0","169","2009-09-17 01:08:28"
"1446267","How do you refactor JavaScript, HTML, CSS, etc?","<p>I'm using Eclipse and the current solution (which I dislike) is to use ""Search/Replace"". This is an error prone solution.</p>

<p>Do you know any better approach to refactor JavaScript, HTML, CSS resources safely in big applications? Or do you use any other cool refactoring tool(s)? </p>
","<javascript><html><css><eclipse><refactoring>","14","3497","2009-09-18 18:46:00"
"1448260","XAML Refactoring - How to extract common markup","<p>I have some xaml pasted at the end of this question. It's from a resource file in my project. </p>

<p>The HierarchicalDataTemplate and the DataTemplate share exactly the same structure. Is there a way to extract the common parts and reference it in?</p>

<pre><code>&lt;HierarchicalDataTemplate DataType=""{x:Type local:ChapterViewModel}""
                          x:Key=""ChapterOutcomesTemplate""
                          ItemsSource=""{Binding Path=Chapter.Outcomes}""
                          ItemTemplate=""{StaticResource AssignedOutcomeTemplate}""&gt;
    &lt;StackPanel Orientation=""Horizontal""&gt;
    	&lt;Image Height=""16""
    		Width=""16""
    		Margin=""0,0,0,0""
    		RenderOptions.BitmapScalingMode=""NearestNeighbor""
    		SnapsToDevicePixels=""True""
    		Source=""{Binding Source={x:Static images:DocumentImages.Outcomes}}""
    		Visibility=""{Binding IsOutcomesAssigned, Converter={StaticResource BooleanToVisibility}, Mode=OneWay}""
                   /&gt;
    	&lt;Image Height=""16""
    		Width=""16""
    		RenderOptions.BitmapScalingMode=""NearestNeighbor""
    		SnapsToDevicePixels=""True""
    		Margin=""5,0,0,0""
    		Source=""{Binding Source={x:Static images:DocumentImages.Chapter}}"" 
                   /&gt;
    	&lt;TextBlock Text=""{Binding Chapter.Name}""
    		Margin=""5,0,0,0"" /&gt;
    &lt;/StackPanel&gt;
&lt;/HierarchicalDataTemplate&gt;
&lt;DataTemplate x:Key=""ItemTemplate""&gt;
    &lt;StackPanel Orientation=""Horizontal""&gt;
    	&lt;Image Height=""16""
    		Width=""16""
    		Margin=""0,0,0,0""
    		RenderOptions.BitmapScalingMode=""NearestNeighbor""
    		SnapsToDevicePixels=""True""
    		Source=""{Binding Source={x:Static images:DocumentImages.Outcomes}}""
    		Visibility=""{Binding IsOutcomesAssigned, Converter={StaticResource BooleanToVisibility}, Mode=OneWay}"" /&gt;
    	&lt;Image Height=""16""
    		Width=""16""
    		RenderOptions.BitmapScalingMode=""NearestNeighbor""
    		SnapsToDevicePixels=""True""
    		Margin=""5,0,0,0""
    		Source=""{Binding Source={x:Static images:DocumentImages.Chapter}}"" /&gt;
    	&lt;TextBlock Text=""{Binding Chapter.Name}""
    		Margin=""5,0,0,0"" /&gt;
    &lt;/StackPanel&gt;

&lt;/DataTemplate&gt;
</code></pre>
","<wpf><xaml><refactoring>","2","562","2009-09-19 10:03:18"
"1456629","Refactoring abstract Java class with many child classes","<p>I'm looking for ideas on the best way to refactor this scenario (better design, minimal effort). 
Starting from the following example abstract class (actual has many more fields, methods and abstract methods) :</p>

<pre><code>abstract class Car
{
    private int manufactureYear;
    // ... many more fields that are hard to clone

    public Car(int manYear)
    {
      this.manufactureYear = manYear;
    }

    abstract public Color getColor();
    abstract public int getNumCylinders();
}
</code></pre>

<p>There are so many child classes (say 100) that extend this class. These child classes are considered like 'specs' for the cars. Here are two examples :</p>

<pre><code>class CarOne extends Car
{
    private static Color COLOR = Color.Red;
    private static int CYLINDERS = 4;

    public CarOne(int manYear)
    {
      super(manYear);
    }

    public final Color getColor();
    {
    return COLOR;
    }

    public final int getNumCylinders() 
    {
    return CYLINDERS;
    }
}

class CarOneThousand extends Car
{
    private static Color COLOR = Color.Black;
    private static int CYLINDERS = 6;

    public CarOneThousand(int manYear)
    {
      super(manYear);
    }

    public final Color getColor();
    {
        return COLOR;
    }

    public final int getNumCylinders() 
    {
    return CYLINDERS;
    }
}
</code></pre>

<p>During runtime car objects get instantiated and used:</p>

<pre><code>CarOne carObject = new CarOne(2009);
carObject.getColor();
carObject.getNumCylinders();
</code></pre>

<p>However, after getting some external data, I discover that the car was repainted and the engine changed. The new specs for the car become: </p>

<pre><code>class ModCar extends Car
{
    private static Color COLOR = Color.Blue; 
    private static int numCylinders = 8;

    public ModCar (int manYear)
    {
      super(manYear);
    }

    public final Color getColor();
    {
    return COLOR;
    }

    public final int getNumCylinders() 
    {
    return numCylinders;
    }
}
</code></pre>

<p>So really need to ""apply"" these specs to the new <code>carObject</code> without modifying existing fields such as <code>manufactureDate</code>. The problem is how to minimize the code of changes to those 100+ child classes (preferably leave them untouched) while being able to update the <code>carObject</code> during runtime.</p>

<p>N.B. I was given to work on this code so I didn't write it in this condition to begin with.</p>
","<java><design-patterns><refactoring><abstract-class>","1","653","2009-09-21 20:21:55"
"1458717","Remove unused references (!= usings) in C# project without Resharper?","<p>Is there any way of removing unused references to assemblies, in a C# project, without the help of Resharper? The <a href=""http://msdn.microsoft.com/en-us/library/7sfxafba%28VS.80%29.aspx"" rel=""nofollow"">MSDN documentation does outline something for Visual Basic</a>, but I couldn't find the same dialogs for C#. </p>
","<c#><visual-studio-2008><refactoring>","11","2659","2009-09-22 08:07:06"
"1460012","Refactoring Linq to Sql","<p><strong>Is there a way to refactor linq to sql and take advantage of late evaluation? Is there a way to reuse object initilizer code?</strong></p>

<p>I have business objects that are persisted in a database and hydrated via a separate linq to sql layer. </p>

<p>I would like to be able to reuse code from multiple queries that do the exact same thing. The portion of the query that I would like to reuse is the object creation part. I would also like to continue to take advantage of late evaluation (only get the columns that I want from the database.) </p>

<p>The examples given below are very simple and some of the names have been changed to protect the innocent. </p>

<p>Sample 1</p>

<pre><code>void GetUserById(Guid userId)
{
    IQueryable&lt;LinqLayer.User&gt; x =
        from user in dataContext.Users
        where user.UserID == userId
        select user;

    IQueryable&lt;BusinessLayer.User&gt; y = hydrateUser(x);

    // Acutally execute the query against the database.
    BusinessLayer.User user = y.First();
}

void GetUserByName(string name)
{
    IQueryable&lt;LinqUser&gt; x =
        from user in dataContext.Users
        where user.FirstName == name
        select user;

    IQueryable&lt;User&gt; y = hydrateUser(x);

    // Acutally execute the query against the database.
    User user = y.First();
}

IQueryable&lt;User&gt; hydrateUser(IQueryable&lt;LinqUser&gt; x)
{
    IQueryable&lt;User&gt; y;
        y = from item in x
        select new User
        {
            ID = item.UserID,
            FirstName = item.FirstName,
            MiddleName = item.MiddleName,
            LastName = item.LastName,
        };
    return y;
}
</code></pre>

<p>A couple of things are going on in sample 1. In this example, I am able to take advantage of linq to sql late evaluation. If you watch the database queries, the only columns selected are the ones I am interested in (listed in hydrateUser as ID, FirstName etc). This is nice because I can reuse the code in hydrateUser. </p>

<p>Sample 2:</p>

<pre><code>IQueryable&lt;User&gt; hydrateUser(IQueryable&lt;LinqUser&gt; x)
{
    IQueryable&lt;User&gt; y;
        y = from item in x
        select new User
        {
            ID = item.UserID,
            FirstName = item.FirstName,
            MiddleName = item.MiddleName,
            LastName = item.LastName,
            ... Big long list of properties
        };
    return y;
}

IQueryable&lt;User&gt; hydrateUserWithPermissions(IQueryable&lt;LinqUser&gt; x)
{
    IQueryable&lt;User&gt; y;
        y = from item in x
        select new User
        {
            ID = item.UserID,
            FirstName = item.FirstName,
            MiddleName = item.MiddleName,
            LastName = item.LastName,
            ... Big long list of properties
            PermissionList = item.Permissions
        };
    return y;
}
</code></pre>

<p>Sample 2 starts to fall down when I want to use hydrateUser and also hydrate an associated object. For example, hydrating a list of permissions. I have to spin off a whole seperate function now that does the extra hydration. this is less then desirable if I have many more properties I am initializing. </p>

<p>Sample 3</p>

<pre><code>IQueryable&lt;User&gt; hydratePermissions(IQueryable&lt;LinqUser&gt; x)
{
    IQueryable&lt;User&gt; y;
        y = from item in x
        select new User
        {
            PermissionList = item.Permissions
        };
    return y;
}

IQueryable&lt;User&gt; hydrateUser(IQueryable&lt;LinqUser&gt; x)
{
    IQueryable&lt;User&gt; y;
        y = from item in x
        select new User
        {
            ID = item.UserID,
            FirstName = item.FirstName,
            MiddleName = item.MiddleName,
            LastName = item.LastName,
            ... Big long list of properties
        };
    return y;
}
</code></pre>

<p>What I would like to be able to do is build the query up with code like sample 3. Somehow try to take advantage of both functions. <em>And make only one trip to the database.</em> However, this does not work.</p>

<p>Sample 4</p>

<pre><code>User newUpUserFromLinqUser(LinqUser item)
{
    y = new User
        {
            ID = item.UserID,
            FirstName = item.FirstName,
            MiddleName = item.MiddleName,
            LastName = item.LastName,
        };
    return y;
}
</code></pre>

<p>Sample 4 is close to what I want, but loses the expression evaluation that linq to sql uses to do late evaluation. All of the fields will come back in the query. Ever worse, if code like this is a child relationship, a call to the database gets made for every child. This is unacceptable in our situation.</p>

<p>Additional notes</p>

<p>Bandwidth is at a premium. We control exactly what data comes down the wire, so it is very important that the queries are as lean as possible.</p>

<p>I have looked at <a href=""http://www.albahari.com/nutshell/linqkit.aspx"" rel=""nofollow"" title=""Title"">LinqKit</a> and while it seems like it may work for what I need, I would prefer ""out of the box"". </p>

<p>At this time, the overall architecture is not up for debate. </p>
","<c#><linq><linq-to-sql><refactoring>","2","298","2009-09-22 13:09:46"
"1466048","Asp.net - Refactor action","<p>I have this ""problem"" that i have code like this in many of my controller actions:</p>

<pre><code>var users = new List&lt;SelectListItem&gt;();
foreach(var user in userRepository.GetAll())
{
 var item = new SelectListItem { Text = user.FriendlyName, Value = user.UserId.ToString() };

 if (User.Identity.Name == user.UserName)
  item.Selected = true;

 users.Add(item);
}

ViewData[""Users""] = users;
</code></pre>

<p>How would you refactor this to a more clean solution? I want to get DRY!</p>
","<c#><.net><asp.net><refactoring><dry>","1","82","2009-09-23 13:35:29"
"1468547","Designing Constructors for Testability","<p>I'm working with some existing code, trying to add to it and increase the unit tests for it. But running into some problems with getting the code testable.</p>

<p><em>Original Constructor:</em></p>

<pre><code>public Info() throws Exception
{
  _ServiceProperties = new ServiceProperties();
  _SshProperties = new SshProperties();
}
</code></pre>

<p>I'm aware that this is bad, and obviously not testable. In a junit environment, this class will fail to create every time since it wont be able to find the necessary properties to construct itself. Now, I'm aware this class would be a lot more testable with the simple change of moving anything prefaced with 'new' as a parameter. </p>

<p>So I end up with:</p>

<p><em>New Constructor:</em></p>

<pre><code>public Info(ServiceProperties srvProps, SshProperties sshProps) throws Exception
{
  _ServiceProperties = srvProps;
  _SshProperties = sshProps;
}
</code></pre>

<p>Which allows me to properly unit test this Info class. The problem though, is now all that work is pushed to some other class:</p>

<p><em>Some Other Class' Method:</em></p>

<pre><code>public void useInfo() throws Exception
{
  ServiceProperties srvProps = new ServiceProperties();
  SshProperties sshProps = new SshProperties();
  Info info = new Info(srvProprs, sshProprs);
  doStuffWithInfo(info);
}
</code></pre>

<p>Now this method isn't testable. All I've managed to do is push off where the constructions of these Property objects are occurring, and somewhere else some piece of code is going to be stuck actually having to call ""new"".</p>

<p>Here's the rub for me: I can't figure out how to break this chain of events of simply pushing these ""new"" calls somewhere else. What am I missing?</p>
","<java><unit-testing><refactoring><constructor>","5","236","2009-09-23 21:16:38"
"1471084","Are all Refactorings parameterized?","<p>The question is about refactorings. Consider a rename method refactoring. This refactoring can be visualized as meta-method that takes old and new names, and changes the old method name to the new. so, for refactoring </p>

<p>foo()
{
.........
.........
}</p>

<p>to </p>

<p>boo()
{
.........
.........
}</p>

<p>the meta method for refactoring would be ... </p>

<p>renameMethod (foo, boo)</p>

<p>This is called parametrized refactoring. My question is can all refactorings mentioned in <a href=""http://www.refactoring.com/catalog/"" rel=""nofollow"">http://www.refactoring.com/catalog/</a> be thought of as having some parameters or are there refactorings that do not need such parameters?</p>
","<refactoring><parameterized>","1","42","2009-09-24 11:28:06"
"1471855","How to easy find unused public methods/properties","<p>I have a .Net(C#) solution. The solution contains bunch of projects. The projects were implemented not by me. It is not a framework, it means that I need to have amount of public methods/properties as less as possible. My task is to identify methods and properties which are not used, but exist in the projects. Well, I can find private methods which are not used using R#. But it is completely unclear how to find <em>public</em> methods/properties which are not used.</p>

<p>I heard that they have NDepend tool, but it is not very simple tool, is it.</p>

<p>So, the question is: could you please point to a tool which can be used to identify methods which are not used in a solution. It is OK with me to have command line tool or something pretty simple.</p>

<p>UPD: I tried to use trial NDepend.</p>

<p>Well, first of all it seems like it is possible to see public methods (properties are represented as get_ set_ methods) which are not used in this particular assembly.</p>

<p>But NDepend does not recognize if the public method is used from another project/assembly, which is a part of the solution and shows the method as unused. But this is not true.</p>

<p>UPD2: mcintyre321 advised to use R#. Please read a first comment below.
<img src=""http://img98.imageshack.us/img98/3412/200909251809.png"" alt=""alt text"" /></p>
","<.net><properties><methods><refactoring><public-method>","3","434","2009-09-24 13:56:55"
"1473364","C# code that generates javascript on the fly","<p>Is it OK to generate code like this on the fly?  Or is this a major code smell?  How can this be made better?</p>

<p>I'm new to web but I'm stumbling across this all the time and I don't really understand why.</p>

<pre><code>// Create a js function that applies foo to each group of controls
foreach (KeyValuePair&lt;string, Dictionary&lt;Control, string&gt;&gt; pair in maps)
{
    js.Append(pair.Key);
    js.Append(""=function(grid){Prm.remove_endRequest("");
    js.Append(pair.Key);
    js.Append("");if(grid &amp;&amp; grid._element)""); //   ... blah blah blah

}
page.ClientScript.RegisterClientScriptBlock(page.GetType(), key + ""Ajax"", 
    js.ToString(), true);
</code></pre>
","<design-patterns><refactoring><code-smell>","2","150","2009-09-24 18:27:40"
"1475016","How do I automatically clean up code in C++?","<p>I'm working as a TA in an introductory programming class, and the students tend to submit their programs as either one line, or without any indentation. Is there any tool that allows me to insert indents and things like that automatically? (We're using C++ and VisualStudio)</p>
","<c++><visual-studio><refactoring>","1","710","2009-09-25 01:35:10"
"1476730","Can we make this snippet groovier?","<p>are there any improvements where i can improve this code? Maybe there are some groovy language features? This snippet flattens a xml file to: node/node/node</p>

<pre><code>def root = new XmlParser().parse(""src/your_xml.xml"")

root.depthFirst().each { n -&gt;
	def name = n.name()
	while(n?.parent()){
		name = ""${n?.parent()?.name()}/${name}"";
		n = n?.parent()
	}
	println name
}
</code></pre>
","<design><groovy><refactoring><code-snippets>","2","114","2009-09-25 11:16:25"
"1477815","How to fix and refactor this calculator script in JavaScript / JQuery","<p>I decided to try and learn more JQuery and here is what I have come up with.</p>

<p>It should be a simple enough job, but I can't get my head around it. I can add it up, but when I change a package, the price just keeps going up.  I know I have to add some logic to decrement the counter, too, but I think a fresh pair of eyes would be great.</p>

<p>How would you refactor my code?</p>

<p>Live: <a href=""http://www.keithdonegan.com/jquery/calculate/"" rel=""nofollow"">http://www.keithdonegan.com/jquery/calculate/</a></p>

<pre><code>$(document).ready(function()
{
    var bronze = 50;
    var silver = 100;
    var gold = 200;

    var email_support = 20;
    var email_telephone_support = 50;
    var email_telephone_im_support = 80;

    var total_support = 0;
    var total = 0;

    $('#total span').append(total);

    $('input').click(function()
    {
        var input_id = $(this).attr('id');
        switch(input_id)
        {
        case 'bronze': 
            total = bronze;
            $('#total span').empty().append(total = bronze + total_support);
            break;
        case 'silver':
            total = silver;
            $('#total span').empty().append(total = silver + total_support);
            break;
        case 'gold':
            total = gold;
            $('#total span').empty().append(total = gold + total_support);
            break;
        case 'email-support':
            $('#total span').empty().append(total_support = email_support + total);
            break;
        case 'email-telephone-support':
            $('#total span').empty().append(total_support = email_telephone_support + total);
            break;
        case 'email-telephone-im-support':
            $('#total span').empty().append(total_support = email_telephone_im_support + total);
            break;
        default:
            break;
        }
    });
});
</code></pre>
","<javascript><jquery><refactoring>","0","229","2009-09-25 14:59:43"
"1479577","What Jquery Plugin or Extension could I use to construct a query string?","<p>At this moment we construct our search query in our website with java script. We have an input box for keyword and another input box for name and so on.  If a user enters keyword: test the query looks like:</p>

<pre><code>http://oursite.com/Search?keyword=test
</code></pre>

<p>if they enter keyword: test and name: john the string looks like:</p>

<pre><code>http://oursite.com/Search?keyword=test&amp;name=john
</code></pre>

<p>So the functionality is easy, take information from input boxed chain it, and then pass it to the window.location. </p>

<p>ok. now we want to do it with jquery, any ideas on how to start or plugins that will do this.</p>

<p>In case you are wondering, we want to do this to increase maintainability of our code and decrease dependency in one developer. </p>
","<javascript><jquery><refactoring>","0","63","2009-09-25 21:04:12"
"1482637","How can I factor out the code duplication here?","<p>So, I'd like to hear what you all think about this.</p>

<p>I have a project where three different inheritance paths need to all implement another base class.  This would be multiple inheritance and isn't allowed in C#.  I am curious how I can implement this without code duplication.</p>

<p>EDIT: I don't own the three classes. The three classes are from 3rd party code. So I cannot make them all extend my base class.</p>

<p>Right now I am using three different classes, each one extending a different base class.  Then I have the same code in each of the three abstract classes.</p>

<p>I could use a single interface, but I would still need to duplicate the code. </p>

<p>I could make some kind of static class that implements the code and then reference that in each of the 3 abstract classes.  It would eliminate the duplication, but, I am not sure how I feel about this.  I could implement Extensions methods on the interface, but then the interface itself would be empty and the extension methods (containing the duplicate code) would be in a totally different file, which seems not quite right.  Plus I can't implement properties in extension methods...</p>

<p>How can I factor out the code duplication here?</p>

<p>EDIT, inheritance tree:</p>

<pre><code>class Class1 : 3rdPartyBaseClass1 { }
class Class2 : 3rdPartyBaseClass2 { }
class Class3 : 3rdPartyBaseClass3 { }
</code></pre>

<p>I have code I want to be in each of the above Classes, but I cannot add it to the 3rdPartyClasses.</p>
","<c#><design-patterns><inheritance><refactoring><multiple-inheritance>","4","400","2009-09-27 02:26:31"
"1484279","How should I refactor a long chain of try-and-catch-wrapped speculative casting operations","<p>I have some C# code that walks XML schemata using the Xml.Schema classes from the .NET framework. The various simple type restrictions are abstracted in the framework as a whole bunch of classes derived from Xml.Schema.XmlSchemaFacet. Unless there is something I've missed, the only way to know which of the derived facet types a given facet is, is to speculatively cast it to one of them, catching the resultant InvalidCastOperation in case of failure. Doing this leaves me with a really ugly function like this:</p>

<pre><code>private void NavigateFacet(XmlSchemaFacet facet)
{
    try
    {
        handler.Length((XmlSchemaLengthFacet)facet);
    }
    catch(InvalidCastException)
    {
        try
        {
            handler.MinLength((XmlSchemaMinLengthFacet)facet);
        }
        catch(InvalidCastException)
        {
            try
            {
                handler.MaxLength((XmlSchemaMaxLengthFacet)facet);
            }
            catch(InvalidCastException)
            {
                ...
            }
        }
    }
}
</code></pre>

<p>I assume there must be more elegant ways to do this; either using some property I've missed from the .NET framework, or with some clever piece of OO trickery. Can anyone enlighten me?</p>
","<c#><.net><refactoring><xml-schema><try-catch>","3","342","2009-09-27 19:42:17"
"1491782","PHP escaping error reporting with @","<p>I am currently refactoring some code for work and I have come across some function calls prefixed by the ""@"" symbol.  As I understand it, this is intended to escape PHP error reporting if the call fails.</p>

<p>Is this type of thing good practice? I understand the rationale in a development environment but when the site is pushed to production shouldn't all errors be handled properly rather than just escaped?</p>

<p>The use of this symbol would therefore mean that the developer has to sort through the code at a later stage to remove all error reporting escapes.</p>

<p>I am unsure whether to remove these symbols and just find a better way to handle potential errors or not.</p>

<p>For clarity, the function this was used on was the native PHP <code>fsockopen()</code> function.</p>
","<php><web-development><debugging><refactoring><error-handling>","1","205","2009-09-29 10:37:29"
"1493743","How to refactor this code?","<p>how can i refactor this code down to one method or something?</p>

<pre><code>            if (!string.IsNullOrEmpty(_gridModel.Header))
                _gridModel.Header += "","";
            if (item != null)
                _gridModel.Header += item.Header;

            if (!string.IsNullOrEmpty(_gridModel.Width))
                _gridModel.Width += "","";
            if (item != null)
                _gridModel.Width += item.Width;

            if (!string.IsNullOrEmpty(_gridModel.Align))
                _gridModel.Align += "","";
            if (item != null)
                _gridModel.Align += item.Align;

            if (!string.IsNullOrEmpty(_gridModel.Filter))
                _gridModel.Filter += "","";
            if (item != null)
                _gridModel.Filter += item.Filter;

            if (!string.IsNullOrEmpty(_gridModel.Type))
                _gridModel.Type += "","";
            if (item != null)
                _gridModel.Type += item.Type;

            if (!string.IsNullOrEmpty(_gridModel.Sort))
                _gridModel.Sort += "","";
            if (item != null)
                _gridModel.Sort += item.Sort;
</code></pre>
","<c#><.net><refactoring>","4","333","2009-09-29 16:53:11"
"1503992","Help finding the deepest Child Control for SpellChecking","<p>I am trying to Refactor this code as it is repeated <em>ad nauseum</em> throughout my program.  </p>

<p>My problem has to do with the fact that on any given page(<em>tabpage,panel,uc,etc</em>) there are controls at multiple levels to <strong>spellcheck</strong>.<br />
i.e. --></p>

<pre><code>            foreach (Control control in tpgSystems.Controls)
            {
                if (control.GetType() == typeof(MemoExEdit))
                {
                    if (control.Text != String.Empty)
                    {
                        control.BackColor = Color.FromArgb(180, 215, 195);
                        control.Text = HUD.Spelling.CheckSpelling(control.Text);
                        control.ResetBackColor();
                    }
                }
            }
            foreach (Control control in grpCogestiveHeartFailure.Controls)
            {
                if (control.GetType() == typeof(MemoExEdit))
                {
                    if (control.Text != String.Empty)
                    {
                        control.BackColor = Color.FromArgb(180, 215, 195);
                        control.Text = HUD.Spelling.CheckSpelling(control.Text);
                        control.ResetBackColor();
                    }
                }
            }
            foreach (Control control in grpDiabetes.Controls)
            {
                if (control.GetType() == typeof(MemoExEdit))
                {
                    if (control.Text != String.Empty)
                    {
                        control.BackColor = Color.FromArgb(180, 215, 195);
                        control.Text = HUD.Spelling.CheckSpelling(control.Text);
                        control.ResetBackColor();
                    }
                }
            }
</code></pre>

<p>As you can see in the example, <code>tpgSystems</code> has some controls directly on it and then there are two <code>Group Boxes</code> that have controls in them as well.</p>

<p>Part of my goal in this was to only check controls that had a possibility of needing <strong>Spell Checking</strong>, as in <code>Text Boxes</code> and there relatives.</p>

<p>I know there is the <code>control.HasChildren()</code> that I can use but what is escaping me is how to use that and tell how deep to go. I would assume that two levels is the deepest I would ever go but that seems short sighted to hard code that in.</p>

<p>Ideally I would figure out how to pass a control to my <code>CheckSpelling()</code> and then have the logic in there to figure out how deep to go.  Probably using <strong><em>Reflection</em></strong>.</p>

<p>For completeness here is <code>CheckSpelling()</code> which is in a seperate library I created.</p>

<pre><code>public string CheckSpelling(string text)
    {
        Word.Application app = new Word.Application();
        object nullobj = Missing.Value;
        object template = Missing.Value;
        object newTemplate = Missing.Value;
        object documentType = Missing.Value;
        object visible = false;
        object optional = Missing.Value;
        object savechanges = false;
        app.ShowMe();

        Word._Document doc = app.Documents.Add(ref template, ref newTemplate, ref documentType, ref visible);

        doc.Words.First.InsertBefore(text);
        Word.ProofreadingErrors errors = doc.SpellingErrors;

        var ecount = errors.Count;
        doc.CheckSpelling(ref optional, ref optional, ref optional, ref optional, 
            ref optional, ref optional, ref optional, ref optional, ref optional, 
            ref optional, ref optional, ref optional);
        object first = 0;
        object last = doc.Characters.Count - 1;
        var results = doc.Range(ref first, ref last).Text;
        doc.Close(ref savechanges, ref nullobj, ref nullobj);
        app.Quit(ref savechanges, ref nullobj, ref nullobj);

        return results;
    }
</code></pre>
","<c#><reflection><controls><refactoring><parent-child>","1","241","2009-10-01 13:31:40"
"1509361","Deciding when nibs should be subdivided in a Cocoa application","<p>Apologies if this has been asked before. I searched and couldn't find it. </p>

<p>In my application I have about 10 nib files, most of which hold a single significant view object and a number of subviews/controls.  </p>

<p>At what point would you consider breaking nibs into pieces? For example in one of my nibs I have an NSCollectionview and the prototype view (relatively simple) in the same nib. Would you put the prototype view in a separate nib?</p>

<p>To me there is a clear tradeoff. If you subdivide too much then you lose many of the advantages of Interface builder (arranging things geometrically, setting resize masks etc), and you need to write more code to ensure pieces of views are arranged properly.  On the other hand if you put everything into one nib ... well .. we all know that is a refactoring nightmare, slow loading etc.</p>

<p>So how do you decide when to draw this line? Looking at my own code I think I've used the following;</p>

<p>(a) Always split pieces that don't always need to load together</p>

<p>(b) Never put more than one relatively complex control (eg NSTableview, NSCollectionview etc) in a nib</p>

<p>Edit: -- I should say that I sometimes break these rules. For example I have a window for configuring a certain type of object. It has a complete Master-detail interface with an NSTableview (master) and a bunch of text fields (detail).  I guess this violates my one complex view per nib rule.</p>

<p>What rules do you use?</p>
","<cocoa><refactoring>","0","124","2009-10-02 13:02:50"
"1511303","Should I use Resharper to tidy up other peoples code?","<p>I use Resharper at work.  Some of my colleagues do not.</p>

<p>When I open some code that has been written someone who doesn't, it is immediately obvious by the amount of orange on my screen.</p>

<p>What I am unsure of is to what extent I should feel free to tidy up the messes the have unknowingly left.  With most of what I am looking at, it is sloppy but harmless, and wouldn't really jump out at me if I hadn't ever used Resharper.  </p>

<p>I guess I see my options broadly as</p>

<p>1) The history of changes to source code is essential to maintenance.  Change as little as possible, or the next guy wont have a hope of figuring out what has changed.  Who cares about unreachable code, unnecessary use of .ToString() etc. anyway.</p>

<p>2) Change the meaningless stuff like includes, fix method documentation comments and things like that.  The guy who wrote it likes his code to look like this, so leave it in a state where he wont complain, but get rid of some of the unnecessary orange</p>

<p>3) Orange is just red but lighter.  F12 then Alt+Enter until green.</p>

<p>4) Forget the orange, look at that monster 700 line function.  What is this 1997?  Time to get busy...  and if you have got the time, introduce your colleague to our good friend and mentor Mr Fowler.</p>

<p>I tend to flit between the options depending on how much time I have got, to what extent I am now responsible for the code, and how complex the code looks (which can make me go for 1 or 4 usually).</p>

<p>It seems like one of the 4 options should be the one I am striving for though, but I have no idea which one</p>
","<.net><refactoring><resharper><maintainability>","10","627","2009-10-02 19:11:22"
"1512809","Is there an application that can convert PHP code to ASP.Net?","<p>I'm tired. I have ~30 really messy PHP files in my project. Hearing people say that Asp.net is more structured , that it is better (I'm mostly relying on Jeff's advice @codinghorror here) and that it is <em>possible to use asp.net without using bloated software from M$</em>. I don't want to and will not convert the the work done upto now, by hand.</p>

<p>Note: I want a <em>good</em> tool -- I don't want to go from ~30 unstructured and messy files to <em>even messier stuff</em> stored in a quantillion directories with odd file names (Java)</p>
","<php><asp.net><tools><automated-refactoring>","0","876","2009-10-03 04:40:17"
"1513547","Help with a Refactoring: Introduce Parameter Object?","<p>I have some code which is the same except that a certain sequence of assignments happen in slightly different orders.  </p>

<p>It is easy to factor this out into a method parameter of type <code>int[]</code>, which denotes the order.</p>

<p>However, I find it isn't the clearest. </p>

<p>Another option was to factor them out into a object of type <code>AssignmentOrders</code>.  I can also do validation on the values in the object constructor that I wasn't able to do with the array.  This would be the ""Introduce Parameter Objects"" refactoring from the book, <em>Refactoring</em>.</p>

<p>I am wondering if this particular refactoring is overkill and I should just stick with the <code>int[]</code>?</p>

<p>CODE:</p>

<p>Three Samples of the Originals:</p>

<pre><code>private static PersonDetails parseLine(String line, String deliminator, int[] orderOfSections) 
            throws Exception {
    	String[] sections = line.split(deliminator);

    	String value1 = sections[0].trim();
    	String value2 = sections[1].trim();
    	String value3 = sections[4].trim();
    	String value4 = sections[2].trim();
    	String value5 = sections[3].trim();

    	//........
    }

private static PersonDetails parseLine(String line, String deliminator) 
            throws Exception {
    	String[] sections = line.split(deliminator);

    	String value1 = sections[1].trim();
    	String value2 = sections[0].trim();
    	String value3 = sections[2].trim();
    	String value4 = sections[3].trim();
    	String value5 = sections[4].trim();

    	//........
    }

private static PersonDetails parseLine(String line, String deliminator, int[] orderOfSections)


        throws Exception {
    	String[] sections = line.split(deliminator);

    	String value1 = sections[0].trim();
    	String value2 = sections[1].trim();
    	String value3 = sections[2].trim();
    	String value4 = sections[4].trim();
    	String value5 = sections[5].trim();

    	//........
    }
</code></pre>

<p>How I've refactored the above 3 into this:</p>

<pre><code>private static PersonDetails parseLine(String line, String deliminator, int[] orderOfSections) 
            throws Exception {
    	String[] sections = line.split(deliminator);

    	String value1 = sections[orderOfSections[0]].trim();
    	String value2 = sections[orderOfSections[1]].trim();
    	String value3 = sections[orderOfSections[2]].trim();
    	String value4 = sections[orderOfSections[3]].trim();
    	String value5 = sections[orderOfSections[4]].trim();

    	//........
    }
</code></pre>

<p>How I could theoretically refactor it into a parameter object: </p>

<pre><code>private static PersonDetails parseLine(String line, String deliminator, OrderOfSections order) 
        throws Exception {
    	String[] sections = line.split(deliminator);

    	String value1 = sections[order.getValue1Idx].trim();
    	String value2 = sections[order.getValue2Idx].trim();
    	String value3 = sections[order.getValue3Idx].trim();
    	String value4 = sections[order.getValue4Idx].trim();
    	String value5 = sections[order.getValue5Idx].trim();

    	//........
    }
</code></pre>

<p>What I was thinking of doing was creating a specific class instead of using <code>int[]</code>... But wondered if that would be overkill.</p>

<p>The benefits are that it would be more readable.  Instead of <code>orderOfSections[0]</code>, it might be <code>orderOfSections.value1SectionIdx</code>...  I could also put some validation code into the class.   </p>

<p>I believe this is what Martin Fowler calls Introducing a Parameter Object.</p>

<p>EDIT:</p>

<p>Another option would be to use a Dictionary.  Lighter-weight than a new class, but more descriptive...  Then I could use something like <code>orderOfSections[""value1""]</code></p>
","<java><refactoring>","0","330","2009-10-03 11:41:35"
"1511480","Refactoring and non-refactoring changes as separate check-ins?","<p>Do you intermingle refactoring changes with feature development/bug fixing changes, or do you keep them separate? Large scale refactorings or reformatting of code that can be performed with a tool like Resharper should be kept separate from feature work or bug fixes because it is difficult to do a diff between revisions and see the real changes to code in amongst the numerous refactoring changes. Is this a good idea?</p>
","<refactoring><diff>","4","104","2009-10-02 19:53:05"
"1523517","Refactoring tool for Spring.NET","<p>Currently I get to edit a lot of Spring.NET XML files, and I do find this work to quite repetitive and, frankly boring.</p>

<p>Most of the stuff I do is sort of 'refactoring' - generalising XML declaration for instances and ""inheriting"" from those generalised structures to declare more specific ones.</p>

<p>As I said, it's a no-brainier type of task but it does require a lot of attention and concentration and it's easy to make a mistake.</p>

<p>I would imagine that a lot of editing of Spring.NET xml files can be automated with a tool similar to ReSharper.</p>

<p>Can you recommend anything?</p>

<p>Thank you!</p>
","<refactoring><automation><productivity><spring.net><editing>","2","161","2009-10-06 03:54:44"
"1523305","Oracle DB (PL/SQL) Refactoring Tools","<p>I was wondering if there are any good refactoring tools for Oracle databases and especially for PL/SQL. I'm working on a project where half the developers are working with c# and the other half on the db where there is a large and complex schema and a large code base in pl/sql. We also use sql server but the database team work exclusively with Oracle.</p>

<p>This code base is being worked on actively and is being refactored gradually but I was quite surprised to see how bad the refactoring tools for oracle seem to be (or at least in comparison to Eclipse and Resharper). </p>

<p>The developers are using Toad which only has basic refactoring support (probably as its seems to be targeted more towards db admin then development). I've used Toad myself before but always had assumed for pl/sql there were more features for working with code but had never looked into it. Now as far as I can see the only refactorings that it provides are extract method (procedure) and variable renaming. I read an article comparing sql developer and pl/sql developer and these do not appear to have any better support for refactoring. I had a quick look at the eclipse data tools project but couldn't see that they've added refactoring support since I last used it (a few years ago).</p>

<p>For Sql Server there exists Sql Refactor which when table structures are changed gets propagated through to the stored procedures. This for me is much cleaner and less error prone than having someone manually update all stored procedures. I used an older version of these tools on a project in the past and they seemed to be quite ok but a bit slow but that was a few years ago and it was still usable. </p>

<p>Something similar for Oracle would already be a big help for our developement team so I'd appreciate some pointers to good refactoring tools for Oracle if they do exist. 
Thanks,
Crocked</p>
","<oracle><refactoring><plsql>","3","1298","2009-10-06 02:15:14"
"1527876","PHP echo question?","<p>Do I really need this many echo's or can I make it shorter?</p>

<pre><code>&lt;?php
if (!empty($url))
{
    echo '&lt;p&gt;Job: &lt;span&gt;' . $job .'&lt;/span&gt;&lt;/p&gt;';
    echo '&lt;p&gt;Skills: &lt;span class=""caps""&gt;' . $skills . '&lt;/span&gt;&lt;/p&gt;';
    echo '&lt;p&gt;Website: &lt;a href=""http://' . $url . '"" title=""' . $url . '""&gt;http://' . $url . '&lt;/a&gt;&lt;/p&gt;';
    echo '&lt;p&gt;Pay:' . $pay. '&lt;/p&gt;';
} else { 
    echo'';
} 
?&gt;
</code></pre>
","<php><syntax><refactoring>","1","529","2009-10-06 20:18:41"
"1529164","wpf xaml namespace refactoring","<p>Consider a ViewModel and an View that uses it, where the DataContext is set to the VM in the code behind file. When they are both at the project namespace, the view runs without exceptions with binding statements along the lines of:
    ItemsSource=""{Binding Path=PrefixFilterChoices}""</p>

<p>where PrefixFilterChoices is a property on the VM. When I refactor the project so that ViewModels and Views are each in their own namespace within the project, I now get a runtime error (System.IO.IOException' occurred in PresentationFramework.dll, cannot find the resource projectView.xaml).</p>

<p>1) I can't figure out who is looking for the resource though, so I'm not sure what the fix is. The code behind is still setting the DataContext and it has the new namespace for the ViewModel. Must I add it to the XAML also? Must I alias it and now qualify the Path for all of the bindings?</p>

<p>2) I use resharper, which has always been spot on the money at refactoring namespace changes; but it isn't helping even a little with the XAML. Are there any tools that do better XAML refactorings?</p>

<p>Cheers,<br />
Berryl</p>
","<data-binding><xaml><refactoring>","0","145","2009-10-07 02:18:09"
"1537901","Is there a way to find all unused code in a .NET project using ReSharper?","<p>I've just done a major, major overhaul on a colleagues project and throughout the process almost everything got rewritten. There was far too much code beforehand.</p>

<p>Now, I am left with the prospect that in amongst my project somewhere are old pre-refactoring methods that are no longer needed.</p>

<p>Is there a way to search the <strong>whole project</strong> for such methods in one go?</p>

<p>I understand the risk of potentially removing code used via reflection.</p>

<p>It's very similar to <a href=""http://stackoverflow.com/questions/245963/find-unused-code"">this question</a>, except I would like two extra things:</p>

<ul>
<li>An answer specific to ReSharper</li>
<li>Instructions on how to achieve this using ReSharper as I cannot seem to figure it out</li>
</ul>
","<visual-studio><resharper><automated-refactoring>","2","340","2009-10-08 13:46:22"
"1537952","Help porting javascript function to jQuery - learning tool","<p>I am just learning jQuery and I wanted to see what I could do with the function below.  This function adds or removes css classes to create a pull down menu (it is in fact Stu Nicholl's well known pull down menu).  But I'm not getting very far (I've been learning jQuery for approximately an hoour now, so my DOM traversal isn't quite up there yet).  I am curious to see how neat and elegant it can become using jQuery, and thought I'd see what you guys could come up with.  Here is the existing function:</p>

<pre><code> var getEls = document.getElementById(""menu"").getElementsByTagName(""LI"");
 var getAgn = getEls;
 for (var i=0; i&lt;getEls.length; i++) {
 getEls[i].onclick=function() {
 for (var x=0; x&lt;getAgn.length; x++) {
 getAgn[x].className=getAgn[x].className.replace(""unclick"", """");
 getAgn[x].className=getAgn[x].className.replace(""click"", ""unclick"");
 }
 if ((this.className.indexOf('unclick'))!=-1) {
 this.className=this.className.replace(""unclick"", """");;
 }
 else {
 this.className+="" click"";
 }
 }
 }
 }
</code></pre>

<p>My first failure started like this:</p>

<pre><code>$(document).ready(function() {
  $('#menu &gt; li').click(function() {
     $('#menu &gt;li &gt; ul').toggleClass('unclick');
  });
});
</code></pre>

<p>That works as far as it goes, but the next bit proved tricky.  So, if anyone feels like having a go, please be my guest :)</p>
","<jquery><css><refactoring><porting>","0","72","2009-10-08 13:54:37"
"1541697","Refactoring nasty legacy systems via AOP or other automated means?","<p>I've recently been playing around with PostSharp, and it brought to mind a problem I faced a few years back: A client's developer had produced a web application, but they had not given a lot of thought to how they managed state information - storing it (don't ask me why) <em>statically</em> on the Application instance in IIS. Needless to say the system didn't scale and was  deeply flawed and unstable. But it was a big and very complex system and thus the cost of redeveloping it was prohibitive. My brief at the time was to try to refactor the code-base to impose proper decoupling between the components.</p>

<p>At the time I tried to using some kind of abstraction mechanism to allow me to intercept all calls to the static resource and redirect them to a component that would properly manage the state data. The problem was there was about 1000 complex references to be redirected (and I didn't have a lot of time to do it in) Manual coding (even with R#) proved to be just too time consuming - we scrapped the code base and rewrote it properly. it took over a year to rewrite.</p>

<p>What I wonder now is - had I had access to an assembly rewriter and/or Aspect oriented programming system (such as a PostSharp) could I have easily automated the refactoring process of finding the direct references and converted them to interface references that could be redirected automatically and supplied by factories.</p>

<p>Has anyone out there used PostSharp or similar systems to rehabilitate pathological legacy systems? How successful were the projects? Did you find after the fact that the effort was worth it? Would you do it again?</p>

<p><strong>UPDATE</strong>:
See <a href=""http://aabs.wordpress.com/2009/10/22/can-aop-help-fix-bad-architectures/"" rel=""nofollow"">this</a> blog post for more discussion.</p>
","<architecture><refactoring><aop><legacy><postsharp>","3","431","2009-10-09 03:49:50"
"1544736","File.ReadAllBytes Code Refactoring","<p>I came across this piece of code today:</p>

<pre><code>public static byte[] ReadContentFromFile(String filePath)
{
    FileInfo fi = new FileInfo(filePath);
    long numBytes = fi.Length;
    byte[] buffer = null;
    if (numBytes &gt; 0)
    {
        try
        {
            FileStream fs = new FileStream(filePath, FileMode.Open);
            BinaryReader br = new BinaryReader(fs);
            buffer = br.ReadBytes((int)numBytes);
            br.Close();
            fs.Close();
        }
        catch (Exception e)
        {
            System.Console.WriteLine(e.StackTrace);
        }
    }
    return buffer;
}
</code></pre>

<p>My first thought is to refactor it down to this:</p>

<pre><code>public static byte[] ReadContentFromFile(String filePath)
{
    return File.ReadAllBytes(filePath);
}
</code></pre>

<p><a href=""http://msdn.microsoft.com/en-us/library/system.io.file.readallbytes.aspx"" rel=""nofollow"">System.IO.File.ReadAllBytes</a> is documented as:</p>

<blockquote>
  <p>Opens a binary file, reads the
  contents of the file into a byte
  array, and then closes the file.</p>
</blockquote>

<p>... but am I missing some key difference? </p>
","<c#><file-io><refactoring>","3","2103","2009-10-09 16:13:31"
"1545681","How to best utilize jQuery to programmatically generate HTML elements","<p>I have a bunch of Javascript functions that look like the following:</p>

<pre><code>function generateBusinessImage (business) {
  var business_image = document.createElement('img');
  business_image.setAttribute('class','photo');
  business_image.alt = business.name;
  business_image.title = business.name;
  business_image.align = 'right';
  business_image.src = business.photo_url;
  return business_image;
}
</code></pre>

<p>This seems like a good canidate for a refactor.  From reviewing a few different jQuery docs, it would appear that I should be able to do something similar to this pseudo code:</p>

<pre><code>return var business_image = document.createElement('img').
  setAttribute('class','photo').
  alt(business.name).
  title(business.title).
  align('right').
  src(business.photo_url);
</code></pre>

<p>Am I on the right track?</p>

<p>Thanks!</p>

<p><strong>EDIT</strong></p>

<p>I'm calling the function above with the following code and the line where I do appendChild on div with generateBusinessImage is where my errors are occurring with some of the answers below:</p>

<pre><code>var div = document.createElement('div');
var div_class = document.createAttribute('class');      
div.setAttribute('class','business');   
div.appendChild(generateBusinessImage(business));
</code></pre>
","<javascript><jquery><refactoring>","1","283","2009-10-09 19:37:02"
"1548085","Revision system - Help improve my code","<p>A section of a site I am building needs some form of revision system and so 
decided to keep it simple and go with one similar to Stack Overflow.</p>

<p>I quickly created the following which works although seems a little messy. I know I can use beforeSave and afterSave but I have no idea how I could implement it.</p>

<p>I know I could probably move more to the model but are they any other ways to improve it?</p>

<p>Revisions controller:</p>

<pre><code>class RevisionsController extends AppController {
    var $name = ""Revisions"";
    var $helpers = array('Diff');

    /**
     * View a list of existing revisions.
     * Displays the changes between revisions with the
     * Diff helper.
     */
    function view($seriesId = null) {
        if ((!$seriesId &amp;&amp; empty($this-&gt;data))) {
            $this-&gt;Session-&gt;setFlash('That Series does not exist', true, array('class' =&gt;
                'error'));
            $this-&gt;redirect('/');
        }

        $revisions = $this-&gt;Revision-&gt;find('all', array('conditions' =&gt; array('Revision.series_id' =&gt;
            $seriesId), 'order' =&gt; 'revision desc', 'contain' =&gt; false));
        $this-&gt;set('revisions', $revisions);
    }

    /**
     * Create a new revision by editing the most recent one.
     * This seems very messy.
     */
    function edit($seriesId = null) {
        if ((!$seriesId &amp;&amp; empty($this-&gt;data))) {
            $this-&gt;Session-&gt;setFlash('That Series does not exist', true, array('class' =&gt;
                'error'));
            $this-&gt;redirect('/');
        }

        if (empty($this-&gt;data)) {
            $latest = $this-&gt;Revision-&gt;find('first', array('conditions' =&gt; array('is_latest' =&gt;
                1, 'series_id' =&gt; $seriesId)));
            $this-&gt;data['Revision']['description'] = $latest['Revision']['description'];
        } else {
            $this-&gt;data['Revision']['revision'] = $this-&gt;Revision-&gt;getNext($seriesId);
            $this-&gt;data['Revision']['series_id'] = $seriesId;
            $this-&gt;Revision-&gt;create();
            if ($this-&gt;Revision-&gt;save($this-&gt;data)) {
                $this-&gt;Revision-&gt;setLatest($this-&gt;Revision-&gt;id, $seriesId);

                $this-&gt;Session-&gt;setFlash('The edit has been saved.', true, array('class' =&gt;
                    'success'));
                $this-&gt;redirect(array('controller' =&gt; 'series', 'action' =&gt; 'view', $seriesId));
            }
        }

        $this-&gt;set('seriesId', $seriesId);
    }


    /**
     * Creates a new revision using data from a previous one.
     * Currently clones the previous revision rather than
     * just linking it. May need to be changed.
     */
    function rollback($seriesId = null, $revision = null) {
        if (!$seriesId || !$revision) {
            $this-&gt;redirect('/');
        }

        $this-&gt;data = $this-&gt;Revision-&gt;find('first', array('conditions' =&gt; array('Revision.series_id' =&gt;
            $seriesId, 'Revision.revision' =&gt; $revision), 'contain' =&gt; false));

        $this-&gt;data['Revision']['revision'] = $this-&gt;Revision-&gt;getNext($seriesId);
        $this-&gt;data['Revision']['is_rollback'] = 1;
        $this-&gt;data['Revision']['rollback_rev'] = $revision;
        unset($this-&gt;data['Revision']['id']);
        $this-&gt;Revision-&gt;create();
        if ($this-&gt;Revision-&gt;save($this-&gt;data)) {
            $this-&gt;Revision-&gt;setLatest($this-&gt;Revision-&gt;id, $seriesId);

            $this-&gt;Session-&gt;setFlash('The rollback has been saved.', true, array('class' =&gt;
                'success'));
            $this-&gt;redirect(array('controller' =&gt; 'series', 'action' =&gt; 'view', $seriesId));
        }
    }

}
</code></pre>

<p>Revision model:</p>

<pre><code>class Revision extends AppModel {

    var $name = 'Revision';

    var $belongsTo = array('Series' =&gt; array('counterCache' =&gt; true));
    var $actsAs = array('Containable');

    function getCurrent($seriesId = null) {
        if (!$seriesId)
            return false;

        $series = $this-&gt;Series-&gt;find('first', array('conditions' =&gt; array('Series.id' =&gt;
            $seriesId), 'contain' =&gt; false));
        return $series['Series']['revision_count'];
    }

    function getNext($seriesId = null) {
        if (!$seriesId)
            return false;

        $revision = $this-&gt;getCurrent($seriesId);
        return $revision + 1;
    }

    function setLatest($id, $seriesId = null) {
        $this-&gt;updateAll(array('Revision.is_latest' =&gt; 0), array('Revision.series_id' =&gt;
            $seriesId));

        $this-&gt;id = $id;
        $this-&gt;saveField('is_latest', 1);
    }

}
</code></pre>
","<php><cakephp><refactoring><versioning>","0","242","2009-10-10 14:23:42"
"1549510","What data exists to show that refactoring is useful?","<p>I'm giving a presentation on refactoring Python.  I'd like to put in a couple of slides giving statistics to show that refactoring is a good thing.  I've been searching the ACM digital library, but it's a bit like looking for a needle in a haystack.  Does anyone know of any statistics on the subject of refactoring in regards to productivity or quality that would be good in a presentation?</p>
","<data><refactoring><productivity><quality><research>","6","276","2009-10-11 00:50:16"
"1555807","How to refactor this in J?","<p>My newbie solution to Project Euler #1</p>

<pre><code>+/((0=3|1+i.1000-1) +. (0=5|1+i.1000-1)) * (1+i.1000-1)
</code></pre>

<p>I know that this can be refactored, and transformed into a function, i don't know how to do it, and I would have to read all the labs to learn it.</p>
","<refactoring><project-euler><j><tacit-programming>","2","191","2009-10-12 17:16:11"
"1557522","How to refactor this in J?","<p>Here is a different approach for the Project Euler #1 solution:</p>

<pre><code>+/~.(3*i.&gt;.1000%3),5*i.&gt;.1000%5
</code></pre>

<p>How to refactor it?</p>
","<refactoring><project-euler><j><tacit-programming>","1","176","2009-10-12 23:37:48"
"1564493","Refactoring Studies","<p>Our development shop is conducting a seminar in a local college to encourage clean code (the standards are from the eponymous book) and best practices. Now we need references for the time and effort saved. Has anybody read studies about it?</p>

<p>Thanks,</p>

<p>Jon</p>
","<refactoring><code-smell>","2","98","2009-10-14 05:59:36"
"1563696","Empirical Data on Refactoring?","<p>Are there any empirical studies that show the impact of refactoring (or lack of refactoring) on a development team's productivity?</p>

<p>(NOTE: I'm only looking for empirical data--From my own experience, I personally know that refactoring works, but I was wondering if there was some hard data to back that claim).</p>
","<refactoring><case-study>","3","66","2009-10-14 00:30:00"
"1569168","If you change code that has a unit test against it, which do you change first?","<p>I have a project that I am building that I have to change a method to behave slightly different. I have several unit tests already built against that method, but I will need to add more to cover the new behavior I am going to add to it. Is it good form to change/add those tests first before making the code change, or do you change your code, fix the broken tests and add the new tests to cover the new behavior?</p>
","<refactoring><tdd>","5","166","2009-10-14 21:40:15"
"1573646","PDO in PHP, how to improve this PDO mysql code","<p>Thanks for checking. All helpful answers/comments are up voted.
I have the following code, which does the job, but imo is not efficient. The reason I think it's not efficient is because I'm using fetchAll + loop <strong>even though I know that the query will return either 1 or no records.</strong></p>

<pre><code>//assume the usual new PDO, binding, and execute are up here

$myval = ""somevalue"";

$res = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);

if (!$res) {
    //no record matches
    //BLOCK A CODE HERE
} else { 
    //found matching record (but always going to be 1 record, no more)	
    foreach($res as $row) {
    	if ($myval == $row['val']){
    		//myval is the same as db
    		//BLOCK B CODE HERE
    	} else {
    		//myval is different from db
    		//BLOCK C CODE HERE
    	}
    }//foreach
}
</code></pre>

<p>How can I improve it to remove the bulky look of the foreach and fetchAll (considering I know it's always going to be 1 or 0 record only)? But I still need similar checkpoints so I can execute the same <code>BLOCK A</code> <code>BLOCK B</code> <code>BLOCK C</code> as my current logic needs it. </p>
","<php><mysql><refactoring><pdo><refactor-my-code>","3","745","2009-10-15 16:48:22"
"1573054","Modifying state of other objects in a constructor: design no-no?","<p>I'm refactoring some code and found this (simplified of course, but general idea):</p>

<pre><code>class Variable:
    def __init__(self):
        self.__constraints = []

    def addConstraint(self, c):
        self.__constraints.append(c)

class Constraint:
    def __init__(self, variables):
        for v in variables:
            v.addConstraint(self)
</code></pre>

<p>The fact that the constructor of Constraint modifies other object's states instead of its own smells a little funky to me.  What do other people think - is this OK, or is it a prime candidate for refactoring?</p>

<p>Edit: My concern is not the parent/child relationship, but that it is linked up inside the constructor rather than in a separate method.</p>
","<python><oop><refactoring><constructor>","2","114","2009-10-15 15:16:29"
"1576960","Finding most commonly edited files in clearcase","<p>We are currently planning a quality improvement exercise and i would like to target the most commonly edited files in our clearcase vobs. Since we have just been through a bug fixing phase the most commonly edited files should give a good indication of where the most bug prone code is, and therefore the most in need of quality improvment.</p>

<p>Does anyone know if there is a way of obtaining a top 100 list of most edited files? Preferably this would cover edits that are happening on multiple branches.</p>
","<version-control><refactoring><clearcase><quality>","2","366","2009-10-16 09:01:25"
"1580210","God object - decrease coupling to a 'master' object","<p>I have an object called Parameters that gets tossed from method to method down and up the call tree, across package boundaries. It has about fifty state variables. Each method might use one or two variables to control its output.</p>

<p>I think this is a bad idea, beacuse I can't easily see what a method needs to function, or even what might happen if with a certain combination of parameters for module Y which is totally unrelated to my current module.</p>

<p>What are some good techniques for decreasing coupling to this god object, or ideally eliminating it ?</p>

<pre><code>        public void ExporterExcelParFonds(ParametresExecution parametres)
    {
        ApplicationExcel appExcel = null;
        LogTool.Instance.ExceptionSoulevee = false;


        bool inclureReferences = parametres.inclureReferences;
        bool inclureBornes = parametres.inclureBornes;
        DateTime dateDebut = parametres.date;
        DateTime dateFin = parametres.dateFin;

        try
        {
            LogTool.Instance.AfficherMessage(Variables.msg_GenerationRapportPortefeuilleReference);

            bool fichiersPreparesAvecSucces = PreparerFichiers(parametres, Sections.exportExcelParFonds);
            if (!fichiersPreparesAvecSucces)
            {
                parametres.afficherRapportApresGeneration = false;
                LogTool.Instance.ExceptionSoulevee = true;
            }
            else
            {
</code></pre>

<p>The caller would do :</p>

<pre><code>                PortefeuillesReference pr = new PortefeuillesReference();
            pr.ExporterExcelParFonds(parametres);
</code></pre>
","<design><oop><refactoring>","6","621","2009-10-16 20:24:17"
"1581877","Migrating to maven from an unusual svn directory structure?","<p>Contrary to a 'normal' svn directory structure I'm using the following structure:</p>

<pre>
trunk/
  project1/
  project2/
  project3/
  ...
branches/
  project1-branch/
    project1/
    project2/
    ...
  project2-branch/
    project1/
    project2/
    ...
tags/
  project1/
    V1
    V2
    ...
</pre>

<p>As you see I don't have separate triples (trunk/branches/tags) for each project. </p>

<p>For development I do a checkout of trunk (sometimes a sparse checkout) containing all the projects I need (there are dependencies between the projects and some projects are simply libraries). </p>

<p>The benefits that I see in this are:</p>

<ul>
<li><p>Update and checkin is easy, because I have a common root directory (trunk) of all projects. One simple <code>svn update</code> or <code>svn commit</code> does it all.</p></li>
<li><p>Creation of a tag or branch is simple, because it's only the trunk that I have to <code>svn copy</code> for this.
(Branches and tags actually contain more projects than needed, but a <code>svn copy</code> is cheap and I still can do sparse checkouts on a branch or tag if needed.)</p></li>
<li><p>Moving of resources from one project to another is easy, because they all live in the same repository.</p></li>
<li><p>Global refactoring (for example changing the package of a commonly used class) is easy when I'm working on a full checkout of trunk, because I can be sure I don't miss a project.</p></li>
<li><p>Merging is easy, because I can always merge the whole branch at once even if there was a refactoring move from one project to another.</p></li>
</ul>

<p><hr /></p>

<p>I intend to migrate to maven and split all the projects from trunk to maven projects. I'd like to benefit from the maven dependency management and from the available plugins (right now I'm using huge custom ant files).</p>

<p><strong>Now my questions are:</strong> </p>

<ul>
<li><p>Do I have to change the svn directory structure to give every project its own triple (trunk/branches/tags)? I guess the answer is 'yes'.</p></li>
<li><p>If I change the structure, which of the benefits mentioned above do I loose (I mean what will be more complicated doing it with maven)?</p></li>
<li><p>What are the equivalent ways to do it with maven?</p></li>
</ul>
","<java><svn><maven-2><refactoring><release-management>","2","2361","2009-10-17 10:09:23"
"1582256","refactoring in iSeries (RPG), is it realistic","<p>Implementing agile in projects requires the ability to do refactoring. It is not really a must, but code refactoring has proven to be a good engineering practice.</p>

<p>In an agile (Scrum) project on the iSeries platform, which requires development (new code and modifications to legacy code) in RPG, RPG LE, is it possible to implement refactoring? If so what are the techniques to do it?</p>

<p>If someone who has tried it could share their experience or just point to references, I would greatly appreciate it.</p>
","<refactoring><ibm-midrange><agile><rpgle><agile-processes>","2","376","2009-10-17 13:50:37"
"1582718","Best practice for the Python-then-profile-then-C design pattern?","<p>A popular software development pattern seems to be:</p>

<ol>
<li>Thrash out the logic and algorithms in Python.</li>
<li>Profile to find out where the slow bits are.</li>
<li>Replace those with C.</li>
<li>Ship code that is the best trade-off between high-level and speedy.</li>
</ol>

<p>I say popular simply because I've seen people talk about it as being a great idea.</p>

<p>But are there any large projects that have actually used this method? Preferably Free software projects so I can have a look and see how they did it - and maybe learn some best practices.</p>
","<python><c><refactoring><profiling>","4","208","2009-10-17 17:24:41"
"1584598","How can I simplify this repetitive jquery?","<p>This code lets me display/hide a custom message <code>msg_one</code> <code>msg_two</code> <code>msg_three</code> when the appropriate div is hovered/unhovered over. The appropriate message is injected into the <code>#screen div</code> and show/hide is then applied. The code is almost identical except for the first 2 lines <code>#one vs #two vs #three</code> and the message being displayed <code>msg_one msg_two msg_three</code>. </p>

<p>How can I simplify this into fewer lines of code to get rid of the repetitiveness?</p>

<pre><code>var msg_one = ""message 1"";
var msg_two = ""message 2"";
var msg_three = ""message 3"";

$(""#one"").hover(function()  { 
    $(""#screen"").html(msg_one).show(); 
}, function(){ 
    $(""#screen"").html("""").hide(); 
});

$(""#two"").hover(function()  { 
    $(""#screen"").html(msg_two).show(); 
}, function(){ 
    $(""#screen"").html("""").hide(); 
});

$(""#three"").hover(function() { 
    $(""#screen"").html(msg_three).show(); 
}, function(){ 
    $(""#screen"").html("""").hide(); 
});
</code></pre>

<p>thanks. </p>
","<javascript><jquery><refactoring>","2","160","2009-10-18 10:59:45"
"1587328","Javascript 'property inheritance'","<p>Is there a way to specify common elements for object literals in an array?</p>

<p>For example:</p>

<pre><code>var array = [ {key: ""hi"", label: ""Hi"", formatter:deleteCheckboxFormatter},
              {key: ""hello"", label: ""Hello"", formatter:deleteCheckboxFormatter},
              {key: ""wut"", label: ""What?"", formatter:deleteCheckboxFormatter}];
</code></pre>

<p>All three records use the same formatter. How would you refactor this?</p>
","<javascript><object><refactoring>","3","116","2009-10-19 07:11:06"
"1587188","What is the best way to find duplicate code?","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/546487/tools-to-identify-code-duplications"">Tools to identify code duplications</a>  </p>
</blockquote>



<p>What tools can I use to find duplicate code that is a good candiate for refactoring?</p>

<p><b>Update:</b></p>

<p>Any language, any IDE.</p>
","<refactoring><code-duplication>","6","1053","2009-10-19 06:10:09"
"1594196","How can I simplify this jquery/javascript","<p>I'm trying to improve my jquery/javascript syntax. Is there a better way to write this?</p>

<pre><code>if (ok)
	var mymsg 	= '&lt;p id=""ok-box""&gt;'
			  	+   ""You're good to go""
				+ '&lt;/p&gt;';
}else {
	var mymsg 	= '&lt;p id=""not-ok-box""&gt;'
			  	+   ""Error""
				+ '&lt;/p&gt;';
}
</code></pre>

<p>I was thinking if jquery/javascript had a similar syntax to the following PHP syntax, it would be great: </p>

<pre><code>$mymsg = ($ok) ? ""You're good to go"" : ""Error"";
</code></pre>
","<javascript><jquery><syntax><refactoring>","3","563","2009-10-20 12:16:26"
"1593875","Can this CSS syntax be improved, be made more organized?","<p>Is there a cleaner way to write the same css <strong>given that <code>input name f1 to f7</code> are all <code>type=text</code> like the first line?</strong> </p>

<p>Thanks</p>

<pre>
#tform input[type=""text""]  { -moz-border-radius:6px; border: 1px solid green; }

#tform input[name=""f1""],
#tform input[name=""f2""],
#tform input[name=""f3""], 
#tform input[name=""f4""],
#tform input[name=""f5""] { width:40%; }

#tform input[name=""f6""] { width:80%; display:block; }

#tform input[name=""f7""] { width:80%; }
</pre>

<p>My problem is actually that I have 3 additional inputs: <code>name f8, f8, f10</code>, also <code>type=text</code> which I'm letting them set width naturally without <code>width:%;</code>. </p>

<p>I thought about putting the 40% into the first line and letting the rest override it, but then those additional 3 will take the 40% by default. </p>
","<css><design><refactoring>","2","91","2009-10-20 11:11:55"
"1595080","Refactoring JSP scriptlet loop to be more readable","<p>I have some JSP code, which writes a tree representing hierachical data. This data is represented using nested layers.</p>

<p>In the JSP code there are many code snippets similar to the following code (which outputs as many closing div tags as is the numerical value of variable differenceAmount):</p>

<pre><code>
&lt;jsp:scriptlet&gt;
    int differenceAmount = previousUserLevel - currentUserLevel;
    for(int i=0;i&lt;differenceAmount;i++){
&lt;/jsp:scriptlet&gt;
&lt;/div&gt;
&lt;jsp:scriptlet&gt;
    }			
&lt;/jsp:scriptlet&gt;
</code></pre>

<p>Using scriptlets is rather inelegant, and reading the code is also not very easy at the first sight. In what way could the code be refactored to be more readable?</p>
","<java><jsp><refactoring><loops><scriptlet>","1","533","2009-10-20 14:37:06"
"1598693","What's the best tool on Windows to rename CSS elements in both a CSS file as well as in multiple HTML files?","<p>I need to rename a large number of CSS elements in both the CSS file in which they are defined as well as in multiple HTML files in which they are used.</p>

<p>What's the best way to do this on Windows?</p>
","<html><css><refactoring>","0","78","2009-10-21 04:16:59"
"1600250","why does this javascript array for loop not work like the literal version?","<p>I'm new to javascript and was trying to refactor some code, clearly there's something I'm missing in javascript that I'd like to learn. This code produces a value once all 5 list boxes have something selected:</p>

<pre><code>function GetTotal() {
        //_listSeverity = document.getElementById(""_listSeverity"");
        function ParseListBoxvalue(listBox) {
        return parseInt(GetListBoxValue(listBox),10);
        }
        _listSeverity = document.getElementById(""&lt;%= _listSeverity.ID %&gt;"");
        _listAssociate = document.getElementById(""&lt;%= _listAssociateImpact.ID %&gt;"");
        _listCustomerImpact = document.getElementById(""&lt;%= _listCustomerImpact.ID %&gt;"");
        _listRegulatoryImpact = document.getElementById(""&lt;%= _listRegulatoryImpact.ID %&gt;"");
        _listShareholderImpact = document.getElementById(""&lt;%= _listShareholderImpact.ID %&gt;"");
        _calculatedTotal = (ParseListBoxvalue(_listAssociate) +
            ParseListBoxvalue(_listSeverity) + ParseListBoxvalue(_listCustomerImpact) 
           +ParseListBoxvalue(_listRegulatoryImpact) + ParseListBoxvalue(_listShareholderImpact)
          )/ 5;
        if (isNaN(_calculatedTotal))
            document.getElementById(""_total"").innerHTML = ""Not enough information"";
        else
            document.getElementById(""_total"").innerHTML = _calculatedTotal;
    }
</code></pre>

<p>Then I tried to refactor into a for loop to eliminate some of the code duplication.
 I tried many methods of <code>if(typeof _calculatedValue !='undefined')</code> I found out on google to see if that could solve it. As I understand it I'm not running into a scope issue here as the only actual scopes are bounded by <code>function(){}</code> declarations. 
This never produces a value. I realize the <code>/ 5</code> isn't in it yet, but that doesn't seem a reason to me for this to always produce a <code>NaN</code>.</p>

<pre><code> function GetTotal() {
        //_listSeverity = document.getElementById(""_listSeverity"");
        function ParseListBoxvalue(listBox) {
        return parseInt(GetListBoxValue(listBox),10);
    }
        var _ListIds=new Array(""&lt;%= _listSeverity.ID %&gt;"",""&lt;%= _listAssociateImpact.ID %&gt;"",
            ""&lt;%= _listCustomerImpact.ID %&gt;"", ""&lt;%= _listRegulatoryImpact.ID %&gt;"",
            ""&lt;%= _listShareholderImpact.ID %&gt;"");
//            _calculatedTotal = (ParseListBoxvalue(_listAssociate) +
//                ParseListBoxvalue(_listSeverity) + ParseListBoxvalue(_listCustomerImpact) 
//               +ParseListBoxvalue(_listRegulatoryImpact) + ParseListBoxvalue(_listShareholderImpact)
        //              )/ 5;
        for (i = 0; i &lt; _ListIds.length; i++) {
            if (i==0)
                _calculatedTotal = ParseListBoxvalue(_ListIds[i]);
            else
                _calculatedTotal += ParseListBoxvalue(_ListIds[i]);
        }

        if (isNaN(_calculatedTotal))
            document.getElementById(""_total"").innerHTML = ""Not enough information"";
        else
            document.getElementById(""_total"").innerHTML = _calculatedTotal;
    }
</code></pre>

<p>The other function should be of no relevance but here it is :</p>

<pre><code>function GetListBoxValue(listBox) {
        index = listBox.selectedIndex
        try {
            opt = listBox.options[index]
            return opt.value;
        } catch (e) { return null; }

    }
</code></pre>

<p>What is wrong with that for loop? or is it something besides the for loop that causes the refactoring to not produce a value?</p>
","<javascript><refactoring><loops>","0","267","2009-10-21 11:30:36"
"1600405","LINQ to SQL refactoring foreach help","<p>Can this be refactored into one LINQ statement? I feel like it can be but can't wrap my head around it. The mishmash of extension methods and LINQ just looks ugly to me. </p>

<p>(db is a DataContext.)</p>

<pre><code>void AddToSeries(Series series, DateTime date)
{
    foreach (var date in db.Ad.Select(ad =&gt; ad.DateTime.Date).Distinct())
    {
        var phraseCount = (from pc in db.PhraseCount
                           where pc.DateTime.Date == date
                           select pc.Count).SingleOrDefault();

        var adCount = db.Ad.Where(ad =&gt; ad.DateTime.Date == date).Count();

        series.Add(new KeyValuePair&lt;DateTime, double&gt;(date, adCount));
    }
}
</code></pre>
","<linq-to-sql><refactoring>","1","124","2009-10-21 12:07:31"
"1603387","Refactoring to Asynchrony?","<p>I program ActionScript for the FlashPlayer. This means compiling a set of ActionScript files into a SWF file (a bunch of bytecode that gets executed by the FlashPlayer in your browser). Anything that is not compiled into the SWF file must be requested. Examples of this would include ANY textual content, media, or graphical content that wasn't originally compiled in. Unfortunately this means dealing with a lot of asynchrony. A double-edged sword since dealing with asynchrony can be a pain in the ass, but can also be a fun force? on your design.</p>

<p>I just want to make the point that ActionScript is single-threaded, but the FlashPlayer is multi-threaded, so things like requesting content over HTTP are done in the background and we are notified of completion via an event broadcasting system (which is built into the language). So the issue here is not a concurrency issue (although I'm interested in any concurrency literature that might be relevant).</p>

<p>When I'm putting together a website I will be adding in functionality a little bit at a time. A little bit at a time usually translates into small steps. And by small step I mean small enough that I don't go from needing content to loading content (e.g. XML using HTTP) in one step. So I'll use, say... Fake It, but at some point I need to implement it for real, hence my search for literature on Refactoring To Asynchrony.</p>

<p>Any thoughts or help would be greatly apprecated. Thanks =)</p>
","<design><language-agnostic><refactoring>","1","55","2009-10-21 20:26:13"
"1608446","Refactoring in Access Queries","<p>so I have inherited an Access DB with different naming conventions applied to tables. It hurts my eyes, and I want to refactor. Code isn't a problem, but what about SQL embedded in the queries?</p>

<p>Going to answer my own question crudely now, but can anyone come up with a better method?</p>
","<ms-access><refactoring><query>","1","186","2009-10-22 16:33:22"
"1606457","Whats wrong with this code? creating a deleting variable in different scopes","<p>I've recently seen some code similar to that outlined below.</p>

<pre><code>public void someMethod() {
  Lecture lect = createLecture();

  ...

  lect.getLectureSeries().delete();
}


public Lecture createLecture() {
  LectureSeries series = new Series();
  Lecture lect = new Lecture(series);

  ...

  return lect;
}
</code></pre>

<p>The point being that some object (in this case the LectureSeries) which needs to be deleted at the end of the call to someMethod() is actually created in the call to another method. I'm trying to explain why it should be created in the same scope it will eventually be deleted. ie</p>

<pre><code>public void someMethod() {
  LectureSeries series = new Series();
  Lecture lect = createLecture(series);

  ...

  series.delete();
}


public Lecture createLecture(LectureSeries series) {
  Lecture lect = new Lecture(series);

  ...

  return lect;
}
</code></pre>

<p>The original code has caused some complication tidying things up when things fail so hopefully the benefits will be evident, but has anyone got any ideas on how I can explain the more general principle behind this refactoring? or anyone want to explain to me why I'm wrong?</p>

<p>== Edit ==</p>

<p>The case in question was a test method so cleaning up anything which had been created during the execution of the test was important. I think though that the unwanted side effect of a LectureSeries being created as a result of the call to createLecture() is still something to try and avoid in most cases.</p>
","<oop><refactoring><variable-scope>","0","64","2009-10-22 11:00:08"
"1607252","How to simplify complicated business ""IF"" logic?","<p>What are the good ways to handle complicated business logic that from the first glance requires many nested if statements?</p>

<p>Example:</p>

<p>Discount Coupon. could be:</p>

<p>1a) Value discount <br>
1b) Percentage discount</p>

<p>2a) Normal discount <br>
2b) Progressive discount</p>

<p>3a) Requires access coupon<br>
3b) Do not require access coupon</p>

<p>4a) Applied only to the customer who already bought before<br>
4b) Applied to any customer</p>

<p>5a) Applied to customer only from countries (X,Y,…)<br></p>

<p>That requires code even more complicated then this:</p>

<pre><code>if (discount.isPercentage) {
    if (discount.isNormal) {
        if (discount.requiresAccessCoupon) {
        } else {
        }
    } else if (discount.isProgressive) {
        if (discount.requiresAccessCoupon) {
        } else {
        }
    }
} else if (discount.isValue) {
    if (discount.isNormal) {
        if (discount.requiresAccessCoupon) {
        } else {
        }
    } else if (discount.isProgressive) {
        if (discount.requiresAccessCoupon) {
        } else {
        }
    }
} else if (discount.isXXX) {
    if (discount.isNormal) {
    } else if (discount.isProgressive) {
    }
}
</code></pre>

<p>Even if you replace IFs to switch/case it's still too complicated.
What are the ways to make it readable, maintainable, more testable and easy to understand?</p>
","<refactoring><business-logic>","9","515","2009-10-22 13:34:38"
"1607291","C# Enum pointing to another Enum (refactoring)","<p>Is there a way I could point an Enum to another Enum? Here are the needs and details:</p>

<p>Currently: </p>

<ul>
<li>I have a two public classes com.abcd.MyManager and com.abcd.data.MyObject.</li>
<li>MyObject class have pretty much everything is private except Types enum member.</li>
<li>MyManager class uses MyObject class</li>
<li>Notice MyObject class lives in a separate namespace.</li>
<li>One of the MyManager methods have following signature:<br />
<code>
public void Init(string name, MyObject.Types type)<br />
{<br />
// does Init<br />
}<br />
</code></li>
</ul>

<p>Refactor requirement: </p>

<ul>
<li>Just because of MyObject.Types used in the Init method and also it is living in another namespace. Developers have to include both namespaces in their code. I like to move the MyObject.Types enum to MyManager class. something similar like this:<br />
<code>
public void Init(string name, MyManager.Types type)<br />
{<br />
// does Init<br />
}<br />
</code></li>
</ul>

<p>Any suggestions on how could I do this without breaking current structure? Thanks.</p>
","<c#><refactoring><enums>","0","336","2009-10-22 13:41:19"
"1609382","ReSharper Keyboard Map","<p>Hi guys:
I have been using ReSharper from  before Visual Studio added Refactor. Then, it was inevitable to use ReSharper. Now that Visual Studio includes a few Refactor functions, I get to do projects where the client can do without paying for the ReSharper licence. </p>

<p>My problem is that I am so used to the ReSharper keymap that switching to VS will affect my fluency and productivity. I am sure there would be some smart guy out there who has the same problem and, unlike me, has done something about it by creating a keymap macro.</p>

<p>I'd like to be able to type my ReSharper key combinations in Visual Studio and get the same refactor functionality (where supported). </p>

<p>Does anyone know?</p>
","<visual-studio><refactoring><resharper><productivity><rad>","2","378","2009-10-22 19:15:52"
"1613569","Create a deep object graph with Linq to XML, refactoring?","<p>I am writing a simple XML file parser using LINQ to XML. </p>

<p>I want to have a TreeNode object (i.e a simple Tree structure) for each element in the XML. I want each element to be strongly typed.</p>

<p>It looks ugly and redundant compared to the simple looping approach I was using before (using System.XML). Is there a way to strip out the redundancies here?</p>

<pre><code>        XElement ops = XElement.Load(@""c:\temp\exp.xml"");
        Tree&lt;Element&gt; domain = new Tree&lt;Element&gt;();
        domain.Root = new TreeNode&lt;Element&gt;();
        var cells =
                    from cell in ops.Elements(""cell"")
                    select new
                    {
                        TreeNodeObj = new TreeNode&lt;Element&gt;
                            (new Cell((string)cell.Attribute(""name""), (string)cell.Attribute(""name""), null)),
                        XElem = cell
                    };
        foreach (var cell in cells)
        {
            domain.Root.AddChild(cell.TreeNodeObj);
            var agents =
                    from agent in cell.XElem.Elements(""agent"")
                    select new
                    {
                        TreeNodeObj = new TreeNode&lt;Element&gt;
                            (new Agent((string)agent.Attribute(""name""), (string)agent.Attribute(""name""), null)),
                        XElem = agent
                    };
            foreach (var agent in agents)
            {
                cell.TreeNodeObj.AddChild(agent.TreeNodeObj);
                var nas =
                    from na in agent.XElem.Elements(""node-agent"")
                    select new
                    {
                        TreeNodeObj = new TreeNode&lt;Element&gt;
                            (new NodeAgent((string)na.Attribute(""name""), (string)na.Attribute(""name""), null)),
                        XElem = agent
                    };
                foreach (var na in nas)
                {
                    agent.TreeNodeObj.AddChild(na.TreeNodeObj);
                }
            }
        }
</code></pre>
","<c#><refactoring><linq-to-xml>","2","443","2009-10-23 13:47:03"
"1617990","Mapping switch statements to data classes","<p>This seems to come up alot in my code, i'm wondering if there is some way of removing the switch statement, or if there is a more elegant way of doing it?</p>

<pre><code>    public class MetaData
{
    public string AlbumArtist { get; set; }
    public string AlbumTitle { get; set; }
    public string Year { get; set; }
    public string SongTitle { get; set; }


    public static MetaData CreateMetaDataFrom(IEnumerable&lt;TextFrame&gt; textFrames)
    {
        var metaData = new MetaData();

        foreach (var frame in textFrames)
        {
            switch (frame.Descriptor.ID)
            {
                case ""TPE1"":
                    metaData.AlbumArtist = frame.Content;
                    break;

                case ""TALB"":
                    metaData.AlbumTitle = frame.Content;
                    break;

                case ""TIT2"":
                    metaData.SongTitle = frame.Content;
                    break;

                case ""TYER"":
                    metaData.Year = frame.Content;
                    break;
            }
        }

        return metaData;
    }
}
</code></pre>
","<c#><.net><refactoring><switch-statement>","1","180","2009-10-24 13:14:13"
"1618958","Java: DRY out these two functions","<p>These two functions have basically the same code. How can I factor it out?</p>

<pre><code>public static String[] removeSuffix(String gA, String gB) {

    	String[] results = new String[2];
    	results[0] = gA;
    	results[1] = gB;

    	if (gA.equals("""") || gB.equals("""")) {
    		return results;
    	}

    	if (gA.charAt(gA.length() - 1) == gB.charAt(gB.length() - 1)) {
    		return removeSuffix(gA.substring(0, gA.length() - 1), gB.substring(0, gB.length() - 1));
    	}
    	else {
    		return results;
    	}
    }


    public static String[] removePrefix(String gA, String gB) {

    	String[] results = new String[2];
    	results[0] = gA;
    	results[1] = gB;

    	if (gA.equals("""") || gB.equals("""")) {
    		return results;
    	}

    	if (gA.charAt(0) == gB.charAt(0)) {
    		return removePrefix(gA.substring(1), gB.substring(1));
    	}
    	else { //if the first two chars are not equal
    		return results;
    	}
    }
</code></pre>
","<java><code-review><dry><refactoring>","4","405","2009-10-24 20:17:09"
"1620250","xCode refactoring fails - ""can't find @implementation for class""","<p>I'm just starting to refactor my spaghetti code in xcode.  I do the following:</p>

<ul>
<li>select my class name in the header file</li>
<li>choose Refactor from the menu</li>
<li>pick ""Create superclass of"" from the dropdown</li>
<li>type in my superclass name</li>
<li>hit Preview</li>
</ul>

<p>Then I get this big ugly error popup:
""Can't find @implementation for class 'MyUglyClass'""
... and the refactor process exits.</p>

<p>Now I know the implementation is there in the .m file.  The app builds and runs fine, no errors, no warnings, and xcode will happily ""Jump To Definition"".</p>

<p>Can anybody suggest what the problem might be?  I could just refactor this by hand - no bog deal - but that's not a habit I want to get into.</p>

<p>Thanks heaps,
LBB</p>
","<xcode><refactoring>","0","324","2009-10-25 07:25:03"
"1632624","Creating testable code","<p>I have a file - in a large legacy codebase - containing methods that access databases.
No classes are used, just a header file with the method declarations, and the source file with the implementation.</p>

<p>I want to override these methods to eliminate the DB access during unit testing.<br></p>

<p>I thought of the following options:<br></p>

<ol>
<li>Make file into class and override methods.<br> 
The main minus here is that it results in alot of changes throughout the codebase.<br>
Not ideal, though it does improve the code...</li>
<li> Wrap the whole source file with an <code>#ifdef PRODUCTION_CODE</code> and create a new source file containing the stub and wrap it with the opposite, i.e. make the whole thing compilation dependent. Problem here is that in a build system that performs regression tests I would have to compile twice, once in order to create the apps and do regression tests, and an additional time to create the unit test executables.</ol>

<p>Any recommended ways of doing this?</p>
","<c++><unit-testing><refactoring><testability>","1","255","2009-10-27 18:04:43"
"1635324","How can I identify and remove redundant code in Perl?","<p>I have a Perl codebase, and there are a lot of redundant functions and they are spread across many files.</p>

<p>Is there a convenient  way to identify those redundant functions in the codebase?
Is there any simple tool that can verify my codebase for this?</p>
","<perl><refactoring>","7","257","2009-10-28 05:20:14"
"1641856","Refactor Django template forloop","<p>I feel like there has to be a cleaner way to do somthing like this. I have 15 or so objects that list out with three on a row. Anyone know a better solutions. </p>

<pre><code>&lt;ul&gt;
    {% for object in object_list %}

        &lt;li
            {% ifequal forloop.counter 1  %}class=""first""{% endifequal %}
            {% ifequal forloop.counter 4  %}class=""first""{% endifequal %}
            {% ifequal forloop.counter 7  %}class=""first""{% endifequal %}
            {% ifequal forloop.counter 10  %}class=""first""{% endifequal %}
            {% ifequal forloop.counter 13  %}class=""first""{% endifequal %}   
        &gt;
            {{ object.title }}
        &lt;/li&gt;

        {% ifequal forloop.counter 3 %}&lt;div class=""clear""&gt;&lt;/div&gt;{% endifequal %}
        {% ifequal forloop.counter 6 %}&lt;div class=""clear""&gt;&lt;/div&gt;{% endifequal %}
        {% ifequal forloop.counter 9 %}&lt;div class=""clear""&gt;&lt;/div&gt;{% endifequal %}
        {% ifequal forloop.counter 12 %}&lt;div class=""clear""&gt;&lt;/div&gt;{% endifequal %}
        {% ifequal forloop.counter 15 %}&lt;div class=""clear""&gt;&lt;/div&gt;{% endifequal %}
    {% endfor %}
&lt;/ul&gt;
</code></pre>

<p>For the second loop you can do</p>

<pre><code>{% if forloop.counter|divisibleby:""3"" %}&lt;div class=""clear""&gt;&lt;/div&gt;{% endif %}
</code></pre>

<p>But 1,4,7,10,13 dont have a common denominator. </p>

<p>Any help is appreciated.</p>
","<refactoring><django-templates><for-loop>","0","259","2009-10-29 06:03:23"
"1644525","Risks associated with changing from default package in Java?","<p>I have an existing code base that is not packaged at all.</p>

<p>The code base is all minor Java programs designed to extend/enhance the functionality of a third party program. The current process is one jar per class, one class per file, no package.</p>

<p>I'd like to break out the code-base so each jar file is also a package; this eases my jar process in Eclipse.</p>

<p>Are there any risks associated with this I need to be aware of?</p>
","<java><eclipse><jar><refactoring>","0","417","2009-10-29 15:25:55"
"1645449","Refactor method with multiple return points","<p>**EDIT: There are several options below that would work.  Please vote/comment according to your views on the matter. </p>

<p>I'm working on cleaning up and adding functionality to a c# method with the following basic structure:</p>

<pre><code>    public void processStuff()
    {
        Status returnStatus = Status.Success;
        try
        {
            bool step1succeeded = performStep1();
            if (!step1succeeded)
                return Status.Error;

            bool step2suceeded = performStep2();
            if (!step2suceeded)
                return Status.Warning;

            //.. More steps, some of which could change returnStatus..//

            bool step3succeeded = performStep3();
            if (!step3succeeded)
                return Status.Error;
        }
        catch (Exception ex)
        {
            log(ex);
            returnStatus = Status.Error;
        }
        finally
        {
            //some necessary cleanup
        }

        return returnStatus;
    }
</code></pre>

<p>There are many steps, and in most cases step x must succeed in order to proceed to step x+1.  Now, I need to add some functionality that will always run at the end of the method, but which depends on the return value.  I'm looking for recommendations on how to cleanly refactor this for the desired effect.  The obvious choice would be to put the functionality that depends on the return value in the calling code, but I'm not able to modify the callers.</p>

<p>One option:</p>

<pre><code>    public void processStuff()
    {
        Status returnStatus = Status.Success;
        try
        {
            bool step1succeeded = performStep1();
            if (!step1succeeded)
            {
                returnStatus =  Status.Error;
                throw new Exception(""Error"");
            }

            bool step2succeeded = performStep2();
            if (!step2succeeded)
            {
                returnStatus =  Status.Warning;
                throw new Exception(""Warning"");
            }

            //.. the rest of the steps ..//
        }
        catch (Exception ex)
        {
            log(ex);
        }
        finally
        {
            //some necessary cleanup
        }
        FinalProcessing(returnStatus);
        return returnStatus;
    }
</code></pre>

<p>This seems a little ugly to me.  Instead, I could throw right from the performStepX() methods.  However, this leaves the problem of setting the returnStatus variable appropriately in the catch block of processStuff().  As you may have noticed, the value returned on failure of a processing step depends on which step failed. </p>

<pre><code>    public void processStuff()
    {
        Status returnStatus = Status.Success;
        try
        {
            bool step1succeeded = performStep1(); //throws on failure
            bool step2succeeded = performStep2(); //throws on failure

            //.. the rest of the steps ..//
        }
        catch (Exception ex)
        {
            log(ex);
            returnStatus = Status.Error;  //This is wrong if step 2 fails!
        }
        finally
        {
            //some necessary cleanup
        }
        FinalProcessing(returnStatus);
        return returnStatus;
    }
</code></pre>

<p>I would appreciate any suggestions that you might have.</p>
","<c#><refactoring>","7","377","2009-10-29 17:50:02"
"1647415","Is it possible in C# to access an object's fields using field names generated at runtime","<p>Here is what I mean:</p>

<p>I need to be able to substitute this ugly looking C# code:</p>

<pre><code>if (attribute.Name == ""Name"") machinePool.Name = attribute.Value;
else if (attribute.Name == ""Capabilities"") machinePool.Capabilities = attribute.Value;
else if (attribute.Name == ""FillFactor"") machinePool.FillFactor = attribute.Value;
</code></pre>

<p>into something like this:</p>

<pre><code>machinePool.ConvertStringToObjectField(attribute.Name) = attribute.Value;
</code></pre>

<p>There is no ConvertStringToObjectField() method, but I would like to have something like this, if it's possible. I have access to the machinePool object class code, so I can add neccessary code, but I am not sure what code it may be or is it even possible to do in C#. </p>
","<c#><refactoring><ref>","2","347","2009-10-30 00:40:55"
"1648887","Hibernate updating database structure with new indexes","<p>It's well known fact that hibernate work with indexes in a very strange way. It generate them only if you create a database schema from the scratch. But if you try to update the database schema hibernate will ignore new indexes.</p>

<p>My question is, does anybody find a solution how to ask hibernate generate SQL for new indexes during schema update.</p>

<p><strong>UPDATE:</strong>
I'll disagree with <a href=""http://stackoverflow.com/users/27343/stefan-steinegger"">Stefan Steinegger</a>. Index management with hibernate it's a pain. Nice to see that the feature was scheduled for next release (3.5.x) and will be backward compatible to 3.3.x and 3.2.x as well. Details are <a href=""http://opensource.atlassian.com/projects/hibernate/browse/HHH-1012"" rel=""nofollow"">here</a>.</p>
","<database><nhibernate><hibernate><refactoring><index>","1","621","2009-10-30 09:48:57"
"1652796","How do you write these loops in a nicer way in Java?","<p>I have a set of objects I'd like to do some operations on, in the order they're iterated. After that operation gets called on them, I'd like to perform other operations on them. Basically, the code will look sort of like this:</p>

<pre><code>for(int i = 0;i &lt; myobj.size();i++)
{
   myobj.at(i).doSomething();
}

for(int i = 0;i &lt; myobj.size();i++)
{
   myobj.at(i).doSomethingElse();
}
</code></pre>

<p>This looks kind of ugly to me. How could I rewrite this into something better? The order of the operations should stay the same.</p>
","<java><refactoring><loops>","3","293","2009-10-30 23:35:50"
"1655217","How to convert a PHP function to a non-function?","<p>How can I convert the php function in the code below to a non-function.</p>

<pre><code>&lt;?php
require_once ('./mysqli_connect.php'); // Connect to the db.

function make_list ($parent)
{
    global $tasks;
    echo '&lt;ol&gt;';
    foreach ($parent as $task_id =&gt; $todo)
    {
        echo ""&lt;li&gt;$todo"";
        if (isset($tasks[$task_id]))
        { 
            make_list($tasks[$task_id]);
        }
        echo '&lt;/li&gt;';
    }

    // Close the ordered list:
    echo '&lt;/ol&gt;';
}

$mysqli = new mysqli(""localhost"", ""root"", """", ""sitename"");
$dbc = mysqli_query($mysqli,""SELECT task_id, parent_id, task FROM tasks WHERE date_completed='0000-00-00 00:00:00' ORDER BY parent_id, date_added ASC"");

if (!$dbc)
{
    // There was an error...do something about it here...
    print mysqli_error();
} 
$tasks = array();

while (list($task_id, $parent_id, $task) = mysqli_fetch_array($dbc, MYSQLI_NUM))
{
    // Add to the array:
    $tasks[$parent_id][$task_id] =  $task;
}

make_list($tasks[0]);

mysqli_close(); // close the connection

// Include the html footer
include('./includes/footer.html');
?&gt;
</code></pre>

<p>Would it be better to leave my code like this even though the rest of my code that I have not posted is in non function form.</p>
","<php><refactoring>","0","105","2009-10-31 18:39:54"
"1656831","Does any one know of any APEX refactoring tools?","<p>The company that owns the company that I work for has recently decided unilaterally that the salesforce.com and force.com platform are where we are headed. Currently, we're a C# .NET shop and we frequently use Visual Studio and Resharper in our daily work.</p>

<p>I'm not happy about this decision but, like any good developer, I'm willing to give it a chance and investigate this new technology to see what things might be like if I'm forced to make the decision to transition from a .NET to a APEX developer. So far, I must admit to not being all that impressed with the Force.com platform. To be fair, there are somethings that seem quite ok...but other things just suck...just look at their ideas on what constitute <a href=""http://wiki.developerforce.com/index.php/How%5Fto%5FWrite%5FGood%5FUnit%5FTests"" rel=""nofollow"">good</a> <a href=""http://www.salesforce.com/us/developer/docs/apexcode/salesforce%5Fapex%5Flanguage%5Freference.pdf"" rel=""nofollow"">unit tests</a>.... Luckily, those sort of mistakes are something I can avoid by actually writing proper unit tests regardless of how much the people behind salesforce.com's documentation suck....</p>

<p>However, and sorry for the rant (I just really needed to get that off my chest), the one thing that I've found missing that I know I'd really miss is a good refactoring tool like Resharper. As a .NET developer, Resharper makes it possible to do a lot of heavy lifting that I would otherwise be hesitant to do. It also makes developing TDD style much easier cause I can easily create new methods and properties with just a few keystrokes. As such, I'm on the lookout for any sort of refactoring tool that is available for Eclipse and the APEX programming language. I've downloaded and installed the tools recommended by the force.com developers site but so far I have seen very little in the way of refactoring support.</p>

<p>Does anyone know of the existence of any refactoring tools for use with the APEX programming language?</p>
","<eclipse><refactoring><eclipse-plugin><salesforce><apex-code>","2","289","2009-11-01 10:29:41"
"1661587","How to call overridden methods in a subclass? Potential candidate for refactoring","<p>Originally I had a design problem where I needed five subclasses of a superclass, where all but two would use the same generic method of doing things and the other two classes would need special handling. I wanted to avoid writing the method five times; two special cases and three identical ones.</p>

<p>So I had every class inherit SuperClass, and its doSomething() method, and had SubClassSpecial1 and SubClassSpecial2 override with their own doSomeThing method.</p>

<p>This was all fine until I wrote a method which looked something like</p>

<pre><code>void fooBar(SuperClass obj) {
    obj.doSomething()
}
</code></pre>

<p>and it could be called as <code>fooBar( new SubClassSpecial1() );</code></p>

<p>The problem is that the runtime class of the <code>obj</code> variable is now that of its superclass, and thus it will call the methods defined in the superclass. I could, of course, make an abstract doSometing() method in the superclass, and make each subclass implement its own version, but that would duplicate code in three of the classes. And I want to avoid doing that ...</p>

<p>I would lose any gain polymorphism gives if I had a lot of branching through</p>

<pre><code>if(obj.getClass().getName() == ""SubClassSpecial1"" )  ((SubClassSpecial1) obj).doSomething()K;
else if ...
</code></pre>

<p>So what should I do in order to make the design more elegant and un-hackish?</p>
","<java><refactoring><polymorphism><override><subclass>","3","1322","2009-11-02 14:23:29"
"1666496","C# - Casting an 'object' parameter into that object's type?","<p>C#</p>

<p>Hi all,</p>

<p>I pass an object to a method.</p>

<p><b>I want to cast that object to its specific class so I can perform its own specific methods? How can I do that?</b></p>

<pre><code>Move( new Cat() );
Move( new Pigeon() );

public void Move(object objectToMove)
{
    if(objectToMove== Cat)
    {
        Cat catObject = objectToMove as Cat;
        catObject.Walk();
    }
    else if(objectToMove== Pigeon)
    {
        Rat pigeonObject = objectToMove as Pigeon;
        pigeonObject.Fly();
    }
}
</code></pre>
","<c#><reflection><refactoring>","2","767","2009-11-03 10:29:02"
"1676103","How can I remove repeated code in my actions?","<p>I have the following code repeated several times in a mvc app.</p>

<pre><code>    public ActionResult AnAction(int Id)
    {           
        var claim = GetClaim(Id);
        if (claim == null)
        {
            return View(""ClaimNotFound"");
        }

        // do stuff here
        ....
        return ....;
    }
</code></pre>

<p>So far this pattern is used 4 times and it's getting ugly.  What is the best way to refactor it?</p>

<p><strong>Edit:</strong><br>
A couple of example usages</p>

<pre><code>    public ActionResult Claim(int Id)
    {           
        var claim = GetClaim(Id);
        if (claim == null)
        {
            return View(""ClaimNotFound"");
        }

        return View(""Claim"", claim);
    }

    public ActionResult MedicalPV(int Id)
    {
        var claim = GetClaim(Id);
        if (claim == null)
        {
            return View(""ClaimNotFound"");
        }

        return PartialView(claim.MedCerts.AsQueryable&lt;MedCert&gt;());
    }
</code></pre>

<p>Typically I am requiring access to the object in the view.  This particular code is only used in one controller, but I am may need something similar in other controllers with different objects and views.</p>
","<c#><asp.net-mvc><refactoring>","2","257","2009-11-04 19:39:32"
"1682784","How can I improve this Comparator?","<p>I've got a few <code>Comparator</code>s -- one for <code>Date</code>s, one for decimals, one for percentages, etc.</p>

<p>At first my decimal comparator looked like this:</p>

<pre><code>class NumericComparator implements Comparator&lt;String&gt; {

  @Override
  public int compare(String s1, String s2) {
    final Double i1 = Double.parseDouble(s1);
    final Double i2 = Double.parseDouble(s2);
    return i1.compareTo(i2);
  }

}
</code></pre>

<p>Life was simple. Of course, this doesn't handle the case where the strings aren't parseable. So I improved <code>compare()</code>:</p>

<pre><code>class NumericComparator implements Comparator&lt;String&gt; {

  @Override
  public int compare(String s1, String s2) {
    final Double i1;
    final Double i2;

    try {
      i1 = Double.parseDouble(s1);
    } catch (NumberFormatException e) {
      try {
        i2 = Double.parseDouble(s2);
      } catch (NumberFormatException e2) {
        return 0;
      }
      return -1;
    }
    try {
      i2 = Double.parseDouble(s2);
    } catch (NumberFormatException e) {
      return 1;
    }

    return i1.compareTo(i2);
  }
}
</code></pre>

<p>Life was better. Tests felt more solid. However, my code reviewer pointed out, ""What about <code>null</code>s?""</p>

<p>Great, so now I have to repeat the above with <code>NullPointerException</code> or prepend the method body with:</p>

<pre><code>if (s1 == null) {
  if (s2 == null) {
    return 0;
  } else {
    return -1;
  }
} else if (s2 == null) {
  return 1;
}
</code></pre>

<p>This method is huge. The worst part is, I need to repeat this pattern with <em>three other classes</em> which compare different types of strings and could raise <em>three other exceptions</em> while parsing.</p>

<p>I'm not a Java expert. Is there a cleaner, neater solution than -- <em>gasp</em> -- copying and pasting? Should I trade correctness for lack of complexity so as long as it is documented?</p>

<p><hr></p>

<p><strong>Update:</strong> Some have suggested that it's not the <code>Comparator</code>'s job to handle <code>null</code> values. Since the sort results are displayed to users I indeed want nulls to be sorted <em>consistently</em>.</p>
","<java><refactoring><comparator>","4","614","2009-11-05 18:56:00"
"1681287","'Remove middleman' IntelliJ refactoring on an empty interface","<p>I have an interface which is now empty, and extends another interface. I'd like to remove the empty interface and use the base interface, and am trying to find the correct refactoring in IntelliJ.</p>

<p>I've tried ""remove middleman"" but got ""cannot perform the refactoring. The caret should be positioned at the name of the field to be refactored"".</p>
","<java><refactoring><interface><intellij-idea>","2","276","2009-11-05 15:28:41"
"1682654","When Refactoring a project to improve maintainability, what are some of the things to target?","<p>I've got a project (about 80K LOC) that I'm working on, and I've got nearly a full month of luxury refactoring and feature adding time prior to release so long as I'm careful not to break anything.  With that being said, what can I do to improve maintainability.  Please not there was no unit testing in place with this project and I'm not really PLANNING to add unit tests to this, however if it is the common consensus I will take it under consideration. </p>

<p>What are the key things I should look for and consider revising or refactoring to improve software maintainability and quality?</p>

<p>Edit: It's been made clear to me I need unit testing.  This is not something I've ever really done, what are some good resources for a developer new to unit testing (preferably via VS2008's unit testing framework)?</p>
","<refactoring><maintainability>","3","203","2009-11-05 18:37:56"
"1683698","Null pointers everywhere because data is suddenly sparse","<p>Someone designed code that relied on full data; the XML always had every element.  The data source is now sending sparse XML; if it would have been empty before, it's missing now.  So, it's time to refactor while fixing bugs.</p>

<p>There's 100+ lines of code like this:</p>

<pre><code>functionDoSomething(foo, bar, getRoot().getChild(""1"").getChild(""A"").
    getChild(""oo"").getContent());
</code></pre>

<p>Except now, getChild(""A"") might return null.  Or any of the getChild(xxx) methods might.</p>

<p>As one additional twist, instead of getChild(), there are actually four separate methods, which can only occur in certain orders.  Someone suggested a varargs call, which isn't a bad idea, but won't work as cleanly as I might like.</p>

<p>What's the quickest way to clean this one up?  The best?  ""try/catch"" around every line was suggested, but man, that's ugly.  Breaking out the third argument to the above method into it's own function could work... but that would entail 100+ new methods, which feels ugly, albeit less so.</p>

<p>The number of getChild(xxx) calls is somewhere between six and ten per line, with no fixed depth.  There's also no possible way to get a correct DTD for this; things will be added later without a prior heads up, and where I'd prefer a warning in the logs when that happens, extra lines in the XML need to be handled gracefully.</p>

<p>Ideas?</p>

<p><i> getChild() is a convenience method, actually.  The cleanest way I have in mind is to have the convenience methods return a valid Child object, but have that ""empty"" Child's getContent() always return """".</i></p>
","<java><refactoring><nullpointerexception>","4","232","2009-11-05 21:20:19"
"1695195","Optimising and Redesigning an existing Application","<p>This seems to be a popular complaint on many programmer forums so I wouldn't be surprised if this question was already on here. Sorry if it has already been answered but I've searched and couldn't find one that relates to Java/OO.</p>

<p>I have a somewhat complicated application that was written a number of months ago. It works well, but is slow and the code is extremely ugly. Classes are split up for no logical reason, half the UI is in the logic code and it's really frustratingly built. I want to redesign and redevelop this program to the correct design standards, yet I don't want to break it completely. There's no design documents, no documentation, nothing but the code (with no formatting) and the built application.</p>

<p>What's the best way of taking an existing Java project, written in the most annoying way possible and redeveloping it in the best way possible? Are there any good tools that'll help me find speed bottlenecks or for extensive testing in NetBeans? Any help for a total novice of testing would be greatly appreciated.</p>

<p><strong>EDIT:</strong> You're correct when saying that we don't really understand this program. It does what we want, but it also does other things and we're not exactly aware of, like creating strange graphics and weird numbers appearing on the UI. The main reason we want this redesigned is so that we can actually find out what's going on, but as I've said the code is so messy you'd think it was written by a genius that didn't want us to find out his secrets.</p>
","<java><design-patterns><refactoring>","4","136","2009-11-08 02:50:18"
"1695541","How can I optimize this SQL query to get rid of the filesort and temp table?","<p>Here's the query:</p>

<pre><code>SELECT 
  count(id) AS count 
FROM `numbers` 
GROUP BY 
  MONTH(created_at), 
  YEAR(created_at) 
ORDER BY 
  YEAR(created_at), 
  MONTH(created_at)
</code></pre>

<p>That query throws a 'Using temporary' and 'Using filesort' when doing EXPLAIN.</p>

<p>Ultimately what I'm doing is looking at a table of user-submitted tracking numbers and counting the number of submitted rows a grouping the counts by month/year.</p>

<p>ie. In November 2008 there were 11,312 submitted rows.</p>

<p><strong>UPDATE</strong>, here's the DESCRIBE for the <code>numbers</code> table.</p>

<pre><code>id  int(11)	NO	PRI	NULL	auto_increment
tracking    varchar(255)	YES		NULL	
service varchar(255)	YES		NULL	
notes   text	YES		NULL	
user_id int(11)	YES		NULL	
active  tinyint(1)	YES		1	
deleted tinyint(1)	YES		0	
feed    text	YES		NULL	
status  varchar(255)	YES		NULL	
created_at  datetime	YES		NULL	
updated_at  datetime	YES		NULL	
scheduled_delivery  date	YES		NULL	
carrier_service varchar(255)	YES		NULL
</code></pre>
","<sql><mysql><database><refactoring>","1","160","2009-11-08 06:08:47"
"1697609","Refactoring function calls while reducing code duplication of resulting class definitions","<p>I have a header file with about 400 function declarations and its corresponding source file with the definitions.</p>

<p>In order to replace the implementation with a mock at runtime, I want to replace the implementation with calls to an object that will contain the implementation instead (pointer to implementation - pImpl).</p>

<p>This means I will have the following files:</p>

<ul>
<li><b>mainFile.h</b> - contains the method declarations as before (must remain as I cannot replace the interface with the client code)
<li><b>IImpl.h</b> - Abstract base (interface) for the implementation object
<li><b>mainFile.cpp</b> - Will contain method definitions where all it does it call the corresponding method on IImpl*
<li><b>SpecificImpl.cpp</b> - Contains the declaration and definition of the specific implementation
<li><b>MockImpl.cpp</b> - Contains the declaration and definition of the implementation used during testing
</ul> 

<p>The main problem with this is the duplication of the 400 method declarations which appear in the main header file and again in each class definition.</p>

<p>Is there any way I can avoid this duplication? I was trying with macros, but then the order of the includes became too specific...</p>
","<c++><design><refactoring>","3","282","2009-11-08 19:24:30"
"1697073","Good open-source codebase for learning refactoring","<p>What open-source codebases have you used to learn refactoring, written in either java or C# ? One requirement is good unit tests.</p>
","<refactoring>","1","206","2009-11-08 16:36:13"
"1696742","C# property refactoring - Should I care?","<p>I have following code:</p>

<pre><code>public class Header
{
    Line Lines { get { ...}}

    public ICryptographer GetCryptographer(FieldGroup group)
    {
        ...
    }
}

public class Line
{

    public Header Header { get; set; }
    public FieldGroup FieldGroup { get; set; }

    ICryptographer CryptoGrapher { get { return Header.GetCryptographer(FieldGroup); } }

    public decimal? Month1
    {
        get { return _month1; }
        set
        {
            if (_month1 != value)
                Month1_Enc = CryptoGrapher.Encrypt(_month1 = value);
        }
    }
    private decimal? _month1;

    protected byte[] Month1_Enc { get; set; }

    //The same repeated for Month2 to Month12
}

public interface ICryptographer
{
    byte[] Encrypt(decimal? value);
    decimal? DecryptDecimal(byte[] value);
}

public enum FieldGroup
{
   ...
}
</code></pre>

<p>Shortly properties Month1 to Month12 are of type decimal? that should be encrypted before they are saved in database. 
I have also few other classes that have encrypted properties. Every property code looks exactly the same as Month1 I showed here.</p>

<p>Ideally I would like to have something like this:</p>

<pre><code>Encrypted&lt;decimal?&gt; Month1 { get; set;}
</code></pre>

<p>but this is impossible because each object may have different Cryptographer (symmetric key).</p>

<p>Is there a way to refactor it to avoid such repeatable code?<br>
Should I care about such repetition ?</p>
","<c#><refactoring>","1","150","2009-11-08 14:42:33"
"1702883","How to unify/simplify this code - event handling/delegating?","<p>I have Process objects that are monitored from two different views.  A Windows.Forms.ListView (actually a derived class) and a Graph Viewer (based on Microsoft Research's Automatic Graphing Layout).  Each has a context menu which can have similar  events activated.  While the list view can have multiple selections, I don't allow it on the graph view.</p>

<p>This is what I currently have:</p>

<pre><code>    private void ctxgrphAddBreakpoint_Click(object sender, EventArgs e)
    {
        Process p = GetProcess(viewer);
        if (p != null)
        {
            p.AddBreakpoint();
            BeginRefresh(false, false);
        }
    }

    private void ctxgrphRemoveBreakpoint_Click(object sender, EventArgs e)
    {
        Process p = GetProcess(viewer);
        if (p != null)
        {
            p.RemoveBreakpoint();
            BeginRefresh(false, false);
        }
    }

    private void ctxlistAddBreakpoint_Click(object sender, EventArgs e)
    {
        foreach (Process p in lvwProcessList.SelectedProcesses())
        {
            p.AddBreakpoint();
        }
        BeginRefresh(false, false);
    }

    private void ctxlistRemoveBreakpoint_Click(object sender, EventArgs e)
    {
        foreach (Process p in lvwProcessList.SelectedProcesses())
        {
            p.RemoveBreakpoint();
        }
        BeginRefresh(false, false);
    }
</code></pre>

<p>I'd like to unify the two context menus into one and the event handling into one like this:</p>

<pre><code>    private void ctxlistAction_Click(object sender, EventArgs e)
    {
        // I can unify the Viewer and ListView and implement some common interface,
        // so I'm pretty sure I can handle this part
        foreach (Process p in UIView.SelectedProcesses())
        {
            p.Action(); // What is the best way to handle this?
        }
        BeginRefresh(false, false);
    }
</code></pre>

<p>How do I get there?</p>
","<c#><.net><design><refactoring><delegates>","0","195","2009-11-09 18:35:15"
"1706684","How to refactor this code?","<p>Please suggest in refactoring this code.
Avoid code duplication, mutiple If's</p>

<pre><code>public FormDataDTO getDataForFieldFormCHrzntalField(Field field) {
    	FormDataDTO formDataDTO = new FormDataDTO();
    	CHrzntalField cHrzntalField = (CHrzntalField) field;
    	for (int j = 0; j &lt; cHrzntalField.getFieldCount(); j++) {
    		Field sField = cHrzntalField.getField(j);
    		if (sField instanceof LabelField) {
    			LabelField labelField = sField;
    			String fieldName = labelField.getText();
    			System.out.println(""The Label field name is "" + fieldName);
    			formDataDTO.setFieldName(fieldName);
    		} else if (sField instanceof CTextFieldBorder) {
    			CTextFieldBorder cTextFieldBorder = (CTextFieldBorder) sField;
    			Field ssField = cTextFieldBorder.getField(0);
    			if (ssField instanceof TextField) {
    				TextField textField = ssField;
    				System.out.println(""Inside TextField---- ""
    						+ textField.getText());
    				formDataDTO.setFieldType(""TextField"");
    				formDataDTO.setSelectedValue(textField.getText());
    			} else if (ssField instanceof DateField) {
    				DateField dateField = ssField;
    				String dateString = dateField.toString();
    				System.out.println(""dateString "" + dateString);
    				formDataDTO.setFieldType(""Date"");
    				formDataDTO.setSelectedValue(dateString);
    			}
    		} else if (sField instanceof CChoiceField) {
    			CChoiceField cChoiceField = (CChoiceField) sField;
    			int i = cChoiceField.getSelectedIndex();
    			String selectedValue = cChoiceField.getChoice(i);
    			System.out.println(""Choice "" + selectedValue);
    			formDataDTO.setFieldType(""Combo"");
    			formDataDTO.setSelectedValue(selectedValue);
    		} else if (sField instanceof CheckboxField) {
    			CheckboxField checkboxField = (CheckboxField) sField;
    			boolean checkStatus = checkboxField.getChecked();
    			System.out.println(""Check box field "" + checkStatus);
    			formDataDTO.setFieldType(""Checkbox"");
    			String status = new Boolean(checkStatus).toString();
    			formDataDTO.setSelectedValue(status);
    		}
    	}
    	return formDataDTO;
    }
</code></pre>
","<java><refactoring><dry><multiple-ifs>","0","297","2009-11-10 09:37:45"
"1712541","Eclipse rename not working completely","<p>Ok I'm completely googled-out.</p>

<p>I have a few java projects in my eclipse workspace (about 25).  &nbsp; Most projects use linked source folders.</p>

<p>When I rename a class in Project1, the references to that class in the other projects are not updated.  The references within the project are updated just fine. &nbsp; The net result is compilation errors on the next automatic recompile.</p>

<p>I'm using Eclipse 3.5.1, but the same behavior was shown by 3.4.0 and 3.4.2</p>

<p>Any ideas about how to fix this?</p>

<p>My current plan - after googling for 20 minutes - is to write a script to convert the linked source folders to be OS links (I'm on linux) in the project folders themselves. &nbsp; So then I'm no longer using linked source folders.</p>
","<java><eclipse><refactoring><eclipse-3.4><eclipse-3.5>","1","1955","2009-11-11 02:06:38"
"1713568","Tools for C code refactoring","<p>What tools are there that supports refactoring C code (renaming variables, extracting methods, finding method references, ...)</p>

<p>Preferably for a Linux environment, but Windows tools are ok too.
If there's something available for emacs, even better!</p>
","<c><linux><emacs><refactoring>","6","1765","2009-11-11 07:17:04"
"1715714","Is there a better way? While loops and continues","<p>There are many functions within the code I am maintaining which have what could be described as boilerplate heavy.  Here is the boilerplate pattern which is repeated ad nausea throughout the application when handling DB I/O with a cursor:</p>

<pre><code>if( !RowValue( row, m_InferredTable-&gt;YearColumn(), m_InferredTable-&gt;YearName(), m_InferredTable-&gt;TableName(), value )
		|| !IsValidValue( value ) )
	{
		GetNextRow( cursor, m_InferredTable );

		continue;
	}
	else
	{
		value.ChangeType(VT_INT);
		element.SetYear( value.intVal );
	}
</code></pre>

<p>The thing is not all of these statements like this deal with ints, this ""element"" object, the ""year"" column, etc.  I've been asked to look at condensing it even further than it already is and I can't think of a way to do it.  I keep tripping over the continue statement and the accessors of the various classes.</p>

<p>Edit:  Thanks to all those that commented. This is why I love this site.  Here is an expanded view:</p>

<pre><code>while( row != NULL )
{
	Element element;
	value.ClearToZero();
	if( !GetRowValue( row, m_InferredTable-&gt;DayColumn(), m_InferredTable-&gt;DayName(), m_InferredTable-&gt;TableName(), value )
		|| !IsValidValue( value ) )
	{
		GetNextRow( cursor, m_InferredTable );

		continue;
	}
	else
	{
		value.ChangeType(VT_INT);
		element.SetDay( value.intVal );
	}
</code></pre>

<p>And things continue onward like this.  Not all values taken from a ""row"" are ints.  The last clause in the while loop is ""GetNextRow.""</p>
","<c++><refactoring><loops>","2","310","2009-11-11 14:58:55"
"1724101","Migrate (monolithic) Classic ASP to ASP.Net","<p>For many years I have had an objective of moving out of ASP/VBScript to a ""better"" language - my preference would be C# as I have skills in C - but I would consider other languages too (including PHP etc. so not just DotNet)</p>

<p>Objective is to have the code base in a language which does more for us. I hate the lack of data typing in VBScript, I would like a number of different ""container objects"" - rather than just a Dictionary Object, and so on - in fact I wonder why, having moved from Basic to C in the 80's, and then C++ a while after that, I managed to move ""back"" to Basic in to 00's.</p>

<p>(I could program the container objects in VBScript, but my instinct is that they would be slow in operation; we have a significant cache of ""snippets"" of HTML used in the rendering of the page, the ASP Application Object is a pretty blunt instrument!)</p>

<p>My ASP/VBScript is a single large application that is basically an ""engine"" to deliver web content.</p>

<p>It has been many years in the making, and now the ASP code changes seldom. (So I do need to justify moving it at all, or just living with VBScript ""for ever"")</p>

<p>It is driven from data in an MS SQL database.</p>

<p>There is only one .ASP page (made up of several include files).</p>

<p>Based on the query string parameters Skin and CMS templates for the page are loaded from database and suitable database Sprocs are run to acquire data which is merged into the CMS templates.</p>

<p>Data about the page (methods to use, etc.) is also retrieved from the database, along with details of access permissions and so on.</p>

<p>From what I have read some these things may make migration easier:</p>

<p>ASP sessions are not used - a session cookie is used to retrieve session data from the DB (so I could easily share a session half-and-half with ASPX</p>

<p>The VBScript uses OPTION EXPLICIT throughout, so all variables are predefined.</p>

<p>All output is via Response.Write (in fact most content is merged into a single variable and then output).  There is no mix of HTML and &lt;% server code %&gt;.</p>

<p>I have some VBScript classes, but not many.</p>

<p>I have lots of VBScript functions, and a few Subroutines.</p>

<p>I have a test suite.  This catches screen shots from the browser and graphically compares them with master images - thus I have the ability to do a regression test.</p>

<p>I don't have the resource to do a complete rewrite; maintenance of the existing code needs to continue during migration; but having said that 99% of our work is in CMS or SQL Sprocs, so the changes to ASP code are infrequent.</p>

<p>I have read of MS's utility to migrate ASP code to VB.NET. Given that my code is 100% VBScript and no mix of HTML/Script I would appreciate opinions on whether this would help me a lot or a little?</p>

<p>I would be happy to refactor STAYING IN VBscript with a view to making the migration to DotNet easier later on (but I'd need to know what my objectives were in doing that :) ).  I could, for example, move some/all the functions to a COM object, and could probably do that piecemeal?</p>

<p>Thanks for your help</p>
","<asp.net><asp-classic><vbscript><refactoring><migration>","3","522","2009-11-12 17:49:17"
"1726277","Refactoring val to method results in compile-time error","<p>I currently have </p>

<pre><code>  def list(node: NodeSeq): NodeSeq = {
    val all = Thing.findAll.flatMap({
      thing =&gt; bind(""thing"", chooseTemplate(""thing"", ""entry"", node),
        ""desc"" -&gt; Text(thing.desc.is),
        ""creator"" -&gt; thing.creatorName.getOrElse(""UNKNOWN""),
        ""delete"" -&gt; SHtml.link(""/test"", () =&gt; delete(thing), Text(""delete""))
        )
    })

    all match {
      case Nil =&gt; &lt;span&gt;No things&lt;/span&gt;
      case _ =&gt; &lt;ol&gt;{bind(""thing"", node, ""entry"" -&gt; all)}&lt;/ol&gt;
    }
  }
</code></pre>

<p>and I tried to refactor it to </p>

<pre><code>  def listItemHelper(node: NodeSeq): List[NodeSeq] = {
    Thing.findAll.flatMap({
      thing =&gt; bind(""thing"", chooseTemplate(""thing"", ""entry"", node),
        ""desc"" -&gt; Text(thing.desc.is),
        ""creator"" -&gt; thing.creatorName.getOrElse(""UNKNOWN""),
        ""delete"" -&gt; SHtml.link(""/test"", () =&gt; delete(thing), Text(""delete""))
        )
    })
  }

  def list(node: NodeSeq): NodeSeq = {
    val all = listItemHelper(node)

    all match {
      case Nil =&gt; &lt;span&gt;No things&lt;/span&gt;
      case all: List[NodeSeq] =&gt; &lt;ol&gt;{bind(""thing"", node, ""entry"" -&gt; all)}&lt;/ol&gt;
      case _ =&gt; &lt;span&gt;wtf&lt;/span&gt;
    }
  }
</code></pre>

<p>but I get the following. I've traced all the return types and I don't see how my refactoring is any different than what would be happening internally. I even tried adding more match cases (as you can see in the refactored code) to make sure I was selecting the right type.</p>

<pre><code>/Users/trenton/projects/sc2/supperclub/src/main/scala/com/runbam/snippet/Whyme.scala:37: error: overloaded method value -&gt; with alternatives [T &lt;: net.liftweb.util.Bindable](T with net.liftweb.util.Bindable)net.liftweb.util.Helpers.TheBindableBindParam[T] &lt;and&gt; (Boolean)net.liftweb.util.Helpers.BooleanBindParam &lt;and&gt; (Long)net.liftweb.util.Helpers.LongBindParam &lt;and&gt; (Int)net.liftweb.util.Helpers.IntBindParam &lt;and&gt; (Symbol)net.liftweb.util.Helpers.SymbolBindParam &lt;and&gt; (Option[scala.xml.NodeSeq])net.liftweb.util.Helpers.OptionBindParam &lt;and&gt; (net.liftweb.util.Box[scala.xml.NodeSeq])net.liftweb.util.Helpers.BoxBindParam &lt;and&gt; ((scala.xml.NodeSeq) =&gt; scala.xml.NodeSeq)net.liftweb.util.Helpers.FuncBindParam &lt;and&gt; (Seq[scala.xml.Node])net.liftweb.util.Helpers.TheBindParam &lt;and&gt; (scala.xml.Node)net.liftweb.util.Helpers.TheBindParam &lt;and&gt; (scala.xml.Text)net.liftweb.util.Helpers.TheBindParam &lt;and&gt; (scala.xml.NodeSeq)net.liftweb.util.Helpers.TheBindParam &lt;and&gt; (String)net.liftweb.util.Helpers.TheStrBindParam cannot be applied to (List[scala.xml.NodeSeq])
      case all: List[NodeSeq] =&gt; &lt;ol&gt;{bind(""thing"", node, ""entry"" -&gt; all)}&lt;/ol&gt;
                                                                  ^
</code></pre>
","<scala><refactoring><lift>","0","419","2009-11-13 00:02:15"
"1727307","""refactor refactor refactor your code."" What does this mean exactly and why do it?","<p>I often heard from professionals blog something like refactoring your code whenever the chance you get. What is it exactly? Rewriting your code in simpler and fewer lines? What is the purpose of doing this?</p>
","<refactoring>","3","475","2009-11-13 05:32:11"
"1733127","Refactor packages in a Jar","<p>I have a requirement that i need to load two versions of a jar at once. To avoid class path collisions I'd like to rename the packages of one of the jars.  Then in source you could always easily determine the version by the package name. </p>

<p>I've played with <code>javap</code> but couldn't find an assembler for Java 1.6.  I've also attempted to decompile the code with <a href=""http://java.decompiler.free.fr"" rel=""nofollow"">JD</a> but it never quite got it right and it wouldn't compile.  </p>
","<java><refactoring><jar><decompiling>","1","125","2009-11-14 03:27:31"
"1735717","Help refactoring this nasty Ruby if/else statement","<p>So I have this big, hairy if/else statement. I pass a tracking number to it, and then it determines what type of tracking number it is.</p>

<p>How can I simplify this thing? Specifically wanting to reduce the number of lines of codes.</p>

<pre><code>if num_length &lt; 8
  tracking_service = false
else
  if number[1, 1] == 'Z'
    tracking_service = 'ups'
  elsif number[0, 1] == 'Q'
    tracking_service = 'dhl'
  elsif number[0, 2] == '96' &amp;&amp; num_length == 22
    tracking_service = 'fedex'
  elsif number[0, 1] == 'H' &amp;&amp; num_length == 11
    tracking_service = 'ups'
  elsif number[0, 1] == 'K' &amp;&amp; num_length == 11
    tracking_service = 'ups'
  elsif num_length == 18 || num_length == 20
    check_response(number)
  else
    case num_length
    when 17
      tracking_service = 'dhlgm'
    when 13,20,22,30
      tracking_service = 'usps'
    when 12,15,19
      tracking_service = 'fedex'
    when 10,11
      tracking_service = 'dhl'
    else
      tracking_service = false  
    end  
  end
end
</code></pre>

<p>Yes, I know. It's nasty.</p>
","<ruby-on-rails><ruby><refactoring>","5","834","2009-11-14 21:47:06"
"1739666","Writing refactoring-friendly PHP code","<p>As far as I know, and have gathered from other SO posts, there are no proper tools for refactoring PHP code yet, so when it comes to refactoring, it's probably good old search-and-replace for most of us, with a good amount of praying that we didn't overlook something. </p>

<p>I would like to know whether there are any coding recommendations on how to write code friendly for manual refactoring. Never to construct variable names from strings, would be one thing that comes to mind because a construct like that is impossible to grep:</p>

<pre><code>$object-&gt;{""field_"".$fieldname}
</code></pre>

<p>I could imagine there are several such do's and don'ts. Maybe somebody knows good resources / articles on the issue. It wouldn't have to be PHP specific, either. </p>
","<php><php5><refactoring>","5","272","2009-11-16 02:02:12"
"1742030","How do I do distributed UML development (à la FOSS)?","<p>I have a UML project (built in IBM's Rational System Architect/Modeler, so stored in their XML format) that has grown quite large. Additionally, it now contains several pieces that other groups would like to re-use. I come from a software development (especially FOSS) background, and am trying to understand how to use that as an analogy here.  The problem I am grappling with is similar to the <a href=""http://en.wikipedia.org/wiki/Fragile%5Fbase%5Fclass"" rel=""nofollow"">Fragile Base Class</a> problem.</p>

<p>Let me start with how it works in an object-oriented (say, Java or Ruby) FOSS ecosystem:</p>

<ol>
<li>Group 1 publishes some ""core"" package, say ""<code>net/smtp</code> version 1.0""</li>
<li>Group 2 includes Group 1's <code>net/smtp</code> 1.0 package in the vendor library of their software project</li>
<li>At some point, Group 1 creates a new 2.0 branch of <code>net/smtp</code> that breaks backwards compatibility (say, it removes an old class or method, or moves a class from one package to another). They tell users of the 1.0 version that it will be deprecated in one year.</li>
<li>Group 2, when they have the time, updates to <code>net/smtp</code> 2.0. When they drop in the new package, their compiler (or test suite, for Ruby) tells them about the incompatibility. They do have to make some manual changes, but all of the changes are in the code, in plain text, a medium with which they are quite familiar. Plus, they can often use their IDE's (or text editor's) ""global-search-and-replace"" function once they figure out what the fixes are.</li>
</ol>

<p>When we try to apply this model to UML in RSA, we run into some problems. RSA supports some fairly powerful refactorings, but they seem to only work if you have write access to <em>all</em> of the pieces. If I rename a class in one package, RSA can rename the references, but only at the same time. It's very difficult to look at the underlying source (the XML) and figure out what's broken. To fix such a problem in the RSA editor itself means tons of clicking on things -- there is no good equivalent of ""global-search-and-replace,"" at least not after an incomplete refactor.</p>

<p>They real sticking point seems to be that RSA assumes that you want to do all your editing using their GUI, but that makes certain operations prohibitively difficult.</p>

<p>Does anyone have examples of open-source UML projects that have overcome this problem? What strategies do they use for communicating changes?</p>
","<refactoring><uml><rational>","0","103","2009-11-16 12:54:01"
"1745511","Refactoring some of my code","<p>I have a SalesOrder class which is inherited by several different types of sales orders. It has a method called ValidateItems(OrderItemList, itemAdditionalValidation), which takes in a list of order items and a delegate for additional validation on an order item.  The different sales orders each define their own version of the delegate and then pass it in when they call ValidateItems of the parent SalesOrder class. The delegate takes in an OrderItem object. OrderItem class has a Validate() method.  The ValidateItems method goes through the list and calls Validate on each OrderItem and then calls itemAdditionalValidation delegate and passes it in the OrderItem.</p>

<p>So far, when I wanted to validate items, I would always create add all the items to the respective order and then the order would call ValidateItems and take care of all the validation.  However, now I want to be able to call OrderItem.Validate directly without creating an order as well, however I don't know how to refactor the delegate.  Basically I want the OrderItem to be able to know which delegates to call based on the Order type it's dealing with.  Any ideas?  Also any tips on how to improve on my current architecture would be greatly appreciated.</p>
","<oop><refactoring>","1","94","2009-11-16 23:19:00"
"1749477","Are empty abstract classes a bad practice, and why?","<p>We have several empty abstract class in our codebase. I find that ugly. But besides this very stupid reason (ugliness), should I refactor it (into empty interface e.g.) ?</p>

<p>Otherwise, the code is robust and well tested. So if it's only for a ""aesthetic"" reason, I will pass and let the empty abstract classes remain.</p>

<p>What do you think?</p>

<p>EDIT : </p>

<p>1) By ""empty abstract class"", I mean something like : </p>

<pre><code>public abstract class EmptyAbstractClass {}
</code></pre>

<p>2) The reason for the ""emptiness"" : Hibernate. I don't master this persistence framework at all. I just understand that an interface cannot be mapped to a table, and for this technical reason, a class has been preferred to an interface.</p>
","<java><refactoring><abstract-class>","4","1296","2009-11-17 15:04:59"
"1749824","Recoding a Podcast Website - What should I use?","<p>OK here is the deal. Me and some buddies are doing a Podcast(for over 4 year now) and in April we relaunched the site, that included a new Backend. Since I only had 2 weeks back then for getting everything to work, I decided to create something from scratch so everything fitted precisely our needs. The whole thing was written in Python based on mod_python.</p>

<p>At the moment I don't have much to do so I thought about refactoring the code(since code you write in 2 weeks isn't the cleanest one as you can imagine), I came to the idea that I could base it on a CMS.</p>

<p>It did take me some minutes to write up the model for the whole thing but here it is:</p>

<h1>All</h1>

<ul>
<li>Create by</li>
<li>Create at</li>
<li>Edited by</li>
<li>Edited at</li>
</ul>

<h1>Users</h1>

<ul>
<li>Usermame</li>
<li>Password</li>
<li>Realname</li>
<li>Administrator(True/False)</li>
<li>Moderator(True/False)</li>
<li>Profile visible(True/False)</li>
<li>Profile picture</li>
<li>Profile text</li>
</ul>

<h1>Tags(belongs_to_many :posts)</h1>

<ul>
<li>Name</li>
</ul>

<h1>Posts(has_many :files, :comments, :tags)</h1>

<ul>
<li>Title</li>
<li>Feed Title</li>
<li>EpisodeNumber</li>
<li>Type(Podcast/News)</li>
<li>Date</li>
<li>Image</li>
<li>Comments(Open/Closed/Hidden)</li>
<li>State(Public/Auto/Hidden)</li>
<li>Text</li>
<li>Files</li>
<li>Tags</li>
</ul>

<h1>Files(belongs_to_many :posts)</h1>

<ul>
<li>File</li>
<li>Size</li>
<li>Duration(This needs libraries for determening the length of mp3/mp4/m4v files)</li>
</ul>

<h1>Comments(belongs_to :posts)</h1>

<ul>
<li>Post</li>
<li>User(If posted by a podcaster, so we can highlight the comment etc.)</li>
<li>Date</li>
<li>Hidden(True/False)</li>
<li>Name</li>
<li>Email</li>
<li>IP</li>
<li>Text  </li>
</ul>

<h1>Pages</h1>

<ul>
<li>Title</li>
<li>Text</li>
</ul>

<p>OK the stuff above is pretty simple, only the getting the duration of the mp3s etc. could be somehow troublesome.</p>

<p>Now comes the bigest problem, our download tracking.</p>

<p>This needs custom tables named Year_Month with the following format:<br>
- rows with: fileID all, itunes, feed, other etc.</p>

<p>On every download we create new tables and rows as necessary.
The part of getting the information back out and converting it into charts is quite complex.</p>

<h1>Choosing...</h1>

<p>So I took a look at Drupal, Django and Ruby on Rails.
Drupal is PHP... well I have no problem with PHP the main question here is how to implement duration check for mp3s.  </p>

<p>Django is Python since I wrote the current site in python too, many questions fall away.</p>

<p>Ruby on Rails seems pretty good for kickstart development (I love the Railscasts), unfortunately, trying to develop a Demo with Aptana RadRails failed epically to a 200 line stack trace. Since I didn't do anything with Ruby before I stopped there.</p>

<p>I hope that some of you people can help me with the choice here, since you may already have experience with Drupal/Django/Ruby on Rails that I don't have, and I really hate it to having start over after being half way though a project, only because there is some little thing that can't be implemented with technology XYZ.</p>
","<ruby-on-rails><django><drupal><refactoring><website>","2","151","2009-11-17 15:53:54"
"1750990","Java Null Conditional","<p>I have the following pattern appearing many times in my Java code and was wondering how some of you might refactor it.</p>

<pre><code>Object obj1 = buildObj1();
if (obj1 != null) {
    return obj1;
}

Object obj2 = buildObj2();
if (obj2 != null) {
    return obj2;
}

Object obj3 = buildObj3();
if (obj3 != null) {
    return obj3;
}
</code></pre>
","<java><refactoring>","2","234","2009-11-17 18:56:46"
"1755254","Error in Preview of Custom Eclipse refactoring","<p>I am implementing an new eclipse refactoring.  This will enable developers to Pull-up the preconditions statements from a child method to the parent method.  </p>

<p>This all works perfectly when I select ""Finish"" in the refactoring wizard, but when I select ""Preview"" I get an error ""No target edit provided.""  This seems to be caused by a problem in the <code>TextEdit</code> returned from <code>ASTRewrite.rewriteAST()</code>.  However I cannot figure out why.</p>

<p>The stack trace of the exception happens after my <code>Refactoring.createChange()</code> code is run, and the change is used to generate the preview.</p>

<pre><code>org.eclipse.text.edits.MalformedTreeException: No target edit provided.
at org.eclipse.text.edits.MoveSourceEdit.performConsistencyCheck(MoveSourceEdit.java:208)
at org.eclipse.text.edits.TextEdit.traverseConsistencyCheck(TextEdit.java:873)
at org.eclipse.text.edits.MoveSourceEdit.traverseConsistencyCheck(MoveSourceEdit.java:183)
at org.eclipse.text.edits.TextEdit.traverseConsistencyCheck(TextEdit.java:869)
at org.eclipse.text.edits.TextEdit.traverseConsistencyCheck(TextEdit.java:869)
at org.eclipse.text.edits.TextEditProcessor.checkIntegrityDo(TextEditProcessor.java:176)
at org.eclipse.text.edits.TextEdit.dispatchCheckIntegrity(TextEdit.java:743)
at org.eclipse.text.edits.TextEditProcessor.performEdits(TextEditProcessor.java:151)
at org.eclipse.ltk.core.refactoring.TextChange.getPreviewDocument(TextChange.java:534)
at org.eclipse.ltk.core.refactoring.TextChange.getPreviewDocument(TextChange.java:403)
at org.eclipse.ltk.core.refactoring.TextChange.getPreviewContent(TextChange.java:411)
at org.eclipse.ltk.internal.ui.refactoring.TextEditChangePreviewViewer.setInput(TextEditChangePreviewViewer.java:209)
at org.eclipse.ltk.internal.ui.refactoring.AbstractChangeNode.feedInput(AbstractChangeNode.java:99)
at org.eclipse.ltk.internal.ui.refactoring.PreviewWizardPage.showPreview(PreviewWizardPage.java:598)
at org.eclipse.ltk.internal.ui.refactoring.PreviewWizardPage.access$6(PreviewWizardPage.java:583)
at org.eclipse.ltk.internal.ui.refactoring.PreviewWizardPage$7.selectionChanged(PreviewWizardPage.java:574)
at org.eclipse.jface.viewers.Viewer$2.run(Viewer.java:162)
at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)
at org.eclipse.core.runtime.Platform.run(Platform.java:888)
at org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:48)
at org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:175)
at org.eclipse.jface.viewers.Viewer.fireSelectionChanged(Viewer.java:160)
at org.eclipse.jface.viewers.StructuredViewer.updateSelection(StructuredViewer.java:2132)
at org.eclipse.jface.viewers.StructuredViewer.setSelection(StructuredViewer.java:1669)
at org.eclipse.jface.viewers.TreeViewer.setSelection(TreeViewer.java:1124)
at org.eclipse.jface.viewers.Viewer.setSelection(Viewer.java:392)
at org.eclipse.ltk.internal.ui.refactoring.PreviewWizardPage.setVisible(PreviewWizardPage.java:505)
at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.makeVisible(RefactoringWizardDialog2.java:762)
at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.showCurrentPage(RefactoringWizardDialog2.java:477)
at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.nextOrPreviewPressed(RefactoringWizardDialog2.java:507)
at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.access$2(RefactoringWizardDialog2.java:492)
at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2$1.widgetSelected(RefactoringWizardDialog2.java:691)
at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:228)
at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1003)
at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3880)
at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3473)
at org.eclipse.jface.window.Window.runEventLoop(Window.java:825)
at org.eclipse.jface.window.Window.open(Window.java:801)
at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation$1.run(RefactoringWizardOpenOperation.java:143)
at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:70)
at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation.run(RefactoringWizardOpenOperation.java:155)
at org.jmlspecs.eclipse.refactor.action.AbstractMethodActionDelegate.run(AbstractMethodActionDelegate.java:78)
at org.jmlspecs.eclipse.refactor.action.AbstractMethodActionDelegate.run(AbstractMethodActionDelegate.java:67)
at org.eclipse.ui.internal.PluginAction.runWithEvent(PluginAction.java:251)
at org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:584)
at org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:501)
at org.eclipse.jface.action.ActionContributionItem$6.handleEvent(ActionContributionItem.java:452)
at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1003)
at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3880)
at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3473)
at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2405)
at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2369)
at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2221)
at org.eclipse.ui.internal.Workbench$5.run(Workbench.java:500)
at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:493)
at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)
at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:113)
at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:194)
at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:368)
at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:179)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
at java.lang.reflect.Method.invoke(Unknown Source)
at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:559)
at org.eclipse.equinox.launcher.Main.basicRun(Main.java:514)
at org.eclipse.equinox.launcher.Main.run(Main.java:1311)
at org.eclipse.equinox.launcher.Main.main(Main.java:1287)
</code></pre>

<p>Currently the code that performs the change looks like this:</p>

<pre><code>CompilationUnit sourceNode = ...
ASTRewrite sourceRewrite = ASTRewrite.create(sourceNode.getAST());

Statement statement = ...
sourceRewrite.createMoveTarget(statement);

CompilationUnit destinationNode = ...
MethodDeclaration destinationMethod = ...
ASTRewrite destinationRewrite = ASTRewrite.create(destinationNode.getAST());

ListRewrite lrw = destinationRewrite.getListRewrite(destinationMethod.getBody(),
    Block.STATEMENTS_PROPERTY);

lrw.insertFirst(statement, null);
</code></pre>

<p>I know that the way <code>createMoveTarget</code> is used is not how it is documented, but when I follow the documentation like below, the statement is deleted from the source but not moved to the destination and I still get the same error in the preview.</p>

<pre><code>CompilationUnit sourceNode = ...
ASTRewrite sourceRewrite = ASTRewrite.create(sourceNode.getAST());

Statement statement = ...
Statement replacement = sourceRewrite.createMoveTarget(statement);
sourceRewrite.remove(statement, null);

CompilationUnit destinationNode = ...
MethodDeclaration destinationMethod = ...
ASTRewrite destinationRewrite = ASTRewrite.create(destinationNode.getAST());

ListRewrite lrw = destinationRewrite.getListRewrite(destinationMethod.getBody(),
    Block.STATEMENTS_PROPERTY);

lrw.insertFirst(replacement, null);
</code></pre>

<p>Here is an example of the Refactoring being performed.</p>

<p>Before:</p>

<pre><code>class A {
    foo(int a) {
        return a * 2;
    }
}

class B {
    foo(int a) {
        JC.requires(a &gt; 1);

        return a * 3;
    }
}
</code></pre>

<p>After:</p>

<pre><code>class A {
    foo(int a) {
        JC.requires(a &gt; 1);

        return a * 2;
    }
}

class B extends A {
    foo(int a) {        
        return a * 3;
    }
}
</code></pre>
","<java><eclipse><refactoring><eclipse-plugin-dev>","51","1848","2009-11-18 11:03:04"
"1755606","Does form processing code need to be abstracted? (Zend_Form)","<p>In Zend Frameworks tutorials, I can see form processing code like</p>

<pre><code>if ($request-&gt;isPost()) {
            $formData = $request-&gt;getPost();

            $code = $request-&gt;getParam(""code"");
        	$url = $request-&gt;getParam(""url"");

            if ($form-&gt;isValid($formData)) {
            // here goes code to determine insert/update action, 
            //retrive record data
            //and perform relative database operation
</code></pre>

<p>This code repeats for many forms. I am trying to make form handling better, yet not to over-engineer it. So far I have moved this code from Controllers into Form object.
But the code still diplicates for different form types. </p>

<p>My question is this - Should I prefer to keep form handling code duplicate or write some ProcessSubmit() Zend_Form method that will be used by all subclasses?
I had experience that abstraction is not always good and sometimes you end up synching two classes that shoul've been different from beginning.</p>

<p>ZF examples demonstrate duplicate code, so I wonder if this duplicity is justifed (at least for small 3-4 form sites) or needs to be avoided by all means.</p>

<p>P.S. This task seems to be pretty common, I wonder if I do double work and there is already a ZF class for CRUD specific form handling.</p>
","<php><zend-framework><refactoring>","4","142","2009-11-18 12:19:42"
"1760838","How to avoid debugger-only variables?","<p>I commonly place into variables values that are only used once after assignment.  I do this to make debugging more convenient later, as I'm able to hover the value on the one line where it's later used.</p>

<p>For example, this code doesn't let you hover the value of GetFoo():</p>

<pre><code>return GetFoo();
</code></pre>

<p>But this code does:</p>

<pre><code>var foo = GetFoo();
return foo; // your hover-foo is great
</code></pre>

<p>This smells very <a href=""http://en.wikipedia.org/wiki/You%5Fain%27t%5Fgonna%5Fneed%5Fit"" rel=""nofollow"">YAGNI</a><em>-esque</em>, as the <em>functionality</em> of the <strong>foo</strong>'s assignment won't ever be used until someone needs to debug its value, which may <em>never happen</em>.  If it weren't for the <em>merely foreseen</em> debugging session, the first code snippet above keeps the code simpler.</p>

<p>How would you write the code to best compromise between simplicity and ease of debugger use?</p>
","<debugging><refactoring><yagni>","2","93","2009-11-19 04:16:50"
"1767218","How would you refactor this bit of code?","<p>This bit of code runs on Windows Compact Framework and what it does is obvious. It looks as it should be refactored (especially considering that I may want to add cmd.ExecuteResultSet() later), but I can't see an elegant way to do it. Any ideas appreciated.</p>

<pre><code>    internal void RunNonQuery(string query)
    {
        string connString = GetLocalConnectionString();

        using (SqlCeConnection cn = new SqlCeConnection(connString))
        {
            cn.Open();
            SqlCeCommand cmd = cn.CreateCommand();
            cmd.CommandText = query;
            cmd.ExecuteNonQuery();
        }
    }  




    internal int RunScalar(string query)  
    {
        string connString = GetLocalConnectionString();

        using (SqlCeConnection cn = new SqlCeConnection(connString))
        {
            cn.Open();
            SqlCeCommand cmd = cn.CreateCommand();
            cmd.CommandText = query;
            return int.Parse(cmd.ExecuteScalar().ToString());
        }
    }
</code></pre>
","<c#><compact-framework><refactoring>","2","288","2009-11-19 23:07:56"
"1769749","Using Exceptions exceptionally","<p>This is a refactoring question.</p>

<pre><code>try
{
  string line = GetFirstLineFromFile(); //Gets first line from a text file, this line would be a number.
  int value = ConvertToInteger(line); // Gets the integer value from the string.
  int result = DivideByValue(value); // Divides some number with the value retrieved.
}
catch(Exception ex)
{
}
</code></pre>

<p>My main concern is, what is the best approach for exception handling in such situations. Certainly wrapping the whole thing in a single try catch is like saying I expect an exception about everything. There must be some place we catch a generic exception right?</p>
","<exception-handling><refactoring>","2","104","2009-11-20 11:00:45"
"1770808","Refactoring function pointers to some form of templating","<p>Bear with me as I dump the following simplified code: (I will describe the problem below.)</p>

<pre><code>class CMyClass
{
    ...
private:
 HRESULT ReadAlpha(PROPVARIANT* pPropVariant, SomeLib::Base *b);
 HRESULT ReadBeta(PROPVARIANT* pPropVariant, SomeLib::Base *b);

 typedef HRESULT (CMyClass::*ReadSignature)(PROPVARIANT* pPropVariant, SomeLib::Base *b);

 HRESULT TryFormats(ReadSignature ReadFormat, PROPVARIANT* pPropVariant);
};


inline HRESULT CMyClass::ReadAlpha(PROPVARIANT* pPropVariant, SomeLib::Base *b)
{
 if (b)
 {
     // got a valid Base. Handle generic stuff here.
     SetStuff(pPropVariant, b-&gt;someInt);
     return S_OK;
 }

 return (b != NULL) ? 0 : -1;
}

inline HRESULT CMyClass::ReadBeta(PROPVARIANT* pPropVariant, SomeLib::Base *b)
{
 if (b)
 {
  SomeLib::FormatA *fa;
  SomeLib::FormatB *fb;

  if ( fa = dynamic_cast&lt;SomeLib::FormatA*&gt;( b ) )
  {
   // specific code for FormatA
   SetStuff(pPropVariant, fa-&gt;getVersion());
   return S_OK;
  }
  else if ( fb = dynamic_cast&lt;SomeLib::FormatB*&gt;( b ) )
  {
   // specific code for FormatB
   SetStuff(pPropVariant, fb-&gt;valueForB);
   return S_OK;
  }
 }

 return (b != NULL) ? 0 : -1;
}

inline HRESULT CMyClass::TryFormats(ReadSignature ReadFormat, PROPVARIANT* pPropVariant)
{
 HRESULT hr;
 if (FAILED(hr = (this-&gt;*ReadFormat)(pPropVariant, _pFile-&gt;formatA())))
  if (FAILED(hr = (this-&gt;*ReadFormat)(pPropVariant, _pFile-&gt;formatC())))
   hr = (this-&gt;*ReadFormat)(pPropVariant, _pFile-&gt;formatD());

 return hr;
}
</code></pre>

<p>I end up calling this code like:</p>

<pre><code>hr = TryFormats(&amp;CMyClass::ReadAlpha, pPropVar);
</code></pre>

<p>Now... the problem is that this is too generic and constrained, especially now that I am trying to refactor this code for use in some other projects. So, this means that I want to place the <code>ReadXxx</code> code in another source file and abuse templating somehow. The <code>TryFormats</code> remains in the class since different classes have different formats they attempt to read.</p>

<p>My current approach is bound to fail due to the <code>dynamic_cast&lt;Derived*&gt;</code> needed for functionality that is not in the <code>Base</code> class, and since I may need to read up to 5 different formats in one class, I really don't want to drag in formats I do not need in the first place. (For example, see above how <code>CMyClass</code> does not support <code>SomeLib::FormatB</code>, yet the <code>ReadBeta()</code> needs to support it and thus forces the compiler to compile all the relevant information in.) In total, I have around 10 different formats I 'support' like this.</p>

<p>How can I properly refactor this code? I don't want to need to rewrite <code>Base</code> functionality for every descendant, nor do I want to put derived specific information into a function that simply takes a <code>Base</code>.</p>

<p>I have tried some things, but all I manage to squeeze out of my compiler are rainbows of errors. Rather than confuse the people here with my attempts, I figured I'd give my (simplified) original working code and allow the experts to draw their own conclusions on how to do this. In reality, there's about 50 of those <code>ReadXxx</code> functions, but they either follow the general structure of the <code>ReadAlpha</code> or <code>ReadBeta</code> functions above. So if someone can show me how to do those, I can without an issue convert my actual code. (I imagine I will need to change <code>TryFormats()</code> definition as well, and that's no problem either - I am just hoping someone can show me how to do get the above example refactored properly.)</p>

<p>Thank you, and my apologies for the long, long question.</p>
","<c++><templates><refactoring><function-pointers>","1","141","2009-11-20 14:33:07"
"1779679","How can I make this repeated code more elegant?","<p>I have this repeated code below and I am assuming that this can be consolidated but if you notice each dictionary is different generic dictionary:</p>

<p>dictionary1 is of type  </p>

<pre><code>Dictionary&lt;int, ContinuousIntegrationSolution&gt;
</code></pre>

<p>whereas dictionary2 is of type:</p>

<pre><code>Dictionary&lt;int, BugTracker&gt;

      DataTable dt = GetDataTable(""CI"");
        for (int i = 0; i &lt; dt.Rows.Count; i++)
        {
            DataRow dr = dt.Rows[i];
            int id = Convert.ToInt32(dr[""id""]);
            string name = dr[""name""].ToString();
            _dictionary1[id] = new ContinuousIntegrationSolution(){Name = name};
        }

        DataTable dt1 = GetDataTable(""Bug_Tracking"");

        for (int i = 0; i &lt; dt1.Rows.Count; i++)
        {
            DataRow dr = dt1.Rows[i];
            int id = Convert.ToInt32(dr[""id""]);
            string name = dr[""name""].ToString();
            _dictionary2[id] = new BugTracker() { Name = name };
        }

        DataTable dt2 = GetDataTable(""SDLC"");

        for (int i = 0; i &lt; dt2.Rows.Count; i++)
        {
            DataRow dr = dt2.Rows[i];
            int id = Convert.ToInt32(dr[""id""]);
            string name = dr[""name""].ToString();
            _dictionary3[id] = new SDLCProcess() { Name = name };
        }
</code></pre>

<p><hr></p>

<p>NOTE: I have fixed the few typos that were mentioned below.</p>
","<c#><refactoring>","0","265","2009-11-22 19:19:40"
"1778683","Dead code detection in PHP","<p>I have a project with very messy code - lots of duplication and dead code here and there.</p>

<p>Some time ago there was zero code coverage by unit-tests but now we're trying to write all new code in T.D.D. manner and lowering technical debt by covering ""old"" code by unit-tests as well(test-last technique).</p>

<p><b>Business logic's complexity is quite high</b> and sometimes no one can answer whether some methods are used or not.</p>

<p>How this dead code methods can be found? Extensive logging? Higher test coverage?(It is not very easy because customers want new features to come out)</p>
","<php><refactoring><code-coverage><legacy-code>","13","1761","2009-11-22 13:23:46"
"1780781","Distribute range in array","<p>I need to create one array of numbers inside one range, like:</p>

<p>[1..5] in 10 times = [1,1,2,2,3,3,4,4,5,5] </p>

<p>[1..5] in 5 times = [1,2,3,4,5] </p>

<p>[1..5] in 3 times = [1,3,5] </p>

<pre><code>def distribute(start_value, end_value, times, is_integer)
    array = Array.new(times-1)

    min_value = [end_value,start_value].min
    max_value = [end_value,start_value].max

    if max_value-min_value&lt;times
      factor = (max_value-min_value).abs/(array.size).to_f
    else
      factor = (max_value-min_value).abs/(array.size-1).to_f
    end

    for i in 0..array.size
      v = [ [max_value, factor*(i+1)].min, min_value].max
      is_integer ? array[i] = v.round : array[i] = v
    end

    start_value &lt; end_value ? array : array.reverse
  end
</code></pre>

<blockquote>
  <p>distribute(1, 5, 10, true)
  => [1, 1, 1, 2, 2, 3, 3, 4, 4, 4] #WRONG should be [1,1,2,2,3,3,4,4,5,5]</p>
  
  <p>distribute(5, 1, 5, true)
  => [5, 4, 3, 2, 1] #OK</p>
  
  <p>distribute(1, 5, 3, true)
  => [4, 5, 5] #WRONG should be [1, 3, 5]</p>
</blockquote>
","<ruby><refactoring><range><distribution>","1","283","2009-11-23 02:11:04"
"1780672","How can this 6 line method be refactored to be more readable?","<p>I'm trying to clean up this ridonkulously ugly method here, that's crying out for refactoring, but I'm not sure what kind of structure would do this best (i.e. a case statement, or simply a carefully formatted <code>if then</code> statements)</p>

<p>At first glance, it looks like it would be an ideal place for a case statement with a few well placed <code>when</code>'s, but my understanding was that case statements can only be used to for a single variable, not two, and various fiddlings with irb to try these statements using hashes or arrays haven't shed much light here either.</p>

<p>How would you do this? Are there any common tricks in Ruby to avoid code like this when checking multiple booleans like this? </p>

<pre><code>  def has_just_one_kind_of_thing?(item, controller)
    if (controller == 'foos' &amp;&amp; item.widgets.blank?) || (controller == 'foos' &amp;&amp; item.doohickeys.blank?) || (controller == 'bars' &amp;&amp; item.widgets.blank?) || (controller == 'bars' &amp;&amp; item.doohickeys.blank?) || (controller == 'bazes' &amp;&amp; item.widgets.blank?) || (controller == 'bazes' &amp;&amp; item.contraptions.blank?)
      return true
    else 
      return false
    end
  end
</code></pre>
","<ruby><oop><readability><refactoring><code-readability>","5","442","2009-11-23 01:18:44"
"1782799",".NET code refactoring when overloads differ on data type","<p>I have a piece of code where in there are 2 overloads which differ by data types of parameter and have different number of parameters as well. I am looking to reduce the code duplication. What are the possible ways I can do this?</p>

<p>My code looks like this:</p>

<pre><code>    public void publicMethod(double[,] data, double increment)
    {
        helperMethod1(data, increment);
    }

    public void publicMethod(double[,] data, TimeSpan increment, Enum someEnum)
    {
        helperMethod2(data, increment, someEnum);
    }

    //The helper methods are in a different class
    internal void helperMethod1(double[,] data, double increment)
    {
        //Some 20 lines of common code

        for (int i = 0; i &lt; data.GetLength(0); ++i)
        {
            TargetFunction((double[])GetRow(i, data), increment);
        }

        //Some more common code
    }

    internal void helperMethod1(double[,] data, TimeSpan increment, Enum someEnum)
    {
        //Some 20 lines of common code

        for (int i = 0; i &lt; data.GetLength(0); ++i)
        {
            TargetFunction((double[])GetRow(i, data), increment, someEnum);
        }

        //Some more common code
    }

    public static double[] GetRow(int rowIndex, double[,] array)
    {
        double[] row = new double[array.GetLength(1)];
        Buffer.BlockCopy(array, array.GetLength(1) * rowIndex * 8, row, 0, array.GetLength(1) * 8);
        return row;
    }
</code></pre>

<h2>UPDATE:</h2>

<p>OK. It looks like I am not explaining my code well enough. I will paste the exact code I have so that you guys get a better picture:</p>

<pre><code>    public class PublicClass
    {
        public void PlotXAppendMultiple(double[,] xData, DataOrientation orientation, TimeSpan increment, PrecisionMode precisionMode)
        {
            HelperClass.PlotXAppendMultiple(xData, orientation, increment, precisionMode);
        }

        public void PlotXAppendMultiple(double[,] xData, DataOrientation orientation, double increment)
        {
            HelperClass.PlotXAppendMultiple(xData, orientation, increment);
        }
    }

    internal class HelperClass
    {
        public virtual void PlotXAppendMultiple(double[,] xData, DataOrientation orientation, double increment)
        {
            switch (orientation)
            {
                case (DataOrientation.DataInRows):
                    {
                        for (int i = 0; i &lt; xData.GetLength(0); ++i)
                        {
                            TargetFunction((double[])GetRow(i, xData), increment);
                        }
                        break;
                    }
                case (DataOrientation.DataInColumns):
                    {
                        for (int i = 0; i &lt; xData.GetLength(1); ++i)
                        {
                            TargetFunction((double[])GetColumn(i, xData), increment);
                        }
                        break;
                    }
                default:
                    {
                        break;
                    }
            }
        }

        public virtual void PlotXAppendMultiple(double[,] xData, DataOrientation orientation, TimeSpan increment, PrecisionMode precisionMode )
        {
            switch (orientation)
            {
                case (DataOrientation.DataInRows):
                    {
                        for (int i = 0; i &lt; xData.GetLength(0); ++i)
                        {
                            TargetFunction((double[])GetRow(i, xData), increment, precisionMode);
                        }
                        break;
                    }
                case (DataOrientation.DataInColumns):
                    {
                        for (int i = 0; i &lt; xData.GetLength(1); ++i)
                        {
                            TargetFunction((double[])GetColumn(i, xData), increment, precisionMode);
                        }
                        break;
                    }
                default:
                    {
                        break;
                    }
            }
        }
    }
</code></pre>

<p>I dont want to modify the enums I am using (so basically I want to add dummy entries to it). Is it even possible/worth refactoring this code?</p>
","<.net><refactoring>","2","105","2009-11-23 12:15:07"
"1787717","C# which is faster do/while or for?","<p>I have a C# .NET 2.0 script and I want to know why the following code would be faster than a do while loop of the same kind. </p>

<pre><code>private double getStop(double avgPrice, bool longTrading)
	{
		double stopS = 0.0;
		double stopL = 0.0;

		for (int i = 0; i &lt; 13; i++)
		{
			if (i == 0 || i == 12)
			{
				stopS = 0.0;
				stopL = 0.0;
			}
			else
			{
				if ((lines[i] - ((lines[i] - lines[i - 1]) / 2)) &lt; avgPrice &amp;&amp; avgPrice &lt; (lines[i + 1] - ((lines[i + 1] - lines[i]) / 2)))
				{
					if (avgPrice &lt; lines[i])
					{
						stopL = (lines[i] - ((lines[i] - lines[i - 1]) / 2));
						stopS = lines[i];
					} else {
						stopL = lines[i];
						stopS = (lines[i + 1] - ((lines[i + 1] - lines[i]) / 2));
					}
				}
			}
		}

		if (longTrading)
		{
			return stopL;	
		} else {
			return stopS;	
		}	
	}
</code></pre>

<p>Also, would it be faster just to explicitly state each if statement instead of doing them inside of a for loop? </p>

<p>Being that this was answered so fast, why would this run far slower than the above code?</p>

<pre><code>private double getStop(double avgPrice, bool longTrading)
	{
		double stopS = 0.0;
		double stopL = 0.0;

		for (int i = 0; i &lt; 13; i++)
		{
			if (i == 0 || i == 12)
			{
				stopS = 0.0;
				stopL = 0.0;
                skip = true;
			}

			if (!skip &amp;&amp; (lines[i] - ((lines[i] - lines[i - 1]) / 2)) &lt; avgPrice &amp;&amp; avgPrice &lt; (lines[i + 1] - ((lines[i + 1] - lines[i]) / 2)))
				{
					if (avgPrice &lt; lines[i])
					{
						stopL = (lines[i] - ((lines[i] - lines[i - 1]) / 2));
						stopS = lines[i];
					} else {
						stopL = lines[i];
						stopS = (lines[i + 1] - ((lines[i + 1] - lines[i]) / 2));
					}
				}
			}
           skip = false;
		}

		if (longTrading)
		{
			return stopL;	
		} else {
			return stopS;	
		}	
	}
</code></pre>
","<c#><refactoring><c#-2.0><benchmarking>","-3","600","2009-11-24 04:08:49"
"1792714","Resharper 4.5 Extract method - Can't get Function!","<p>I am using Resharper 4.5 in Visual Studio 2008.  Whenever I try to extract a block of code into a method, it tries to create a subroutine and not a function.  The return type option is disabled.  Does anyone have any advice as to how I can get it to create a function and not a subroutine?</p>

<p>thanks!</p>
","<vb.net><visual-studio-2008><refactoring><methods><resharper-4.5>","0","77","2009-11-24 20:28:43"
"1794277","How to identify LINQable parts in pre-.NET 3.5 code?","<p>This is the scenario: I have a huge code-base written in .NET 2.0...and sometime back the migration happened to .NET 3.5.</p>

<p>This code-base is both refactored and enhanced as an ongoing maintenance project. I am looking for patterns to identify in code base which are good candidates for <strong>LINQ to Objects.</strong></p>

<p>I need pointers for comprehensive analysis in identifying LINQ-to-Object-phillic areas of my code.</p>
","<c#><linq><design-patterns><refactoring><linq-to-objects>","0","70","2009-11-25 02:25:13"
"1795119","Template pattern violates encapsulation?","<p>Please take a look at this piece of code I came up with.</p>

<pre><code>    abstract class Command
    {
     public void Execute(string[] commandParameters)
     {
        CommandResult result = ExecuteCommand(commandParameters);
        PrintResult(result);
     }

     public abstract CommandResult ExecuteCommand(string[] commandParameters);
     public abstract void PrintResult(CommandResult result);
    }
</code></pre>

<p>There will be several commands inheriting from this Command class. Each command would override ExecuteCommand and PrintResult. Although with this design, for the client code, I am exposing both Execute and ExecuteCommand function which is wierd. I feel like I need to define a template for a function but not expose other functions which are used in that template! Refactoring fellas, my code sucks almost all the time, please let me know what might be the best way out here.</p>
","<refactoring><patterns>","1","67","2009-11-25 06:58:43"
"1796829","Is there any C++ code beautifuler plug-in for eclipse?","<p>I found a very tempting function in Netbeans, which is to re-factor or 'beautiful-ize' the c++ code according to some parameters, such as tab length, {'s position, etc</p>

<p>is there anything similar in Eclipse, which keyword should I google?</p>
","<c++><eclipse><refactoring>","0","262","2009-11-25 13:14:15"
"1798538","Looking for some refactoring advice","<p>I have some code that I had to write to replace a function that was literally used thousands of times.  The problem with the function was that return a pointer to a static allocated buffer and was ridiculously problematic.  I was finally able to prove that intermittent high load errors were caused by the bad practice. </p>

<p>The function I was replacing has a signature of <code>char * paddandtruncate(char *,int)</code>, <code>char * paddandtruncate(float,int)</code>, or <code>char * paddandtruncat(int,int)</code>.  Each function returned a pointer to a static allocated buffer which was overwritten on subsequent calls. </p>

<p>I had three constants one the</p>

<ol>
<li>Code had to be replaceable with no impact on the callers.</li>
<li>Very little time to fix the issue.</li>
<li>Acceptable performance.</li>
</ol>

<p>I wanted some opinion on the style and possible refactoring ideas.</p>

<p>The system is based upon fixed width fields padded with spaces, and has some architectural issues.  These are not addressable since the size of the project is around 1,000,000 lines.</p>

<p>I was at first planning on allowing the data to be changed after creation, but thought that immutable objects offered a more secure solution.</p>

<pre><code>    using namespace std;
class SYSTEM_DECLSPEC CoreString
{
private:
     friend ostream &amp; operator&lt;&lt;(ostream &amp;os,CoreString &amp;cs);

     stringstream   m_SS          ;
     float          m_FltData     ;
     long           m_lngData     ;
     long           m_Width       ;
     string         m_strData     ;
     string                  m_FormatedData;
     bool           m_Formated    ;
     stringstream    SS            ;


public:

     CoreString(const string &amp;InStr,long Width):
             m_Formated(false),
             m_Width(Width),
             m_strData(InStr)
             {
                     long OldFlags = SS.flags();
                     SS.fill(' ');
                     SS.width(Width);
                     SS.flags(ios::left);
                     SS&lt;&lt;InStr;
                     m_FormatedData = SS.str();
             }

     CoreString(long longData , long Width):
             m_Formated(false),
             m_Width(Width),
             m_lngData(longData)
             {
                     long OldFlags = SS.flags();
                     SS.fill('0');
                     SS.precision(0);
                     SS.width(Width);
                     SS.flags(ios::right);
                     SS&lt;&lt;longData;
                     m_FormatedData = SS.str();
             }

     CoreString(float FltData, long width,long lPerprecision):
             m_Formated(false),
             m_Width(width),
             m_FltData(FltData)
             {
                     long OldFlags = SS.flags();
                     SS.fill('0');
                     SS.precision(lPerprecision);
                     SS.width(width);
                     SS.flags(ios::right);
                     SS&lt;&lt;FltData;
                     m_FormatedData = SS.str();
             }

     CoreString(const string &amp;InStr):
             m_Formated(false),
             m_strData(InStr)
             {
                     long OldFlags = SS.flags();
                     SS.fill(' ');
                     SS.width(32);
                     SS.flags(ios::left);
                     SS&lt;&lt;InStr;
                     m_FormatedData = SS.str();
             }
 public:
     operator const char   *() {return m_FormatedData.c_str();}
     operator const string&amp; () const {return m_FormatedData;}
     const string&amp; str() const ; 

};

const string&amp; CoreString::str() const
{
     return m_FormatedData;
}

ostream &amp; operator&lt;&lt;(ostream &amp;os,CoreString &amp;cs)
{
     os&lt;&lt; cs.m_Formated;
     return os;
 }
</code></pre>
","<c++><refactoring><refactor-my-code>","0","144","2009-11-25 17:23:35"
"1797984","Anyone tried JustCode?","<p>Have you used <a href=""http://www.telerik.com/products/justcode.aspx"" rel=""nofollow"">JustCode</a>?  is it better than resharper?  seems like performance better.  Do I need to uninstall resharper before using JustCode?</p>
","<visual-studio><refactoring><resharper><justcode>","18","5749","2009-11-25 16:05:46"
"1800634","Diff tool that can compare sub-sections of files","<p>I'm looking for a diff tool that will allow me to compare just a sub-section of a file with a section of another file, or even of itself. Preferably eclipse based but will take all suggestions.</p>

<p>Yes I know I can copy out the two sections into different files and compare those, but that is very tedious when you are trying to do a large amount of refactoring.</p>

<p>Basically I'm trying to remove as much duplicated code as possible from a code base that is suffering from a great deal of ctrl-V 'inheritance' ;-) However the pasted parts have evolved apart a little over time.</p>
","<eclipse><refactoring><eclipse-plugin><diff>","4","394","2009-11-25 23:20:52"
"1797667","C# Switch Statement refactoring","<p>The purpose of the code below is to determine if a particular date qualifies as a ""weekend"" i.e after 12:00 PM on Thursday, minimum 2 days and before Monday 12:00 PM</p>

<p>Is there a better way? If-Else turns ugly and the Strategy pattern is way too much work for this.</p>

<pre><code>public bool ValidateWeekend(DateTime pickupDate, DateTime dropoffDate)
    {
        TimeSpan ts = dropoffDate.Subtract(pickupDate);

        if (ts.TotalDays &gt;= 2 &amp;&amp; ts.TotalDays &lt;= 4)
        {
            switch (pickupDate.DayOfWeek)
            {
                case DayOfWeek.Thursday:
                    if (pickupDate.Hour &gt;= 12)
                    {
                        switch (dropoffDate.DayOfWeek)
                        {
                            case DayOfWeek.Sunday:
                                return true;
                            case DayOfWeek.Monday:
                                if (dropoffDate.Hour &lt;= 12)
                                {
                                    return true;
                                }
                                return false;
                        }
                    }
                    break;
                case DayOfWeek.Friday:
                    switch (dropoffDate.DayOfWeek)
                    {
                        case DayOfWeek.Sunday:
                            return true;
                        case DayOfWeek.Monday:
                            if (dropoffDate.Hour &lt;= 12)
                            {
                                return true;
                            }
                            return false;
                    }
                    break;
                case DayOfWeek.Saturday:
                    switch (dropoffDate.DayOfWeek)
                    {
                        case DayOfWeek.Sunday:
                            return true;
                        case DayOfWeek.Monday:
                            if (dropoffDate.Hour &lt;= 12)
                            {
                                return true;
                            }
                            return false;
                    }
                    return false;
            }
        }
        return false;
    }
</code></pre>
","<c#><refactoring><switch>","3","1136","2009-11-25 15:26:04"
"1802965","Create a new method from selecting existing code block, Eclipse","<p>I'm using <em>Eclipse 3.something</em> and would like to know if it is possible to create a new method from selecting a block of code?  Obviously the method's signature would contain the necessary existing references and we can't return more than one variable from a method.</p>

<p>I have various methods where code related to presentation is mixed with code related to the logic.  TY</p>
","<eclipse><refactoring><methods>","1","204","2009-11-26 10:46:43"
"1802629","Is there an elegant way to remove nulls while transforming a Collection using Google Collections?","<p>I have a question about simplifying some Collection handling code, when using Google Collections.</p>

<p>I've got a bunch of ""Computer"" objects, and I want to end up with a Collection of their ""resource id""s.  This is done like so:</p>

<pre><code>Collection&lt;Computer&gt; matchingComputers = findComputers();
Collection&lt;String&gt; resourceIds = 
    Lists.newArrayList(Iterables.transform(matchingComputers, new Function&lt;Computer, String&gt;() {
    public String apply(Computer from) {
        return from.getResourceId();
    }
}));
</code></pre>

<p>Now, <code>getResourceId()</code> may return null (and changing that is not an option right now), yet in this case I'd like to omit nulls from the resulting String collection.</p>

<p>Here's one way to filter nulls out: </p>

<pre><code>Collections2.filter(resourceIds, new Predicate&lt;String&gt;() {
    @Override
    public boolean apply(String input) {
        return input != null;
    }
});
</code></pre>

<p>You could put all that together like this:</p>

<pre><code>Collection&lt;String&gt; resourceIds = Collections2.filter(
Lists.newArrayList(Iterables.transform(matchingComputers, new Function&lt;Computer, String&gt;() {
    public String apply(Computer from) {
        return from.getResourceId();
    }
})), new Predicate&lt;String&gt;() {
    @Override
    public boolean apply(String input) {
        return input != null;
    }
});
</code></pre>

<p>But this is hardly elegant, let alone readable, for such a simple task! In fact, plain old Java code (with no fancy Predicate or Function stuff at all) would arguably be much cleaner:</p>

<pre><code>Collection&lt;String&gt; resourceIds = Lists.newArrayList();
for (Computer computer : matchingComputers) {
    String resourceId = computer.getResourceId();
    if (resourceId != null) {
        resourceIds.add(resourceId);
    }
}
</code></pre>

<p>Using the above is certainly also an option, but out of curiosity (and desire to learn more of Google Collections), <strong>can you do the exact same thing in some shorter or more elegant way using Google Collections</strong>?</p>
","<java><collections><refactoring><guava>","9","1603","2009-11-26 09:42:20"
"1804839","Eclipse: Most useful refactorings","<p>Every now and again, I make use of the Eclipse refactoring feature. Some techniques are more obvious then others and some I never tried.</p>

<p>What refactoring is most useful for you and why?</p>

<p>Note: I find this presentation very useful, perhaps because it is example driven therefore easy to understand:</p>

<p>""<a href=""http://www.ibm.com/developerworks/library/os-ecref/"" rel=""nofollow"">Refactoring for everyone - How and why to use Eclipse's automated refactoring features</a>""</p>

<p>Edit: This article is useful as well (Thanks jitter)</p>

<p><a href=""http://www.ibm.com/developerworks/opensource/library/os-eclipse-refactoring/index.html"" rel=""nofollow"">Explore refactoring functions in Eclipse JDT</a></p>
","<java><eclipse><refactoring>","21","1467","2009-11-26 17:11:22"
"1804930","What complex refactoring features do you wish there were?","<p>Tools like CodeRush and Resharper offer lots of simple refactorings, such as 'Rename Variable'. But if you could have any refactoring feature at all (no matter how complex), what would it be?</p>

<p>(I know, everyone wants a 'make program perfect' refactoring, but let's be realistic here.)</p>
","<c#><refactoring><resharper><coderush>","0","145","2009-11-26 17:39:17"
"1806393","Is there a way to extract a class with methods in eclipse?","<p>I am trying to refactor a class I have into 2 classes. Unfortunately eclipse's extract class function seems to only support the variables which really isn't all that helpful. Is there a way to do it that extracts the methods or Is there a plugin that does it? Thanks  </p>
","<eclipse><refactoring><eclipse-plugin>","9","867","2009-11-27 01:27:48"
"1809174","Performance implications with 'clean code'","<p>At my workplace we're planning a major refactor on our core product, a web application with several 'modules'. I quoted that because that's one of our main concerns: modules are not really modules, the whole thing is monolithic. The application is written in PHP with smarty templating and using Pear for accessing a MySQL database. We're not really concerned with database independence, although it would be nice if that wouldn't take months to implement.</p>

<p>Our main concerns are that development time/cost is increasing exponentially because of bugs popping up in unrelated places and not having a sound common architecture to rely on to get the most common functionality (each module is basically copy/paste from the previous one, then adapt).</p>

<p>I've got some experience with the web MVC principle, mainly in ASP.NET MVC. I like the clean separation it offers and the testability. However, when trying this on a local machine the app is simply a lot slower than it should be. </p>

<p>Alright, enough introduction, off to the questions:
- Should I rely on caching modules? Does this remove most of the overhead using a good architecture provide? Something like APC.</p>

<ul>
<li>The application is mainly read. Writing is mainly single values (change a single field on a record). Any OR/M for PHP that are good at this?</li>
<li>Also looking for a flexible MVC framework. I know Zend, CakePHP, maybe Symfony?</li>
</ul>

<p>The tricky part is that we don't have the luxury of being able to do a full rewrite. We'll have to incrementally improve a currently very messy codebase. This has to be done while writing new code, or fixing bugs. One thing I'd really, REALLY like to be able to do is write a regression test for a new bug before fixing it, to prevent it from popping up again later (this happens, occasionally).</p>

<p>The stack I'm currently considering contains:</p>

<ul>
<li>MVC framework of choice</li>
<li>Logging (log4php?)</li>
<li>an OR/M of choice (doesn't have to be dynamic, code generation is fine too)</li>
<li>IoC container of choice</li>
<li>Smarty Templating, perhaps abstracted so we can switch it out if we need to.</li>
<li>Opcode cache of choice (we're using one now, forgot which one, have to ask sysadmin)</li>
</ul>

<p>The main point that worries me is the performance implications of creating clean code in PHP. Seeing it's a parsed language opposed to something like the .NET/Java web stack, creating abstractions for otherwise in-line code (with obligatory separation in different files) might create new problems on another level.</p>

<p><hr></p>

<p>Note: Retag if you come up with more appropriate tags, I'm not sure on the current ones.</p>
","<php><performance><refactoring><separation-of-concerns>","3","233","2009-11-27 14:45:33"
"1824366","How to handle widespread code format changes in a git repository","<p>We have a project with around 500,000 lines of code, managed with git, much of it several years old.  We're about to make a series of modifications to bring the older code into conformance with the developer community's current standards and best practices, with regards to naming conventions, exception handling, indentation, and so forth.</p>

<p>You can think of it as something between pretty printing and low level/mechanical refactoring.</p>

<p>This process is likely to touch almost every line of code in the code base (~85%), and some lines will be subject to as many as five modifications.  All of the changes are intended to be semantically neutral.</p>

<p>
<li>Is there any way to make the changes transparent to git blame, etc. so that when looking at the code a month from now we'll see the commit the logic was introduced in, not the one in which the indentation or capitalization was changed?
<li>What's the best way to pull merges from forks that have not undergone this process?  My present plan would be to have a script clone the forked repo, apply the automated process to it and its base, diff them, then apply the diff.  But I'd love to have a cleaner answer.
<li>Are there any other problems of this sort that I'm not seeing, and if so what can be done to mitigate them?  I'm figuring that git bisect, etc. should be fine, git log, etc. crossing the great divide will be annoying unless you are careful, and git diff will be hopeless, but I'm not convinced I'm not overlooking another pain point.</p>
","<git><refactoring><indentation><pretty-print>","16","698","2009-12-01 06:30:17"
"1826914","Strategies for multithreaded application","<p>I might inherit a somewhat complex multithreaded application, which currently has several files with 2+k loc, lots of global variables accessed from everywhere and other practices that I would consider quite smelly.</p>

<p>Before I start adding new features with the current patterns, I'd like to try and see if I can make the basic architecture of the application better. Here's a short description :</p>

<ul>
<li>App has in memory lists of data, listA, listB</li>
<li>App has local copy of the data (for offline functionality) dataFileA, dataFileB</li>
<li>App has threads tA1, tB1 which update dirty data from client to server</li>
<li>Threads tA2, tB2 update dirty  data from server to client</li>
<li>Threads tA3, tB3 update dirty  data from in memory lists to local files</li>
</ul>

<p>I'm kinda trouble on what different patterns, strategies, programming practices etc I should look into in order to have the knowledge to make the best decisions on this.</p>

<p>Here's some goals I've invented for myself:</p>

<ol>
<li>Keep the app as stable as possible </li>
<li>Make it easy for Generic Intern to add new features (big no-no to 50 lines of boilerplate code in each new EditRecordX.cs )</li>
<li>Reduce complexity</li>
</ol>

<p>Thanks for any keywords or other tips which could help me on this project.</p>
","<c#><multithreading><refactoring><synchronization>","1","166","2009-12-01 15:27:24"
"1833786","Rails XML Builder - Code refactoring","<p>I have written the following code in my Rails app to generate XML. I am using Aptana IDE to do Rails development and the IDE shows a warning that the code structure is identical in both the blocks. What changes can be done to the code to remove the duplicity in structure? Is there any other way to write the same?</p>

<pre><code>xml.roles do
    @rolesList.each do |r|
        xml.role(:id =&gt; r[""role_id""], :name =&gt; r[""role_name""])
    end
end

xml.levels do
    @levelsList.each do |lvl|
        xml.level(:id =&gt; lvl[""level_id""], :name =&gt; lvl[""level_name""])
    end
end
</code></pre>
","<ruby-on-rails><xml><refactoring><builder>","0","1366","2009-12-02 15:51:14"
"1833972","How can I simplify this ocaml pattern-matching code?","<p>I'm writing a simple little ocaml program that reads an algebraic statement in from a file, parses it into an AST using ocamllex/ocamlyacc, reduces it, and then prints it.  The part where I'm reducing the expression seems a bit... ugly.  Is there any way I can simplify it?</p>

<pre><code>(* ocaml doesn't seem to be able to take arithmetic operators
 as functions, so define these wrappers for them *)
let add x y =
  x + y

let sub x y =
  x - y

let mul x y =
  x * y

let div x y =
  x / y

(* Are term1 and term2 both ints? *)
let both_ints term1 term2 =
  match (term1, term2) with
    | (Term (Number x), Term (Number y)) -&gt; true
    | (_, _) -&gt; false

(* We know that both terms are reducable to numbers, so combine
  them *)
let combine_terms func x y =
  match (x, y) with
      (Term (Number t1), Term (Number t2)) -&gt;
        (Term (Number (func  t1  t2)))
    | (_, _) -&gt; raise InvalidArg

(* Reduce the expression as much as possible *)
let rec reduce_expr expr =
  match expr with
      Plus (x, y) -&gt;
        let reduced_x = reduce_expr x
        and reduced_y = reduce_expr y in
      if both_ints reduced_x reduced_y then
        (combine_terms add reduced_x reduced_y)
      else
        Plus (reduced_x, reduced_y)
    | Minus (x, y) -&gt;
        let reduced_x = reduce_expr x
        and reduced_y = reduce_expr y in
      if both_ints reduced_x reduced_y then
        (combine_terms sub reduced_x reduced_y)
      else
        Minus (reduced_x, reduced_y)
    | Multiply (x, y) -&gt;
        let reduced_x = reduce_expr x
        and reduced_y = reduce_expr y in
      if both_ints reduced_x reduced_y then
        (combine_terms mul reduced_x reduced_y)
      else
        Multiply (reduced_x, reduced_y)
    | Divide (x, y) -&gt;
        let reduced_x = reduce_expr x
        and reduced_y = reduce_expr y in
      if both_ints reduced_x reduced_y then
        (combine_terms div reduced_x reduced_y)
      else
        Divide (reduced_x, reduced_y)
    | Term x -&gt; Term x
</code></pre>
","<refactoring><pattern-matching><ocaml>","2","211","2009-12-02 16:15:29"
"1837801","Refactoring exceptions for workflow","<p>I am currently refactoring an application which uses exceptions for logic flow. The code is difficult to read and maintain and makes a S.O.L.I.D fanboy like myself cry when reading it (not to mention the longest catch block I've ever seen in my career). </p>

<p>My question is what pattern(s) could you use to make it easier to maintain or how would you go about refactoring?</p>

<pre><code>public void CallExternalServices(ICriteria criteria)
{
    try
    {
    	someResult = ExternalService1.SomeMethod(criteria);
    }
    catch (Service1Exception service1Exception)
    {
    	if (criteria.SomeValue == ""1"")
    	{
    		if (service1Exception.InnerException != null 
    			&amp;&amp; service1Exception.InnerException.InnerException != null
    			&amp;&amp; service1Exception.InnerException.InnerException is TargetSystemException)
    		{
    			TargetSystemException targetSystemException = (TargetSystemException)service1Exception.InnerException.InnerException;
    			if (targetSystemException.ErrorStatus.IsServiceDownForMaintenance())
    			{
    				// Call internal method to perform some action
    				SendNotification(""Service down for maintenance."")
    			}
    		}
    	}
    	else if (criteria.SomeValue == ""2"")
    	{
    		if (service1Exception.InnerException != null 
    			&amp;&amp; service1Exception.InnerException.InnerException != null
    			&amp;&amp; service1Exception.InnerException.InnerException is TargetSystemException)
    		{
    			TargetSystemException tx = (TargetSystemException)service1Exception.InnerException.InnerException;
    			if (targetSystemException.ErrorStatus.IsBusy())
    			{
    				// Call to some internal method to perform an action
    				SendDifferentNotification()

    				criteria.SetSomeFlagToBe = true;

    				try
    				{
    					someResult = ExternalService2.SomeOtherMethod(criteria);
    				}
    				catch (Service2Exception service2Exception)
    				{
    					if (service2Exception.InnerException != null 
    						&amp;&amp; service2Exception.InnerException.InnerException != null
    						&amp;&amp; service2Exception.InnerException.InnerException is TargetSystemException)
    					{
    						TargetSystemException tx = (TargetSystemException)service1Exception.InnerException.InnerException;
    						if (targetSystemException.ErrorStatus.HasNumberOfDailyTransactionsBeenExceeded())
    						{
    							// Call internal method to perform some action
    							SendNotification(""Number of daily transactions exceeded."")
    						}
    					}
    					else if (service2Exception.InnerException != null
    						&amp;&amp; service2Exception.InnerException.InnerException != null
    						&amp;&amp; service2Exception.InnerException.InnerException is FaultException)
    					{
    						FaultException faultException = service2Exception.InnerException.InnerException as FaultException;

    						if (faultException.Detail != null
    							&amp;&amp; faultException.Detail.FaultMessage.Equals(""SomeValueToCheckAgainst"", StringComparison.OrdinalIgnoreCase))
    						{
    							return someResult;
    						}
    						else
    						{
    							throw service2Exception;
    						}
    					}
    					else
    					{
    						throw service2Exception;
    					}
    				}

    				if (someResult != null)
    				{
    					// perform another action
    					SomeActionInvoker.ExecuteAcitonAgainst(someResult);
    				}
    			}
    		}
    		else if (service1Exception.InnerException != null
    				 &amp;&amp; service1Exception.InnerException.InnerException != null
    				 &amp;&amp; service1Exception.InnerException.InnerException is FaultException)
    		{
    			FaultException faultException = service1Exception.InnerException.InnerException as FaultException;

    			if (faultException.Detail != null
    				&amp;&amp; faultException.Detail.FaultMessage.Equals(""SomeOtherValueToCheckAgainst"", StringComparison.OrdinalIgnoreCase))
    			{
    				return someResult;
    			}
    			else
    			{
    				throw service1Exception;
    			}
    		}
    		else
    		{
    			throw service1Exception;
    		}
    	}
    }
}
</code></pre>
","<c#><exception><refactoring>","0","102","2009-12-03 05:13:19"
"1838910","How do I get a list of event handlers with nonstandard names in my code?","<p>I'm in the middle of performing a large refactoring which will involve renaming a lot of events.  This will leave our code with a lot of code like this:</p>

<pre><code>thing.NewEventName += thing_OldEventName;
</code></pre>

<p>How do I get a list of event handlers with nonstandard names in my code?  Should I be thinking about a regex search, or should I be looking at writing something using CodeDom?</p>
","<c#><.net><refactoring><naming-conventions><event-handling>","1","144","2009-12-03 10:02:04"
"1844537","Refactoring a method containing conditional with extremely different code blocks that are the same ;)","<p>So I have this stinky method, the two conditional blocks do almost the exact same thing, but with radically different parameters (at least in my eyes). I want to clean it Uncle Bob style, but can't for the life of me figure out a tidy way of doing it. So I come to you, my fabulous nerd friends, to see how you might distill this down to something that doesn't make one want to gouge out their eyes. The code is AS3, but that doesn't really make a difference in my opinion.</p>

<pre><code>/**
 * Splits this group into two groups based on the intersection of the group
 * with another group. The group is split in a direction to fill empty
 * cells left by the splitting group.
 *
 * @param onGroup
 * @param directionToMoveSplitCells
 * @return
 *
 */
public function split(onGroup:CellGroup, directionToMoveSplitCells:String):CellGroup
{
	if (!hasIntersection(onGroup))
		return this;
	var numCellsToSplit:int = 0;
	var splitCells:Array;
	var newGroup:CellGroup;
	var numberOfCellsToSplit:int;
	var splitStartIndex:int;
	var resultingGroupStartIndex:int;

	if (directionToMoveSplitCells == ""RIGHT"")
	{
		numberOfCellsToSplit = endIndex - onGroup.startIndex + 1;
		splitStartIndex = length - numberOfCellsToSplit;
		splitCells = trimCells(splitStartIndex, numberOfCellsToSplit);
		resultingGroupStartIndex = onGroup.endIndex + 1;

		if (splitCells.length &gt; 0)
		{
			newGroup = row.createGroup(splitCells, resultingGroupStartIndex)
			newGroup.nextGroup = nextGroup;
			if (newGroup.nextGroup)
				newGroup.nextGroup.previousGroup = newGroup;
			newGroup.previousGroup = this;
			nextGroup = newGroup;

		}
	}
	else
	{
		numberOfCellsToSplit = onGroup.endIndex - startIndex + 1;
		splitStartIndex = 0;
		splitCells = trimCells(splitStartIndex, numberOfCellsToSplit);
		resultingGroupStartIndex = onGroup.startIndex - splitCells.length;

		if (splitCells.length &gt; 0)
		{
			newGroup = row.createGroup(splitCells, resultingGroupStartIndex)
			newGroup.previousGroup = previousGroup;
			if (newGroup.previousGroup)
				newGroup.previousGroup.nextGroup = newGroup
			previousGroup = newGroup;
			newGroup.nextGroup = this;
			var newX:int = (onGroup.endIndex + 1) * cellSize.width;
			x = newX;
		}

	}

	removeArrayOfCellsFromGroup(splitCells);
	row.joinGroups();
	row.updateGroupIndices();
	repositionCellsInGroup();

	return newGroup;
}
</code></pre>
","<oop><refactoring><coding-style>","0","172","2009-12-04 02:44:08"
"1846605","Long code blocks inside if statements or for loops","<p>This is a cross language question on coding style.</p>

<p>I have to work with a lot of code that has very long code blocks, sometimes hundreds of lines, inside if statements or for loops. The code is procedural.</p>

<p>Code like the following</p>

<pre><code>if(condition){
    //hundreds of lines of code
}else if{
    //hundreds of lines of code
} else {
    //hundreds of lines of code
}
</code></pre>

<p>I have trouble navigating this code if I haven't seen it in a while because I constantly have to scroll back and forth to check which branch of the statement I'm in or whether I'm in a loop, or what the loop iterator is called.</p>

<p>My hunch is to put pieces of the long lines of code inside functions and call them from within the branches of the statements or inside the loops, so the loops and if trees are shorter and therefore more readable. I'd create functions that are sensible code-silos ofcourse, not just cut up the current code haphazardly.</p>

<p>But, and here's my question: is that a good idea? Or is it <em>not</em> a bad coding style to have hundreds of lines of code inside an if statement or a for loop? I'm not a really experienced programmer but I do appreciate clean code :)</p>

<p>Thanks!</p>

<p>Added:
The hundreds of lines of code are not repetitive, most of the time. I understand and try to adhere to the DRY principle of course.</p>
","<refactoring><formatting><coding-style>","1","441","2009-12-04 12:18:27"
"1848011","Are there any built in SQL Server 2005 functions to serialize / deserialize string parameters to a table?","<p><strong>The big question is are there any ""built in"" SQL Server 2005 functions to serialize / deserialize string parameters to a table variables?</strong>  The rest explains my need further, but may not be necessary.</p>

<p>I have a SQL SP I would like to refactor.  It currently accepts five customers ids and five sets of order ids relevant to those customers. (one to many).</p>

<p>I would like to change the parameters to select one or more customer ids each having one or more order ids.</p>

<p>The customer id list would be easy because you can provide a string ""1,3,5,77,21"", then dbo.split(@customer, ',') (then isnumeric() and convert(int)..)</p>

<p>Pages would be more difficult.  My first thought is a string like ""[1, 3, 5], [2, 4, 6], [2, 4, 6]"".  Of course, I could cheat and do a double dbo.split() on something like ""1,3,5|2,4,6|2,4,6"".  However, I would want something a little more humanized and standard, maybe XML?</p>
","<sql><sql-server><sql-server-2005><tsql><refactoring>","0","139","2009-12-04 16:14:47"
"1855691","use EventObject.getSource in Actionlistener","<p>I am refactoring some code for an assignment - currently the view has lots of buttons and menus and one action listener which decides what to do by using event.getSource(). From what I've read people seem to think its better for each GUI component to have its own action listener, perhaps created through some kind of factory. However other than it cleaning up the code a bit what other benefits does this give - also does this not mean a lot more objects will be on the heap and could affect performance?</p>

<p>Thanks,</p>

<p>Aly</p>
","<java><gui><refactoring><actionlistener>","1","619","2009-12-06 15:29:26"
"1863056","PHP code validation when refactoring","<p>As a developer that's used to static typing I usually let the compiler tell me if the code is correct, logic flaws excluded of course. But when refactoring PHP I find it is VERY hard to know that my code is correct.</p>

<p>There always seem to be some lingering reference to some method or member somewhere that get's broken and doesn't show up until runtime. Even when using the limited refactoring support in Zend Studio things tend to get broken somehow.</p>

<p>Due to the dynamic nature of the language itself, I understand it is a hard problem. But are there any tools out there to statically verify PHP code so that I know that it is okay before runtime? I don't want to see any more ""Undefined property"" error messages.</p>
","<php><refactoring>","2","105","2009-12-07 21:33:38"
"1862107","Automatically Refactor Access Modifiers","<p>Is there a tool that can run through a visual studio solution and adjust access modifiers to anything not being called in the solution is converted to private or internal where applicable?</p>

<p>I suppose I could just change everything to private, and then use the compiler messages and do it by hand...but that could take a while, if there was something automatic, that would be fantastic!</p>
","<c#><visual-studio><refactoring><access-modifiers>","1","79","2009-12-07 18:56:25"
"1862192","Void, value, or other?","<p>I'm working on a spaghetti monster (unfortunately not of the flying variety), and I've got a question about proper design.</p>

<p>I'm in the process of taking a gigantic static Java method that returns an object and splitting it into reusable (and readable) components.  Right now, the method reads an XML document, and then appends summary and detailed information from the document to a ""dataModule"", and the dataModule is then returned from the method.</p>

<p>In breaking my code up into a getSummaryData and getDetailedData method, I noticed I'd done the following:</p>

<pre><code>dataModule = getSummaryData(xmlDocument);
setDetailedData(xmlDocument, dataModule);
</code></pre>

<p>(Pass by reference, append detailed data to dataModule within method)</p>

<p>This mostly has to do with the fact that the detailed data requires business logic based on the summary data in order to be parsed properly, and the fact that changing the structure of the dataModule involves lots of changing the front end of the application.  </p>

<p>Is this approach any better than:</p>

<pre><code>dataModule = getSummaryData(xmlDocument);
dataModule = setDetailedData(xmlDocument, dataModule);
</code></pre>

<p>(Pass by reference, append detailed data to dataModule within method, return dataModule)</p>

<p>I can't share much more of the code without revealing ""teh secretz"", but is there a strong reason to go with one approach over the other?  Or, am I just getting caught up in which shade of lipstick I'm putting on my pig, here?</p>

<p>Thanks,<br>
IVR Avenger</p>
","<java><refactoring>","2","127","2009-12-07 19:09:32"
"1866329","How should I organise my functions with pyparsing?","<p>I am parsing a file with python and <a href=""http://pyparsing.wikispaces.com/"" rel=""nofollow"">pyparsing</a> (it's the report file for <a href=""http://www.power.uwaterloo.ca/~fmilano/psat.htm"" rel=""nofollow"">PSAT</a> in Matlab but that isn't important). <a href=""http://github.com/kerspoon/laos/blob/master/psat%5Freport.py"" rel=""nofollow"">here</a> is what I have so far. I think it's a mess and would like some advice on how to improve it. Specifically, how should I organise my grammar definitions with pyparsing? </p>

<p>Should I have all my grammar definitions in one function? If so, it's going to be one huge function. If not, then how do I break it up. At the moment I have split it at the sections of the file. Is it worth making loads of functions that only ever get called once from one place. Neither really feels right to me. </p>

<p>Should I place all my input and output code in a separate file to the other class functions? It would make the purpose of the class much clearer. </p>

<p>I'm also interested to know if there is an easier way to parse a file, do some sanity checks and store the data in a class. I seem to spend a lot of my time doing this.</p>

<p>(I will accept answers of <em>it's good enough</em> or <em>use X rather than pyparsing</em> if people agree)</p>
","<python><refactoring><coding-style><pyparsing>","0","368","2009-12-08 11:17:38"
"1866813","Pull-up refactoring, Objective-C","<p>I have two similar classes, <code>MultiSlotBlock</code> and <code>SingleSlotBlock</code>.  They have started to share a lot of common code so I have decided to do some refactoring and pull some of the methods up to a new superclass, let's call it <code>Block</code>.  </p>

<p>Now one of the methods that I pull up, simplified for the example, looks like this:</p>

<pre><code>// (Block.mm)

- (void)doACommonBehaviour
{   	
      // .. does some stuff

      [self doAUniqueBehaviour];
}
</code></pre>

<p>The problem here is that <code>[self doAUniqueBehaviour]</code> is showing a warning because of course my superclass doesn't implement this method anywhere.</p>

<p>The two solutions I thought of don't sound great to me.  One is to use a protocol (the way I am currently doing it) like so:</p>

<pre><code>// (Block.mm)

- (void)doACommonBehaviour
{   	
      // .. does some stuff

      if ([self conformsToProtocol:@protocol(UniqueBehaviourProtocol)])
      {
           id&lt;UniqueBehaviourProtocol&gt; block = (id&lt;UniqueBehaviourProtocol&gt;)self;
           [block doAUniqueBehaviour];
      }
}
</code></pre>

<p>The other is to have a blank method body in my superclass (in this case there would be a lot) and just return <code>doesNotRespondToSelector</code>.</p>

<p>Something is tingling at the back of my mind that I should be using the Strategy Pattern, but I might be way off, and I haven't thought through how that would be implemented.</p>

<p>Any ideas? Thanks.</p>

<p>EDIT: I know for a fact that <code>doAUniqueBehaviour</code> will be implemented in all subclasses, it is just the implementation that will differ. </p>
","<objective-c><refactoring><patterns>","0","407","2009-12-08 12:59:23"
"1870557","Refactoring a working project","<p>Let's say you got a project that is really poorly written, contains lots of code smells, wtfs, etc. Moreover, its code structure is so complicated that it is extremely hard to add any new functionality to it. On the other hand, the project works as it is supposed to.</p>

<p>You want to refactor the project, perhaps move it to a new framework, how would you approach this problem? Will you try to build a new one from scratch or use some techniques (specify) to convert the working project into a new one?</p>

<p><hr></p>

<p>I would like to clarify the question a little bit as there is a confusion what do I mean when saying ""refactoring"".</p>

<p>I'll give an example about a car, think of it as a software project. Let's say you have built your own car. Its construction is pretty weird: engine is upside down, thus all the pipes are laid differently, electricity wires are tangled together and nobody has an idea where do they start or end, etc.</p>

<p>However, everything is working fine: you can easily ride it to shop, work, etc. However, its fuel consumption is a bit too high. Also, if you ever wanted to install new headlights to it, it would be a disaster with all the mess in the wires.</p>

<p>You cant afford buying a new one, so you have to refactor the car somehow: change engines position to normal, make the wires tidy, etc. You need to do this, because sooner or later you will need to change engine, headlights, install new stereo etc.. On the other hand, you still need something to drive you to work every morning, so you must make sure that you don't screw everything up.</p>

<p>Now let's go back to the project. How would you refactor the project as complicated as the car above, while not disturbing its primary function and purpose.</p>

<p><hr></p>

<p>I would also like to make this a community wiki. Please edit.</p>

<p>So far the main tendencies are:</p>

<ul>
<li>Don't write a new one from scratch</li>
<li>Unit test the hell out of it, then start refactoring small pieces</li>
<li>Read <a href=""http://rads.stackoverflow.com/amzn/click/0131177052"" rel=""nofollow"" title=""Working Effectively with Legacy Code (Robert C Martin) (Paperback)"">Working Effectively with Legacy Code (Robert C Martin)</a></li>
</ul>

<p>Links:</p>

<ul>
<li><a href=""http://rads.stackoverflow.com/amzn/click/0131177052"" rel=""nofollow"" title=""Working Effectively with Legacy Code (Robert C Martin) (Paperback)"">Working Effectively with Legacy Code (Robert C Martin)</a></li>
<li><a href=""http://www.joelonsoftware.com/articles/fog0000000069.html"" rel=""nofollow"">http://www.joelonsoftware.com/articles/fog0000000069.html</a></li>
<li><a href=""http://www.c2.com/cgi/wiki/wiki?RefactorLowHangingFruit"" rel=""nofollow"">Refactor the low-hanging fruit.</a></li>
</ul>
","<refactoring>","7","315","2009-12-08 23:16:53"
"1886489","Does removing an interface break code calling methods on the object?","<p>I need to do some refactoring in Java, and I need to maintain some degree of binary compatibility. In this case I want to remove some legacy interfaces, that are not used anywhere anymore and which require a rather big (and also deprecated) external dependency.</p>

<p>I have class <code>C</code> that implements interface <code>I</code>, and I have code that calls a method (declared in the interface) on an instance of <code>C</code>. The calling code knows that it is using <code>C</code>, not just the interface.</p>

<pre><code> class C implements I {
      void theMethod(){} ; // is declared in the interface I
 }

 C object;
 object.theMethod();
</code></pre>

<p>When I remove the interface from the class definition (but keep all the methods), will the calling code (which does not refer to the interface at all) still work (without a recompile)? </p>
","<java><refactoring><binary-compatibility>","2","94","2009-12-11 07:52:04"
"1889831",".NET Refactoring Tools - String to StringBuilder","<p>Is Refactor Pro the only .NET Refactoring tool that supports the String to StringBuilder refactor?</p>

<p>I'm looking for one that has a trial version of this feature to see if I like it enough to purchase. The overall goal is to tidy up another developer's VB.NET code.</p>
","<.net><vb.net><refactoring><stringbuilder><code-cleanup>","0","231","2009-12-11 18:03:20"
"1888719","Taking baby-steps in applying a better design","<p>In wanting to get some hands-on experience of good OO design I've decided to try to apply separation of concerns on a legacy app.</p>

<p>I decided that I wasn't comfortable with these calls being scattered all over the code base.</p>

<pre><code>ConfigurationManager.AppSettings[""key""]
</code></pre>

<p>While I've already tackled this before by writing a helper class to encapsulate those calls into static methods I thought it could be an opportunity to go a bit further.</p>

<p>I realise that ultimately I should be aiming to use dependency injection and always be 'coding to interfaces'. But I don't want to take what seems like too big a step. In the meantime I'd like to take smaller steps towards that ultimate goal.</p>

<blockquote>
  <p>Can anyone enumerate the steps they would recommend?</p>
</blockquote>

<p>Here are some that come to mind:</p>

<ul>
<li><p>Have client code depend on an interface not a concrete implementation</p></li>
<li><p>Manually inject dependencies into an
interface via constructor or property?</p></li>
<li><p>Before going to the effort of
choosing and applying an IoC
container how do I keep the code
running?</p></li>
<li><p>In order to fulfil a dependency the default
constructor of any class that needs a 
configuration value could use a Factory
(with a static CreateObject() method)?</p></li>
</ul>

<p>Surely I'll still have a concrete dependency on the Factory?...</p>

<p>I've dipped into <a href=""http://books.google.com/books?id=CQlRAAAAMAAJ&amp;q=working+effectively+with+legacy+code&amp;dq=working+effectively+with+legacy+code&amp;ei=RGwiS8qcPIzIyQTKpdymCw&amp;client=firefox-a&amp;cd=1"" rel=""nofollow"">Michael Feathers' book</a> so I know that I need to introduce seams but I'm struggling to know when I've introduced enough or too many!</p>

<p><strong>Update</strong></p>

<p>Imagine that Client calls methods on WidgetLoader passing it the required dependencies (such as an IConfigReader)</p>

<p>WidgetLoader reads config to find out what Widgets to load and asks WidgetFactory to create each in turn</p>

<p>WidgetFactory reads config to know what state to put the Widgets into by default</p>

<p>WidgetFactory delegates to WidgetRepository to do the data access, which reads config to decide what diagnostics it should log</p>

<blockquote>
  <p>In each case above should the IConfigReader be passed like a hot potato between each member in the call chain?</p>
  
  <p>Is a Factory the answer?</p>
</blockquote>

<p>To clarify following some comments:</p>

<p>My primary aim is to gradually migrate some app settings out of the config file and into some other form of persistence. While I realise that with an injected dependency I can <a href=""http://taswar.zeytinsoft.com/2009/03/08/extract-and-override-refactoring-technique/"" rel=""nofollow"">Extract and Override</a> to get some unit testing goodness, my primary concern is not testing so much as to encapsulate enough to begin being ignorant of where the settings actually get persisted.</p>
","<c#><configuration><refactoring><dependency-injection><separation-of-concerns>","1","213","2009-12-11 15:16:18"
"1891249","What's a pattern for getting two ""deep"" parts of a multi-threaded program talking to each other?","<p><em>I have this general problem in design, refactoring or ""triage"":</em></p>

<p>I have an existing multi-threaded C++ application which searches for data using a number of plugin libraries. With the current search interface, a given plugin receives a search string and a pointer to a QList object. Running on a different thread, the plugin goes out and searches various data sources (locally and on the web) and adds the objects of interest to the list. When the plugin returns, the main program, still on the separate thread, adds this data to the local data store (with further processing), guarding this insertion point using a mutex.  Thus each plugin can return data asynchronously. </p>

<p>The QT-base plugin library is based on message passing. There are a fair number of plugins which are already written and tested for the application and they work fairly well. </p>

<p>I would like to write some more plugins and leverage the existing application. </p>

<p>The problem is that the new plugins will need more information from the application. They will to need intermittent access to the local data store itself as they search. So to get this, they would need direct or indirect access both the hash array storing the data and the mutex which guards multiple access to the store. I assume the access would be encapsulated by adding an extra method in a ""catalog"" object.</p>

<p>I can see three ways to write these new plugins. </p>

<ol>
<li><p>When loading a plugin, pass them
a pointer to my ""catalog"" at the
start. This becomes an extra,
""invisible"" interface for the new
plugins. This seems quick, easy,
completely wrong according to OO but
I can't see what the future problems would be. </p></li>
<li><p>Add a method/message to the
existing interface so I have a
second function which could be
called for the new plugin libraries,
the message would pass a pointer to
the catalog to the plugins. This
would be easy for the plugins but it
would complicate my main code and
seems generally bad. </p></li>
<li><p>Redesign the plugin interface.
This seems ""best"" according to OO,
could have other added benefits but
would require all sorts of
rewriting.</p></li>
</ol>

<p>So, my questions are</p>

<p>A. Can anyone tell me the <em>concrete dangers</em> of option 1?</p>

<p>B. Is there a known pattern that fits this kind of problem?</p>

<p><strong>Edit1:</strong></p>

<p>A typical function for calling the plugin routines looks like:</p>

<pre><code>elsewhere(spec){
    QList&lt;CatItem&gt; results;
    plugins-&gt;getResult(spec, &amp;results);
    use_list(results);
}

...
void PluginHandler::getResults(QString* spec, QList&lt;CatItem&gt;* results)
{
    if (id-&gt;count() == 0) return;
    foreach(PluginInfo info, plugins) {
    	if (info.loaded)
    		info.obj-&gt;msg(MSG_GET_RESULTS, (void*) spec, (void*) results);
    }
}
</code></pre>

<p>It's a repeated through-out the code. I'd rather extend it than break it. </p>
","<c++><multithreading><design-patterns><refactoring><plugin-development>","2","142","2009-12-11 22:21:06"
"1898645","How can I extract the code repetition here?","<p>I am trying to extract out the common code pattern here in an extract method, but am having trouble finding the proper type for the type of Presenter.  Any help?    </p>

<pre><code>public bool CanGotoHome 
{ 
    get { return !(CurrentPresenter is IHomePresenter) &amp;&amp; IsLoggedIn; } 
}
public bool CanGotoImportanceOfAimsAndObjectives 
{ 
    get { return !(CurrentPresenter is IImportanceOfAimsAndObjectivesPresenter) &amp;&amp; IsLoggedIn; } 
}
public bool CanGotoGotoAimsAndObjectives 
{ 
    get { return !(CurrentPresenter is IAimsAndObjectivesPresenter) &amp;&amp; IsLoggedIn; } 
}
</code></pre>
","<c#><.net><refactoring><dry>","4","196","2009-12-14 02:27:02"
"1907575","Architecture of player hand in JavaScript card game","<p>So, i'm attempting simple card game. I have <code>player</code> ""class"" with <code>draw</code> function, and public members <code>deck</code> and <code>hand</code>, both are Arrays.</p>

<p>I need to draw a card from the deck, put it in hand and show it in player ""hand"" area. I'm concerned about the way I do ""flip"" and ""play"" buttons (through closures).</p>

<p>Here is the code:</p>

<pre><code>littlegame.player.prototype.draw = function() {
	if (this.canDrawCard()) {
		var card = this.deck.draw(); // this.deck is Array

		//Create card element on the playfield

		var card_object = $('&lt;div class=""card""&gt;&lt;/div&gt;').append($('&lt;span class=""attack""&gt;' + card.attack + '&lt;/span&gt;')).append($('&lt;span class=""defence""&gt;' + card.defence + '&lt;/span&gt;'));

		// Add controls to card
		if (this.playerid == 1) {
			var flipper = $('&lt;span class=""flip""&gt;Flip&lt;/span&gt;');
			flipper.click(function(){
				card.flip();
			});

			var actuator = $('&lt;span class=""play""&gt;Play&lt;/span&gt;');
			console.log('Loading actuator closure with id ' + this.playerid + ' and name ' + this.playername);
			var player = this;

			var old_hand = this.hand.slice(0); // Store a copy of old hand. Stupid trick, i know. It doesn't work

			actuator.click(function(){
				card.play(player.playerid);
				delete card;
				player.hand = old_hand;
			});

			card_object = card_object.append(flipper).append(actuator);
		}

		this.element.append(card_object);
		card.element = card_object;

		// Put card in hand
		this.hand.push(card);
	}
};
</code></pre>

<p>What i need is a way to call <code>card.play()</code> and <code>card.flip()</code> on corresponding button presses, with <code>card.play</code> knowing card position in hand, to remove the card. How can I do this?</p>
","<javascript><architecture><refactoring><refactor-my-code>","0","509","2009-12-15 13:47:26"
"1909036","Support for C++ refactoring in VS (auto-updating references and header/cpp)","<p>In Visual C# I can rename an entity at its definition, and with two clicks all references to that entity get updated. How do I do this in Visual C++? If it's not supported, is there another IDE that supports it?</p>

<p>Note that in the C++ case I also want automatic header/implementation synchronization, so I hardly ever need to do duplicate work.</p>
","<c++><visual-studio-2008><ide><refactoring><synchronization>","0","141","2009-12-15 17:27:25"
"1910003","lisp-style style `let` syntax in Python list-comprehensions","<p>Consider the following code:</p>

<pre><code>&gt;&gt;&gt; colprint([
        (name, versions[name][0].summary or '')
        for name in sorted(versions.keys())
    ])
</code></pre>

<p>What this code does is to print the elements of the dictionary <code>versions</code> in ascending order of its <code>keys</code>, but since the <code>value</code> is another sorted list, only the summary of its <em>first</em> element (the 'max') is printed.</p>

<p>Since I am familiar with <code>let</code> from lisp, I rewrote the above as:</p>

<pre><code>&gt;&gt;&gt; colprint([
        (name, package.summary or '')
        for name in sorted(versions.keys())
        for package in [versions[name][0]]
    )]
</code></pre>

<p>Do you think this violates <a href=""http://www.python.org/dev/peps/pep-0020/"" rel=""nofollow"">being Pythonic</a>? Can it be improved?</p>

<p>Note: For the curious, <code>colprint</code> is defined <a href=""http://stackoverflow.com/questions/1396820/apt-like-column-output-python-library/1397382#1397382"">here</a>.</p>
","<python><refactoring><lisp><pythonic>","4","623","2009-12-15 20:02:47"
"1911770",".Net Refactoring application to use Dependency Injection","<p>I am currently into the testing stage of a project I am working on and am having trouble bringing the main service under test in anything other than the most basic default test cases.</p>

<p>The Service is currently responsible for the creation of all sub-components, which I would like to change to use an IoC container. </p>

<p>What container should I use to refactor quickly to a simple IoC setup, all I need is to inject the componets lsited in the following constructor: </p>

<pre><code>  public DataService(string applicationFolder, string pluginFolder, 
         string persistantCacheDirectory, string settingsFolder, 
         string colorsFolder, string templatesFolder) 
 {

  _DataSourceLoaderPlugins = new DataSourceLoaderPlugins(pluginFolder, 
                                     applicationFolder, defaultConnectionString);
  _DataSourcesService = new DataSourceService(_DataSourceLoaderPlugins);

  _ChartPlugins = new ChartPlugins(pluginFolder);
  //... and about 10 more dependencies

}
</code></pre>

<p>I am new to IoC containers, and I'm not quite sure what the best framework for my basic needs is. </p>

<p>The component constructors do need some parameters from the application settings in the web.config, that will be as complicated as it gets for this project.</p>

<p>This service also needs to have singleton scope.</p>

<p>What suggestions do people have? what framework is simple, easy to setup and get under way? </p>
","<c#><refactoring><frameworks><dependency-injection><inversion-of-control>","0","155","2009-12-16 01:47:59"
"1916030","Should you wrap 3rd party libraries that you adopt into your project?","<p>A discussion I had with a colleague today.</p>

<p>He claims whenever you use a 3rd party library, you should always write for it a wrapper. So you can always change things later and accomodate things for your specific use.</p>

<p>I disagree with the word <strong>always</strong>, the discussion arose regarding log4j and I claimed that log4j has well tested and time proven API and implementation, and everything thinkable can be configured a posteriori and there is nothing you should wrap. Even if you wanted to wrap there are proven wrappers like commons-logging and log5j.</p>

<p>Another example that we touched in our discussion is Hibernate. I claimed that it has a very big API to be wrapped. Furthermore it has a layered API which lets you tweak its inside if you so need. My friend claimed that he still believes it should be wrapped but he didn't do it because of the size of the API (this co-worker is much veteran than me in our current project).</p>

<p>I claimed <a href=""http://stackoverflow.com/questions/406760/whats-your-most-controversial-programming-opinion/406775#406775"">this</a>, and that wrapping should be done in specific cases:</p>

<ul>
<li>you are not sure how the library will fit your needs</li>
<li>you will only use a small portion of a libary (in which case you may only expose a part of its API).</li>
<li>you are not sure of the quality of the library's API or implementation.</li>
</ul>

<p>I also maintained that sometimes you can wrap your code instead of the library. For example, puting your database related code in a DAO layer, instead of preemptively wrapping all of hibernate.</p>

<p>Well, in the end this is not really a question, but your insights, experiences and opinions are highly appreciated.</p>
","<library><refactoring><third-party>","14","752","2009-12-16 16:53:06"
"1916435","Simple codeigniter refactoring question -- best practice","<p>I have a quick question about refactoring php code.  Below are three functions.  The first two appear quite similar, and only differ with one if statement.  The third combines the first two through use of a flag.  Is this the best practice?  Here it seems okay to use a flag, but what if we need to add more flags in the future?  What is the best practice?  </p>

<p>Thanks.  </p>

<pre><code>function check_contact_email($email) 
{ 
  $this-&gt;db-&gt;select('COUNT(login) AS count'); 
  $this-&gt;db-&gt;from('users'); 
  $this-&gt;db-&gt;where('email', $email); 
  $query = $this-&gt;db-&gt;get(); 
  $row = $query-&gt;row(); 
  return ($row-&gt;count &gt; 0); 
} 

function check_contact_email_id($email) 
{ 
  $this-&gt;db-&gt;select('COUNT(login) AS count'); 
  $this-&gt;db-&gt;from('users'); 
  $this-&gt;db-&gt;where('email', $email); 
  $this-&gt;db-&gt;where('user_id !=', $_POST['user_id']); 
  $query = $this-&gt;db-&gt;get(); 
  $row = $query-&gt;row(); 
  return ($row-&gt;count &gt; 0); 
} 

function check_contact_email($email, $id = FALSE) 
{ 
  $this-&gt;db-&gt;select('COUNT(login) AS count'); 
  $this-&gt;db-&gt;from('users'); 
  $this-&gt;db-&gt;where('email', $email); 
  if ($id) $this-&gt;db-&gt;where('user_id !=', $_POST['user_id']); 
  $query = $this-&gt;db-&gt;get(); 
  $row = $query-&gt;row(); 
  return ($row-&gt;count &gt; 0);  
}
</code></pre>
","<codeigniter><refactoring>","0","610","2009-12-16 17:53:43"
"1916827","Why does ReSharper's ""Rename"" only sometimes display a prompt?","<p>When I rename a variable using ReSharper 4.5 (VS2008), the rename is performed inline (I specify the new variable name in the editor itself) or via a prompt (a popup window where I specify the new variable name).</p>

<p>I'm hoping someone can tell me what determines which approach is used?</p>
","<visual-studio><refactoring><resharper><rename>","2","212","2009-12-16 18:51:43"
"1916836","Good Non-Commerical (free) Refactoring Tool for Visual Studio 2005/Visual C++ 8.0?","<p>We have a rather large codebase in C++ here that needs some refactoring; <a href=""http://www.joelonsoftware.com/articles/fog0000000069.html"" rel=""nofollow"">since it's generally bad to start from scratch</a>, I was wondering if there were any good free code refactoring tools for Visual Studio 2005/Visual C++ 8.0?</p>
","<visual-c++><open-source><visual-studio-2005><refactoring><free>","1","777","2009-12-16 18:53:24"
"1918604","refactoring best practices for both PHP and Ruby on Rails","<p>Wondering if someone can suggest a refactoring 'best practice' or more ideally a ""check-list"" that we can go through and refactor against common issues.  </p>

<p>Some of these ideas were pretty good:  <a href=""http://my.safaribooksonline.com/9780321620293"" rel=""nofollow"">http://my.safaribooksonline.com/9780321620293</a></p>

<p>But looking for more.</p>

<p>Thanks.</p>
","<php><ruby-on-rails><refactoring>","0","108","2009-12-16 23:44:24"
"1920322","Visual Assist X: curly braces are moving during refactoring","<p>I use Visual Assist X, build from 05.01.2009, but the same problem occurred in the previous releases as well. (I run it on MSVS 2005)</p>

<p>When I do some refactoring (like extracting a method), everything's fine, but all the curly braces move forward. For example, before refactoring the code looked like this:</p>

<pre><code>while (expr)
{
  doSmth();
}
</code></pre>

<p>After refactoring:</p>

<pre><code>while (expr)
  {
  doSmth();
  }
</code></pre>

<p>So, I need to move manually all the brackets. Sure, the problem is minor, but it becomes annoying when you do a lot of refactoring. Is it a bug or just default settings? So, does anyone know a workaround?</p>
","<visual-studio><coding-style><visual-assist><automated-refactoring>","1","373","2009-12-17 08:51:52"
"1920661","Why does my http response body suddenly contain a load of gibberish?","<p>I'm trying to refactor an existing asp.net-mvc web application and introduce mvc-turbine.<br>
The application works as is, but I want to make it more pluggable and maintainable so future maintenance will be easier.</p>

<p>I figured I'd try to keep the refactoring steps as small as possible, so I referenced MvcTurbine, MvcTurbine.Unity and MvcTurbine.Web.<br>
Then I made my MvcApplication in global.asax.cs look like this:</p>

<pre><code>Public class MvcApplicatoin : TurbineApplication{
    static MvcApplication(){
        ServiceLocatorManager.SetLocatorProvider(() =&gt; new UnityServiceLocator());
        Application_Start();
    }
    &lt;snip of all code that hasn't changed/&gt;
}
</code></pre>

<p>I realize calling Application_Start is not how it's supposed to go, but that would keep the changes for the first step as small as possible.<br>
When I now run, I see the code in my controller gets hit and runs correctly. Then my views are being rendered. I can step through each line, no problems there either. And then the result gets shown in the browser: gibberish.<br>
������í½<code>I%&amp;/mÊ{JõJ×àt¡</code>$Ø@ìÁÍæìiG#)«*ÊeVe]f@Ìí¼÷Þ{ï½÷Þ<br>
etc, a whole page of that.</p>

<p>I didn't encounter this problem without Turbine nor did I encounter any problems in previous tests where I would introduce Turbine from the start.<br>
Any ideas on how I can start to debug this?</p>
","<c#><asp.net-mvc><refactoring><turbine>","0","201","2009-12-17 10:02:11"
"1922036","What name should I give my function? And who can I ask next time?","<p><strong>Background:</strong></p>

<p>There are a few threads on SO about how to choose names for variables and functions. It dawned up on me that there might be a use for a site where you could go and ask random people what name a particular function should have. You describe the behavior, and they come up with a name. The benefit of this, you get multiple perspectives and potentially code that is more readable to more people.</p>

<p>The other thing that dawned upon me is that SO may not be a good site for that kind of thing. Who wants to create a new SO question every time they scratch their neck trying to think of a function or variable name?</p>

<p><strong>Question:</strong></p>

<p>I have a function that does something very simple. It takes a source string and converts it into a target output. The target output is intended to be usable as a variable name or a database column name.</p>

<p>Example:</p>

<pre><code>'Customer Name' --(becomes)--&gt; 'customer_name'
</code></pre>

<p>What should I name my function? Where can I go to ask this question for the 356 other functions I want to have perfect names for?</p>

<p><strong>See also:</strong></p>

<p><a href=""http://stackoverflow.com/questions/1505880/thoughts-on-variable-function-naming-conventions"">http://stackoverflow.com/questions/1505880/thoughts-on-variable-function-naming-conventions</a> ;; <a href=""http://stackoverflow.com/questions/380458/marking-up-argument-names-in-comments-of-functions"">http://stackoverflow.com/questions/380458/marking-up-argument-names-in-comments-of-functions</a></p>
","<documentation><refactoring><coding-style><naming-conventions>","2","300","2009-12-17 14:09:10"
"1923429","strategies for managing long class files in php","<p>I've got a bunch of functions that I want to move into a class. They're currently split into a couple of fairly long files. I'd prefer not to have one 2500 line file, but as far as I can tell, you can't use include to split a class up into multiple files. In theory, I could group the functions in different classes, but they're closely related enough that I feel like they belong together, and splitting them will reduce some of the utility that I'm hoping to get from moving away from a procedural approach (with shared properties, rather than a bunch of parameters that are in nearly every function). </p>

<p>I know this is a bit vague, but any suggestions/pointers? If it matters, this is for a prototype, so ease of code management takes precedence over security and performance.</p>

<p><strong>UPDATE</strong>: Let me see if I can remove some of the vagueness:</p>

<p>This class/set of functions outputs the html for a complex form. There are many different sections and variations within each section, depending on about 5 or 6 parameters, which are currently passed into the functions. I was hoping to define the parameters once as properties of the class and then have access to them from within all of the section-creation methods. If I use sub-classes, the values of those properties won't be initialized properly, hence the desire for one class. (Hmm...  unless I define them as static. I may have just answered my own question. I'll have to look to see if there's any reason that wouldn't work.)</p>

<p>I've currently got a mess of functions like:</p>

<pre><code>get_section_A ($type='foo', $mode='bar', $read_only=false, $values_array=array()) {
    if ($this-&gt;type == 'foo') { }
    else ($this-&gt;type == 'foo') { }
}
</code></pre>

<p>So I was initially imagining something like:</p>

<pre><code>class MyForm {
    public $type;          // or maybe they'd be private or 
    public $mode;          // I'd use getters and setters 
    public $read_only;     // let's not get distracted by that :)
    public $values_array;
    // etc.

    function __constructor ($type='foo', $mode='bar', $read_only=false, $values_array=array()) {
        $this-&gt;type = $type;
        // etc.
    }

    function get_sections () {
        $result = $this-&gt;get_section_A();
        $result .= $this-&gt;get_section_B();
        $result .= $this-&gt;get_section_C();        
    }      

    function get_section_A() { 
        if ($this-&gt;type == 'foo') { }
        else { }
    }
    function get_section_B() {}
    function get_section_C() {}
    // etc. for 2500 lines
}
</code></pre>

<p>Now I'm thinking something like:</p>

<pre><code>// container class file
class MyForm {
    static $type 
    static $mode
    static $read_only
    static $values_array
    // etc.

    function __constructor ($type='foo', $mode='bar', $read_only=false, $values_array=array()) {
        MyForm::$type = $type;
        // etc.
    }

    function get_sections () {
        $result = new SectionA();
        $result .= new SectionB();
        $result .= new SectionC();
    }      
}

// section A file
class SectionA extends MyForm {
    function __constructor() { 
        if (MyForm::$type == 'foo') { }
        else { }
    }

    function __toString() {
        // return string representation of section
    }
}

// etc.
</code></pre>

<p>Or probably I need an abstract class of FormSection where the properties live. </p>

<p>Any other ideas/approaches?</p>
","<php><oop><refactoring>","2","379","2009-12-17 17:47:02"
"1922581","writing more efficient code in javascript","<p>I'm trying to write more readable and more efficient code, I've always hated if if if chains .. is it possible to write the following statement in some other more ""elegant"" way like maybe using ternary ops :</p>

<pre><code>if(text.length &lt; 1){
	if(errtext.length &gt; 1){
		errtext+=""&lt;br&gt;"";
	}
   	errors = true;
   	errtext += ""Field cannot be empty"";
}
</code></pre>

<p>Thank you</p>
","<javascript><refactoring>","1","247","2009-12-17 15:37:03"
"1924598","Is the Eclipse CDT Refactoring Project Dead?","<p>I've been over to the <a href=""http://r2.ifs.hsr.ch/cdtrefactoring/"" rel=""nofollow"">site</a> lately and nothing much seems to work (aside from the main page)</p>
","<refactoring><eclipse-cdt><automated-refactoring>","4","730","2009-12-17 21:06:09"
"1925142","best way to refactor my form (procedural to oop?)","<p>(Note: this is related to <a href=""http://stackoverflow.com/questions/1923429/"">this question</a>, but I think it could have been written more clearly, so I'm trying again -- my update only helped to a limited extent.)</p>

<p>I've inherited some code that creates a complex form with numerous sections, and lots of possible views, depending on a number of parameters. I've been working with it for a while, and finally have a chance to think about doing some re-factoring. It's currently written procedurally, with a bunch of functions that look like this:</p>

<pre><code>get_section_A ($type='foo', $mode='bar', $read_only=false, $values=array()) {
    if ($this-&gt;type == 'foo') { 
        if ($this-&gt;mode == 'bar') { }
        else { }
    } else { }
}
</code></pre>

<p>Passing around those parameters is nasty, so I've started writing a class like this:</p>

<pre><code>class MyForm {
    public $type;          // or maybe they'd be private or 
    public $mode;          // I'd use getters and setters 
    public $read_only;     // let's not get distracted by that :)
    public $values;
    // etc.

    function __constructor ($type='foo', $mode='bar', $read_only=false, $values_array=array()) {
        $this-&gt;type = $type;
        // etc.
    }

    function get_sections () {
        $result = $this-&gt;get_section_A();
        $result .= $this-&gt;get_section_B();
        $result .= $this-&gt;get_section_C();        
    }      

    function get_section_A() { 
        if ($this-&gt;type == 'foo') { }
        else { }
    }
    function get_section_B() {}
    function get_section_C() {}
    // etc.
}
</code></pre>

<p>The problem is that the procedural functions are split into a few files (for groups of sections), and if I combine them all into a single class file, I'm looking at 2500 lines, which feels unwieldy. I've thought of a few solutions:</p>

<ol>
<li>keep living with the nasty parameters and do something else with my time :)</li>
<li>live with having a 2500 line file</li>
<li>create a separate class for each group of sections that somehow ""knows"" the values of those parameters</li>
</ol>

<p>If I do #3, I've thought of two basic approaches:</p>

<ol>
<li>pass the MyForm object in as a single parameter</li>
<li>create a FormSectionGroup class with static properties that get set in MyForm, then in the group files, each class would extend FormSectionGroup and automatically have access to the current values for those parameters.</li>
</ol>

<p>1) is probably easier to set-up, and once I'm inside <code>get_section_A()</code> whether I say <code>$this-&gt;type</code> or <code>$myForm-&gt;type</code> isn't all that different, but it's not exactly OOP. (In fact, I could do that without really changing to an OOP approach.)</p>

<p>Are there other approaches? Thoughts about which is better?</p>
","<php><oop><refactoring>","4","266","2009-12-17 22:50:36"
"1935583","How do I refactor three database operations that only differ by the method call?","<p>I have three database operations like so:</p>

<pre><code>public void Add&lt;T&gt;(T entity)
{
    using (var transaction = Session.BeginTransaction())
    {
        if (entity is IEnumerable)
        {
            foreach (var item in (IEnumerable) entity)
            {
                Session.Save(item);
            }
        }
        else
        {
            Session.Save(entity);
        }

        transaction.Commit();
    }
}

public void Update&lt;T&gt;(T entity)
{
    using (var transaction = Session.BeginTransaction())
    {
        if (entity is IEnumerable)
        {
            foreach (var item in (IEnumerable) entity)
            {
                Session.Update(item);
            }
        }
        else
        {
            Session.Update(entity);
        }

        transaction.Commit();
    }
}

public void Delete&lt;T&gt;(T entity)
{
    using (var transaction = Session.BeginTransaction())
    {
        if (entity is IEnumerable)
        {
            foreach (var item in (IEnumerable)entity)
            {
                Session.Delete(item);
            }
        }
        else
        {
            Session.Delete(entity);
        }

        transaction.Commit();
    }
}
</code></pre>

<p>As you can see, the only thing that differs is the <code>Session.[something]</code> part. How would I refactor this into only one method?</p>
","<c#><nhibernate><refactoring><transactions><refactor-my-code>","0","152","2009-12-20 11:37:33"
"1935331","How can I check that I didn't break anything when refactoring?","<p>I'm about to embark on a bout of refactoring of some functions in my code.  I have a nice amount of unit tests that will ensure I didn't break anything, but I'm not sure about the coverage they give me.  Are there any tools that can analyze the code and see that the functionality remains the same?</p>

<p>I plan to refactor some rather isolated code, so I don't need to check the entire program, just the areas that I'm working on.</p>

<p>For context, the code I'm working on is in C/C++, and I work in Linux with GCC and VIM.</p>
","<c++><c><linux><gcc><refactoring>","3","235","2009-12-20 09:14:48"
"1937830","Using parameter to control Rails validations","<p>I have an <code>Event</code> model with a <code>finish_time</code> field and a form checkbox called <code>whenever</code>. When <code>whenever</code> is checked I want to set <code>finish_time</code> to <code>nil</code> regardless of its value in parameters, when <code>whenever</code> is not checked I want to make sure that <code>finish_time</code> is a valid date before I save it in the database.</p>

<p><hr></p>

<p>Currently I am achieving this using a <code>whenever</code> attr_accessor on Event:</p>

<pre><code>params[:event][:finish_time] = nil if whenever = params[:event].delete(:whenever)
@event = Event.new(params[:event])
@event.whenever = whenever
</code></pre>

<p>And using conditional validations to check for <code>finish_time</code> if <code>whenever</code> is <code>false</code></p>

<pre><code>validates_presence_of :finish_time, :unless =&gt; @whenever
</code></pre>

<p><hr></p>

<p>I am not happy with the duplication this creates. The only way that <code>finish_time</code> can be <code>nil</code> is if <code>whenever</code> is <code>true</code>, and if you change one you often have to change the other. If the <code>Event</code> is updated with a new <code>finish_time</code> then <code>whenever</code> will have to be changed to <code>false</code> as well.</p>

<p>Ideally I would like to move the validation to my controller. That way when doing direct model access <code>whenever</code> can be easily indicated by setting <code>finish_time</code> to <code>null</code>, but users posting to /events will get yelled at if they haven't indicated a choice. However I can't figure out a way to conditionally add or remove validations to <code>Event</code> from the controller or even if this is the best approach.</p>

<p>What is the best way to remove this duplication?</p>
","<ruby-on-rails><refactoring><controller><dry>","2","172","2009-12-21 02:06:49"
"1949828","Refactor this C# code to a more elegant version","<p>I am trying to refactor this code into a more elegant version. Can anyone please help. </p>

<ul>
<li>The issue is where to as sign the first evaluation result for comparision later on?</li>
<li>And I want to eliminate the use of if/switch if possible</li>
<li>Should I remove Operator class and split Eval into And and Or class, but wouldn't be too much differnt I think</li>
</ul>

<p><hr></p>

<pre><code>public interface IEval&lt;T&gt;
{
    Func&lt;T, bool&gt; Expression { get; }
    Operator Operator { get; }
    string Key { get; }
}
</code></pre>

<p><hr></p>

<pre><code>public static bool Validate&lt;T&gt;(this T o, IList&lt;IEval&lt;T&gt;&gt; conditions)
{
    var returnResult = true;
    var counter = 0;

    foreach (var condition in conditions)
    {
        var tempResult = condition.Expression(o);

        if (counter == 0) //don't like this
        {
            returnResult = tempResult;
            counter++;
        }
        else
        {
            switch (condition.Operator) //don't like this
            {
                case Operator.And:
                    returnResult &amp;= tempResult;
                    break;
                case Operator.Or:
                    returnResult |= tempResult;
                    break;
                default:
                    throw new NotImplementedException();
            }
        }
    }

    return returnResult;
}
</code></pre>

<p>Thanks!</p>

<p>Code Updated:</p>

<pre><code>public interface IEval&lt;T&gt;
{
    Func&lt;T, bool&gt; Expression { get; }
    bool Eval(bool against, T t);
}

public class AndEval&lt;T&gt; : IEval&lt;T&gt;
{
    public Func&lt;T, bool&gt; Expression { get; private set; }

    public AndEval(Func&lt;T, bool&gt; expression)
    {
        Expression = expression;
    }

    public bool Eval(bool against, T t)
    {
        return Expression.Invoke(t) &amp; against;
    }
}

public class OrEval&lt;T&gt; : IEval&lt;T&gt;
{
    public Func&lt;T, bool&gt; Expression { get; private set; }

    public OrEval(Func&lt;T, bool&gt; expression)
    {
        Expression = expression;
    }

    public bool Eval(bool against, T t)
    {
        return Expression.Invoke(t) | against;
    }
}

public static class EvalExtensions
{
    public static bool Validate&lt;T&gt;(this T t, IList&lt;IEval&lt;T&gt;&gt; conditions)
    {
        var accumulator = conditions.First().Expression(t);

        foreach (var condition in conditions.Skip(1))
        {
            accumulator = condition.Eval(accumulator, t);
        }

        return accumulator;
    }
}
</code></pre>
","<c#><refactoring>","1","364","2009-12-22 23:12:41"
"1952505","How to avoid long switch ..need help refactoring","<p>i needed help refactoring the following class,</p>

<p>Following is a class Operation with variety of Operations in switch : 
i want to avoid the switch statement.I read few articles on using polymorphism and state   pattern .but when i refactor the classes i dont get access to many variables,properties<br>
Im confused on whether to use operation as abstract class or to implement an interface.<br>
Just wanted to know which type of refactoring will help in this case<br>
polymorphism or state pattern?<br>
And when to use them?    </p>

<pre><code>public class Operation
    {
        public enum OperationType
        {
            add,
            update,
            delete,
            retrieve
        }
        public enum OperationStatus
        {
            Success,
            NotStarted,
            Error,
            Fail,
            InProcess,
            Free
        }

    // raise this event when operation completes
    public delegate void OperationNotifier(Operation operation);
    public event OperationNotifier OperationEvent=null;           

    private OperationStatus _status=OperationStatus.Free;
    public OperationStatus Status
    {
        get { return _status; }
        set { _status = value; }
    }      


    private string _fileName = null;

    public string FileName
    {
        get { return _fileName; }
        set { _fileName = value; }
    }

    private string _opnid = null;

    public string OperationId
    {
        get { return _opnid; }
        set { _opnid = value; }
    }

    private OperationType _type;
    public OperationType Type
    {
        get { return _type; }
        set { _type = value; }
    }

   public void performOperation(OperationType type, string parameters)
    {  

        switch (type)
        {
            case OperationType.add:
                _status = addOperation(parameters);                   
                break;
            case OperationType.update:
               _status = updateOperation(parameters);
                break;
            case OperationType.delete:
                _status = deleteOperation(parameters);
                break;
            case OperationType.retrieve:
                _status = retrieveOperation(parameters);
                break;
            default:
                break;
        }
        if (OperationEvent != null)
            OperationEvent(this);           
       // return true;
    }


    public OperationStatus addOperation(string parameters)
    {           
        DateTime start = DateTime.Now;
         //Do SOMETHING BIG
        TimeSpan timeTaken = DateTime.Now - start;
        System.Diagnostics.Debug.WriteLine(""addOperation:-"" + _opnid + ""-"" + _fileName + ""--"" + timeTaken.Milliseconds); 
        return OperationStatus.Success;

        }
...other operations here....
</code></pre>

<p>Calling code is similar to :</p>

<pre><code>  Operation oprnObj;
                Operation.OperationType operationType;

 oprnObj = new Operation();
 oprnObj.FileName = String.Concat(""myxmlfile"","".xml"");
 oprnObj.OperationId = oprnid;
 oprnObj.OperationEvent += new Operation.OperationNotifier(oprnObj_OperationEvent);
 operation=""add""; //get From Outside function getOperation()
 operationType = (Operation.OperationType)Enum.Parse(typeof(Operation.OperationType),   operation.ToLower(), true);
 oprnObj.Type = operationType;
 oprnObj.performOperation(operationType, parameters);
</code></pre>

<p>References Threads:<br>
<a href=""http://stackoverflow.com/questions/126409/ways-to-eliminate-switch-in-code"">Link</a><br>
<a href=""http://stackoverflow.com/questions/942481/refactoring-advice-for-big-switches-in-c"">Link</a><br>
..many more.</p>
","<design-patterns><polymorphism><switch-statement><state><refactoring>","2","638","2009-12-23 12:21:09"
"1954614","Inter-solution C# refactoring in VS","<p>I have solution A which defines public class Foo, and solution B which references A and uses Foo. I rename Foo to Bar in A and use the ""Update References"" feature, but that only updates the references in the current solution. How do I go about updating them in solution B as well (automatically)?</p>

<p>(note that search&amp;replace isn't an option, because it doesn't take context into account - there may be other symbols called Foo too)</p>
","<c#><visual-studio-2008><refactoring><solution>","0","78","2009-12-23 18:43:28"
"1963149","Ruby editing with intellisense","<p>Currently I am exploring the world of ruby. Playing around in the irb you get nice intellisense for like <code>5.&lt;tab&gt;&lt;tab&gt;</code>. I tried many editors/IDEs (mainly gedit, vim, radrails) with a couple of plugins. I kind of do not like the bloated eclipse-style environment but as far as I fount out it is the only one providing intellisense.
All I have found for gedit/vim (never tried emacs, actually I cannot remember anyone using emacs for ruby development) are plugins doing completion based on phrases in the same file.</p>

<p>Is there some intellisenselike feature for an editor? In my job I am developing PHP in Eclipse PDT but I would really like to not use a bloated IDE for ruby :)</p>
","<ruby><ide><refactoring><editor><intellisense>","2","1314","2009-12-26 11:06:42"
"1978270","Whats a good ruby idiom for breaking up a large class into modules?","<p>I have a large class with lots of methods and it's starting to get a bit unorganized and hard to navigate. I'd like to break it up into modules, where each module is a collection of class and instance methods. Perhaps something like this:</p>

<p>UPDATE: I've now realized that this is a pretty poor example. You probably wouldn't want to move validations or attributes out of the core class.</p>

<pre><code>class Large
  include Validations
  include Attributes
  include BusinessLogic
  include Callbacks
end
</code></pre>

<p>After reading Yehuda's post about <a href=""http://yehudakatz.com/2009/11/12/better-ruby-idioms/"" rel=""nofollow"">Better Ruby Idioms</a>, I'm curious how others are tackling this problem. Here's the two methods I can think of.</p>

<h2>First Method</h2>

<pre><code>module Foo
  module Validations
    module ClassMethods
      def bar
        ""bar""
      end
    end

    module InstanceMethods
      def baz
        ""baz""
      end
    end
  end

  class Large
    extend Validations::ClassMethods
    include Validations::InstanceMethods
  end
end
</code></pre>

<h2>Second Method</h2>

<pre><code>module Foo
  module Validations
    def self.included(base)
      base.extend ClassMethods
    end

    module ClassMethods
      def bar
        ""bar""
      end
    end

    def baz
      ""baz""
    end
  end

  class Base
    include Validations
  end
end
</code></pre>

<h2>My questions are:</h2>

<ul>
<li>Is there a better way to do this?</li>
<li>How do you get a one-liner module mixin for a set of class/instance methods with the least amount of magic?</li>
<li>How do you namespace these modules to the base class without namespacing the class itself?</li>
<li>How do you organize these files?</li>
</ul>
","<ruby><refactoring><module>","1","514","2009-12-30 03:32:07"
"1976587","Link error LNK2005 when trying to compile several CUDA files togheter","<p>I have a CUDA program that works fine, but that is currently all written in one file. I'd like to split this big file into several smaller ones, in order to make it easier to maintain and navigate.</p>

<p>The new structure is :</p>

<pre><code>foo.cuh
foo.cu
bar.cuh
bar.cu
main.cu
</code></pre>

<p>The <code>.cuh</code> header files contain structs and function prototypes, and the <code>.cu</code> files contain the function definitions (as usual). The main file includes <code>bar.cuh</code>, and <code>bar.cu</code> includes <code>foo.cuh</code>. All the .cu files include cutil_inline.h, in order to be able to use the CUDA functions.</p>

<p>Hence :</p>

<pre><code>// main.cu
#include ""bar.cuh""
#include &lt;cutil_inline.h&gt;

int main() [...]

// bar.cu
#include ""bar.cuh""
#include ""foo.cuh""
#include &lt;cutil_inline.h&gt;

[...]

// foo.cu
#include ""foo.cuh""
#include &lt;cutil_inline.h&gt;

[...]
</code></pre>

<p>The problem is that when I compile my Visual Studio 2008 project with this new structure, I get tons of link errors :</p>

<pre><code>error LNK2005: ""void __cdecl __cutilBankChecker(unsigned int,unsigned int,unsigned int,unsigned int,unsigned int,unsigned int,char *,int,char *,int)"" (?__cutilBankChecker@@YAXIIIIIIPADH0H@Z) already defined in cuda_generated_foo.cu.obj cuda_generated_bar.cu.obj
error LNK2005: ""void __cdecl __cutilCondition(int,char *,int)"" (?__cutilCondition@@YAXHPADH@Z) already defined in cuda_generated_foo.cu.obj cuda_generated_bar.cu.obj
error LNK2005: ""void __cdecl __cutilExit(int,char * *)"" (?__cutilExit@@YAXHPAPAD@Z) already defined in cuda_generated_foo.cu.obj    cuda_generated_bar.cu.obj
error LNK2005: ""int __cdecl cutGetMaxGflopsDeviceId(void)"" (?cutGetMaxGflopsDeviceId@@YAHXZ) already defined in cuda_generated_foo.cu.obj   cuda_generated_bar.cu.obj
error LNK2005: ""void __cdecl __cudaSafeCallNoSync(enum cudaError,char const *,int)"" (?__cudaSafeCallNoSync@@YAXW4cudaError@@PBDH@Z) already defined in cuda_generated_foo.cu.obj    cuda_generated_bar.cu.obj
error LNK2005: ""void __cdecl __cudaSafeCall(enum cudaError,char const *,int)"" (?__cudaSafeCall@@YAXW4cudaError@@PBDH@Z) already defined in cuda_generated_foo.cu.obj    cuda_generated_bar.cu.obj
error LNK2005: ""void __cdecl __cudaSafeThreadSync(char const *,int)"" (?__cudaSafeThreadSync@@YAXPBDH@Z) already defined in cuda_generated_foo.cu.obj    cuda_generated_bar.cu.obj
error LNK2005: ""void __cdecl __cufftSafeCall(enum cufftResult_t,char const *,int)"" (?__cufftSafeCall@@YAXW4cufftResult_t@@PBDH@Z) already defined in cuda_generated_foo.cu.obj  cuda_generated_bar.cu.obj
</code></pre>

<p>I understand what they mean (all those symbols already defined are part of cutil_inline.h) but I have to include this header in all files, otherwise it does not compile. What am I doing wrong ?</p>

<p>UPDATE: To clarify the situation :
 * with all code in one big file, it compiles, links and runs fine
 * with the new structure (several smaller files) and including cutil_inline.h in all .cu files, it compiles correctly but fails during linking
 * with the new structure and including cutil_inline.h only in the main file, it fails during compilation, saying that the cutil function are unknown in the files where cutil_inline.h was not included (as expected, but I had to try everything)
 - List item</p>
","<c><visual-studio-2008><refactoring><cuda><linker-error>","2","2794","2009-12-29 19:51:54"
"1980571","How could I refactor this code with performance in mind?","<p>I have a method where performance is really important (I know premature optimization is the root of all evil. I know I should and I did profile my code. In this application every tenth of a second I save is a big win.) This method uses different heuristics to generate and return elements. The heuristics are used sequentially: the first heuristic is used until it can no longer return elements, then the second heuristic is used until it can no longer return elements and so on until all heuristics have been used. On each call of the method I use a switch to move to the right heuristic. This is ugly, but work well. Here is some pseudo code</p>

<pre><code>class MyClass
{
private:
   unsigned int m_step;
public:
   MyClass() : m_step(0) {};

   Elem GetElem()
   {
      // This switch statement will be optimized as a jump table by the compiler.
      // Note that there is no break statments between the cases.
      switch (m_step)
      {
      case 0:
         if (UseHeuristic1())
         {
            m_step = 1; // Heuristic one is special it will never provide more than one element.
            return theElem;
         }

         m_step = 1;

      case 1:
         DoSomeOneTimeInitialisationForHeuristic2();
         m_step = 2;

      case 2:
         if (UseHeuristic2())
         {
            return theElem;
         }

         m_step = 3;

      case 3:
         if (UseHeuristic3())
         {
            return theElem;
         }
         m_step = 4; // But the method should not be called again
      }

      return someErrorCode;
   };
}
</code></pre>

<p>As I said, this works and it's efficient since at each call, the execution jumps right where it should. If a heuristic can't provide an element, m_step is incremented (so the next time we don't try this heuristic again) and because there is no break statement, the next heuristic is tried. Also note that some steps (like step 1) never return an element, but are one time initialization for the next heuristic.</p>

<p>The reason initializations are not all done upfront is that they might never be needed. It is always possible (and common) for GetElem to not get called again after it returned an element, even if there are still elements it could return.</p>

<p>While this is an efficient implementation, I find it really ugly. The case statement is a hack; using it without break is also hackish; the method gets really long, even if each heuristic is encapsulated in its own method.</p>

<p>How should I refactor this code so it's more readable and elegant while keeping it as efficient as possible?</p>
","<c++><algorithm><oop><refactoring>","5","471","2009-12-30 14:55:02"
"1981777","rails remove old models with migrations","<p>I have a bunch of rails models that i'm re-writing into a single model to simplify my code and reduce unnecessary tables.  </p>

<p>I'm wondering what the best way to delete a model class and its table is.  I want past migrations to still succeed, but I don't want to leave the empty models lying around.  Do I have to manually delete the old migrations that reference these models, then manually delete the class files?</p>

<p>Does anyone have any tips for the best way to do this?</p>
","<ruby-on-rails><migration><refactoring>","5","3491","2009-12-30 18:49:32"
"1985717","Is mixing constructor-based and setter-based injections a bad thing?","<p>I have a class for products import from CSV file operation which requires about 7 parameters. This is an info which is definitely needed for importer.</p>

<p>All of this parameters have the same life time. In the end we must have an <a href=""http://en.wikipedia.org/wiki/Immutable_object"" rel=""nofollow"">Immutable Object</a>.</p>

<p>I was too scared to list all of them in constructor because of its affect to readability and decided to move 3 of them to setters injection. But obviously it's not an elegant solution.</p>

<p>Questions:</p>

<p>1) Is mixing constructor-based and setter-based injections a bad practice?</p>

<p>2) How this particular problem can be solved?</p>

<p>I was thinking about applying ""Introduce Parameter Object"" refactoring by Martin Fowler, but there is a problem with this.</p>

<p>4 Parameters can be moved to Parameter object quite easily (customerId, projectId, languageId etc.) - all integers.</p>

<p>Other 3 parameters are an object I inject(it is required for Mock unit-tests).</p>
","<oop><refactoring><dependency-injection><setter>","5","204","2009-12-31 14:57:14"
"1995622","How do I implement 'Parameter Object' refactor in Python?","<p>Right now I use the parameter object's class to be inherited like so</p>

<pre><code>class A():
    def __init__(self,p1,p2):
        self.p1, self.p2 = p1, p2

class B(A):
    def __init__(self,b):
        self.p1, self.p2 = b.p1, b.p2
</code></pre>

<p>This trims up the absurdity of using the code but not the class code itself. So, I'd like to do the C++ thing and pass the parameter object to the initialization list like so</p>

<pre><code>class A { 
    int p1,p2; 
}
class B : public A { 
    B(const A&amp; a) : A(a) {} 
}
</code></pre>

<p>Can I do this in Python? Specifically, can I set the attributes of a parent class by somehow calling it's <code>__init__</code> within the child's? - from reading ""Dive into Python"" I'd guess I can do this since the object is already constructed by the time <code>__init__</code> is called. </p>

<p>Or, perhaps is there some different method of implementing the <a href=""http://www.refactoring.com/catalog/introduceParameterObject.html"" rel=""nofollow"">parameter object refactor</a> in Python (and I'm just trying to force a C++ technique)?</p>
","<python><inheritance><refactoring>","2","230","2010-01-03 17:33:26"
"1996953","Refactoring Javascript","<p>I have a lot of code in the admin area of my site that is, basically just CRUD operations using AJAX posting.</p>

<p>I was wondering if you had any tips on refactoring these type of functions either into generic functions or classes etc.</p>

<p>Here is some sample code, though a lot of this is duplicated in other functions with just different ajax parameters:</p>

<pre><code>function BindAddMenuHeaderOption() {
    $(""#AddMenuHeaderOption"").click(function (e) {
        e.preventDefault();

        var headerOptionId = jQuery.trim($(""#HeaderOptions"").val());
        var menuHeaderId = jQuery.trim($(""#MenuHeaderId"").val());

        $.ajax(
        {
            type: ""POST"",
            url: ""/Menu/AddMenuHeaderOption"",
            data: ""menuHeaderId="" + menuHeaderId + ""&amp;headerOptionId="" + headerOptionId,
            dataType: ""html"",
            success: function (result) {
                var domElement = $(result);
                $(""#ModalContent"").empty();
                $(""#ModalContent"").append(domElement);
                BindAllBehaviours();
            }
        });
    });

}

function BindAddMenuItem() {
    $("".AddMenuItem"").click(function (e) {
        e.preventDefault();

        //get header id from link by removing addmenuitem from this.id
        var currentId = $(this).attr(""id"").replace(""AddMenuItem"", """");

        //get itemnumber, itemname, itemdetails from textboxes with same header id
        var restaurantId = jQuery.trim($(""#RestaurantId"").val());
        var itemNumber = jQuery.trim($(""#ItemNumber"" + currentId).val());
        var itemName = jQuery.trim($(""#ItemName"" + currentId).val());
        var itemDetails = jQuery.trim($(""#ItemDetails"" + currentId).val());

        $.ajax(
        {
            type: ""POST"",
            url: ""/Menu/AddMenuItem"",
            data: ""reastaurantId="" + restaurantId + ""&amp;menuHeaderId="" + currentId + ""&amp;itemNumber="" + itemNumber + ""&amp;itemName="" + itemName + ""&amp;itemDetails="" + itemDetails,
            dataType: ""html"",
            success: function (result) {
                var domElement = $(result);
                $(""#MenuContainer"").replaceWith(domElement);
                var newNum = parseInt(itemNumber) + 1;
                $(""#ItemNumber"" + currentId).val(newNum);
                BindAllBehaviours();
            }
        });
    });

}

function BindUpdateMenuItem() {
    $("".UpdateMenuItem"").click(function (e) {
        e.preventDefault();


        var restaurantId = jQuery.trim($(""#RestaurantId"").val());
        var itemNumber = jQuery.trim($(""#UpdateItemNumber"").val());
        var itemName = jQuery.trim($(""#UpdateItemName"").val());
        var itemDetails = jQuery.trim($(""#UpdateItemDetails"").val());

        var vars = GetHtmlParameters($(this));

        $.ajax(
        {
            type: ""POST"",
            url: ""/Menu/UpdateMenuItem"",
            data: ""reastaurantId="" + restaurantId + ""&amp;menuItemId="" + vars[""menuItemId""] + ""&amp;itemNumber="" + itemNumber + ""&amp;itemName="" + itemName + ""&amp;itemDetails="" + itemDetails,
            dataType: ""html"",
            success: function (result) {
                var domElement = $(result);
                $(""#MenuContainer"").replaceWith(domElement);
                BindAllBehaviours();
            }
        });
    });

}
</code></pre>
","<javascript><jquery><ajax><refactoring>","0","466","2010-01-04 00:42:13"
"2004964","Refactoring a regular expression check in ruby","<p>I'm thinking there has got to be a cleaner way to check if a regular expression is not nil / is true.  This is what I have been using:
hold = (h4.text =~ /Blah/)
if !hold.nil?
  ...
end</p>

<p>I tried: !(h4.text =~ /Blah/).nil? but it did not seem to work.</p>
","<ruby><regex><refactoring>","0","93","2010-01-05 09:04:31"
"2024332","jQuery Refactoring/Maintaining","<p>I've searched a little bit around SO and haven't found any questions/answers that are helping me.  The problem is my jQuery function calls are getting much too large to maintain.  I'm wondering if I should be refactoring a lot more or if there is a better way to do all of these calls.  You'll see as I make one call, the anonymous functions that are arguments for the function end up being very large and make the readability of the code terrible.  I could in theory break all these up into their own functions but I don't know if that's a best practice or not.  Here is an example of some of the jQuery so far:</p>

<pre><code>$('#dialog').html('A TON OF HTML TO BUILD A FORM').dialog('option', 'buttons', { 'Save': function(){$.post('/use/add/', $('#use_form').serialize(), function(data){ ......There were 4 more lines of this but I'm saving you so you don't rip your eyeballs out hopefully you get the idea.....dialog('option','title','New Use').dialog('open');
</code></pre>

<p>As you can see since so many of the functions I'm calling take functions as arguments, when I create anonymous functions I end up with a huge mess (there were about 3 more anonymous function declarations in this code)</p>

<p>Should I simply make a bunch of functions and call those to make it more readable.  The only reason I'd be against this is because I'd have a bunch of functions declared that are only used once.</p>

<p>Thanks in advance for the help!</p>
","<jquery><refactoring><maintainability>","3","260","2010-01-07 22:58:50"
"2026371","Xcode refactoring error - ""The Selection Does Not Contain Identifiable Content""","<ol>
<li><p>Select a method</p>

<p><img src=""http://synapticmishap.co.uk/aSO/SelectionGrab.jpg"" alt=""Selection""></p></li>
<li><p>Edit > Refactor...</p></li>
<li><p>Select ""Move Up""</p></li>
<li><p>I get the following error a lot.</p></li>
</ol>

<p><img src=""http://synapticmishap.co.uk/aSO/RefactoringError.jpg"" alt=""Refactoring Error""></p>

<p>Any ideas on how I can get Xcode to, well, do its job?</p>

<p><strong>Solution Summary</strong></p>

<p>Option 2 that Peter suggests below did the trick. I can't believe that</p>

<p>a) I didn't try this <em>Smacks head</em></p>

<p>and </p>

<p>b)</p>

<p>Xcode couldn't find a sane way of saying ""Don't select the whole method!""</p>
","<cocoa><xcode><refactoring>","1","319","2010-01-08 08:41:04"
"2031454","Help with refactoring to an Action<T> delegate","<p>In a test method (for a Fluent NHibernate mapping, although that's not really relevant) I have the following code wrapped in a bunch of usings and try/catch blocks:</p>

<pre><code>new PersistenceSpecification&lt;Entry&gt;(session)
    .CheckProperty(e =&gt; e.Id, ""1"")
    .VerifyTheMappings();
</code></pre>

<p>I would like to refactor this so that I can pass it to a helper method (where I place the <code>using</code> and <code>try/catch</code> blocks). </p>

<p><strong>My requirements for this to work as I want it to are</strong></p>

<ol>
<li><code>session</code> needs to be provided by one of the using statements</li>
<li><code>Entry</code> should be provided as a generic parameter, so I can test mappings of various objects</li>
<li>It should be possible to replace <code>.CheckProperty(e =&gt; e.Id, ""1"").VerifyTheMappings()</code> with anything that's called on a <code>PersistenceSpecification&lt;T&gt;</code> when defining the argument (in the test method).</li>
</ol>

<p>Basically, I'd like to do something like this:</p>

<pre><code>var testAction = new PersistenceSpecification&lt;Entry&gt;(session)
                      .CheckProperty(e =&gt; e.Id, ""1"")
                      .VerifyTheMappings();

HelpTestMethod(testAction)
</code></pre>

<p>but with the above requirements satisified.</p>
","<c#><generics><refactoring>","2","108","2010-01-08 23:14:16"
"2033323","Refactoring JSP pages","<p>hi i want to take out the common content in the 2 FACES JSPS and put in one jsp and include two tabs in that FACESJSP and those two tabs will show the differet content any help with sample code pls?</p>
","<java><jsp><jsf><refactoring>","0","314","2010-01-09 12:24:56"
"2035907","Any advice for a developer given the task of enhancing & refactoring a business critical application?","<p>Recently I inherited a business critical project at work to ""enhance"".  The code has been worked on and passed through many hands over the past five years.  Consultants and full-time employees who are no longer with the company have butchered this very delicate and overly sensitive application.  Most of us have to deal with legacy code or this type of project... its part of being a developer... but...  </p>

<p>There are zero units and zero system tests.  Logic is inter-mingled (and sometimes duplicated for no reason) between stored procedures, views (yes, I said views) and code.  Documentation?  Yeah, right.
I am scared.  Yes, very sacred to make even the most minimal of ""tweak"" or refactor.  One little mishap, and there would be major income loss and potential legal issues for my employer.</p>

<p>So, any advice?  My first thought would be to begin writing assertions/unit tests against the existing code.  However, that can only go so far because there is a lot of logic embedded in stored procedures.  (I know its possible to test stored procedures, but historically its much more difficult compared to unit testing source code logic).
Another or additional approach would be to compare the database state before and after the application has performed a function, make some code changes, then do database state compare.</p>
","<unit-testing><refactoring><brownfield>","5","147","2010-01-10 02:52:42"
"2040896","How to refactor singleton methods in Ruby?","<p>Currently I have code like the following (simplified somewhat). Eventually, I've added more and more new classes like D1/D2, and I think it's time to do some refactoring to make it more elegant. The goal of course is to make adding new class Dx use as little duplicate code as possible. At least, the duplicate parts of calling <code>FileImporter.import</code> inside the singleton method <code>Dx.import</code> should be factored out.</p>

<pre><code>module FileImporter
  def self.import(main_window, viewers)
    ...
    importer = yield file  # delegate to D1/D2 for preparing the importer object
    ...
  end
end

class D1
  def self.import(main_window)
    viewers = [:V11, ]  # D1 specific viewers
    FileImporter.import(main_window, viewers) do |file|
      importer = self.new(file)
      ...  # D1 specific handling of importer
      return importer
    end
  end
end

class D2
  def self.import(main_window)
    viewers = [:V21,:v22, ]  # D2 specific viewers
    FileImporter.import(main_window, viewers) do |file|
      importer = self.new(file)
      ...  # D2 specific handling of importer
      return importer
    end
  end
end

# client code calls D1.import(...) or D2.import(...)
</code></pre>

<p>Essentially <code>FileImporter.import</code> is the common part, with <code>Dx.import</code> being the variation. I'm not sure how to refactor these singleton methods. What is the common <strong>Ruby</strong> way of doing this?</p>

<p><strong>Update</strong>: (some comments were added into code above, hopefully make my intension clearer ...)</p>

<p>Originally, I've left out code I thought not significant to avoid confusion. I should have mentioned that the code above was also the result of refactoring class D1 and D2 (by moving common part out and into module <code>FileImporter</code>). The purpose of <code>D1.import</code> and <code>D2.import</code> was mainly to create objects of proper class (and possibly followed by some class-specific handling before returning from the block). <code>FileImporter.import</code> is mainly the common logic, within which at some point would yield to specific class for generating the importer object.</p>

<p>I feel that class D1 and D2 and looks really similar and it should be possible to further refactor them. For example, they both call <code>FileImporter.import</code> to supply a block, within which both create an object of itself.</p>

<p><strong>Solution</strong>: Originally I didn't realize you could call base class's singleton methods simply by calling <code>super</code> from within derived class's corresponding singleton methods. That was really the main problem I had and was not able to go with that route. So I've accepted @makevoid answer as it indeed makes creating new derived classes more easily. </p>

<p>Using a common base class is an elegant refactoring solution, but one problem with that is all new derived classes would already use up the one base class quota. I've came to this class macro method which provides even more concise results from the derived class perspective.</p>

<pre><code>module FileImporter
  def self.included(mod)
    mod.extend ClassMethods
  end

  module ClassMethods
    def importer_viewer(*viewers, &amp;blk)
      @viewers = viewers
      @blk = blk

      class &lt;&lt; self
        def import(main_window)
          if @blk.nil?
            FileImporter.import(main_window, @viewers) do |file|
              self.new(file)
            end
          else
            FileImporter.import(main_window, @viewers, &amp;@blk)
          end      
        end
      end
    end
  end

  def self.import(main_window, viewers, multi=true)
    ...
    importer = yield file  # delegate to D1/D2 for preparing the importer object
    ...
  end
end

class D1
  include FileImporter
  importer_viewer [:V11, ] do
    ...  # D1 specific handling of importer
  end
end

class D2
  include FileImporter
  importer_viewer [:V21,:v22, ] do
    ...  # D2 specific handling of importer
  end
end
</code></pre>
","<ruby><refactoring>","2","275","2010-01-11 09:33:11"
"2045045","Determine Unused Methods and Properties","<p>I have a self-contained solution (non of the DLLs are used in any other project, so no worrying about Methods being used somewhere else).</p>

<p>I'm trying to figure out a way to determine every method/property that is not in use at all.</p>

<p>So I can't just look at private methods/properties, I need to also check Public methods and Properties.</p>

<p>I used a program in the past that did this, but only for Private Methods/Properties (things it guarantee weren't used by another project). Even if I could remember what it was, it did not meet my needs.</p>

<p>I've looked at nDepend, but not sure if this is something standard in the application, or if I will need to write a custom CQL statement for it.</p>

<p>Does anyone know of an application that does this, or if nDepend can do it, how hard it would be to do in nDepend?</p>
","<.net><refactoring><ndepend>","3","463","2010-01-11 21:22:39"
"2045353","Refactoring to remove try/catch","<p>Any ideas on a good way to refactor this so that my code acts the same, but without the whole throwing and catching my own exception?</p>

<pre><code>public Int32 ChooseNextColor(Int32 numColors)
{
    int? nextColor = null;

    while (nextColor == null)
    {
        Console.Write(""Please enter your next color selection: "");
        string input = Console.ReadLine();

        try
        {
            nextColor = Convert.ToInt32(input);
            if (nextColor &gt; numColors || nextColor &lt; 0) 
                throw new ArgumentOutOfRangeException();
        }
        catch
        {
            nextColor = null;
            Console.WriteLine(""Unrecognized input: "" + input);
            Console.WriteLine(""Please enter a value between 0 and "" + numColors + ""."");
        }
    }

    return (nextColor.Value);
}
</code></pre>

<p><strong>EDIT</strong>: The try/parse method is exactly what I am looking for.</p>

<p>In response to John's title edit -> I should have posted more information to begin with, and that would have been ""getting rid of the try/catch all together is best"".  So with that in mind, I changed the title.</p>
","<c#><exception-handling><refactoring>","4","419","2010-01-11 22:14:41"
"2048014","Structure CodeIgniter Application","<p>EDIT:</p>

<p>What is the best way to structure complex applications with CodeIgniter?  To make this question more specific, maybe to just focus on structuring controllers: If you have a Users controller, than should all functions be in this one file?  In other words, you might have controller actions that tie to specific views, but a bunch of helper functions as well.</p>

<p>ORIGINAL QUESTION:   Given a complex application, with Users, Transactions, Products, does it make sense to have a Controller for each of them?  And since each of these corresponds to a database table, to have a corresponding model for each of them?  I think it does, but an application I am currently working on consists of one 3000 line controller and one 3000 line model.  Just want to verify the standard practice regarding CI and the application structure.</p>
","<codeigniter><refactoring>","1","1084","2010-01-12 09:56:31"
"2046370","refactor dilemma","<p>I want to extract the guard statement from the following method    </p>

<pre><code>private void CreateProxy()
    {
        //extract the following guard statement.
        Host selected = this.comboBox1.SelectedItem as Host;
        if (selected == null)
        {
            return;
        }


        this.SearchProxy = ServiceProxy.ProxyFactory.CreateSearchProxy(GetSelectedIP().ToString());
        this.StreamProxy = ServiceProxy.ProxyFactory.CreatePlayerProxy(GetSelectedIP().ToString());
    }

     //extracted guard method
     public bool IsHostSelected()
     {
        Host selected = this.comboBox1.SelectedItem as Host;
        if (selected == null)
        {
            return false;
        }
        return true;
     }
</code></pre>

<p>see? now i have to add return value for the extracted method, is this kinda ugly?</p>

<p>any better solution to avoid adding the return value for the extracted method?</p>
","<refactoring>","-1","91","2010-01-12 02:45:17"
"2051577","Porting code that used SimpleXML to Dom in PHP","<p>I have a class that extends PDO to give it the ability to pull the configuration from an xml file.  Unfortunately the our hosting provider has disabled SimpleXML so I need to refactor my code to use Dom, which is available.</p>

<p>I am using the following code:</p>

<pre><code>class xmlPDO extends PDO
{
    public function __construct($xml_uri){
        $xml = simplexml_load_file($xml_uri);
        $dsn_template = ""%s:host=%s; dbname=%s"";
        $dsn = sprintf($dsn_template, $xml-&gt;dsn-&gt;driver, $xml-&gt;dsn-&gt;host, $xml-&gt;dsn-&gt;dbname);
        parent::__construct($dsn, $xml-&gt;username, $xml-&gt;password);
    }
}
</code></pre>

<p>To read the following XML:</p>

<pre><code>&lt;?xml version=""1.0"" encoding=""UTF-8""?&gt;
&lt;!DOCTYPE database [
&lt;!ELEMENT database (name, description, dsn, username, password)&gt;
    &lt;!ELEMENT name (#PCDATA)&gt;
    &lt;!ELEMENT description (#PCDATA)&gt;
    &lt;!ELEMENT dsn (driver, dbname, host)&gt;
        &lt;!ELEMENT driver (#PCDATA)&gt;
        &lt;!ELEMENT dbname (#PCDATA)&gt;
        &lt;!ELEMENT host (#PCDATA)&gt;
    &lt;!ELEMENT username (#PCDATA)&gt;
    &lt;!ELEMENT password (#PCDATA)&gt;
]&gt;

&lt;database&gt;
    &lt;name&gt;Test Database&lt;/name&gt;
    &lt;description&gt;Localhost test database, use only for testing&lt;/description&gt;
    &lt;dsn&gt;
        &lt;driver&gt;mysql&lt;/driver&gt;
        &lt;dbname&gt;test&lt;/dbname&gt;
        &lt;host&gt;localhost&lt;/host&gt;
    &lt;/dsn&gt;
    &lt;username&gt;user&lt;/username&gt;
    &lt;password&gt;test&lt;/password&gt;
&lt;/database&gt;
</code></pre>

<p>I am looking at the php.net documentation and am having a really hard time trying to figure out how I am supposed to be doing this.  I can't seem to be any clear code examples of pulling out data like this.</p>
","<php><dom><refactoring><simplexml>","1","169","2010-01-12 19:05:37"
"2052408","What compiler warnings should I switch off?","<p>I am refactoring java 1.3 legacy code, around 700 classes.
Due to the lack of generics in this code I see currently thousands of warnings, which of them should I simply disable? I don't wan't to discuss of every single warning, just a rule of thumb in terms of groups displayed in eclipses the errors/warnings dialog.</p>
","<java><eclipse><refactoring><suppress-warnings>","1","150","2010-01-12 21:10:08"
"2053319","What tools are there for suggesting potential refactorings","<p>I don't want tools for actually performing refactorings, but tools for finding and suggesting potential refactorings. Particularly tools for identifying blocks of code that are similar and could be merged into a utility functions.</p>

<p>The background here is that I've been asked to investigate reducing the code size of an embedded C system. This task seems to mostly break down into removing code that isn't needed (dead code) and merging code that is duplicated. The various lint like tools will find the dead code. But I still need a way of finding the duplicated code.</p>
","<c><refactoring>","2","99","2010-01-12 23:40:39"
"2056602","Tips on how to write refactoring-friendly unit TDD tests","<p>I've been working on an ASP.NET MVC project for about 8 months now. For the most part I've been using TDD, some aspects were covered by unit tests only after I had written the actual code. In total the project pretty has good test coverage. </p>

<p>I'm quite pleased with the results so far. Refactoring really is much easier and my tests have helped me uncover quite a few bugs even before I ran my software the first time. Also, I have developed more sophisticated fakes and helpers to help me minimize the testing code. </p>

<p>However, what I don't really like is the fact that I frequently find myself having to update existing unit tests to account for refactorings I made to the software. Refactoring the software is now quick and painless, but refactoring my unit tests is quite boring and tedious. In fact the cost of maintaining my unit tests is higher than the cost of writing them in the first place.</p>

<p>I am wondering whether I might be doing something wrong or if this relation of cost of test development vs. test maintenance is normal. I've already tried to write as many tests as possible so that these cover my user stories instead of systematically covering my object's interface as suggested in <a href=""http://stephenwalther.com/blog/archive/2009/04/11/tdd-tests-are-not-unit-tests.aspx"">this blog article</a>.</p>

<p>Also, do you have any further tips on how to write TDD tests so that refactoring breaks as few tests as possible? </p>

<p><strong>Edit:</strong> As Henning and tvanfosson correctly remarked, it's usually the setup part that is most expensive to write and maintain. Broken tests are (in my experience) usually a result of a refactoring to the domain model that is not compatible with the setup part of those tests.</p>
","<unit-testing><refactoring><tdd>","6","515","2010-01-13 12:35:25"
"2056089","Refactoring help...property-based object or lots of member fields?","<p>I'm currently refactoring a class which currently looks something like this:</p>

<pre><code> class SomeModel {
    private String displayName;
    private int id;
    private boolean editable;
    private int minimumAllowedValue;
    private int maximumAllowedValue;
    private int value;
    // etc. etc.... a bunch (10+) of other fields...

    // and then tons of setters and getters for these fields, some of the
    // setters have restrictions depending on other settings, like you can't
    // set the maximum lower than the minimum, etc.
    // ...
 }
</code></pre>

<p>My question is: is this really the best way to go or should I refactor all these fields into more of a property-based structure (with simply two methods setProperty and getProperty)?</p>

<p>Another possible refactoring would be to extract ""properties"" belonging together into classes of their own, such as the max/min structure into an ""AllowedRange"" object or something.</p>

<p>Ideas?</p>
","<java><design-patterns><refactoring><properties><refactor-my-code>","1","102","2010-01-13 11:01:31"
"2065044","Smaller Methods","<p>Following the guidelines given in ""Clean Code"" by Uncle Bob Martin, I'm trying to make my methods smaller.</p>

<p>One recommendation he gives is that methods that contain a trys should invoke other methods that don't involve the exceptional cases.</p>

<p>My problem is one of naming.</p>

<p>Usually by the time my method only contains the try expression, there's not much left and the name of the method perfectly describes what it does except for the exception.</p>

<p>What conventions do you use for naming the ""non-exceptional"" method that the exceptional one will call?</p>

<p>As an example, this is a method I'm looking at:</p>

<pre><code>private void generateAndAttachDocumentFromTemplate(File templateFile) {
  try {
    File generatedDocument = generateDocumentFromTemplate(templateFile);
    if (generatedDocument != null) {
      attachDocument(generatedDocument, container);

      attachmentsPanel.reload();

      SystemControl.openDocument(generatedDocument);
    }
  } catch (Exception ex) {
    Notifier.notifyIT(App.user().getEmail(), ex);
    Dialogs.complain(""Can\'t Generate Document"");
  }
}
</code></pre>
","<java><refactoring><methods><coding-style>","3","209","2010-01-14 15:11:56"
"2067763","rate my code: on the spot interview with startup","<p>1.5hr of coding in their smaller than by bedroom office with 4 desks lol. Afterward, while destressing at a bar, I refactored it a bit. objective was: </p>

<ul>
<li>develop a mechanism to define a schema for json objects and validate against it</li>
<li>coerce data to schema types if possible, in case an int came in as a float or str</li>
<li>develop mechanism to convert between versions of schema</li>
</ul>

<p>I googled an MIT licensed <a href=""http://code.google.com/p/jsonschema/"" rel=""nofollow"">json schema validator</a> and patched in type coercion support.</p>

<p><a href=""http://github.com/dustingetz/gcio-interview/blob/master/output.txt"" rel=""nofollow"">output.txt</a><br>
<a href=""http://github.com/dustingetz/gcio-interview/blob/master/json_validator.py"" rel=""nofollow"">json_validator.py</a><br>
<a href=""http://github.com/dustingetz/gcio-interview/commit/1f2215e864c1189b818f51cfb0a52e7dece02fb1"" rel=""nofollow"">diff of hacked library</a>  </p>

<p>Question is: How good/bad is this code sample, what improvements would you make?</p>
","<python><json><refactoring><interview-questions><startup>","1","889","2010-01-14 21:37:19"
"2070933","Refactor Exception Handling","<p>Ok i have sinned, i wrote too much code like this</p>

<pre><code>try {
   // my code
} catch (Exception ex) {
   // doesn't matter
}
</code></pre>

<p>Now i'm going to cleanup/refactor this.</p>

<p>I'm using NB 6.7 and code completion works fine on first writing, adding all Exception types, etc. Once i have done the above code NB do not give more help.</p>

<p>Do you know a way to say NB look again for all Exception types <strike>and make the proposal for handling them</strike> and do code completion again ?</p>
","<java><netbeans><exception-handling><refactoring>","4","547","2010-01-15 10:54:19"
"2075522","Refactor Ant scripts - multiple directories","<p>I have a set of databases that are built using scripts that are run using Ant.
I have the scripts for each database in a separate directory.</p>

<pre><code>root (build.xml)
 - db1 (build.xml, *.sql)
 - db2 (build.xml, *.sql)
...
</code></pre>

<p>The root build.xml has a target</p>

<pre><code>&lt;target name=""all""&gt;
 &lt;ant dir=""db1""/&gt;
 &lt;ant dir=""db2""/&gt;
 ...
&lt;/target&gt;
</code></pre>

<p>The build.xml in each of the subfolders is essentially the same but for the database name.</p>

<p>Is there a way to refactor this to one single build file that runs the sql scripts in each of the folders against the corresponding databases?</p>
","<ant><refactoring><build>","1","189","2010-01-15 23:55:59"
"2077639","How do I best combine and optimize these two queries?","<p>Here is my main query which pulls in thread information as one row, it lacks the # of votes and currently I'm pulling that in with a second query.</p>

<pre><code>SELECT   Group_concat(t.tag_name) AS `tags`,
         `p`.`thread_id`,
         `p`.`thread_name`,
         `p`.`thread_description`,
         `p`.`thread_owner_id`,
         `p`.`thread_view_count`,
         `p`.`thread_reply_count`,
         `p`.`thread_comment_count`,
         `p`.`thread_favorite_count`,
         `p`.`thread_creation_date`,
         `p`.`thread_type_id`,
         `p`.`thread_edited_date`,
         `u`.*,
         `x`.*,
         `t`.*

FROM     `shoop_posts` AS `p`
         INNER JOIN `shoop_users` AS `u`
           ON u.user_id = p.thread_owner_id
         LEFT JOIN `shoop_tags_map` AS `x`
           ON x.thread_id = p.thread_id
         LEFT JOIN `shoop_tags` AS `t`
           ON t.tag_id = x.tag_id


WHERE    (p.thread_id = '1')
GROUP BY `p`.`thread_id` 
</code></pre>

<p>My second query which pulls in the # of votes per thread:</p>

<pre><code>SELECT Sum(vote_value)
FROM   shoop_votes
       INNER JOIN shoop_vote_codes
         ON shoop_votes.vote_type = shoop_vote_codes.vote_type
WHERE  thread_id = 1
       AND shoop_votes.vote_type = 3
        OR shoop_votes.vote_type = 2 
</code></pre>

<p>A vote type of 2 is an upvote, 3 is a downvote. Here's the schema if you need it, and some sample data:</p>

<pre><code>CREATE TABLE `shoop_posts` (

  `thread_id` int(11) unsigned NOT NULL auto_increment,

  `thread_name` text,

  `thread_description` text,

  `thread_parent_id` int(11) default NULL,

  `thread_owner_id` int(11) default NULL,

  `thread_view_count` int(11) default NULL,

  `thread_reply_count` int(11) default NULL,

  `thread_comment_count` int(11) default NULL,

  `thread_favorite_count` int(11) default NULL,

  `thread_creation_date` timestamp NULL default NULL,

  `thread_type_id` int(11) default NULL,

  `thread_edited_date` timestamp NULL default NULL,

  PRIMARY KEY  (`thread_id`)

) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;



-- ----------------------------

-- Records of shoop_posts

-- ----------------------------

INSERT INTO `shoop_posts` VALUES ('1', 'Shoop that', '\r\n&lt;img class=\""image-shoop\"" src=\""\""&gt;\r\n\r\n&lt;p&gt;test:&lt;br&gt;\r\n\r\n\r\n&lt;/p&gt;', null, '2', '217', '0', '0', '0', '2010-01-10 02:06:25', '1', null);



-- ----------------------------

-- Table structure for `shoop_tags`

-- ----------------------------


CREATE TABLE `shoop_tags` (

  `tag_id` int(11) NOT NULL auto_increment,

  `tag_name` varchar(11) default NULL,

  PRIMARY KEY  (`tag_id`)

) ENGINE=MyISAM AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;



-- ----------------------------

-- Records of shoop_tags

-- ----------------------------

INSERT INTO `shoop_tags` VALUES ('1', 'mma');

INSERT INTO `shoop_tags` VALUES ('2', 'strikeforce');

INSERT INTO `shoop_tags` VALUES ('3', 'ufc');



-- ----------------------------

-- Table structure for `shoop_tags_map`

-- ----------------------------

DROP TABLE IF EXISTS `shoop_tags_map`;

CREATE TABLE `shoop_tags_map` (

  `map_id` int(11) NOT NULL auto_increment,

  `tag_id` int(11) default NULL,

  `thread_id` int(11) default NULL,

  PRIMARY KEY  (`map_id`)

) ENGINE=MyISAM AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;



-- ----------------------------

-- Records of shoop_tags_map

-- ----------------------------

INSERT INTO `shoop_tags_map` VALUES ('1', '1', '1');

INSERT INTO `shoop_tags_map` VALUES ('2', '2', '2');

INSERT INTO `shoop_tags_map` VALUES ('3', '1', '2');

INSERT INTO `shoop_tags_map` VALUES ('4', '3', '1');

INSERT INTO `shoop_tags_map` VALUES ('5', '3', '2');




-- ----------------------------

-- Table structure for `shoop_vote_codes`

-- ----------------------------


CREATE TABLE `shoop_vote_codes` (

  `vote_type` smallint(1) NOT NULL default '0',

  `vote_value` smallint(2) default NULL,

  PRIMARY KEY  (`vote_type`)

) ENGINE=MyISAM DEFAULT CHARSET=utf8;



-- ----------------------------

-- Records of shoop_vote_codes

-- ----------------------------

INSERT INTO `shoop_vote_codes` VALUES ('2', '1');

INSERT INTO `shoop_vote_codes` VALUES ('3', '-1');



-- ----------------------------

-- Table structure for `shoop_votes`

-- ----------------------------

DROP TABLE IF EXISTS `shoop_votes`;

CREATE TABLE `shoop_votes` (

  `thread_id` int(11) NOT NULL default '0',

  `user_id` int(11) NOT NULL default '0',

  `vote_type` smallint(1) NOT NULL default '0',

  PRIMARY KEY  (`thread_id`,`user_id`,`vote_type`)

) ENGINE=MyISAM DEFAULT CHARSET=utf8;



-- ----------------------------

-- Records of shoop_votes

-- ----------------------------

INSERT INTO `shoop_votes` VALUES ('1', '1', '2');

INSERT INTO `shoop_votes` VALUES ('1', '2', '2');

INSERT INTO `shoop_votes` VALUES ('1', '3', '3');
</code></pre>
","<mysql><refactoring><database-modeling>","0","52","2010-01-16 14:38:02"
"2081745","Approaching refactoring","<p>I have a very data-centric application, written in Python / PyQt. I'm planning
to do some refactoring to really separate the UI from the core, mainly because
there aren't any real tests in place yet, and that clearly has to change.</p>

<p>There is some separation already, and I think I've done quite a few things the right way, but it's far from perfect. Two examples, to show you what kind of things are bothering me:</p>

<ul>
<li><p>When the user right-clicks on the representation of a data object, the context menu
that pops up is created by the data object, although this data object (essentially the
ORM representation of a database row) should clearly have nothing to do with the UI.</p></li>
<li><p>When something is written to the database, but the write fails (e.g. because the database record is
locked by a different user), the classical ""retry / abort"" message box is presented to the user. This
dialog is created by the data provider*, although the provider should obviously not have any UI functionality.
Clearly, the provider can instead raise an exception or otherwise indicate failure, and the UI can catch
that and act accordingly.</p>

<p><sub>* that's the word I use for the object that basically represents a database table and mediates
between its data objects and the database engine; I'm not sure whether that's what is usually called
a ""provider""</sub></p></li>
</ul>

<p>I don't have experience with testing, so I don't easily ""feel"" testability problems or the like, but before I get into that, some reorganizing has to be done.</p>

<p>There is no complicated business logic involved (it's mainly just CRU<strike>D</strike>, yes, even without the D), and this would be much more reorganizing than rewriting, so I'm not really concerned about introducing regression bugs like discussed in <a href=""http://stackoverflow.com/questions/20262/refactoring-for-testability-on-an-existing-system"">this question</a>.</p>

<p>My plan is to start refactoring with the idea in mind that the UI part could easily be ripped out to be
replaced by, say, a web frontend or a text-based interface instead of the Qt interface. On the other hand,
Qt itself would still be used by the core, because the signal/slot mechanism is used in quite a few places,
e.g. data objects emit a <code>changed</code> signal to indicate, well, you know what.</p>

<p>So, my question: Is that a feasible approach to increase testability and maintainability? Any other remarks, especially with Python in mind?</p>
","<python><unit-testing><qt><refactoring><separation-of-concerns>","7","502","2010-01-17 16:50:51"
"2089608","How do I share jQuery script between pages?","<p>what is the best way to share jQuery code between pages? this is the situation:</p>

<p>-------SITUATION---------</p>

<p>I have several different pages that goes this way (pseudo code)</p>

<pre><code> &lt;% render ""content/link"" , collection =&gt; required_links %&gt;
</code></pre>

<p>In the ""content/link"" partial</p>

<pre><code> &lt;div class=""element_to_be_changed""/&gt;
</code></pre>

<p>Currently in EVERY PAGE that renders the partial, i call </p>

<pre><code> jQuery.('.element_to_be_changed')... effect that i want...
</code></pre>

<p>This strikes me as unscalable, but i am not sure what is the best way to handle it. anyone has any ideas? </p>
","<javascript><jquery><refactoring>","0","114","2010-01-18 22:11:15"
"2093531","Pimp my Perl code","<p>I'm an experienced developer, but not in Perl. I usually learn Perl to hack a script, then I forget it again until the next time. Hence I'm looking for advice from the pros.</p>

<p>This time around I'm building a series of data analysis scripts. Grossly simplified, the program structure is like this:</p>

<pre><code>01 my $config_var = 999;

03 my $result_var = 0;

05 foreach my $file (@files) {
06   open(my $fh, $file);
07   while (&lt;$fh&gt;) {
08     &amp;analyzeLine($_);
09   }
10 }

12 print ""$result_var\n"";

14 sub analyzeLine ($) {
15   my $line = shift(@_);
16   $result_var = $result_var + calculatedStuff;
17 }
</code></pre>

<p>In real life, there are up to about half a dozen different <code>config_var</code>s and <code>result_var</code>s.</p>

<p>These scripts differ mostly in the values assigned to the <code>config_var</code>s. The main loop will be the same in every case, and <code>analyzeLine()</code> will be mostly the same but could have some small variations.</p>

<p>I can accomplish my purpose by making N copies of this code, with small changes here and there; but that grossly violates all kinds of rules of good design. Ideally, I would like to write a series of scripts containing only a set of config var initializations, followed by </p>

<pre><code>do theCommonStuff;
</code></pre>

<p>Note that <code>config_var</code> (and its siblings) must be available to the common code, as must <code>result_var</code> and its lookalikes, upon which <code>analyzeLine()</code> does some calculations.</p>

<p>Should I pack my ""common"" code into a module? Create a class? Use global variables?</p>

<p>While not exactly code golf, I'm looking for a simple, compact solution that will allow me to DRY and write code only for the differences. I think I would rather not drive the code off a huge table containing all the configs, and certainly not adapt it to use a database.</p>

<p>Looking forward to your suggestions, and thanks!</p>

<hr>

<p><strong>Update</strong></p>

<p>Since people asked, here's the <em>real</em> <code>analyzeLine</code>:</p>

<pre><code># Update stats with time and call data in one line.
sub processLine ($) {
  my $line = shift(@_);
  return unless $line =~ m/$log_match/;
  # print ""$1 $2\n"";
  my ($minute, $function) = ($1, $2);
  $startMinute = $minute if not $startMinute;
  $endMinute = $minute;
  if ($minute eq $currentMinute) {
    $minuteCount = $minuteCount + 1;
  } else {
    if ($minuteCount &gt; $topMinuteCount) {
      $topMinute = $currentMinute;
      $topMinuteCount = $minuteCount;
      printf (""%40s %s : %d\n"", '', $topMinute, $topMinuteCount);
    }
    $totalMinutes = $totalMinutes + 1;
    $totalCount = $totalCount + $minuteCount;
    $currentMinute = $minute;
    $minuteCount = 1;
  }
}
</code></pre>

<p>Since these variables are largely interdependent, I think a functional solution with separate calculations won't be practical. I apologize for misleading people.</p>
","<perl><refactoring><coding-style><refactor-my-code>","4","305","2010-01-19 12:53:02"
"2094755","Suggestions on How to Migrate Website from ASP.net 1.1/2.0 to 3.5","<p>Good Morning All,
I have inherited an ASP.net website that was originally started back in 2007.  I believe that a lot of the codebase was written in version 1.1, patched to 2.0 where necessary.  The client is still not happy with some features and has requested changes to be made.  In ""peeling back the onion skin"" I found that the codebase is rather outdated.  I have asked and received approval to upgrade the entire application (website plus VB library) to ASP.net 3.5.<br>
Besides following the standard help instructions in VS 2008 and the advise of other posters on this site, can anyone direct me to specific resources to utilize in reviewing the 1.1/2.0 codebase and selecting the best 3.5 constructs that are most compatible?  Do you favor the approach of converting the codebase in VS 2008, or do you start with a clean slate and copy/paste code where necessary?  The original codebase uses Anthem and Free Textbox libraries.  Do you favor upgrading these libraries to 3.5 where available, or are there other (free) libraries that will do a better job?</p>

<p>Thanks,
Sid</p>
","<asp.net><refactoring>","1","161","2010-01-19 15:49:18"
"2099467","Javascript to compare page you are on with a link","<p>i have a menu, and i need the link for the current page i am on to be highlighted differently. I do a really twisted way of comparing strings now, but i am sure there is a smarter way?</p>

<pre><code>  jQuery(document).ready (function(){
        jQuery("".filteroptions .option"").each (function (index,ele) 
        {
                link=jQuery(ele).find(""a"").attr(""href"").toString();
                p=jQuery(window).attr(""location"").toString().search(link)
                if (p!=-1){
                        jQuery(ele).find("".link"").addClass(""current"")
                }
        });
  });
</code></pre>
","<javascript><jquery><refactoring>","0","92","2010-01-20 06:35:39"
"2100009","How to cope with bad code","<p>One of the most unpleasant (and unfortuantely most frequent) situations I am confronted with in my all day life as a developer is that I have to fix bugs or add features into code that is badly designed. Now as a good craftsman I would like to leave the code in a better state than I found it. Often new features can not be implemented if I do not refactor the design. Well - they could, but that would make the code even worse. </p>

<p>Unfortunately this is exactly what I tend to have a hard time with. I feel that if there is one thing that is hard, it is to refactor bad code, especially when you have deadlines. Touching bad and complex code that more or less works is scary. As a result I introduce even more clutter when I hack a new feature into the code without modifiying existing code.</p>

<p>Now my question is <strong>How can I learn to cope with bad code? How can I learn to understand huge codebases and then refactor parts of it without breaking stuff that already worked and without exceeding the deadline? Is there any literature you can recommend? Do you have any general tips for me?</strong></p>
","<design><refactoring>","10","376","2010-01-20 08:41:35"
"2111212","Simple refactoring example","<p>Given the following code:</p>

<pre><code>public static bool UpdateUser(string userId, 
                                      string jobTitle)
{    
        return GetProvider().UpdateUser
            (userId, jobTitle);
}
</code></pre>

<p>It needs to be changed and may not return a bool, for example:</p>

<pre><code>    UserProfile userProfile = new UserProfile();
    userProfile.Initialize(user.UserName, true);
    userProfile.ProfileJobTitle = jobTitle;
    userProfile.Save();
</code></pre>

<p>Should you ensure it does return a bool or just change the method completely?</p>

<p>What's the right approach to this type of problem?</p>
","<refactoring><coding-style>","1","233","2010-01-21 17:09:58"
"2109169","Method knows too much about methods it's calling","<p>I have a method that I want to be ""transactional"" in the abstract sense. It calls two methods that happen to do stuff with the database, but this method doesn't know that.</p>

<pre><code>public void DoOperation()
{
    using (var tx = new TransactionScope())
    {
        Method1();
        Method2();

        tc.Complete();
    }
}

public void Method1()
{
    using (var connection = new DbConnectionScope())
    {
        // Write some data here
    }
}

public void Method2()
{
    using (var connection = new DbConnectionScope())
    {
        // Update some data here
    }
}
</code></pre>

<p>Because in real terms the <code>TransactionScope</code> means that a database transaction will be used, we have an issue where it could well be promoted to a Distributed Transaction, if we get two different connections from the pool.</p>

<p>I could fix this by wrapping the <code>DoOperation()</code> method in a ConnectionScope:</p>

<pre><code>public void DoOperation()
{
    using (var tx = new TransactionScope())
    using (var connection = new DbConnectionScope())
    {
        Method1();
        Method2();

        tc.Complete();
    }
}
</code></pre>

<p><em>I made <code>DbConnectionScope</code> myself for just such a purpose, so that I don't have to pass connection objects to sub-methods (this is more contrived example than my real issue).  I got the idea from this article: <a href=""http://msdn.microsoft.com/en-us/magazine/cc300805.aspx"" rel=""nofollow"">http://msdn.microsoft.com/en-us/magazine/cc300805.aspx</a></em></p>

<p><strong>However I don't like this workaround</strong> as it means <code>DoOperation</code> now has knowledge that the methods it's calling may use a connection (and possibly a different connection each).  How could I refactor this to resolve the issue?</p>

<p><em>One idea I'm thinking of is creating a more general <code>OperationScope</code>, so that when teamed up with a custom Castle Windsor lifestyle I'll write, will mean any component requested of the container with <code>OperationScopeLifetyle</code> will always get the same instance of that component.  This does solve the problem because <code>OperationScope</code> is more ambiguous than  <code>DbConnectionScope</code>.</em></p>
","<c#><design><refactoring>","6","354","2010-01-21 12:38:02"
"2114481","How to get Resharper to show a Refactoring that it already has","<p>Whenever Resharper encounters code like this:</p>

<pre><code>(treeListNode.Tag as GridLine).AdvertiserSeparation = 5;
</code></pre>

<p>it presents you with a possible fix (since treeListNode.Tag as GridLine might be null).  It says: 'Replace with Direct Cast', which turns the code into the following:</p>

<pre><code>((GridLine) treeListNode.Tag).AdvertiserSeparation = 5;
</code></pre>

<p>This is great. However, when it encounters code like this:</p>

<pre><code>GridLine line = treeListNode.Tag as GridLine;
line.AdvertiserSeparation = 5;
</code></pre>

<p>Resharper simply displays a warning 'Possible System.NullReferenceException', but does not offer me to 'Replace with Direct Cast'.  Is there a way to make Resharper offer me this refactoring, since it already has it?</p>
","<visual-studio-2008><refactoring><resharper><directcast>","3","113","2010-01-22 02:02:17"
"2115977","Reorganize Classes into Static Libraries","<p>I am about to attempt reorganizing the way my group builds a set of large applications that share about 90% of their source files.  Right now, these applications are built without any libraries whatsoever involved except for externally linked ones that are not under our control.  The applications use the same common source files (we are not maintaining 5 versions of the same .h/.cpp files), but these are not built into any common library.  So, at the moment, we are paying the price of building the same code over-and-over per application, each time we intend to release a version.  To me, this sounds like a prime candidate for using libraries to capture the shared code and reduce build times.  I do not have the option of using DLL's, so the approach is to use static libraries.</p>

<p>I would like to know what tips you would have for how to approach this task.  I have limited experience with creating/organizing static libraries, so even the basic suggestions towards organization/gotchas are welcome.  Maybe even a good book recommendation?</p>

<p>I have done a brief exercise by finding the entire subset of files that each application share in common.  As a proof of concept, I took these files and placed them in a single ""Common Monster"" static library.  Building the full application using this single static library certainly improves the build time for all of the applications, but should I leave it at this?  The purpose of the library in this form is not very focused and seems like a lazy attempt at modularity.  There is ongoing development with these applications, and I'm afraid this setup will cause problems further down the line.</p>
","<c++><refactoring><static-libraries><organization>","1","120","2010-01-22 08:37:04"
"2117962","How to refactor a static inner class to a top level class in Eclipse?","<p>I am having trouble finding the correct refactor option for the following scenario:</p>

<p>I have code like this (in Outer.java):</p>

<pre><code>public class Outer {

    // ... class stuff

    public static class Inner {
        // ... inner class stuff   
    }
}
</code></pre>

<p>I am looking for a way to select Inner, and have it converted to a top level class, in it's own <code>.java</code> source file. I know this is pretty easy to do manually with copy/paste etc., but the inner class is referenced in a lot of places, and I would like the refactor option to handle the change everywhere it is referenced.</p>

<p>I have tried the option <code>Refactor -&gt; Extract Class...</code> but that does something weird with a field called <code>data</code> that I don't quite understand.</p>

<p>Eclipse version is 3.5.1 Galileo.</p>

<p>How do I refactor a static inner class to be a top level class?</p>

<hr>

<p>Edit: Can't believe I overlooked the option to do this. Thanks for all your correct answers, +1 to you all. I'll still need to accept an answer, so if there is any more useful info, e.g. gotchas with the script, there is still a purpose to leaving an answer.</p>
","<java><eclipse><automated-refactoring>","3","1096","2010-01-22 14:43:22"
"2118936","Cursor design and refactoring question","<p>I have many cursors that all return rows with the same fields: a numeric ID field and an XMLType field. Every time I access one of these cursors (each cursor has now got its own function for access), I go through the same pattern:</p>

<pre><code>--query behind cursor is designed to no more than one row.
for rec in c_someCursor(in_searchKey =&gt; local_search_key_value) loop
    v_id := rec.ID
    v_someXMLVar := rec.XMLDataField
end loop;

if v_someXMLVar is null then
    /* A bunch of mostly-standard error handling and logging goes here */
end if;

exception
    /* all cursor access functions have the same error-handling */
end;
</code></pre>

<p>As the pattern became more obvious, it made sense to centralize it in a single function:</p>

<pre><code>    function fn_standardCursorAccess(in_cursor in t_xmlCursorType, in_alt in XMLType) return XMLType is
            v_XMLData XMLType;
        begin
            dbms_application_info.set_module(module_name =&gt; $$PLSQL_UNIT, action_name =&gt; 'fn_standardCursorAccess');
            loop
                fetch in_cursor
                    into v_XMLData;
                exit when in_cursor%notfound;
            end loop;
            /*some additional standard processing goes here*/
            return v_XML;
        exception
        /*standard exception handling happens here*/
    end;
</code></pre>

<p>The problem I've run into is in calling this function. I now have to call it like this:</p>

<pre><code>open v_curs for select /*blah blah blah*/ where key_field = x and /*...*/;
v_data := fn_standardCursorAccess(v_curs,alt);
close v_curs;
</code></pre>

<p>What I'd like to do is call it like this:</p>

<pre><code>open v_curs for c_getSomeData(x);
v_data := fn_standardCursorAccess(v_curs,alt);
close v_curs;
</code></pre>

<p>...reason being to minimize the amount of changes to my code (I don't want to have to cut/paste all these cursors to the functions that depend on them, and in the case where multiple functions depend on the same cursor, I'll have to wrap that in a new function).</p>

<p>Unfortunately, this does not work, Oracle returns an error saying </p>

<p><code>Error: PLS-00222: no function with name 'C_GETSOMEDATA' exists in this scope</code></p>

<p>Is what I'm trying to do even possible?</p>

<p>(Oracle version is 10.2)</p>

<p><strong>EDIT:</strong> 
I think a better way to describe what I'm doing is pass a reference to an explicit cursor to a function that will perform some common routines on the data returned by the cursor.
It appears that I cannot use an open-for statement with an explcit cursor, is there any other way to get a reference to an explicit cursor so I can pass that reference to a function? Maybe there is some other way I could approach this problem?</p>

<p><strong>EDIT:</strong>
Copying and pasting from my earlier reply to R Van Rijn's reply:</p>

<p>I tried declaring the cursor in the package specification, and referencing it with the package name: open v_curs for PKG.c_getSomeData(x);... This gives me a new error, saying that PKG.c_getSomeData must be a function or array to be used that way.</p>

<p><strong>UPDATE:</strong>
I spoke to our DBA here, he says it is not possible to have a ref cursor point to an explicit cursor. It looks like I can't do this after all. Bummer. :(</p>
","<oracle><refactoring><plsql><cursor>","0","276","2010-01-22 16:59:57"
"2121258","i violated D.R.Y. help me please?","<p>I'm making a blackjack sim and I want to deal the cards how it would be in a casino,</p>

<p>i.e. all players get dealt a card, dealer gets one face down, players get another card, dealer gets one face up</p>

<p>BUT LOOK I VIOLATED DRY :(  How to redo??</p>

<pre><code>void BlackJack::newHand()
{
    resetHands();

    for (unsigned int i = 0; i &lt; players.size(); i++)
        players[i]-&gt;addCard(deck-&gt;nextCard());

    Card* c = deck-&gt;nextCard();
    c-&gt;setVisible(false); // dealer gets a face down card
    dealer-&gt;addCard(c);

    for (unsigned int i = 0; i &lt; players.size(); i++)
        players[i]-&gt;addCard(deck-&gt;nextCard());

    dealer-&gt;addCard(deck-&gt;nextCard());
}
</code></pre>
","<c++><refactoring><dry><blackjack>","2","363","2010-01-22 23:26:47"
"2122810","How to refactor Netbeans generated GUI code?","<p>I had created a GUI in Netbeans through Netbeans Swing GUI creator. So I just dragged and dropped the Swing Components from the ""palette"" window and all the code was generated by netbeans.</p>

<p>Now the code is too long to maintain (approx. 10,000 lines). So some experts on SO suggested me to refactor my code.</p>

<p>I can refactor the code that was generated by me but I don't know how to refactor the code generated by the Netbeans as It doesn't allow editing in its generated code.</p>

<p>Any suggestions?</p>
","<java><swing><netbeans><refactoring>","2","901","2010-01-23 10:23:20"
"2121901","How to recognize that short code blocks can be refactored into something cleaner?","<p>i have a bit of code that i wrote a few weeks ago (the code's purpose isn't so much important as its structure):</p>

<pre><code>if (_image.Empty)
{
   //Use the true image size if they haven't specified a custom size
   if (_glyphSize.Width &gt; 0)
      imageSize.Width = _glyphSize.Width //override
   else
      imageSize.Width = _image.GetWidth;

   if (_glyphSize.Height &gt; 0) then
      imageSize.Height = _glyphSize.Height
   else
      imageSize.Height = _image.GetHeight
}
else
{
   //No image, but they can still override it with a custom size
   if (_glyphSize.Width &gt; 0) then
      imageSize.Width = _glyphSize.Width
   else
      imageSize.Width = 0;

   if (_glyphSize.Height &gt; 0)
      imageSize.Height = _glyphSize.Height
   else
      imageSize.Height := 0;
}
</code></pre>

<p>i was going over it tonight, and as i was cleaning it up, i realized that the cleaned version is must more concise:</p>

<pre><code>//Figure out the final image width
if (_glyphSize.Width &gt; 0)
   imageSize.Width = _glyphSize.Width
else if (not _glyph.Empty)
   imageSize.Width = _glyph.GetWidth
else
   imageSize.Width = 0;

//Figure out the final image height
if (_glyphSize.Height &gt; 0)
   imageSize.Height = _glyphSize.Height
else if (not _glyph.Empty)
   imageSize.Height = _glyph.GetHeight
else
   imageSize.Height = 0;
</code></pre>

<p><strong>Note:</strong> i've trimmed down the code to bare logical flow, and obfsucated the source language.</p>

<p>In the end i took the nested <code>if</code>'s, and inverted them. Doing that allowed this shortening. My question is: how can i recognize this in the future?</p>

<p>What are the tell-tale signs that i've just written some code that can be refactored into something shorter?</p>

<hr>

<p>Another example i had from a few weeks ago was something akin to a permission check: the user can perform an action:</p>

<ul>
<li>if they have the permission they can do it</li>
<li>if they don't have the permission, but the override is in effect</li>
</ul>

<p>Which i initially coded as:</p>

<pre><code>if ((HasPermission || (!HasPermission and OverrideEnabled))
{
   ...do stuff
}
</code></pre>

<p>The logical conditions on that <code>if</code> clause seemed kind of wordy. i tried to reach back to my boolean algebra course to figure out how to simplify it. In the end i could do it, so i ended up drawing a truth table:</p>

<pre><code>Permission  Override   Result
    0           0        0
    0           1        1
    1           0        1
    1           1        1
</code></pre>

<p>Which when i look at it is an <strong>OR</strong> operation. So my <code>if</code> statement became:</p>

<pre><code>if (HasPermission  or OverrideEnabled)
{
   ...
}
</code></pre>

<p>Which is obvious and simple. And so now i'm wondering how i couldn't see that to begin with.</p>

<hr>

<p>Which brings me back to my SO question: What tell-tale signs could/should i be looking for in order to recognize that some block of code needs some TLC?</p>
","<language-agnostic><refactoring><code-cleanup>","4","117","2010-01-23 03:04:49"
"2123076","Confusion between whether a code should be executed by EDT (Event Dispatch Thread) or not?","<p>I had developed a Swing GUI which contains 12 JPanels. Initially, all the JPanels code was written in the main JFrame class code. As a result, the code became too long (10,000+ lines).</p>

<p>Now I want to refactor the code to break the code into 13 classes (12 classes each for one JPanel and 1 class for the main JFrame)instead of 1 class carrying all the code.</p>

<p>But I have some confusions which is as follows:</p>

<ol>
<li>Initially those 12 JPanels were set on a ""Card"" JPanel and the layout of the ""Card"" JPanel was set to CardLayout so that only 1 JPanel out of those 12 JPanels showed at a time based on the button on which use has clicked. Now when I have seperated those 12 JPanels from the MainJForm and implemented each of them into its own class, I think I need to instantiate a corresponding JPanel first whenever a user clicks on the button. So, would it better to do this heavy task on the EDT (Event Dispath Thread). If no, then Will it work to make a instance of the JPanel in SwingWorker thread and pass a ref. to EDT?</li>
</ol>
","<java><gui><swing><refactoring>","3","121","2010-01-23 12:06:54"
"2125527","cost to refactor on medium sized freelance projects","<p>I've been working on a freelance project for about a year.  I build a new feature every month as per client request.  Things went smoothly the first several months.  I built each new feature as a separate module.  But today, there are too many different modules for me to manage and new developers on the project are confused by the complexity of the system.  If I had enough time and money, I would re-write many of old modules and consolidate them under one super module to improve system maintenance.</p>

<p>When I compare working for a large company to working as a freelancer, it's easier to convince an experienced-supervisor of a big company than a freelance client on the costs and merits of refactoring a system.  Supervisors understand software entropy while freelance clients generally don't.  Freelance clients are prone to asking, ""But I already paid you X dollars to build the payment system.  Why do I need to pay you Y dollars to rewrite it?  Is it because you didn't do a good job?  Maybe I should hire someone else.""</p>

<p>So I suppose my problems are as follow:</p>

<p>1) I find it difficult to convince my clients of the value of my work, so I'm often underpaid.   Additionally, it makes it extremely difficult to convince clients to pay me to refactor old code.</p>

<p>2) I receive requests for new modules every month and build accordingly.  Had a I known the ""exact"" details of future modules for the next several months, perhaps I'd be able to build a more generic framework for the long haul, instead of just tacking on one module after another.   </p>

<p>3) Maybe these difficulties are the nature of freelance development and I should just accept it?</p>

<p>4) A client does not see no tangible results of refactoring.   It's difficult to sell them on something they can't see.</p>

<p>I know I'm about to ask a very broad question, but with regards to all the issues I've stated above, what can I do to make freelance life easier?</p>
","<refactoring>","5","181","2010-01-24 01:31:43"
"2128687","Refactoring Service Layer classes","<p>My company is on a Unit Testing kick, and I'm having a little trouble with refactoring Service Layer code.  Here is an example of some code I wrote:</p>

<pre><code>public class InvoiceCalculator:IInvoiceCalculator
{
   public CalculateInvoice(Invoice invoice)
   {
      foreach (InvoiceLine il in invoice.Lines)
      {
          UpdateLine(il);
      }
      //do a ton of other stuff here
   }

   private UpdateLine(InvoiceLine line)
   {
      line.Amount = line.Qty * line.Rate;
      //do a bunch of other stuff, including calls to other private methods
   }
}
</code></pre>

<p>In this simplified case (it is reduced from a 1,000 line class that has 1 public method and ~30 private ones), my boss says I should be able to test my CalculateInvoice and UpdateLine separately (UpdateLine actually calls 3 other private methods, and performs database calls as well).  But how would I do this?  His suggested refactoring seemed a little convoluted to me:</p>

<pre><code>//Tiny part of original code
public class InvoiceCalculator:IInvoiceCalculator
{
   public ILineUpdater _lineUpdater;

   public InvoiceCalculator (ILineUpdater lineUpdater)
   {
      _lineUpdater = lineUpdater;
   }

   public CalculateInvoice(Invoice invoice)
   {
      foreach (InvoiceLine il in invoice.Lines)
      {
          _lineUpdater.UpdateLine(il);
      }
      //do a ton of other stuff here
   }
}

public class LineUpdater:ILineUpdater
{
   public UpdateLine(InvoiceLine line)
   {
      line.Amount = line.Qty * line.Rate;
      //do a bunch of other stuff
   }
}
</code></pre>

<p>I can see how the dependency is now broken, and I can test both pieces, but this would also create 20-30 extra classes from my original class.  We only calculate invoices in one place, so these pieces wouldn't really be reusable.  Is this the right way to go about making this change, or would you suggest I do something different?</p>

<p>Thank you!</p>

<p>Jess</p>
","<c#><unit-testing><refactoring>","7","199","2010-01-24 20:33:26"
"2133032","What is the name of the question mark in my URL?","<p><code>http://example.com/foo.aspx?foo=bar</code></p>

<p>I'm refactoring and need to name the constant which will hold only the question mark character of this string.  I'm not sure what best to name the variable, as I've never known what the proper name of that question mark was.</p>

<p>What should I name the constant?  Or... is there something in .NET that's the wiser choice here (something built-in whose value is already that question mark -- or that builds a querystring for me automatically given a name/value pair collection)?</p>
","<.net><url><refactoring><naming><questionmark>","10","480","2010-01-25 14:47:46"
"2138157","How to validate that a Refactoring is equal to original code","<p>I'm working with legacy java code, without any Unit-Tests. Many classes need to be refactored in order to work with the project. </p>

<p>Many refactorings can be done with eclipse, and am I doing some by hand. After some refactoring I review the diff to cvs-HEAD, but i can't really feel certain that everything is 100% correct. </p>

<p>The Question: <strong>How can I validate a refactoring, that is <em>mathematical</em> identical to the previous version?</strong> I wish there were a tool, but i also accept ""basic human algorithms"" as solutions.</p>

<p><em>I know, ""run your JUnit-Tests"" is the best answer, but sadly, there aren't any in my project.</em> </p>

<p>Thank you!</p>
","<java><validation><refactoring>","12","414","2010-01-26 08:13:44"
"2142537","Automatically remove explicit package declarations with import statements in Java","<p>I have a project created by others that includes thousands of class files and has the package names explicitly typed out for every reference to any of their classes. It looks like the code was reverse engineered. Is there a good tool for Java that refactors the code so that the explicitly typed package prefixes are removed from class references and moved into import statements.</p>

<p>Thank you in advance.</p>

<p><strong>EDIT:</strong></p>

<p>I think an example will help. I want to have the imports at the top, and I don't care how many imports there are.</p>

<pre><code>javax.swing.JButton button1 = new javax.swing.JButton();
</code></pre>

<p>Imagine the code above but absolutely everywhere in thousands upon thousands of lines of code amongst thousands of class files. I would like to be able to remove all of the prefixes and just have a nice import javax.swing.JButton; at the top of each class file.</p>
","<java><eclipse><refactoring><import><packages>","15","1156","2010-01-26 20:50:50"
"2141644","Reporting Stored Procedure - How to avoid duplication?","<p>I'm writing a reporting stored procedure.  I want to get the number of non-Acknowledged and non-Invoiced Purchase Orders, with the ability to (optionally) filter on <code>CustomerID</code>.</p>

<p>What I have below works as expected, but I worry that a) it's slow and b) there's duplication in the <code>CustomerID</code> portion of the <code>WHERE</code> clause.</p>

<p>How would you write this stored proc, Stack Overflow?</p>

<pre><code>SELECT 
  (SELECT COUNT(*)
   FROM PurchaseOrder
   WHERE AcknowledgmentStatus &lt;&gt; 'Complete'
   AND (@CustID = 0 OR CustomerID = @CustID)
  ) AS NonAckd,
  (SELECT COUNT(*)
   FROM PurchaseOrder
   WHERE InvoiceStatus &lt;&gt; 'Complete'
   AND (@CustID = 0 OR CustomerID = @CustID)
  ) AS NonInvoiced
</code></pre>
","<sql><sql-server><stored-procedures><refactoring><query-optimization>","1","94","2010-01-26 18:29:28"
"2143313","In agile development how do you deal with the ""less-well-architected"" code that results from a sprint-focussed mindset","<p>I work on an agile project using Scrum.</p>

<p>Sprints have come and gone and we have fulfilled milestones successfully. The system works well enough to meet the current customer requirements. </p>

<p>However, we are left with a system in serious need of refactoring, as much of the development was performed with little eye on the future (instead the focus was on the sprint at hand).</p>

<p>How best to deal with this? Sprint(s) dedicated to refactoring?</p>
","<architecture><refactoring><agile><scrum><sprint>","12","494","2010-01-26 22:52:02"
"2156783","java: refactoring case (M and C of MVC?)","<p>I have a situation in Java where I have an external device that I want to communicate via serial I/O. I know how to do this, but I'm now in a refactoring mode to make sure I've got a maintainable software package, &amp; was looking for advice on what to do / not to do <em>at a high level</em> (specific questions below)</p>

<p>Conceptually, let's say I have a low-level <code>DeviceIOChannel</code> interface with several methods (getInputStream, getOutputStream, and some other ones for controlling connection / disconnection detection, etc.), implemented by one or more classes that handle the I/O for various data link types (RS232, TCPIP, etc). Some of my software, let's call it a <code>Device</code> class, is devoted to managing the I/O (parsing the input, constructing output, managing low-level state machines), but without knowing the details of how <code>DeviceIOChannel</code> does its thing (so I can use it with RS232 or TCPIP without having to change the <code>Device</code> class). So I'll probably pass in <code>DeviceIOChannel</code> as a parameter to <code>Device</code>'s constructor. I also would like to expose some sort of data model to the outside world.</p>

<ol>
<li>Does my partitioning of <code>DeviceIOChannel</code>  / <code>Device</code> sound right?</li>
<li><code>Device</code> needs to be doing some things actively on a worker thread. What's the best way to set this up? Should I have it create and manage its own <code>Thread</code> or <code>ScheduledExecutorService</code>? Or should I pass in a <code>ScheduledExecutorService</code> as a construction parameter?</li>
<li>any thoughts (links to good articles on the web would be ideal!) about how to whether or not the <code>Device</code> class should have a <code>startup()</code> method distinct from construction? (doing all the initialization in construction makes me nervous... seems like class instance construction should be quick, and then lengthy stuff should be reserved for an init or startup phase that comes later.) </li>
<li>What about whether to have a <code>Device</code> class with a pair of shutdown / restart methods, vs. no shutdown + requiring a new <code>Device</code> instance to be created?</li>
<li>I'm still new to MVC architecture: would it make sense to create a <code>DeviceDataModel</code> interface that <code>Device</code> implements, or should I have some separate class <code>DeviceDataModel</code> that somehow has two-way communication with the <code>Device</code> class?</li>
</ol>
","<java><architecture><refactoring>","1","112","2010-01-28 18:12:09"
"2161613","Call graph of the whole application","<p>Is there a non-toyish tool that can create a call graph of the whole application? I don't mean just getting a picture or drawing call graph by means of pointing method-by-method.</p>

<p>I need a call graph, which is accessible programmatically, i.e. the tool should flush it to a file in text mode (e.g. XML) or build the call graph in memory (which becomes problematic for large application). A call graph built in a DB would be great.</p>

<p>Both static and dynamic call graphs are in demand; though static one is a little more interesting, the fact that it is overapproximated is acceptable.</p>

<p>I have tried Soot so far. However, it is not able to handle even medium-size projects like FreeCol (java sources are available). Soot depletes 1.5GB of memory on that project, and then JVM crashes, as described here: <a href=""http://www.sable.mcgill.ca/pipermail/soot-list/2008-July/001828.html"" rel=""nofollow"">http://www.sable.mcgill.ca/pipermail/soot-list/2008-July/001828.html</a></p>

<p>Could anyone suggest a tool to generate a call graph, as described above? Java or .NET languages are ok.</p>

<p>Best regards,
Sarge</p>
","<java><.net><architecture><refactoring><reverse-engineering>","14","2804","2010-01-29 11:40:44"
"2165658","Java: Are there some tools out there which are able to refactor X[][] to List<List<X>>?","<p>I have to refactor an existing project, which is not that small. It contains a lot of arrays declarations and accesses:<br>
<em>(X is <strong>not</strong> a generic type, it's just a placeholder)</em>.<br>
declarations: <code>X[]</code> and <code>X[][]</code>,<br>
access: <code>someArray[i]</code> and <code>someArray[i][j]</code>.</p>

<p>I have to rewrite everything to use generic Lists:<br>
declaration: <code>List&lt;X&gt;</code> and <code>List&lt;List&lt;X&gt;&gt;</code>,<br>
access: <code>someList.get(i)</code> and <code>someList.get(i).get(j)</code>.</p>

<p>I couldn't find a possibility to automatize such refactoring, neither in Eclipse, nor in Netbeans (both newest versions).</p>

<p>Are there some tools available to do such refactoring?</p>

<p><strong>EDIT:</strong><br>
The project is very algorithm-oriented. Internal implementation of algorithms will not be touched. But the exposure to the external world must be changed. Most classes are made in such a way, that they only hold some result arrays or arrays of arrays.</p>
","<java><arrays><collections><refactoring><automation>","2","101","2010-01-29 22:32:00"
"2165212","How should I refactor my code in this case?","<p>I'm currently using Qt's QTextStream to read many different types (read: different extension) of text files. Each ""FileReader"" class I create starts to have a similar pattern where it needs to readLine() like this:</p>

<pre><code>// Get the line's first word as float where each word is delimited by a comma 
fileData.readLine().split("","")[0].toFloat();
</code></pre>

<p>You can imagine I have tens of these lines in my program.</p>

<p>Further, it's possible that toFloat() could fail (e.g. the value read is not convertible to float), so I'm planning to modify the above line like this:</p>

<pre><code>// Get the line's first word as float where each word is delimited by a comma 
bool convertible;
fileData.readLine().split("","")[0].toFloat(&amp;convertible);
if(!convertible) throw std::runtime_error(""Error!"");
</code></pre>

<p>Obviously, IMO, the least maintainable code would be to simply repeat the above code to every line that I use readLine(). This is definitely not the path I plan to choose. (I would welcome someone who could prove otherwise the benefits of doing so)</p>

<p>I could think of a few ways to refactor this code.</p>

<p>1) Instead of directly using Qt's QTextStream class, create my own class that owns QTextStream, and then create a method called readFirstTokenAsFloat(). Inside that method I would have error checking as shown above. Then every ""FileReader"" class would now switch to use this new class. The pros of this approach, IMO, is it accomplishes what I want to do, but the cons, IMO, is that if I were to need to do other things, or if I wanted to use other QTextStream's methods, I would violate the DRY principle (?) by duplicating the same methods, and internally just have a one-liner calling QTextStream.</p>

<p>2) OR I could just inherit from QTextStream. This way I would simply extend its functionality, and would also get all of QTextStream's functionality. But is inheritance a good idea in this case?</p>

<p>3) Any other thoughts? I'm sure someone has come across something like this. Is there a specific name for this pattern?</p>
","<qt><refactoring>","0","110","2010-01-29 21:15:35"
"2174933","C# ASP.NET Refactoring Codes | How To/ Guidelines","<p>I am facing with a huge task at hand, start re-factoring our biggest asp.net web which created from asp classic, then ported to asp.net VS2003 and then later on ported on asp.net VS2005. Where codes are old school, all business logic &amp; data access are all to be found on the .aspx.cs files. The good thing is, it is working A-Ok.</p>

<p>Now my question is, is there any guidelines on how to refactor asp.net code behind?
Such as:
 - do I need to create a separate class for the refactor codes or should I use the app_code for the new files for the refactor codes?
 - refactor code structure.. etc.</p>
","<c#><asp.net><refactoring>","2","689","2010-02-01 05:59:39"
"2177733","Is there a way to force OracleCommand.BindByName to be true by default for ODP.NET?","<p>Since the <a href=""http://msdn.microsoft.com/en-us/library/system.data.oracleclient.aspx"" rel=""nofollow"">System.Data.OracleClient</a> library has been <a href=""http://blogs.msdn.com/adonet/archive/2009/06/15/system-data-oracleclient-update.aspx"" rel=""nofollow"">deprecated</a>, we are in the process of migrating our code base to use <a href=""http://www.oracle.com/technology/tech/windows/odpnet/index.html"" rel=""nofollow"">Oracle Data Provider for .NET</a> (ODP.NET) instead. One of the issues that we have encountered is that the System.Data.OracleClient uses parameter name binding as opposed to binding by position and all of the code directly access the <a href=""http://msdn.microsoft.com/en-us/library/system.data.oracleclient.oraclecommand.aspx"" rel=""nofollow"">System.Data.OracleClient.OracleCommand</a> as opposed to using an intermediate data layer.</p>

<p>Since there is quite a bit of code, is there an easy way to force the ODP.NET OracleCommand.BindByName to be true by default, or must we go through and set the value each time that it is used? Failing at that, is there an easy way to insert that line of code in Visual Studio 2008?</p>
","<.net><oracle><refactoring><odp.net><system.data.oracleclient>","1","1553","2010-02-01 15:27:13"
"2178662","Generate Call-Tree from cscope database","<p>I want to generate Full and Partially Call Trees from cscope database of c and c++ projects in Linux.</p>

<p>The project is rather large, so it can be not easy to work with the full call tree of project, so I want to limit call tree generation with grep-like filter of function names.</p>

<p>And also I want to be able to build ""called by"" and ""called from"" sub-trees from any point.</p>

<p>So tool must be interactive and easy to patch.</p>

<p>PS:
I want use cscope database, because it is already used in project and generating of it is rather fast. I use vim editor and have X windows system.</p>

<p>There is cbrowser program on sourceforge, but its call-tree (callgraph) functionality is broken.</p>
","<c><refactoring><code-analysis><analysis><cscope>","7","1565","2010-02-01 17:23:58"
"2181444","Which function architecture is the best for maintainability in this simple case?","<p>I'm adding ""promo code"" functionality to an online shopping cart written by someone else.  This is a pretty micky mouse architecture question, but I would like to hear a couple of opinions.  All three of my ideas would work, but which do you think is best for maintainability?</p>

<p>So, here's the basic table structure for the promo codes:</p>

<pre><code>CREATE TABLE `promocodes` (
    `promocode_id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
    `promocode` VARCHAR( 255 ) NOT NULL ,
    `description` VARCHAR( 255 ) NULL ,
    `discount_percentage` INT NULL ,
    `discount_dollars` DECIMAL( 6, 2 ) NULL ,
    `expiration_date` DATE NULL ,
    `uses_remaining` INT NULL ,
    `is_active` BOOL NOT NULL DEFAULT '1'
)
</code></pre>

<p>What's the smartest (without getting overcomplicated):</p>

<p><strong>Check existence with SQL, everything else seperately in code</strong></p>

<pre><code>// LIBRARY
function promoCodeExists($promoCodeString){
  // make sql call
  return $promoCodeDetailsHash; // or false if no record
}

function isPromoCodeUsable($promoCodeDetailsHash){
  // check expiry date and number of uses left and active / inactive
}

function usePromoCode($promoCodeId){
  // do order association
  // decrement uses left
}

// USAGE 
$promoCodeDetailsHash = promoCodeExists($promoCode);
if (is_array($promoCodeDetailsHash) AND isPromoCodeUsable($promoCodeDetailsHash)){
  usePromoCode($promoCodeDetailsHash['id'])
} else {
  // invalid promo code
}
</code></pre>

<p><strong>Or, have a validation function but have it called only by the get function:</strong></p>

<pre><code>// LIBRARY
function validatePromoCode($promoCodeDetailsHash){
  // check expiry date and number of uses left and active / inactive
}

function isPromoCodeUsable($promoCodeString){
  // make sql call
  return validatePromoCode($promoCodeDetailsHash); // or false if no record
}

// USAGE 
$promoCodeDetailsHash = promoCodeExists($promoCode);
if (is_array(isPromoCodeUsable($promoCodeDetailsHash))){
  usePromoCode($promoCodeDetailsHash['id'])
} else {
  // invalid promo code
}
</code></pre>

<p><strong>Check everything in SQL with invalid the same as nonexistance:</strong></p>

<pre><code>// LIBRARY
function getDetailsForUsablePromoCode($promoCode){
  // use SQL WHERE clauses to only return existence for currently valid promo codes
  // or false if no result
}

// USAGE
$promoCodeDetailsHash = getDetailsForUsablePromoCode($promoCode)
if (is_array($promoCodeDetailsHash)){
  usePromoCode($promoCodeDetailsHash['id'])
} else {
  // error state
}
</code></pre>

<p>Feel free to point out any other approaches or wackness here.  </p>
","<php><sql><architecture><refactoring>","0","80","2010-02-02 01:59:12"
"2181901","Eliminating code duplication in a single file","<p>Sadly, a project that I have been working on lately has a large amount of copy-and-paste code, even within single files.  Are there any tools or techniques that can detect duplication or near-duplication within a single file?  I have Beyond Compare 3 and it works well for comparing separate files, but I am at a loss for comparing single files.</p>

<p>Thanks in advance.</p>

<p><strong>Edit:</strong></p>

<p>Thanks for all the great tools!  I'll definitely check them out.</p>

<p>This project is an ASP.NET/C# project, but I work with a variety of languages including Java; I'm interested in what tools are best (<strong>for any language</strong>) to remove duplication.</p>
","<refactoring><code-duplication>","8","376","2010-02-02 04:31:40"
"2187581","Why is this code slower even if the function is inlined?","<p>I have a method like this : </p>

<pre><code>bool MyFunction(int&amp; i)
{
  switch(m_step)
  {
    case 1:
       if (AComplexCondition)
       {
         i = m_i;
         return true;
       }

    case 2:
      // some code

    case 3:
      // some code
  }
}
</code></pre>

<p>Since there are lots of case statements (more than 3) and the function is becoming large, I tried to extract the code in case 1 and put it in an inline function like this:</p>

<pre><code>inline bool funct(int&amp; i)
{
  if (AComplexCondition)
  {
    i = m_i;
    return true;
  }
  return false;
}
bool MyFunction(int&amp; i)
{
  switch(m_step)
  {
    case 1:
       if (funct(i))
       {
         return true;
       }

    case 2:
      // some code

    case 3:
      // some code
  }
}
</code></pre>

<p>It seems this code is significantly slower than the original. <strong>I checked with -Winline and the function is inlined.</strong> Why is this code slower? I thought it would be equivalent. The only difference I see is there is one more conditional check in the second version, but I thought the compiler should be able to optimize it away. Right?</p>

<p><strong>edit:</strong>
Some peoples suggested that I should use gdb to stop over every assembly instructions in both versions to see the differences. I did this.</p>

<p>The first version look like this :</p>

<pre><code>mov
callq (Call to AComplexCondition())
test
je (doesn't jump)
mov (i = m_i)
movl (m_step = 1)
</code></pre>

<p>The second version, that is a bit slower seems simpler.</p>

<pre><code>movl (m_step = 1)
callq (Call to AComplexCondition())
test
je (doesn't jump)
mov (i = m_i)
xchg %ax,%ax (This is a nop I think)
</code></pre>

<p>These two version seems to do the same thing, so I still don't know why the second version is still slower.</p>
","<c++><performance><gcc><refactoring><inline>","2","345","2010-02-02 20:49:46"
"2192655","Is there a tool for refactoring SQL, a bit like a ReSharper for SQL","<p>The sort of stuff I'm after right now is quite basic:</p>

<ul>
<li>Auto format </li>
<li>Detect unused variables</li>
<li>Variable naming convention checking</li>
</ul>

<p>I wouldn't be surprised if there was a tool available that could handle more complex refactorings such as those found in <a href=""http://rads.stackoverflow.com/amzn/click/0321293533"" title=""Refactoring Databases: Evolutionary Database Design"">Refactoring Databases</a>, but I appreciate that the added complexities introduced by current db structure and data state may prevent many of them.</p>

<p>I suppose I'm after ReSQLer</p>
","<sql><sql-server><tools><refactoring>","20","1507","2010-02-03 14:37:01"
"2192766","Refactor for Speed: Convert To a Date","<p>I work for myself, I am a self-employed coder and as a result I don't have the luxury of code reviews or the ability to improve based upon peer programming. I am going to use this as an exercise to see if the StackOverflow community might help to review a simple method which i've written;</p>

<pre><code>    internal static DateTime CONVERT_To_DateTime(int binDate)
    {
        //   3/10/2008 = 1822556159
        //   2/10/2008 = 1822523391
        //   1/10/2008 = 1822490623
        //   30/09/2008 = 1822392319
        //   29/09/2008 = 1822359551

        //   September 30th 2008
        //   1822392319 = 0x6c9f7fff
        //   0x6c = 108 = 2008 (based on 1900 start date)
        //   0x9 = 9 = September
        //   0xf7fff - take top 5 bits = 0x1e = 30

        //   October 1st 2008
        //   1822490623 = 0x6ca0ffff
        //   0 x6c = 108 = 2008
        //   0 xa = 10 = October
        //   0x0ffff  - take top 5 bits = 0x01 = 1

        //   OR using Binary (used by this function)
        //   a = 1822556159 (3/10/2008)
        //   1101100 1010 00011 111111111111111

        //   b = 1822523391 (2/10/2008)
        //   1101100 1010 00010 111111111111111

        //   c = 1822490623 (1/10/2008)
        //   1101100 1010 00001 111111111111111

        //   D = 1822392319 (30/09/2008)
        //   1101100 1001 11110 111111111111111

        //   Excess 111111 are probably used for time/seconds which
        //   we do not care for at the current time

        var BaseYear = 1900;

        //  Dump the long date to binary
        var strBinary = Convert.ToString(binDate);

        //  Calculate the year
        var strBYear = strBinary.Substring(0, 7);
        var iYear = Convert.ToInt32(strBYear, 2) + BaseYear;

        //  Calculate the month
        var strBMonth = strBinary.Substring(7, 4);
        var iMonth = Convert.ToInt32(strBMonth, 2);

        //  Calculate the day
        var strBDay = strBinary.Substring(11, 5);
        var iDay = Convert.ToInt32(strBDay, 2);

        // ensure that month and day have two digits
        var strDay = iDay &lt; 10 ? ""0"" + iDay : iDay.ToString();
        var strMonth = iMonth &lt; 10 ? ""0"" + iMonth : iMonth.ToString();

        //  Build the final date
        var convertedDate = iYear + strMonth + strDay;

        return DateTime.ParseExact(convertedDate, ""yyyyMMdd"", null);
    }
</code></pre>

<p>This is a method that takes a numeric representation of a date and converts it to a DateTime DataType. I would like the method to be reviewed to acheive the fastest possible execution time because it's being executed within a loop.</p>

<p>Any comments on the method is appreciated as this will be an exercise for me. i look forward to some responses.</p>
","<c#><datetime><refactoring><binary>","5","174","2010-02-03 14:52:15"
"2194745","Rails: Refactoring, views, helpers: how does it all go together?","<p>Warning: Noob here.</p>

<p>I know this is a trivial subject but I'm having a lot of difficulty in figuring out how exactly I can simplify my views by moving parts of them into helpers. For example, I've always read that conditionals in your views are prime candidates for extraction into helpers, but I couldn't really find examples of this, and my attempts to achieve this failed.</p>

<p>For example, suppose I have:</p>

<pre><code>#index.html.erb

&lt;% for beast in @beasts do -%&gt;
  &lt;% if beast.dead? -%&gt;
    &lt;%= beast.body %&gt;
    &lt;%= link_to ""bury"", bury_beast_path( :id =&gt; beast.id ) %&gt;
  &lt;% else -%&gt;
    &lt;%= beast.body %&gt;
    &lt;%= link_to ""kill!"", kill_beast_path( :id =&gt; beast.id ) %&gt;
  &lt;% end -%&gt;
&lt;% end -%&gt;
</code></pre>

<p>It annoys me a little to have this in my view, but how exactly could I move this to a helper instead? And further simplify it, if possible. (I've read somewhere that conditionals are bad but it's just beyond me how you could program anything without them.)</p>

<p>Another example: I need to <code>id</code> my <code>body</code> tags with the format <code>controller_action</code>. The best I've got so far is this:</p>

<pre><code>#index.html.erb

&lt;body id=""&lt;%= controller_action %&gt;""&gt;
</code></pre>

<p>…and…</p>

<pre><code>#application_helper.rb

def controller_action
  @id = @controller.controller_name + ""_"" + @controller.action_name
end
</code></pre>

<p>I'm no expert, but that's still ugly even to me. </p>

<p>To make things more complicated, <a href=""http://37signals.com/svn/posts/1952-i-gave-a-talk-on-ui-fundamentals-for-programmers"" rel=""nofollow"">Ryan Singer said something I liked</a>: to treat ERB like an image tag, using helpers to ""reveal intention"". Then in the next breath saying that you should have no HTML in helpers for that is the way to hell. WTF? How are both things compatible? If it's come to the point where you can just declare behaviors in the view, surely there should be a lot of HTML to be rendered behind the scenes? I can't grasp it.</p>

<p>So, that's basically it. I'd appreciate if anyone could share some thoughts on this, or point me to some good in depth reading on the subject – which I've found to have a really weak coverage on the web. I've already googled it to exhaustion but who knows.</p>
","<ruby-on-rails><refactoring><views><helper>","7","1716","2010-02-03 19:18:02"
"2199966","Change classes in Java","<p>I have a class ImageA, and a class ImageB. The both classes represents an image in my app, but each one in a different way. Even being different, their constructors are equal, and both have the method <strong>compare</strong>.</p>

<p>So, what I done was creating a class Image, and ImageA and ImageB are subClasses of Image.</p>

<pre><code>public abstract class Image {
    protected String path;

    public Image(String path){
        this.path = path;
    }

    public abstract double compare(Image i2);
}


public class ImageA extends Image{...} 

public class ImageB extends Image{...}
</code></pre>

<p>But what I need is to test each implementation of image (ImageA and ImageB, in this case), to see the best one.</p>

<p>Is there a way to do this, changing my code at minimum? Suppose the objects used are from ImageA class, and I want to test now imageB class;</p>

<p>Obs.: </p>

<ul>
<li><p>If all imageA objects of my app are
setted by the type (ImageA i = new
ImageA()), I'd have to change
manually all in the code.</p></li>
<li><p>But even if I use the superType and
cast it (Image i = (ImageA)new
Image()), I'll have the same problem,
to change the casts.</p></li>
<li><p>My question is different from this one: <a href=""http://stackoverflow.com/questions/1456629/refactoring-abstract-java-class-with-many-child-classes"">http://stackoverflow.com/questions/1456629/refactoring-abstract-java-class-with-many-child-classes</a> . In my case, the attributes inside the child classes are different, and I keep the attributes common to these classes in the Image class.</p></li>
</ul>
","<java><inheritance><refactoring><multiple-inheritance>","1","216","2010-02-04 13:31:29"
"2215356","Is there any tool that can analyze the dependencies between variables in c# programs?","<p>There are many tools that we can use to show the dependencies between modules, source code files, classes, or functions etc. But there seems no tool for analyzing the dependencies between variables. Given a dependency graph of variables would be helpful for understanding and refactoring the code.</p>

<p>For example, if variable b is only used for calculating the value of variable c as follows:</p>

<pre><code>b = a;
....
c = b + 2;
</code></pre>

<p>Maybe we could remove variable b to make the code more readable:</p>

<pre><code>....
c = a + 2;
</code></pre>

<p>This kind of refactory may be hard if the code is very complex or has many bad smells.</p>

<p>Is there any tool that can analyze the dependencies between variables in c# or other programming languages?</p>
","<c#><variables><refactoring><dependencies><static-analysis>","5","387","2010-02-07 00:28:16"
"2215129","Can this Sql statement be refactored to NOT use RANK/PARTITION?","<p>I have the following sql statement, which works perfectly fine. I was hoping to see how this could be refactored so it doesn't require the use of RANK/PARTITION ... if possible.</p>

<pre><code>SELECT LogEntryId, FileId, CreatedOn, EventTypeId
FROM (SELECT a.LogEntryId, a.FileId, a.CreatedOn,  a.EventTypeId, 
        RANK() OVER (PARTITION BY ClientName ORDER BY a.CreatedOn DESC) AS MostRecentEventRank
    FROM LogEntries a
    WHERE (a.EventTypeId = 2 or a.EventTypeId = 4)) SubQuery
WHERE MostRecentEventRank = 1
</code></pre>

<p>What is it trying to do?</p>

<ol>
<li>Grab all the records in the table, grouped by client name and then ordered by most recently created.</li>
<li>Filter this by only event types #2 (a connection) or #4 (a disconnection).</li>
<li>Now, for each client name, retrieve the most recent record.</li>
</ol>

<p>this in effect is grabbing the most recent event (for a connection or disconnection), for each unique user in the table.</p>

<p>I do like RANK/PARTITION, but i was hoping to see if it's possible to do without using it.</p>
","<sql><sql-server><tsql><refactoring><refactor-my-code>","3","185","2010-02-06 23:16:43"
"2218994","Refactoring Fun - Prime Numbers","<p>From Uncle Bob's book Clean Code (example was in Java, so this was my first java translation), I've been playing with the refactoring example on prime numbers.  </p>

<p>The question is:   How would you refactor the following code? </p>

<p>There are 4 versions here:  UglyVersion :-) , BobVersion, PeteVersion, PeteVersionClassMember.  I'm doing this for fun, and hope you enjoy too :-)</p>

<pre><code>class ProgramBad
{
    static void Main()
    {
        int[] result = GeneratePrimes.generatePrimes(30);
        foreach (var i in result)
            Console.Write(i.ToString() + "", "");
    }
}

/// &lt;summary&gt;
/// Given an array of integers starting at 2, cross out the multiples of 2.  Fine the next
/// uncrossed integer, and cross out all of its multiples.
/// Repeat until you have passed the square root of the maximum value
/// &lt;/summary&gt;
public class GeneratePrimes
{
    public static int[] generatePrimes(int maxValue)
    {
        if (maxValue &gt;= 2) // the only valid case
        {
            // declarations
            int s = maxValue + 1; // size of the array
            bool[] f = new bool[s];
            int i;

            // initialize array to be true
            for (i = 0; i &lt; s; i++)
            {
                f[i] = true;
            }

            // get rid of non-primes
            f[0] = f[1] = false;

            //sieve
            int j;
            for (i = 2; i &lt; Math.Sqrt(s) + 1; i++)
            {
                if (f[i]) // if i is uncrossed, cross its multiples
                {
                    for (j = 2 * i; j &lt; s; j += i)
                        f[j] = false; // multiple is not a prime
                }
            }

            // how many primes are there?
            int count = 0;
            for (i = 0; i &lt; s; i++)
            {
                if (f[i])
                    count++; // bump count
            }

            int[] primes = new int[count];

            //move the primes into the result
            for (i = 0, j=0;i&lt;s ; i++)
            {
                if (f[i])
                    primes[j++] = i;
            }

            return primes; // return the primes
        } else // maxvalue &lt; 2
            return new int[0]; // return null array if bad input
    }
}
</code></pre>

<p>Bob's refactored version:</p>

<pre><code>class ProgramBob
    {
        static void Main()
        {
            int[] result = PrimeGeneratorBob.generatePrimes(30);
            foreach (var i in result)
                Console.Write(i + "", "");
        }
    }

    /// &lt;summary&gt;
    /// Generates prime number up to a user specified maximum
    /// The algorithm used is the Sieve of Eratosthenes.
    /// Given an array of integers starting at 2:
    /// Find the first uncrossed (eg 3 ) integer, and cross out all its multiples (eg 6,9,12,14)
    /// Repeat until there are no more multipes in the array
    /// &lt;/summary&gt;
    class PrimeGeneratorBob
    {
        static bool[] crossedOut;
        static int[] result;

        static public int[] generatePrimes(int maxValue)
        {
            if (maxValue &lt; 2)
                return new int[0];
            else
            {
                uncrossIntegersUpTo(maxValue);
                crossOutMultiples();
                putUncrossedIntegersIntoResult();
                return result;
            }
        }

        static void uncrossIntegersUpTo(int maxValue)
        {
            crossedOut = new bool[maxValue + 1]; // as bool array starts at 0, and if maxvalue = 10, we need an array of length 11
            for (int i = 2; i &lt; crossedOut.Length; i++) // less than as we don't want to reference crossedOut[4] which doesn't exist
                crossedOut[i] = false;
        }

        static void crossOutMultiples()
        {
            int limit = determineIterationLimit();
            for (int i = 2; i &lt;= limit; i++)
                if (notCrossed(i))
                    crossOutMultiplesOf(i);
        }

        static int determineIterationLimit()
        {
            // Every multiple in the array has a prime factor that
            // is less than or equal to the square root of the array size, 
            // which is the largest number we are trying to find primes in.
            // So we don't have to cross out numbers
            // larger than that square root of the maxnumber, as they will have been crossed out already
            double iterationLimit = Math.Sqrt(crossedOut.Length);
            return (int) iterationLimit;
        }

        static void crossOutMultiplesOf(int i)
        {
            for (int multiple = 2*i; multiple &lt; crossedOut.Length; multiple += i)
                crossedOut[multiple] = true;
        }

        static bool notCrossed(int i)
        {
            return crossedOut[i] == false;
        }

        static void putUncrossedIntegersIntoResult()
        {
            result = new int[numberOfUncrossedIntegers()];
            for (int j = 0, i = 2; i &lt; crossedOut.Length; i++)
                if (notCrossed(i))
                    result[j++] = i;
        }

        static int numberOfUncrossedIntegers()
        {
            int count = 0;
            for (int i = 2; i &lt; crossedOut.Length; i++)
                if (notCrossed(i))
                    count++;
            return count;
        }
    }
</code></pre>

<p>What I like about this is:</p>

<ul>
<li>How easy it is to get an overall feeling of how the program works eg
uncrossIntegersUpTo(maxValue);
crossOutMultiples();
putUncrossedIntegersIntoResult();</li>
</ul>

<p>I paired with a friend over the weekend, and we came up with this version:</p>

<pre><code>class PetesRefactored
{
    static void MainPete()
    {
        PrimeGeneratorPete pg = new PrimeGeneratorPete();
        int[] arrayOfPrimes = pg.generatePrimes(30);
        foreach (int prime in arrayOfPrimes)
            Console.Write(prime + "", "");
    }
}

/// &lt;summary&gt;
/// Generates prime number up to a user specified maximum
/// The algorithm used is the Sieve of Eratosthenes.
/// Given an array of integers starting at 2:
/// Find the first uncrossed (eg 3 ) integer, and cross out all its multiples (eg 6,9,12,14)
/// Repeat until there are no more multipes in the array
/// &lt;/summary&gt;
class PrimeGeneratorPete
{
    public int[] generatePrimes(int maxValue)
    {
        bool[] crossedOut;

        if (maxValue &lt; 2)
            return new int[0];
        else
        {
            crossedOut = new bool[maxValue + 1];
            uncrossIntegersUpTo(crossedOut);
            crossOutMultiples(crossedOut);
            return putUncrossedIntegersIntoResult(crossedOut);
        }
    }

    void uncrossIntegersUpTo(bool[] crossedOut)
    {
        for (int i = 2; i &lt; crossedOut.Length; i++) 
            crossedOut[i] = false;
    }

    void crossOutMultiples(bool[] crossedOut)
    {
        int limit = determineIterationLimit(crossedOut);
        for (int i = 2; i &lt;= limit; i++)
            if (!crossedOut[i])
                crossOutMultiplesOf(crossedOut, i);
    }

    int determineIterationLimit(bool[] crossedOut)
    {
        // Every multiple in the array has a prime factor that
        // is less than or equal to the square root of the array size, 
        // which is the largest number we are trying to find primes in.
        // So we don't have to cross out numbers
        // larger than that square root of the maxnumber, as they will have been crossed out already
        double iterationLimit = Math.Sqrt(crossedOut.Length);
        return (int) iterationLimit;
    }

    void crossOutMultiplesOf(bool[] crossedOut, int i)
    {
        for (int multiple = 2*i; multiple &lt; crossedOut.Length; multiple += i)
            crossedOut[multiple] = true;
    }

    int[] putUncrossedIntegersIntoResult(bool[] crossedOut)
    {
        int[] result = new int[numberOfUncrossedIntegers(crossedOut)];
        for (int j = 0, i = 2; i &lt; crossedOut.Length; i++)
            if (!crossedOut[i])
                result[j++] = i;
        return result;
    }

    int numberOfUncrossedIntegers(bool[] crossedOut)
    {
        int count = 0;
        for (int i = 2; i &lt; crossedOut.Length; i++)
            if (!crossedOut[i])
                count++;
        return count;
    }
}
</code></pre>

<p>We:</p>

<ul>
<li>Initialised crossedOut in generatePrimes method instead of ‘child’ method</li>
<li>Pass in crossedOut as a parameter instead of a class scope variable</li>
<li>Took out (defactored), the notCrossed(i) method as !crossedOut[i] is very readable inline.</li>
<li>Make everything non static</li>
</ul>

<p>And thanks to Casey and anon.</p>

<p>Here is the code with crossedOut as a class level variable.  I like this as it cuts down on some noise when passing parameters into methods.</p>

<pre><code>class PrimeGeneratorPeteClassMember
{
    bool[] crossedOut;

    public int[] generatePrimes(int maxValue)
    {
        if (maxValue &lt; 2)
            return new int[0];
        else
        {
            crossedOut = new bool[maxValue + 1];
            uncrossIntegersUpTo();
            crossOutMultiples();
            return putUncrossedIntegersIntoResult();
        }
    }

    void uncrossIntegersUpTo()
    {
        for (int i = 2; i &lt; crossedOut.Length; i++)
            crossedOut[i] = false;
    }

    void crossOutMultiples()
    {
        int limit = determineIterationLimit();
        for (int i = 2; i &lt;= limit; i++)
            if (!crossedOut[i])
                crossOutMultiplesOf(i);
    }

    int determineIterationLimit()
    {
        double iterationLimit = Math.Sqrt(crossedOut.Length);
        return (int)iterationLimit;
    }

    void crossOutMultiplesOf(int i)
    {
        for (int multiple = 2 * i; multiple &lt; crossedOut.Length; multiple += i)
            crossedOut[multiple] = true;
    }

    int[] putUncrossedIntegersIntoResult()
    {
        int[] result = new int[numberOfUncrossedIntegers()];
        for (int j = 0, i = 2; i &lt; crossedOut.Length; i++)
            if (!crossedOut[i])
                result[j++] = i;
        return result;
    }

    int numberOfUncrossedIntegers()
    {
        int count = 0;
        for (int i = 2; i &lt; crossedOut.Length; i++)
            if (!crossedOut[i])
                count++;
        return count;
    }
}
</code></pre>
","<c#><refactoring>","2","378","2010-02-08 00:38:47"
"2224102","JQuery refactoring help needed","<p>Here's my javascript code:</p>

<pre><code>&lt;script type=""text/javascript""&gt;
    $(document).ready(function() {

        var currentInput = '';
        var currentLabel = '';

        $(""#userLookup"").click(function() {
            var url = ""&lt;%= Url.Action( ""ListAll"" , ""User"") %&gt;"";
            currentInput = $(""#User"");
            currentLabel = $(""#lblUser"");
            openModal(url);
            return false;

        });

        $(""#locationLookup"").click(function() {
            var url = ""&lt;%= Url.Action( ""ListAll"" , ""Location"") %&gt;"";
            currentInput = $(""#Location"");
            currentLabel = $(""#lblLocation"");
            openModal(url);
            return false;
        });


        $("".selectable"").live(""click"", function(e){
            currentInput.val($(this).attr('id'));
            var labelText = $(this).parent().parent().find('td').eq(2).html();
            currentLabel.html(labelText);
            $.fn.colorbox.close();  
            e.preventDefault();
        });

    });

    function openModal(url){
        $.fn.colorbox({
                href:url
                , open:true
                , width: ""400px""
                , height: ""300px"" 
              });
    }
&lt;/script&gt;
</code></pre>

<p>And here's my HTML</p>

<pre><code>&lt;table width = ""100%""&gt;
     &lt;tr&gt;            
        &lt;td&gt;Asset User Id:&lt;/td&gt;
        &lt;td&gt;&lt;%= Html.TextBox(""User"", Model.User, (object)new{style = ""width:100px"", maxLength=""20""})%&gt;
            &lt;a id=""userLookup"" href=""#""&gt;Lookup User&lt;/a&gt;
        &lt;label id=""lblUser""&gt;&lt;/label&gt;
        &lt;%=Html.ValidationMessage(""User"")%&gt;&lt;/td&gt;
    &lt;/tr&gt;      
    &lt;tr&gt;            
        &lt;td&gt;Location Id:&lt;/td&gt;
        &lt;td&gt;&lt;%= Html.TextBox(""Location"", Model.Location, (object)new{style = ""width:100px"", maxLength=""20""})%&gt;
            &lt;a id=""locationLookup"" href=""#""&gt;Lookup Location&lt;/a&gt;
        &lt;label id=""lblLocation""&gt;&lt;/label&gt;
        &lt;%=Html.ValidationMessage(""Location"")%&gt;&lt;/td&gt;
    &lt;/tr&gt;         
&lt;/table&gt;
</code></pre>

<p>I have plenty of more lookup fields (which i omitted) similar to the two listed above and i was looking to see if anyone could help me come up with a cleaner/dry method of doing something like this?</p>

<p>Thanks</p>
","<asp.net><jquery><asp.net-mvc><refactoring>","2","109","2010-02-08 19:03:12"
"2225065","Is it reasonable to have a fair amount of public properties in a class?","<p>Or in more specific words, is it ""ok"" to not be relying on setters and getters?</p>

<p>I'm dealing with a class that checks the availability of rooms and sets public properties of which there are more than a dozen. Things such as:</p>

<ul>
<li>unitNumber</li>
<li>roomTypes ( array )</li>
<li>codeCorporate</li>
<li>codeGroup</li>
<li>numberKids</li>
<li>numberAdults</li>
<li>numberRooms</li>
<li>currency</li>
<li>minRate</li>
<li>maxRate</li>
<li>soapServer</li>
<li>units ( array )</li>
<li>hotelId</li>
</ul>

<p>And after an object is instantiated those properties are set with <code>$this-&gt;</code> inside various methods. However the code that deals with the object often sets public properties directly instead of using getter/setter methods:</p>

<pre><code>$object-&gt;something = 3;

foreach ($object-&gt;things as $thing ) { }
</code></pre>

<p>If I have the time to refactor this class..</p>

<ul>
<li>Should I stick all of these properties in a data array that's a private property, and define <code>__set</code> and <code>__get</code> methods?</li>
<li>Should I make a single getter method for each of the properties?</li>
</ul>
","<php><class><refactoring><class-design>","12","304","2010-02-08 21:40:00"
"2223657","help me ""dry"" out this .net XML serialization code","<p>I have a base collection class and a child collection class, each of which are serializable.  In a test, I discovered that simply having the child class's <code>ReadXml</code> method call <code>base.ReadXml</code> resulted in an <code>InvalidCastException</code> later on.  First, here's the class structure:</p>

<p><strong>Base Class</strong></p>

<pre><code>// Collection of Row objects
[Serializable]
[XmlRoot(""Rows"")]
public class Rows : IList&lt;Row&gt;, ICollection&lt;Row&gt;, IEnumerable&lt;Row&gt;,
    IEquatable&lt;Rows&gt;, IXmlSerializable
{
    public Collection&lt;Row&gt; Collection { get; protected set; }

    public void ReadXml(XmlReader reader)
    {
        reader.ReadToFollowing(XmlNodeName);
        do
        {
            using (XmlReader rowReader = reader.ReadSubtree())
            {
                var row = new Row();
                row.ReadXml(rowReader);
                Collection.Add(row);
            }
        } while (reader.ReadToNextSibling(XmlNodeName));
    }
}
</code></pre>

<p><strong>Derived Class</strong></p>

<pre><code>// Acts as a collection of SpecificRow objects, which inherit from Row.  Uses the same
// Collection&lt;Row&gt; that Rows defines which is fine since SpecificRow : Row.
[Serializable]
[XmlRoot(""MySpecificRowList"")]
public class SpecificRows : Rows, IXmlSerializable
{
    public new void ReadXml(XmlReader reader)
    {
        // Trying to just do base.ReadXml(reader) causes a cast exception later
        reader.ReadToFollowing(XmlNodeName);
        do
        {
            using (XmlReader rowReader = reader.ReadSubtree())
            {
                var row = new SpecificRow();
                row.ReadXml(rowReader);
                Collection.Add(row);
            }
        } while (reader.ReadToNextSibling(XmlNodeName));
    }

    public new Row this[int index]
    {
        // The cast in this getter is what causes InvalidCastException if I try
        // to call base.ReadXml from this class's ReadXml
        get { return (Row)Collection[index]; }
        set { Collection[index] = value; }
    }
}
</code></pre>

<p>And here's the code that causes a runtime InvalidCastException <em>if</em> I do not use the version of <code>ReadXml</code> shown in <code>SpecificRows</code> above (i.e., I get the exception if I just call <code>base.ReadXml</code> from within <code>SpecificRows.ReadXml</code>):</p>

<pre><code>TextReader reader = new StringReader(serializedResultStr);
SpecificRows deserializedResults = (SpecificRows)xs.Deserialize(reader);
SpecificRow = deserializedResults[0]; // this throws InvalidCastException
</code></pre>

<p>So, the code above all compiles and runs exception-free, but it bugs me that <code>Rows.ReadXml</code> and <code>SpecificRows.ReadXml</code> are essentially the same code.  The value of <code>XmlNodeName</code> and the <code>new Row()</code>/<code>new SpecificRow()</code> are the differences.  How would you suggest I extract out all the common functionality of both versions of <code>ReadXml</code>?  Would it be silly to create some generic class just for one method?  Sorry for the lengthy code samples, I just wanted to provide the reason I can't simply call <code>base.ReadXml</code> from within <code>SpecificRows</code>.</p>
","<c#><refactoring><xml-serialization><dry>","1","336","2010-02-08 17:49:59"
"2232806","How do I disable automatic save after refactoring in Eclipse?","<p>When I ran the Inline and Extract Local Variable refactorings, Eclipse saved my file immediately after.  Also, Undoing/Redoing these refactorings resaved the file each time.  How can I disable this behavior?</p>

<p>Secondary question:  Running Extract Method <em>didn&#8217;t</em> automatically save the file.   Why the inconsistent behavior?</p>
","<eclipse><refactoring><autosave>","1","499","2010-02-09 21:51:47"
"2234287","Which tools can help in translating (as in french -> english and not C++ -> java) source code?","<p>I have some code that is written in french, that is the variables, class, function all have french names. The comments are also in french. I'd like to translate the code to english. This will be quite a challenge, since it's a 18K lines project and I'd like to know if there is any tool that could help me, especially with the variables/class/function names, since it will be error prone to rename them all.</p>

<p>Is there any tools that can help me? Advices?</p>

<p>edit : I'm not looking for machine translation. I'm looking for a tool that would help me translate the code. Let's say there is class name C and this class has a method named TraverserLaRue and I rename it CrossTheRoad I'd like all references to TraverserLaRue in all files to be translated as CrossTheRoad. However I don't want the method TraverserLaRue of class B to be translated.</p>
","<refactoring><translation>","6","266","2010-02-10 03:51:36"
"2236649","Is there a source code control system that understands/records c#/vb.net factorings and how to merge them?","<blockquote>
  <p><a href=""https://netfiles.uiuc.edu/dig/MolhadoRef/index.html"" rel=""nofollow"">MolhadoRef</a> is a refactoring-aware SCM
  tool that is capable of capturing and
  versioning of the semantics of Java
  program entities and refactoring
  operations that were performed on
  those entities.</p>
</blockquote>

<p>Does anyone know of such a system in the .NET universe?
(Why is it that .NET always seems to be way behind java with the type of tool support?)</p>
","<c#><.net><vb.net><version-control><refactoring>","2","84","2010-02-10 12:14:50"
"2235693","Is there a 3 way merger tool that “understands” common refactoring?","<p>When a simple refactoring like “rename field” has been done on one branch it can be very hard to merge the changes into the other branches.  (Extract method is much harder as the merge tools don’t seem to match the unchanged blocks well)</p>

<p><em>Now in my dreams</em>, I am thinking of a tool that can record (or work out) what well defined refactoring operations have been done on one branch and then “replay” them on the other branch, rather than trying to merge every line the refactoring has affected.</p>

<p>see also ""<a href=""http://stackoverflow.com/questions/2235625/is-there-an-intelligent-3rd-merge-tool-that-understands-vb-net/2235736#2235736""><em>Is there an intelligent 3rd merge tool that understands VB.NET""</em></a> for the other half of my pain!</p>

<hr>

<p>Also has anyone try something like <a href=""https://netfiles.uiuc.edu/dig/MolhadoRef/molhadoref.html"" rel=""nofollow"">MolhadoRef</a> (<a href=""http://www.mooreds.com/wordpress/archives/000398"" rel=""nofollow"">blog article about MolhadoRef and Refactoring-aware SCM</a>),  This is, in theory, refactoring-aware source control. </p>
","<version-control><refactoring><merge><branch>","5","162","2010-02-10 09:32:39"
"2243225","How should I refactor my class?","<p>Basically I have a class that sends a SOAP request for room information receives a response, it can only handle one room at a time.. eg:</p>

<pre><code>class roomParser {
    private $numRooms;
    private $adults;
    private $dailyPrice;

    public function parse(){}
    public function send(){}

};

$room = new roomParser( $arrival, $departue );
$return = $room-&gt;parse();

if ( $return ) { }
</code></pre>

<p>Now I have the dilemma of basically supporting multiple rooms, and for each room I have to separately keep information of the dailyPrice, # of adults, so I have to sessionize each rooms information since its a multiple step form..</p>

<p>Should I just create multiple instances of my object, or somehow modify my class so it supports any # of rooms in a rooms array, and in the rooms array it contains properties for each room?</p>

<p>Edit #1: After taking advice I tried implementing the Command pattern:</p>

<pre><code>&lt;?php

interface Parseable {

    public function parse( $arr, $dept );
}

class Room implements Parseable {

    protected $_adults;
    protected $_kids;
    protected $_startDate;
    protected $_endDate;
    protected $_hotelCode;
    protected $_sessionNs;
    protected $_minRate;
    protected $_maxRate;
    protected $_groupCode;
    protected $_rateCode;
    protected $_promoCode;
    protected $_confCode;
    protected $_currency = 'USD';
    protected $_soapAction;
    protected $_soapHeaders;
    protected $_soapServer;
    protected $_responseXml;
    protected $_requestXml;

    public function __construct( $startdate,$enddate,$rooms=1,$adults=2,$kids=0 ) {
        $this-&gt;setNamespace(SESSION_NAME);
        $this-&gt;verifyDates( $startdate, $enddate );

        $this-&gt;_rooms= $rooms;
        $this-&gt;_adults= $adults;
        $this-&gt;_kids= $kids;

        $this-&gt;setSoapAction();
        $this-&gt;setRates();
    }

    public function parse( $arr, $dept ) {
        $this-&gt;_price = $arr * $dept * rand();
        return $this;
    }

    public function setNamespace( $namespace ) {
        $this-&gt;_sessionNs = $namespace;
    }

    private function verifyDates( $startdate, $enddate ) {}

    public function setSoapAction( $str= 'CheckAvailability' ) {
        $this-&gt;_soapAction = $str;
    }

    public function setRates( $rates='' ) { }

    private function getSoapHeader() {
        return '&lt;?xml version=""1.0"" encoding=""utf-8""?&gt;
            &lt;soap:Header&gt;
            &lt;/soap:Header&gt;';
    }

    private function getSoapFooter() {
        return '&lt;/soap:Envelope&gt;';
    }

    private function getSource() {
        return '&lt;POS&gt;
            &lt;Source&gt;&lt;RequestorId ID="""" ID_Context="""" /&gt;&lt;/Source&gt;
            &lt;/POS&gt;';
    }

    function requestXml() {
        $this-&gt;_requestXml  = $this-&gt;getSoapHeader();
        $this-&gt;_requestXml .='&lt;soap:Body&gt;&lt;/soap:Body&gt;';
        return $this-&gt;_requestXml;
    }

    private function setSoapHeaders ($contentLength) {
        $this-&gt;_soapHeaders = array('POST /url HTTP/1.1',
            'Host: '.SOAP_HOST,
            'Content-Type: text/xml; charset=utf-8',
            'Content-Length: '.$contentLength);
    }
}

class RoomParser extends SplObjectStorage {

    public function attach( Parseable $obj ) {
        parent::attach( $obj );
    }

    public function parseRooms( $arr, $dept ) {
        for ( $this-&gt;rewind(); $this-&gt;valid(); $this-&gt;next() ) {
            $ret = $this-&gt;current()-&gt;parse( $arr, $dept );
            echo $ret-&gt;getPrice(), PHP_EOL;
        }
    }
}

$arrive = '12/28/2010';
$depart = '01/02/2011';
$rooms = new RoomParser( $arrive, $depart);
$rooms-&gt;attach( new Room( '12/28/2010', '01/02/2011') );
$rooms-&gt;attach( new Room( '12/29/2010', '01/04/2011') );
echo $rooms-&gt;count(), ' Rooms', PHP_EOL;
</code></pre>
","<php><oop><refactoring><class-design>","0","139","2010-02-11 08:48:55"
"2243232","Is there a refactoring tool that works across solutions files?","<p>All the refactoring tools for C# and VB.Net that I have seen only consider the source code in a single visual studio solution.</p>

<p>For better or worse, our <strong>large</strong> (many related programs) system is spread over many solution files, however:</p>

<ul>
<li>All the code is below a single windows folder. </li>
<li>Our nAnt based build system, builds all files in a windows folder to produce a single dll (bit more complex then this but not important for this question).</li>
<li>Therefore ALL  “.cs” and “.vb” files below the single root folder are part of the system.</li>
</ul>

<p>So I am looking for refactoring and reverse engineering tools that take a single folder as input and act on all files below that folder.</p>

<p>(The tools may need some help to decide what “public” and “internal” means, however most of the time “internal” means “in the same code tree” when a “code tree” is a folder that contains code and any child folders.)</p>

<hr>

<p>Now I am being greedy, I would like the tools to create a lot of all the refactorings that have been done and to be able to replay the refactorings.    Then I could try out ideal and if they work, throw away my code, get the latest code, you do the refactorings and checkin the code before anyone else changes the files.  (Likewise for when branches need merging)</p>
","<c#><vb.net><visual-studio><refactoring>","6","234","2010-02-11 08:50:45"
"2243794","How do I refactor data contracts in WCF services?","<p>We have lots of WCF services that are only used by our own code; the code that uses them is mostly in the same solutions files that contains the services.</p>

<p>However they do not use a shared assembly for the contracts, so each time a data contract is change the reference to the service has to be updated by hand in all projects that use the service.  (Then the code needs to be fixed up by hand)</p>

<p><strong>So how do I do a simple refactoring like renamed a data item in a data contract?</strong></p>

<hr>

<p>Is there a way to update all references to services in a single solution with one command, rather then having to click on each reference in each project?</p>
","<c#><vb.net><wcf><refactoring>","0","476","2010-02-11 10:26:20"
"2245871","How do you cleanly separate code for backwards compatibility from the main code?","<p>I'm interested in what strategies people have come up with for separating all the crufty logic that's necessary to maintain backwards compatibility from the main code of an application. In other words, strategies that let you come closer to having your code look as if there were no backwards compatibility concerns except for separate isolated source files distinctly for that task.</p>

<p>For example, if your application reads a particular file format, instead of one giant honking file parsing function, you could have your code first iterate a list of ""quirks"" entries/objects, where each quirk checks the file to see if it's a file it would apply to, and if so invokes its own parsing logic instead of the normal case logic.</p>

<p>Quirks is an OK strategy but you have to do work to put hooks in for quirks checks at all the appropriate places in your app, and what the checks will look like will vary for different quirk types, etc. It almost seems like there should be libraries dedicated to the boilerplate for this task. Another issue is how to enforce that quirks aren't abused as general purpose hooks into arbitrary chunks of the app.</p>
","<language-agnostic><refactoring><backwards-compatibility>","9","168","2010-02-11 16:26:00"
"2247980","How to refactor log4net statements in c#?","<p>Ok so after reading danben's answer on this <a href=""http://stackoverflow.com/questions/2230180/whats-log4j-actually-doing-when-we-turn-on-or-off-some-log-places"">post</a>, I guess I'm convinced of the need for writting this kind of code, atleast in a lot of cases.  My managers seem to be agreeing too.</p>

<pre><code>if (log.IsDebugEnabled)
     log.Debug(""ZDRCreatorConfig(""+rootelem.ToString()+"")"");
if (log.IsInfoEnabled)
     log.Info(""Reading Configuration . . ."");
</code></pre>

<p>The problem with it is it bugs the heck out of me seeing all these if statements placed everywhere just to do a simple log statement.  </p>

<p>My question is, how might we refactor this into a class without reproduceing the performance problem of having to evaluate the arguments to the log method?</p>

<p>Simply putting it in a class as a static method doesn't help, because when you pass the Object message it still has to evaluate the argument:</p>

<pre><code>public class LogHelper {
     public static Info(ILog log, Object message) {
          if(log.IsInfoEnabled) { log.Info(message); }
     }
}
</code></pre>

<p>C# apparently doesn't support forcing a method to be inline, so that solution isn't available.  MACROs are not supported in C#.  What can we do?!?!</p>

<p>UPDATE:
Thanks for the replies, I have not forgot about this one; it's just low priorty on my list right now.  I will get to it and award the answer once I get caught up a bit.  Thanks.</p>

<p>Another UPDATE:<br>
well ... I still haven't look at this closly yet, and both of you deserve the correct answer; but I awarded Tanzelax the answer because I agree, I think they will be automatically inlined.  The link he posted does good job of convincing me I shouldn't worry too much about this right now, which is also good lol.  I'll still look at those lambda things later.  Thanks for the help!</p>
","<c#><logging><refactoring><log4net>","4","363","2010-02-11 21:50:58"
"2247946","OO Design Question","<p>Looking for opinions on this:</p>

<p>I have broken out various responsibilities into separate objects.  However, many of these objects have dependencies on each other.  All of these objects are adhering to interfaces so I'm not tied to an implementation.  I'm concerned about the dependencies between objects and the potential for circular dependencies.  Is this a symptom of bad design?  What have other people done to separate responsibilities and manage dependencies?  Thanks.</p>
","<oop><refactoring><object>","0","165","2010-02-11 21:45:10"
"2253110","How to Manage CSS Explosion","<p>I have been heavily relying on CSS for a website that I am working on (currently, everything is done as property values within each tag on the website and I'm trying to get away from that to make updates significantly easier).</p>

<p>The problem I am running into, is I'm starting to get a bit of ""CSS explosion"" going on.  It is becoming difficult for me to decide how to best organize and abstract data within the CSS file.  For example:</p>

<p>I am using a large number of <strong>div</strong> tags within the website (previously it was completely tables based).  So I'm starting to get a lot of CSS that looks like this...</p>

<pre><code>div.title
{
  background-color: Blue;
  color: White;
  text-align: center;
}

div.footer
{
  /* Stuff Here */
}

div.body
{
  /* Stuff Here */
}
</code></pre>

<p>etc.  It's not too bad yet, but since I am learning here, I was wondering if recommendations could be made on how best to organize the various parts of a CSS file.  What I don't want to get to is where I have a separate CSS attribute for every single thing on my website (which I have seen happen), and I always want the CSS file to be fairly intuitive.</p>

<p>(P.S. I do realize this is a very generic, high-level question.  My ultimate goal is to make it easy to use the CSS files and demonstrate their power to increase the speed of web development so other individuals that may work on this site in the future will also get into the practice of using them rather than hard-coding values everywhere.)</p>
","<css><web-development><refactoring><organization>","327","21210","2010-02-12 16:03:34"
"2254109","Searching asp.net Code","<p>I want to search my asp.net pages and user controls to see which master page and base class they use. I mention search because we are re-factoring a large project and we need to track progress on the code conversion. I know I can pull this information individually but I need a automated and repeatable procedure.</p>
","<asp.net><search><refactoring>","1","92","2010-02-12 18:19:16"
"2261348","Clean way to refactor test code","<p><strong>Background</strong>:<br>
I currently write test cases for the client side of a network protocol. As part of the tests I have to simulate several different expected and unexpected responses from the server (wrong header, connection lost, unexpected messages, timeouts).<br>
Each of these test-cases can be accessed by its unique address.<br>
<strong>My problem</strong>:<br>
The current implementation is split into several parts:  </p>

<ul>
<li>An enum containing all the addresses of the test-cases</li>
<li>A class Tests containing all tests as static functions</li>
<li>A number of defines which map the function name to the corresponding enum + _FUNC</li>
<li>A wrapper class which takes an address a function and a name as argument</li>
<li>A method which returns a list of wrapper-class objects, one object for each test-case  </li>
</ul>

<p>For each message received the server checks the list of test-cases and either executes the test-case corresponding to the address or falls back to a default response.<br>
<strong>The Question</strong>:<br>
This implementation requires me to update at least five different locations for each new test-case and the class Test grows rather fast. Is there a good way to refactor it?<br>
<strong>Example code</strong>:(this code is not valid c++)</p>

<pre><code>enum TestAddress
{
   TEST_CONNECTION_BREAKDOWN = 0x100,
   TEST_ALL_IS_GOOD = 0x101,
}


class Wrapper : AbstrTestCase  //AbstrTestCase requires applies and test implementations
{ 
typedef testFun;
Wrapper(TestAddress addr,testFun func,string name)
boolean applies(int ad,...){return addr == ad;}
int test(...){return func(...);}
}
class Test
{
static int testConnectionBreakDownFunc (...)
static int testAllIsGoodFunc(...)
}
#define TEST_CONNECTION_BREAKDOWN_FUNC Test::testConnectionBreakDownFunc
#define TEST_ALL_IS_GOOD_FUNC Test::testAllIsGoodFunc

list&lt;AbstrTestCase*&gt; GetTests()
{
   list&lt;AbstrTestCase*&gt; tlist;
   tlist.push_back(new Wrapper(TEST_ALL_IS_GOOD,TEST_ALL_IS_GOOD_FUNC,""TEST_ALL_IS_GOOD""));
   ...
   tlist.push_back(new Wrapper(TEST_CONNECTION_BREAKDOWN,TEST_CONNECTION_BREAKDOWN_FUNC,""TEST_CONNECTION_BREAKDOWN_FUNC""));
   return tlist;
}
</code></pre>

<p>Related: My last atemp to at least clean up the code in GetTests() was an additional define for the arguments of wrapper  </p>

<pre><code>#define WRAP_ARGS(N) N,N##_FUNC,#N
tlist.push_back(new Wrapper(WRAP_ARGS(TEST_CONNECTION_BREAKDOWN));
#undef WRAP_ARGS(N)
</code></pre>

<p>while it results in cleaner looking code, it only hides the problem</p>
","<c++><testing><refactoring><coding-style>","0","88","2010-02-14 14:13:39"
"2262388","How to refactor this code?","<p>Grouped params:</p>

<pre><code>&lt;?php
class Form {
    private $field;

    public function getFieldRelated($field) {
        return $this-&gt;fieldrelated[$field];
    }

    public function __construct() {
        $this-&gt;fieldrelated['email']['name'] = 'email';
        $this-&gt;fieldrelated['email']['value'] = $_POST['email'];
        $this-&gt;fieldrelated['email']['pattern'] = REGEX_EMAIL;
        $this-&gt;fieldrelated['email']['confirmation'] = 'emailconfirmation';
        $this-&gt;fieldrelated['email']['names'] = 'emails';

        $this-&gt;fieldrelated['emailconfirmation']['name'] = 'email confirmation';
        $this-&gt;fieldrelated['emailconfirmation']['value'] = $_POST['emailconfirmation'];
        $this-&gt;fieldrelated['emailconfirmation']['pattern'] = REGEX_EMAIL;

        $this-&gt;fieldrelated['password']['name'] = 'password';
        $this-&gt;fieldrelated['password']['value'] = $_POST['password'];
        $this-&gt;fieldrelated['password']['pattern'] = REGEX_PASSWORD;
        $this-&gt;fieldrelated['password']['confirmation'] = 'passwordconfirmation';
        $this-&gt;fieldrelated['password']['names'] = 'passwords';

        $this-&gt;fieldrelated['passwordconfirmation']['name'] = 'password confirmation';
        $this-&gt;fieldrelated['passwordconfirmation']['value'] = $_POST['passwordconfirmation'];
        $this-&gt;fieldrelated['passwordconfirmation']['pattern'] = REGEX_PASSWORD;
        }
    }
?&gt;
</code></pre>

<p>A part of the Validate class:</p>

<pre><code>public function isEmpty($field) {
    $fieldrelated = $this-&gt;form-&gt;getFieldRelated($field);
    $name = $fieldrelated['name'];
    $value = $fieldrelated['value'];

    if(empty($value)) {
        $this-&gt;setProperty($field, 'empty');
        $this-&gt;addErrorMessage('The '.$name.' is empty!');
        return true;
    } else {
        $this-&gt;setProperty($field, 'unempty');
        return false;
    }
}
public function isValid($field) {
    $fieldrelated = $this-&gt;form-&gt;getFieldRelated($field);
    $name = $fieldrelated['name'];
    $value = $fieldrelated['value'];

    $pattern = $fieldrelated['pattern'];

    if(preg_match($pattern, $value)) {
        $this-&gt;setProperty($field, 'valid');
        return true;
    } else {
        $this-&gt;setProperty($field, 'invalid');
        $this-&gt;addErrorMessage('The '.$name.' is invalid!');
        return false;
    }
}
public function isConfirmed($field) {
    $fieldrelated = $this-&gt;form-&gt;getFieldRelated($field);
    $value = $fieldrelated['value'];

    $field2 = $fieldrelated['confirmation'];

    $fieldrelated2 = $this-&gt;form-&gt;getFieldRelated($field2);
    $value2 = $fieldrelated2['value'];

    $names = $fieldrelated['names'];

    if($value == $value2) {
        $this-&gt;setProperty($field, 'confirmed');
        $this-&gt;setProperty($field2, 'confirmed');
        return true;
    } else {
        $this-&gt;setProperty($field, 'unconfirmed');
        $this-&gt;setProperty($field2, 'unconfirmed');
        $this-&gt;addErrorMessage('The '.$names.' are unconfirmed!');
        return false;
    }
}
public function isEmailOnlyIn($correct) {
    $fieldrelated = $this-&gt;form-&gt;getFieldRelated('email');
    $name = $fieldrelated['name'];
    $value = $fieldrelated['value'];

    $value = mysql_real_escape_string($value);
    $result = ""SELECT * FROM account WHERE email = '$value'"";
    $result = mysql_query($result);
    $result = mysql_fetch_array($result);

    if($result) {
        $this-&gt;setProperty('email', 'email only in');
        if($correct == 'not in') {
            $this-&gt;addErrorMessage('The '.$name.' is in database!');
        }
        return true;
    } else {
        $this-&gt;setProperty('email', 'email only not in');
        if($correct == 'in') {
            $this-&gt;addErrorMessage('The '.$name.' is not in database.');
        }
        return false;
    }
}
public function isPasswordAlsoIn($correct) {
    $fieldrelated = $this-&gt;form-&gt;getFieldRelated('email');
    $name = $fieldrelated['name'];
    $value = $fieldrelated['value'];

    $fieldrelated2 = $this-&gt;form-&gt;getFieldRelated('password');
    $name2 = $fieldrelated2['name'];
    $value2 = $fieldrelated2['value'];

    $value = mysql_real_escape_string($value);

    $value2 = md5($value2);
    $value2 = mysql_real_escape_string($value2);

    $result = ""SELECT * FROM account WHERE email = '$value' AND password = '$value2'"";
    $result = mysql_query($result);
    $result = mysql_fetch_array($result);

    if($result) {
        $this-&gt;setProperty('password', 'password also in');
        if($correct == 'not in') {
            $this-&gt;addErrorMessage('The '.$name2.' is in database!');
        }
        return true;
    } else {
        $this-&gt;setProperty('password', 'password also not in');
        if($correct == 'in') {
            $this-&gt;addErrorMessage('The '.$name2.' is not in database!');
        }
        return false;
    }
}
</code></pre>

<p>The usage:</p>

<pre><code>    if(!$validate-&gt;isEmpty('email')) {
        $validate-&gt;isValid('email');
    }
    if(!$validate-&gt;isEmpty('emailconfirmation')) {
        $validate-&gt;isValid('emailconfirmation');
    }
    if($validate-&gt;isProperty('email', 'valid') &amp;&amp; $validate-&gt;isProperty('emailconfirmation', 'valid')) {
        $validate-&gt;isConfirmed('email');
    }

    if(!$validate-&gt;isEmpty('password')) {
        $validate-&gt;isValid('password');
    }
    if(!$validate-&gt;isEmpty('passwordconfirmation')) {
        $validate-&gt;isValid('passwordconfirmation');
    }
    if($validate-&gt;isProperty('password', 'valid') &amp;&amp; $validate-&gt;isProperty('passwordconfirmation', 'valid')) {
        $validate-&gt;isConfirmed('password');
    }

    if($validate-&gt;isProperty('email', 'confirmed') &amp;&amp; $validate-&gt;isProperty('emailconfirmation', 'confirmed')) {
        $validate-&gt;isEmailOnlyIn('not in');
    }
</code></pre>
","<php><refactoring><oop>","2","145","2010-02-14 19:15:31"
"2264273","Keeping a global reference to a control in WinForms for accessing GUI thread","<p><em>(There's a tiny bit of history to this question, please bear with me)</em></p>

<p>In <a href=""http://stackoverflow.com/questions/192980/boiler-plate-code-replacement-is-there-anything-bad-about-this-code"">this</a> question, I talked about the possibility of centralising the 'cross thread' hocus-pocus that is required for updating the GUI like so:</p>

<pre><code>//Utility to avoid boiler-plate InvokeRequired code
//Usage: SafeInvoker.Invoke(myCtrl, () =&gt; myCtrl.Enabled = false);
public static void Invoke(Control ctrl, Action cmd)
{
    if (ctrl.InvokeRequired)
        ctrl.BeginInvoke(new MethodInvoker(cmd));
    else
        cmd();
}
</code></pre>

<p>Last week, mulling over the fact that this always happens (in my code) when handling an event, and partly inspired by <a href=""http://diditwith.net/CommentView,guid,aacdb8ae-7baa-4423-a953-c18c1c7940ab.aspx"" rel=""nofollow"">Dustin Campbell</a>'s event extension method, I cooked up this:</p>

<pre><code>//Utility to avoid boiler-plate SafeInvoker.Invoke code
//Usage obj.EventRaised += obj_EventRaised.OnGUIThread(controlreference);
public static EventHandler OnGUIThread(this EventHandler h, Control ctrl)
{
    // lambda expressions are not syntactic sugar, they are syntactic crack!
    return (s, e) =&gt; SafeInvoker.Invoke(ctrl, () =&gt; h(s, e));
}
</code></pre>

<p>The thing that bugs me here is always having to have a control to hand. As far as I know, there is only one GUI thread, so any control would do here. </p>

<p>I got to wondering about creating a 'GUIContext' singleton and throwing it a reference to my main form when the application starts up, then accessing that from my extension method, thus removing the need for the ctrl parameter.</p>

<p>Is this a bad idea, and if so, why? Is there a better way to do it? I know that in Rx there is a notion of Context, but I'm not aware of anything equivalent in vanilla WinForms. I can imagine there might be a problem if I try to update a control that is not yet handled (but in that case I'm <a href=""http://stackoverflow.com/questions/246058/system-invalidoperationexception-the-object-is-currently-in-use-elsewhere-ho"">screwed anyway</a>).</p>
","<c#><winforms><refactoring><cross-threading>","2","216","2010-02-15 06:04:53"
"2264470","Shortening a ""Long"" parameter list","<p>I'm refactoring one of my projects - a shopping cart. One of the tightly coupled areas of my code is the ""Viewer"" class - to generate information for the user to see, it often needs a combination of two or more of the following objects:</p>

<ul>
<li>The store catalog. </li>
<li>The customer's order. </li>
<li>The customer's mailing information.</li>
</ul>

<p>I can't really break up the display methods, for various reasons.</p>

<p>Martin Fowler's Refactoring identifies this as a ""Long parameter list"" smell. The relevant refactoring here is ""Introduce parameter object."" I am, however, hesitant to do that, as doing so would couple loosely related data. It would also lock me to a very narrow one-to-one relationship between those three objects - while that would work for my application as it is now, it makes no real-world sense. (As there is only one store catalog, there can be many ""Customer mailing information"" objects, and each of those may be related to many ""Customer's order"" objects).</p>

<p>Does anyone have any elegant solutions to this?</p>
","<design><refactoring>","1","199","2010-02-15 07:22:39"
"2265234","Design pattern to organize non-trivial ORM queries?","<p>I am developing a web API with 10 tables or so in the backend, with several one-to-many and many-to-many associations. The API essentially is a database wrapper that performs validated updates and conditional queries. It's written in Python, and I use SQLAlchemy for ORM and CherryPy for HTTP handling.</p>

<p>So far I have separated the 30-some queries the API performs into functions of their own, which look like this:</p>

<pre><code># in module ""services.inventory""
def find_inventories(session, user_id, *inventory_ids, **kwargs):
    query = session.query(Inventory, Product)
    query = query.filter_by(user_id=user_id, deleted=False)
    ...
    return query.all()

def find_inventories_by(session, app_id, user_id, by_app_id, by_type, limit, page):
    ....

# in another service module
def remove_old_goodie(session, app_id, user_id):
    try:
        old = _current_goodie(session, app_id, user_id)
        services.inventory._remove(session, app_id, user_id, [old.id])
    except ServiceException, e:
        # log it and do stuff
....
</code></pre>

<p>The CherryPy request handler calls the query methods, which are scattered across several service modules, as needed. The rationale behind this solution is, since they need to access multiple model classes, they don't belong to individual models, and also these database queries should be separated out from direct handling of API accesses.</p>

<p>I realize that the above code might be called <a href=""http://www.refactoring.com/catalog/introduceForeignMethod.html"" rel=""nofollow"">Foreign Methods</a> in the realm of refactoring. I could well live with this way of organizing for a while, but as things are starting to look a little messy, I'm looking for a way to refactor this code.</p>

<ul>
<li>Since the queries are tied directly to the API and its business logic, they are hard to generalize like getters and setters.</li>
<li>It smells to repeat the <code>session</code> argument like that, but as the current implementation of the API creates a new CherryPy handler instance for each API call and therefore the <code>session</code> object, there is no global way of getting at the current <code>session</code>.</li>
</ul>

<p>Is there a well-established pattern to organize such queries? Should I stick with the Foreign Methods and just try to unify the function signature (argument ordering, naming conventions etc.)? What would you suggest?</p>
","<python><design-patterns><orm><refactoring><sqlalchemy>","2","254","2010-02-15 10:24:04"
"2268575","What features do you look for (or use most) in refactoring tools?","<p>I'm familiar with the basics, such as ""Extract Method."" But that is about all that I use. What others are there? This can include refactoring tool features and also macros that you write yourself.</p>
","<language-agnostic><refactoring>","4","65","2010-02-15 20:04:30"
"2280588","Redirecting to same ActionResult from diffrent controllers","<p>I have a User entity, and in various views, I want to create links to a user home page basically. This fuctionality should be avaialbe in different controllers, so I can easily redirect to the user's home page. Each user in my site has a role ; for example reader, writer, editor, manager and admin. Ideally, I want to try to achieve something like this:</p>

<p>In a controller, for example</p>

<pre><code>public ActionResult SomeThingHere() {
    return View(User.GetHomePage());
//OR 
    return RedirectToROute(User.GetHomePage());
}
</code></pre>

<p>in a View, I also want to use the same functionality, for  example:</p>

<pre><code>&lt;%= Html.ActionLink(""Link to home"", user.GetHomePage() %&gt;
</code></pre>

<p>Is it possible to achieve such a design in MVC? If so , how should I go about it?</p>

<p>I currently use a method like this, but it is only in one controller at the moment. Now I need to use the same code somewhere else and I am trying to figure out how I could refractor this and avoid repeating myself?</p>

<pre><code>....
private ActionResult GetHomePage(User user){
    if (user.IsInRole(Role.Admin))
        return RedirectToAction(""Index"", ""Home"", new { area = ""Admin"" });

    if (user.IsInRole(Role.Editor))
        // Managers also go to editor home page
        return RedirectToAction(""Index"", ""Home"", new {area = ""Editor""});

    if (user.IsInRole(Role.Reader))
        // Writer and reader share the same home page
        return RedirectToAction(""Index"", ""Home"", new { area = ""Reader"" });

    return RedirectToAction(""Index"", ""Home"");
}
...
</code></pre>

<p>Thanks for your help</p>
","<asp.net-mvc><refactoring><asp.net-mvc-routing>","2","554","2010-02-17 12:37:28"
"2286356","How to tighten up this Ruby code?","<p>I'm wondering how I can write this better.  I was trying to use inject instead of each, but kept running into errors.  Mostly I'd like to tighten up the block.  Any thoughts?</p>

<pre><code>def to_proc
    levels_of_nesting = @fields.zip(@orderings)

    procedure = nil
    levels_of_nesting.each do |field, ordering|
      procedure = proc_for(field, ordering) and next if procedure.nil?
      procedure = procedure.decorate_w_secondary_sorting_level(proc_for(field, ordering))
    end
    procedure
  end
</code></pre>
","<ruby><refactoring><block>","2","109","2010-02-18 04:42:25"
"2288692","What happens if I use ""throw;"" without an exception to throw?","<p>Here's the setup.</p>

<p>I have a C++ program which calls several functions, all of which potentially throw the same exception set, and I want the same behaviour for the exceptions in each function
(e.g. print error message &amp; reset all the data to the default for exceptionA; simply print for exceptionB; shut-down cleanly for all other exceptions).</p>

<p>It seems like I should be able to set the catch behaviour to call a private function which simply rethrows the error, and performs the catches, like so:</p>

<pre><code>void aFunction()
{
    try{ /* do some stuff that might throw */ }
    catch(...){handle();}
}

void bFunction()
{
    try{ /* do some stuff that might throw */ }
    catch(...){handle();}
}

void handle()
{
    try{throw;}
    catch(anException)
    {
        // common code for both aFunction and bFunction
        // involving the exception they threw
    }
    catch(anotherException)
    {
        // common code for both aFunction and bFunction
        // involving the exception they threw
    }
    catch(...)
    {
        // common code for both aFunction and bFunction
        // involving the exception they threw
    }
}
</code></pre>

<p>Now, what happens if ""handle"" is called outside of the exception class.
I'm aware that this should never happen, but I'm wondering if the behaviour is undefined by the C++ standard.</p>
","<c++><exception><refactoring>","3","418","2010-02-18 12:55:06"
"2292545","PHP loading new models in a loop","<p>I am currently battling this error message by refactoring some of my code:</p>

<blockquote>
  <p>Fatal error: Allowed memory size of 33554432 bytes exhausted</p>
</blockquote>

<p>I figure I must have sloppy code somewhere. Is it a bad practice to load new models in a loop like so:</p>

<pre><code>&lt;?php 
foreach($blog_ids as $blog_id) { 
    $blog = new Blog($blog_id);
    echo $blog-&gt;title;
}
?&gt;
</code></pre>

<p>Is this a quick way to burn up memory....and if it is, how do I accomplish the same goal?</p>

<p>EDIT:</p>

<ol>
<li><p>the above code is just a snippet. I have tons of info for each blog - a model should most likely be the best way to handle it.</p></li>
<li><p>I may have up to 100 different blog listings on a page.</p></li>
</ol>
","<php><refactoring>","1","79","2010-02-18 22:01:20"
"2297615","Javascript refactor","<p>Is there a better way to write this function?  I've inherited some javascript code and I'd like to make this more concise if possible.  Also, I'll probably be adding many more ""theme"" elements and don't want to copy and paste over and over.  </p>

<pre><code>function imageClick() {
var theme1 = document.getElementById(""li-theme1"");
var theme2 = document.getElementById(""li-theme2"");
var theme3 = document.getElementById(""li-theme3"");

var imgtheme1 = theme1.getElementsByTagName(""img"");
var imgtheme2 = theme2.getElementsByTagName(""img"");
var imgtheme3 = theme3.getElementsByTagName(""img"");

var inputtheme1 = document.getElementById(""radiotheme1"");
var inputtheme2 = document.getElementById(""radiotheme2"");
var inputtheme3 = document.getElementById(""radiotheme3"");

imgtheme1[0].onclick = function() {
    inputtheme1.checked = true;
    highlightChoice(""li-theme1"");
}
imgtheme2[0].onclick = function() {
    inputtheme2.checked = true;
    highlightChoice(""li-theme2"");
}
imgtheme3[0].onclick = function() {
    inputtheme3.checked = true;
    highlightChoice(""li-theme3"");
}
}
</code></pre>
","<javascript><refactoring>","4","398","2010-02-19 15:57:36"
"2299433","How to make this code more functional?","<p>I am a newbie in functional programming. I just tried solving the following problem : </p>

<pre><code>[ a rough specification ]

e.g.1:
dividend : {3,5,9}
divisor : {2,2}
radix = 10
ans (remainder) : {7}

Procedure :
dividend = 3*10^2+5*10^1+9*10^0 = 359
similarly, divisor = 22
so 359 % 22 = 7

e.g.2:
dividend : {555,555,555,555,555,555,555,555,555,555}
divisor: {112,112,112,112,112,112,112,112,112,112}
radix = 1000
ans (remainder) : {107,107,107,107,107,107,107,107,107,107}
</code></pre>

<p>My solution to this problem is :</p>

<pre><code>object Tornedo {
  def main(args: Array[String]) {
    val radix: BigInt = 1000
    def buildNum(segs: BigInt*) = (BigInt(0) /: segs.toList) { _ * radix + _ }
    val dividend = buildNum(555,555,555,555,555,555,555,555,555,555)
    val divisor = buildNum(112,112,112,112,112,112,112,112,112,112)
    var remainder = dividend % divisor
    var rem = List[BigInt]()
    while(remainder &gt; 0) {
      rem = (remainder % radix) :: rem
      remainder /= radix
    }
    println(rem)
  }
}
</code></pre>

<p>Although I am pretty satisfied with this code I'd like to know how to eliminate the while loop &amp; two mutable variables and make this code more functional.</p>

<p>Any help would be greatly appreciated.</p>

<p>Thanks. :)</p>
","<scala><refactoring><functional-programming>","1","373","2010-02-19 20:47:44"
"2297901","Refactoring C++ code to use forward declarations","<p>I've got a largeish codebase that's been around for a while and I'm trying to tidy it up a bit by refactoring it.  One thing I'd like to do is find all the headers where I could forward declare members, instead of including the entire header file.</p>

<p>This is a fairly labour intensive process and I'm looking for a tool that could help me figure out which headers have members that could be forward declared.</p>

<p>Is there a compiler setting that could emit a warning or suggestion that the following code could use a forward declaration?  I'm using the following compilers icc, gcc, sun studio and HP's aCC</p>

<p>Is there a standalone tool that could do the same job?</p>

<pre><code>#include ""Foo.h""
...//more includes

class Bar {
.......
private:
    Foo* m_foo;
};
</code></pre>
","<c++><tools><compiler><refactoring><forward-declaration>","15","534","2010-02-19 16:32:08"
"2299889","Refactor my ruby anagram solver?","<p>I recently had to write an anagram solver for a job interview.  Here is my code.</p>

<pre><code>class Anagram

  def self.resolves?(first_word, second_word)
    @letter_counts = {}

    # Assuming that anagrams aren't case sensitive.
    first_word.downcase!
    second_word.downcase!

    count_letters(first_word, 1)
    count_letters(second_word, -1)

    (sum_of_counts == 0)
  end

  private
    def self.sum_of_counts
      @letter_counts.inject(0){|sum, n| sum + n[1]}
    end

    def self.count_letters(aword, incrementer)
      aword.each_byte {|c| @letter_counts[c].nil? ? @letter_counts[c] = 1 : @letter_counts[c]+=incrementer }
    end
end

puts Anagram.resolves?('dog','cat')
puts Anagram.resolves?('dog','god')
puts Anagram.resolves?('Jim','Jones')
puts Anagram.resolves?('Hello','olleH')
</code></pre>

<p>I particularly don't like the count_letters method and the checking of the existence of the hash value. Where can I improve this code so that's it's more idiomatic Ruby?</p>

<p>Thanks in advance.</p>
","<ruby><refactoring><code-review>","4","1453","2010-02-19 21:56:19"
"2298272","How much duplicated code do you tolerate?","<p>In a recent code review I spotted a few lines of duplicated logic in a class (less than 15 lines). When I suggested that the author refactor the code, he argued that the code is simpler to understand that way. After reading the code again, I have to agree extracting the duplicated logic would hurt readability a little. </p>

<p>I know DRY is guideline, not an absolute rule. But in general, are you willing to hurt readability in the name of DRY?</p>
","<refactoring><coding-style><dry><code-duplication>","18","1124","2010-02-19 17:20:45"
"2302220","Extract method to already existing interface with ReSharper","<p>I'm adding a new method to a class that implements an interface, and I like to use the ""Extract Interface"" refactoring and just add the method to the interface. But it doesn't seem like ReSharper supports adding a method signature to an already existing interface.</p>

<p>It feels like I'm missing something, I'm sure it can be done somehow. Maybe I should add the method signature to the interface first, but this is the way I'm working sometimes. Am I missing some shortcut, feature or using ReSharper wrong? </p>
","<c#><refactoring><resharper>","7","630","2010-02-20 12:51:18"
"2301234","Shorter way to write this code?","<p>I know how to make all these uiimageviews disappear and come back again, but I don't know how to write this shorter.  They are all assigned unique tags 1-35.  I want to check if ALL of them are hidden and then perform an action.</p>

<pre><code>if(test.hidden==YES 
       &amp;&amp; test2.hidden==YES
       &amp;&amp; test3.hidden==YES 
       &amp;&amp; test4.hidden==YES 
       &amp;&amp; test5.hidden==YES 
       &amp;&amp; test6.hidden==YES 
       &amp;&amp; test7.hidden==YES 
       &amp;&amp; test8.hidden==YES 
       &amp;&amp; test9.hidden==YES 
       &amp;&amp; test10.hidden==YES 
       &amp;&amp; test11.hidden==YES 
       &amp;&amp; test12.hidden==YES 
       &amp;&amp; test13.hidden==YES 
       &amp;&amp; test14.hidden==YES 
       &amp;&amp; test15.hidden==YES 
       &amp;&amp; test16.hidden==YES 
       &amp;&amp; test17.hidden==YES 
       &amp;&amp; test18.hidden==YES 
       &amp;&amp; test19.hidden==YES 
       &amp;&amp; test20.hidden==YES 
       &amp;&amp; test21.hidden==YES 
       &amp;&amp; test22.hidden==YES 
       &amp;&amp; test23.hidden==YES 
       &amp;&amp; test24.hidden==YES 
       &amp;&amp; test25.hidden==YES 
       &amp;&amp; test26.hidden==YES 
       &amp;&amp; test27.hidden==YES 
       &amp;&amp; test28.hidden==YES 
       &amp;&amp; test29.hidden==YES 
       &amp;&amp; test30.hidden==YES 
       &amp;&amp; test31.hidden==YES 
       &amp;&amp; test32.hidden==YES 
       &amp;&amp; test33.hidden==YES 
       &amp;&amp; test34.hidden==YES 
       &amp;&amp; test35.hidden==YES){
do something
}
</code></pre>
","<iphone><refactoring><sdk><uiimageview>","2","134","2010-02-20 05:54:07"
"2301568","How/where to temporarily store ActiveRecord objects if not in session?","<p>I'm refactoring a Rails-based event registration application that has a checkout process that hits several ActiveRecord models.  Ideally, the objects should not be saved unless checkout is complete (payment is successfully processed).  I'm not entirely certain why it would be a bad thing to serialize these objects into the session temporarily, but I've read over and over that its bad mojo.  At least there's no risk of getting out of sync with existing records, as there won't be any existing records.</p>

<p>My questions are:</p>

<p>A) Is it still problematic to store records in the session even though they don't exist elsewhere?  Even if I modify a model, can't I kill all existing sessions?</p>

<p>B) If it may cause problems, how should I temporarily store objects?  Should I save them and use a boolean flag to indicate permanent vs. temporary status?  Then cron a script to weed out stale temporary objects?</p>

<p>Thoughts?</p>
","<ruby-on-rails><session><activerecord><refactoring>","6","550","2010-02-20 08:20:34"
"2306171","Potential use of Python decorator or other refactorization: iterative optimization","<p>Forgive me for yet another question on Python decorators. I did read through many of them, but I wonder what the best solution to the specific following problem is.</p>

<p>I have written several functions that do some form of gradient descent in numpy/scipy. Given a matrix X, I try to iteratively minimize some distance, d(X, AS), as functions of A and S. Each algorithm follows the same basic procedure, but each has a different update rule. For example, here were two of my functions (note the only difference is in the update rule):</p>

<pre><code>def algo1(X, A=None, S=None, K=2, maxiter=10, c=0.1):
    M, N = X.shape
    if A is None:
        A = matrix(rand(M, K))
    if S is None:
        S = matrix(rand(K, N))
    for iter in range(maxiter):
        # Begin update rule.
        A = multiply(A, (X*S.T + c)/(A*S*S.T + c))
        S = multiply(S, (A.T*X + c)/(A.T*A*S + c))
        # End update rule.
        for k in range(K):
            na = norm(A[:,k])
            A[:,k] /= na
            S[k,:] *= na
    return A, S
</code></pre>

<p>... and the other:</p>

<pre><code>def algo2(X, A=None, S=None, K=2, maxiter=10, c=0.1):
    M, N = X.shape
    O = matrix(ones([M, N]))
    if A is None:
        A = matrix(rand(M, K))
    if S is None:
        S = matrix(rand(K, N))
    for iter in range(maxiter):
        # Begin update rule.
        A = multiply(A, ((X/(A*S))*S.T + c)/(O*S.T + c))
        S = multiply(S, (A.T*(X/(A*S)) + c)/(A.T*O + c))
        # End update rule.
        for k in range(K):
            na = norm(A[:,k])
            A[:,k] /= na
            S[k,:] *= na
    return A, S
</code></pre>

<p>Both functions are successful on their own. Obviously, these functions are asking to be refactored. The unit of code that differs is the update rule. So here is my attempt at refactoring:</p>

<pre><code>@iterate
def algo1(X, A=None, S=None, K=2, maxiter=10, c=0.1):
    A = multiply(A, (X*S.T + c)/(A*S*S.T + c))
    S = multiply(S, (A.T*X + c)/(A.T*A*S + c))

@iterate
def algo2(X, A=None, S=None, K=2, maxiter=10, c=0.1):
    A = multiply(A, ((X/(A*S))*S.T + c)/(O*S.T + c))
    S = multiply(S, (A.T*(X/(A*S)) + c)/(A.T*O + c))
</code></pre>

<p>Here are some potential function calls:</p>

<pre><code>A, S = algo1(X)
A, S = algo1(X, A0, S0, maxiter=50, c=0.2)
A, S = algo1(X, K=10, maxiter=40)
</code></pre>

<p>Questions:</p>

<ol>
<li>What technique is best suited for refactoring this code? Function decorators?</li>
<li>If so, how would you write <code>iterate</code>? What confuses me, in particular, are the arguments/parameters, e.g., with vs. without default values, accessing them in the decorator and ""wrapper"", etc. For example, the update rules themselves do not require <code>K</code>, but the initialization code does, so I wonder if my function signatures are correct.</li>
</ol>

<p>EDIT: Thank you for the help. More questions:</p>

<ol>
<li>Is it true that a wrapper (e.g., <code>inner</code>) is only necessary when parameters are being passed? Because I see decorator examples without wrappers, and no parameters are passed, and they work just fine. </li>
<li>From reading the Python docs some more, <code>functools</code> appears useful; is its main purpose to preserve the metadata of the original function (e.g., <code>algo1.__name__</code> and <code>algo1.__doc__</code>)? </li>
<li>With the signatures <code>def algo1(X, A, S, c)</code> and <code>def inner(X, A=None, S=None, K=2, maxiter=10, c=0.1)</code>, the call <code>algo1(X, maxiter=20)</code> still works. Syntactically, I'm not sure why that is. For learning purposes, could you clarify (or cite a reference)? Thanks!</li>
</ol>
","<python><refactoring><numpy><decorator>","1","196","2010-02-21 14:32:34"
"2311080","How to Refactor aspectJ code","<p>I'm trying to refactor aspectJ code in order to avoid collision with other jars.
I took the source code from the eclipse CVS and refactored all the source code (including build scripts etc.), but it seems that I need to refactor the eclipse plugin jars as well (which I'm not sure I need at all)</p>

<p>Can anyone recommend a good way of refactoring aspectJ?</p>

<p>thanks for the help</p>
","<java><aspectj><refactoring>","0","117","2010-02-22 13:24:34"
"2312299","How to factor static call out of a class","<p>Let's say I have a static method called Logger.log(), which calls another static method, CurrentUser.getName(), to get some additional information to log:</p>

<pre><code>public static void log(text) {
  String[] itemsToLog = { text, todaysDate, ipAddress, CurrentUser.getName() };
</code></pre>

<p>Now obviously this isn't an ideal situation, especially with the static data in the CurrentUser class. But I want to start improving it by reducing the Logger's dependencies. I'd prefer that the Logger not have any knowledge of higher-level concepts like users. It just needs a list of things to log, and doesn't care what they are.</p>

<p>So I want to somehow factor out the CurrentUser class. But Logger is static, so I can't just pass the information into its constructor.</p>

<p>What would be a good pattern for factoring out things like this?</p>
","<language-agnostic><refactoring><static-methods>","4","95","2010-02-22 16:22:29"
"2317579","Is Automatic Refactoring Possible in Dynamic Languages?","<p>Perhaps I am limited by my experience with dynamic languages (Ruby on Netbeans and Groovy on Eclipse), but it seems to me that the nature of dynamic languages makes it impossible to refactor (renaming methods, classes, pushing-up, pulling-down, etc.) automatically.</p>

<p><strong>Is it possible to refactor AUTOMATICALLY in any dynamic language (with any IDE/tool)?</strong> I am especially interested in Ruby, Python and Groovy, and how the refactoring compares to the 100% automatic refactoring available in all Java IDEs.</p>
","<refactoring><dynamic-languages>","4","767","2010-02-23 11:14:22"
"2320648","How to justify massive refactor / redesign","<blockquote>
  <p><strong>Possible Duplicates:</strong><br>
  <a href=""http://stackoverflow.com/questions/242407/how-to-convince-my-boss-to-do-refactoring"">How to convince my boss to do refactoring?</a><br>
  <a href=""http://stackoverflow.com/questions/38144/how-can-i-convince-skeptical-management-and-colleagues-to-allow-refactoring-of-aw"">How can I convince skeptical management and colleagues to allow refactoring of awful code?</a><br>
  <a href=""http://stackoverflow.com/questions/77193/how-do-you-justify-refactoring-work-to-your-penny-pinching-boss"">How do you justify Refactoring work to your penny-pinching boss?</a>  </p>
</blockquote>



<p>I have been an independent software contractor for a couple years now, straight out of university. The code-base of one of my primary on-going jobs is incredibly messy and poorly designed... or not designed. I started on this job while in university. I would like to spend some (or a lot of) time refactoring/redesigning the code. I just don't like working on this project anymore because the code is so bad.</p>

<p>How can I justify to the client my spending a considerable amount of time (which equals their money) refactoring/redesigning the code?</p>

<p>I've been refactoring little bits as I go - but the code is so wild that I think such on-going refactoring will only help so much.</p>
","<refactoring><business>","3","351","2010-02-23 18:20:22"
"2324428","How to refactor overloaded methods","<p>I have the methods:</p>

<pre><code>public MyReturnType MyMethod(Class1 arg)
{
 //implementation
}

public MyReturnType MyMethod(Class2 arg)
{
 //implementation
}

//...

public MyReturnType MyMethod(ClassN arg)
{
 //implementation
}
</code></pre>

<p>decimal, string, DateTime in [Class1, ... , ClassN]<br />
and one common method:</p>

<pre><code>public MyReturnType MyMethod(object obj)
{
 if(obj == null)
  throw new ArgumentNullException(""obj"");
 if(obj is MyClass1)
  return MyMethod((Class1)obj);
 if(obj is MyClass2)
  return MyMethod((Class2)obj);
 //...
 if(obj is MyClassN)
  return MyMethod((ClassN)obj);
 return MyMethod(obj.ToString()); //MyMethod(string) implemented.
}
</code></pre>

<p>How can i refactor this code? I can use attributes and component model, something like this:</p>

<pre><code>public class MyAttribute : Attribute
{
 public Type Type { get; set; }
}

public MyReturnType MyMethod(object obj)
{
    if(obj == null)
        throw new ArgumentNullException(""obj"");
 var protperty = TypeDescriptor.GetProperties(this, new Attribute[] { new MyAttribute() })
  .Cast&lt;PropertyDescriptor&gt;().FirstOrDefault(x =&gt;
   x.GetAttribute&lt;MyAttribute&gt;().Type.IsInstanceOfType(obj));
 if (protperty != null)
  return protperty.GetValue(obj) as MyReturnType;
 return MyMethod(obj.ToString());
}
</code></pre>

<p>but it looks quite hard to understand and can create some bugs. For example if somebody declare method like</p>

<pre><code>[MyAttribute(Type = ClassNplus1)]
public NotMyReturnType MyMethod(ClassNplus1 arg);
</code></pre>

<p>Any other ideas how to create extensible system, where adding new class is required only to add one method? (add code in one place)</p>
","<c#><.net><refactoring><overloading>","3","137","2010-02-24 07:55:12"
"2327552","How to introduce boost::shared_ptr into an existing (large) C++ codebase?","<p>I am currently trying to fix a few weaknesses in our code base by introducing the use of smart pointers. The code base is very large, and interlinked like a spider who's had one to many coffee's.</p>

<p>I was wondering if people had tried the before and what their approach was.</p>

<p>My first step has been to typedef classes, as follows.</p>

<pre><code>#ifndef USE_SMART_POINTERS
    #define USE_SMART_POINTERS 0
#endif

#if USE_SMART_POINTERS == 1
    #include &lt;boost/smart_ptr.hpp&gt;
#endif


namespace ProductX
{
    // forward decleration
    class CTObject;


    //typedefs
    #if USE_SMART_POINTERS == 1
        typedef boost::shared_ptr&lt;CTObject&gt; CTObjectPtr;
    #else
        typedef CTObject* CObjectPtr;
    #endif
}
</code></pre>

<p>Now I realise this will lead to a wealth of compile areas, things like</p>

<pre><code>CTObjectPtr i = NULL;
</code></pre>

<p>Will completly bork when smart pointers are enabled.</p>

<p>I was wondering if there was anything I could do at this early stage to reduce the mass of compile errors, or is it as I suspect just take things on a case by case basis.</p>

<p>Cheers
Rich</p>
","<c++><boost><refactoring><shared-ptr>","6","299","2010-02-24 16:18:45"
"2326609","How to organize MATLAB code?","<p>How do you organize your Matlab code?  I've come into ownership of several thousand lines of Matlab code, some as >900 line functions and a few directories full of <code>function_name.m</code> files.  It's hard to figure out what everything is doing (or relating to) or figure out the dependencies.  I'd like to reorganize things as I figure out what does what, but Matlab limits what's possible.  What would you suggest?</p>
","<matlab><refactoring><organizing>","23","3433","2010-02-24 14:20:14"
"2333336","How do i refacter a 100 function class","<p>I haven't counted but its a lot. How do i refacter a 100 function class?</p>

<p>This is for a website, i use to have a PageView, Backend, DB layer where PageView calls the backend, every backend public function checks if the user meets the required authority then calls the DB or any other code. It wasnt as nice as it may sound, each of them have many functions within (lets say 30+ each. Also many two liner functions in Backend calling a DB func)</p>

<p>A friend suggested to drop the backend class and use inheritance. The function that requires mod privileges goes into ModUser which inherits from NormalUser which is nice and i now only check if the user is authorize once instead of many times (the result is only fetch from the db the first time so speed didnt improve).</p>

<p>The problem is now i have a large class now that i decided DB should be part of it since it doesnt make sense when theres no backend middleman. The functions are something like</p>

<ul>
<li>DoPageXYZ (20 of these)  </li>
<li>IsXYZUser (properties for permissions. A page with normal access can had mod bonuses)  </li>
<li>getUserBlah (favourites, media, followers, comment for a page, etc)  </li>
</ul>

<p>Coding isnt difficult and is actually pretty nice but it doesnt feel right. Its weird looking through dozens of functions in one class and sometimes takes more then a few seconds to find the correct one.</p>

<p>How do i cleanup the class? I notice i use a MANY functions only once or twice but its often like that for my well design classes as well. Does anyone know what problem i fell into?</p>
","<c#><language-agnostic><refactoring><code-smell><code-design>","2","204","2010-02-25 10:45:57"
"2337197","Should I rename a return type to something more generic in order to reuse it?","<p>So I made a mistake.</p>

<p>When originally writing a signature for an API, I created something like this:</p>

<pre><code>public JellyBeanResult getJellyBeanReport();
</code></pre>

<p>Now, it turns out that I would like to re-use the more specific JellyBeanResult object because of its functionality, but it would be confusing to have other functions return a type named for a different process. There are a couple of ways to fix this that I can think of. I could re-name the return type to something more generic:</p>

<pre><code>public GenericResult getJellyBeanReport();
public GenericResult getChocolateBarReport();
</code></pre>

<p>but that would break any code that is using the API. I could create a new, more accuratly named class that extends SpecificResult that more closely fits the new function:</p>

<pre><code>public class ChocolateBarResult extends JellyBeanResult{};

public JellyBeanResult getJellyBeanReport();
public ChocolateBarResult getChocolateBarReport();
</code></pre>

<p>But this is really, really ugly and the problem still sticks around if I want to to use the return type again down the road. <strong>How can I clean up these signatures to make them less confusing without breaking any code that is using them?</strong></p>
","<java><oop><refactoring>","2","166","2010-02-25 20:04:05"
"2338202","Move type from one project to another via Resharper?","<p>I have several interfaces and classes that i have in my business layer project and i want to move them into a brand new project.  I am using Resharper 4.5.2.  Is there any way I can do that easily and with no pain?  I know about the move type functionality, but it seems like it will only do it within the same project.</p>

<p>Any help would be greatly appreciated</p>

<p>Thanks!</p>
","<visual-studio-2008><refactoring><projects-and-solutions><resharper-4.5>","4","248","2010-02-25 22:37:22"
"2340423","Routes - Tidily define multiple resources with customisation","<p>My routes are getting out of hand due to the fact that this isn't possible (correct me if I'm wrong):</p>

<pre><code>map.resources :english_pages, :as =&gt; :english, :spanish_pages, :as =&gt; :spanish do |article|
</code></pre>

<p>Due to nested routes things are spiralling out of control (tidiness).</p>

<pre><code>map.resources :english_pages, :as =&gt; :english, :member =&gt; {:manage =&gt; :get} do |article|
  article.resources :topics do |topic|
    topic.resources :posts
  end
end
map.resources :spanish_pages, :as =&gt; :spanish do |article|
  article.resources :topics do |topic|
    topic.resources :posts
  end
end
</code></pre>

<p>How can I avoid duplication of this:</p>

<pre><code>article.resources :topics do |topic|
  topic.resources :posts
end
</code></pre>

<p>Is there some way to store routes as a block somewhere, or perhaps define, in my case, english_pages and spanish pages aliases seperately?</p>

<p>Thanks very much in advance.</p>
","<ruby-on-rails><routing><refactoring>","1","91","2010-02-26 08:56:00"
"2345760","Java refactor to Generics industry standards","<p>There seems to be some debate over refactoring to utilize java generics within my current team.  The question I have is what are the current industry standards in terms of refactoring older Java code to take advantage of some of these features?  Of course by industry standards I am referring to best practices.  A link to a book or a site with these listed will be awarded the answer vote as that is the least subjective way to handle this question.</p>
","<java><generics><refactoring>","2","441","2010-02-27 00:46:01"
"2359646","Deleting large chunks of PHP effectively","<p>I've just inherited a project, and been told that an entire folder, ""includes/"" needs to be removed due to licensing issues -- We don't have the right to redistribute the files in that folder, so we need to cut our dependencies on them, and fix whatever breaks. I've been told ""Less than 5% of the lines in that folder are ever even called by our program"", but I have no way of verifying this.</p>

<p>There are about 50 files in the folder, each with a couple hundred lines of code. There is no unit testing currently in place. There's one master file, include.php, that <code>require()s</code> all 49 other files, so I can't just grep for any file doing <code>import()</code> on 'includes/.*'.</p>

<p>This is about as much detail as I've really figured out at this point. I spent all last week reading through the files in the includes/ folder, and it won't be hard to rewrite any of this, but I'm having trouble deciding where to start. I tried deleting the folder and slowly fixing things that break, but I'm afraid that this route will cause me to miss some crucial functions in my rewrite.</p>

<p>Can anyone point me in a direction to get started? Are there tools that will simplify this process? I'm looking at xdebug right now, but I'm not sure exactly how I'd use it for this.</p>

<p>Thanks in advance!</p>
","<php><refactoring><deleting>","3","82","2010-03-01 22:41:46"
"2361721","Refactoring: How to refactor with an unknown type?","<p>I don't know how to use the ""T"" and I never understood it quite well, but I'm sure that the answer will reside in anything around it ...</p>

<p>I have a huge switch that all it does is apply an Attribute to an object and add the control  to a collection, kind of Extract > Apply Attribute > Add, like:</p>

<p><strong>1st switch</strong></p>

<pre><code>foreach (AdwizaControl control in form.AdwizaControls)
{
    Panel panel = new Panel();
    int x = 0, y = 0;
    switch (control.Type)
    {

        case ControlType.CheckBox:
            AdwizaCheckBox checkbox = (AdwizaCheckBox)control.AdwizaWebControl;
            x = checkbox.X;
            y = checkbox.Y;
            panel.Controls.Add(checkbox);
            break;
        case ControlType.Bevel:
            AdwizaBevel bevel = (AdwizaBevel)control.AdwizaWebControl;
            bevel.Width = bevel.W;
            bevel.Height = bevel.H;
            panel.Controls.Add(bevel);
            break;
</code></pre>

<p>checkbox.X and checkbox.Y are properties from a Definition XML and here we are setting the control to that size</p>

<p>...</p>

<p><strong>2nd switch</strong> (to loop through controls that are inside a RadPageView (Telerik component)</p>

<pre><code>foreach (RadPageView pageView in multiPage.PageViews)
{
    int controlCount = pageView.Controls.Count;

    for (int i = 0; i &lt; controlCount; i++)
    {
        if (pageView.Controls[i].GetType() == typeof(AdwizaControl))
        {
            switch (((AdwizaControl)pageView.Controls[i]).Type)
            {
</code></pre>

<p>...</p>

<pre><code>case ControlType.Grid:
    AdwizaGrid pageViewGrid = (AdwizaGrid)((AdwizaControl)pageView.Controls[i]).AdwizaWebControl;
    pageViewGrid.Attributes.Add(
        ""style"", string.Format(""position:absolute;top:{0}px;left:{1}px;"", pageViewGrid.Y + increaseY, pageViewGrid.X + increaseX));
    pageView.Controls.Add(pageViewGrid);
    break;
case ControlType.Hyperlink:
    AdwizaHyperlink pageViewHyperlink = (AdwizaHyperlink)((AdwizaControl)pageView.Controls[i]).AdwizaWebControl;
    pageViewHyperlink.Attributes.Add(
        ""style"", string.Format(""position:absolute;top:{0}px;left:{1}px;"", pageViewHyperlink.Y + increaseY, pageViewHyperlink.X + increaseX));
    pageView.Controls.Add(pageViewHyperlink);
    break;
case ControlType.ImageBox:
    AdwizaImageBox pageViewImageBox = (AdwizaImageBox)((AdwizaControl)pageView.Controls[i]).AdwizaWebControl;
    pageViewImageBox.Attributes.Add(
        ""style"", string.Format(""position:absolute;top:{0}px;left:{1}px;"", pageViewImageBox.Y + increaseY, pageViewImageBox.X + increaseX));
    pageView.Controls.Add(pageViewImageBox);
    break;
case ControlType.Label:
    AdwizaLabel pageViewlabel = (AdwizaLabel)((AdwizaControl)pageView.Controls[i]).AdwizaWebControl;
    pageViewlabel.Attributes.Add(
        ""style"", string.Format(""position:absolute;top:{0}px;left:{1}px;"", pageViewlabel.Y + increaseY, pageViewlabel.X + increaseX));
    pageView.Controls.Add(pageViewlabel);
    break;
case ControlType.Slavebox:
    AdwizaSlavebox pageViewSlavebox = (AdwizaSlavebox)((AdwizaControl)pageView.Controls[i]).AdwizaWebControl;
    pageViewSlavebox.Attributes.Add(
        ""style"", string.Format(""position:absolute;top:{0}px;left:{1}px;"", pageViewSlavebox.Y + increaseY, pageViewSlavebox.X + increaseX));

    pageView.Controls.Add(pageViewSlavebox);
    break;
case ControlType.Repeatbox:
    AdwizaRepeatBox pageViewrepeatbox = (AdwizaRepeatBox)((AdwizaControl)pageView.Controls[i]).AdwizaWebControl;
    pageViewrepeatbox.Attributes.Add(
        ""style"", string.Format(""position:absolute;top:{0}px;left:{1}px;"", pageViewrepeatbox.Y + increaseY, pageViewrepeatbox.X + increaseX));
    pageView.Controls.Add(pageViewrepeatbox);
    break;
</code></pre>

<p>it is bigger as it has to cover all objects I'm using...</p>

<p>How can I to this in a simple call? Kind like:</p>

<pre><code>ApplyPositionAttribute(
    ((AdwizaControl)pageView.Controls[i]).AdwizaWebControl);
</code></pre>

<p>Is there a way to simplify this?</p>

<hr>

<p><strong>Added</strong>
The switch statement</p>
","<c#><refactoring><asp.net-2.0>","0","177","2010-03-02 08:29:06"
"2361796","Refactoring an id type","<p>My application uses an <code>int</code> as id to identify objects in both in-memory and persistent registry. Functions in the application receive the id as argument, retrieve the object from the registry and do their job, e.g. </p>

<pre><code>void print( int id, int bar, double zip, int boo )
{
    Object *obj = get_obj_by_id( id );
    obj-&gt;print( bar, zip, boo );
}
</code></pre>

<p>The application has evolved and now it is possible to have more than one registry in the same application. The application now uses a globally accessible 'current' registry, which, as globals tend to do, causes a lot of trouble.</p>

<p>To get rid of the concept of a global 'current' registry, I would need to introduce a type that uniquely identifies the object across registries. I cannot change the value of the <code>int</code> that is being used, so I have to create a <code>full_id</code> type from the <code>int</code> id and an identification of the registry. 
The example function hence would have to change to </p>

<pre><code>void print( full_id id, int bar, double zip, int boo )
{
    Object *obj = get_obj_by_id( id );
    obj-&gt;print( bar, zip, boo );
}
</code></pre>

<p>There are conventions about the naming of id arguments, but these are not rigorously followed throughout the application, so I cannot make assumptions about the name of the id argument, or that it is always the first argument. Also there are many many functions that that have to be changed. What is the most efficient and reliable way to replace the <code>int</code> typed ids by <code>full_id</code> typed ids?</p>
","<c++><c><refactoring>","1","99","2010-03-02 08:45:06"
"2362982","jQuery dynamically create table/tr/td or etc and append attributes","<p>In an example I am having this structure (small example):</p>

<pre><code>&lt;table id=example&gt;
&lt;tr class=""blah test example""&gt;&lt;td&gt;Test1&lt;/td&gt;&lt;td&gt;&lt;a href=""url""&gt;LINK&lt;/a&gt;Test11&lt;/td&gt;&lt;/tr&gt;
&lt;tr class=""blah test example""&gt;&lt;td&gt;Test2&lt;/td&gt;&lt;td&gt;&lt;a href=""url""&gt;LINK&lt;/a&gt;Test22&lt;/td&gt;&lt;/tr&gt;
&lt;tr class=""blah test example""&gt;&lt;td&gt;Test3&lt;/td&gt;&lt;td&gt;&lt;a href=""url""&gt;LINK&lt;/a&gt;Test33&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
</code></pre>

<p>In jQuery I would create it dynamically like:</p>

<pre><code>var test = ""&lt;table id="" + someIDVar + ""&gt;""
           + ""&lt;tr class="" + classOneVar 
+ classTwoVar + classThreeVar + ""&gt;""....
</code></pre>

<p>and etc etc... (lots of other stuff to write). After I would just append it:</p>

<pre><code>$("".somePlaceInHtml"").append(test);
</code></pre>

<p>So is there any other way to write such a structure dynamically with jQuery? This is a problem for me because I am having a big structure, not as small as I showed in the example. The main reason is I want to get better readability for myself and other developers who will maintain this code. Thanks for any advice!</p>
","<javascript><jquery><table><refactoring>","1","6529","2010-03-02 12:18:13"
"2366401","Refactoring method with many conditional return statements","<p>I have a method for validation that has many conditional statements.  Basically it goes </p>

<pre><code>If Check1 = false 
  return false
If Check2 = false
  return false
etc
</code></pre>

<p>FxCop complains that the cyclomatic complexity is too high.  I know that it is not best practice to have return statements in the middle of functions, but at the same time the only alternative I see is an ugly list of If-else statements.  What is the best way to approach this?</p>

<p>Thanks in advance.</p>
","<.net><refactoring><code-analysis><fxcop>","3","341","2010-03-02 20:12:38"
"2366280","Is there any way to trace through the execution of a batch file?","<p>I inherited some large batch files, and I'd like to rewrite them to a more ""developer friendly"" language. </p>

<p>I'd like to find out the following things:</p>

<ul>
<li>what other scripts it calls</li>
<li>what other processes it starts</li>
<li>what files does it write to</li>
<li>what environment variables it uses, which ones does it set</li>
</ul>

<p>For the last point, I'm aware I can do this before I start:</p>

<pre><code>set &gt; original_environment.txt
</code></pre>

<p>And after I run it, I can do this:</p>

<pre><code>set &gt; new_environment.txt
</code></pre>

<p>and just do a diff between them ... but I'll probably miss some variables that may be unset when the script finishes ( or even all of them if the script's ran under <code>setlocal</code> ). </p>

<p>Is there any way of finding all those things without me adding tons of echo statements throughout the script code? 
Is there such a tool that can monitor the process started by the batch file and tell me everything it did?</p>
","<winapi><refactoring><batch><environment><batch-file>","6","726","2010-03-02 19:54:23"
"2367056","Rails generate url from array with parameters","<p>I wondered if there's some way to do this</p>

<pre><code>polymorphic_path([@page, @image])
</code></pre>

<p>but like this</p>

<pre><code>polymorphic_path([@page, :image_id =&gt; 1])
</code></pre>

<p>It's for the purposed of refactoring where I'd like to throw various params into the array and where they're null, they're ignored, but otherwise they generate the relevant nested url. </p>

<p>Thanks in advance. </p>
","<ruby-on-rails><refactoring><routing><polymorphic>","1","868","2010-03-02 21:47:33"
"2373335","How can I improve our CM.AppSettings references","<p>ASP.NET 3.5</p>

<p>Classes throughout our solution referenced ConfigurationManater.AppSettings[""""] to get appSettings (from web.config).</p>

<p>We decided we weren't happy with that.  Folks were mistyping appSetting key names in code (which compiled fine), and it was cumbersome to track usages.  And then there's the duplicated strings throughout the codebase as you reference the same appSettings all over the place.</p>

<p>So, we decided that only one class would be allowed to reference the ConfigurationManager, and the rest of the solution would reference that class when it needed the value of a certain appSetting.  ConfigurationManater.AppSettings[""""] was static, so we exposed a bunch of static read-only properties off of our single Settings class.</p>

<pre><code>public class Settings {
    public static string Foo {
        get {
            return ConfigurationManager.AppSettings[""Foo""];
        }
    }
}
</code></pre>

<p>That worked pretty well, until we needed to mock the settings in our tests.  We created an interface to enable our mocking (was this a mistake of any kind?).</p>

<pre><code>public interface ISettings {
    string Foo {
        get;
        set;
    }

}

public class Settings : ISettings {
    public string Foo {
        get {
            return ConfigurationManager.AppSettings[""Foo""];
        }
    }
}
</code></pre>

<p>And now we're injecting the ISettings instance as a dependency of the objects which use settings values (the class/interface are in a project that everyone can reference without problems).</p>

<p>In places where we can't inject an existing instance (e.g. Global.asax), we construct a new instance into a static field.</p>

<p>Given all of that, what would you recommend we change, and why?</p>
","<asp.net><refactoring><application-settings><configuration-management>","1","40","2010-03-03 17:09:22"
"2389320","Resource for Refactoring tips geared towards JavaScript","<p>I'd like to start a discussion on the best resources for refactoring tips, with an eye towards Front-End JavaScript refactoring.</p>

<p>A friend whose opinion I respect suggests this <a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">book</a>, though it uses examples in Java. I understand that the principles of OO refactoring should translate to another language.</p>

<p>Let's talk about refactoring in general and JS refactoring specifically.</p>
","<javascript><refactoring><tips-and-tricks>","1","188","2010-03-05 19:19:14"
"2392459","Refactoring (and testing) for performance","<p>I have a library that provides a reflection API on top of describeType() (a method that returns an XML object with all the specs of a class or instance). Since this library is used in several other libraries and frameworks, I really want it to be as fast as possible.</p>

<p>The problem I'm facing is that I'm not sure about the best approach to refactor this libraries' code and make it possible to test and compare the results. I could easily add timers to the code, log the ouput and compare the results, but it seems like a lot of work to do this manually.</p>

<p>So this brings me to the following questions:</p>

<ul>
<li>Has anyone done something similar before?</li>
<li>How did you test and compare the results of the changes?</li>
<li>Is there perhaps any testing framework (also non-actionscript) that helps in performance testing in such a scenario?</li>
<li>Do you have any other general tips?</li>
</ul>
","<actionscript-3><testing><refactoring><performance>","0","183","2010-03-06 12:39:24"
"2395410","How I can refactor imap nmap vmap code in vim?","<p>I can such code in my .vimrc file:</p>

<pre><code>imap &lt;D-1&gt; &lt;ESC&gt;1gt
vmap &lt;D-1&gt; 1gt
nmap &lt;D-1&gt; 1gt

imap &lt;D-2&gt; &lt;ESC&gt;2gt
vmap &lt;D-2&gt; 2gt
nmap &lt;D-2&gt; 2gt

imap &lt;D-3&gt; &lt;ESC&gt;3gt
vmap &lt;D-3&gt; 3gt
nmap &lt;D-3&gt; 3gt

imap &lt;D-4&gt; &lt;ESC&gt;4gt
vmap &lt;D-4&gt; 4gt
nmap &lt;D-4&gt; 4gt

imap &lt;D-5&gt; &lt;ESC&gt;5gt
vmap &lt;D-5&gt; 5gt
nmap &lt;D-5&gt; 5gt

imap &lt;D-6&gt; &lt;ESC&gt;6gt
vmap &lt;D-6&gt; 6gt
nmap &lt;D-6&gt; 6gt

imap &lt;D-7&gt; &lt;ESC&gt;7gt
vmap &lt;D-7&gt; 7gt
nmap &lt;D-7&gt; 7gt

imap &lt;D-8&gt; &lt;ESC&gt;8gt
vmap &lt;D-8&gt; 8gt
nmap &lt;D-8&gt; 8gt

imap &lt;D-9&gt; &lt;ESC&gt;9gt
vmap &lt;D-9&gt; 9gt
nmap &lt;D-9&gt; 9gt
</code></pre>

<p>How I can refactor this code?</p>
","<vim><refactoring><macvim>","1","321","2010-03-07 06:33:20"
"2398666","Python: Can subclasses overload inherited methods?","<p>I'm making a shopping cart app in Google App Engine. I have many classes that derive from a base handler:</p>

<pre><code>class BaseHandler(webapp.RequestHandler):
    def get(self, CSIN=None):
        self.body(CSIN)
</code></pre>

<p>Does this mean that the <code>body()</code> method of every descendant class needs to have the same argument? This is cumbersome. Only one descendant actually uses that argument. And what about when I add new args? Do I need to go through and change every class?</p>

<pre><code>class Detail(BaseHandler):
    def body(self, CSIN):

class MainPage(BaseHandler):
    def body(self, CSIN=None): #@UnusedVariable

class Cart(BaseHandler):
    def body(self, CSIN): #@UnusedVariable
</code></pre>
","<python><oop><google-app-engine><refactoring><method-overloading>","0","717","2010-03-08 00:38:34"
"2397885","How to correctly refactor this?","<p>I have trouble finding way to correctly refactor this code so that there would be as little duplicate code as possible, I have a couple of methods like this (pseudocode):</p>

<pre><code>public List&lt;Something&gt; parseSomething(Node n){
  List&lt;Something&gt; somethings = new ArrayList&lt;Something&gt;();
  initialize();
  sameCodeInBothClasses();
  List&lt;Node&gt; nodes = getChildrenByName(n, ""somename"");
  for(Node n:nodes){
    method();
    actionA();
    somethings.add(new Something(actionB());
  }
  return somethings;
}
</code></pre>

<p>methods <code>sameCodeInBothClasses()</code> are same in all classes but where it differs is what hapens in for loop <code>actionA()</code> and it also adds an element to the List of different type. </p>

<p>Should I use Strategy pattern for the different parts inside loop? </p>

<p>What about the return value (The type of list differs), should the method return just <code>List&lt;Object&gt;</code> that I would then cast to appropriate type? Should I pass the class I want to return as parameter?</p>
","<java><oop><refactoring>","2","221","2010-03-07 20:40:18"
"2404311","How to refactor logging in C#?","<p>In my services all exposed methods have:</p>

<pre><code>try
{
    // the method core is written here
}
catch(Exception ex)
{
    Log.Append(ex);
}
</code></pre>

<p>It's boring and ugly to repeat it over and over again. Is there any way to avoid that? Is there a better way to keep the service working even if exceptions occur and keep sending the exception details to the <code>Log</code> class?</p>
","<c#><.net><logging><refactoring>","5","306","2010-03-08 20:02:17"
"2405424","Getting jQuery to return an ajax object","<p>The question title is a bit strange because I'm not exactly sure how to phrase the problem.  The issue is that I have many links to which I want to bind a click event with an ajax call, and I'm just looking to refactor some duplicate code into a single area.</p>

<p>The links I'm trying to bind an ajax call only have one thing that differentiates them, and that's an id from a previously declared object.  So I have lots of code that looks like this:</p>

<pre><code>$(""a.link"").bind('click', function() {
           id = obj.id; 
           $.ajax({ 
                   url: ""/set/"" + id, 
                   dataType: 'json', 
                   type: ""POST"" 
           }) 
    });
</code></pre>

<p>I was trying to refactor it into something like this:</p>

<p>$(""a.link"").bind('click', ajax_link(obj.id));</p>

<pre><code> function ajax_link(id) {
      $.ajax({ 
             url: ""/set/"" + id, 
             dataType: 'json', 
             type: ""POST"" 
      }) 
 });
</code></pre>

<p>However, as you can imagine, this just actually makes the ajax call when the element is binded with the click event.</p>

<p>Is there an easy way to refactor this code so I can extract out the common ajax code into its own function, and hopefully reduce the number of lines of jQuery in my current script?</p>
","<jquery><ajax><refactoring>","0","83","2010-03-08 22:56:19"
"2406989","Multiple presenters interaction","<p>I have two views each with their own presenters and they need a two way communication between them. Like if the user name changes in View A, presenter A needs to notify presenter B of the change and vice versa. Should I create a high level presenter/eventHandler that gets notified when either A or B needs to trigger an event or is there a better way?</p>
","<design-patterns><refactoring>","1","60","2010-03-09 06:06:03"
"2407038","moqing static method call to c# library class","<p>This seems like an easy enough issue but I can't seem to find the keywords to effect my searches.</p>

<p>I'm trying to unit test by mocking out all objects within this method call. I am able to do so to all of my own creations except for this one:</p>

<pre><code>public void MyFunc(MyVarClass myVar)
{
    Image picture;
    ...

    picture = Image.FromStream(new MemoryStream(myVar.ImageStream));

    ...
}
</code></pre>

<p>FromStream is a static call from the Image class (part of c#). So how can I refactor my code to mock this out because I really don't want to provide a image stream to the unit test.</p>
","<unit-testing><refactoring><moq>","3","590","2010-03-09 06:21:54"
"2412236","Refactoring large method in .NET","<p>If I have a large .NET method, I want to know if it is good practice to split it up into multiple methods or not.  My concerns are:
1 - Is there any point creating a method if it will only be called once?<br>
2 - If I'm calling a private method from within my class, I try not to use instance variables.  Is this good or bad practice?  For example:</p>

<pre><code>var a, b;
public void TestMe
{
   FirstTest(a,b);
}
private void FirstTest(paramA, paramB)
{
         //code here with passed in parameters
}

//instead of:
private void FirstTest()
{
      //code here with instance variables a,b
}  
</code></pre>

<p>edit: replace global with instance</p>
","<language-agnostic><refactoring><methods><static-methods>","6","208","2010-03-09 20:17:12"
"2413028","Rails helper methods","<p>I'm doing some <strong>refactoring</strong> on a piece of code I have, and am thinking of moving some stuff from the model into helper methods.</p>

<p>Nothing major, but my model does some screen-scraping, and I need to treat (and filter) some of the strings returned, so they are passed back to the controller nicely formatted.</p>

<p>I've been using helper methods with my view already.</p>

<p>My question is, is it a good practice to use helper methods with the model, or should I simply add my string cleaning methods in the model itself?</p>

<p>Thanks in advance</p>
","<ruby-on-rails><refactoring>","0","131","2010-03-09 22:21:38"
"2425727","ASP.NET: Reusing the same Repeater ItemTemplate","<p>I'm currently using a certain <code>ItemTemplate</code> for three repeaters that are all on the same page, but they are all bound to different data sources. Is there any way to refactor my web form <em>without</em> using a user control to easily refer to this template so I will only have to define it once?</p>
","<c#><asp.net><refactoring><repeater><dry>","2","404","2010-03-11 14:32:41"
"2425731","What are the most frequent Code Smells encountered and for which languages?","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/114342/what-are-code-smells-what-is-the-best-way-to-correct-them"">What are Code Smells? What is the best way to correct them?</a>  </p>
</blockquote>



<p>We've all run across (as well as produced) <a href=""http://en.wikipedia.org/wiki/Code_smell"" rel=""nofollow"">""code smells""</a>.
There are many kinds as documented <a href=""http://www.soberit.hut.fi/mmantyla/BadCodeSmellsTaxonomy.htm"" rel=""nofollow"">here</a>.  </p>

<p>What I'm interested in is what's the funk responsible for the funkiest code.  It is difficult when writing code to maintain the perspective needed to analyze your own mistakes, but while reading code, especially someone else's, they jump out at you.  Some, one catches more whiffs of while refactoring and debugging than others.</p>

<p>So, when you are deep in the code and something tickles your nose, what is it most likely to be?</p>

<p>edit: Please note the language you are using when you answer.  Hopefully we might learn which code smells are endemic to which languages and/or design philosophies.  Don't worry about explaining fixes as there are plenty of resources for that already.</p>
","<debugging><refactoring>","3","119","2010-03-11 14:33:35"
"2432256","How far did DevExpress get with Javascript refactoring?","<p>Over a year ago, I remember watching one of DevExpress evangelists previewing or at least promoting rich Javascript refactoring (beyond just limited intellisense) within the Visual Studio shell, I recall part of CodeRush/DevExpress product line. I was excited. </p>

<p>On checking today (lmgtfy) I can find only very very limited reference to it, just one small italtic line about beta in product description, no videos, no blog posts, no community buzz. Was it dropped? Vapourware? Poor implementation that they dont even promote it?</p>

<p>With Javascript arguably the most popular programming language ever and with a VM for it on practically every machine in last 10 years, why is editor support so poor? (Compared with those for Java and C#)? You see the likes of ScottGu bragging we now have jQuery intellisense but compare this to richness of C# support in the IDE it is a joke. </p>

<p>Someone once said since there are many style of writing Javascript a rich IDE (beyond intellisense) with refactoring support is difficult,  but if several engines can interpret/compile JS with same result surely it should be hard to analysis it to support stuff like rename variable, extract method, move to another namespace (or JS minic of it), etc.. Am I wrong?</p>
","<javascript><refactoring><devexpress>","10","1325","2010-03-12 11:10:54"
"2431987","How to refactor these generic methods?","<p><strong>UPDATE: I should have mentioned in the original post that I want to learn more about generics here. I am aware that this can be done by modifying the base class or creating an interface that both document classes implement. But for the sake of this exercise I'm only really interested in solutions that do not require any modification to the document classes or their base class. I thought that the fact that the question involves extension methods would have implied this.</strong></p>

<p>I have written two nearly identical generic extension methods and am trying to figure out how I might refactor them into a single method. They differ only in that one operates on List and the other on List, and the properties I'm interested in are AssetID for AssetDocument and PersonID for PersonDocument. Although AssetDocument and PersonDocument have the same base class the properties are defined in each class so I don't think that helps. I have tried</p>

<pre><code>public static string ToCSVList&lt;T&gt;(this T list) where T : List&lt;PersonDocument&gt;, List&lt;AssetDocument&gt;
</code></pre>

<p>thinking I might then be able to test the type and act accordingly but this results in the syntax error </p>

<blockquote>
  <p>Type parameter 'T' inherits
  conflicting constraints</p>
</blockquote>

<p>These are the methods that I would like to refactor into a single method but perhaps I am simply going overboard and they would best be left as they are. I'd like to hear what you think.</p>

<pre><code>public static string ToCSVList&lt;T&gt;(this T list) where T : List&lt;AssetDocument&gt;
{
  var sb = new StringBuilder(list.Count * 36 + list.Count);
  string delimiter = String.Empty;

  foreach (var document in list)
  {
    sb.Append(delimiter + document.AssetID.ToString());
    delimiter = "","";
  }

  return sb.ToString();
}

public static string ToCSVList&lt;T&gt;(this T list) where T : List&lt;PersonDocument&gt;
{
  var sb = new StringBuilder(list.Count * 36 + list.Count);
  string delimiter = String.Empty;

  foreach (var document in list)
  {
    sb.Append(delimiter + document.PersonID.ToString());
    delimiter = "","";
  }

  return sb.ToString();
}
</code></pre>
","<c#><generics><refactoring>","5","276","2010-03-12 10:27:47"
"2433027","What is a faster way of merging the values of this Python structure into a single dictionary?","<p>I've refactored how the merged-dictionary (<code>all_classes</code>) below is created, but I'm wondering if it can be more efficient.</p>

<p>I have a dictionary of dictionaries, like this:</p>

<pre><code>groups_and_classes = {'group_1': {'class_A': [1, 2, 3],
                                  'class_B': [1, 3, 5, 7], 
                                  'class_c': [1, 2], # ...many more items like this
                                 },
                      'group_2': {'class_A': [11, 12, 13],
                                  'class_C': [5, 6, 7, 8, 9]
                                 }, # ...and many more items like this
                     }
</code></pre>

<p>A function creates a new object from <code>groups_and_classes</code> like this (the function to create this is called often):</p>

<pre><code>all_classes = {'class_A': [1, 2, 3, 11, 12, 13],
               'class_B': [1, 3, 5, 7, 9],
               'class_C': [1, 2, 5, 6, 7, 8, 9]
              }
</code></pre>

<p>Right now, there is a loop that does this:</p>

<pre><code>all_classes = {}
for group in groups_and_classes.values():
    for c, vals in group.iteritems():
        for v in vals:
            if all_classes.has_key(c):
                if v not in all_classes[c]:
                    all_classes[c].append(v)
            else:
                all_classes[c] = [v]
</code></pre>

<p>So far, I changed the code to use a <code>set</code> instead of a <code>list</code> since the order of the list doesn't matter <em>and</em> the values need to be unique:</p>

<pre><code>all_classes = {}
for group in groups_and_classes.values():
    for c, vals in group.iteritems():
        try:
            all_classes[c].update(set(vals))
        except KeyError:
            all_classes[c] = set(vals)
</code></pre>

<p>This is a little nicer, and I didn't have to convert the sets to lists because of how <code>all_classes</code> is used in the code.</p>

<p><strong>Question</strong>: Is there a more efficient way of creating <code>all_classes</code> (aside from building it at the same time <code>groups_and_classes</code> is built, and changing everywhere this function is called)?</p>
","<python><data-structures><refactoring><performance>","3","101","2010-03-12 13:34:37"
"2437692","remove duplicate code in java","<pre><code>class A extends ApiClass
{
   public void duplicateMethod()
   {
   }
}    


class B extends AnotherApiClass
{
   public void duplicateMethod()
   {
   }
}
</code></pre>

<p>I have two classes which extend different api classes. The two class has some duplicate
methods(same method repeated in both class) and how to remove this duplication?</p>

<h1>Edit</h1>

<p>Both ApiClass and AnotherApiClass are not under my control</p>
","<java><refactoring><code-duplication>","1","999","2010-03-13 07:55:05"
"2437783","Turning one file with lots of classes to many files with one class per file","<p>How do I turn one file with lots of classes to many files with one class per file? (C\C++)</p>

<p>So I have that file with such structure: Some includes and then lots of classes that sometimes call each other:</p>

<pre><code>#include &lt;wchar.h&gt;
#include &lt;stdlib.h&gt;
//...
class PG_1 {
  //...
}
class PG_2 {
  //...
}
//......
class PG_N {
  //...
}
</code></pre>
","<c++><refactoring>","4","265","2010-03-13 08:50:30"
"2462508","Method to concatenate 2 Strings in Java","<p>I have a method in Java that concatenates 2 Strings.  It currently works correctly, but I think it can be written better.</p>

<pre><code>public static String concat(String str1, String str2) {
  String rVal = null;
  if (str1 != null || str2 != null) {
    rVal = """";
    if (str1 != null) {
      rVal += str1;
    }
    if (str2 != null) {
      rVal += str2;
    }      
  }    
  return rVal;
}
</code></pre>

<p>Here are some of the requirements:</p>

<ol>
<li>If both str1 and str2 are null, the method returns null</li>
<li>If either str1 or str2 is null, it will just return the not null String</li>
<li>If str1 and str2 are not null, it will concatenate them</li>
<li>It never adds ""null"" to the result</li>
</ol>

<p>Can anyone do this with less code?</p>
","<java><string><refactoring><concatenation>","8","906","2010-03-17 13:24:32"
"2470653","Refactoring c / c++ in vim (e.g. method extraction like in eclipse.)","<p>Is there any plugins or built-in method in vim for performing refactoring on c or c++ code, something like the refactoring tools in eclipse?</p>

<p>I'm especially keen on the extract method refactoring tool from eclipse that will determine parameters from new method and typically also guess a variable to use as return value.</p>
","<c><eclipse><vim><refactoring><vim-plugin>","16","2655","2010-03-18 14:41:54"
"2470048","How to convert this procedural programming to object-oriented programming?","<p>I have a source code that is needed to be converted by creating classes, objects and methods.
So far, I've just done by converting the initial main into a separate class. But I don't know what to do with constructor and which variables are supposed to be private. This is the code :</p>

<pre><code>import java.util.*;

public class Card{

private static void shuffle(int[][] cards){

    List&lt;Integer&gt; randoms = new ArrayList&lt;Integer&gt;();
    Random randomizer = new Random();

    for(int i = 0; i &lt; 8;) {
      int r = randomizer.nextInt(8)+1;
      if(!randoms.contains(r)) {
        randoms.add(r);
        i++;
      }
    }

    List&lt;Integer&gt; clonedList = new ArrayList&lt;Integer&gt;();
    clonedList.addAll(randoms);
    Collections.shuffle(clonedList);
    randoms.addAll(clonedList);
    Collections.shuffle(randoms);

    int i=0;

    for(int r=0; r &lt; 4; r++){
        for(int c=0; c &lt; 4; c++){
            cards[r][c] = randoms.get(i);
            i++;
        }
    }
}

public static void play() throws InterruptedException {

    int ans = 1;
    int preview;
    int r1,c1,r2,c2;
    int[][] cards = new int[4][4];
    boolean[][] cardstatus = new boolean[4][4];
    boolean gameover = false;
    int moves;
    Scanner input = new Scanner(System.in);

    do{
        moves = 0;

        shuffle(cards);

        System.out.print(""Enter the time(0 to 5) in seconds for the preview of the answer : "");
        preview = input.nextInt();

        while((preview&lt;0) || (preview&gt;5)){
            System.out.print(""Invalid time!! Re-enter time(0 - 5) : "");
            preview = input.nextInt();
        }

        preview = 1000*preview;
        System.out.println("" "");

        for (int i =0; i&lt;4;i++){
            for (int j=0;j&lt;4;j++){

                System.out.print(cards[i][j]);
                System.out.print("" "");
            }
            System.out.println("""");
            System.out.println("""");
        }

        Thread.sleep(preview);

        for(int b=0;b&lt;25;b++){
            System.out.println("" "");
        }

        for(int r=0;r&lt;4;r++){
            for(int c=0;c&lt;4;c++){
                System.out.print(""*"");
                System.out.print("" "");
                cardstatus[r][c] = false;
            }
            System.out.println("""");
            System.out.println("" "");
        }

        System.out.println("""");

        do{
            do{
                System.out.print(""Please insert the first card row : "");
                r1 = input.nextInt();
                while((r1&lt;1) || (r1&gt;4)){
                    System.out.print(""Invalid coordinate!! Re-enter first card row : "");
                    r1 = input.nextInt();
                }

                System.out.print(""Please insert the first card column : "");
                c1 = input.nextInt();
                while((c1&lt;1) || (c1&gt;4)){
                        System.out.print(""Invalid coordinate!! Re-enter first card column : "");
                        c1 = input.nextInt();
                }

                if(cardstatus[r1-1][c1-1] == true){
                    System.out.println(""The card is already flipped!! Select another card."");
                    System.out.println("""");
                }
            }while(cardstatus[r1-1][c1-1] != false);

            do{
                System.out.print(""Please insert the second card row : "");
                r2 = input.nextInt();
                while((r2&lt;1) || (r2&gt;4)){
                    System.out.print(""Invalid coordinate!! Re-enter second card row : "");
                    r2 = input.nextInt();
                }

                System.out.print(""Please insert the second card column : "");
                c2 = input.nextInt();
                while((c2&lt;1) || (c2&gt;4)){
                    System.out.print(""Invalid coordinate!! Re-enter second card column : "");
                    c2 = input.nextInt();
                }

                if(cardstatus[r2-1][c2-1] == true){
                    System.out.println(""The card is already flipped!! Select another card."");
                }
                if((r1==r2)&amp;&amp;(c1==c2)){
                    System.out.println(""You can't select the same card twice!!"");
                    continue;
                }
            }while(cardstatus[r2-1][c2-1] != false);

            r1--;
            c1--;
            r2--;
            c2--;

            System.out.println("""");
            System.out.println("""");
            System.out.println("""");

            for(int r=0;r&lt;4;r++){
                for(int c=0;c&lt;4;c++){

                    if((r==r1)&amp;&amp;(c==c1)){
                        System.out.print(cards[r][c]);
                        System.out.print("" "");
                    }
                    else if((r==r2)&amp;&amp;(c==c2)){
                        System.out.print(cards[r][c]);
                        System.out.print("" "");
                    }
                    else if(cardstatus[r][c] == true){
                        System.out.print(cards[r][c]);
                        System.out.print("" "");
                    }
                    else{
                        System.out.print(""*"");
                        System.out.print("" "");
                    }
                }
                System.out.println("" "");
                System.out.println("" "");
            }

            System.out.println("""");

            if(cards[r1][c1] == cards[r2][c2]){
                System.out.println(""Cards Matched!!"");

                cardstatus[r1][c1] = true;
                cardstatus[r2][c2] = true;
            }
            else{
                System.out.println(""No cards match!!"");
            }

            Thread.sleep(2000);

            for(int b=0;b&lt;25;b++){
                System.out.println("""");
            }

            for(int r=0;r&lt;4;r++){
                for(int c=0;c&lt;4;c++){
                    if(cardstatus[r][c] == true){
                        System.out.print(cards[r][c]);
                        System.out.print("" "");
                    }
                    else{
                        System.out.print(""*"");
                        System.out.print("" "");
                    }
                }
                System.out.println("""");
                System.out.println("" "");
            }

            System.out.println("""");
            System.out.println("""");
            System.out.println("""");

            gameover = true;

            for(int r=0;r&lt;4;r++){
                for( int c=0;c&lt;4;c++){
                    if(cardstatus[r][c]==false){
                        gameover = false;
                        break;
                    }
                }
                if(gameover==false){
                    break;
                }
            }

            moves++;

        }while(gameover != true);

        System.out.println(""Congratulations, you won!!"");
        System.out.println(""It required "" + moves + "" moves to finish it."");
        System.out.println("""");
        System.out.print(""Would you like to play again? (1=Yes / 0=No) : "");
        ans = input.nextInt();

    }while(ans == 1);


}


}
</code></pre>

<p>The main class is:</p>

<pre><code>import java.util.*;

public class PlayCard{

public static void main(String[] args) throws InterruptedException{

    Card game = new Card();
    game.play();

    }
}
</code></pre>

<p>Should I simplify the Card class by creating other classes?</p>

<p>Through this code, my javadoc has no constructtor. So i need help on this!</p>
","<java><refactoring>","5","671","2010-03-18 13:19:10"
"2471260","Should I go back and fix work when you learn something new/better?","<p>Considering that we're all constantly learning, we've all got to come across a point where we learn something just awesome that improves our code or parts of it significantly. </p>

<p>The question is, when you've learned some new technique, strategy or whatever, do your or should you go back to code that you know works, but could be so much better/maintainable/faster/<em>generally improved</em> and implement this new knowledge?</p>

<p>I understand the concept of ""if it ain't broke, don't fix it"" but when does that become losing pride in code you've already written and what does it say for refactoring.</p>
","<refactoring>","17","402","2010-03-18 15:54:33"
"2475657","Overloaded function called with one parameter, but I thought I'd passed two","<p>I recently refactored code like this (<code>MyClass</code> to <code>MyClassR</code>).</p>

<pre><code>#include &lt;iostream&gt;

class SomeMember
{
public:
  double m_value;

  SomeMember() : m_value(0) {}
  SomeMember(int a) : m_value(a) {}
  SomeMember(int a, int b)
  : m_value(static_cast&lt;double&gt;(a) / 3.14159 +
            static_cast&lt;double&gt;(b) / 2.71828)
  {}
};


class MyClass
{
public:
SomeMember m_first, m_second, m_third;

MyClass(const bool isUp, const int x, const int y)
{
  if (isUp)
  {
    m_first = SomeMember(x);
    m_second = SomeMember(y);
    m_third = SomeMember(x, y);
  }
  else
  {
    m_first = SomeMember(y);
    m_second = SomeMember(x);
    m_third = SomeMember(y, x);
  }
}
};


class MyClassR
{
public:
SomeMember m_first, m_second, m_third;

MyClassR(const bool isUp, const int x, const int y)
: m_first(isUp ? x : y)
, m_second(isUp ? y : x)
, m_third(isUp ? x, y : y, x)
{
}
};


int main()
{
    MyClass a(true, 1, 2);
    MyClassR b(true, 1, 2);

    using namespace std;
    cout.precision(10);
    cout
        &lt;&lt; ""a:"" &lt;&lt; endl
        &lt;&lt; ""\tfirst: "" &lt;&lt; a.m_first.m_value 
        &lt;&lt; ""\tsecond: "" &lt;&lt; a.m_second.m_value 
        &lt;&lt; ""\tthird: "" &lt;&lt; a.m_third.m_value &lt;&lt; endl;

    cout
        &lt;&lt; ""b:"" &lt;&lt; endl
        &lt;&lt; ""\tfirst: "" &lt;&lt; b.m_first.m_value
        &lt;&lt; ""\tsecond: "" &lt;&lt; b.m_second.m_value
        &lt;&lt; ""\tthird: "" &lt;&lt; b.m_third.m_value &lt;&lt; endl;

    return 0;
}
</code></pre>

<ul>
<li>What is the error,</li>
<li>why does it compile (tested with VC6 <strong>as well as VC9 warning level 4</strong>: no complaints) and</li>
<li>what is the right way of doing it?  </li>
</ul>

<p>I (assume) I already have all these answers but I think it's and interesting problem to share.</p>

<p><strong>Update</strong><br>
Extended code so it's ""copy &amp; paste &amp; execute""-able. VC9 gave me no complaints either so <em>VC6 is not the problem here.</em><br>
For completeness, the output is:</p>

<pre><code>a:
        first: 1        second: 2       third: 1.054069532
b:
        first: 1        second: 2       third: 1.004499999
</code></pre>
","<c++><refactoring><ternary-operator>","2","435","2010-03-19 07:38:06"
"2480770","Suggestions on Working with this Inherited Generic Method","<p>We have inherited a project that is a wrapper around a section of the core business model. </p>

<p>There is one method that takes a generic, finds items matching that type from a member and then returns a list of that type.</p>

<pre><code>public List&lt;T&gt; GetFoos&lt;T&gt;()
{
    List&lt;IFoo&gt; matches = Foos.FindAll(
        f =&gt; f.GetType() == typeof(T)
    );

    List&lt;T&gt; resultList = new List&lt;T&gt;();
    foreach (var match in matches)
    {
        resultList.Add((T)obj);
    }
}
</code></pre>

<p>Foos can hold the same object cast into various classes in inheritance hierarchy to aggregate totals differently for different UI presentations.  There are 20+ different types of descendants that can be returned by GetFoos.</p>

<p>The existing code basically has a big switch statement copied and pasted throughout the code.  The code in each section calls GetFoos with its corresponding type.  </p>

<p>We are currently refactoring that into one consolidated area, but as we are doing that we are looking at other ways to work with this method.</p>

<p>One thought was to use reflection to pass in the type, and that worked great until we realized the Invoke returned an object, and that it needed to be cast somehow to the List &lt;T&gt;.</p>

<p>Another was to just use the switch statement until 4.0 and then use the dynamic language options.</p>

<p>We welcome any alternate thoughts on how we can work with this method.  I have left the code pretty brief, but if you'd like to know any additional details please just ask.</p>

<p><strong>Update</strong></p>

<p>The switch statement was originally using strings and the first pass was moving it into a Presenter with something like this: (No refactoring done on the switch, just where the data went).</p>

<pre><code>// called on an event handler in FooPresenter
// view is the interface for the ASPX page injected into FooPresenter's constructor
// wrapper is the instance of the model wrapper that has the GetFoos method
// selectedFooName is the value of a DropDownList in the Page
//  letting the user say how they want to see the animals
//   its either one big group (Animal)
//   or individual types (Tiger, Lion)
private void LoadFoos(string selectedFooName)
{
    switch (selectedFooName)
    {
        case ""Animal"":  // abstract base class for all other types
            this.view.SetData(this.wrapper.GetFoos&lt;Animal&gt;(); 

        case ""Lion"":
            this.view.SetData(this.wrapper.GetFoos&lt;Lion&gt;();
            break;

        case ""Tiger"":
            this.view.SetData(this.wrapper.GetFoos&lt;Tiger&gt;();    
            break;

        case ""Bear"":
            this.view.SetData(this.wrapper.GetFoos&lt;Bear&gt;();
            break;    
    }
}
</code></pre>

<p>The View implementation (codebehind for an ASPX page)</p>

<pre><code>public void SetData&lt;T&gt;(List&lt;T&gt; data)
{
    // there is a multiview on the page that contains user controls with 
    // grid layouts for the different types

    // there is a control for the common type of ""Animal""
    // and other controls for Tiger, Bear, etc

    // the controls contain a 3rd party grid of pain 
    // and the grids' binding event handlers cast the data item 
    // for the row and do some stuff with it specific to that type
}
</code></pre>

<p>Our first pass was going to be at least using the Type in the switch statement, or adding an enum.</p>

<p>I played around with using the Strategy Pattern but had to stop when I got to the loading factory returning the List again and realizing I didn't have the type.</p>
","<c#><generics><reflection><refactoring>","4","126","2010-03-19 21:43:34"
"2480961","Is search and replace the only way to rename an asp control in the code behind file?","<p>Is search and replace the only way to rename as asp control in the code behind file?
I find this extremely annoying, but it is the only way I can find. </p>

<p>Scenario:</p>

<p>I'll find a variable that needs renaming (Usually to meet naming convention)
I'll rename the variable in the aspx/ascx file.
I'll have to go in the code behind files and search and replace.
I get annoyed</p>

<p>Are there any better ways - preferably that would not touch a similarly named variable in another scope in the project.</p>

<p>I'm on VS2008 with resharper -- does VS2010 address this perhaps?</p>
","<c#><asp.net><refactoring>","0","39","2010-03-19 22:29:05"
"2484774","Is there a better way to write the find_messages_by_slug_or_404 method?","<p>In my messages_controller I have the following private method:</p>

<pre><code>def find_message_or_404(slug)
  message = user.messages.find_by_slug(slug)
  if message.nil?
    raise Error404
  end
  message
end
</code></pre>

<p>I find it not elegant and not very Rubist. Is there a way to improve it?</p>
","<ruby-on-rails><ruby><refactoring>","1","44","2010-03-20 21:04:56"
"2485259","Quick help refactoring Ruby Class","<p>I've written this class that returns feed updates, but am thinking it can be further improved. It's not glitchy or anything, but as a new ruby developer, I reckon it's always good to improve :-)</p>

<pre><code>class FeedManager
  attr_accessor :feed_object, :update, :new_entries

  require 'feedtosis'

  def initialize(feed_url)
    @feed_object = Feedtosis::Client.new(feed_url)
    fetch
  end

  def fetch
    @feed_object.fetch
  end

  def update
    @updates = fetch
  end

  def updated?
    @updates.new_entries.count &gt; 0 ? true : false
  end

  def new_entries
    @updates.new_entries
  end
end
</code></pre>

<p>As you can see, it's quite simple, but the things I'm seeing that aren't quite right are:</p>

<ol>
<li>Whenever I call fetch via terminal, it prints a list with the updates, when it's really supposed return an object.</li>
</ol>

<p>So as an example, in the terminal if I do something like:</p>

<pre><code>client = Feedtosis::Client.new('http://stackoverflow.com/feeds')
result = client.fetch
</code></pre>

<p>I then get:</p>

<pre><code>&lt;Curl::Easy http://stackoverflow.com/feeds&gt;
</code></pre>

<p>Which is exactly what I'd expect. However, when doing the same thing with ""inniting"" class with:</p>

<pre><code>FeedManager.new(""http://stackoverflow.com/feeds"")
</code></pre>

<p>I'm getting the object returning as an array with all the items on the feed.</p>

<p>Sure I'm doing something wrong, so any help refactoring this class will he greatly appreciated.</p>

<p>Also, I'd like to see comments about my implementation, as well as any sort of comment to make it better would be welcome.</p>

<p>Thanks in advance</p>
","<ruby-on-rails><ruby><refactoring><refactor-my-code>","3","170","2010-03-21 00:01:07"
"2488678","Java: Best practices for turning foreign horror-code into clean API...?","<p>I have a project (related to graph algorithms). It is written by someone else.</p>

<p>The code is horrible:</p>

<ul>
<li>public fields, no getters/setters</li>
<li>huge methods, all public</li>
<li>some classes have over 20 fields</li>
<li>some classes have over 5 constructors (which are also huge)</li>
<li>some of those constructors just leave many fields <code>null</code><br>
(so I can't make some fields final, because then every second constructor signals errors)</li>
<li>methods and classes rely on each other in both directions</li>
</ul>

<p>I have to rewrite this into a clean and understandable API.</p>

<p>Problem is: I myself don't understand anything in this code.</p>

<p>Please give me hints on analyzing and understanding such code.</p>

<p><em>I was thinking, perhaps, there are tools which perform static code analysis
and give me call graphs and things like this.</em></p>
","<java><api><refactoring><readability>","4","437","2010-03-21 20:57:13"
"2488992","Help with refactoring PHP code","<p>I had some troubles implementing Lawler's algorithm but thanks to SO and a bounty of 200 reputation I finally managed to write a working implementation:</p>

<p><a href=""http://stackoverflow.com/questions/2466928/lawlers-algorithm-implementation-assistance"">http://stackoverflow.com/questions/2466928/lawlers-algorithm-implementation-assistance</a></p>

<p>I feel like I'm using too many variables and loops there though so I am trying to refactor the code. It should be simpler and shorter yet remain readable.</p>

<p>Does it make sense to make a class for this? Any advice or even help with refactoring this piece of code is welcomed:</p>

<pre><code>&lt;?php

/*
 * @name Lawler's algorithm PHP implementation
 * @desc This algorithm calculates an optimal schedule of jobs to be
 *       processed on a single machine (in reversed order) while taking
 *       into consideration any precedence constraints.
 * @author Richard Knop
 *
 */

$jobs = array(1 =&gt; array('processingTime' =&gt; 2,
                         'dueDate'        =&gt; 3),
              2 =&gt; array('processingTime' =&gt; 3,
                         'dueDate'        =&gt; 15),
              3 =&gt; array('processingTime' =&gt; 4,
                         'dueDate'        =&gt; 9),
              4 =&gt; array('processingTime' =&gt; 3,
                         'dueDate'        =&gt; 16),
              5 =&gt; array('processingTime' =&gt; 5,
                         'dueDate'        =&gt; 12),
              6 =&gt; array('processingTime' =&gt; 7,
                         'dueDate'        =&gt; 20),
              7 =&gt; array('processingTime' =&gt; 5,
                         'dueDate'        =&gt; 27),
              8 =&gt; array('processingTime' =&gt; 6,
                         'dueDate'        =&gt; 40),
              9 =&gt; array('processingTime' =&gt; 3,
                         'dueDate'        =&gt; 10));
// precedence constrainst, i.e job 2 must be completed before job 5 etc
$successors = array(2=&gt;5,
                    7=&gt;9);
$n = count($jobs);
$optimalSchedule = array();

for ($i = $n; $i &gt;= 1; $i--) {

    // jobs not required to precede any other job
    $arr = array();
    foreach ($jobs as $k =&gt; $v) {

        if (false === array_key_exists($k, $successors)) {
            $arr[] = $k;
        }

    }

    // calculate total processing time
    $totalProcessingTime = 0;
    foreach ($jobs as $k =&gt; $v) {
        if (true === array_key_exists($k, $arr)) {
            $totalProcessingTime += $v['processingTime'];
        }
    }

    // find the job that will go to the end of the optimal schedule array
    $min = null;
    $x = 0;
    $lastKey = null;
    foreach($arr as $k) {
        $x = $totalProcessingTime - $jobs[$k]['dueDate'];
        if (null === $min || $x &lt; $min) {
            $min = $x;
            $lastKey = $k;
        }
    }

    // add the job to the optimal schedule array
    $optimalSchedule[$lastKey] = $jobs[$lastKey];
    // remove job from the jobs array
    unset($jobs[$lastKey]);
    // remove precedence constraint from the successors array if needed
    if (true === in_array($lastKey, $successors)) {
        foreach ($successors as $k =&gt; $v) {
            if ($lastKey === $v) {
                unset($successors[$k]);
            }
        }
    }

}

// reverse the optimal schedule array and preserve keys
$optimalSchedule = array_reverse($optimalSchedule, true);

// add tardiness to the array
$i = 0;
foreach ($optimalSchedule as $k =&gt; $v) {
    $optimalSchedule[$k]['tardiness'] = 0;
    $j = 0;
    foreach ($optimalSchedule as $k2 =&gt; $v2) {
        if ($j &lt;= $i) {
            $optimalSchedule[$k]['tardiness'] += $v2['processingTime'];
        }
        $j++;
    }
    $i++;
}

echo '&lt;pre&gt;';
print_r($optimalSchedule);
echo '&lt;/pre&gt;';
</code></pre>
","<php><refactoring>","0","151","2010-03-21 22:23:35"
"2489722","How to make freelance clients understand the costs of developing and maintaining mature products?","<p>I have a freelance web application project where the client requests new features every two weeks or so.  I am unable to anticipate the requirements of upcoming features.  So when the client requests a new feature, one of several things may happen:</p>

<ol>
<li><p>I implement the feature with ease
because it is compatible with the
existing platform</p></li>
<li><p>I implement the feature with
difficulty because I have to rewrite
a significant portion of the
platform's foundation</p></li>
<li><p>Client withdraws request because it
costs too much to implement against
existing platform</p></li>
</ol>

<p>At the beginning of the project, for about six months, all feature requests fell under category 1) because the system was small and agile.   But for the past six months, most feature implementation fell under category 2).  The system is mature, forcing me to refactor and test everytime I want to add new modules.  Additionally, I find myself breaking things that use to work, and fixing it (I don't get paid for this).</p>

<p>The client is starting to express frustration at the time and cost for me to implement new features.  To them, many of the feature requests are of the same scale as the features they requested six months ago.  For example, a client would ask, ""If it took you 1 week to build a ticketing system last year, why does it take you 1 month to build an event registration system today?  An event registration system is much simpler than a ticketing system.  It should only take you 1 week!""  Because of this scenario, I fear feature requests will soon land in category 3).  In fact, I'm already eating a lot of the cost myself because I volunteer many hours to support the project.</p>

<p>The client is often shocked when I tell him honestly the time it takes to do something.  The client always compares my estimates against the early months of a project.   I don't think they're prepared for what it really costs to develop, maintain and support a mature web application.</p>

<p>When working on a salary for a full time company, managers were more receptive of my estimates and even encouraged me to pad my numbers to prepare for the unexpected.   Is there a way to condition my clients to think the same way?</p>

<p>Can anyone offer advice on how I can continue to work on this web project without eating too much of the cost myself?</p>

<p><strong>Additional info</strong> - I've only been freelancing full time for 1 year.  I don't yet have the high end clients, but I'm slowly getting there.  I'm getting better quality clients as time goes by.</p>
","<refactoring><time-estimation>","15","196","2010-03-22 02:34:10"
"2491057","linq null refactoring code","<p>i have code</p>

<pre><code>public List&lt;Files&gt; List(int? menuId)
{
    if (menuId == null)
    {
        return _dataContext.Files.ToList();
    }
    else
    {
        return _dataContext.Files.Where(f =&gt; f.Menu.MenuId == menuId).ToList();
    }
}
</code></pre>

<p>is it possible to make it only one line like return _dataContext.Files.Where(f => f.Menu.MenuId == menuId).ToList();?</p>
","<.net><linq><entity-framework><refactoring><null>","2","49","2010-03-22 09:30:02"
"2492398","Removing unused local variables from .NET code","<p>Is there a tool available that can scan a C# or VB.NET project and automatically remove all unused local variables?</p>
","<.net><visual-studio><visual-studio-2010><refactoring>","14","1918","2010-03-22 13:10:27"
"2492525","Practical refactoring","<p>I've read about refactoring and probably did it before I even knew about it, however I don't really know much about it is actually done and what it practically means.</p>

<ul>
<li>What, from your view, is refactoring?</li>
<li>How and when do you do it?</li>
</ul>
","<design><refactoring>","4","184","2010-03-22 13:29:28"
"2500821","Find unused classes in a .net project","<p>I have a VS.NET 2008 project. Is it possible to check for classes that are not used anywere in the project? With FXcop I can find unused variables and unused code, but not unused classes.</p>
","<.net><visual-studio><tools><refactoring>","6","1387","2010-03-23 14:49:01"
"2503510","Does a version control database storage engine exist?","<p>I was just wondering if a storage engine type existed that allowed you to do version control on row level contents. For instance, if I have a simple table with ID, name, value, and ID is the PK, I could see that row 354 started as (354, ""zak"", ""test"")v1 then was updated to be (354, ""zak"", ""this is version 2 of the value"")v2 , and could see a change history on the row with something like select history (value) where ID = 354.</p>

<p>It's kind of an esoteric thing, but it would beat having to keep writing these separate history tables and functions every time a change is made...</p>
","<sql><mysql><database><refactoring-databases>","14","479","2010-03-23 20:50:02"
"2507359","Refactoring SQL","<p>Are there any formal techniques for refactoring SQL similar to this list <a href=""http://www.refactoring.com/catalog/index.html"" rel=""nofollow"">here</a> that is for code?</p>

<p>I am currently working on a massive query for a particular report and I'm sure there's plenty of scope for refactoring here which I'm just stumbling through myself bit by bit.</p>
","<sql><refactoring>","8","593","2010-03-24 11:55:54"
"2521045","Is it possible to create a domain model for legacy code without refactoring?","<p>I currently have a client that wants me to 'abstract' out a domain model from the existing code but they specifically said that I shouldn't refactor the existing code itself. My question is 1) whether or not this is advisable and 2) what techniques would you apply in this scenario if you can't refactor the code yet they expect you to come up with a model for it?</p>

<p>(EDIT: I can't quite put my finger on it, but somehow, not being able to refactor in this case just feels wrong. Has anyone else run into this type of scenario?)</p>
","<design><refactoring><domain-driven-design><programming-techniques>","0","147","2010-03-26 03:52:40"
"2522205","Etiquette for refactoring other people's sourcecode?","<p>Our team of software developers consists of a bunch of experienced programmers with a variety of programming styles and preferences. We do not have standards for everything, just the bare necessities to prevent total chaos.</p>

<p>Recently, I bumped into some refactoring done by a colleague. My code looked somewhat like this:</p>

<pre><code>public Person CreateNewPerson(string firstName, string lastName) {
    var person = new Person() {
        FirstName = firstName,
        LastName = lastName
    };
    return person;
}
</code></pre>

<p>Which was refactored to this:</p>

<pre><code>public Person CreateNewPerson (string firstName, string lastName) {
    Person person = new Person ();
           person.FirstName = firstName;
           person.LastName = lastName;
    return person;
    }
</code></pre>

<p>Just because my colleague needed to update some other method in one of the classes I wrote, he also ""refactored"" the method above. For the record, he's one of those developers that despises <a href=""http://en.wikipedia.org/wiki/Syntactic_sugar"" rel=""nofollow"">syntactic sugar</a> and uses a different bracket placement/identation scheme than the rest of us.</p>

<p>My question is: What is the (C#) programmer's etiquette for refactoring other people's sourcecode (both semantic and syntactic)? </p>
","<c#><refactoring><etiquette>","14","517","2010-03-26 09:39:44"
"2524337","Refactor instance declaration from try block to above try block in a method","<p>Often I find myself coming across code like this:</p>

<pre><code>try
{
  StreamWriter strw = new StreamWriter();
}
</code></pre>

<p>However, there is no reference to the object outside the scope of the try block. How could I refactor (extract to field in Visual Studio says there is no field or something) the statement in the try block so that it is declared above the try block so I can use it anywhere in the method?</p>

<p>Thanks</p>
","<visual-studio-2008><refactoring><resharper>","0","37","2010-03-26 15:18:36"
"2526140","In sql server, is there any way to check whether the schema change will impact on the stored procs?","<p>In SQL Server, is there any way to check whether the changes in the schema will impact Stored Procedures (and/or Views)?<br>
For example a change of the column name in one table, may break some Stored Procedures; how to check the impacted stored procs?</p>
","<sql-server><refactoring><schema><refactoring-databases>","0","260","2010-03-26 19:29:18"
"2527009","Dependency Injection: What's wrong with good old-fashioned refactoring?","<p>DI creates an extra layer of abstraction so that if your implementation class ever changes you can simply plug in a different class with the same interface.</p>

<p>But why not simply refactor when you want to use a different implementation class? Other languages like Python and Ruby work fine this way. Why not Java?</p>
","<java><refactoring><dependency-injection>","4","291","2010-03-26 21:55:46"
"2529849","Refactoring many nested ifs or chained if statements","<p>I have an object with large number of similar fields (like more than 10 of them) and I have to assign them values from an array of variable length. The solution would be either a huge nested bunch of ifs based on checking length of array each time and assigning each field </p>

<p>OR</p>

<p>a chain of ifs checking on whether the length is out of bounds and assigning each time after that check.</p>

<p>Both seem to be repetitive. Is there a better solution ? </p>
","<refactoring>","1","345","2010-03-27 15:39:06"
"2539728","How to refactor method which performs multiple steps (dependent on each other)?","<p>What is the best way to refactor a method which has many steps in it? For example, a method which setups some objects, creates several objects (Eg a database table), and so on - basically, one method which does a set of related steps.</p>

<p>Would this be best suited to the command design pattern?</p>

<p>Thanks</p>
","<design-patterns><refactoring>","4","133","2010-03-29 16:55:12"
"2539812","Refactor the following two C++ methods to move out duplicate code","<p>I have the following two methods that (as you can see) are similar in most of its statements except for one (see below for details)</p>

<pre><code>unsigned int CSWX::getLineParameters(const SURFACE &amp; surface, vector&lt;double&gt; &amp; params)
{
    VARIANT varParams;

    surface-&gt;getPlaneParams(varParams); // this is the line of code that is different

    SafeDoubleArray sdParams(varParams);

    for( int i = 0 ;  i &lt; sdParams.getSize() ; ++i )
    {
        params.push_back(sdParams[i]);
    }

    if( params.size() &gt; 0 ) return 0;
    return 1;
}

unsigned int CSWX::getPlaneParameters(const CURVE &amp; curve, vector&lt;double&gt; &amp; params)
{
    VARIANT varParams;

    curve-&gt;get_LineParams(varParams); // this is the line of code that is different

    SafeDoubleArray sdParams(varParams);

    for( int i = 0 ;  i &lt; sdParams.getSize() ; ++i )
    {
        params.push_back(sdParams[i]);
    }

    if( params.size() &gt; 0 ) return 0;
    return 1;
}
</code></pre>

<p>Is there any technique that I can use to move the common lines of code of the two methods out to a separate method, that could be called from the two variations - OR - possibly combine the two methods to a single method?</p>

<p>The following are the restrictions:</p>

<ol>
<li>The classes SURFACE and CURVE are from 3rd party libraries and hence unmodifiable. (If it helps they are both derived from IDispatch)</li>
<li>There are even more similar classes (e.g. FACE) that could fit into this ""template"" (not C++ template, just the flow of lines of code)</li>
</ol>

<p>I know the following could (possibly?) be implemented as solutions but am really hoping there is a better solution:</p>

<ol>
<li>I could add a 3rd parameter to the 2 methods - e.g. an enum - that identifies the 1st parameter (e.g. enum::input_type_surface, enum::input_type_curve)</li>
<li>I could pass in an IDispatch and try dynamic_cast&lt;> and test which cast is NON_NULL and do an if-else to call the right method (e.g. getPlaneParams() vs. get_LineParams())</li>
</ol>

<p>The following is not a restriction but would be a requirement because of my teammates resistance:</p>

<ol>
<li>Not implement a new class that inherits from SURFACE/CURVE etc. (They would much prefer to solve it using the enum solution I stated above)</li>
</ol>
","<c++><refactoring>","6","252","2010-03-29 17:08:44"
"2536769","Visual Studio - plugin finding/removing dead code?","<p>Anyone knows any <strong>free</strong> Visual Studio add-in that would find and/or delete dead (unused) code? I saw such possibility in MZ-Tools, but it's a little expensive as for private use ;)</p>
","<visual-studio><refactoring><plugins><add-in><dead-code>","2","1141","2010-03-29 09:04:45"
"2541724","Can someone help me refactor this C# linq business logic for efficiency?","<p>I feel like this is not a very efficient way of using linq. I was hoping somebody on here would have a suggestion for a refactor. I realize this code is not very pretty, as I was in a complete rush.</p>

<pre><code>public class Workflow
{

    public void AssignForms()
    {

        using (var cntx = new ProjectBusiness.Providers.ProjectDataContext())
        {
            var emplist = (from e in cntx.vw_EmployeeTaskLists where e.OwnerEmployeeID == null select e).ToList();
            foreach (var emp in emplist)
            {
                // if employee has a form assigned: break;

                if (emp.GRADE &gt; 15 || (emp.Pay_Plan.ToLower().Contains(""al"") || emp.Pay_Plan.ToLower().Contains(""ex"")))
                {
                    //Assign278();
                }
                else if ((emp.Series.Contains(""0905"") || emp.Series.Contains(""0511"") || emp.Series.Contains(""0110"") || emp.Series.Contains(""1801"")) || (emp.GRADE &gt;= 12 &amp;&amp; emp.GRADE &lt;= 15))
                {
                    var emptask = new ProjectBusiness.Providers.EmployeeTask();
                    emptask.TimespanID = cntx.Timespans.SingleOrDefault(t =&gt; t.BeginDate.Year == DateTime.Today.Year &amp; t.EndDate.Year == DateTime.Today.Year).TimespanID;
                    var FormID = (from f in cntx.Forms where f.FormName.Contains(""450"") select f.FormID).FirstOrDefault();
                    var TaskStatusID = (from s in cntx.TaskStatus where s.StatusDescription.ToLower() == ""not started"" select s.TaskStatusID).FirstOrDefault();
                    Assign450((int)emp.EmployeeID, FormID, TaskStatusID, emptask);
                    cntx.EmployeeTasks.InsertOnSubmit(emptask);
                }
                else
                {
                    //Assign185();
                }

            }
            cntx.SubmitChanges();
        }

    }

    private void Assign450(int EmployeeID, int FormID, int TaskStatusID, ProjectBusiness.Providers.EmployeeTask emptask)
    {
        emptask.FormID = FormID;
        emptask.OwnerEmployeeID = EmployeeID;
        emptask.AssignedToEmployeeID = EmployeeID;
        emptask.TaskStatusID = TaskStatusID;
        emptask.DueDate = DateTime.Today;
    }
}
</code></pre>
","<c#><linq><refactoring>","0","177","2010-03-29 22:39:59"
"2547915","Ctrl+R, Ctrl+R command not working","<p>I'm attempting to use the <kbd>Ctrl</kbd>+<kbd>R</kbd>, <kbd>Ctrl</kbd>+<kbd>R</kbd> command within Visual Studio 2008 to rename a variable.  I get an error message at the bottom saying that </p>

<p>""The key combination (<kbd>Ctrl</kbd>+<kbd>R</kbd>, <kbd>Ctrl</kbd>+<kbd>R</kbd>) is bound to command (&amp;Rename...) which is not currently available.""</p>

<p>I am not running it or anything I can think of which might prohibit modifications of the file and the F2 command allows a rename to happen.  Anyone know how to fix this?</p>

<p>EDIT:  I do have Resharper installed but was previously able to do this with the same setup, I recently migrated computers.</p>
","<c#><visual-studio-2008><refactoring><resharper>","5","2410","2010-03-30 19:05:29"
"2554413","C# searching for new Tool for the tool box, how to template this code","<p>All i have something i have been trying to do for a while and have yet to find a good strategy to do it, i am not sure C# can even support what i am trying to do.</p>

<p>Example imagine a template like this, repeated in manager code overarching cocept function Returns a result consisting of a success flag and error list.</p>

<pre><code>       public Result&lt;Boolean&gt; RemoveLocation(LocationKey key)
        {
           List&lt;Error&gt; errorList = new List&lt;Error&gt;();
           Boolean result = null;
           try{
                result  = locationDAO.RemoveLocation(key);
           }catch(UpdateException ue){
               //Error happened less pass this back to the user!
               errorList = ue.ErrorList;
           }

           return new Result&lt;Boolean&gt;(result, errorList);
        }
</code></pre>

<p>Looking to turn it into a template like the below where Do Something is some call (preferably not static) that returns a Boolean.  I know i could do this in a stack sense, but i am really looking for a  way to do it via object reference.</p>

<pre><code>        public Result&lt;Boolean&gt; RemoveLocation(LocationKey key)
        {
             var magic =  locationDAO.RemoveLocation(key);

             return ProtectedDAOCall(magic);
        }
        public Result&lt;Boolean&gt; CreateLocation(LocationKey key)
        {
             var magic =  locationDAO.CreateLocation(key);

             return ProtectedDAOCall(magic);
        }


        public Result&lt;Boolean&gt; ProtectedDAOCall(Func&lt;..., bool&gt; doSomething)
        {
           List&lt;Error&gt; errorList = new List&lt;Error&gt;();
           Boolean result = null;
           try{
                result  = doSomething();
           }catch(UpdateException ue){
               //Error happened less pass this back to the user!
               errorList = ue.ErrorList;
           }

           return new Result&lt;Boolean&gt;(result, errorList);
        }
</code></pre>

<p>If there is any more information you may need let me know.</p>

<p>I am interested to see what someone else can come up with.</p>

<hr>

<p><strong>Marc solution applied to the code above</strong></p>

<pre><code>    public Result&lt;Boolean&gt; CreateLocation(LocationKey key)
    {
        LocationDAO locationDAO = new LocationDAO();
        return WrapMethod(() =&gt; locationDAO.CreateLocation(key));
    }


    public Result&lt;Boolean&gt; RemoveLocation(LocationKey key)
    {
        LocationDAO locationDAO = new LocationDAO();
        return WrapMethod(() =&gt;  locationDAO.RemoveLocation(key));
    }


    static Result&lt;T&gt; WrapMethod&lt;T&gt;(Func&lt;Result&lt;T&gt;&gt; func)
    {
        try
        {
            return func();
        }
        catch (UpdateException ue)
        {
            return new Result&lt;T&gt;(default(T), ue.Errors);
        }
    }
</code></pre>
","<c#><algorithm><refactoring>","1","87","2010-03-31 15:53:56"
"2556509","Reducing Code Repetition: Calling functions with slightly different signatures","<p>Suppose I have two functions which look like this:</p>

<pre><code>public static void myFunction1(int a, int b, int c, string d)
{
    //dostuff
    someoneelsesfunction(c,d);
    //dostuff2
}

public static void myFunction2(int a, int b, int c, Stream d)
{
    //dostuff
    someoneelsesfunction(c,d);
    //dostuff2
}
</code></pre>

<p>What would be a good way to avoid repeated dostuff?</p>

<p>Ideas I've thought of, but don't like:</p>

<ol>
<li>I could make d an object and cast at runtype based on type, but this strikes me as not being ideal; it removes a type check which was previously happening at compile time.</li>
<li>I could also write a private helper class that takes an object and write both signatures as public functions.</li>
<li>I could replace dostuff and dostuff2 with delegates or function calls or something.</li>
</ol>
","<c#><refactoring>","7","206","2010-03-31 21:13:11"
"2556149","Refactor java code","<p>Okay guess this question looks a lot like:</p>

<p><a href=""http://stackoverflow.com/questions/519422/what-is-the-best-way-to-replace-or-substitute-if-else-if-else-trees-in-programs"">http://stackoverflow.com/questions/519422/what-is-the-best-way-to-replace-or-substitute-if-else-if-else-trees-in-programs</a></p>

<p>consider this question CLOSED!</p>

<hr>

<p>I would like to refactor code which looks something like this:</p>

<pre><code>String input; // input from client socket.
if (input.equals(x)) {
  doX();
} else if (input.equals(y)) {
  doY();
} else {
  unknown_command();
}
</code></pre>

<p>It is code which checks input from socket to perform some action, but I don't like the <code>if else</code> construction because every time a new command is added to the server (code) a new if else has to be added which is ugly. Also when deleting a command the <code>if else</code> has to be modified.</p>
","<java><refactoring>","6","596","2010-03-31 20:15:10"
"2567567","How should I do a loop a nokogiri search in ruby?","<p>I have the following that I retreive the title of each url from an array that contains a list of urls.</p>

<pre><code>require 'rubygems'
require 'nokogiri'
require 'open-uri'

@urls = [""http://google.com"", ""http://yahoo.com"", ""http://rubyonrails.org""]

@found_titles = Array.new
@found_titles[0] = Nokogiri::HTML(open(""#{@urls[0]}"")).search(""title"").inner_html

#this can go on forever...but
#@found_titles[1] = Nokogiri::HTML(open(""#{@urls[1]}"")).search(""title"").inner_html
#@found_titles[2] = Nokogiri::HTML(open(""#{@urls[2]}"")).search(""title"").inner_html

puts ""#{@found_titles[0]}""
</code></pre>

<p>How should i form a loop method for this so i can get the title even when the list in @url array gets longer.</p>
","<ruby><arrays><refactoring><loops><nokogiri>","1","580","2010-04-02 15:45:07"
"2571100","Is it possible to refactor this C# if(..) statement?","<p>simple question :-</p>

<p>i have the following simple if (..) statements :-</p>

<pre><code>if (foo == Animal.Cat || foo == Animal.Dog)
{ .. }

if (baa == 1|| baa == 69)
{ .. }
</code></pre>

<p>is it possible to refactor these into something like ...</p>

<p><em>DISCLAIMER: I know this doesn't compile .. but this is sorta what i'm trying to get...</em></p>

<pre><code>if (foo == (Animal.Cat || Animal.Dog))
{ .. }

if (baa == (1 || 69))
{ .. }
</code></pre>

<p>Cheers :)</p>

<h3>EDIT</h3>

<p>I wonder if a lambda expression extension could do this? :P</p>
","<.net><.net-4.0><refactoring><if-statement>","7","324","2010-04-03 11:24:58"
"2569169","Can I stop Visual Studio from refactoring outside the current project?","<p>I'm working in a class library and there are other source projects associated with the same solution.
Is there a way for me to stop the VS refactoring tools from traversing those other projects, without removing them from the solution, but keeping everything the same?</p>

<p>The reason I'm asking is because I often know the changed symbol doesn't exist in the other projects and refactoring takes a long time looking through all projects in the solution. Especially if there's an unwieldy Website project in the solution.</p>
","<visual-studio><refactoring><dependencies>","2","68","2010-04-02 20:57:41"
"2576483","Why do people have to use multiple versions of jQuery on the same page?","<p>I have noticed that sometimes people have to use multiple versions of jQuery in the same page (See <a href=""http://stackoverflow.com/questions/528241/how-do-i-run-different-versions-of-jquery-on-the-same-page"">question 1</a> and <a href=""http://stackoverflow.com/questions/1566595/can-i-use-multiple-versions-of-jquery-on-the-same-page"">question 2</a>). I assume people have to carry old versions of jQuery because some pieces of their code is based on an older version of jQuery. Obviously, this approach causes inefficiency. The ideal solution is to refactor the old code to use the newer jQuery API. I wonder if there are tools that automate the process of upgrading a piece of code to use a newer version of jQuery. I've never written programs in in either Javascript or jQuery. So, I'd like to hear from programmers experienced in these language about their opinion on this issue. In particular, I'd like to know the following.</p>

<ol>
<li>How much of problem it is to have to load multiple versions of jQuery?</li>
<li>Have you ever had to load multiple versions of any other library in the same page?</li>
<li>Do you know of any refactoring tool that helps you migrate your code to use the updated API?</li>
<li>Do you think such a refactoring tool is useful? Are you willing to use it?</li>
</ol>

<p><strong>Please don't consider this question closed. Current responses have already gave me good insight about the process and tools available for upgrading jQuery code. But, please feel free to add your own experience with upgrading jQuery code.</strong></p>
","<javascript><jquery><api><refactoring>","2","716","2010-04-05 01:04:09"
"2584224","Why .NET Boolean has TrueLiteral and TrueString?","<p>Why in Boolean type there are two fields with the same value?</p>

<pre><code>internal const int True = 1;
internal const int False = 0;
internal const string TrueLiteral = ""True"";
internal const string FalseLiteral = ""False"";
</code></pre>

<p>and</p>

<pre><code>public static readonly string TrueString;
public static readonly string FalseString;

static Boolean()
{
    TrueString = ""True"";
    FalseString = ""False"";
}
</code></pre>

<p>in reflector generated code, methods don't use those strings but:</p>

<pre><code>public string ToString(IFormatProvider provider)
{
    if (!this)
    {
        return ""False"";
    }
    return ""True"";
}
</code></pre>

<p>would't it be better to use those const values?</p>

<p><strong>EDIT:</strong> in CIL there is no difference between using const strings and instance strings.</p>

<p>So when I declare a private const string = ""a"", wherever in the application ""a"" is used, Jitter uses const value, or is it only in const string's scope?</p>
","<.net><refactoring><types><boolean>","2","216","2010-04-06 10:53:12"
"2588277","How can I swap or replace multiple strings in code at the same time?","<p>Given the following code sample:</p>

<pre><code>uint8_t i, in, ni;
i = in = 2; ni = 1;
while (2 == i &gt; ni) in++;
</code></pre>

<p>How can I replace <code>i, in, and ni</code>, respectively with either <code>in, ni, and i</code> or <code>inni, inin, and nini</code> using emacs, vi, *nix commands, or anything else?</p>
","<c><bash><emacs><refactoring><vi>","2","413","2010-04-06 20:59:24"
"2592221","Xcode raises exception when refactoring","<p>When I run a refactor on my code in xcode, all the files are correctly refactored except one, and when I click to check the changes made in that file, the following 'Internal Error Occurs':</p>

<pre><code>Uncaught Exception:
Invalid parameter not satisfying: fileName

Stack Backtrace:
The stack backtrace has been logged to the console.
</code></pre>

<p>Here is what it spat out in the console:</p>

<pre><code>4/7/10 06:47:30  Xcode[35355] [MT] Uncaught Exception:
Invalid parameter not satisfying: fileName

Backtrace:
0  0x92842bbd __raiseError (in CoreFoundation)
1  0x914b9509 objc_exception_throw (in libobjc.A.dylib)
2  0x92842908 +[NSException raise:format:arguments:] (in CoreFoundation)
3  0x98801dc3 -[NSAssertionHandler handleFailureInMethod:object:file:lineNumber:description:] (in Foundation)
4  0x98db0f8e -[NSDocument(NSDeprecated) initWithContentsOfFile:ofType:] (in AppKit)
5  0x0075c07e -[PBXTextFileDocument initWithContentsOfFile:ofType:] (in DevToolsInterface)
6  0x007dc5be -[PBXFileDocument initWithFileReference:usingType:] (in DevToolsInterface)
7  0x00b1c0f8 -[XCRefactoringFileChangeSet(XCRefactoringModule_HelperMethods) referencedTextFileDocument] (in DevToolsInterface)
8  0x00b1d1f4 -[XCRefactoringEditableExistingTextFileChangeSet populateComparator:] (in DevToolsInterface)
9  0x00ab19b7 -[XCRefactoringModuleFileItem populateComparator:previewFinished:] (in DevToolsInterface)
10  0x00aa4606 -[XCRefactoringModule(MasterListDelegate) outlineViewSelectionDidChange:] (in DevToolsInterface)
11  0x987381cb _nsnote_callback (in Foundation)
12  0x927ca3f9 __CFXNotificationPost (in CoreFoundation)
13  0x927c9e2a _CFXNotificationPostNotification (in CoreFoundation)
14  0x9872d098 -[NSNotificationCenter postNotificationName:object:userInfo:] (in Foundation)
15  0x9873a475 -[NSNotificationCenter postNotificationName:object:] (in Foundation)
16  0x98af1de2 -[NSTableView _enableSelectionPostingAndPost] (in AppKit)
17  0x98bd11d0 -[NSTableView mouseDown:] (in AppKit)
18  0x98bcfeea -[NSOutlineView mouseDown:] (in AppKit)
19  0x007596c3 -[PBXExtendedOutlineView mouseDown:] (in DevToolsInterface)
20  0x98b6e548 -[NSWindow sendEvent:] (in AppKit)
21  0x00757a06 -[XCWindow sendEvent:] (in DevToolsInterface)
22  0x98a871af -[NSApplication sendEvent:] (in AppKit)
23  0x006f6dec -[PBXExtendedApplication sendEvent:] (in DevToolsInterface)
24  0x98a1ac4f -[NSApplication run] (in AppKit)
25  0x98a12c85 NSApplicationMain (in AppKit)
26  0x0000eee1
27  0x000021a5
</code></pre>

<p>If you would like to take a look at the project I'm working on, here is a link to download my xcodeproject:
    <a href=""http://bit.ly/bxOPNc"" rel=""nofollow"">Tea Timer.zip</a></p>

<p>To recreate my problem, open Timer.h, attempt to refactor timeField to minuteField, use the preview function of refactor and then select Timer.m, to look at the changes supposedly made within. It will then raise this error without editing the file.</p>
","<objective-c><xcode><exception><refactoring>","0","189","2010-04-07 12:05:41"
"2591628","Is there a strategy to back-port C# code?","<p>I intend using the Argotic framework in support of a .Net Atom server.  Unfortunately my target server (over which I have no control) only has .Net 1.1 - any the Argotic library is only in .Net 2 and 3.5.</p>

<p>So, I now need to back-port the code to 1.1.</p>

<p>Can anybody provide any strategic tips for this undertaking?</p>

<p>I'm aware of the merits of using Unit Tests to verify the ported code (<a href=""http://cyberfox.com/blog/2007/10/05/35/tdd-the-logans-run-of-software-development"" rel=""nofollow"">here</a>).</p>

<ul>
<li>should I be looking for automated tools?</li>
<li>should I just import the code into VS2003 .Net 1.1 project and work through the compiler warnings?</li>
</ul>

<p>Any tips appreciated.</p>

<p>cheers,
Ian</p>
","<c#><.net><visual-studio><unit-testing><refactoring>","1","104","2010-04-07 10:30:19"
"2598703","Is it better to create methods with a long list of parameters or wrap the parameters into an object?","<p>Is it better(what is the best practice) to create methods with a long list of parameters or wrap the parameters into an object?</p>

<p>I mean lets say i have a Client data type with a long list of properties and i want to update all the properties at once. is it better to do something like</p>

<pre><code>public int Update(int id, string name, string surname, string streetAddress, string streetAddress2, string postcode, string town, string city, string nationality, string age, string gender,string job)
{  }
</code></pre>

<p>or wrap all the properties in a object and do something like</p>

<pre><code>public int Update(Client client)
{  }
</code></pre>

<p>thanks</p>
","<c#><refactoring>","15","281","2010-04-08 09:18:16"
"2607845","Visual studio: automatically update C++ cpp/header file when the other is changed?","<p>For example, if I change the signature in a function in either the header or the cpp, I'd like it to automatically change in the other one. If I add a new function in either, it should appear in both. If I delete a function, it could probably comment out the other one.
Manually having to duplicate one's changes seems silly.</p>

<p>Some people have mentioned <a href=""http://www.lazycplusplus.com/"" rel=""nofollow"">http://www.lazycplusplus.com/</a> in response to a similar question, but it seems that that's a command line tool which would require saving and then running this external tool on a particular file. That's still more manual steps than I would have thought were necessary; I'd like this to apply changes <strong>as I type</strong>.</p>
","<visual-c++><refactoring><vsx><header-files><automated-refactoring>","2","627","2010-04-09 13:34:14"
"2608875","Bad Design? Constructor of composition uses `this`","<p>Example:</p>

<pre><code>class MyClass
{
    Composition m_Composition;

    void MyClass()
    {
        m_Composition = new Composition( this );
    }
}
</code></pre>

<p>I am interested in using depenency-injection here. So I will have to refactor the constructor to something like:</p>

<pre><code>void MyClass( Composition composition )
{
    m_Composition = composition;
}
</code></pre>

<p>However I get a problem now, since the <code>Composition</code>-object relies on the object of type <code>MyClass</code> which is just created.</p>

<p><em>Can a dependency container resolve this?</em> Is it supposed to do so?<br>
<em>Or is it just bad design from the beginning on?</em></p>
","<refactoring><dependency-injection><inversion-of-control><code-smell>","7","206","2010-04-09 15:53:51"
"2608966","Changing property stubs for Interface refactoring","<p>Is it possible to change the stub used to implement interfaces in Visual Studio 2008? </p>

<p>For instance, when I choose either<br>
<code>Implement interface 'IMyInterface'</code><br>
 or<br>
 <code>Explicitly implement interface 'IMyInterface'</code></p>

<p>Instead of a number of properties that look like this:</p>

<pre><code>    public string Comment
    {
        get
        {
            throw new NotImplementedException();
        }
        set
        {
            throw new NotImplementedException();
        }
    }
</code></pre>

<p>I'd like my properties to use the C# 3.0 auto-implemented properties and look like this:</p>

<pre><code>    public string Comment {get;set;}
</code></pre>

<p>I want to do this to avoid forcing this interface to be an abstract class.</p>

<p>I've looked through the snippets in the Visual Studio folder, but I didn't see any that would be appropriate.  I've also googled and searched SO, and found nothing.</p>

<p>If this isn't possible, does anyone have a macro I can steal?</p>

<p>Thanks.</p>

<p><strong>edit:</strong>  I have tried editing the snippets located in <code>C:\Program Files\Microsoft Visual Studio 9.0\VC#\Snippets\1033\Refactoring</code> but these changes don't change the implementation.  I've tried making the changes, then reopening Visual Studio, which doesn't work.  Am I doing something wrong here?</p>
","<c#><visual-studio-2008><refactoring><interface><editor>","1","285","2010-04-09 16:05:30"
"2611699","Access Violation Using memcpy or Assignment to an Array in a Struct","<p><strong>Update 2:</strong></p>

<p>Well I’ve refactored the work-around that I have into a separate function. This way, while it’s still not ideal (especially since I have to free outside the function the memory that is allocated inside the function), it does afford the ability to use it a little more generally. I’m still hoping for a more optimal and elegant solution…
<br /><br /><br />
<strong>Update:</strong></p>

<p>Okay, so the <em>reason</em> for the problem has been established, but I’m still at a loss for a solution.</p>

<p>I am trying to figure out an (easy/effective) way to modify a few bytes of an array in a struct. My current work-around of dynamically allocating a buffer of equal size, copying the array, making the changes to the buffer, using the buffer in place of the array, then releasing the buffer seems excessive and less-than optimal. If I have to do it this way, I may as well just put two arrays in the struct and initialize them both to the same data, making the changes in the second. My goal is to reduce both the memory footprint (store just the differences between the original and modified arrays), and the amount of manual work (automatically patch the array).
<br /><br /><br />
<strong>Original post:</strong></p>

<p>I wrote a program last night that worked just fine but when I refactored it today to make it more extensible, I ended up with a problem.</p>

<p>The original version had a hard-coded array of bytes. After some processing, some bytes were written into the array and then some more processing was done.</p>

<p>To avoid hard-coding the pattern, I put the array in a structure so that I could add some related data and create an array of them. However now, I cannot write to the array in the structure. Here’s a pseudo-code example:</p>

<pre><code>main() {
  char pattern[]=""\x32\x33\x12\x13\xba\xbb"";
  PrintData(pattern);
  pattern[2]='\x65';
  PrintData(pattern);
}
</code></pre>

<p>That one works but this one does not:</p>

<pre><code>struct ENTRY {
  char* pattern;
  int   somenum;
};

main() {
  ENTRY Entries[] = {
      {""\x32\x33\x12\x13\xba\xbb\x9a\xbc"", 44}
    , {""\x12\x34\x56\x78"", 555}
  };
  PrintData(Entries[0].pattern);
  Entries[0].pattern[2]='\x65';   //0xC0000005 exception!!! :(
  PrintData(Entries[0].pattern);
}
</code></pre>

<p>The second version causes an access violation exception on the assignment. I’m sure it’s because the second version allocates memory differently, but I’m starting to get a headache trying to figure out what’s what or how to get fix this. (I’m currently working around it by dynamically allocating a buffer of the same size as the pattern array, copying the pattern to the new buffer, making the changes to the buffer, using the buffer in the place of the pattern array, and then trying to remember to free the—temporary—buffer.)</p>

<p>(Specifically, the original version cast the pattern array—+offset—to a DWORD* and assigned a DWORD constant to it to overwrite the four target bytes. The new version cannot do that since the length of the source is unknown—may not be four bytes—so it uses memcpy instead. I’ve checked and re-checked and have made sure that the pointers to memcpy are correct, but I still get an access violation. I use memcpy instead of str(n)cpy because I am using plain chars (as an array of bytes), not Unicode chars and ignoring the null-terminator. Using an assignment as above causes the same problem.)</p>

<p>Any ideas?</p>
","<c++><memory><data-structures><refactoring><access-violation>","0","679","2010-04-10 00:04:42"
"2611977","Refactor Pro versus Visual Assist X for C++ Development","<p>There are two major refactoring tools which can be installed for Visual Studio that provide C++ support. The full versions of both tools are $250, and they seem to offer similar functionality. They are:</p>

<ul>
<li><a href=""http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/"" rel=""nofollow"">Developer Express' Refactor Pro + CodeRush</a></li>
<li><a href=""http://www.wholetomato.com/products/default.asp"" rel=""nofollow"">Whole Tomato's Visual Assist X</a></li>
</ul>

<p>Which tool is better?</p>

<p>EDIT: My initial evaluation of the tools seems to be that Refactor Pro/CodeRush has several more features, but is also quite buggy on occasion. It doesn't seem to like macros:
<img src=""http://billy-oneal.com/forums/4-9-2010%2010-31-50%20PM.png"" />
Here's Visual Assist's interpretation of the same:
<img src=""http://billy-oneal.com/forums/4-10-2010%201-52-24%20AM.png"" /></p>

<p>EDIT2: I think I like CodeRush over Visual Assist, but I'm not sure I can trust CR. CodeRush does seem to have problems parsing some C++ constructs, like the macros above. But it's UI is <em>much</em> more polished. For example:
<img src=""http://billy-oneal.com/forums/4-10-2010%201-37-12%20AM.png"" /></p>

<p>On the other hand Visual Assist X seems to have a much larger following among C++ developers, and it's code analysis is MUCH better. It doesn't seem to make mistakes like R! Pro was making from time to time.</p>

<p>I think at this point I just have to play with both tools and see which one proves more useful. But I'm still curious if anyone has had horror / success stories with either tool.</p>
","<c++><visual-studio><refactoring><automated-refactoring>","11","3494","2010-04-10 02:14:47"
"2615901","refactor LINQ TO SQL custom properties that instantiate datacontext","<p>I am working on an existing ASP.NET MVC app that started small and has grown with time to require a good re-architecture and refactoring.</p>

<p>One thing that I am struggling with is that we've got partial classes of the L2S entities so we could add some extra properties, but these props create a new data context and query the DB for a subset of data.  This would be the equivalent to doing the following in SQL, which is not a very good way to write this query as oppsed to joins: </p>

<pre><code>SELECT tbl1.stuff, 
    (SELECT nestedValue FROM tbl2 WHERE tbl2.Foo = tbl1.Bar),
    tbl1.moreStuff
 FROM tbl1
</code></pre>

<p>so in short here's what we've got in some of our partial entity classes:</p>

<pre><code>public partial class Ticket {

public StatusUpdate LastStatusUpdate
{
    get
    {
         //this static method call returns a new DataContext but needs to be refactored
         var ctx = OurDataContext.GetContext();
         var su = Compiled_Query_GetLastUpdate(ctx, this.TicketId);
         return su;
    }
}

}
</code></pre>

<p>We've got some functions that create a compiled query, but the issue is that we also have some DataLoadOptions defined in the DataContext, and because we instantiate a new datacontext for getting these nested property, we get an exception </p>

<blockquote>
  <p>""Compiled Queries across DataContexts
  with different LoadOptions not
  supported""</p>
</blockquote>

<p>.  The first DataContext is coming from a DataContextFactory that we implemented with the refactorings, but this second one is just hanging off the entity property getter.</p>

<p>We're implementing the Repository pattern in the refactoring process, so we <strong>must</strong> stop doing stuff like the above.  Does anyone know of a good way to address this issue?</p>

<p>EDIT:  I am adding the code for the DataContextFactory that we created during our refactoring efforts.  Note that in the code above we have a GetContext() static method in the Linq DataContext class, which news up a datacontext, and is not using the DataContextFactory below:</p>

<pre><code>public class DataContextFactory&lt;T&gt; : IDataContextFactory where T : System.Data.Linq.DataContext
{
    public DataContextFactory()
    {
        _context = Activator.CreateInstance&lt;T&gt;();
    }

    public DataContextFactory(T context)
    {
        _context = context;
    }

    private System.Data.Linq.DataContext _context;
    public System.Data.Linq.DataContext Context
    {
        get 
        {
            return _context; 
        }
    }

    public void SaveAll()
    {
        Context.SubmitChanges();
    }

    public bool IsContextDirty
    {
        get
        {
            return Context != null &amp;&amp; (Context.GetChangeSet().Deletes.Count &gt; 0 ||
                                           Context.GetChangeSet().Inserts.Count &gt; 0 ||
                                           Context.GetChangeSet().Updates.Count &gt; 0);
        }
    }
}
</code></pre>
","<asp.net-mvc><linq-to-sql><refactoring><repository-pattern>","1","530","2010-04-11 03:03:28"
"2614496","Better way to write this SQL","<p>I have the following table:</p>

<pre><code>create table ARDebitDetail(ID_ARDebitDetail int identity, 
                  ID_Hearing int, ID_AdvancedRatePlan int)
</code></pre>

<p>I am trying to get the latest ID_AdvancedRatePlan based on a ID_Hearing.  By latest I mean with the largest ID_ARDebitDetail. I have this query and it works fine.</p>

<pre><code>    select ID_AdvancedRatePlan
    from ARDebitDetails
    where ID_Hearing = 135878
    and ID_ARDebitDetail = 
            (   select max(ID_ARDebitDetail) 
                from ARDebitDetails 
                where ID_AdvancedRatePlan &gt; 0 and ID_Hearing = 135878
            )
</code></pre>

<p>However, it just looks ugly and smells bad.  Is there a way to rewrite it in a more concise manner?</p>
","<sql><sql-server-2005><refactoring>","0","61","2010-04-10 18:45:46"
"2620480","Singleton class design in C#, are these two classes equivalent?","<p>I was reading up on singleton class design in C# on <a href=""http://www.yoda.arachsys.com/csharp/singleton.html"" rel=""nofollow"">this great resource</a> and decided to go with alternative 4:</p>

<pre><code>public sealed class Singleton1
{
    static readonly Singleton1 _instance = new Singleton1();

    static Singleton1()
    {
    }

    Singleton1()
    {
    }

    public static Singleton1 Instance
    {
        get
        {
            return _instance;
        }
    }
}
</code></pre>

<p>Now I wonder if this can be rewritten using auto properties like this?</p>

<pre><code>public sealed class Singleton2
{
    static Singleton2()
    {
        Instance = new Singleton2();
    }

    Singleton2()
    {
    }

    public static Singleton2 Instance { get; private set; }
}
</code></pre>

<p>If its only a matter of readability I definitely prefer the second version, but I want to get it right.</p>
","<c#><design-patterns><refactoring><singleton>","4","149","2010-04-12 07:28:50"
"2627081","Javascript source code analysis ( specifically duplication checking )","<p>Partial duplicate of <a href=""http://stackoverflow.com/questions/331326/javascript-source-code-analyzer"">this</a></p>

<p>Notes:
I already use JSLint extensively via a tool I wrote that scans in intervals my current project directory for recently updated/created .js files.  It's drastically improved productivity for me and I doubt there is anything as good as JSLint for the price (it's free).</p>

<p>That said, is there any analysis tool out there that can find repetitive or near-duplicate code blocks, the goal being to make it easier to find opportunities to consolidate large files or small/medium sized projects?</p>
","<tools><refactoring><code-analysis>","1","360","2010-04-13 05:03:33"
"2626064","Change namespace/filesystem folder names in Visual Studio","<p>I'm trying to change a namespace in Visual Studio.</p>

<p>My folder structure looks something like this:</p>

<pre><code>GameAlpha/
         GameAlpha.sln
         GameAlphaRelease/
         GameAlphaTest/
         GameAlphaLevelEditor/
</code></pre>

<p>These include namespaces like <code>GameAlphaRelease</code>. I want to change all this to <code>GameBetaRelease</code>.</p>

<p>Before this process, it built fine.</p>

<p>First, I changed the solution and project files from Alpha to Beta. Then, I did a ""find-replace-all"" on the namespace. Finally, I went through the properties of each project and changed the ""Assembly Name"" and ""Default Namespace"" to the appropriate Beta title.</p>

<p>However, now the solution does not build. The error is:</p>

<blockquote>
  <p>GameAlpha.accessor: The reference to 'GameAlpha.exe' was not found in
  the list of this projects references.
  (Project: GameBetaTest)</p>
</blockquote>

<p>What am I doing wrong? If I remove project GameBetaTest, the solution builds just fine.</p>

<p>Also, what is the preferable way to change the names of the folders in the file system?</p>
","<visual-studio><ide><namespaces><refactoring>","2","1605","2010-04-12 23:15:52"
"2633528","Should I refactor this code?","<p>The code is for a view debate page. The code is supposed to determine whether or not to show an add reply form to the viewing user. </p>

<p>If the user is logged in, and the user is not the creator of the debate, then check if the user already replied to the debate.</p>

<p>If the user did not already reply to the debate then show the form... 
Otherwise, Check If the user wants to edit their already existing reply by looking in the url for the reply id</p>

<p>If any of these tests dont pass, Then I save the reason as an int and pass that to a switch statement in the view.</p>

<p>The logic seems easy enough, but my code seems a little sloppy.</p>

<p>Here's the code.. (using Kohana V2.3.4)</p>

<pre><code>public function view($id = 0)
{
    $debate = ORM::factory('debate')-&gt;with('user')-&gt;with('category')-&gt;find($id);

    if ($debate-&gt;loaded == FALSE)
    {
        url::redirect();
    }

    // series of tests to show an add reply form
    if ($this-&gt;logged_in)
    {
        // is the viewer the creator?
        if ($this-&gt;user-&gt;id != $debate-&gt;user-&gt;id)
        {
            // has the user already replied?
            if (ORM::factory('reply')
                -&gt;where(array('debate_id' =&gt; $id, 'user_id' =&gt; $this-&gt;user-&gt;id))
                -&gt;count_all() == 0)
            {
                $form = $errors = array
                (
                    'body'      =&gt; '',
                    'choice_id' =&gt; '',
                    'add'       =&gt; ''
                );

                if ($post = $this-&gt;input-&gt;post())
                {
                    $reply = ORM::factory('reply');

                    // validate and insert the reply
                    if ($reply-&gt;add($post, TRUE))
                    {
                        url::redirect(url::current());
                    }

                    $form   = arr::overwrite($form,   $post-&gt;as_array());
                    $errors = arr::overwrite($errors, $post-&gt;errors('reply_errors'));
                }
            }
            // editing a reply?
            else if (($rid = (int) $this-&gt;input-&gt;get('edit'))
                    AND ($reply = ORM::factory('reply')
                                -&gt;where(array('debate_id' =&gt; $id, 'user_id' =&gt; $this-&gt;user-&gt;id))
                                -&gt;find($rid)))
            {
                $form = $errors = array
                (
                    'body'      =&gt; '',
                    'choice_id' =&gt; '',
                    'add'       =&gt; ''
                );

                // autocomplete the form
                $form = arr::overwrite($form, $reply-&gt;as_array());

                if ($post = $this-&gt;input-&gt;post())
                {
                    // validate and insert the reply
                    if ($reply-&gt;edit($post, TRUE))
                    {
                        url::redirect(url::current());
                    }

                    $form   = arr::overwrite($form,   $post-&gt;as_array());
                    $errors = arr::overwrite($errors, $post-&gt;errors('reply_errors'));
                }
            }
            else
            {
                // user already replied
                $reason = 3;
            }
        }
        else
        {
            // user started the debate
            $reason = 2;
        }
    }
    else
    {
        // user is not logged in.
        $reason = 1;
    }

    $limits = Kohana::config('app/debate.limits');
    $page   = (int) $this-&gt;input-&gt;get('page', 1);
    $offset = ($page &gt; 0) ? ($page - 1) * $limits['replies'] : 0;

    $replies = ORM::factory('reply')-&gt;with('user')-&gt;with('choice')-&gt;where('replies.debate_id', $id);

    $this-&gt;template-&gt;title  = $debate-&gt;topic;
    $this-&gt;template-&gt;debate = $debate;
    $this-&gt;template-&gt;body   = View::factory('debate/view')
        -&gt;set('debate',     $debate)
        -&gt;set('replies',    $replies-&gt;find_all($limits['replies'], $offset))
        -&gt;set('pagination', Pagination::factory(array
            (
                'style'          =&gt; 'digg',
                'items_per_page' =&gt; $limits['replies'],
                'query_string'   =&gt; 'page',
                'auto_hide'      =&gt; TRUE,
                'total_items'    =&gt; $total = $replies-&gt;count_last_query()
            ))
        )
        -&gt;set('total', $total);

    // are we showing the add reply form?
    if (isset($form, $errors))
    {
        $this-&gt;template-&gt;body-&gt;add_reply_form = View::factory('reply/add_reply_form')
            -&gt;set('debate', $debate)
            -&gt;set('form',   $form)
            -&gt;set('errors', $errors);
    }
    else
    {
        $this-&gt;template-&gt;body-&gt;reason = $reason;
    }
}
</code></pre>

<p>Heres the view, theres some logic in here that determines what message to show the user.</p>

<pre><code>&lt;!-- Add Reply Form --&gt;
&lt;?php if (isset($add_reply_form)): ?&gt;

    &lt;?php echo $add_reply_form; ?&gt;

&lt;?php else: ?&gt;

    &lt;?php
        switch ($reason)
        {
            case 1 :
                // not logged in, show a message
                $message = 'Add your ' . html::anchor('login?url=' . url::current(TRUE), '&lt;b&gt;vote&lt;/b&gt;') . ' to this discussion';
                break;

            case 2 :
                // started the debate. dont show a message for that.
                $message = NULL;
                break;

            case 3:
                // already replied, show a message
                $message = 'You have already replied to this debate';
                break;

            default:
                // unknown reason. dont show a message
                $message = NULL;
                break;
        }
    ?&gt;

    &lt;?php echo app::show_message($message, 'h2'); ?&gt;

&lt;?php endif; ?&gt;
&lt;!-- End Add Reply Form --&gt;
</code></pre>

<p>Should I refactor the add reply logic into another function or something.... It all works, it just seems real sloppy.</p>

<p>Thanks</p>

<p><b>Edit: </b> I took all answers into consideration. Since I wasn't adding anything new at the moment and had time to kill, I chose to refactor the code. After a little thought, a better solution popped out to me. The whole process took me about 30 minutes, and I would say it was worth it. Thanks to all for your answers</p>
","<php><refactoring><kohana>","2","343","2010-04-13 22:02:00"
"2642023","Ruby: Is there a better way to iterate over multiple (big) files?","<p>Here's what I'm doing (sorry for the variable names, I'm not using those in my code):</p>

<pre><code>File.open(""out_file_1.txt"", ""w"") do |out_1|
  File.open(""out_file_2.txt"", ""w"") do |out_2|
    File.open_and_process(""in_file_1.txt"", ""r"") do |in_1|
      File.open_and_process(""in_file_2.txt"", ""r"") do |in_2|
        while line_1 = in_1.gets do
          line_2 = in_2.gets        #input files have the same number of lines
          #process data and output to files
        end
      end
    end
  end
end
</code></pre>

<p>The open_and_process method is just to open the file and close it once it's done. It's taken from the pickaxe book.</p>

<p>Anyway, the main problem is that the code is nested too deeply. I can't load all the files' contents into memory, so I have to iterate line by line. Is there a better way to do this? Or at least prettify it?</p>
","<ruby><file><file-io><refactoring>","0","352","2010-04-15 00:52:03"
"2636864","Can I use Ninject ConstructorArguments with strong naming?","<p>Well, I don't know if ""strong naming"" is the right term, but what I want to do is as follows. </p>

<p>Currently I use ConstructorArgument like e.g. this: </p>

<pre><code>public class Ninja
{
    private readonly IWeapon _weapon;
    private readonly string _name;

    public Ninja(string name, IWeapon weapon)
    {
        _weapon = weapon;
        _name = name;
    }
    // ..more code..
}

public void SomeFunction()
{
    var kernel = new StandardKernel();
    kernel.Bind&lt;IWeapon&gt;().To&lt;Sword&gt;();
    var ninja = kernel.Get&lt;Ninja&gt;(new ConstructorArgument(""name"", ""Lee""));
}
</code></pre>

<p>Now, if I rename the parameter ""name"" (e.g. using ReSharper) the ConstructorArgument won't update, and I will get a runtime error when creating the Ninja. To fix this I need to manually find all places I specify this parameter through a ConstructorArgument and update it. No good, and I'm doomed to fail at some point even though I have good test coverage. Renaming should be a cheap operation. </p>

<p>Is there any way I can make a reference to the parameter instead - such that it is updated when I rename the parameter? </p>
","<.net><refactoring><naming><ninject><constructorargument>","6","344","2010-04-14 11:21:49"
"2643358","can you simplify and generalize this useful jQuery function, please?","<p>I'm doing an eshop with goods displayed as ""tiles"" in grid as usual. I just want to use various sizes of tiles and make sure (via jQuery) there are no free spaces.</p>

<p>In basic situation, I have a 960px wrapper and want to use 240x180px (class .grid_4) tiles and 480x360px (class .grid_8) tiles. See image (imagine no margins/paddings there):</p>

<p><img src=""http://img580.imageshack.us/img580/2828/screenshot2010041508h52.png"" alt=""alt text""></p>

<p>Problems without jQuery:</p>

<ul>
<li>when the CMS provides the big tile as 6th, there would be a free space under the 5th one</li>
<li>when the CMS provides the big tile as 7th, there would be a free space under 5th and 6th</li>
<li>when the CMS provides the big tile as 8th, it would shift to next line, leaving position no.8 free</li>
</ul>

<p>My solution so far looks like this:</p>

<pre><code>$("".grid_8"").each(function(){
        //console.log(""BIG on position ""+($(this).index()+1)+"" which is ""+(($(this).index()+1)%2?""ODD"":""EVEN""));

        switch (($(this).index()+1)%4) {

            case 1:
                // nothing needed
                //console.log(""case 1"");
                break;

            case 2:
                //need to shift one position and wrap into 240px div
                //console.log(""case 2"");
                $(this).insertAfter($(this).next()); //swaps this with next
                $(this).prevAll("":nth(0), :nth(1)"").wrapAll(""&lt;div class=\""grid_4\"" /&gt;"");

                break;

            case 3:
                //need to shift two positions and wrap into 480px div
                //console.log(""case 3"");
                $(this).prevAll("":nth(0), :nth(1)"").wrapAll(""&lt;div class=\""grid_4\"" /&gt;""); //wraps previous two - forcing them into column 
                $(this).nextAll("":nth(0), :nth(1)"").wrapAll(""&lt;div class=\""grid_4\"" /&gt;""); //wraps next two - forcing them into column
                $(this).insertAfter($(this).next()); //moves behind the second column
                break;

            case 0:
                //need to shift one position
                //console.log(""case 4"");
                $(this).insertAfter($(this).next());
                //console.log(""shifted to next line"");
                break;

        }

    }); 
</code></pre>

<p>It should be obvious from the comments how it works - generally always makes sure that the big tile is on odd position (count of preceding small tiles is even) by shifting one position back if needed. Also small tiles to the left from the big one need to be wrapped in another div so that they appear in column rather than row.</p>

<p>Now finally the questions:</p>

<ul>
<li>how to generalize the function so that I can use even more tile dimensions like 720x360 (3x2), 480x540 (2x3), etc.?</li>
<li>is there a way to simplify the function?</li>
<li>I need to make sure that big tile counts as a multiple of small tiles when checking the actual position. Because using index() on the tile on position 12 (last tile in 3rd row) would now return 7 (position 8) because tiles on positions 5 and 9 are wrapped together in one culumn and the big tile is also just a single div, but spans 2x2 positions. any clean way to ensure this?</li>
</ul>

<p>Thank you very much for any hints. Feel free to reuse the code, I think it can be useful.</p>

<p>Josef  </p>
","<javascript><jquery><refactoring><grid><shopping-cart>","1","201","2010-04-15 07:20:58"
"2651744","How could I refactor this into more manageable code?","<p>Is this code even complex enough to deserve a higher level of abstraction?    </p>

<pre><code>public static JsonStructure Parse(string jsonText)
{
    var result = default(JsonStructure);
    var structureStack = new Stack&lt;JsonStructure&gt;();
    var keyStack = new Stack&lt;string&gt;();
    var current = default(JsonStructure);
    var currentState = ParserState.Begin;
    var key = default(string);
    var value = default(object);

    foreach (var token in Lexer.Tokenize(jsonText))
    {
        switch (currentState)
        {
            case ParserState.Begin:
                switch (token.Type)
                {
                    case TokenType.BeginObject:
                        currentState = ParserState.Name;
                        current = result = new JsonObject();
                        break;
                    case TokenType.BeginArray:
                        currentState = ParserState.Value;
                        current = result = new JsonArray();
                        break;
                    default:
                        throw new JsonException(token, currentState);
                }
                break;
            case ParserState.Name:
                switch (token.Type)
                {
                    case TokenType.String:
                        currentState = ParserState.NameSeparator;
                        key = (string)token.Value;
                        break;
                    default:
                        throw new JsonException(token, currentState);
                }
                break;
            case ParserState.NameSeparator:
                switch (token.Type)
                {
                    case TokenType.NameSeparator:
                        currentState = ParserState.Value;
                        break;
                    default:
                        throw new JsonException(token, currentState);
                }
                break;
            case ParserState.Value:
                switch (token.Type)
                {
                    case TokenType.Number:
                    case TokenType.String:
                    case TokenType.True:
                    case TokenType.False:
                    case TokenType.Null:
                        currentState = ParserState.ValueSeparator;
                        value = token.Value;
                        break;
                    case TokenType.BeginObject:
                        structureStack.Push(current);
                        keyStack.Push(key);
                        currentState = ParserState.Name;
                        current = new JsonObject();
                        break;
                    case TokenType.BeginArray:
                        structureStack.Push(current);
                        currentState = ParserState.Value;
                        current = new JsonArray();
                        break;
                    default:
                        throw new JsonException(token, currentState);
                }
                break;
            case ParserState.ValueSeparator:
                var jsonObject = (current as JsonObject);
                var jsonArray = (current as JsonArray);
                if (jsonObject != null)
                {
                    jsonObject.Add(key, value);
                    currentState = ParserState.Name;
                }
                if (jsonArray != null)
                {
                    jsonArray.Add(value);
                    currentState = ParserState.Value;
                }
                switch (token.Type)
                {
                    case TokenType.EndObject:
                    case TokenType.EndArray:
                        currentState = ParserState.End;
                        break;
                    case TokenType.ValueSeparator:
                        break;
                    default:
                        throw new JsonException(token, currentState);
                }
                break;
            case ParserState.End:
                switch (token.Type)
                {
                    case TokenType.EndObject:
                    case TokenType.EndArray:
                    case TokenType.ValueSeparator:
                        var previous = structureStack.Pop();
                        var previousJsonObject = (previous as JsonObject);
                        var previousJsonArray = (previous as JsonArray);
                        if (previousJsonObject != null)
                        {
                            previousJsonObject.Add(keyStack.Pop(), current);
                            currentState = ParserState.Name;
                        }
                        if (previousJsonArray != null)
                        {
                            previousJsonArray.Add(current);
                            currentState = ParserState.Value;
                        }
                        if (token.Type != TokenType.ValueSeparator)
                        {
                            currentState = ParserState.End;
                        }
                        current = previous;
                        break;
                    default:
                        throw new JsonException(token, currentState);
                }
                break;
            default:
                break;
        }
    }
    return result;
}
</code></pre>
","<c#><json><refactoring><parsing>","9","383","2010-04-16 09:02:28"
"2653439","Restful authentication + Facebook connect - User model redesign","<p>I have a site with Restful authentication as authentication plugin. I need to integrate Facebook connect. Facebook does not provide email address for the user (maybe only if user agrees if), and of course does not provide a password. </p>

<p>The main issue is that the User model has a lot of <code>validates_**</code> on those 2 fields (from Restful authentication modules).
Another little issue would be that we already have a lot of code (observers sending emails after user creation, etc etc) that depends on email address.
The solution present in the facebook_connect tutorials was to save the user model bypassing validations, but this is sooo wrong..</p>

<p>How would you <em>redesign the User model</em> to <em>include any/both of the authentication methods</em>(standard and/or facebook_connect)?</p>

<ol>
<li><p>Refactor all validations (with :unless => :is_facebook_user), put conditions on observers, etc. </p></li>
<li><p>Implement STI on User table (and have StandardUser / FacebookUser, each with custom authentication modules)</p></li>
<li><p>User table having polymorphic reference to standard_user and facebook_user </p></li>
<li><p>Other ideea</p></li>
</ol>

<p>Please notice that the functionality to link a 'standard' account to a 'facebook' account is also required, which complicates things.</p>

<p>References:</p>

<p><a href=""http://crazyviraj.blogspot.com/2010/01/test-cases-for-basic-facebook-connect.html"" rel=""nofollow"">http://crazyviraj.blogspot.com/2010/01/test-cases-for-basic-facebook-connect.html</a></p>

<p><a href=""http://blog.yangtheman.com/2009/08/23/how-to-integrate-facebook-connect-with-a-rails-app/comment-page-1/"" rel=""nofollow"">http://blog.yangtheman.com/2009/08/23/how-to-integrate-facebook-connect-with-a-rails-app/comment-page-1/</a></p>
","<ruby-on-rails><refactoring><facebook-connect><data-modeling><restful-authentication>","0","502","2010-04-16 13:59:32"
"2653639","Refactoring an ASP.NET 2.0 app to be more ""modern""","<p>This is a hypothetical scenario.  Let's say you've just been hired at a company with a small development team.  The company uses an internal CRM/ERP type system written in .NET 2.0 to manage all of it's day to day things (let's simplify and say customer accounts and records).  The app was written a couple of years ago when .NET 2.0 was just out and uses the following architectural designs:</p>

<ul>
<li>Webforms</li>
<li>Data layer is a thin wrapper around SqlCommand that calls stored procedures</li>
<li>Rudimentary DTO-style business objects that are populated via the sprocs</li>
<li>A ""business logic"" layer that acts as a gateway between the webform and database (i.e. code behind calls that layer)</li>
</ul>

<p>Let's say that as there are more changes and requirements added to the application, you start to feel that the old architecture is showing its age, and changes are increasingly more difficult to make.  How would you go about introducing refactoring steps to A) Modernize the app (i.e. proper separation of concerns) and B) Make sure that the app can readily adapt to change in the organization?</p>

<p>IMO the changes would involve:</p>

<ul>
<li>Introduce an ORM like Linq to Sql and get rid of the sprocs for CRUD</li>
<li>Assuming that you can't just throw out Webforms, introduce the M-V-P pattern to the forms</li>
<li>Make sure the gateway classes conform to SRP and the other SOLID principles.</li>
<li>Change the logic that is re-used to be web service methods instead of having to reuse code</li>
</ul>

<p>What are your thoughts?  Again this is a totally hypothetical scenario that many of us have faced in the past, or may end up facing.</p>
","<asp.net><refactoring><software-engineering>","5","140","2010-04-16 14:24:03"
"2657362","How do I force Coderush to always display the context menu when I trigger a Refactor?","<p>It seems that starting v9.3 by default CodeRush disables the Refactor context menu and performs the Refactor if there is only one option. How do I force Coderush to always display the context menu when I trigger a Refactor even if there is only one option?</p>
","<refactoring><coderush>","0","81","2010-04-17 05:22:49"
"2660868","Good readings about refactoring data structures","<p>Nowadays most programmers know about code refactorings.</p>

<p>What about refactorings of data structures, are there any good readings about it?</p>

<p>One paradigm that I can think of is the normalization process of a relational database.</p>

<p>Are there any other good examples?</p>
","<data><refactoring>","2","103","2010-04-18 02:22:16"
"2678044","How to refactor this MySQL code?","<pre><code>    SELECT AVG(`col5`)
    FROM `table1`
    WHERE `id` NOT IN (
        SELECT `id` FROM `table2`
        WHERE `col4` = 5
    )
    group by `col2` having sum(`col3`) &gt; 0
UNION
    SELECT MAX(`col5`)
    FROM `table1`
    WHERE `id` NOT IN (
        SELECT `id` FROM `table2`
        WHERE `col4` = 5
    )
    group by `col2` having sum(`col3`) = 0
</code></pre>

<p>For readability and performance reasons, I think this code could be refactored. But how?</p>

<p><strong>EDITIONS</strong></p>

<ol>
<li><p>removed the outer select</p></li>
<li><p>made the first select to return a sum and the second one to return another value</p></li>
<li><p>replaced the <code>SUM</code> by <code>AVG</code></p></li>
</ol>
","<mysql><refactoring>","4","145","2010-04-20 19:33:26"
"2683894","Refactoring exercise with generics","<p>I have a variation on a Quantity (Fowler) class that is designed to facilitate conversion between units. The type is declared as:</p>

<pre><code>public class QuantityConvertibleUnits&lt;TFactory&gt; 
    where TFactory : ConvertableUnitFactory, new() { ... }
</code></pre>

<p>In order to do math operations between dissimilar units, I convert the right hand side of the operation to the equivalent Quantity of whatever unit the left hand side is in, and do the math on the amount (which is a double) before creating a new Quantity. Inside the generic Quantity class, I have the following:</p>

<pre><code>    protected static TQuantity _Add&lt;TQuantity&gt;(TQuantity lhs, TQuantity rhs)
       where TQuantity : QuantityConvertibleUnits&lt;TFactory&gt;, new()
    {
        var toUnit = lhs.ConvertableUnit;
        var equivalentRhs = _Convert&lt;TQuantity&gt;(rhs.Quantity, toUnit);
        var newAmount = lhs.Quantity.Amount + equivalentRhs.Quantity.Amount;
        return _Convert&lt;TQuantity&gt;(new Quantity(newAmount, toUnit.Unit), toUnit);
    }

    protected static TQuantity _Subtract&lt;TQuantity&gt;(TQuantity lhs, TQuantity rhs)
       where TQuantity : QuantityConvertibleUnits&lt;TFactory&gt;, new()
    {
        var toUnit = lhs.ConvertableUnit;
        var equivalentRhs = _Convert&lt;TQuantity&gt;(rhs.Quantity, toUnit);
        var newAmount = lhs.Quantity.Amount - equivalentRhs.Quantity.Amount;
        return _Convert&lt;TQuantity&gt;(new Quantity(newAmount, toUnit.Unit), toUnit);
    }

    ... same for multiply and also divide
</code></pre>

<p>I need to get the typing right for a concrete Quantity, so an example of an add op looks like:</p>

<pre><code>        public static ImperialLengthQuantity operator +(ImperialLengthQuantity lhs, ImperialLengthQuantity rhs) { return _Add(lhs, rhs); }
</code></pre>

<p>The question is those verbose methods in the Quantity class. The only change between the code is the math operator (+, -, *, etc.) so it seems that there should be a way to refactor them into a common method, but I am just not seeing it.</p>

<p>How can I refactor that code?</p>

<p>Cheers,<br>
Berryl</p>
","<c#><generics><refactoring>","1","221","2010-04-21 14:37:29"
"2690235","c++ templates and inheritance","<p>I'm experiencing some problems with breaking my code to reusable parts using templates and inheritance. I'd like to achieve that my tree class and avltree class use the same node class and that avltree class inherits some methods from the tree class and adds some specific ones. So I came up with the code below. Compiler throws an error in tree.h as marked below and I don't really know how to overcome this. Any help appreciated! :) </p>

<p>node.h:</p>

<pre><code>#ifndef NODE_H
#define NODE_H
#include ""tree.h""

template &lt;class T&gt;
class node
{
T data;
    ...

node()
    ... 

  friend class tree&lt;T&gt;;
};

#endif
</code></pre>

<p>tree.h</p>

<pre><code>#ifndef DREVO_H
#define DREVO_H

#include ""node.h""

template &lt;class T&gt;
class tree
{
public: //signatures
    tree();
...

    void insert(const T&amp;);
private:
    node&lt;T&gt; *root; //missing type specifier - int assumed. Note: C++ does not support default-int


};
//implementations

#endif
</code></pre>

<p>avl.h</p>

<pre><code>#ifndef AVL_H
#define AVL_H

#include ""tree.h""
#include ""node.h""

template &lt;class T&gt;
class avl: public tree&lt;T&gt;
{
public: //specific
    int findMin() const;
...

protected:
    void rotateLeft(node&lt;T&gt; *)const;
private:
    node&lt;T&gt; *root;

};

#endif
</code></pre>

<p>avl.cpp (I tried separating headers from implementation, it worked before I started to combine avl code with tree code)</p>

<pre><code>#include ""drevo""
#include ""avl.h""
#include ""vozlisce.h""

template class avl&lt;int&gt;; //I know that only avl with int can be used like this, but currently this is doesn't matter :)
//implementations
...
</code></pre>
","<c++><inheritance><templates><data-structures><refactoring>","1","251","2010-04-22 11:14:48"
"2691488","VS API to facilitate a process to automate fixing of code breaks after refactoring","<p>I have found myself countless times reorganizing our solution (72 +  projects), in efforts to reduce code.  A lot of times it involves pulling out common types/libraries and moving them around.</p>

<p>It always involves a reptitive compiler error so i am having to fix the same compiler error in a lot of different places.  I am looking for a guide to the VS api so i can do some code generation/automated fixing.</p>

<p>Even if you dont have the exact solution, can you please point me to where i should look?  Is there a compiler api?  refactor api?  Any suggestions on how i can do either one? </p>

<p>Use Cases:</p>

<p>So first question (easiest of the two):</p>

<p>Automated fixing when i move a file from one project to another.  This process would be to find the error</p>

<blockquote>
  <p>""The type or namespace name 'MovedClass' could not be found.  </p>
</blockquote>

<p>Then remove the old namespace, add the new, and add the project reference.</p>

<p>Case Two...  refactoring to a pattern.</p>

<p>Example:</p>

<p>Original Base VO Class: </p>

<pre><code>   public class BaseVO{
      public AuditInfo { get;set;}

   }
   public class BaseKey{

   }
</code></pre>

<hr>

<p>All of our Business Objects(each in individual class).</p>

<pre><code>   public class ExampleBusinessVO : BaseVO{
      public AuditInfo { get;set;}
      public ExampleBusinessKey BusinessKey { get;set;}
   }

   public class ExampleBusinessKey{


   }
</code></pre>

<hr>

<hr>

<p>Now assume we want to add an explicit link between BaseVO and Base Key, and force all to implement Equals/HashCode</p>

<p>New Base VO Class: </p>

<pre><code>   public abstract class BaseVO&lt;TKey&gt;{
      TKey BusinessKey{get;set;}
      public abstract override bool Equals(object obj);          
      public abstract override int GetHashCode();

   }
   public class BaseKey{

   }
</code></pre>

<hr>

<p>All then i must cascade these changes to all VOs. (ouch )</p>

<pre><code>   //Add generic
   public class ExampleBusinessVO : BaseVO&lt;ExampleBusinessKey&gt;{
       //Remove old business key  

        //Implement methods
       public override bool Equals(object obj){

       }
   }

   public class ExampleBusinessKey: BaseKey{


   }
</code></pre>

<p>Now i recognize i can't fix all of the errors, but it would be nice to be able to write something to check a class for the compile errors.  Then i could develop a pragmatic solution:</p>

<p>For each of the VOs if error: ""Using the generic type ... requires 1 type argument"", then read the class file and find the class that implements BaseKey, and then add it to the template method.</p>

<p><strong>Please note i am looking for an automated solution not a refactoring tool</strong></p>
","<c#><visual-studio-2008><api><refactoring>","2","61","2010-04-22 14:05:39"
"2696739","Using a part of a class in multiple projects","<p>I have a set of methods that do some utility work over SQL connection, and until now these have been copied over from project to project. But as time goes on, project numbers have grown and I need to keep these methods in sync in case I find a bug or need to update it.</p>

<p>I have managed to get it to the state that SQL access class is a <strong>partial</strong> class, one part is specific for project and contains wrappers for a specific database. The second part is the common one and contains methods that are used in all project-specific databases.</p>

<p>The problem is that now I would have the ""utility"" class copied over 8 projects, with the same content, but in different namespaces. In C/C++ it would have been simple, because I would just have #included the contents of the file wherever needed. What should I do in C#?</p>
","<c#><refactoring><partial-classes>","3","123","2010-04-23 06:49:43"
"2706515","Cluttered code (almost complete): refactor it now or later?","<p>I have a very cluttered code, and the current revision is almost complete, meaning all functionalities i wanted for this revision/sprint are done.<br>
Should i finish this revision as it is and refactor it later or should i refactor it right now?</p>
","<refactoring>","2","187","2010-04-24 23:13:38"
"2710503","Updated list of refactoring support for different IDEs","<p>Does anyone know of an updated list of refactoring support for different IDEs?</p>

<p>How many of Fowler's refactorings have tool support in popular IDEs?
And does any IDE use code smells to any greater extent?</p>

<p>I guess one would have to use addons for some IDEs, so even if I did find an updated list of refactoring support for say Eclipse, that would probably not be representative. </p>
","<eclipse><ide><refactoring><code-smell>","2","98","2010-04-26 00:20:06"
"2717383","Avoiding ""variable might not have been initialized""","<p>I recently ran across a routine that looks something like this:</p>

<pre><code>procedure TMyForm.DoSomething(list: TList&lt;TMyObject&gt;; const flag: boolean);
var
  local: integer;
begin
  if flag then
    //do something
  else local := ExpensiveFunctionCallThatCalculatesSomething;

  //do something else
  for i := 0 to list.Count do
    if flag then
      //do something
    else if list[i].IntValue &gt; local then //WARNING HERE
        //do something else
end;
</code></pre>

<p>This gives <code>Variable 'local' might not have been initialized</code> even though you can tell by reading the code that you won't hit that line unless the code branch that initializes it has run.</p>

<p>Now, I could get rid of this warning by adding a useless <code>local := 0;</code> at the top of the procedure, but I wonder if there might not be a better way to structure this to avoid the issue.  Anyone have any ideas?</p>
","<delphi><refactoring><compiler-warnings>","8","979","2010-04-26 22:29:42"
"2717983","jquery small refactoring , json call","<p>I need you suggestion to make some refactoring in jquery code because now it looks terrible for me. I have 4 json calls but the difference it is just the URL call. </p>

<p>EX:</p>

<pre><code>        var userId = MyuserID;
        var perPage = '45';
        var showOnPage = '45';

        var tag =  'tag1';
        var tag1 = 'tag2';
        var tag2 = 'tagn';


        $.getJSON('http://api.flickr.com/services/rest/?format=json&amp;method='+
            'flickr.photos.search&amp;api_key=' + apiKey + '&amp;user_id=' + userId +
            '&amp;tags=' + tag + '&amp;per_page=' + perPage + '&amp;jsoncallback=?',
        function(data){
            var classShown = 'class=""lightbox""';
            var classHidden = 'class=""lightbox hidden""';

            $.each(data.photos.photo, function(i, rPhoto){
                var basePhotoURL = 'http://farm' + rPhoto.farm + '.static.flickr.com/'
                    + rPhoto.server + '/' + rPhoto.id + '_' + rPhoto.secret;

                var thumbPhotoURL = basePhotoURL + '_s.jpg';
                var mediumPhotoURL = basePhotoURL + '.jpg';

                var photoStringStart = '&lt;li&gt;&lt;a ';
                var photoStringEnd = 'title=""' + rPhoto.title + '"" href=""'+
                    mediumPhotoURL +'""&gt;&lt;img src=""' + thumbPhotoURL + '"" alt=""' +
                    rPhoto.title + '""/&gt;&lt;/a&gt;&lt;span&gt;'+rPhoto.title+'&lt;/span&gt;&lt;/li&gt;;'
                var photoString = (i &lt; showOnPage) ?
                    photoStringStart + classShown + photoStringEnd :
                    photoStringStart + classHidden + photoStringEnd;

                $(photoString).appendTo(""#flickr ul"");
            });
            $(""#flickr a"").fancybox();
        });


        $.getJSON('http://api.flickr.com/services/rest/?format=json&amp;method='+
            'flickr.photos.search&amp;api_key=' + apiKey + '&amp;user_id=' + userId +
            '&amp;tags=' + tag1 + '&amp;per_page=' + perPage + '&amp;jsoncallback=?',
        function(data){
            var classShown = 'class=""lightbox""';
            var classHidden = 'class=""lightbox hidden""';

            $.each(data.photos.photo, function(i, rPhoto){
                var basePhotoURL = 'http://farm' + rPhoto.farm + '.static.flickr.com/'
                    + rPhoto.server + '/' + rPhoto.id + '_' + rPhoto.secret;

                var thumbPhotoURL = basePhotoURL + '_s.jpg';
                var mediumPhotoURL = basePhotoURL + '.jpg';

                var photoStringStart = '&lt;li&gt;&lt;a ';
                var photoStringEnd = 'title=""' + rPhoto.title + '"" href=""'+
                    mediumPhotoURL +'""&gt;&lt;img src=""' + thumbPhotoURL + '"" alt=""' +
                    rPhoto.title + '""/&gt;&lt;/a&gt;&lt;span&gt;'+rPhoto.title+'&lt;/span&gt;&lt;/li&gt;;'
                var photoString = (i &lt; showOnPage) ?
                    photoStringStart + classShown + photoStringEnd :
                    photoStringStart + classHidden + photoStringEnd;

                $(photoString).appendTo("".SetPinos1 ul"");
            });
            $("".Sets a"").fancybox();
        });


        $.getJSON('http://api.flickr.com/services/rest/?format=json&amp;method='+
            'flickr.photos.search&amp;api_key=' + apiKey + '&amp;user_id=' + userId +
            '&amp;tags=' + tagn + '&amp;per_page=' + perPage + '&amp;jsoncallback=?',
        function(data){
            var classShown = 'class=""lightbox""';
            var classHidden = 'class=""lightbox hidden""';

            $.each(data.photos.photo, function(i, rPhoto){
                var basePhotoURL = 'http://farm' + rPhoto.farm + '.static.flickr.com/'
                    + rPhoto.server + '/' + rPhoto.id + '_' + rPhoto.secret;

                var thumbPhotoURL = basePhotoURL + '_s.jpg';
                var mediumPhotoURL = basePhotoURL + '.jpg';

                var photoStringStart = '&lt;li&gt;&lt;a ';
                var photoStringEnd = 'title=""' + rPhoto.title + '"" href=""'+
                    mediumPhotoURL +'""&gt;&lt;img src=""' + thumbPhotoURL + '"" alt=""' +
                    rPhoto.title + '""/&gt;&lt;/a&gt;&lt;span&gt;'+rPhoto.title+'&lt;/span&gt;&lt;/li&gt;;'
                var photoString = (i &lt; showOnPage) ?
                    photoStringStart + classShown + photoStringEnd :
                    photoStringStart + classHidden + photoStringEnd;

                $(photoString).appendTo("".SetPinos ul"");
            });
            $("".Sets a"").fancybox();
        });
</code></pre>

<p>var tag is only one difference in this url :</p>

<p>Can somebody help me not to repeat all this stuff ??</p>

<p>Sorry by so long garbage :(  </p>
","<jquery><ajax><refactoring>","1","252","2010-04-27 00:36:36"
"2721009","Refactoring PL/SQL triggers - extract procedures","<p>we have application where database contains large parts of business logic in triggers, with a update subsequently firing triggers on several other tables. I want to refactor the mess and wanted to start by extracting procedures from triggers, but can't find any reliable tool to do this. Using ""Extract procedure"" in both SQL Developer and Toad failed to properly handle :new and :old trigger variables. </p>

<p>If you had similar problem with triggers, did you find a way around it?</p>

<p>EDIT: Ideally, only columns that are referenced by extracted code would be sent as in/out parameters, like:</p>

<p>Example of original code to be extracted from trigger:</p>

<pre><code>  .....
  if :new.col1 = some_var then
    :new.col1 := :old.col1
  end if
  .....
</code></pre>

<p>would become :</p>

<pre><code>  procedure proc(in old_col1 varchar2, in out new_col1 varchar2, some_var varchar2) is
  begin
    if new_col1 = some_var then
      new_col1 := old_col1
    end if;
  end;
  ......
  proc(:old.col1,:new.col1, some_var);
</code></pre>
","<oracle><refactoring><plsql>","3","455","2010-04-27 12:13:28"
"2724195","Cut and Paste Code Reuse - JavaScript and C#","<p>What is the best tool(s) for tracking down ""cut and paste reuse"" of code in JavaScript and C#?
I've inherited a really big project and the amount of code that is repeated throughout the app is 'epic'. I need some help getting handle on all the stuff that can be refactored to base classes, reusable js libs, etc...</p>

<p>If it can plug into Visual Studio 2010, that would be an added bonus.</p>
","<c#><.net><javascript><refactoring><code-analysis>","2","301","2010-04-27 19:07:27"
"2730228","Python: does it make sense to refactor this check into its own method?","<p>I'm still learning python. I just wrote this method to determine if a player has won a game of tic-tac-toe yet, given a board state like: <code>'[['o','x','x'],['x','o','-'],['x','o','o']]'</code></p>

<pre><code>def hasWon(board):
  players = ['x', 'o']
  for player in players:
    for row in board:
      if row.count(player) == 3:
        return player
    top, mid, low = board
    for i in range(3):
      if [ top[i],mid[i],low[i] ].count(player) == 3:
        return player
    if [top[0],mid[1],low[2]].count(player) == 3:
        return player
    if [top[2],mid[1],low[0]].count(player) == 3:
        return player
  return None
</code></pre>

<p>It occurred to me that I check lists of 3 chars several times and could refactor the checking to its own method like so:</p>

<pre><code>def check(list, player):
  if list.count(player) == 3:
    return player
</code></pre>

<p>...but then realized that all that really does is change lines like:</p>

<pre><code> if [ top[i],mid[i],low[i] ].count(player) == 3:
    return player
</code></pre>

<p>to:</p>

<pre><code>  if check( [top[i],mid[i],low[i]], player ):
    return player
</code></pre>

<p>...which frankly doesn't seem like much of an improvement. Do you see a better way to refactor this? Or in general a more Pythonic option? I'd love to hear it!</p>
","<python><refactoring><pythonic><tic-tac-toe>","2","229","2010-04-28 14:12:33"
"2732676","vestal_versions and htmldiff question of reversion","<p>I'm guessing there's probably an easier way to do what I'm doing so that the code is less unwieldy.</p>

<p>I had trouble understanding how to use the revert_to method... i wanted something where i could call up two different versions at the same time, but this doesn't seem to be the way that vestal_versions works.</p>

<p>This code works, but I'm wondering if I'm making something harder than it needs to be and I'd like to find out before I delve deeper.</p>

<pre><code>@article = Article.find(params[:id])

if params[:versions]
  v = params[:versions].split(',')
  @article.revert_to(v.first.to_i)
  @content1 = @article.content
  @article.revert_to(v.last.to_i)
  @content2 = @article.content
end
</code></pre>

<p>In case you're wondering, I'm using this in conjunction with HTMLDIFF to get the version changes.</p>

<pre><code>&lt;div id=""content""&gt;
  &lt;% if params[:versions] %&gt;
    &lt;%= Article.diff(@content1, @content2) %&gt;
  &lt;% else %&gt;
    &lt;%= @article.content %&gt;
  &lt;% end %&gt;
&lt;/div&gt;
</code></pre>
","<ruby-on-rails><refactoring><versioning><vestal-versions><reversion>","1","311","2010-04-28 19:51:25"
"2733343","frequently merge changes between branch and trunk?","<p>My team and I are using svn branches for the first time.  Before, we use to work only from the trunk.</p>

<p>Over the past 2 weeks, we've been refactoring and developing new code against our branch.  But during that time, another developer has been making bug fixes to code in the trunk and deploying it to the production server.   We would like to frequently ""update"" our branch with changes from the trunk to make sure we get the latest fixes.  But the problem is that we're making drastic changes to our branch, and many files have been renamed.  I have a feeling every ""update"" we do on our branch that takes changes from trunk will cause a conflict, unless we some how get subversion to recognise that fileA.html in trunk is really fileB.html in branch.</p>

<p>Am I using subversion branches correctly?  Am I using the word ""update"" correctly?  Are frequent ""updates"" in branch advisable?</p>
","<svn><refactoring>","1","79","2010-04-28 21:44:31"
"2740465","Refactoring a C# derived class with method dependancies","<p>I want to get your opinion on this.</p>

<p>I have a class which is derived from a base class.  I don't have control over the code in the base class and it is critical to the system that I derive from it.</p>

<p>In my class I inherite two methods that are critical to the system and are used in pretty much every function, many times.</p>

<p>I intend to refactor this derived class and extract some classes from it  - this won't be a problem.  What I'm not sure about is, is it worth extracting class if I have to constantly make call backs to my main class to access the two methods (or public wrappers to the methods)???  </p>

<p>Thanks</p>
","<c#><design-patterns><inheritance><refactoring>","2","119","2010-04-29 20:13:22"
"2741593","Is TDD broken in Python?","<p>Assume we have a class <code>UserService</code> with attribute <code>current_user</code>. Suppose it is used in <code>AppService</code> class.</p>

<p>We have <code>AppService</code> covered with tests. In test setup we stub out <code>current_user</code> with some mock value:</p>

<pre><code>UserService.current_user = 'TestUser'
</code></pre>

<p>Assume we decide to rename <code>current_user</code> to <code>active_user</code>. We rename it in <code>UserService</code> but forget to make change to its usage in <code>AppService</code>.</p>

<p>We run tests and they pass! Test setup adds attribute <code>current_user</code> which is still (wrongly but successfully) used in <code>AppService</code>.</p>

<p>Now our tests are useless. They pass but application will fail in production.</p>

<p>We can't rely on our test suite ==> TDD is not possible.</p>

<p>Is TDD broken in Python?</p>
","<python><unit-testing><refactoring><tdd><mocking>","3","367","2010-04-30 00:21:03"
"2741689","are projects with high developer turn over rate really a bad thing?","<p>I've inherited a lot of web projects that experienced high developer turn over rates.   Sometimes these web projects are a horrible patchwork of band aid solutions.  Other times they can be somewhat maintainable mosaics of half-done features each built with a different architectural style.  Everytime I inherit these projects, I wish the previous developers could explain to me why things got so bad.</p>

<p>What puzzles me is the reaction of the owners (either a manager, a middle man company, or a client).  They seem to think, ""Well, if you leave, I'll find another developer, because you're expendable.""   Or they think, ""Oh, it costs that much money to refactor the system?   I know another developer who can do it at half the price.  I'll hire him if I can't afford you.""   I'm guessing that the high developer turn over rate is related to the owner's mentality of ""My ideas are always great ideas, and if you don't agree, I'll find another (possibly cheaper) developer who agrees with me and does what I want"".  For the owners, the approach seems to work because their business is thriving.  Unfortunately, it's no fun for developers because they go AWOL after 3-4 months of working with poor code, strict timelines, and insufficient client feedback.</p>

<p>So my question is the following:</p>

<p>Are the following symptoms of a project really such a bad thing for business?</p>

<ul>
<li><p>high developer turn over rate</p></li>
<li><p>poorly built technology - often a patchwork of different and inappropriately used architectural styles</p></li>
<li><p>owners without a clear roadmap for their web project, and they request features on a whim</p></li>
</ul>

<p>I've seen numerous businesses prosper with the symptoms above.  <strong>So as a programmer, even though my instincts tell me the above points are terrible, I need to take a step back and ask, ""are things really that bad in the grand scheme of things?""</strong>  If not, I will re-evaluate my approach to these projects..ie. Do I build long term solutions or band-aid solutions?</p>

<p>** At the risk of this post being closed as non-programming related, I'd like to argue that I think it is programming related because answers to this question will influence the way a developer approaches a project.  He will have a better feel for how far in advance he should plan his development (ie. build short term or long term solution) knowing he may quit at any moment.</p>
","<refactoring><project-management><entropy>","12","428","2010-04-30 00:51:01"
"2742426","Automate refactor import/using directives, using ReSharper and Visual Studio 2010","<p>I want to automate the Visual Studio 2010 / Resharper 5 auto inserting import directives to put my internal namespaces into the namespace sphere. Like this:</p>

<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using StructureMap;
using MyProject.Core;          // &lt;--- Move inside.
using MyProject.Core.Common;   // &lt;--- Move inside.

namespace MyProject.DependencyResolution
{
    using Core;
    using Core.Common;   // &lt;--- My internal namespaces to be here!

    public class DependencyRegistrar
    {
        ...........
    }
}
</code></pre>

<p>Currently, I'm doing it manually, the problem is that with every refactoring the using directives going up, to the beginning of the page.</p>
","<visual-studio-2010><refactoring><resharper><using>","4","899","2010-04-30 05:19:03"
"2743578","Removing a pattern from the beggining and end of a string in ruby","<p>So I found myself needing to remove <code>&lt;br /&gt;</code> tags from the beginning and end of strings in a project I'm working on. I made a quick little method that does what I need it to do but I'm not convinced it's the best way to go about doing this sort of thing. I suspect there's probably a handy regular expression I can use to do it in only a couple of lines. Here's what I got:</p>

<pre><code>def remove_breaks(text)  
    if text != nil and text != """"
        text.strip!

        index = text.rindex(""&lt;br /&gt;"")

        while index != nil and index == text.length - 6
            text = text[0, text.length - 6]

            text.strip!

            index = text.rindex(""&lt;br /&gt;"")
        end

        text.strip!

        index = text.index(""&lt;br /&gt;"")

        while index != nil and index == 0
            text = test[6, text.length]

            text.strip!

            index = text.index(""&lt;br /&gt;"")
        end
    end

    return text
end
</code></pre>

<p>Now the <code>""&lt;br /&gt;""</code> could really be anything, and it'd probably be more useful to make a general use function that takes as an argument the string that needs to be stripped from the beginning and end.</p>

<p>I'm open to any suggestions on how to make this cleaner because this just seems like it can be improved.</p>
","<ruby-on-rails><ruby><string><refactoring>","2","151","2010-04-30 09:35:51"
"2744806","How to set default values to all wrong or null parameters of method?","<p>At the moment I have this code (and I don't like it):    private RenderedImage </p>

<pre><code>private RenderedImage getChartImage (GanttChartModel model, String title,
                                     Integer width, Integer height,
                                     String xAxisLabel, String yAxisLabel,
                                     Boolean showLegend) {
    if (title == null) {
        title = """";
    }
    if (xAxisLabel == null) {
        xAxisLabel = """";
    }
    if (yAxisLabel == null) {
        yAxisLabel = """";
    }
    if (showLegend == null) {
        showLegend = true;
    }
    if (width == null) {
        width = DEFAULT_WIDTH;
    }
    if (height == null) {
        height = DEFAULT_HEIGHT;
    }
    ...
}
</code></pre>

<p>How can I improve it? </p>

<p>I have some thoughts about introducing an object which will contain all these parameters as fields and then, maybe, it'll be possible to apply builder pattern. But still don't have clear vision how to implement that and I'm not sure that it's worth to be done. Any other ideas?</p>
","<java><oop><refactoring>","3","104","2010-04-30 13:30:23"
"2749082","Why Does This Maintainability Index Increase?","<p>I would be appreciative if someone could explain to me the difference between the following two pieces of code in terms of Visual Studio's Code Metrics rules. Why does the Maintainability Index increase slightly if I don't encapsulate everything within using ( )?</p>

<p><strong>Sample 1</strong> (<em>MI score of 71</em>)</p>

<pre><code>public static String Sha1(String plainText)
{
    using (SHA1Managed sha1 = new SHA1Managed())
    {
        Byte[] text = Encoding.Unicode.GetBytes(plainText);
        Byte[] hashBytes = sha1.ComputeHash(text);
        return Convert.ToBase64String(hashBytes);    
    }
}
</code></pre>

<p><strong>Sample 2</strong> (<em>MI score of 73</em>)</p>

<pre><code>public static String Sha1(String plainText)
{
    Byte[] text, hashBytes;
    using (SHA1Managed sha1 = new SHA1Managed())
    {
        text = Encoding.Unicode.GetBytes(plainText);
        hashBytes = sha1.ComputeHash(text);
    }
    return Convert.ToBase64String(hashBytes);   
}
</code></pre>

<p>I understand metrics are meaningless outside of a broader context and understanding, and programmers should exercise discretion. While I <em>could</em> boost the score up to 76 with <code>return Convert.ToBase64String(sha1.ComputeHash(Encoding.Unicode.GetBytes(plainText)))</code>, I shouldn't. I would clearly be just playing with numbers and it isn't truly any more readable or maintainable at that point. I am curious though as to what the logic might be behind the increase in this case. It's obviously not line-count.</p>
","<c#><refactoring><metrics><code-metrics>","5","1371","2010-05-01 06:13:42"
"2747021","So, I have this jquery bit that adds a row to a table the way I need it to, but it's UGLY","<p>I have a table that looks like this: </p>

<pre><code>&lt;table name=""exercises"" id=""workout-table""&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Reps/Intervals&lt;/th&gt;
&lt;th&gt;Sets&lt;/th&gt;
&lt;th&gt;Weight/Distance/Time&lt;/th&gt;
&lt;/tr&gt;


[%- i=0 %]
[% WHILE i&lt;=10 %]
&lt;tr class=""workout-rows""&gt;
&lt;td&gt;&lt;input type=""text"" name=""workout[exercise][[% i %]][name]"" /&gt;&lt;/td&gt;
&lt;td&gt;&lt;input type=""text"" name=""workout[exercise][[% i %]][repetitions]"" size=""3""/&gt;&lt;/td&gt;
&lt;td&gt;&lt;input type=""text"" name=""workout[exercise][[% i %]][sets]"" size=""3""/&gt;&lt;/td&gt;
&lt;td&gt;&lt;input type=""text"" name=""workout[exercise][[% i %]][weight]"" size=""4""/&gt;&lt;/td&gt;
&lt;/tr&gt;
[% i = i + 1 %]
[% END %]

&lt;/table&gt;
</code></pre>

<p>That template code is Template::Toolkit code that basically just generates an index so I can keep track of elements in what will become an HoAoH from Catalyst::Plugin::Params::Nested.  This is the javascript that actually adds the row to the table on button click:</p>

<pre><code>$(""#add-row"").click(function(){
       var size = $("".workout-rows"").length;
       //size += 1;
       var row ='&lt;tr class=""workout-rows""&gt;' +
        '&lt;td&gt;&lt;input type=""text"" name=""workout[exercise][' + size + '][name]"" /&gt;&lt;/td&gt;' +
        '&lt;td&gt;&lt;input type=""text"" name=""workout[exercise][' + size + '][repetitions]"" size=""3""/&gt;&lt;/td&gt;' +
        '&lt;td&gt;&lt;input type=""text"" name=""workout[exercise][' + size + '][sets]"" size=""3""/&gt;&lt;/td&gt;' +
        '&lt;td&gt;&lt;input type=""text"" name=""workout[exercise][' + size + '][weight]"" size=""4""/&gt;&lt;/td&gt;' +
        '&lt;/tr&gt;';

       $(""#workout-table &gt;tbody tr:last"").after(row)
    });
</code></pre>

<p>I really really don't like the idea of copy-pasting the table row markup into the script itself, as it's repetitive and non-intuitive.  I've tried .clone stuff, which works great for copying the row verbatim, but it doesn't keep track of the number of rows dynamically like I need it to.</p>

<p>So basically I've pared it down to needing to find out how to mess with the name of each input so that it can reflect the loop index appropriately, so Catalyst::Plugin::Params::Nested will build the correct structure.</p>

<p>Thoughts?</p>
","<jquery><perl><refactoring><template-toolkit><code-beautification>","0","161","2010-04-30 19:13:59"
"2747090","PHP Array logic re-factor","<h1>PHP Array logic re-factor</h1>

<p>I'm trying to re-factor my code... This is PHP ...</p>

<p>I have the following:</p>

<pre><code>$totals[] = ""Total"";
$totals[] = $counts['hole'][1] + $counts['warn'][1] + $counts['info'][1] + $counts['crit'][1];
$totals[] = $counts['hole'][2] + $counts['warn'][2] + $counts['info'][2] + $counts['crit'][2];
$totals[] = $counts['hole'][3] + $counts['warn'][3] + $counts['info'][3] + $counts['crit'][3];
$totals[] = $counts['hole'][4] + $counts['warn'][4] + $counts['info'][4] + $counts['crit'][4];
$totals[] = $counts['hole'][5] + $counts['warn'][5] + $counts['info'][5] + $counts['crit'][5];
$totals[] = $counts['hole'][6] + $counts['warn'][6] + $counts['info'][6] + $counts['crit'][6];
</code></pre>

<hr>

<p>Why doesn't this work?</p>

<pre><code>for($i; $i &lt; 6; $i++ ){
    foreach( $severity as $sev ){
        $totals[$i] = $totals[$i] + $counts[$sev][$i];
    }
}
</code></pre>
","<php><refactoring><arrays>","2","63","2010-04-30 19:25:58"
"2756280","How to pull a method out of its class (and into a new or existing)?","<p>What is the easiest way of pulling an excisting method out of its class and into a new class using Visual studio 2010 / Resharper?</p>

<p>Edit: I use Resharper version 5.</p>
","<c#><visual-studio-2010><resharper><refactoring>","1","270","2010-05-03 05:31:01"
"2762689","F# replace ref variable with something fun","<p>I have the following F# function which makes use of a ref variable to seed and keep track of a running total, something tells me this isn't in the spirit of fp or even particular clear on its own.  I'd like some direction on the clearest (possible fp, but if an imperative approach is clearer I'd be open to that) way to express this in F#.  Note that selectItem implements a random weighted selection algorithm.</p>

<pre><code>type WeightedItem(id: int, weight: int) =
    member self.id = id
    member self.weight = weight

let selectItem (items: WeightedItem list) (rand:System.Random) =
    let totalWeight = List.sumBy (fun (item: WeightedItem) -&gt; item.weight) items
    let selection = rand.Next(totalWeight) + 1
    let runningWeight = ref 0
    List.find 
        (fun (item: WeightedItem) -&gt;
            runningWeight := !runningWeight + item.weight
            !runningWeight &gt;= selection)
        items

let items = [new WeightedItem(1,100); new WeightedItem(2,50); new WeightedItem(3,25)]
let selection = selectItem items (new System.Random())
</code></pre>
","<f#><refactoring><functional-programming>","4","301","2010-05-04 03:45:48"
"2767443","How to Elegantly convert switch+enum with polymorphism","<p>I'm trying to replace simple enums with type classes.. that is, one class derived from a base for each type.  So for example instead of:</p>

<pre><code>enum E_BASE { EB_ALPHA, EB_BRAVO };
E_BASE message = someMessage();
switch (message) 
{
  case EB_ALPHA: applyAlpha();
  case EB_BRAVO: applyBravo();
}
</code></pre>

<p>I want to do this:</p>

<pre><code>Base* message = someMessage();
message-&gt;apply(this); // use polymorphism to determine what function to call.
</code></pre>

<p>I have seen many ways to do this which all seem less elegant even then the basic switch statement.  Using dyanimc_cast, inheriting from a messageHandler class that needs to be updated every time a new message is added, using a container of function pointers, all seem to defeat the purpose of making code easier to maintain by replacing switches with polymorphism.</p>

<p>This is as close as I can get: (I use templates to avoid inheriting from an all-knowing handler interface)</p>

<pre><code>class Base
{
public:
    template&lt;typename T&gt; virtual void apply(T* sandbox) = 0;
};

class Alpha : public Base
{
public:
    template&lt;typename T&gt; virtual void apply(T* sandbox)
    {
        sandbox-&gt;applyAlpha();
    }
};

class Bravo : public Base
{
public:
    template&lt;typename T&gt; virtual void apply(T* sandbox)
    {
        sandbox-&gt;applyBravo();
    }
};

class Sandbox
{
public:
    void run()
    {
        Base* alpha = new Alpha;
        Base* bravo = new Bravo;

        alpha-&gt;apply(this);
        bravo-&gt;apply(this);

        delete alpha;
        delete bravo;
    }
    void applyAlpha() {
        // cout &lt;&lt; ""Applying alpha\n"";
    }

    void applyBravo() {
        // cout &lt;&lt; ""Applying bravo\n"";
    }
};
</code></pre>

<p>Obviously, this doesn't compile but I'm hoping it gets my problem accross.</p>
","<c++><refactoring><polymorphism>","1","701","2010-05-04 17:20:08"
"2772303","Refactoring a complicated if-condition","<p>Can anyone suggest best way to avoid most if conditions? I have below code, I want avoid most of cases if conditions, how to do it ? any solution is great help;</p>

<pre><code>if (adjustment.adjustmentAccount.isIncrease) {
    if (adjustment.increaseVATLine) {
        if (adjustment.vatItem.isSalesType) {
            entry2.setDebit(adjustment.total);
            entry2.setCredit(0d);
        } else {
            entry2.setCredit(adjustment.total);
            entry2.setDebit(0d);
        }
    } else {
        if (adjustment.vatItem.isSalesType) {
            entry2.setCredit(adjustment.total);
            entry2.setDebit(0d);
        } else {
            entry2.setDebit(adjustment.total);
            entry2.setCredit(0d);
        }
    }
} else {
    if (adjustment.increaseVATLine) {
        if (adjustment.vatItem.isSalesType) {
            entry2.setCredit(adjustment.total);
            entry2.setDebit(0d);
        } else {
            entry2.setDebit(adjustment.total);
            entry2.setCredit(0d);
        }
    } else {
        if (adjustment.vatItem.isSalesType) {
            entry2.setDebit(adjustment.total);
            entry2.setCredit(0d);
        } else {
            entry2.setCredit(adjustment.total);
            entry2.setDebit(0d);
        }
    }
}
</code></pre>
","<java><refactoring><conditional><if-statement>","7","797","2010-05-05 10:21:43"
"2774303","Factoring out conditional from Rails view","<p>I have a line of code in a basic Rails blog application I did that determines whether the suffix to the number of comments should be ""comment"" (if 1) or ""comments"" (0 or 2+)</p>

<p>Currently, it is a line in the view looking like this:</p>

<pre><code>    &lt;%= post.comments.count() %&gt; &lt;%= post.comments.count() == 1 ? ""comment"" : ""comments"" -%&gt;
</code></pre>

<p>However, since I wrote that I have done some more studying, and realized that this logic shouldn't actually go in the view. </p>

<p>Am I right to assume that the real place for this is in the posts helper?</p>

<p>How can I implement it?</p>
","<ruby-on-rails><refactoring><helper>","0","171","2010-05-05 14:52:58"
"2769971","How do you remove functionality from a program in ruby?","<p>You have some <a href=""http://stackoverflow.com/questions/2769851/is-removing-unused-functionality-a-bad-thing"">code you want to remove</a> associated with an obsolete piece of functionality from a ruby project. How do ensure that you get rid of all of the code?</p>

<p>Some guidelines that usually help in refactoring ruby apply, but there are added challenges because having code that isn't being called by anything won't break any unit tests.</p>

<p><strong>Update</strong>: Has anyone written anything that allows you to guess based on your version control history if there are commits where you have since deleted most, but not all, of the code and can point out the remaining code?</p>
","<ruby><refactoring>","1","103","2010-05-05 01:09:55"
"2769508","Any way to surround code block with Curly Braces {} in VS2008?","<p>I always find myself needing to enclose a block of code in curly braces <strong>{ }</strong>, but unfortunately that isn't included in the C# surround code snippets, which seems to be an oversight.  I couldn't find anything on building your own surround snippets either (just other kinds of snippets).  </p>

<p>I am actually running Resharper too, but it doesn't seem to have this functionality either (or I haven't figured how to activate it).  </p>

<p>We have a coding standard of including <em>even a single line of code</em> after an <strong>if</strong> or <strong>else</strong> in curly braces, so if I could just make Resharper do that refactoring automatically that would be even better!</p>
","<c#><visual-studio-2008><refactoring><resharper><code-snippets>","3","1055","2010-05-04 22:55:30"
"2783420","Is there a better way to write this repetitive event-declaration code in C# when implementing an interface explicitly?","<p>I have a lot of code like the following, where I explicitly implement some events required by an interface.</p>

<pre><code>public class IMicrowaveNotifier {
  event EventHandler&lt;EventArgs&gt; DoorClosed;
  event EventHandler&lt;EventArgs&gt; LightbulbOn;
  // ...
}

public class Microwave : IMicrowaveNotifier {
  private EventHandler&lt;EventArgs&gt; _doorClosed;
  event EventHandler&lt;EventArgs&gt; IMicrowaveNotifier.DoorClosed {
    add { lock (this) _doorClosed += value; }
    remove { lock (this) _doorClosed -= value; }
  }

  private EventHandler&lt;EventArgs&gt; _lightbulbOn;
  event EventHandler&lt;EventArgs&gt; IMicrowaveNotifier.LightbulbOn {
    add { lock (this) _lightbulbOn += value; }
    remove { lock (this) _lightbulbOn -= value; }
  }

  // ...
}
</code></pre>

<p>You can see that much of this is boilerplate. In Ruby I'd be able to do something like this:</p>

<pre><code>class Microwave
  has_events :door_closed, :lightbulb_on, ...
end
</code></pre>

<p>Is there a similar shorter way of removing this boilerplate in C#?</p>

<hr/>

<p><strong>Update:</strong> I left a very important part out of my example: namely, the events getting implemented are part of an interface, and I want to implement it explicitly. Sorry for not mentioning this earlier!</p>
","<c#><refactoring><events><boilerplate>","2","165","2010-05-06 18:20:19"
"2780744","c# 4.0 - best way to refactor a block of ""If (something is Type) {}"" statements?","<p>I've got some code that looks like this,</p>

<pre><code>public void ResetControls(Control controlOnPage)
{
    if (controlOnPage is TextBox)
    {
        ResetTextBoxControl(controlOnPage);
    }

    if (controlOnPage is MediaPicker)
    {
        ((MediaPicker)controlOnPage).Media = null;
    }

    if (controlOnPage is RelatedContentPicker)
    {
        ((RelatedContentPicker)controlOnPage).RelatedContentCollection = null;
    }
    ...
    ...

    foreach (Control child in controlOnPage.Controls)
    {
        ResetControls(child);
    }
}
</code></pre>

<p>The idea behind it is that I can pass a page to the method and it'll recursively reset all the controls on it to their default states - in the case of MediaPicker and RelatedContentPicker, these are user controls that I've created.</p>

<p>FXCop warns me ""Do Not Cast Unnecessarily"" for this code - but I'm unsure how to rewrite it to make it better.  Any ideas?</p>
","<types><c#-4.0><refactoring>","1","166","2010-05-06 11:40:45"
"2784519","How do I unit test the methods in a method object?","<p>I've performed the ""<a href=""http://sourcemaking.com/refactoring/replace-method-with-method-object"" rel=""nofollow"">Replace Method with Method Object</a>"" refactoring described by <a href=""http://books.google.com/books?id=1MsETFPD3I0C&amp;pg=PA135&amp;lpg=PA135&amp;dq=%22Replace+Method+with+Method+Object%22++Beck&amp;source=bl&amp;ots=pKS1l5PLff&amp;sig=tp3gs4GUg66Fwch8kRi4mUAbPJU&amp;hl=en&amp;ei=PDPjS9SzFMO78gad5cSnBA&amp;sa=X&amp;oi=book_result&amp;ct=result&amp;resnum=4&amp;ved=0CCEQ6AEwAw#v=onepage&amp;q=%22Replace%20Method%20with%20Method%20Object%22%20%20Beck&amp;f=false"" rel=""nofollow"">Beck</a>.</p>

<p>Now, I have a class with a ""run()"" method and a bunch of member functions that decompose the computation into smaller units. How do I test those member functions?</p>

<p>My first idea is that my unit tests be basically copies of the ""run()"" method (with different initializations), but with assertions between each call to the member functions to check the state of the computation.</p>

<p>(I'm using Python and the unittest module.)</p>

<pre><code>class Train: 

    def __init__(self, options, points): 
        self._options = options 
        self._points = points 
        # other initializations

    def run(self): 
        self._setup_mappings_dict() 
        self._setup_train_and_estimation_sets() 
        if self._options.estimate_method == 'per_class': 
            self._setup_priors() 
        self._estimate_all_mappings() 
        self._save_mappings() 

    def _estimate_all_mappings(): 
        # implementation, calls to methods in this class

    #other method definitions
</code></pre>

<p>I definitely have expectations about what the the states of the member attributes should be before and after calls to the the different methods as part of the implementation of the <code>run()</code> method. Should I be making assertions about these ""private"" attributes? I don't know how else to unittest these methods.</p>

<p>The other option is that I really shouldn't be testing these.</p>
","<python><unit-testing><refactoring><tdd>","3","444","2010-05-06 21:10:50"
"2789310","How can i make this code, more Ruby-esque?","<pre><code>unless scope.nil?
  @page ||= Page.find(id, :scope =&gt; Page.find(scope) )
else
  @page ||= Page.find(id)
end
</code></pre>
","<ruby><refactoring>","0","116","2010-05-07 14:31:47"
"2792136","Replace conditional with polymorphism refactoring or similar?","<p>I have tried to ask a variant of this question before. I got some helpful answers, but still nothing that felt quite right to me. It seems to me this shouldn't really be that hard a nut to crack, but I'm not able to find an elegant simple solution. (Here's my previous post, but please try to look at the problem stated here as procedural code first so as not to be influenced by the earlier explanation which seemed to lead to very complicated solutions: <a href=""http://stackoverflow.com/questions/2772858/design-pattern-for-cost-calculator-app"">http://stackoverflow.com/questions/2772858/design-pattern-for-cost-calculator-app</a> )</p>

<p>Basically, the problem is to create a calculator for hours needed for projects that can contain a number of services. In this case ""writing"" and ""analysis"". The hours are calculated differently for the different services: writing is calculated by multiplying a ""per product"" hour rate with the number of products, and the more products are included in the project, the lower the hour rate is, but the total number of hours is accumulated progressively (i.e. for a medium-sized project you take both the small range pricing and then add the medium range pricing up to the number of actual products). Whereas for analysis it's much simpler, it is just a bulk rate for each size range.</p>

<p>How would you be able to refactor this into an elegant and preferably simple object-oriented version (please note that I would never write it like this in a purely procedural manner, this is just to show the problem in another way succinctly). </p>

<p>I have been thinking in terms of factory, strategy and decorator patterns, but can't get any to work well. (I read Head First Design Patterns a while back, and both the decorator and factory patterns described have some similarities to this problem, but I have trouble seeing them as good solutions as stated there. The decorator example seemed very complicated there for just adding condiments, but maybe it could work better here, I don't know. At least the fact that the calculation of hours accumulates progressively made me think of the decorator pattern... And the factory pattern example from the book with the pizza factory...well it just seems to create such a ridiculous explosion of classes, at least in their example. I have found good use for factory patterns before, but I can't see how I could use it here without getting a really complicated set of classes) </p>

<p>The main goal would be to only have to change in one place (loose coupling etc) if I were to add a new parameter (say another size, like XSMALL, and/or another service, like ""Administration""). Here's the procedural code example:</p>

<pre><code>public class Conditional
{
    private int _numberOfManuals;
    private string _serviceType;
    private const int SMALL = 2;
    private const int MEDIUM = 8;

    public int GetHours()
    {
        if (_numberOfManuals &lt;= SMALL)
        {
            if (_serviceType == ""writing"")
                return 30 * _numberOfManuals;
            if (_serviceType == ""analysis"")
                return 10;
        }
        else if (_numberOfManuals &lt;= MEDIUM)
        {
            if (_serviceType == ""writing"")
                return (SMALL * 30) + (20 * _numberOfManuals - SMALL);
            if (_serviceType == ""analysis"")
                return 20;
        }
        else //i.e. LARGE
        {
            if (_serviceType == ""writing"")
                return (SMALL * 30) + (20 * (MEDIUM - SMALL)) + (10 * _numberOfManuals - MEDIUM);
            if (_serviceType == ""analysis"")
                return 30;
        }
        return 0; //Just a default fallback for this contrived example
    }
}
</code></pre>

<p>All replies are appreciated! (But as I stated in my previous posts I would appreciate actual code examples rather than just ""Try this pattern"", because as I mentioned, that is what I'm having trouble with...) I hope someone has a really elegant solution to this problem that I actually thought from the beginning would be really simple...</p>

<p>========================================================</p>

<p>NEW ADDITION:</p>

<p>I appreciate all the answers so far, but I'm still not seeing a really simple and flexible solution to the problem (one I thought wouldn't be very complex at first, but apparently is). It may also be that I haven't quite understood each answer correctly yet. But I thought I'd post my current attempt at working it out (with some help from reading all the different angles in answers here). Please tell me if I'm on the right track or not. But at least now it feels like it's starting to get more flexible... I can quite easily add new parameters without having to change in lots of places (I think!), and the conditional logic is all in one place. I have some of it in xml to get the basic data, which simplifies part of the problem, and part of it is an attempt at a strategy type solution.</p>

<p>Here's the code:</p>

<pre><code> public class Service
{
    protected HourCalculatingStrategy _calculatingStrategy;
    public int NumberOfProducts { get; set; }
    public const int SMALL = 3;
    public const int MEDIUM = 9;
    public const int LARGE = 20;
    protected string _serviceType;
    protected Dictionary&lt;string, decimal&gt; _reuseLevels;

    protected Service(int numberOfProducts)
    {
        NumberOfProducts = numberOfProducts;
    }

    public virtual decimal GetHours()
    {
        decimal hours = _calculatingStrategy.GetHours(NumberOfProducts, _serviceType);
        return hours;
    }
}

public class WritingService : Service
{
    public WritingService(int numberOfProducts)
        : base(numberOfProducts)
    {
        _calculatingStrategy = new VariableCalculatingStrategy();
        _serviceType = ""writing"";
    }
}

class AnalysisService : Service
{
    public AnalysisService(int numberOfProducts)
        : base(numberOfProducts)
    {
        _calculatingStrategy = new FixedCalculatingStrategy();
        _serviceType = ""analysis"";
    }
}

public abstract class HourCalculatingStrategy
{
    public abstract int GetHours(int numberOfProducts, string serviceType);

    protected int GetHourRate(string serviceType, Size size)
    {
        XmlDocument doc = new XmlDocument();
        doc.Load(""calculatorData.xml"");
        string result = doc.SelectSingleNode(string.Format(""//*[@type='{0}']/{1}"", serviceType, size)).InnerText;
        return int.Parse(result);
    }
    protected Size GetSize(int index)
    {
        if (index &lt; Service.SMALL)
            return Size.small;
        if (index &lt; Service.MEDIUM)
            return Size.medium;
        if (index &lt; Service.LARGE)
            return Size.large;
        return Size.xlarge;
    }
}

public class VariableCalculatingStrategy : HourCalculatingStrategy
{
    public override int GetHours(int numberOfProducts, string serviceType)
    {
        int hours = 0;
        for (int i = 0; i &lt; numberOfProducts; i++)
        {
            hours += GetHourRate(serviceType, GetSize(i + 1));
        }
        return hours;
    }
}

public class FixedCalculatingStrategy : HourCalculatingStrategy
{
    public override int GetHours(int numberOfProducts, string serviceType)
    {
        return GetHourRate(serviceType, GetSize(numberOfProducts));
    }
}
</code></pre>

<p>And a simple example form that calls it (I guess I could also have a wrapper Project class with a Dictionary containing the Service objects, but I haven't gotten to that):</p>

<pre><code>    public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();
        List&lt;int&gt; quantities = new List&lt;int&gt;();

        for (int i = 0; i &lt; 100; i++)
        {
            quantities.Add(i);
        }
        comboBoxNumberOfProducts.DataSource = quantities;
    }


    private void CreateProject()
    {
        int numberOfProducts = (int)comboBoxNumberOfProducts.SelectedItem;
        Service writing = new WritingService(numberOfProducts);
        Service analysis = new AnalysisService(numberOfProducts);

        labelWriterHours.Text = writing.GetHours().ToString();
        labelAnalysisHours.Text = analysis.GetHours().ToString();
    }
    private void comboBoxNumberOfProducts_SelectedIndexChanged(object sender, EventArgs e)
    {
        CreateProject();
    }

}
</code></pre>

<p>(I wasn't able to include the xml because it got automatically formatted on this page, but it's basically just a bunch of elements with each service type, and each service type containing the sizes with the hour rates as values.)</p>

<p>I'm not sure if I'm just pushing the problem over to the xml file (I'd still have to add new elements for each new servicetype, and add elements for any new size in each servicetype if that changed.) But maybe it's impossible to achieve what I am trying to do and not having to do at least that type of change. Using a database rather than xml the change would be as simple as adding a field and a row:</p>

<p>ServiceType Small Medium Large</p>

<p>Writing     125   100    60</p>

<p>Analysis    56    104    200</p>

<p>(Simply formatted as a ""table"" here, although the columns aren't quite aligned... I'm not the best at database design though, and maybe it should be done differently, but you get the idea...)</p>

<p>Please tell me what you think! </p>
","<c#><design-patterns><refactoring><conditional>","7","1106","2010-05-07 22:49:58"
"2789979","How would you refactor this code?","<p>This hypothetical example illustrates several problems I can't seem to get past, even though I keep trying!! ... Suppose the original code is a long event handler, coded in the UI, triggered when a user clicks a cell in a grid. Expressed as pseudocode it's:</p>

<pre><code>if Condition1=true then
begin
  //loop through every cell in row, 
  //if aCell/headerCellValue&gt;1 then
  //color aCell red
end
else if Condition2=true then
begin
  //do some other calculation adding cell and headerCell values, and
  //if some other product&gt;2 then
  //color the whole row green
end
else show an error message
</code></pre>

<p>I look at this and say ""Ah, refactor to the strategy pattern! The code will be easier to understand, easier to debug, and easier to later extend!"" I get that.</p>

<p>And I can easily break the code into multiple procedures. </p>

<p>The problem is ultimately scope related. Assume the pseudocode makes extensive use of grid properties, values displayed in cells, maybe even built-in grid methods. How do you move all that to another unit, without referencing the grid component in the UI--which would break all the ""rules"" about loose coupling that make OOP valuable? ... </p>

<p>I'm really looking forward to responses. Thanks, as always -- Al C.</p>
","<delphi><design-patterns><oop><refactoring>","0","347","2010-05-07 16:10:29"
"2798868","Proactively using 'lines of code' (LOC) metric in your software-development process?","<p>Codebase size has a lot to do with complexity of a software system (the higher the size the higher the costs for maintenance and extensions). A way to map codebase size is the simple 'lines of code (LOC)' metric (see also <a href=""http://www.aldana-online.de/2010/05/09/process-implications-of-metric-lines-of-code-loc/"" rel=""nofollow"">blog-entry 'implications of codebase-size'</a>).</p>

<p>I wondered how many of you out there are using this metric as a part for retrospective to create awareness (for removing unused functionality or dead code). I think creating awareness that more lines-of-code mean more complexity in maintenance and extension can be valuable.</p>

<p>I am not taking the LOC as fine grained metric (on method or function level), but on subcomponent or complete product level.</p>
","<project-management><refactoring><software-engineering><agile>","1","469","2010-05-09 19:28:42"
"2806004","How can I refactor these script tags?","<p>I have the following script tags in the <code>&lt;head&gt;</code> so that they don't prompt any security errors when going back and forth between SSL and non-SSL pages. But it just looks hairy.</p>

<p>Any way I can combine them or reduce some of the code?</p>

<pre><code>&lt;script type=""text/javascript""&gt;document.write([""\&lt;script src='"",(""https:"" == document.location.protocol) ? ""https://"" : ""http://"",""ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js' type='text/javascript'&gt;\&lt;\/script&gt;""].join(''));&lt;/script&gt;
&lt;script type=""text/javascript""&gt;document.write([""\&lt;script src='"",(""https:"" == document.location.protocol) ? ""https://"" : ""http://"",""html5shiv.googlecode.com/svn/trunk/html5.js' type='text/javascript'&gt;\&lt;\/script&gt;""].join(''));&lt;/script&gt;
&lt;script type=""text/javascript""&gt;document.write([""\&lt;script src='"",(""https:"" == document.location.protocol) ? ""https://"" : ""http://"",""use.typekit.com/12345.js' type='text/javascript'&gt;\&lt;\/script&gt;""].join(''));&lt;/script&gt;
</code></pre>
","<javascript><refactoring>","3","102","2010-05-10 19:59:07"
"2806170","Can I improve performance by refactoring SQL commands into C# classes?","<p>Currently, my entire website does updating from SQL parameterized queries.  It works, we've had no problems with it, but it can occasionally be very slow.</p>

<p>I was wondering if it makes sense to refactor some of these SQL commands into classes so that we would not have to hit the database so often.  I understand hitting the database is generally the slowest part of any web application  For example, say we have a class structure like this:</p>

<p>Project (comprised of) Tasks (comprised of) Assignments</p>

<p>Where Project, Task, and Assignment are classes.</p>

<p>At certain points in the site you are only working on one project at a time, and so creating a Project class and passing it among pages (using Session, Profile, something else) might make sense.  I imagine this class would have a Save() method to save value changes.</p>

<p>Does it make sense to invest the time into doing this?  Under what conditions might it be worth it?</p>
","<c#><asp.net><sql><performance><refactoring>","2","232","2010-05-10 20:21:08"
"2817730","Improve this snippet from a prototype class","<p>This is a snippet from a prototype class i am putting together. The scoping workaround feels a little hacky to me, can it be improved or done differently?</p>

<pre><code>var myClass = Class.create({
    initialize: function() {
        $('formid').getElements().each(function(el){
            $(el).observe(""blur"", function(){
                this.validateEl(el);
            }.bind(this,el));
        },this);
     },
    validateEl: function(el){
      // validate $(el) in here...
    }
});
</code></pre>

<p>Also, it seems to me that i could be doing something like this for the event observers:</p>

<pre><code>$('formid').getElements().invoke(""observe"",""blur"" ...
</code></pre>

<p>Not sure how i would pass the element references in though?</p>
","<javascript><class><refactoring><prototypejs>","0","105","2010-05-12 10:05:10"
"2818082","How to diff two regions of the same file in Eclipse","<p>I'm a TDDer and often have a need to refactor out common or similar code. If it is exactly the same there is no big problem, Eclipse can almost always do that by itself. But to get there I'm finding myself often looking at similar, but not identical, code fragments in the same, or even different, files.</p>

<p>It would be very handy if there was a possibility to mark two regions and get Eclipse (or some other tool) to mark the differences. With this information it would be much simpler to iteratively move the regions closer until they are the same and then activate the Extract Method refactoring.</p>

<p>It can be done in Emacs of course, but I'd like to have this readily available from Eclipse. Any pointers?</p>
","<eclipse><diff><extract><refactoring>","0","75","2010-05-12 10:56:19"
"2820534","Combining database tables","<p>I have two tables which look kind of similar and i was thinking about combining them and thought i would get some input from everyone.
Here's what they currently look like:</p>

<p>Issues</p>

<pre><code>Id  | IssueCategory   | IssueType | Status | etc..
-------------------------------------------------
123 | Copier          | Broken     | Open   |
124 | Hardware        | Missing    | Open   |
</code></pre>

<p>CopierIssueDetails</p>

<pre><code>Id | IssueId | SerialNumber | Make | Model    | TonerNumber | LastCount
---------------------------------------------------------------------
1  | 123     | W12134       | Dell | X1234    | 12344555    | 500120
</code></pre>

<p>HardwareIssueDetails</p>

<pre><code>Id | IssueId | EquipmentNumber | Make | Model | Location  | Toner | Monitor | Mouse 
-----------------------------------------------------------------------------------
1  | 124     | X1123113        | Dell | XXXX  | 1st floor | 0     | 1       | 0
</code></pre>

<p>What do you guys think about combining these two tables into one. Would it be a good idea or is it better to keep them separated like this?
Thanks in advance for any suggestions.</p>
","<database><table><refactoring>","1","74","2010-05-12 15:56:52"
"2827308","Simple way to reorder methods of a Java class in IntelliJ?","<p>Is there a simpler way of reordering methods within a class source file in IntelliJ than cutting and pasting the code manually? Nowadays I often need this while refactoring legacy code, e.g. to move related methods close to each other in the source code.</p>

<p>In Eclipse AFAIK there is a view similar to the Structure view of IntelliJ, where I can drag and drop methods around. However, this does not work in IntelliJ and I couldn't find any hints from its help either.</p>

<p>I am using IntelliJ 9.0.2 to be specific.</p>
","<java><refactoring><methods><intellij-idea>","1","701","2010-05-13 13:54:12"
"2834439","What are some alternatives to resharper?","<p>I'm considering purchasing a resharper license but would like to know if there are any possible alternatives to resharper and how would you rate these compared to reharper?</p>

<p>It doesn't necessarily have to be a free alternative but I would just like to know how good equivalent products are.  </p>
","<c#><asp.net><refactoring><resharper>","26","4581","2010-05-14 13:22:57"
"2838223","Refactor/rewrite code or continue?","<p>I just completed a complex piece of code. It works to spec, it meets performance requirements etc etc but I feel a bit anxious about it and am considering rewriting and/or refactoring it. Should I do this (spending time that could otherwise be spent on features that users will actually notice)?</p>

<p>The reasons I feel anxious about the code are:</p>

<ol>
<li>The class hierarchy is complex and not obvious</li>
<li>Some classes don't have a well defined purpose (they do a number of unrelated things)</li>
<li>Some classes use others internals (they're declared as friend classes) to bypass the layers of abstraction for performance, but I feel they break encapsulation by doing this</li>
<li>Some classes leak implementation details (eg, I changed a map to a hash map earlier and found myself having to modify code in other source files to make the change work)</li>
<li>My memory management/pooling system is kinda clunky and less-than transparent</li>
</ol>

<p>They look like excellent reasons to refactor and clean code, aiding future maintenance and extension, but could be quite time consuming. Also, I'll never be perfectly happy with any code I write anyway...</p>

<p>So, what does stackoverflow think? Clean code or work on features?</p>
","<c++><refactoring><code-design>","6","459","2010-05-14 23:21:51"
"2835641","C variable argument refactoring","<p>I have a function <code>irc_sendline</code> that can be called like <code>printf</code> can</p>

<pre><code>irc_sendline(s, ""A strange game.\nThe only %s is not to play."", ""winning move"");
</code></pre>

<p>It works perfectly, but I'm not happy with its implementation:</p>

<pre><code>int irc_sendline(irc *iobj, char *msg, ...)
{
   char tmp_msg[BUFSIZE], fmsg[BUFSIZE];
   va_list args;
   int len;

   va_start(args, msg);

   strncpy(tmp_msg, msg, BUFSIZE);
   strncat(tmp_msg, ""\r\n"", BUFSIZE);

   len = vsnprintf(fmsg, BUFSIZE, tmp_msg, args);
   len = send(iobj-&gt;fd, fmsg, len, 0);

   return len;
}
</code></pre>

<p>You see, I'm using 2 ""temporary"" buffers here, because I first have to copy the original message from the function arguments to a temporary buffer to append ""\r\n"" to it, and then copy that temporary buffer to <strong>another</strong> temporary buffer to do the actual formatting with the arguments supplied from the function call, and only <em>THEN</em> I can send the stuff on its way.</p>

<p>How could I make this cleaner, better?</p>

<hr>

<p>Thanks for all the input here, I thought my only problem was the mess in there, but it was actually a ticking timebomb! My new function looks like this:</p>

<pre><code>int irc_sendline(irc *iobj, char *msg, ...)
{
   char buffer[BUFSIZE];
   va_list args;
   int res_str_len;
   int sent;

   va_start(args, msg);

   res_str_len = vsnprintf(buffer, BUFSIZE, msg, args);

   sent =  send(iobj-&gt;fd, buffer, res_str_len, 0);
   sent += send(iobj-&gt;fd, ""\r\n"", 2, 0);

   return sent;
}
</code></pre>

<p>If I could, I'd accept multiple answers here, but meh.</p>
","<c><function><refactoring>","6","174","2010-05-14 16:05:59"
"2838889","How can this verbose, unpythonic routine be improved?","<p>Is there a more pythonic way of doing this?  I am trying to find the eight neighbours of an integer coordinate lying within an extent.  I am interested in reducing its verbosity without sacrificing execution speed.</p>

<pre><code>def fringe8((px, py), (x1, y1, x2, y2)):
    f = [(px - 1, py - 1),
         (px - 1, py),
         (px - 1, py + 1),
         (px, py - 1),
         (px, py + 1),
         (px + 1, py - 1),
         (px + 1, py),
         (px + 1, py + 1)]
    f_inrange = []
    for fx, fy in f:
        if fx &lt; x1:  continue
        if fx &gt;= x2: continue
        if fy &lt; y1:  continue
        if fy &gt;= y2: continue
        f_inrange.append((fx, fy))
    return f_inrange
</code></pre>
","<python><refactoring><code-review><pythonic>","4","380","2010-05-15 04:08:24"
"2839475","Modified map2 (without truncation of lists) in F# - how to do it idiomatically?","<p>I'd like to rewrite such function into F#:</p>

<pre><code>zipWith' :: (a -&gt; b -&gt; c) -&gt; (a -&gt; c) -&gt; (b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
zipWith' _ _ h []     bs     = h `map` bs
zipWith' _ g _ as     []     = g `map` as
zipWith' f g h (a:as) (b:bs) = f a b:zipWith f g h as bs
</code></pre>

<p>My first attempt was:</p>

<pre><code>let inline private map2' (xs : seq&lt;'T&gt;) (ys : seq&lt;'U&gt;) (f : 'T -&gt; 'U -&gt; 'S) (g : 'T -&gt; 'S) (h : 'U -&gt; 'S) =
    let xenum = xs.GetEnumerator()
    let yenum = ys.GetEnumerator()
    seq {
        let rec rest (zenum : IEnumerator&lt;'A&gt;) (i : 'A -&gt; 'S) =
            seq {
                yield i(zenum.Current)
                if zenum.MoveNext() then yield! (rest zenum i) else zenum.Dispose()
            }
        let rec merge () =
            seq {
                if xenum.MoveNext()
                then
                    if yenum.MoveNext()
                    then yield (f xenum.Current yenum.Current); yield! (merge ())
                    else yenum.Dispose(); yield! (rest xenum g)
                else
                    xenum.Dispose()
                    if yenum.MoveNext()
                    then yield! (rest yenum h)
                    else yenum.Dispose()
            }
        yield! (merge ())
    }
</code></pre>

<p>However it can hardly be considered idiomatic. I heard about <code>LazyList</code> but I cannot find it anywhere.</p>
","<haskell><f#><refactoring>","1","173","2010-05-15 08:31:29"
"2840844","Does resharper add any kind of code refactoring to VS that Eclipse doesn't have?","<p>And if so are there Eclipse plugins that add those types of code refactoring to eclipse?</p>

<p>note:for C#/Java respectively.</p>
","<java><visual-studio><eclipse><refactoring><resharper>","4","356","2010-05-15 16:25:00"
"2845899","Document-oriented database - What if the document definitions change?","<p>As I understand it, you can enter any non-structured information into a document-oriented database. Let's imagine a document like this:</p>

<pre><code>{
  name: 'John Blank',
  yearOfBirth: 1960
}
</code></pre>

<p>Later, in a new version, this structure is refactored to</p>

<pre><code>{
  firstname: 'John',
  lastname: 'Blank',
  yearOfBirth: 1960
}
</code></pre>

<p>How do you do this with Document-Oriented databases? Do you have to prepare merge-scripts, that alter all your entries in the database? Or are there better ways you can handle changes in the structure?</p>
","<refactoring><nosql><document-oriented-db>","5","243","2010-05-16 23:21:40"
"2852444","Using ideas from Uncle Bob's Clean Code in real-world code","<p>I just finished reading the ""Functions"" chapter from Uncle Bob's <em>Clean Code</em>. The main advice was to make sure that functions are short -- <strong>really</strong> short. And they should only do one thing per level of abstraction. Here's a function from an app I'm making to learn Cocoa (idea from <a href=""http://andymatuschak.org/articles/2007/09/09/getting-started-with-cocoa-a-friendlier-approach/"" rel=""nofollow"">Andy Matuschak</a>).</p>

<pre><code>- (IBAction)go:(id)sender
{
NSString *output = nil;

if ([[nameInputField stringValue] isEqualToString:@""""])
{
    output = @""Please enter your name"";
}
else
{
    NSString *date = [[NSDate date] descriptionWithCalendarFormat:@""%A, %B %d"" 
                                                         timeZone:nil 
                                                           locale:[[NSUserDefaults standardUserDefaults] dictionaryRepresentation]];
    output = [NSString stringWithFormat:@""Hello, %@! Today is %@."", [nameInputField stringValue], date];
}

[responseOutputField setStringValue:output];
}
</code></pre>

<p>Basically, this function reads a name from a text field (<code>nameInputField</code>) and outputs a message to another text field (<code>responseOutputField</code>) I'm wondering a) if this function does 'one thing' per level of abstraction and b) how to make it shorter. </p>
","<objective-c><cocoa><refactoring>","2","342","2010-05-17 20:19:37"
"2854138","Is there any point to an interface if only one class implements it?","<p>Looking at the (mature) codebase at my new job, there is an interface, and only one class implements it (as far as I can tell). Can/should I get rid of the interface?</p>
","<refactoring><interface><class-design>","6","205","2010-05-18 01:53:23"
"2859989","Factoring out a while loop in SQL script","<p>Suppose I have a table amountInfo with columns (id, amount1, amount2, amount3)
where amountX are money values and id is an int value ranging from 1 to some int under 10.</p>

<p>Currently I have some code that approximately does this:</p>

<pre><code>declare @id int, @idmax int, @amounttotal money
select @idmax = (select max(Id) from amountInfo)
while (@id &lt;= @idmax)
begin
    select @amounttotal = sum(amount1 + amount2 + amount3) 
                          from amountinfo where id=@id
    -- do something with @amounttotal
    select @id=@id+1
end
</code></pre>

<p>Is there a way to factor out the while loop with some kind of complex select statement here? I am experienced with C/C++/C# programming but SQL is kinda new to me. Thanks!</p>

<p>EDIT: basically the ""--do something"" part involves inserting the individual @amounttotals into another table. The actual query I'm running is more complicated than that but I'm hoping to solve this simple problem first before posting a huge example of code.</p>
","<sql><refactoring>","1","169","2010-05-18 18:36:22"
"2860006","Good code visualization / refactoring tools for C++?","<p>I've found myself coming across a lot of reasonably large, complicated codebases at work recently which I've been asked to either review or refactor or both.  This can be extremely time consuming when the code is highly concurrent, makes heavy use of templates (particularly static polymorphism) and has logic that depends on callbacks/signals/condition variables/etc.</p>

<p>Are there any good visualization tools for C++ period, and of those are there any that actually play well with ""advanced"" C++ features?  Anything would probably be better than my approach now, which is basically pen+paper or stepping through the debugger.  The debugger method can be good for following a particular code path, but isn't great for seeing the big picture you really need when doing serious refactoring.</p>

<p>EDIT: I should mention that Visual Studio plugins aren't going to be a lot of help to me, since our stuff is mostly Linux-only.</p>
","<c++><refactoring><visualization>","5","945","2010-05-18 18:38:11"
"2864658","PHP: Grab an image from a stream (in an img tag) but if it's not there, i don't want the img tag written. How?","<p>I currently have code like this in a web based file called 'view_file.php' to grab an image from an internal network.</p>

<pre><code>&lt;img src=""put_file.php?type=&lt;?=$TN_TYPE;?&gt;&amp;path=&lt;?=$TN_PATH;?&gt;&amp;filename=&lt;?=$TN_FILENAME;?&gt;"" /&gt;
</code></pre>

<p>The 'put_file.php' script allows access to an internal server that we don't want to expose to the internet. This script checks to see if an image is available and if it is, sends an image header and then uses <code>readfile()</code> to stream the image to the 'view_file.php' page.</p>

<p>The problem is if there isn't an image available, instead of streaming a temporary 'spacer.gif' i want to not have the img tag written at all.</p>

<p>Any Ideas how to do this?
I'm thinking maybe move the img tag into the 'put_file.php' script, but how to mix strings and steams?</p>
","<php><image><refactoring><stream>","0","496","2010-05-19 10:32:32"
"2864669","How can I refactor that code ? (state pattern ?)","<p>How can I refactor that code ?</p>

<pre><code>public enum enum1
{
    value1 = 0x01,
    value2 = 0x02,
    value3 = 0x03,
    value4 = 0x04,
    value5 = 0x05,
    UNKNOWN = 0xFF
}

class class1
{
    private const string STR_VALUE1 = ""some text description of value1"";
    private const string STR_VALUE2 = ""some text description of value2"";
    private const string STR_VALUE3 = ""some text description of value3"";
    private const string STR_VALUE4 = ""some text description of value4"";
    private const string STR_VALUE5 = ""some text description of value5"";
    private const string STR_VALUE6 = ""some text description of unknown type"";

    public static string GetStringByTypeCode(enum1 type)
        {
            switch(type)
            {
                case enum1.value1:
                    return STR_VALUE1;
                case enum1.value2:
                    return STR_VALUE2;
                case enum1.value3:
                    return STR_VALUE3;
                case enum1.value4:
                    return STR_VALUE4;
                case enum1.value5:
                    return STR_VALUE5;
                default:
                    return STR_VALUE6;
            }
        }
}
</code></pre>

<p><strong>PS</strong>: there are many enum1...enumX and GetStringByTypeCode(enum1) ... GetStringByTypeCode(enumX) methods.</p>

<p><strong>EDIT</strong>: I refactored it this way:</p>

<pre><code>namespace ConsoleApplication4
{
    public enum enum1
    {
        value1 = 0x01,
        value2 = 0x02,
        value3 = 0x03,
        value4 = 0x04,
        value5 = 0x05,
        UNKNOWN = 0xFF
    }

    class class1
    {
        static Dictionary&lt;enum1, string&gt; _dict;

        static class1()
        {
            _dict = new Dictionary&lt;enum1, string&gt;();

            _dict.Add(enum1.value1, ""some text description of value1"");
            _dict.Add(enum1.value2, ""some text description of value2"");
            _dict.Add(enum1.value3, ""some text description of value3"");
            _dict.Add(enum1.value4, ""some text description of value4"");
            _dict.Add(enum1.value5, ""some text description of value5"");
            _dict.Add(enum1.UNKNOWN, ""some text description of unknown type"");
        }

        public static string GetStringByTypeCode(enum1 type)
        {
            string result = string.Empty;

            try
            {
                _dict.TryGetValue(type, out result);
            }
            catch
            { 
            }

            return result;
        }
    } 


    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine(class1.GetStringByTypeCode(enum1.value4));

            Console.ReadKey();
        }
    }
}
</code></pre>
","<c#><refactoring>","0","188","2010-05-19 10:34:24"
"2865352","What's the steps for SQL optimization and changes without reflect live system?","<p>we have a big portal that build using SharePoint 2007 , asp.net 3.5 , SQL Server 2005 .. many developers work in it since 01/2008 and we are now doing huge analysis for current SQL Databases [not share-point DB ] to optimize and enhance it.<BR></p>

<ul>
<li>The main db have about <strong>330 table and 1720 stored procedure (SP)</strong> created from 01/2008 till now</li>
<li>Many table names / Columns is very long and we want to short it</li>
<li>we found SP names is written in 25 format :( , some of them are very complex and also we want to rename</li>
<li>many SP parameters need to be renamed</li>
<li>one of the biggest table is Registered user table, that will be spitted in more than one table for some optimization, many columns name will be changed</li>
</ul>

<p>I searched for the way that i can rename table names ,columns and i found SQL refactor tool but i still trying it ..<BR></p>

<p>my questions :<BR></p>

<ul>
<li>Is SQl Refactor is the best tool for renaming ? or is there any other one ?</li>
<li>if i want to make it manually, is there any references or best practice for that ?</li>
<li>How can i do such changes in fast and stable way .. i search for recommendations and case studies if exist ?</li>
</ul>
","<sql-server-2005><database-design><optimization><refactoring>","1","84","2010-05-19 12:19:24"
"2866267","SQL select row-wise increase in amount of running total column","<p>Suppose I have a table with columns (DayId, RunningTotal):</p>

<pre><code>DayId    RunningTotal
---------------------
1        25
3        50
6        100
9        200
10       250
</code></pre>

<p>How can I select the DayId and the amount the RunningTotal has increased from the previous day? i.e. how can I select:</p>

<pre><code>DayId    DayTotal
---------------------
1        25
3        25
6        50
9        100
10       50
</code></pre>

<p>The only current method I know is with a while loop I am trying to factor out. Also, the DayId has no regular rules, just that it is some increasing integer value, but it increases by an irregular amount as shown in the example table. </p>

<p>EDIT: using MS SQL Server 2005</p>
","<sql><refactoring><running-total>","0","612","2010-05-19 14:12:57"
"2866384","A report of refactoring recommendations","<p>I'm working on an old site that needs to be optimised, I've installed Refactor! and its coming up with lots of recommendations, including lots of instances where objects aren't disposed off.  Is there a way to create a report of these recommendations or another tool that I could use?</p>

<p>Thanks,
Chris.</p>
","<visual-studio><refactoring><add-in>","0","47","2010-05-19 14:25:14"
"2872954","Erlang: simple refactoring","<p>Consider the code:</p>

<pre><code>f(command1, UserId) -&gt;
    case is_registered(UserId) of
        true -&gt;
            %% do command1
            ok;
        false -&gt;
            not_registered
    end;

f(command2, UserId) -&gt;
    case is_registered(UserId) of
        true -&gt;
            %% do command2
            ok;
        false -&gt;
            not_registered
    end.

is_registered(UserId) -&gt;
    %% some checks
</code></pre>

<p>Now imagine that there are a lot of commands and they are all call <strong>is_registered</strong> at first.
Is there any way to generalize this behavior (refactor this code)? I mean that it's not a good idea to place the same <strong>case</strong> in all the commands.</p>
","<refactoring><functional-programming><erlang>","4","200","2010-05-20 10:43:52"
"2875147","Ruby non_empty? method","<p>I want to use expression:</p>

<pre><code>!([1,2,3] &amp; [43,5]).empty?
=&gt; false
!([1,2,3] &amp; [3,5]).empty?
=&gt; true
</code></pre>

<p>to check if two arrays contains at least one common value. And I wonder if there is a better way of doing it? Maybe something like:</p>

<pre><code> ([1,2,3] &amp; [3,5]).non_empty?
</code></pre>

<p>How to write <code>non_empty?</code> method?</p>
","<ruby><refactoring>","1","63","2010-05-20 15:18:17"
"2875861","Retrieving all objects in code upfront for performance reasons","<p>How do you folks retrieve all objects in code upfront? </p>

<p>I figure you can increase performance if you bundle all the model calls together? </p>

<p>This makes for a bigger deal, especially if your DB cannot keep everything in memory </p>

<blockquote>
  <p>def hitDBSeperately {</p>
  
  <p>get X users
  ...code</p>
  
  <p>get Y users... code</p>
  
  <p>get Z users... code</p>
  
  <p>}</p>
</blockquote>

<p>Versus: </p>

<blockquote>
  <p>def hitDBInSingleCall {</p>
  
  <p>get X+Y+Z users</p>
  
  <p>code for X
  code for Y...</p>
  
  <p>}</p>
</blockquote>
","<ruby-on-rails><database><performance><refactoring><object>","1","39","2010-05-20 16:33:57"
"2882483","How to refactor my class so I can unit test it?","<p>I am trying to unit test a class that does SAX parsing and creates an object.
This class takes a string as a parameter representing the URL of a document on the internet, parses it and then creates an object based on the contents.</p>

<p>I don't want to have the unit tests actually access the network, so I'd like to have a few test xml files to parse. However I can't figure out how to access them from my AndroidTestCases. I don't want to include the test files with the actual application, I want them in the test project (it's a separate project, as is the norm for Android tests from what I could gather - due to the need to have a custom AndroidManifest.xml, for one).</p>

<p>One way would be to put the XML files in the test project's assets directory, I can read them using <code>getContext().getAssets().open(filename</code>) into an <code>InputStream</code> in the test case, but my class expects a URL string. I'd rather not have to provide an InputStream to this class instead of the current URL string. I can test just the parsing by making two methods, one that takes a string and one an Inputstream, and test the second, but how can I then test the one that just takes a string?</p>

<p>How should I design my class and or tests to circumvent this problem?</p>
","<android><unit-testing><refactoring><uri>","1","174","2010-05-21 13:34:17"
"2882696","Replicating object function across various model files in Ruby on Rails","<p>I am looking to replicate a given object function across various model files</p>

<p>As you can see below, the 2 things I need to vary across the model are</p>

<p>1)  the ""guser"" string
 2)  the self.xxx</p>

<p>SIMPLIFIED CODE SAMPLE:</p>

<pre><code>  def self.get_all
       statement=""SELECT * FROM gusers WHERE""
       results = results + self.find_by_sql([""#{statement} #{statements[shard_id]}""])
       return results
  end
</code></pre>

<p>It would be great if you can provide code to help out here - thanks! </p>
","<ruby-on-rails><ruby><refactoring><model><modularity>","0","41","2010-05-21 14:00:45"
"2889195","When to delete newly deprecated code?","<p>I spent a month writing an elaborate payment system that handles both credit card payments and electronic fund transfers.  My work was used on production server for about a month.  I was told recently by the client that he no longer wants to use the electronic fund transfer feature.</p>

<p>Because the way I had to interface and communicate with the credit card gateway is drastically different from the electronic fund transfer api (eg. the cc company gives transaction responses immediately after an http request, while the eft company gives transaction responses 5 business days after an http request), I spent a lot of time writing my own API to abstract common function calls like</p>

<p>function pay(amount, pay_method,pay_freq)</p>

<p>function updateRecurringSchedule(user_id,new_schedule)</p>

<p>etc..</p>

<p>Now that the client wants to abandon the EFT feature, all my work for this abstracted payments API is obsolete. </p>

<p>I'm deliberating over whether I should scrap my work.   Here's my pro vs. con for scrapping it now:</p>

<p>PRO 1: Eliminate code bloat</p>

<p>PRO 2: New developers do not need to learn MY API.  They only need to read the CC company's API</p>

<p>PRO 3: Because the EFT company did not handle recurring payment schedules, refunds, and validation, I wrote my own application to do it.  Although the CC company's API permitted this functionality, I opted to use mine instead so that I could streamline my code.  now that EFT is out of the picture, I can delete all this confusing code and just rely on the CC company's system to manage recurring billing, payment schedules, refunds, validations etc...</p>

<p>CON 1: Although I can just delete the EFT code, it still takes time to remove the entire framework that consolidates different payment systems.</p>

<p>CON 2: with regards to PRO 3, it takes time to build functionality that integrates the payment system more closely with the CC company.</p>

<p>CON 3: I feel insecure deleting all this work.  I don't think I'll ever use it again.  But, for some inexplicable reason, I just don't feel comfortable deleting this work ""right now"".</p>

<p>CON 4: There's also the issue of the database.  If I delete my business logic code, then normalize the database (which will end up with a new db schema), it will be difficult to revive this feature because of data migration issues.  Whereas, if I keep the existing code against the existing database, it's more trouble for the developer to maintain, but no fear of losing anything.</p>

<p>So my question is, should I delete one month's worth recent development?  If yes, should I do it immediately or wait X amount of time before doing so?</p>

<p><strong>Additional details</strong>
I added CON 4</p>
","<refactoring>","2","165","2010-05-22 18:12:19"
"2893071","How do I convert a method's local variable or expression to a method parameter using Eclipse?","<p>How do I convert a method's local variable or expression into a method parameter using Eclipse's built-in refactoring tools?</p>
","<java><eclipse><refactoring>","2","157","2010-05-23 19:18:15"
"2890383","Rails- Using a set of functions across the view , controller and model","<p>i have a function that converts an array to a hash which i would like to use across all the model, controller and view files in the rails app.</p>

<p>Does this violate some core design principle, or am i missing something really obvious?</p>

<p>UPDATE: This is actually a software engineering question. I want to understand why some ""convenient"" things are not allowed in rails, and i suspect it is precisely because they do not want us to do it</p>
","<ruby-on-rails><mvc><refactoring><modularity>","0","247","2010-05-23 01:22:26"
"2897165","Organizing Eager Queries in an ObjectContext","<p>I am messing around with Entity Framework 3.5 SP1 and I am trying to find a cleaner way to do the below.  </p>

<p>I have an EF model and I am adding some Eager Loaded entities and i want them all to reside in the ""Eager"" property in the context.   We originally were just changing the entity set name, but it seems a lot cleaner to just use a property, and keep the entity set name in tact.</p>

<p>Example:</p>

<pre><code>Context
 - EntityType
 - AnotherType
 - Eager (all of these would have .Includes to pull in all assoc. tables)
    - EntityType
    - AnotherType
</code></pre>

<p>Currently I am using composition but I feel like there is an easier way to do what I want. </p>

<pre><code>namespace Entities{   
 public partial class TestObjectContext
{

   EagerExtensions Eager { get;set;}
   public TestObjectContext(){
     Eager = new EagerExtensions (this);
   }

}

 public partial class EagerExtensions 
 {
   TestObjectContext context;
   public EagerExtensions(TestObjectContext _context){
       context = _context;
   }
      public IQueryable&lt;TestEntity&gt; TestEntity
        {
            get
            {
                return context.TestEntity
                .Include(""TestEntityType"")
                .Include(""Test.Attached.AttachedType"")
                .AsQueryable();
            }
        }
 }
}



public class Tester{
  public void ShowHowIWantIt(){
     TestObjectContext context=  new TestObjectContext();
     var query = from a in context.Eager.TestEntity select a;

  }

}
</code></pre>
","<c#><design><entity-framework><refactoring>","0","94","2010-05-24 13:07:34"
"2904003","How easy would it be to refactor a small JSP/Servlet/JDBC project to SpringMVC/Hibernate","<p>With reference to <a href=""http://stackoverflow.com/questions/2903185/choose-better-or-more-familiar-technologies-for-a-new-project"">this post</a>, I am considering starting a new web-based Java project. Since I don't know Spring/Hibernate I was concerned if it's a bad plan to start learning them while creating a new project, especially since it will slow down the early development.</p>

<p>One idea I had was to write a prototype using tech I <em>do</em> know, namely JSP/Servlets/JDBC, since I can get this running much quicker with my current knowledge. I <em>could</em> then throw the whole thing away and start over with Spring, etc, but I'd like to consider how easy it would be to refactor a smallish project from JSP/Servlets/JDB to SpringMVC/Hibernate? My DB could of course be re-used but what about other code... would I expect to save most of it plugged into an MVC framework, or is the paradigm shift big enough this would cause more trouble than it avoids?</p>

<hr>

<p><em>Please use the <a href=""http://stackoverflow.com/questions/2903185/choose-better-or-more-familiar-technologies-for-a-new-project"">other</a> question for more general advice on choosing technologies</em></p>
","<java><java-ee><refactoring><prototyping>","1","334","2010-05-25 11:09:49"
"2904011","Tool that shows unit dependencies for Delphi 2010 or Delphi 7 program","<p>We're trying to untangle a hairball of 100's of units, removing some.</p>

<p>It would be helpful if there was tool that would show us what units were explicitly using unit X.</p>

<p>Penganza doesn't seem to have a report that does that. (Although it has lots of other useful reports.)</p>

<p>Can anyone suggest a tool or strategy for doing this, other than just hiding unit x and then hitting F9 ... repeatedly?</p>
","<delphi><refactoring><coding-style>","2","853","2010-05-25 11:10:41"
"2905029","Flexibility starting to develop applications and DB","<p>First of all I want to say some info for admins. This post can help to all DBA and developers. Hope You don't close this. I'm writing about widespread problem</p>

<p>I'm writing master work and I want that You will had little time to answer my questions in my form. These questions are about db structures. Visit here:</p>

<p><a href=""http://spreadsheets.google.com/embeddedform?formkey=dEhmOWFGb2twWVFreWJwWXp2U3c5a1E6MQ"" rel=""nofollow"">http://spreadsheets.google.com/embeddedform?formkey=dEhmOWFGb2twWVFreWJwWXp2U3c5a1E6MQ</a></p>

<p>After I summarized results, I insert it in new post and developers can choose which structure to use to reach needed requirements developing new applications. I think that my test will help a lot of people.</p>

<p>Best regards, Kristaps</p>
","<refactoring><structure><flexibility>","0","15","2010-05-25 13:28:00"
"2908990","How to take advantage of an auto-property when refactoring this .Net 1.1 sample?","<p>I see a lot of legacy .Net 1.1-style code at work like in example below, which I would like to shrink with the help of an auto-property. This will help many classes shrink by 30-40%, which I think would be good. </p>

<pre><code>public int MyIntThingy
{
    get
    {
        return _myIntThingy;
    }

    set
    {
        _myIntThingy = value;
    }
} private int _myIntThingy = -1;
</code></pre>

<p>This would become:</p>

<pre><code>public int MyIntThingy
{
    get;
    set;
}
</code></pre>

<p>And the only question is - where do I set <code>MyIntThingy = -1;</code>?</p>

<p>If I wrote the class from the start, then I would have a better idea, but I did not. An obvious answer would be: put it in the constructor. Trouble is: there are many constructors in this class. Watching the initialization to <code>-1</code> in the debugger, I see it happen (I believe) before the constructor gets called. It is almost as if I need to use a static constructor as described here:
<a href=""http://www.c-sharpcorner.com/uploadfile/cupadhyay/staticconstructors11092005061428am/staticconstructors.aspx"" rel=""nofollow"">http://www.c-sharpcorner.com/uploadfile/cupadhyay/staticconstructors11092005061428am/staticconstructors.aspx</a>
except that my variables are not static. Java's static initializer comes to mind, but again - my variables are not static. <a href=""http://www.glenmccl.com/tip_003.htm"" rel=""nofollow"">http://www.glenmccl.com/tip_003.htm</a></p>

<p>I want to make stylistic but not functional changes to this class. As crappy as it is, it has been tested and working for a few years now. breaking the functionality would be bad. So ... I am looking for shorter, sweeter, cuter, and yet EQUIVALENT code. Let me know if you have questions.</p>
","<refactoring><.net-1.1><auto-properties>","0","58","2010-05-25 22:29:42"
"2909321","How do I correct feature envy in this case?","<p>I have some code that looks like:</p>

<pre><code>class Parent {
 private Intermediate intermediateContainer;
 public Intermediate getIntermediate();
}

class Intermediate {
 private Child child;
 public Child getChild() {...}
 public void intermediateOp();
}

class Child {
 public void something();
 public void somethingElse();
}

class Client {
 private Parent parent;

 public void something() {
  parent.getIntermediate().getChild().something();
 }

 public void somethingElse() {
  parent.getIntermediate().getChild().somethingElse();
 }

 public void intermediate() {
  parent.getIntermediate().intermediateOp();
 }
}
</code></pre>

<p>I understand that is an example of the ""feature envy"" code smell. The question is, what's the best way to fix it? My first instinct is to put the three methods on parent:</p>

<pre><code>parent.something();
parent.somethingElse();
parent.intermediateOp();
</code></pre>

<p>...but I feel like this duplicates code, and clutters the API of the Parent class (which is already rather busy).</p>

<p>Do I want to store the result of getIntermediate(), and/or getChild(), and keep my own references to these objects?</p>
","<java><oop><refactoring><feature-envy>","3","399","2010-05-25 23:52:58"
"2911482","Better name needed for applying a function on elements of a container","<p>I have a container class (containing a multi-index container) for which I have a public ""foreach"" member-function, so users can pass a functor to apply on all elements.<br>
While implementing, I had a case where the functor should only be applied to some elements of a range in the container, so I overloaded the foreach, to pass some valid range.<br>
Now, in some cases, it was worthwhile to stop on a certain condition, so practically, I let the foreach stop based on the return-value of the function.  </p>

<p>I'm pleased with how the system works, but I have one concern:<br>
<strong>How should a ""foreach"" on a range, with stop conditions be called?</strong><br>
Anyone knows a generic, clear and concise name?</p>
","<c++><refactoring><name>","6","89","2010-05-26 09:03:43"
"2913183","XHTML 1.0 Transitive, is there a tool that can refactor HTML?","<p>I have a Asp.net web application running with the following config setting.</p>

<pre><code>&lt;xhtmlConformance mode=""Legacy""/&gt;
</code></pre>

<p>This limits use of AJAX and compatibility with multiple browser. </p>

<p>If my understanding is correct, the HTML code of the aspx pages need to be fixed to comply with XHTML 1.0 Transitional.</p>

<p>There are alot of HTML pages, ~1000, is there a tool that could speed up this process?</p>
","<asp.net><html><xhtml><automated-refactoring>","2","140","2010-05-26 13:07:42"
"2913495","Refactoring if/else logic","<p>I have a java class with a thousand line method of if/else logic like this:</p>

<pre><code>if (userType == ""admin"") {
     if (age &gt; 12) {
          if (location == ""USA"") {
               // do stuff
          } else if (location == ""Mexico"") {
               // do something slightly different than the US case
          }
     } else if (age &lt; 12 &amp;&amp; age &gt; 4) {
          if (location == ""USA"") {
               // do something slightly different than the age &gt; 12 US case
          } else if (location == ""Mexico"") {
               // do something slightly different
          }
     }
 } else if (userType == ""student"") {
     if (age &gt; 12) {
          if (location == ""USA"") {
               // do stuff
          } else if (location == ""Mexico"") {
               // do something slightly different than the US case
          }
     } else if (age &lt; 12 &amp;&amp; age &gt; 4) {
          if (location == ""USA"") {
               // do something slightly different than the age &gt; 12 US case
          } else if (location == ""Mexico"") {
               // do something slightly different
          }
     }
</code></pre>

<p>How should I refactor this into something more managable?</p>
","<java><refactoring><if-statement>","27","2983","2010-05-26 13:44:27"
"2921368","Program structure in long running data processing python script","<p>For my current job I am writing some long-running (think hours to days) scripts that do CPU intensive data-processing.  The program flow is very simple - it proceeds into the main loop, completes the main loop, saves output and terminates:  The basic structure of my programs tends to be like so:</p>

<pre><code>&lt;import statements&gt;
&lt;constant declarations&gt;

&lt;misc function declarations&gt;

def main():
   for blah in blahs():
      &lt;lots of local variables&gt;
      &lt;lots of tightly coupled computation&gt;

      for something in somethings():
          &lt;lots more local variables&gt;
          &lt;lots more computation&gt;

   &lt;etc., etc.&gt;

   &lt;save results&gt;

if __name__ == ""__main__"":
    main()
</code></pre>

<p>This gets unmanageable quickly, so I want to refactor it into something more manageable.  I want to make this more maintainable, without sacrificing execution speed.</p>

<p>Each chuck of code relies on a large number of variables however, so refactoring parts of the computation out to functions would make parameters list grow out of hand very quickly. Should I put this sort of code into a python class, and change the local variables into class variables?  It doesn't make a great deal of sense tp me conceptually to turn the program into a class, as the class would never be reused, and only one instance would ever be created per instance.</p>

<p>What is the best practice structure for this kind of program? I am using python but the question is relatively language-agnostic, assuming a modern object-oriented language features.</p>
","<python><language-agnostic><refactoring><maintainability>","3","216","2010-05-27 13:11:20"
"2929624","Tool for sql refactoring?","<p>Is there a refactoring tool available for SQL (TSQL in particular).  Is there any tool that can do automatic simplification of SQL?  </p>

<p>I have a set of views where only the top two are used, and I'd like to refactor this into only two views, hence 10+ queries into two queries.</p>
","<sql><tools><refactoring>","3","251","2010-05-28 13:59:49"
"2931615","Throws declarations and interface methods","<p>Here's some code from an FTP application I'm working on. The first method comes from an interface which is being triggered by a class which is monitoring server output.</p>

<pre><code>@Override
public void responseReceived(FTPServerResponse event) {
    if (event.getFtpResponseCode() == 227) {
        try {
            setupPassiveConnection(event.getFullResponseString());
        } catch (UnknownHostException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>

<p>It invokes the second <code>setupPassiveConnection()</code> which throws some Exceptions.</p>

<pre><code>public void setupPassiveConnection(String serverReplyString) throws UnknownHostException, IOException {
    String passiveInfo[] = serverReplyString.substring(
            serverReplyString.indexOf(""("") + 1,
            serverReplyString.indexOf("")"")).split("","");

    int port = (Integer.parseInt(passiveInfo[4]) * 256)
            + (Integer.parseInt(passiveInfo[5]));

    String ip = passiveInfo[0] + ""."" + passiveInfo[1] + "".""
            + passiveInfo[2] + ""."" + passiveInfo[3];

    passiveModeSocket = new Socket(ip, port);

    if( passiveModeSocket != null )
        isPassiveMode();
}
</code></pre>

<p>As the Exceptions can't be rethrown through the first method what would be a proper way to rewrite this?</p>
","<java><interface><exception><refactoring>","1","301","2010-05-28 18:38:03"
"2935943","Version control of software refactoring","<p>What is the best way of doing version control of large scale refactoring?</p>

<p>My typical style of programming (actually of writing documents as well) is getting something out as quickly as possible and then refactoring it. Typically, refactoring takes place at the same time as adding other functionality. In addition to standard refactoring of classes and functions, functions may move from one file to another, files get split and merged or just reordered.</p>

<p>For the time being, I am using version control as a lone user, so there is no issue of interaction with other developers at this stage. Still, version control gives me two aspects:</p>

<ol>
<li>Backup and ability to revert to a good version ""in case"".</li>
<li>Looking at the history tells me how the project progressed and the flow of ideas.</li>
</ol>

<p>I am using mercurial on windows using TortoiseHg which enables selections of hunks to commit. The reason I mention this is that I would like advice on the granularity of a commit in refactoring. Should I split refactoring from functionality added always in committing?</p>

<p>I have looked at the answers of <a href=""http://stackoverflow.com/questions/68459/refactoring-and-source-control-how-to"">http://stackoverflow.com/questions/68459/refactoring-and-source-control-how-to</a> but it doesn't answer my question. That question focuses on collaboration with a team. This one concentrates on having a history that is understandable in future (assuming I don't rewrite history as some VCS seem to allow).</p>
","<version-control><refactoring>","2","152","2010-05-29 17:18:17"
"2949519","Refactoring tool","<p>I am using several months ReSharper 4.5 It's very powerfull tool but use a lot of system resources and VS working very slow with it. With which tool I can replace Resharper with the same functionality. Which refactoring tool do you use?</p>
","<.net><refactoring><resharper><recommendation>","2","203","2010-06-01 11:58:54"
"2946598","Is there a PHP refactoring tool to tell what functions are never called?","<p>I have a large codebase which has suffered many changes over the years. I would like to remove the functions that are no longer called or relevant. Is there a tool that will analysis the codebase and determine if a method is ever used? </p>

<p>I'm also using phpunit/xdebug which reports which functions have not been run for the unit tests, however coverage is only at 55% and will require a massive amount of work to bring it up to 100% (I'm working on it!).</p>

<p>Anything that was a command line tool would be extra good as I could hook it into hudson (CI).</p>
","<php><tools><refactoring>","4","153","2010-06-01 00:12:02"
"2958443","How can I find unused methods in a Ruby app?","<p>I have a Ruby app with a lot of classes/modules, and some of them are not used. Is there an easy way of finding out which?</p>

<p>I was thinking to do a profile, and then work with it's output. Any other ideas?</p>
","<ruby><refactoring>","3","300","2010-06-02 14:03:43"
"2956679","Refactoring a long method that simply populates","<p>I am refactoring a method which is over 500 lines (don't ask me why) </p>

<p>The method basically queries a list of maps from the database and for each map in the list does some computation and adds the value of that computation to the map. There are however too many computations and puts being done that the code has reached over 500 lines already! </p>

<p>Here's a sample preview:</p>

<pre><code>public List&lt;Hashmap&gt; getProductData(...) {
   List&lt;Hashmap&gt; products = productsDao.getProductData(...);
   for (Product product: products) {
       product.put(""Volume"",new BigDecimanl(product.get(""Height"")*
              product.get(""Width"")*product.get(""Length""));
   //over 10 more lines like the one above
      if (some condition here) {
         //20 lines worth of product.put(..,..) 
      } else {
         //20 lines worth of product.put(..,..)
      }
      //3 more if-else statements like the one above
      try {
         product.put(..,..)
      } catch (Exception e) {
         product.put("""",..)
      }
      //over 8 more try-catches of the form above
   }
</code></pre>

<p>Any ideas on how to go about refactoring this? </p>
","<java><refactoring>","3","181","2010-06-02 10:12:29"
"2958030","Find completely commented files which are commented by /* */","<p>Similar to this <a href=""http://stackoverflow.com/questions/1207232/find-completely-commented-files"">question</a>. I would like to find all commented files. But in my case <code>/* */</code> is a possibility.</p>

<p>Apparently when you write changes to a database project, dropped objects are only commented out instead of deleting the file. I would like to remove all of these commented out files from the project.</p>

<p>Is is possible to find all files which start with <code>/*</code> and end with <code>*/</code>?</p>
","<visual-studio><refactoring><database-project>","0","74","2010-06-02 13:20:28"
"2958285","C++ refactor common code with one different statement","<p>I have two methods <code>f(vector&lt;int&gt;&amp; x, ....) and g(DBConn&amp; x, ....)</code>
where the (....)  parameters are all identical.</p>

<p>The code inside the two methods are completely identical except for one statement
where we do different actions based on the type of x:</p>

<pre><code>in f(): we do x.push_back(i)
in g(): we do x.DeleteRow(i)
</code></pre>

<p>What is the simplest way to extract the common code into one method and yet
have the two different statements? </p>

<p>I am thinking of having a templated functor that overloads operator () (int a) but that seems overkill.</p>
","<c++><refactoring><common-code>","2","147","2010-06-02 13:47:11"
"2961895","How to refactor this Ruby on Rails code?","<p>I want to fetch posts based on their status, so I have this code inside my <code>PostsController</code> <code>index</code> action. It seems to be cluttering the index action, though, and I'm not sure it belongs here.</p>

<p>How could I make it more concise and where would I move it in my application so it doesn't clutter up my index action (if that is the correct thing to do)?</p>

<pre><code>if params[:status].empty?
  status = 'active'
else
  status = ['active', 'deleted', 'commented'].include?(params[:status]) ? params[:status] : 'active'
end

case status
when 'active'
  #active posts are not marked as deleted and have no comments
  is_deleted = false
  comments_count_sign = ""=""
when 'deleted'
  #deleted posts are marked as deleted and have no comments
  is_deleted = true
  comments_count_sign = ""=""
when 'commented'
  #commented posts are not marked as deleted and do have comments
  is_deleted = false
  comments_count_sign = ""&gt;""
end

@posts = Post.find(:all, :conditions =&gt; [""is_deleted = ? and comments_count_sign #{comments_count_sign} 0"", is_deleted])
</code></pre>
","<ruby-on-rails><refactoring><dry>","0","77","2010-06-02 21:55:25"
"2965036","Is grouping your verification code in one Ruby method a bad idea?","<p>Imagine I have a class like this:</p>

<pre><code>class A
   attr_accessor :a
   attr_accessor :b

   def check
      raise ""a must meet some condition"" if !condition(@a)
      raise ""b must meet some condition"" if !condition(@b)
   end

   def do_some_work
      check()
      # more work here
   end

   def do_some_more_work
      check()
      # other work here
   end
end
</code></pre>

<p>Is it bad practice to have the preconditions for the accessors inside another method, and not the current one?</p>
","<ruby><exception><refactoring>","2","43","2010-06-03 10:26:34"
"2966592","How to refactor this duplicated LINQ code?","<p>I am trying to figure out how to refactor this LINQ code nicely. This code and other similar code repeats within the same file as well as in other files. Sometime the data being manipulated is identical and sometimes the data changes and the logic remains the same.</p>

<p>Here is an example of duplicated logic operating on different fields of different objects.</p>

<pre><code>public IEnumerable&lt;FooDataItem&gt; GetDataItemsByColor(IEnumerable&lt;BarDto&gt; dtos)
{
    double totalNumber = dtos.Where(x =&gt; x.Color != null).Sum(p =&gt; p.Number);
    return from stat in dtos
           where stat.Color != null
           group stat by stat.Color into gr
           orderby gr.Sum(p =&gt; p.Number) descending
           select new FooDataItem
           {
               Color = gr.Key,
               NumberTotal = gr.Sum(p =&gt; p.Number),
               NumberPercentage = gr.Sum(p =&gt; p.Number) / totalNumber
           };
}

public IEnumerable&lt;FooDataItem&gt; GetDataItemsByName(IEnumerable&lt;BarDto&gt; dtos)
{
    double totalData = dtos.Where(x =&gt; x.Name != null).Sum(v =&gt; v.Data);
    return from stat in dtos
           where stat.Name != null
           group stat by stat.Name into gr
           orderby gr.Sum(v =&gt; v.Data) descending
           select new FooDataItem
           {
               Name = gr.Key,
               DataTotal = gr.Sum(v =&gt; v.Data),
               DataPercentage = gr.Sum(v =&gt; v.Data) / totalData
           };
}
</code></pre>

<p>Anyone have a good way of refactoring this?</p>
","<c#><linq><refactoring>","8","268","2010-06-03 13:53:06"
"2967128","Seeking suggestions on redesigning the interface","<p>As a part of maintaining large piece of legacy code, we need to change part of the design mainly to make it more testable (unit testing). One of the issues we need to resolve is the existing interface between components. The interface between two components is a class that contains static methods only. </p>

<p>Simplified example:</p>

<pre><code>class ABInterface {

    static methodA();
    static methodB();
    ...
    static methodZ();
};
</code></pre>

<p>The interface is used by component A so that different methods can use ABInterface::methodA() in order to prepare some input data and then invoke appropriate functions within component B. </p>

<p>Now we are trying to redesign this interface for various reasons:</p>

<ul>
<li><p>Extending our unit test coverage - we need to resolve this dependency between the components and stubs/mocks are to be introduced</p></li>
<li><p>The interface between these components diverged from the original design (ie. a lots of newer functions, used for the inter-component i/f are created outside this interface class). </p></li>
<li>The code is old, changed a lot over the time and needs to be refactored.</li>
</ul>

<p>The change should not be disruptive for the rest of the system. We try to limit leaving many test-required artifacts in the production code. Performance is very important and should be no (or very minimal) degradation after the redesign. Code is OO in C++. </p>

<p>I am looking for some ideas what approach to take. Any suggestions on how to do this efficiently? </p>
","<c++><unit-testing><refactoring><interface><legacy-code>","0","122","2010-06-03 14:58:31"
"2968857","Refactoring - Speed increase","<p>How can I make this function more efficient. It's currently running at 6 - 45 seconds.
I've ran dotTrace profiler on this specific method, and it's total time is anywhere between 6,000ms to 45,000ms. The majority of the time is spent on the ""MoveNext"" and ""GetEnumerator"" calls.</p>

<p>and example of the times are </p>

<pre><code>71.55% CreateTableFromReportDataColumns - 18, 533* ms - 190 calls
 -- 55.71% MoveNext - 14,422ms - 10,775 calls 
</code></pre>

<p>can I do to speed this method up? it gets called a lot, and the seconds add up:</p>

<pre><code>    private static DataTable CreateTableFromReportDataColumns(Report report)
    {
        DataTable table = new DataTable();
        HashSet&lt;String&gt; colsToAdd = new HashSet&lt;String&gt; { ""DataStream"" };
        foreach (ReportData reportData in report.ReportDatas)
        {
            IEnumerable&lt;string&gt; cols = reportData.ReportDataColumns.Where(c =&gt; !String.IsNullOrEmpty(c.Name)).Select(x =&gt; x.Name).Distinct();

            foreach (var s in cols)
            {
                if (!String.IsNullOrEmpty(s))
                    colsToAdd.Add(s);
            }
        }

        foreach (string col in colsToAdd)
        {
            table.Columns.Add(col);
        }

        return table;
    }
</code></pre>

<p>If you need the sql table definitions here they are:</p>

<p><strong>ReportData</strong></p>

<pre><code>ReportID            int
</code></pre>

<p><strong>ReportDataColumn</strong></p>

<pre><code>ReportDataColumnId  int
ReportDataId        int 
Name                varchar(255)    
Value               text    
</code></pre>
","<c#><linq><refactoring><profiling>","4","289","2010-06-03 18:50:09"
"2975040","C++ Refactoring Precompiled Header","<p>Unfortunately on a project here at work, someone had the great idea to put every header every single file from pretty big project into the precompiled header. This means any change to any header in the project has to recompile the entire project, and all cpp files taking way too long. </p>

<p>Is there any decent C++ refactoring tool which could automatically put the needed includes in the appropriate cpp files? I really don't want to do this manually with hundreds of different files. </p>
","<c++><refactoring><precompiled-headers>","1","167","2010-06-04 14:30:52"
"2981024",".NET Framework deprecated interfaces and attributes. What was your biggest refactoring due to lack of support?","<p>Some .net-framework interfaces and attributes become obsolete and deprecated since new framework version appears. I am warned that such code may be removed or become unpredictable in next versions but have you ever faced the situation when you were forced to refactor code because code came uncompilable or start to behave weird? What was you biggest refactoring?</p>

<p>Or maybe Microsoft always continued to support api's once they were published? </p>

<p>Thank you in advance! </p>
","<.net><refactoring><deprecated><obsolete>","1","110","2010-06-05 15:52:33"
"2981750","How do you refactor a large messy codebase?","<p>I have a big mess of code. Admittedly, I wrote it myself - a year ago. It's not well commented but it's not very complicated either, so I can understand it -- just not well enough to know where to start as far as refactoring it.</p>

<p>I violated every rule that I have read about over the past year. There are classes with multiple responsibilities, there are indirect accesses (I forget the term - something like <code>foo.bar.doSomething()</code>), and like I said it is not well commented. On top of that, it's the beginnings of a game, so the graphics is coupled with the data, or the places where I tried to decouple graphics and data, I made the data <code>public</code> in order for the graphics to be able to access the data it needs...</p>

<p><strong>It's a huge mess! Where do I start? How would you start on something like this?</strong></p>

<p>My current approach is to take variables and switch them to private and then refactor the pieces that break, but that doesn't seem to be enough. Please suggest other strategies for wading through this mess and turning it into something clean so that I can continue where I left off!</p>

<hr>

<p><strong>Update two days later:</strong> I have been drawing out UML-like diagrams of my classes, and catching some of the ""Low Hanging Fruit"" along the way. I've even found some bits of code that were the beginnings of new features, but as I'm trying to slim everything down, I've been able to delete those bits and make the project feel cleaner. I'm probably going to refactor as much as possible before rigging my test cases (but only the things that are 100% certain not to impact the functionality, of course!), so that I won't have to refactor test cases as I change functionality. (do you think I'm doing it right or would it, in your opinion, be easier for me to suck it up and write the tests first?)</p>

<p><strong>Please vote for the best answer so that I can mark it fairly! Feel free to add your own answer to the bunch as well, there's still room for you!</strong> I'll give it another day or so and then probably mark the highest-voted answer as accepted.</p>

<p>Thanks to everyone who has responded so far!</p>

<hr>

<p>June 25, 2010: I discovered <a href=""http://www.yapb.net/post/2010/06/24/If-you-dont-understand-it-Refactor-it.aspx"" rel=""nofollow"">a blog post</a> which directly answers this question from someone who seems to have a pretty good grasp of programming: (or maybe not, if you read his article :) )</p>

<blockquote>
  <p>To that end, I do four things when I
  need to refactor code:</p>
  
  <ol>
  <li>Determine what the purpose of the code was</li>
  <li>Draw UML and action diagrams of the classes involved</li>
  <li>Shop around for the right design patterns</li>
  <li>Determine clearer names for the current classes and methods</li>
  </ol>
</blockquote>
","<language-agnostic><oop><refactoring>","25","814","2010-06-05 19:27:22"
"2980031","More pythonic way to iterate","<p>I am using a module that is part of a commercial software API.  The good news is there is a python module - the bad news is that its pretty unpythonic.  </p>

<p>To iterate over rows, the follwoing syntax is used:</p>

<pre><code>cursor = gp.getcursor(table)
row =  cursor.next()
while row:
    #do something with row
    row = cursor.next()
</code></pre>

<p>What is the most pythonic way to deal with this situation?  I have considered creating a first class function/generator and wrapping calls to a for loop in it:</p>

<pre><code>def cursor_iterator(cursor):
    row =  cursor.next()
    while row:
        yield row
        row = cursor.next()

[...]

cursor = gp.getcursor(table)
for row in cursor_iterator(cursor):
    # do something with row
</code></pre>

<p>This is an improvement, but feels a little clumsy.  Is there a more pythonic approach?  Should I create a wrapper class around the <code>table</code> type?</p>
","<python><refactoring><iterator><pythonic>","3","306","2010-06-05 10:48:42"
"2993934","Help me refactor my World Cup Challenge Script","<p>I am setting up a World Cup Challenge between some friends, and decided to practice my Ruby and write a small script to automate the process. </p>

<p><strong>The Problem:</strong> </p>

<ul>
<li>32 World Cup qualifiers split into 4 tiers by their Fifa ranking</li>
<li>8 entries</li>
<li>Each entry is assigned 1 random team per tier</li>
<li>Winner takes all :-)</li>
</ul>

<p>I wrote something that suffices yet is admittedly brute force. But, in my attempt to improve my Ruby, I acknowlege that this code isn't the most elegant solution around - So I turn to you, the experts, to show me the way. </p>

<p>It may be more clear to check out this gist - <a href=""https://gist.github.com/91e1f1c392bed8074531"" rel=""nofollow"">https://gist.github.com/91e1f1c392bed8074531</a></p>

<p><strong>My Current (poor) solution</strong>:</p>

<pre><code>require 'yaml'

@teams = YAML::load(File.open('teams.yaml'))
@players = %w[Player1 Player2 Player3 Player4 Player5 Player6 Player7 Player8]

results = Hash.new
players = @players.sort_by{rand}

players.each_with_index do |p, i|
  results[p] = Array[@teams['teir_one'][i]]
end

second = @players.sort_by{rand}
second.each_with_index do |p, i|
  results[p] &lt;&lt; @teams['teir_two'][i]
end

third = @players.sort_by{rand}
third.each_with_index do |p, i|
  results[p] &lt;&lt; @teams['teir_three'][i]
end

fourth = @players.sort_by{rand}
fourth.each_with_index do |p, i|
  results[p] &lt;&lt; @teams['teir_four'][i]
end

p results
</code></pre>

<p>I am sure there is a better way to iterate through the tiers, and duplicating the @players object ( <code>dup()</code> or <code>clone()</code> maybe?)</p>

<p>So from one Cup Fan to another, help me out.</p>
","<ruby><refactoring><loops><iteration><refactor-my-code>","0","107","2010-06-07 23:43:18"
"2994786","Refactoring. Your way to reduce code complexity of big class with big methods","<p>I have a legacy class that is rahter complex to maintain:</p>

<pre><code>class OldClass {
  method1(arg1, arg2) {
      ... 200 lines of code ... 
  }

  method2(arg1) {
      ... 200 lines of code ... 
  }

  ...

  method20(arg1, arg2, arg3) {
      ... 200 lines of code ... 
  }    
}
</code></pre>

<p>methods are huge, unstructured and repetitive (developer loved copy/paste aprroach). I want to split each method into 3-5 small functions, whith one pulic method and several helpers.  </p>

<p>What will you suggest?  Several ideas come to my mind:</p>

<ul>
<li><p>Add several private helper methods to each method and join them in #region  (straight-forward refactoring)</p></li>
<li><p>Use Command pattern (one command class per OldClass method in a separate file).  </p></li>
<li><p>Create helper static class per method with one public method &amp; several private helper methods. OldClass methods delegate implementation to appropriate static class (very similiar to commands).</p></li>
<li><p>? </p></li>
</ul>

<p>Thank you in advance! </p>
","<c#><refactoring>","5","410","2010-06-08 04:41:30"
"2995151","A better way of representing File Attachment into a list(c#3.0)","<p>I have written</p>

<pre><code>List&lt;Attachment&gt; lstAttachment = new List&lt;Attachment&gt;();

            //Check if any error file is present in which case it needs to be send
            if (new FileInfo(Path.Combine(errorFolder, errorFileName)).Exists)
            {
                Attachment unprocessedFile = new Attachment(Path.Combine(errorFolder, errorFileName));
                lstAttachment.Add(unprocessedFile);
            }
            //Check if any processed file is present in which case it needs to be send
           if (new FileInfo(Path.Combine(outputFolder, outputFileName)).Exists)
            {
                Attachment processedFile = new Attachment(Path.Combine(outputFolder, outputFileName));
                lstAttachment.Add(processedFile);
            }
</code></pre>

<p>Working fine and is giving the expected output.</p>

<p>Basically I am attaching the file to the list based on whether the file is present or not.</p>

<p>I am looking for any other elegant solution than the one I have written.</p>

<p><strong>Reason</strong>: Want to learn differnt ways of representing the same program.</p>

<p>I am using C#3.0</p>

<p>Thanks.</p>
","<c#-3.0><refactoring>","2","102","2010-06-08 06:13:19"
"2990601","Please help me with this Ruby code","<p>I am new to Ruby and I know that I am not using the simple and powerful methods available within it. I made my code work but it has to be simple not this huge (especially I feel I am very bad at loop variables)</p>

<pre><code>i = 0
j = 0

loop_count = ((to_date-from_date)/(60*60*24)).to_i#diff b/w two dates in days

loop_count.times do
   48.times do

    event = Icalendar::Event.new

    status = get_availability_on_date_and_hour(@templates, @availabilities, from_date+j.days, i).downcase

    if(status != 'unavailable')
      #Initialize start and end dates in DateTime's civil format
      bias_date_time = DateTime.civil(from_date.year, from_date.month, from_date.day)

      event.dtstart = bias_date_time + j.day + (i/2).to_i.hour + (i%2*30).to_i.minutes
      event.dtend = event.dtstart + 30.minutes

      event.summary = status.upcase
      cal.add_event(event)
    end

    i += 1
  end
  i = 0
  j += 1
end
</code></pre>
","<ruby><refactoring>","2","114","2010-06-07 15:03:00"
"2998805","C# lambda contents won't happen until it's called, right? Also, code cleanup","<p>I have the following methods:</p>

<pre><code>protected static void updateExistingSection(XmlDocument doc,
    XmlNode rootNode, string sectionTag, CreateSection createSection,
    Func&lt;XmlNode[]&gt; createChildNodes, Action&lt;XmlNode&gt; firstSection)
{
    IEnumerable&lt;XmlNode&gt; sections =
        getChildNodesByName(rootNode, sectionTag);
    if (sections.Count() &lt; 1)
    {
        rootNode.AppendChild(createSection(doc, createChildNodes()));
        return;
    }
    removeSubsequentNodes(sections, rootNode, firstSection);
}

private static void updateExistingCredentialsSection(XmlDocument doc,
    XmlNode rootNode, string newUser, string newPassword, string newHost)
{
    updateExistingSection(doc, rootNode, CREDENTIALS_SECTION_TAG,
        createCredentialsSection,
        () =&gt; new[] {
            createNode(USER_TAG, doc, newUser),
            createNode(PASSWORD_TAG, doc, newPassword),
            createNode(HOST_TAG, doc, newHost)
        },
        credentialsNode =&gt;
        {
            updateExistingLeafNode(USER_TAG, doc, credentialsNode, newUser);
            updateExistingLeafNode(PASSWORD_TAG, doc, credentialsNode,
                newPassword);
            updateExistingLeafNode(HOST_TAG, doc, credentialsNode, newHost);
        });
}
</code></pre>

<p>My question concerns the fifth parameter passed in <code>updateExistingCredentialsSection</code> to <code>updateExistingSection</code>, the <code>() =&gt; new[] { createNode(USER_TAG, doc, newUser), ... }</code> one.  It was my understanding that those <code>createNode</code> calls will not occur unless that lambda expression is called in <code>updateExistingSection</code>, right?  Likewise for the <code>updateExistingLeafNode</code> calls in the last parameter given to <code>updateExistingSection</code>.</p>

<p>Also, from a design perspective, does either method look ridiculous?  Do you see a way I could make either method smaller, or require fewer parameters?  I've been trying to DRY things out, which is what led to writing <code>updateExistingSection</code> in the first place, since I had several methods doing the same functionality.</p>
","<c#><refactoring><lambda><dry>","1","86","2010-06-08 15:31:01"
"3000093","Refactoring tools for namespaces and physical project structure","<p>When I hack around, some code tend to get much bigger than originally planned. As this happens I usually introduce/collapse/merge namespaces, move files between them, move folders etc etc. Sometimes, if I don't have a clear picture of the end result, this is a real pain and really easy to just ""skip"". This leads the project deteriorate where classes belong elsewhere, strange namespaces, no folders/wrong folders etc.
And then I usually cannot take it anymore and do a larger cleanup - which is usually not difficult, just very tedious and it feels nice to do everything at once, so I do a code freeze while finishing up.</p>

<p>So my question is... Are there any tools to help refactoring the namespace/physical aspects of a project?</p>
","<c#><visual-studio><refactoring><namespaces><physical-design>","1","389","2010-06-08 18:19:49"
"3003324","How can I improve this click/toggle function in jquery?","<pre><code>$('.tabs a ').click(function () {
    var a = $(this).attr('href');
    if (a == '#tab-1') {
        $('.btn-buy').hide();
        $('.btn-sell').show();
    } else {
        $('.btn-sell').hide();
        $('.btn-buy').show();
    }
    return false;
});
</code></pre>

<p>... it works, but the code is ugly, too many lines. Can it be reduced any further?</p>

<p>Thanks in advance for your help!</p>
","<jquery><refactoring><click><toggle>","0","75","2010-06-09 05:43:19"
"3007707","How to update old C code?","<p>I have been working on some 10 year old C code at my job this week, and after  implementing a few changes, I went to the boss and asked if he needed anything else done. That's when he dropped the bomb. My next task was to go through the 7000 or so lines and understand more of the code, <em>and</em> to modularize the code somewhat. I asked him how he would like the source code modularized, and he said to start putting the old C code into C++ classes.</p>

<p>Being a good worker, I nodded my head yes, and went back to my desk, where I sit now, wondering how in the world to take this code, and ""modularize"" it. It's already in 20 source files, each with its own purpose and function. In addition, there are three ""main"" structs. each of these structures has 30 plus fields, many of them being other, smaller structs. It's a complete mess to try to understand, but almost every single function in the program is passed a pointer to one of the structs and uses the struct heavily.</p>

<p>Is there any clean way for me to shoehorn this into classes? I am resolved to do it if it can be done, I just have no idea how to begin.</p>
","<c++><c><refactoring><maintaining-code>","32","1160","2010-06-09 16:15:11"
"3013354","How do I refactor code into a subroutine but allow for early exit?","<p>There's a really obvious refactoring opportunity in this (working) code.</p>

<pre><code>bool Translations::compatibleNICodes(const Rule&amp; rule, 
                                     const std::vector&lt;std::string&gt;&amp; nicodes)
{
    bool included = false;

    // Loop through the ni codes.
    for(std::vector&lt;std::string&gt;::const_iterator iter = nicodes.begin();
        iter != nicodes.end();
        ++iter)
    {
        // Match against the ni codes of the rule
        if(rule.get_ni1() == *iter)
        {
            // If there's a match, check if it's flagged include or exclude
            const std::string flag = rule.get_op1();
            // If include, code is included unless a later rule excludes it
            if(flag == ""INCLUDE""){ included = true; }
            // If exclude, code is specifically excluded
            else if(flag == ""EXCLUDE""){ return false; }
        }
        if(rule.get_ni2() == *iter)
        {
            const std::string flag = rule.get_op2();
            if(flag == ""INCLUDE""){ included = true; }
            else if(flag == ""EXCLUDE""){ return false; }
        }
        if(rule.get_ni3() == *iter)
        {
            const std::string flag = rule.get_op3();
            if(flag == ""INCLUDE""){ included = true; }
            else if(flag == ""EXCLUDE""){ return false; }
        }
        if(rule.get_ni4() == *iter)
        {
            const std::string flag = rule.get_op4();
            if(flag == ""INCLUDE""){ included = true; }
            else if(flag == ""EXCLUDE""){ return false; }
        }
        if(rule.get_ni5() == *iter)
        {
            const std::string flag = rule.get_op5();
            if(flag == ""INCLUDE""){ included = true; }
            else if(flag == ""EXCLUDE""){ return false; }
        }
    }
    return included;
}
</code></pre>

<p>I want to turn it to something like:</p>

<pre><code>bool Translations::compatibleNICodes(const Rule&amp; rule, 
                                     const std::vector&lt;std::string&gt;&amp; nicodes)
{
    bool included = false;

    // Loop through the ni codes.
    for(std::vector&lt;std::string&gt;::const_iterator iter = nicodes.begin();
        iter != nicodes.end();
        ++iter)
    {
        // Match against the ni codes of the rule
        included |= matchNICode(rule.get_ni1(), rule.get_op1);
        included |= matchNICode(rule.get_ni2(), rule.get_op2);
        included |= matchNICode(rule.get_ni3(), rule.get_op3);
        included |= matchNICode(rule.get_ni4(), rule.get_op4);
        included |= matchNICode(rule.get_ni5(), rule.get_op5);
    }
    return included;
}

bool Translations::matchNICode(const std::string&amp; ni, 
                               const std::string&amp; op)
{
    if(ni == *iter)
    {
        if(op == ""INCLUDE""){ return true; }
        else if(op == ""EXCLUDE""){ /*Return worse than false*/ }
    }
    return false;
}
</code></pre>

<p>The problem is that I can't get around the problem that I want to exit early if it's an exclude statement.</p>

<p>Note that I can't change the structure of the Rule class.</p>

<p>Any advice?</p>
","<c++><refactoring>","1","234","2010-06-10 09:58:54"
"3017477","How to make a jQuery plugin (the right way)?","<p>I know there are jQuery cookie plugins out there, but I wanted to write one for the sake of better learning the jQuery plugin pattern.</p>

<p>I like the separation of ""work"" in small, manageable functions, but I feel like I'm passing <code>name</code>, <code>value</code>, and <code>options</code> arguments around too much. Is there a way this can be refactored?</p>

<p>I'm looking for snippets of code to help illustrate examples provided with in answers.</p>

<p>Any help is appreciated. Thanks :)</p>

<h2>example usage</h2>

<pre><code>$.cookie('foo', 'bar', {expires:7});
$.cookie('foo'); //=&gt; bar
$.cookie('foo', null);
$.cookie('foo'); //=&gt; undefined
</code></pre>

<h2>Edit:</h2>

<p>I did a little bit of work on this. You can view the revision history to see where this has come from. It still feels like more refactoring can be done to optimize the flow a bit. Any ideas?</p>

<h2>the plugin</h2>

<pre><code>(function($){

  // the utility function
  $.cookie = function(name, value, options) {

    // cookies enabled?
    if (!navigator.cookieEnabled){
      return false;
    }

    // get
    if (typeof value == 'undefined') {
      return get(name);
    }

    // set
    else {
      options = $.extend({}, $.cookie.defaults, options || {});
      return (value != null) ? set(name, value, options) : unset(name, options);  
    }
  };

  // default options
  $.cookie.defaults = {
    expires:  null,
    path:     '/',
    domain:   null,
    secure:   false
  };

  // private functions
  var set = function(name, value, options){
    return document.cookie = options_string(name, value, options);
  };

  var get = function(name){
    var cookies = {};
    $.map(document.cookie.split(';'), function(pair){
      var c = $.trim(pair).split('=');
      cookies[c[0]] = c[1];
    });
    return decodeURIComponent(cookies[name]);
  };

  var unset = function(name, options){
    value = '';
    options.expires = -1;
    set(name, value, options);
  };

  var options_string = function(name, value, options){
    var pairs = [param.name(name, value)];
    $.each(options, function(k,v){
      pairs.push(param[k](v));
    });
    return $.map(pairs, function(p){
      return p === null ? null : p;
    }).join(';');
  };

  // prepare each key=value pair
  var param = {
    name: function(name, value){
      return name + ""="" + encodeURIComponent(value);
    },
    expires: function(value){
      // no expiry
      if(value === null){
        return null;
      }
      // number of days
      else if(typeof value == ""number""){
        d = new Date();
        d.setTime(d.getTime() + (value * 24 * 60 * 60 * 1000));
      }
      // date object
      else if(typeof value == ""object"" &amp;&amp; value instanceof ""Date"") {
        d = value;
      }
      return ""expires="" + d.toUTCString();
    },
    path: function(value){
      return ""path=""+value;
    },
    domain: function(value){
      return value === null ? null : ""domain="" + value;
    },
    secure: function(bool){
      return bool ? ""secure"" : null;
    }
  };

})(jQuery);
</code></pre>
","<jquery><design-patterns><jquery-plugins><refactoring>","2","262","2010-06-10 18:50:48"
"3011141","How to cancel a deeply nested process","<p>I have a class that is a ""manager"" sort of class.  One of it's functions is to signal that the long running process of the class should shut down.  It does this by setting a boolean called ""IsStopping"" in class.  </p>

<pre><code>public class Foo
{
    bool isStoping

    void DoWork() {
        while (!isStopping)
        {
            // do work...
        }
    }
}
</code></pre>

<p>Now, DoWork() was a gigantic function, and I decided to refactor it out and as part of the process broke some of it into other classes.  The problem is, Some of these classes also have long running functions that need to check if isStopping is true.  </p>

<pre><code>public class Foo
{
    bool isStoping

    void DoWork() {
        while (!isStopping)
        {
            MoreWork mw = new MoreWork()
            mw.DoMoreWork() // possibly long running
            // do work...
        }
    }
}
</code></pre>

<p>What are my options here?</p>

<p>I have considered passing isStopping by reference, which I don't really like because it requires there to be an outside object.  I would prefer to make the additional classes as stand alone and dependancy free as possible.</p>

<p>I have also considered making isStopping a property, and then then having it call an event that the inner classes could be subscribed to, but this seems overly complex.  </p>

<p>Another option was to create a ""Process Cancelation Token"" class, similar to what .net 4 Tasks use, then that token be passed to those classes.</p>

<p>How have you handled this situation?  </p>

<p>EDIT:</p>

<p>Also consider that MoreWork might have a EvenMoreWork object that it instantiates and calls a potentially long running method on... and so on.  I guess what i'm looking for is a way to be able to signal an arbitrary number of objects down a call tree to tell them to stop what they're doing and clean up and return.</p>

<p>EDIT2:</p>

<p>Thanks for the responses so far.  Seems like there's no real consensus on methods to use, and everyone has a different opinion.  Seems like this should be a design pattern...</p>
","<c#><oop><refactoring><request-cancelling>","4","249","2010-06-10 01:52:20"
"3020772","Compromising design & code quality to integrate with existing modules","<p>Greetings!</p>

<p>I inherited a C#.NET application I have been extending and improving for a while now. Overall it was obviously a rush-job (or whoever wrote it was seemingly less competent than myself). The app pulls some data from an embedded device &amp; displays and manipulates it. At the core is a communications thread in the main application form which executes a 600+ lines of code method which calls functions all over the place, implementing a state machine - lots of if-state-then-do type code. Interaction with the device is done by setting the state/mode globally and letting the thread do it's thing. (This is just one example of the badness of the code - overall it is not very OO-like, it reminds of the style of embedded C code the device firmware is written in).</p>

<p>My problem is that this piece of code is central to the application. The software, communications protocol or device firmware are not documented at all. Obviously to carry on with my work I have to interact with this code. </p>

<p>What I would like some guidance on, is whether it is worth scrapping this code &amp; trying to piece together something more reasonable from the information I can reverse engineer? I can't decide! The reason I don't want to refactor is because the code already works, and changing it will surely be a long, laborious and unpleasant task. On the flip side, not refactoring means I have to sometimes compromise the design of other modules so that I may call my code from this state machine!</p>

<p>I've heard of ""If it ain't broke don't fix it!"", so I am wondering if it should apply when ""it"" is influencing the design of future code! Any advice would be appreciated!</p>

<p>Thanks!</p>
","<oop><refactoring>","4","59","2010-06-11 06:57:54"
"3024452","More ruby-like solution to this problem?","<p>I am learning ruby and practicing it by solving problems from <a href=""http://projecteuler.net/"" rel=""nofollow"">Project Euler</a>.</p>

<p>This is my solution for problem <a href=""http://projecteuler.net/index.php?section=problems&amp;id=12"" rel=""nofollow"">12</a>.</p>

<pre><code># Project Euler problem: 12
# What is the value of the first triangle number to have over five hundred divisors?

require 'prime'

triangle_number = -&gt;(num){ (num *(num + 1)) / 2 }

factor_count = -&gt;(num) do
  prime_fac = Prime.prime_division(num)
  exponents = prime_fac.collect { |item| item.last + 1 }
  fac_count = exponents.inject(:*)
end

n = 2
loop do
  tn = triangle_number.(n)
  if factor_count.(tn) &gt;= 500
    puts tn
    break
  end
  n += 1
end
</code></pre>

<p>Any improvements that can be made to this piece of code?</p>
","<ruby><refactoring><project-euler>","0","240","2010-06-11 16:23:41"
"3025173","How to correctly refactor a control's namespace in ASP.NET","<p>I have this situation which is rather frustrating... I have some user controls where I would like to rename their namespace.  However, when I do this my build fails because the .designer.cs file for pages that use the controls is still generating control declarations with the OLD namespace.  Is this coming from the assembly?  I can't rebuild because this is obviously creating a compile-time error (those controls no longer exist in the old name).  I've tried wiping out the entire file, but it is always regenerated with the old namespace.</p>

<p>How do I get around this without manually editing every .designer.cs file???</p>
","<asp.net><refactoring>","1","59","2010-06-11 18:14:47"
"3022600","A C# Refactoring Question","<p>I came accross the following code today and I didn't like it.  It's fairly obvious what it's doing but I'll add a little explanation here anyway:</p>

<p>Basically it reads all the settings for an app from the DB and the iterates through all of them looking for the DB Version and the APP Version then sets some variables to the values in the DB (to be used later).</p>

<p>I looked at it and thought it was a bit ugly - I don't like switch statements and I hate things that carry on iterating through a list once they're finished.  So I decided to refactor it.</p>

<p><strong>My question to all of you is how would you refactor it?  Or do you think it even needs refactoring at all?</strong></p>

<p>Here's the code:</p>

<pre><code>        using (var sqlConnection = new SqlConnection(Lfepa.Itrs.Framework.Configuration.ConnectionString))
        {
            sqlConnection.Open();

            var dataTable = new DataTable(""Settings"");

            var selectCommand = new SqlCommand(Lfepa.Itrs.Data.Database.Commands.dbo.SettingsSelAll, sqlConnection);
            var reader = selectCommand.ExecuteReader();
            while (reader.Read())
            {
                switch (reader[SettingKeyColumnName].ToString().ToUpper())
                {
                    case DatabaseVersionKey:
                        DatabaseVersion = new Version(reader[SettingValueColumneName].ToString());
                        break;
                    case ApplicationVersionKey: 
                        ApplicationVersion = new Version(reader[SettingValueColumneName].ToString());
                        break;
                    default:
                        break;
                }
            }

            if (DatabaseVersion == null)
                throw new ApplicationException(""Colud not load Database Version Setting from the database."");
            if (ApplicationVersion == null)
                throw new ApplicationException(""Colud not load Application Version Setting from the database."");
        }
</code></pre>
","<c#><.net><refactoring>","11","416","2010-06-11 12:17:31"
"3026682","How to pass a function to a function?","<p>Suppose I have a class with 2 static functions:</p>

<pre><code>class CommandHandler
{
public:
  static void command_one(Item);
  static void command_two(Item);
};
</code></pre>

<p>I have a <a href=""http://en.wikipedia.org/wiki/Don%27t_repeat_yourself"" rel=""nofollow"">DRY</a> problem where I have 2 functions that have the exact same code for every single line, except for the function that it calls:</p>

<pre><code>void CommandOne_User()
{
  // some code A

  CommandHandler::command_one(item);

  // some code B
}

void CommandTwo_User()
{
  // some code A

  CommandHandler::command_two(item);

  // some code B
}
</code></pre>

<p>I would like to remove duplication, and, ideally, do something like this:</p>

<pre><code>void CommandOne_User()
{
  Function func = CommandHandler::command_one();

  Refactored_CommandUser(func);
}

void CommandTwo_User()
{
 Function func = CommandHandler::command_one();

 Refactored_CommandUser(func);
}

void Refactored_CommandUser(Function func)
{
  // some code A

  func(item);
}
</code></pre>

<p>I have access to Qt, but not Boost. Could someone help suggest a way on how I can refactor something like this?</p>
","<c++><qt><refactoring>","4","312","2010-06-11 22:37:11"
"3027067","Optional Member Objects","<p>Okay, so you have a load of methods sprinkled around your system's main class.  So you do the right thing and refactor by creating a new class and perform move method(s) into a new class.  The new class has a single responsibility and all is right with the world again:</p>

<pre><code>class Feature
{
public:
    Feature(){};

    void doSomething();
    void doSomething1();
    void doSomething2();   
};
</code></pre>

<p>So now your original class has a member variable of type object:</p>

<pre><code>  Feature _feature;
</code></pre>

<p>Which you will call in the main class.  Now if you do this many times, you will have many member-objects in your main class.</p>

<p>Now these features may or not be required based on configuration so in a way it's costly having all these objects that may or not be needed.</p>

<p>Can anyone suggest a way of improving this?</p>

<hr>

<p>EDIT: Based on suggestion to use The Null Object Design Pattern I've come up with this:</p>

<p>An Abstract Class Defining the Interface of the Feature:</p>

<pre><code>class IFeature
{
public:
    virtual void doSomething()=0;
    virtual void doSomething1()=0;
    virtual void doSomething2()=0;

    virtual ~IFeature(){}
};
</code></pre>

<p>I then define two classes which implement the interface, one real implementation and one Null Object:</p>

<pre><code>class RealFeature:public IFeature
{
public:
    RealFeature(){};

    void doSomething(){std::cout&lt;&lt;""RealFeature doSomething()""&lt;&lt;std::endl;}
    void doSomething1(){std::cout&lt;&lt;""RealFeature doSomething()""&lt;&lt;std::endl;}
    void doSomething2(){std::cout&lt;&lt;""RealFeature doSomething()""&lt;&lt;std::endl;}
}; 
</code></pre>

<hr>

<pre><code>class NullFeature:public IFeature
{
public:
    NullFeature(){};

    void doSomething(){std::cout&lt;&lt;""NULL doSomething()""&lt;&lt;std::endl;};
    void doSomething1(){std::cout&lt;&lt;""NULL doSomething1()""&lt;&lt;std::endl;};
    void doSomething2(){std::cout&lt;&lt;""NULL doSomething2()""&lt;&lt;std::endl;};


};
</code></pre>

<p>I then define a Proxy class which will delegate to either the real object or the null object depending on configuration:</p>

<pre><code>class Feature:public IFeature
{
public:
    Feature();
    ~Feature();

    void doSomething();
    void doSomething1();
    void doSomething2();

private:
    std::auto_ptr&lt;IFeature&gt; _feature;
};
</code></pre>

<p>Implementation:</p>

<pre><code>   Feature::Feature()
    {
        std::cout&lt;&lt;""Feature() CTOR""&lt;&lt;std::endl;
        if(configuration::isEnabled() )
        {
            _feature = auto_ptr&lt;IFeature&gt;( new RealFeature() );
        }
        else
        {
            _feature = auto_ptr&lt;IFeature&gt;( new NullFeature() );
        }
    }


    void Feature::doSomething()
    {
        _feature-&gt;doSomething();
    }

    //And so one for each of the implementation methods
</code></pre>

<p>I then use the proxy class in my main class (or wherever it's required):</p>

<pre><code>Feature _feature;

_feature.doSomething();
</code></pre>
","<c++><design-patterns><refactoring>","2","157","2010-06-12 00:57:42"
"3024199","Why are ""Extracted Interfaces"" Internal rather than Public?","<p>Visual Studio includes a refactoring function called ""Extract Interface"" that generates an interface based on a class implementation.</p>

<p>The extracted interfaces are Internal by default.  Problem is, we end up changing nearly all of them to <code>Public</code>. </p>

<p>Does anyone know why it's Internal by default?  Better yet, is there a way to customize this to default to <code>Public</code>? </p>
","<visual-studio><refactoring><conventions>","2","90","2010-06-11 15:46:06"
"3037765","How to clean up my code","<p>Being new to this I really am trying to learn how to keep code as simple as possible, whilst doing the job it's supposed to. </p>

<p>The question I have done is from Project Euler, it says </p>

<blockquote>
  <p>Each new term in the Fibonacci sequence is generated by adding the
  previous two terms. By starting with 1
  and 2, the first 10 terms will be:</p>
  
  <blockquote>
<pre><code>1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...
</code></pre>
  </blockquote>
  
  <p>Find the sum of all the even-valued terms in the sequence
  which do not exceed four million.</p>
</blockquote>

<p>Here is my code below.  I was wondering what the best way of simplifying this would be, for a start removing all of the .get(list.length()-1 )..... stuff would be a good start if possible but I don't really know how to?</p>

<p>Thanks</p>

<pre><code>public long fibb()
{
    ArrayList&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();


    list.add(1);
    list.add(2);

    while((list.get(list.size() - 1) +  (list.get(list.size() - 2)) &lt; 4000000)){  
        list.add((list.get(list.size()-1)) + (list.get(list.size() - 2)));
    }     

    long value = 0;
    for(int i = 0; i &lt; list.size(); i++){
        if(list.get(i) % 2 == 0){
            value += list.get(i);
        }    
    }
    return value;
}
</code></pre>
","<java><refactoring><tidy>","6","559","2010-06-14 13:52:48"
"3038278","Place variable one context up in Eclipse JDT","<p>I've been looking for the Eclipse JDT refactoring tool which allows me to quickly change</p>

<pre><code>if (...) {
  Object x = blablabla;
}
</code></pre>

<p>to</p>

<pre><code>Object x;
if (...) {
  x = blablabla;
}
// insert code using x here
</code></pre>

<p>But I can't find it. Does something like that exist?</p>
","<java><eclipse><refactoring><jdt>","2","54","2010-06-14 15:01:05"
"3039468","Refactoring Tabs","<p>HTML:</p>

<pre><code>&lt;ul&gt;
    &lt;li&gt;&lt;a href=""#tab1""&gt;tab1&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=""#tab2""&gt;tab2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div id=""tab1"" class=""tab-content""&gt;content 1&lt;/div&gt;
&lt;div id=""tab2"" class=""tab-content""&gt;content 2&lt;/div&gt;
</code></pre>

<p>jQuery</p>

<pre><code>$('#mode li:first').addClass('active');
$('#mode li.active').append('&lt;span class=""arrow""&gt;&amp;nbsp;&lt;/span&gt;');
$('#mode li a').click(function () {
    $('#mode li').removeClass('active')
    $('.arrow').remove();
    $(this).parent().addClass('active').append('&lt;span class=""arrow""&gt;&amp;nbsp;&lt;/span&gt;');
    var a = $(this).attr('href');
    $('.tab-content').hide();
    $(a).show();
    return false;
});
</code></pre>

<p>.. works, but looking ugly. Can it be simplified/reduced further?</p>

<p>Many thanks!</p>
","<jquery><refactoring><tabs>","0","102","2010-06-14 17:38:39"
"3033583","Refactor C++ code to use a scripting language?","<p><strong>Background:</strong> </p>

<p>I have been working on a platformer game written in C++ for a few months.  The game is currently written entirely in C++, though I am intrigued by the possibility of using Lua for enemy AI and possibly some other logic.  However, the project was designed without Lua in mind, and I have already written working C++ code for much of the AI.  I am hoping Lua can improve the extensibility of the game, but don't know if it would make sense to convert existing C++ code into Lua.</p>

<p><strong>The question:</strong></p>

<p>When, if ever, is it appropriate to take fully functional C++ code and refactor it into a scripting language like Lua?</p>

<p>The question is intentionally a bit vague, so feel free give answers that are not relevant to the given background.</p>
","<c++><game-development><refactoring><lua>","5","403","2010-06-13 19:30:29"
"3051570","Operating on rows and then on columns of a matrix produces code duplication","<p>I have the following (Python) code to check if there are any rows or columns that contain the same value:</p>

<pre><code>    # Test rows -&gt;  

        # Check each row for a win
        for i in range(self.height):                    # For each row ...

            firstValue = None                           # Initialize first value placeholder

            for j in range(self.width):                 # For each value in the row
                if (j == 0):                                # If it's the first value ...
                    firstValue = b[i][j]                        # Remember it
                else:                                       # Otherwise ...
                    if b[i][j] != firstValue:                   # If this is not the same as the first value ...
                        firstValue = None                           # Reset first value
                        break                                       # Stop checking this row, there's no win here

            if (firstValue != None):                    # If first value has been set
                                                            # First value placeholder now holds the winning player's code
                return firstValue                           # Return it

    # Test columns -&gt;

        # Check each column for a win
        for i in range(self.width):                 # For each column ...

            firstValue = None                           # Initialize first value placeholder

            for j in range(self.height):                # For each value in the column
                if (j == 0):                                # If it's the first value ...
                    firstValue = b[j][i]                        # Remember it
                else:                                       # Otherwise ...
                    if b[j][i] != firstValue:                   # If this is not the same as the first value ...
                        firstValue = None                           # Reset first value
                        break                                       # Stop checking this column, there's no win here

            if (firstValue != None):                    # If first value has been set
                                                            # First value placeholder now holds the winning player's code
                return firstValue                           # Return it
</code></pre>

<p>Clearly, there is a lot of code duplication here. <b>How do I refactor this code?</b></p>

<p>Thanks!</p>
","<python><refactoring><code-duplication>","0","199","2010-06-16 08:06:00"
"3062211","Making legacy straightforward win.forms application code more clear","<p>I have legacy win.forms application written in pretty straightforward approach where forms communicate with DAL on UI events. For example there are textboxes: login/password, button - ""Login"" and a click-handler where business logic is implemented (DAL is asked to get user by id/password, if not null - than show next screen, if null - show ""retry screen""). </p>

<p>I have no ability to rewrite it from scratch (in MVP or View/Document pattern), I just want to separate business logic from handlers: grab existing handlers code that communicate with DAL and group it somewhere out of UI handlers. </p>

<p>Dozens of forms are composed with dozens user controls and it's often not clear who is responsible for business logic. Sometimes it's UI control. But sometimes it's a form, who is listening for custom UI-control event and then implement business logic.</p>

<p>If I separate business logic, who should be responsible to call business logic controllers? Forms, user controls, or forms and user controls simultaneously? </p>

<p>Thank you in advance!</p>
","<winforms><language-agnostic><architecture><refactoring>","2","52","2010-06-17 13:54:00"
"3065244","Ruby on Rails controller-view refactoring","<p>In my app I am using the <em>ym4r-gm</em> plugin, which allows you to play with the Google Maps API... I put the map ""setup"" in the controller:</p>

<pre><code>@map = GMap.new(""div_map"")
@map.control_init(:large_map =&gt; true, :map_type =&gt; true)
@map.center_zoom_init([47.0, 26.0], 7)
...
</code></pre>

<p>And only render @map in the view.</p>

<p>So my first question is whether I am using the right approach of ""diving"" this code?
And the second question is: I have to models, which are rendering the same map (only the resources are different). Where should I put my refactored method that renders the map? In the application controller, maybe?</p>

<p>Thanks in advance,
I hope you will understand me!</p>
","<ruby-on-rails><mvc><refactoring>","0","81","2010-06-17 20:08:54"
"3066163","Rename files in Xcode","<p>is it possible to rename/refactor a class file and have it rename the actual file on disk? if so, how can i do this?</p>
","<iphone><objective-c><xcode><refactoring><renaming>","8","4191","2010-06-17 22:37:40"
"3066583","BDD / TDD with JSpec - Removing code duplication","<p>How do I refactor to remove the code duplication in this spec:</p>

<pre><code>describe 'TestPlugins'
    describe '.MovieScanner(document)'
        before_each
            MoviePage_loggedIn = fixture(""movie_logged_in.html"")                // Get logged-in movie page
            MoviePage_notloggedIn = fixture(""movie_not_logged_in.html"")     // Get non logged-in movie page
            scanner = new MovieScanner()                                                // Get movie scanner
        end

        it 'should scan logged-in movie page for movie data'
            doc = MoviePage_loggedIn            // Get document to scan

            // Unit Tests
            // ------------------------------------------------------------

            // Test movie scanner's functions
            scanner.getMovieTitle(doc).should.eql ""The Jacket""
            scanner.getMovieYear(doc).should.eql ""2005""

            // Test movie scanner's main scan function
            scannedData = scanner.scan(doc)
            scannedData.title.should.eql ""The Jacket""
            scannedData.year.should.eql ""2005""
        end

        it 'should scan non logged-in movie page for movie data'
            doc = MoviePage_notloggedIn     // Get document to scan

            // Unit Tests
            // ------------------------------------------------------------

            // Test movie scanner's functions
            scanner.getMovieTitle(doc).should.eql ""The Jacket""
            scanner.getMovieYear(doc).should.eql ""2005""

            // Test movie scanner's main scan function
            scannedData = scanner.scan(doc)
            scannedData.title.should.eql ""The Jacket""
            scannedData.year.should.eql ""2005""
        end
    end
end
</code></pre>
","<refactoring><tdd><bdd><code-duplication><jspec>","1","156","2010-06-18 00:53:52"
"3071274","Is it better to comment out unneeded code or delete it?","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/123423/do-you-leave-historical-code-commented-out-in-classes-that-you-update"">Do you leave historical code commented out in classes that you update?</a>  </p>
</blockquote>



<p>For web applications under maintenance, assuming you have source control, when you need to remove part of the UI and the associated code, do you delete the code and check in, or do you comment out the old code?</p>

<p>Arguments in favor of deleting: cleaner code, can still see deleted code in source control history, no worrying about refactoring code that <em>might</em> be uncommented some day.</p>

<p>Arguments in favor of commenting: sometimes you need to add the feature back in and the developer adding it back in may not know to check source control history, sometimes the code represents unique functionality that can be a handy reference, seeing it all in one place can help provide clues to deciphering the active code.</p>
","<refactoring><comments><version-control>","0","582","2010-06-18 16:07:35"
"3081748","Tools to detect duplicated code (Java)","<p>I am in a project where previous programmers have been copy-pasting codes all over the place. These codes are actually identical (or very similar) and they could have been refactored into one.</p>

<p>I have spent countless hours refactoring these codes manually but I think there must be a better way. Some are very trivial static methods that could have been moved into an ancestor class (but instead was copy pasted all over by previous junior programmers).</p>

<p>Is there a code analysis tool that can detect this and provide reports/recommendations? I prefer free/open source tool if possible.</p>
","<java><refactoring><code-analysis>","15","1044","2010-06-21 02:04:21"
"3077299","Drying out/refactoring flex/actionscript code","<p>I have something like 10 components that have code that's very similar, except for the target that it's applied to and some other minor differences.</p>

<p>For example, I return xml to <code>component1</code> and <code>component2</code> that differs in this way:</p>

<pre><code>component 1: event.result.names.name
component 2: event.result.phones.phone
</code></pre>

<p>I then bind these to a <code>List</code>, and the name of that list differs by component.</p>

<pre><code>component 1: nameslist.dataProvider = 
component 2: phoneslist.dataProvider = 
</code></pre>

<p>How do I create a single method that would accept as parameters just the names/pointers/references to the objects I need worked on. For examples <code>nameslist</code> or <code>phoneslist</code> as <code>List</code> or <code>.phones.phone</code> vs. <code>.names.name</code> for the structure of the xml returned?</p>
","<flex><actionscript-3><refactoring><adobe><mxml>","0","83","2010-06-19 21:26:49"
"3084120","SQL, How to change column in SQL table without breaking other dependencies?","<p>I'm sure this might be quite common query but couldn't find good answer as for now.</p>

<p>Here is my question:</p>

<p>I've got a table named <b>Contacts</b> with varchar column <b>Title</b>. Now in the middle of development I want to replace field <b>Title</b> with <b>TitleID</b> which is foreign key to <b>ContactTitles</b> table. At the moment table <b>Contacts</b> has over 60 dependencies (other tables, views functions).</p>

<p>How can I do that the safest and easiest way?</p>

<p>We use: MSSQL 2005, data has already been migrated, just want to change schema.</p>

<p><b>Edit:</b></p>

<p>Thanks to All for quick replay.</p>

<p>Like it was mentioned <b>Contacts</b> table has over 60 dependents, but when following query was run, only 5 of them use <b>Title</b> column. Migration script was run, so no data changes required.</p>

<p><code>
/*gets all objects which use specified column */
</code></p>

<p><code>
SELECT Name
FROM syscomments sc
JOIN sysobjects so ON sc.id = so.id
WHERE TEXT LIKE '%Title%' AND TEXT LIKE '%TitleID%'
</code></p>

<p>Then I went through those 5 views and updated them manually.</p>
","<sql><sql-server-2005><refactoring-databases>","4","270","2010-06-21 11:16:20"
"3096800","How can I refactor our the type parameter from this code?","<p>I want to write an extension method that tests if an attribute is applied on a method call, and I'd like to specify the method as a lambda expression. Currently, I have the following (working) approach, but I really don't like the way this code looks:</p>

<pre><code>// Signature of my extension method:
public static bool HasAttribute&lt;TAttribute, TDelegate&gt;(this Expression&lt;TDelegate&gt; method)

// Usage (current code)
Expression&lt;Func&lt;AccountController, LogInModel, string, ActionResult&gt;&gt; mut = (c, m, s) =&gt; c.LogIn(m, s);
mut.HasAttribute&lt;ExportModelStateAttribute, Func&lt;AccountController, LogInModel, string, ActionResult&gt;&gt;().ShouldBeTrue();
</code></pre>

<p>As you can see, I have to specify the delegate type twice, and neither time does it look pretty... I'd like to have something more like</p>

<pre><code>// Usage (if I had my way...)
var mut = (c, m, s) =&gt; c.LogIn(m, s);
mut.HasAttribute&lt;ExportModelStateAttribute&gt;().ShouldBeTrue();
</code></pre>

<p>but I realize that might be asking a tad bit too much.</p>

<p><strong>Is there any way I could refactor away the type arguments from my current code?</strong></p>

<p>The reason I have the <code>TDelegate</code> type argument there in the first place, is that I want to use this regardless of method signature and return type, and depending on the number of input arguments and whether the method in question is a <code>void</code> or a function, <code>TDelegate</code> needs to vary. I don't want to have one different implementation for each number of input arguments to the method I test...</p>

<p><strong>Update:</strong><br>
As Jay points out in a comment, I apparently don't need to specify the <code>TDelegate</code> type argument in the call to <code>HasAttribute&lt;&gt;</code>. The code now looks like this:</p>

<pre><code>Expression&lt;Func&lt;AccountController, LogInModel, string, ActionResult&gt;&gt; mut = (c, m, s) =&gt; c.LogIn(m, s);
mut.HasAttribute&lt;ExportModelStateAttribute&gt;().ShouldBeTrue();
</code></pre>

<p>It's much better, but I still think the first line is pretty messy. Could it be even better?</p>
","<c#><generics><refactoring><delegates><inferred-type>","3","135","2010-06-22 20:17:28"
"3098847","Liquibase, ""Migration Failed: Java heap space"" error when generateChangeLog with ""data""","<p>I am trying to create a baseline on one of my development database using liquibase, here's my environment
- Database, -> Oralce 10g, with 500+ Tables with lots of configuration data, the oracle export dump file is about 70mb;
- Java - Java 6
- Oracle JDBC Driver - ojdbc14.jar (downloaded from Oracle web site)
- Command line execute
liquibase --changeLogFile=base.changelog.data.xml --diffTypes=""data""  generateChangeLog</p>

<p>Execute result:
- Liquibase is configure to run with ""-Xmx512m -Xms256m"" jvm parameters, fail, error message - ""Migration Failed: Java heap space
""
- configure to run with ""-Xmx1024m -Xms512m"", same error occurs
- configure to run with ""-Xmx2048 -Xms512m"", same error</p>

<p>What other options I have in oder to create base line for my development projects, so that we could start version control our db..</p>

<p>Appreciate ur advise, thanks!</p>

<p>James</p>
","<java><database><refactoring><heap><liquibase>","0","264","2010-06-23 03:57:22"
"3098649","Custom Inclusive TakeWhile(), is there a better way?","<p>I've written a custom LINQ extension method that extends the <code>TakeWhile()</code> method to be inclusive, rather than exclusive when the predicate is false.</p>

<pre><code>        public static IEnumerable&lt;T&gt; TakeWhile&lt;T&gt;(this IEnumerable&lt;T&gt; source, Func&lt;T, bool&gt; predicate, bool inclusive)
        {
            source.ThrowIfNull(""source"");
            predicate.ThrowIfNull(""predicate"");

            if (!inclusive)
                return source.TakeWhile(predicate);

            var totalCount = source.Count();
            var count = source.TakeWhile(predicate).Count();

            if (count == totalCount)
                return source;
            else
                return source.Take(count + 1);
        }
</code></pre>

<p>While this works, I'm sure there is a better way of doing it. I'm fairly sure that this doesn't work in terms of deferred execution/loading.</p>

<p><code>ThrowIfNull()</code> is a extension method for <code>ArgumentNullException</code> checking</p>

<p>Can the community provide some some hints or re-writes? :)</p>
","<c#><linq><refactoring>","0","155","2010-06-23 03:00:46"
"3104611","Sanitize pasted text from MS-Word","<p>Here's my wild and whacky psuedo-code. Anyone know how to make this real?</p>

<p>Background:</p>

<p>This dynamic content comes from a ckeditor. And a lot of folks paste Microsoft Word content in it. No worries, if I just call the attribute untouched it loads pretty. But the catch is that I want it to be just 125 characters abbreviated. When I add truncation to it, then all of the Microsoft Word scripts start popping up. Then I added simple_format, and sanitize, and truncate, and even made my controller start spotting out specific variables that MS would make and gsub them out. But there's too many of them, and it seems like an awfully messy way to accomplish this. Thus so! Realizing that by itself, its clean. I thought, why not just slice it. However, the microsoft word text becomes blank but still holds its numbered position in the string. So I came up with this (probably awful) solution below. </p>

<p>It's in three steps.</p>

<ol>
<li>When the text parses, it doesn't display any of the MSWord junk. But that text still holds a number position in a slice statement. So I want to use a regexp to find the first actual character.</li>
<li>Take that character and find out what its numbered position is in the total string.</li>
<li><p>Use a slice statement to cut it from.</p>

<pre><code>def about_us_truncated
  x = self.about_us.find.first(regExp representing first actual character)
  x.charCount = y
  self.about_us[y..125]
end
</code></pre></li>
</ol>

<p>The only other idea i got, is a regex statement that allows it to explicitly slice only actual characters like so :</p>

<p><code>about_us([a-zA-Z][0..125])</code> , but that is definately not how it is written.</p>

<p>Here is some sample text of MS Word junk :</p>

<pre><code> &amp;Lt;! [If Gte Mso 9]&gt;&amp;Lt;Xml&gt;&amp;Lt;Br /&gt; &amp;Lt;O:Office Document Settings&gt;&amp;Lt;Br /&gt; &amp;Lt;O:Allow Png/&gt;&amp;Lt;Br /&gt; &amp;Lt;/O:Off...
</code></pre>
","<ruby-on-rails><ruby><regex><refactoring>","1","382","2010-06-23 18:54:13"
"3110752","How to Refactor a fat interface?","<p>Lets say i have the following set of interfaces....</p>

<pre><code> public interface IStart
        {
            void M1();
            bool IsWorking { get; }
        }

    public interface IStartStop : IStart
        {
            void M2();
                   event EventHandler DoM1;
            event EventHandler DoM2;
        }
    public interface IPreferencesReader : IStartStop, IDisposable
        {
            string CustomColumnDefinition       {get;}
                bool UsePricelevelDetection  {get;}
            void InitializePreferences();
        }
</code></pre>

<p>Now, if i want to implement IPreferencesReader my class would look like below. This is an example of a fat interface, where i 
will have to provide implementation of methods that i may not need in all scenarious.</p>

<pre><code>public class PreferencesReaderBase : IPreferencesReader
    {
        public void M1()
        {
            throw new NotImplementedException();
        }

        public bool IsWorking
        {
            get { throw new NotImplementedException(); }
        }

        public void M2()
        {
            throw new NotImplementedException();
        }

        public event EventHandler DoM1;
        public event EventHandler DoM2;

        public void Dispose()
        {
            throw new NotImplementedException();
        }

        public string CustomColumnDefinition
        {
            get { throw new NotImplementedException(); }
        }

        public bool UsePricelevelDetection
        {
            get { throw new NotImplementedException(); }
        }

        public void InitializePreferences()
        {
            DoSomeInitialization();
        }
    }
</code></pre>

<p>Can i apply any pattern for this scenario so as to refactor it?</p>

<p>EDIT: I can not do without this hierarchy, as in can not remove any of the interfaces.</p>

<p>Thanks for your interest.</p>
","<c#><design-patterns><refactoring><interface>","4","262","2010-06-24 14:14:22"
"3116097","Refactor that code ... Controls.Find method","<p>OK, I have a code (see below):</p>

<pre><code>    void M1()
    {
        for (int i = 1; i &lt; 10; i++)
        {
            Control[] carr = this.Controls.Find(""Number"" +
                                                (i - 1).ToString() +
                                                ""CheckBox"", true);

            if ((carr != null) &amp;&amp; (carr.Length &gt; 0))
            {
                CheckBox enableCB = carr[0] as CheckBox;

                enableCB.Checked = i % 2 == 0 ? true : false; // or any other value
            }
        }
    }
</code></pre>

<p>I don't like iteration with using Controls.Find method. Can I replace it with something easier ?</p>

<p>PS: all the NumberXCheckBox (X>=0 and X&lt;=8) presented on the form.</p>

<p>LINQ enabled, .net 3.5, Visual studio 2008.</p>
","<c#><winforms><refactoring>","1","426","2010-06-25 06:50:44"
"3121150","WPF/MVVM: Refactoring Code-Behind to make it ready for MVVM binding","<p>I have this code in my code-behind file of my View:</p>

<pre><code>private string GetSelectedSchoolclassCode()
    {
        return ((SchoolclassCode)cboSchooclassCodeList.SelectedItem).SchoolclassCodeName;
    }

    private void dgTimeTable_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {        
        var columnNumber = dgTimeTable.CurrentCell.Column.DisplayIndex;
        var timetable = dgTimeTable.CurrentItem as TimeTableViewModel;

        switch (columnNumber)
        {
            case 0: timetable.SchoolclassCodeMonday = GetItemValue(timetable.SchoolclassCodeMonday); break;
            case 1: timetable.SchoolclassCodeTuesday = GetItemValue(timetable.SchoolclassCodeTuesday); break;
            case 2: timetable.SchoolclassCodeWednesday = GetItemValue(timetable.SchoolclassCodeWednesday); break;
            case 3: timetable.SchoolclassCodeThursday = GetItemValue(timetable.SchoolclassCodeThursday); break;
            case 4: timetable.SchoolclassCodeFriday = GetItemValue(timetable.SchoolclassCodeFriday); break;
            case 5: timetable.SchoolclassCodeSaturday = GetItemValue(timetable.SchoolclassCodeSaturday); break;
            case 6: timetable.SchoolclassCodeSunday = GetItemValue(timetable.SchoolclassCodeSunday); break;
        }
    }

    private string GetItemValue(string schoolclassCodeWeekDay)
    {
        if (schoolclassCodeWeekDay == null)
            schoolclassCodeWeekDay = GetSelectedSchoolclassCode();
        else
            schoolclassCodeWeekDay = null;

        return schoolclassCodeWeekDay;
    }
</code></pre>

<p>I would like to put all this code in the ViewModel.
The problem already starts with the CurrentColumn.DisplayIndex in XAML. I can not declare it with binding as the syntax is not allowed. WPF thinks that DisplayIndex is an attached property...</p>

<p>What would you do?</p>
","<wpf><mvvm><refactoring><code-behind>","0","257","2010-06-25 20:15:20"
"3131668","Rails: Facebox link if condition is satisfied","<p>I want to display a facebox link when I click on a  element when a particular condition is satisfied.
I do not want the user to click if the condition is not satisfied. 
I am doing something like this to achieve it which is pretty ugly</p>

<pre><code>&lt;% if x == 5 %&gt;
    &lt;a id=""something"" href=""http://www.some_weird_link.com"" rel=""facebox""&gt;
&lt;% end %&gt;
&lt;div&gt;
    &lt;!-- Loads of HTML and erb code here which should be shown no matter what condition --&gt;
&lt;/div&gt;

&lt;% if x == 5 %&gt;
    &lt;/a&gt;
&lt;% end %&gt;
</code></pre>

<p>Note that I have to put an if condition just so that the <code>&lt;/a&gt;</code> does not come in my HTML when the condition is not satisfied. This looks bad.
Can you suggest me a better way of doing this ?</p>

<p><code>link_to_if</code> is promising but then it wants me to put the link display text in the parameter which happens to be a big <code>&lt;div&gt;</code> in my case.</p>
","<ruby-on-rails><ruby><refactoring><hyperlink><facebox>","1","259","2010-06-28 10:40:17"
"3134681","return statements when doing Extract Method","<p>Let's say you have a very long method, like this:</p>

<pre><code>int monster()
{
    int rc = 0;

    // some statements ...

    if (dragonSlayer.on_vacation()) {
        cout &lt;&lt; ""We are screwed!\n"";
        if (callTheKing() == true)
            return 1;
        else
            return 2;
    } else {
        cout &lt;&lt; ""We are saved!\n"";
        slayTheDragon();
    }

    // rest of long method...

    return rc;
}
</code></pre>

<p>and I'm working on skeletonizing the code. I want to extract the dragon slaying part to</p>

<pre><code>int handleDragon() {
    if (dragonSlayer.on_vacation()) {
        cout &lt;&lt; ""We are screwed!\n"";
        if (callTheKing() == true)
            return 1;
        else
            return 2;
    } else {
        cout &lt;&lt; ""We are saved!\n"";
        slayTheDragon();
    }

    return 0; // ?
}
</code></pre>

<p>and replace the code in monster() with a call to handleDragon(). </p>

<p>But there is a problem. There is a return statement in the middle of that part. If I keep the part where the return code of handleDragon() is handled, it will keep the litter in the big method.</p>

<p>Besides using exceptions, is there an elegant and safe way to refactor this piece of code out of the monster method? How should these types of situations be handled?</p>
","<c++><refactoring>","1","105","2010-06-28 17:31:33"
"3135727","Is there any good code analysis/refactoring tools for T-SQL besides RedGate?","<p>I've used RedGate in the past, but the feature-to-price ratio really sucks. At $369 for one-year it is far too expensive when compated to much richer applications like CodeRush and Resharper.</p>
","<tsql><refactoring>","3","131","2010-06-28 20:02:06"
"3137168","Algorithm to determine proper divisors","<p>I am interested in finding the numbers that exhibit the property of having the sum of their proper divisors equal to the number. The first example is 6, where the proper divisors are 1 + 2 + 3 = 6.</p>

<p>I wrote the following code in R, but I feel it is pretty inefficient and can be improved upon significantly. </p>

<pre><code>propDivisor &lt;- function(
    max
)
{
    n&lt;-{}
    for(j in 2:max){
        m&lt;-{}
        for(i in 1:(j/2+1)){
            if(j%%i==0){m&lt;-c(m,i)}
        }   
        if(sum(m)==j){n&lt;-c(n,j)}
    }
return(cat(""The proper divisors between 1 and"", max, ""are"", n, ""."", sep="" "")    )
}
</code></pre>

<p>Does anyone have any suggestions for improving the following code? I feel one of the apply functions should be used here. Maybe this would be a decent code golf exercise for the future? </p>

<p>And as I know this comes up somewhat frequently here, this is NOT a homework problem, just something a coworker posed as an interesting coding challenger earlier today.</p>

<p>UPDATE:</p>

<p>Thanks to everyone for your comments and thoughts on places to look for further information. Here's another solution that utilizes sapply:</p>

<pre><code>D &lt;- function(n) sum((1:(n-1))[n%%1:(n-1)==0])==n
(2:9000)[sapply(2:9000,D)]
</code></pre>
","<r><refactoring><apply>","1","751","2010-06-29 00:57:52"
"3138823","What is the best way to explain refactoring to non-technical people?","<p>We have a project on at the moment where we are refactoring an application that works fine for the moment but under the hood is beyond help.  We need to rewrite it so that changes and maintenance can be achievable.</p>

<p>The problem is that after the project is done, the application will look and feel cosmetically and functionally the same.  From a non-technical person's perspective, we'll have spent the best part of three months working on something that has no noticeable improvement at the end.</p>

<p>I'm wondering about the best way to justify what we're doing and why we're doing it.</p>

<p>How do I best explain the value of refactoring a project to someone who has no knowledge about programming?</p>
","<project-management><refactoring><non-technical>","98","2772","2010-06-29 07:53:41"
"3140877","Refactoring some code with 'instanceof' to overloaded method solution in Java","<p>I have this piece of code from GWT in Action:</p>

<pre><code>public void processOperator(final AbstractOperator op) {
        System.out.println(""Wordt deze ooit aangeroepen?"");
        if (op instanceof BinaryOperator) {
            if ((data.getLastOperator() == null) || (data.isLastOpEquals())) {
                data.setBuffer(Double.parseDouble(data.getDisplay()));
                data.setInitDisplay(true);
            } else {
                data.getLastOperator().operate(data);
            }
            data.setLastOperator(op);
        } else if (op instanceof UnaryOperator) {
            op.operate(data);
        }

        data.setLastOpEquals(false);
}
</code></pre>

<p>I want to eliminate the 'instanceof' part by using method dispatching:</p>

<pre><code>public void processOperator(final BinaryOperator op) {
    if ((data.getLastOperator() == null) || (data.isLastOpEquals())) {
        data.setBuffer(Double.parseDouble(data.getDisplay()));
        data.setInitDisplay(true);
    } else {
        data.getLastOperator().operate(data);
    }
    data.setLastOperator(op); 
    data.setLastOpEquals(false);
}

public void processOperator(final UnaryOperator op) {
    op.operate(data);
    data.setLastOpEquals(false);
}
</code></pre>

<p>But now I run into trouble in the code below from class ButtonOperator. The following code has AbstractOperator as a type in the constructor. The code for the types UnaryOperator and BinaryOperator would look exactly the same, so it feels a little cumbersome having to make special constructors for them containing the exact same code. What is a better approach? </p>

<pre><code>public ButtonOperator(final CalculatorController controller,
        final AbstractOperator op) {
        super(op.label);

        this.addClickHandler(new ClickHandler() {

            @Override
            public void onClick(ClickEvent event) {
                controller.processOperator(op);
            }

        });
        this.setStyleName(CalculatorConstants.STYLE_BUTTON);
    }
</code></pre>
","<java><refactoring><method-overloading>","2","332","2010-06-29 13:06:58"
"3141432","Any weird purpose of switch / default in this code?","<p>I am porting some code from C to C++ and I found this code:</p>

<pre><code>if(ErrorCode &gt;= SOME_CONSTANT)
{
    Status = RETVAL_OK;

    switch ( ErrorCode )
    {
        default:
            Status = RETVAL_FAILED;
            break;
    }
}
</code></pre>

<p>This code generates a compilation warning:</p>

<pre><code>warning C4065: switch statement contains 'default' but no 'case' labels
</code></pre>

<p>The question: Is there any purpose of the switch statement (that I failed to grasp) or is it simply crufty code?</p>

<p>That is, is there any reason (when compiling for ANSI C or C++) to not write it like this?</p>

<pre><code>if(ErrorCode &gt;= SOME_CONSTANT)
     Status = RETVAL_FAILED;
</code></pre>

<p><strong>EDIT</strong>: To address all the questions that appeared:</p>

<p>The code was not meant to be expanded: It was the final release of a module that was delivered four years ago (it hasn't been touched since then, so I am inclined to believe it's cruft).</p>

<p>There were also no removed case statements as far as I could see (the same code construct was placed in three different places in code (the same <code>switch/default</code> inside an if checking on the error constant). If there were removed case statements, the code should have been refactored anyway when the cases were removed.</p>

<p>Thanks everyone.</p>
","<c++><c><refactoring><switch-statement>","2","351","2010-06-29 14:05:34"
"3144593","How should i refactor this?","<p>so in my application I've got several different customers being ""serviced"".  Each customer has their own implementations of various classes that are all based on interfaces.</p>

<p>With the latest customer being added, I've noticed there will be a lot of duplication of code from another customer but the other customer is in no other way related to them.</p>

<p>I've already got a default implementation for several other customers and roll new ones as i need them.</p>

<p>My question is how do i refactor this and still keep the code clean?  If i were a dev new to this code base i would want each customer to either use the default or their own implementation of these classes...  but that's a lot of duplication.</p>
","<c#><.net><oop><refactoring><interface>","3","245","2010-06-29 20:47:50"
"3142365","Combine directory and file path - C","<p>As part of learning C, I wrote the following code to combine directory name with file name. Eg: <code>combine(""/home/user"", ""filename"")</code>  will result in <code>/home/user/filename</code>. This function is expected work across platforms (atleast on all popular linux distributions and windows 32 and 64bit).</p>

<p>Here is the code.</p>

<pre><code>const char* combine(const char* path1, const char* path2)
{
    if(path1 == NULL &amp;&amp; path2 == NULL) {
        return NULL;
    }

    if(path2 == NULL || strlen(path2) == 0) return path1;
    if(path1 == NULL || strlen(path1) == 0) return path2;

    char* directory_separator = """";
#ifdef WIN32
    directory_separator = ""\\"";
#else 
    directory_separator = ""/"";
#endif

    char p1[strlen(path1)];                    // (1)
    strcpy(p1, path1);                         // (2) 
    char *last_char = &amp;p1[strlen(path1) - 1];  // (3)

    char *combined = malloc(strlen(path1) + 1 + strlen(path2));
    int append_directory_separator = 0;
    if(strcmp(last_char, directory_separator) != 0) {
        append_directory_separator = 1;
    }
    strcpy(combined, path1);
    if(append_directory_separator)
        strcat(combined, directory_separator);
    strcat(combined, path2);
    return combined;
}
</code></pre>

<p>I have the following questions regarding the above code.</p>

<ol>
<li>Consider the lines numbered 1,2,3. All those 3 lines are for getting the last element from the string. It looks like I am writing more code for such a small thing. What is the correct method to get the last element from the <code>char*</code> string.</li>
<li>To return the result, I am allocating a new string using <code>malloc</code>. I am not sure this is the right way to do this. Is caller expected to free the result? How can I indicate the caller that he has to free the result? Is there a less error prone method available?</li>
<li>How do you rate the code (Poor, Average, Good)? What are the areas that can be imrpoved?</li>
</ol>

<p>Any help would be great.</p>

<p>Edit</p>

<p>Fixed all the issues discussed and implemented the changes suggested. Here is the updated code.</p>

<pre><code>void combine(char* destination, const char* path1, const char* path2)
{
    if(path1 == NULL &amp;&amp; path2 == NULL) {
        strcpy(destination, """");;
    }
    else if(path2 == NULL || strlen(path2) == 0) {
        strcpy(destination, path1);
    }
    else if(path1 == NULL || strlen(path1) == 0) {
        strcpy(destination, path2);
    } 
    else {
        char directory_separator[] = ""/"";
#ifdef WIN32
        directory_separator[0] = '\\';
#endif
        const char *last_char = path1;
        while(*last_char != '\0')
            last_char++;        
        int append_directory_separator = 0;
        if(strcmp(last_char, directory_separator) != 0) {
            append_directory_separator = 1;
        }
        strcpy(destination, path1);
        if(append_directory_separator)
            strcat(destination, directory_separator);
        strcat(destination, path2);
    }
}
</code></pre>

<p>In the new version, caller has to allocate enough buffer and send to <code>combine</code> method. This avoids the use of <code>malloc</code> and <code>free</code> issue. Here is the usage</p>

<pre><code>int main(int argc, char **argv)
{
    const char *d = ""/usr/bin"";
    const char* f = ""filename.txt"";
    char result[strlen(d) + strlen(f) + 2];
    combine(result, d, f);
    printf(""%s\n"", result);
    return 0;
}
</code></pre>

<p>Any suggestions for more improvements?</p>
","<c><string><refactoring>","5","355","2010-06-29 15:47:23"
"3148293","How to integrate zend framework in an existing website","<p>I'm currently learning Zend Framework and now I am looking for a way to integrate it into an existing website. This website is coded in an extremely complex spaghetti way, and I am hoping that it will be easier to read by integrating it into Zend and slowly refactor it. How could i run legacy code and the zend framework + mod_rewrites side by side?</p>

<p>Greetings,</p>

<p>Bas</p>
","<zend-framework><refactoring>","0","136","2010-06-30 10:23:26"
"3149048","Simplest, fastest way to break out all dependencies from a class","<p>When working with legacy code, and trying to create tests, I often break out dependencies from classes or methods so I can write unit tests using mocks for these dependencies. Dependencies most often come in the form of calls to static classes and objects created using the new keyword in the constructor or other locations in that class.</p>

<p>In most cases, static calls are handled either by wrapping the static dependency, or if its a singleton pattern (or similar) in the form of StaticClass.Current.MethodCall() passing that dependency by its interface go the constructor instead.</p>

<p>In most cases, uses of the new keyword in the constructor is simply replaced by passing that interface in the constructor instead.</p>

<p>In most cases, uses of the new keyword in other parts of the class, is handled either by the same method as above, or by if needed create a factory, and pass the factory's interface in the constructor.</p>

<p>I always use Resharpers refactoring tools to help me all of these break-outs, however most things are still manual labour (which could be automated), and for some legacy classes and methods that can be a very very tedious process. Is there any other refactoring plugins and/or tools which would help me in this process? Is there a ""break out all depencencies from this class in a single click"" refactoring tool? =)</p>

<p>It sounds to me like all these steps are common for many developers and a common problem, and before I attempt writing plugin to Resharper or CodeRush, I have to ask, because someone has probably already attempted this..</p>

<p><strong>ADDED:</strong></p>

<p>In reflection to answers below: even if you might not want to break out everything at once (one click total break out might cause more problems than it helps) still being able to simply break out 1 methods dependencies, or 1-2 dependencies easily, would be of big difference.</p>

<p>Also, refactoring code has a measure of ""try and see what happens just to learn how everything fits together"", and a one click total break out would help that process tons, even if you dont check that code in..</p>
","<c#><dependencies><refactoring>","9","298","2010-06-30 12:04:39"
"3143049","When to refactor to a design-pattern?","<p>When coding and reviewing code, it's easy to spot places where a design pattern could be used. A chain of command here, a strategy there... It's tempting to dive in and apply patterns even though a better solution might be a switch or some simple if's.</p>

<p>Are there some rules or tips you've found valuable to estimate when to do the actual refactoring?</p>

<p>Wait until it becomes too difficult to add features? Wait until the third time you have to change the code? First time you need a hack?</p>
","<design-patterns><refactoring>","3","90","2010-06-29 17:10:43"
"3143844","Python code refactoring question. Simplification","<p>I have code that looks something like this:</p>

<pre><code>self.ui.foo = False
self.ui.bar = False
self.ui.item = False
self.ui.item2 = False 
self.ui.item3 = False
</code></pre>

<p>And I would like to turn it into something like this:</p>

<pre><code>items = [foo,bar,item,item2,item3]
for elm in items:
    self.ui.elm = False
</code></pre>

<p>But obviously just having the variables in the list with out the 'self.ui' part is invalid, and I would rather not type out 'self.ui' for every element in the list, because that really isn't to much better.  How could I rewrite my first code to make it something like what I'm talking about?</p>
","<python><refactoring><list>","3","145","2010-06-29 19:00:34"
"3150856","Python code refactoring question. Applying functions to multiple elements","<p>I have code that looks something like this:</p>

<pre><code>self.ui.foo.setEnabled(False)
self.ui.bar.setEnabled(False)
self.ui.item.setEnabled(False)
self.ui.item2.setEnabled(False)
self.ui.item3.setEnabled(False)
</code></pre>

<p>And I would like to turn it into something like this:</p>

<pre><code>items = [foo,bar,item,item2,item3]
for elm in items:
    self.ui.elm.setEnabled(False)
</code></pre>

<p>But obviously just having the variables in the list with out the 'self.ui' part is invalid, and I would rather not type out 'self.ui' for every element in the list, because that really isn't to much better.  How could I rewrite my first code to make it something like what I'm talking about?</p>
","<python><refactoring><list>","1","61","2010-06-30 15:37:26"
"3152820","python refactoring (similar methods in class)","<h2>Python refactoring</h2>

<p>Both the <em>add</em> and <em>sub</em> are very similar.  How does one re-factor code like this?  The logic is basically inverse of each other.</p>

<pre><code>class point(object):

      def __init__( self, x, y ):
          self.x, self.y = x, y

      def add( self, p ):
          x = self.x + p.x
          y = self.y + p.y
          return point( x, y )

      def sub( self, p ):
          x = self.x - p.x
          y = self.y - p.y
          return point( x, y )
</code></pre>
","<python><refactoring>","1","147","2010-06-30 19:42:18"
"3156183","Can I exclude a file from being searched when doing refactoring with ReSharper?","<p>Is there any way, when doing e.g. a rename class refactoring with ReSharper, I can exclude certain files or projects in the solution from being searched?</p>

<p>I have one project in my solution that ReSharper takes forever to search through whenever I run a rename class, and I know that in 99% of the time, the refactoring does not affect this project.</p>
","<visual-studio><refactoring><resharper>","1","159","2010-07-01 08:37:53"
"3154135","How can this code be cleaned up to remove duplication?","<p>i have the following code which has some duplication</p>

<pre><code>    private List&lt;SelectListItem&gt; GetDeskList(int deskId)
    {
        List&lt;Desk&gt; apps = Model.GetDesks();

        List&lt;SelectListItem&gt; dropdown = apps.ConvertAll(c =&gt; new SelectListItem
        {
            Selected = c.Id == deskId,
            Text = c.Name,
            Value = c.Id.ToString()
        }).ToList();
        dropdown.Insert(0, new SelectListItem());
        return dropdown;
    }

    private List&lt;SelectListItem&gt; GetRegionList(int regionId)
    {
        List&lt;Region&gt; apps = Model.GetRegions();

        List&lt;SelectListItem&gt; dropdown = apps.ConvertAll(c =&gt; new SelectListItem
        {
            Selected = c.Id == regionId,
            Text = c.Name,
            Value = c.Id.ToString()
        }).ToList();
        dropdown.Insert(0, new SelectListItem());
        return dropdown;
    }
</code></pre>

<p>and a few more like it with a similar pattern.  what is the best way to refactor this to avoid duplication</p>
","<c#><refactoring><code-duplication>","2","165","2010-06-30 23:23:16"
"3157778","Drowning in a Sea of Nulls","<p>An application I inherited tracks lab test results performed on material samples. Data is stored in a single table (tblSampleData) with a primary key of SampleID and 235 columns representing potential test results. The problem is that only a few tests are performed per sample, so each row contains over 200 nulls. Actually, there is a second similar table (tblSampleData2) with another 215 primarily null columns and a primary key of SampleID. The two tables have a one-to-one relationship and most SampleIDs have some data in both tables. <strong><em>For every SampleID, however, there are easily 400 null columns!</em></strong></p>

<p>Is this bad database design? If so, which normal form rule is broken? How can I query this table to identify which groups of columns are typically filled together with data? My goal would be to have, say 45 tables with 10 columns and fewer null values. How can I do this? How do I avoid breaking existing applications?</p>

<p>The tables have about 200,000 sample records so far. Users are asking me to add more columns for more tests, but I'd rather build a new table. Is this wise?</p>
","<query><database-design><refactoring><null><normalization>","8","274","2010-07-01 12:33:24"
"3159586","A design for sending objects to be added to the appropriate data structure","<p>I have a class called <code>DataStructures</code> where I have a set of <code>public static</code> data structures that store objects. To add an object to a data structures is an involved process requiring a number of checks to be carried out, processes to be remembered and data to be rearranged. In another class called <code>Foo</code>, I need to add objects to the data structures.
I was thinking I can do this by making a method called <code>ObjectFeed</code> which would take an object and the object's label as parameters. The label would tell the method which of the data structures the object should be added to. I would also have a method called <code>addObject</code> which would take the object to append and the appropriate target data structure as parameters:</p>

<pre><code>Public Class DataStructures
{
    public static List&lt;obj&gt; object1Storage = new List&lt;obj&gt;();
    public static List&lt;obj&gt; object2Storage = new List&lt;obj&gt;();
    ...
}

Public Class Foo
{
    public void ObjectFeed(/* PARAMETERS */)
    {
      //Code that generates an object called inspectionObject
      //inspection object has an associated enum Type
        if(objectType == Type.Type1)
        {
             addObject(inspectionObject, DataStructures.object1Storage);
        }
        if(objectType == Type.Type2)
        {
             addObject(inspectionObject, DataStructures.object2Storage);
        }
        ...
    }

    private void addObject(obj inspectionObject, List&lt;obj&gt; objStorage)
    {
        objStorage.Add(inspectionObject);
        //And a lot more code
    }
}
</code></pre>

<p>Passing a public data structure as a parameter to a method that can just as well access that data structure directly doesn't feel correct. Is there a more clever and less intuitive way of doing this?</p>

<p><strong>Edit:</strong></p>

<p>In the example I originally contrived, the ObjectFeed method served no apparent purpose. I rewrote the method to look more like a method from the real world.</p>
","<c#><design-patterns><refactoring>","1","55","2010-07-01 16:05:57"
"3159313","easiest way to map ids during database refactoring","<p>i have a number of tables with a column called <strong>OrderId</strong>.  I have just done a refactoring and i want to get rid of the <strong>Order</strong> table and i have a new table called <strong>Transaction</strong>.  I want all tables that have an <strong>OrderId</strong> column to now have a <strong>TransactionId</strong> column</p>

<p>This is complete.   I now need to populate the <strong>transactionId</strong> column.  I have a mapping today between <strong>orderId</strong> and <strong>transactionId</strong>  so i wanted to see the quickest way i can go populate that new <strong>transactionId</strong>  column  (should i do this through code, through a SQL query, etc ??)</p>

<p>So i have the transationId column in the Order Table so i can do a join.</p>

<p>I want a query that says something like this (pseudo SQL)</p>

<pre><code>update childTable CT
set transactionId = MapFromOrderId(CT.OrderId)
</code></pre>

<p>any suggestions? </p>
","<sql><sql-server><database><query><refactoring>","2","39","2010-07-01 15:36:08"
"3161558","How to better rewrite this repeat function","<p>I have the following function that takes a string as parameter and repeats it a number of times (also a parameter).  I feel like this is something that's already in the framework or at least could be done better.  Any suggestions?</p>

<pre><code>private string chr(string s, int repeat)
{
    string result = string.Empty;
    for (int i = 0; i &lt; repeat; i++)
    {
        result += s;
    }
    return result;
}
</code></pre>
","<c#-3.0><refactoring>","5","182","2010-07-01 20:50:19"
"3171610","Java - Refactor two nearly identical methods","<p>I have two methods, one which counts the number of objects which are considered to have a lower value than a given object, and another which counts the number of objects which have a higher value than a given object. As you can probably tell, the two methods are practically identical:</p>

<pre><code>public int countHigher(SomeObject a){
    if (a == null){
           throw etc...
    }
    int numberHigher = 0;
    for (SomeObeject b : this.listOfSomeObjects) {
        if (b.compareTo(a) == 1) {
            numberHigher++;
        }
    }
    return numberHigher;
}

public int countLower(SomeObject a){
    if (a == null){
           throw etc...
    }
    int numberLower = 0;
    for (SomeObeject b : this.listOfSomeObjects){
        if (b.compareTo(a) == -1){
            numberLower++;
        }
    }
    return numberLower;
}
</code></pre>

<p>I've refactored the methods to call a private method:</p>

<pre><code>private int coun(SomeObject a, int comparison){
    if (a == null){
           throw etc...
    }
    int number = 0;
    for (SomeObeject b : this.listOfSomeObjects){
        if (b.compareTo(a) == comparison){
            number++;
        }
    }
    return number;
}
</code></pre>

<p>But I do not find this solution satisfying. It would be possible to call the private method with an invalid integer (i.e. 10), and the additional error checking for this case is fairly  ugly:</p>

<pre><code>if (comparison &lt; -1 || comparison &gt; 1)
{
    throw blah
}
</code></pre>

<p>Using a boolean is also unsatisfactory, since in the future it is reasonably possible that I may want to count the number of objects of equal value. </p>

<p>Do you have an alternative refactoring solution?</p>

<p>Cheers,</p>

<p>Pete</p>
","<java><refactoring>","4","257","2010-07-03 13:19:57"
"3172451","Error handling for xml parsing","<p>I'm using tinyxml to parse xml files, and I've found that error handling here lends itself to arrow code. Our error handling is simply reporting a message to a file.</p>

<p>Here is an example:</p>

<pre><code>  const TiXmlElement *objectType = dataRoot-&gt;FirstChildElement( ""game_object"" );
  if ( objectType ) {
    do {
      const char *path = objectType-&gt;Attribute( ""path"" );
      if ( path ) {
        const TiXmlElement *instance = objectType-&gt;FirstChildElement( ""instance"" ); 
        if ( instance ) {
          do {
            int x, y = 0; 
            instance-&gt;QueryIntAttribute( ""x"", &amp;x );
            instance-&gt;QueryIntAttribute( ""y"", &amp;y );
            if ( x &gt;= 0 &amp;&amp; y &gt;= 0 ) {
              AddGameObject( new GameObject( path, x, y ));
            } else {
              LogErr( ""Tile location negative for GameObject in state file."" );
              return false;
            }
          } while ( instance = instance-&gt;NextSiblingElement( ""instance"" ));
        } else {
          LogErr( ""No instances specified for GameObject in state file."" );
          return false;
        }
      } else {
        LogErr( ""No path specified for GameObject in state file."" );
        return false;
      }
    } while ( objectType = objectType-&gt;NextSiblingElement( ""game_object"" ));
  } else {
    LogErr( ""No game_object specified in &lt;game_objects&gt;. Thus, not necessary."" );
    return false;
  }
  return true;
</code></pre>

<p>I'm not huffing and puffing over it, but if anyone can think of a cleaner way to accomplish this it would be appreciated. </p>

<p>P.S. Exceptions not an option.</p>

<p>Edit:</p>

<p>Would something like this be preferable?</p>

<pre><code>if ( !path ) {
  // Handle error, return false
}
// Continue
</code></pre>

<p>This eliminates the arrow code, but the arrow code kind of puts all of the error logging on one place.</p>
","<c++><refactoring><error-handling><xml-parsing>","1","120","2010-07-03 18:34:09"
"3173355","Python: Passing functions with arguments to a built-in function?","<p>like this <a href=""http://stackoverflow.com/questions/3136915/python-passing-all-arguments-of-a-function-to-another-function"">question</a> I want to pass a function with arguments. But I want to pass it to built-in functions.</p>

<p>Example:</p>

<pre><code>files = [ 'hey.txt', 'hello.txt', 'goodbye.jpg', 'howdy.gif' ]

def filterex(path, ex):
  pat = r'.+\.(' + ex + ')$'
  match = re.search(pat, path)         
  return match and match.group(1) == ex) 
</code></pre>

<p>I could use that code with a for loop and an if statement but it's shorter and maybe more readable to use filter(func, seq). But if I understand correctly the function you use with filter only takes one argument which is the item from the sequence.</p>

<p>So I was wondering if it's possible to pass more arguments?</p>
","<python><refactoring>","1","110","2010-07-04 00:51:51"
"3192282","How do I cancel an ajax call made using sajax?","<p>a long while back when I built my first web application I used sajax by modernmethod to add ajax features to it. NOw its been a while and I have to clean it up a bit - I haven't set any real checks and my code of the time is terrible inefficient and to top things off it seems that sajax is dead? </p>

<p>How do you cancel a specific ajax request made using sajax? please help!</p>
","<javascript><ajax><refactoring><sajax>","1","65","2010-07-07 06:05:10"
"3195455","How to set JQuery .show / .hide without repeating Div selectors","<p>I want to pass this function a True or a False and have the elements listed show (true) or hide (false) on this input.</p>

<p>I am currently using this function...</p>

<pre><code>        function SetElementVisibility(visible) {
        if (visible) {
            $(""#Div1"").show(""slow"");
            $(""#Div2"").show(""slow"");
            $(""#Div3"").show(""slow"");
        }
        else {
            $(""#Div1"").hide(""slow"");
            $(""#Div2"").hide(""slow"");
            $(""#Div3"").hide(""slow"");
        }
    }
</code></pre>

<p>But i would prefer to not repeat myself by naming the Div's for each outcome.</p>

<p>How can i refactor this into a more DRY (Don't Repeat Yourself) example?</p>

<p>Thanks,
Kohan</p>
","<javascript><jquery><refactoring><dry>","1","350","2010-07-07 13:57:40"
"3195984","Shorten JavaScript","<p>I got some help a few weeks ago on some code for a drop down menu but I am wondering if it is possible to make the code shorter because the current code shown below is quite big, any help would be great.</p>

<pre><code>    $(document).ready(function(){
$(""#zone-bar li em"").mouseenter(function() {
   var hidden = $(this).parents(""li"").children(""ul"").is("":hidden"");

   $(""#zone-bar&gt;ul&gt;li&gt;ul"").hide()        
   $(""#zone-bar&gt;ul&gt;li&gt;a"").removeClass();

   if (hidden) {
       $(this).parents(""li"").children(""ul"").toggle()
              .parents(""li"").children(""a"").addClass(""zoneCur"");
   } 
});

$(""#zone-bar&gt;ul&gt;li&gt;ul"").mouseleave(function() {
   var hidden = $(this).parents(""li"").children(""ul"").is("":hidden"");

   $(""#zone-bar&gt;ul&gt;li&gt;ul"").hide()        
   $(""#zone-bar&gt;ul&gt;li&gt;a"").removeClass();

   if (visable) {
       $(this).parents(""li"").children(""ul"").toggle()
              .parents(""li"").children(""a"").addClass(""zoneCur"");
   } 
});
        });
</code></pre>
","<javascript><jquery><refactoring>","1","188","2010-07-07 14:57:52"
"3197308","Refactoring inheritance to composition using Vbex2005","<p>I have a class that I wrote fairly early on in my vb.net programming experience which inherited from another class it really should have composed.  The base class is a relatively generic nested dictionary-based collection; let's call the descendant class a ""Car"".</p>

<p>Right now there's a lot of code that does things like 'MyCar!Color.st = ""Red""' (I use the generic collection rather than real properties to facilitate data interchange with code written in VB6, and also to facilitate comparisons of cars; given three cars X, Y, Z, I can e.g. detect any changes between X and Y and apply those changes to Z).</p>

<p>Is there any nice way to refactor the code to use composition rather than inheritance?  Which properties/methods should the ""Car"" object wrap, and which ones should be accessed through a data-object property?  Should a widening conversion be defined between a car and the collection object?  Are there any gotchas when doing such refactoring?</p>
","<vb.net><inheritance><refactoring><composition>","0","135","2010-07-07 17:31:18"
"3212825","Conversion VB -> C #. Regular expression to modify (""abc"") in [""abc""]","<p>We are currently converting our old base VB.Net to C #. Converting the bulk of the code is not a problem .. there are good converters around. The problem we are facing is that none of the tested converters can convert () in [] in arrays and collections.</p>

<p>Example: Session (""abcd"") to Session [""abcd""];. Converters think Session is a method/function and leave with the parenthesis.</p>

<p>My question is: is there any regular expression that can be used in find/replace in Visual Studio 2008 that can make this substitution? Why do it manually to get tired when you have to do it over 200 times per class.</p>

<p>Thank you for attention</p>
","<regex><visual-studio-2008><refactoring>","1","108","2010-07-09 13:06:27"
"3214049","Is it acceptable having parameter in class constructor?","<p>Guys for <a href=""http://github.com/thesp0nge/wc"" rel=""nofollow"">wc</a>, a rubygem I'm writing and that is useful for counting word occurrences in a text, I choose to put 3 parameters in class constructor.</p>

<p>The code is working, but I want to refactor it for niceness.
In your experience, it's easier to read/mantain/use as API a class with a constructor with no params and a lot of setters/getters method or a code like this one, with all the params in the constructor?</p>

<p>TIA</p>

<p>Paolo</p>

<pre><code>def initialize(filename, words, hide_list)

  if ! filename.nil?
    @filename = filename
    @occurrences = read
  else
    @filename = STDIN
    @occurrences = feed
  end

  @hide_list = hide_list
  @sorted = Array(occurrences).sort { |one, two| -(one[1] &lt;=&gt; two[1]) }
  @words = words

end
</code></pre>
","<ruby><constructor><refactoring><beautification>","4","239","2010-07-09 15:23:37"
"3214276","What is the best way to DRY up these classes, duplication in everything but constructor","<p>So I did some refactoring and two of my classes now look exactly the same except for their constructors.</p>

<p>The classes wrap an API object that isn't very pretty, and add some functionality that belong at the edge of the API.</p>

<pre><code>class A extends API {
  public A {
    this.APIOption = Option1;
    this.AnotherAPIOption = Option2;
    // a few more
  }

  public ArrayList&lt;String&gt; somethingTheAPIDoesntDo() {
    // Do something the API doesn't provide but I use alot
  }
  // Other shared methods
}

class B extends API {
  public B {
    this.APIOption = Option3;
    this.AnotherAPIOption = Option4;
    // a few more
  }

  public ArrayList&lt;String&gt; somethingTheAPIDoesntDo() {
    // Do something the API doesn't provide but I use alot
  }
  // Other shared methods
}
</code></pre>

<p>Does it make sense to push the common code between the two to an Abstract Base class, and have the subclasses only implement their constructors with the specialized option settings?
It makes sense on paper, but something feels weird/counterintuitive about it. Am I missing a pattern here?</p>

<p>Possible DRYer Solution</p>

<pre><code>class A extends BetterAPIBase {
  public A {
    this.APIOption = Option1;
    this.AnotherAPIOption = Option2;
    // a few more
  }
}

class B extends BetterAPIBase {
  public B {
    this.APIOption = Option3;
    this.AnotherAPIOption = Option4;
    // a few more
  }
}    

abstract class BetterAPIBase extends API {
  public Better APIBase() {}
  public ArrayList&lt;String&gt; somethingTheAPIDoesntDo() {
    // Do something the API doesn't provide but I use alot
  }
  // Other methods
}
</code></pre>

<p><strong>EDIT</strong></p>

<p>Static Factory Pattern is nice, but I think I may also add an Interface that includes the common methods I added.</p>

<p>I would make the <code>BetterAPI</code> class also implement <code>IBetterAPI</code>, which would only expose the methods I added wherever I declare the instance's type as <code>IBetterAPI</code>.</p>

<pre><code>interface IBetterAPI{
      public ArrayList&lt;String&gt; somethingTheAPIDoesntDo();
      // other methods I added in BetterAPI
}

//somewhere else:
IBetterAPI niceApi = BetterAPI.createWithOptionSetA();
niceApi.somethingTheAPIDoesntDo();

// Can't do this, nice and hidden.
niceApi.somethingBaseAPIDoes(string uglyOptions, bool adNauseum); 
</code></pre>
","<java><oop><refactoring><dry>","2","164","2010-07-09 15:47:41"
"3214613","How to Optimize this method","<pre><code> private static void ConvertToUpper(object entity, Hashtable visited)
    {
        if (entity != null &amp;&amp; !visited.ContainsKey(entity))
        {
            visited.Add(entity, entity);

            foreach (PropertyInfo propertyInfo in entity.GetType().GetProperties())
            {
                if (!propertyInfo.CanRead || !propertyInfo.CanWrite)
                    continue;

                object propertyValue = propertyInfo.GetValue(entity, null);

                Type propertyType;
                if ((propertyType = propertyInfo.PropertyType) == typeof(string))
                {
                    if (propertyValue != null &amp;&amp; !propertyInfo.Name.Contains(""password""))
                    {
                        propertyInfo.SetValue(entity, ((string)propertyValue).ToUpper(), null);
                    }
                    continue;
                }

                if (!propertyType.IsValueType)
                {
                    IEnumerable enumerable;
                    if ((enumerable = propertyValue as IEnumerable) != null)
                    {
                        foreach (object value in enumerable)
                        {
                            ConvertToUpper(value, visited);
                        }
                    }
                    else
                    {
                        ConvertToUpper(propertyValue, visited);
                    }
                }
            }
        }
    }
</code></pre>

<p>Right now it works fine for objects with lists that are relatively small, but once the list of objects get larger it takes forever. How would i optimize this and also set a limit for a  max depth. </p>

<p>Thanks for any help</p>
","<reflection><refactoring><c#-4.0>","3","278","2010-07-09 16:26:37"
"3219718","Is it possible to simplify (refactor) my Pizza Program code (VB.Net 2010)?","<p>I have created a simply Pizza program (for a summer project not education related) that uses check boxes to determine what the customer wants. Basically a simple pizza ordering program.
I was wondering as I have used the If statement over and other again for different parameters and variables, is it possible to use multiply arrays to simply the VB Code...</p>

<p>I was advised to use Constructors in VB.Net, but have no current experience, could you help?
Or is there a more simpler way to go about creating this program...or a better way of programing?
What about decreasing the repetition in the code?</p>

<pre><code>Option Strict On
Public Class Form1

Dim CurrentBalance As String
Private Sub CheckBox1_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox1.CheckedChanged

    Dim SmallPizza As String
    SmallPizza = ""5""
    CurrentBalance = Label4.Text
    If CheckBox1.Checked Then
        ListBox1.Items.Add(""Small Pizza"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(SmallPizza))
    Else
        ListBox1.Items.Remove(""Small Pizza"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(SmallPizza))
    End If
End Sub

Private Sub CheckBox2_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox2.CheckedChanged
    Dim MediumPizza As String
    MediumPizza = ""7""
    CurrentBalance = Label4.Text
    If CheckBox2.Checked Then
        ListBox1.Items.Add(""Medium Pizza"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(MediumPizza))
    Else
        ListBox1.Items.Remove(""Medium Pizza"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(MediumPizza))
    End If
End Sub

Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
    CurrentBalance = Label4.Text
    MessageBox(""Total cost: £"" &amp; CurrentBalance)
End Sub

Private Sub CheckBox3_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox3.CheckedChanged
    Dim LargePizza As String
    LargePizza = ""9""
    CurrentBalance = Label4.Text
    If CheckBox3.Checked Then
        ListBox1.Items.Add(""Large Pizza"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(LargePizza))
    Else
        ListBox1.Items.Remove(""Large Pizza"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(LargePizza))
    End If
End Sub

Private Sub CheckBox4_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox4.CheckedChanged
    Dim ExtraLargePizza As String
    ExtraLargePizza = ""7""
    CurrentBalance = Label4.Text
    If CheckBox4.Checked Then
        ListBox1.Items.Add(""Extra Large Pizza"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(ExtraLargePizza))
    Else
        ListBox1.Items.Remove(""Extra Large Pizza"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(ExtraLargePizza))
    End If
End Sub

Private Sub CheckBox5_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox5.CheckedChanged
    Dim Ham As String
    Ham = ""1""
    CurrentBalance = Label4.Text
    If CheckBox5.Checked Then
        ListBox1.Items.Add(""Ham"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(Ham))
    Else
        ListBox1.Items.Remove(""Ham"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(Ham))
    End If
End Sub

Private Sub CheckBox6_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox6.CheckedChanged
    Dim Pineapple As String
    Pineapple = ""1""
    CurrentBalance = Label4.Text
    If CheckBox6.Checked Then
        ListBox1.Items.Add(""Pineapple"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(Pineapple))
    Else
        ListBox1.Items.Remove(""Pineapple"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(Pineapple))
    End If
End Sub

Private Sub CheckBox7_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox7.CheckedChanged
    Dim Bananna As String
    Bananna = ""1""
    CurrentBalance = Label4.Text
    If CheckBox7.Checked Then
        ListBox1.Items.Add(""Bananna"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(Bananna))
    Else
        ListBox1.Items.Remove(""Bananna"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(Bananna))
    End If
End Sub

Private Sub CheckBox8_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox8.CheckedChanged
    Dim Meat As String
    Meat = ""1""
    CurrentBalance = Label4.Text
    If CheckBox8.Checked Then
        ListBox1.Items.Add(""Meat"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(Meat))
    Else
        ListBox1.Items.Remove(""Meat"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(Meat))
    End If
End Sub

Private Sub CheckBox9_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox9.CheckedChanged
    Dim ExtraCheese As String
    ExtraCheese = ""1""
    CurrentBalance = Label4.Text
    If CheckBox9.Checked Then
        ListBox1.Items.Add(""Extra Cheese"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(ExtraCheese))
    Else
        ListBox1.Items.Remove(""Extra Cheese"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(ExtraCheese))
    End If
End Sub

Private Sub CheckBox10_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox10.CheckedChanged
    Dim Pepperoni As String
    Pepperoni = ""1""
    CurrentBalance = Label4.Text
    If CheckBox10.Checked Then
        ListBox1.Items.Add(""Pepperoni"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(Pepperoni))
    Else
        ListBox1.Items.Remove(""Pepperoni"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(Pepperoni))
    End If
End Sub

Private Sub CheckBox11_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox11.CheckedChanged
    Dim Special As String
    Special = ""1""
    CurrentBalance = Label4.Text
    If CheckBox11.Checked Then
        ListBox1.Items.Add(""Special"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(Special))
    Else
        ListBox1.Items.Remove(""Special"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(Special))
    End If
End Sub

Private Sub CheckBox12_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox12.CheckedChanged
    Dim Pickup As String
    Pickup = ""1""
    CurrentBalance = Label4.Text
    If CheckBox12.Checked Then
        ListBox1.Items.Add(""Pickup"")
        Label4.Text = CStr(Val(CurrentBalance) - Val(Pickup))
    Else
        Label4.Text = CStr(Val(CurrentBalance) + Val(Pickup))
        ListBox1.Items.Remove(""Pickup"")
    End If
End Sub

Private Sub CheckBox13_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox13.CheckedChanged
    Dim Deliver As String
    Deliver = ""5""
    CurrentBalance = Label4.Text
    If CheckBox13.Checked Then
        ListBox1.Items.Add(""Deliver"")
        Label4.Text = CStr(Val(CurrentBalance) + Val(Deliver))
    Else
        Label4.Text = CStr(Val(CurrentBalance) - Val(Deliver))
        ListBox1.Items.Remove(""Deliver"")
    End If
End Sub

Private Sub ChesseToastToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ChesseToastToolStripMenuItem.Click
    Dim CheeseToast As String
    CheeseToast = ""8""
    CurrentBalance = Label4.Text
    ListBox1.Items.Add(""Cheese Toast"")
    Label4.Text = CStr(Val(CurrentBalance) + Val(CheeseToast))
End Sub

Private Sub GarlicToastToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GarlicToastToolStripMenuItem.Click
    Dim GarlicToast As String
    GarlicToast = ""11""
    CurrentBalance = Label4.Text
    ListBox1.Items.Add(""Garlic Toast"")
    Label4.Text = CStr(Val(CurrentBalance) + Val(GarlicToast))
End Sub

Private Sub BreadSticksToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles BreadSticksToolStripMenuItem.Click
    Dim Breadsticks As String
    Breadsticks = ""14""
    CurrentBalance = Label4.Text
    ListBox1.Items.Add(""Bread Sticks"")
    Label4.Text = CStr(Val(CurrentBalance) + Val(Breadsticks))
End Sub

Private Sub CashToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CashToolStripMenuItem.Click
    ListBox1.Items.Add(""Paying by Cash"")
End Sub

Private Sub ChequeToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ChequeToolStripMenuItem.Click
    ListBox1.Items.Add(""Paying by Cheque"")
End Sub

Private Sub DebitToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DebitToolStripMenuItem.Click
    ListBox1.Items.Add(""Paying by Debit Card"")
End Sub

Private Sub CreditCardToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CreditCardToolStripMenuItem.Click
    ListBox1.Items.Add(""Paying by Crebit Card"")
End Sub

Private Sub VoucherToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles VoucherToolStripMenuItem.Click
    Dim Voucher As String
    Voucher = ""5""
    CurrentBalance = Label4.Text
    ListBox1.Items.Add(""Voucher"")
    Label4.Text = CStr(Val(CurrentBalance) - Val(Voucher))
End Sub

Private Sub ExitToolStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ExitToolStripMenuItem.Click
    End
End Sub

Private Sub MessageBox(ByVal p1 As String)
    Throw New NotImplementedException
End Sub
</code></pre>

<p>Help would be much appreciated.</p>
","<vb.net><refactoring>","3","373","2010-07-10 15:11:02"
"3225894","My Python Program Files cleaner, a better way to write this?","<p>Similar to my other post I have created a new little utility and wanted to get some feedback if there is a way to make my script more Pythonic per say. It is a simple tool for Windows that removes empty directory from the Program Files directory because sometimes programs leave behind an empty directory when they uninstall.</p>

<pre><code>import os

def path_exist(path):
    return os.path.exists(path)

def list_dir(path):
    return os.listdir(path)

def is_dir(path):
    return os.path.isdir(path)

def main():
    x86_64 = 'C:\\Program Files\\'
    x86 =  'C:\\Program Files (x86)\\'

    if path_exist(x86_64):
        for i in list_dir(x86_64):
            i = x86_64 + i
            if is_dir(i):
                if not list_dir(i):
                    os.rmdir(i)
                    print 'Removed', i

    if path_exist(x86):
        for i in list_dir(x86):
            i = x86 + i
            if is_dir(i):
                if not list_dir(i):
                    os.rmdir(i)
                    print 'Removed', i

if __name__ == '__main__':
    main()
</code></pre>
","<python><refactoring><code-review><idioms>","2","206","2010-07-12 04:34:00"
"3230697","Writing a simple custom read more on click function for jquery that needs refactoring","<p>I want to be able to reuse the same function many times on one page..</p>

<p>So here's some psuedo-code :</p>

<pre><code>$("".read_more"").click(function(){
$(this).parents().find("".hidden_text"").slideToggle(""fast"")
});
</code></pre>

<p>The problem with this code, however, is that it targets every elem on the page matching .hidden_text. Is there a way to combine closest() with this? Or is there a better way to refactor this?</p>

<p><b> Update: </b></p>

<p>HTML:</p>

<pre><code>&lt;div class=""grid_2""&gt;
  &lt;div class=""read_more""&gt;
    Click Me
  &lt;/div&gt;
&lt;/div&gt;

&lt;div class=""grid_2""&gt;
  &lt;div id="".hidden_text""&gt;
    Bagels are the most resourceful tools to the most legendary programmers.
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
","<javascript><jquery><refactoring><selectors>","1","402","2010-07-12 17:34:02"
"3233373","Adding features to code bases which are in dire need of refactoring","<p>I am developing on a system that is a bit difficult to work with. It is 99% undocumented, does not follow best practices and is fairly difficult to understand (globals galore, methods spanning 50 lines, eval abuse, etc.). Unfortunately, I am fairly new to the code base and I need to add functionality.</p>

<p>I am sure there is code in there that I could reuse, but I have to meet a deadline and am afraid that the time spent salvaging will end up with me rushing at the end. What is better in the long run? Part of me wants wants to reuse as much as possible, but another part says I should focus on writing the new functionality from scratch, at the risk of duplication (with a plan to refactor when I have more time to spend with the existing code)? I'm leaning towards the latter but wanted to hear some opinions.</p>

<p>Thanks!</p>
","<php><oop><refactoring><code-reuse><legacy-code>","2","104","2010-07-13 00:35:16"
"3236740","PHP Static code Analysis - Finding Class Dependancies","<p>I am about to start a large refactoring job on a big PHP project.</p>

<p>I have successfully used pdepend to generate dependancy reports on the packages outlined in the PHPDoc blocks at the start of every file.</p>

<p>The information is really usefull, it outlines dependancies between packages (which packages are used by which, cyclic dependancies etc).</p>

<p>However I'd like to go one step further and get this data on individual classes. Ideally it would be a tool that compiled a report similar to pdepend however I'd settle for a command line tool that takes the name of a class and the path of a project and returns a list of files the class is used by.</p>

<p>Thanks for your help!</p>

<p>Ben</p>
","<php><refactoring><static><continuous-integration><code-analysis>","3","230","2010-07-13 11:38:32"
"3242133","""Test Driven Development"" Refactoring Design Complexity","<p>I am currently studying test driven development. I am inquiring about an improvement in design if we refactor after the development of every couple of units as opposed to  dedicated refactoring sessions that are more spaced apart in time.</p>

<p>I am aware that the technical debt will be larger. But I am wondering what other impacts. Maybe the refactoring process is not as effective when there is a larger time interval because...?</p>

<p>Thank you..</p>
","<design><refactoring><tdd>","1","143","2010-07-13 22:42:36"
"3242600","How to change the name of a database model and table in Rails?","<p>Lots out there about changing model names only or mapping new models to existing tables, but nothing about renaming both at the same time.  For now, I'm starting with the DB table and working my way out with Find/Replace in my code, but I'm surprised there isn't something better or at least someone who's tried it and written about it.</p>
","<ruby-on-rails><refactoring><model><migration>","1","232","2010-07-14 00:41:17"
"3242768","Purging Preprocessing Macros","<p>This is an odd problem, so I have to provide a bit of background. I have a C++ project that I'm working on that I want to clean up a bit. The main issue that I'm dealing with that makes me want to barf is the massive abuse of preprocessor macros that are used in a core component of the project. There's a file with a bunch of <code>#define</code>s that are commented/uncommented before compiling and using the program in order to toggle the use of different algorithms.  I'd much rather have command-line arguments to do that rather than recompiling every time we want to try a different algorithm. The problem is that there are so many <code>#ifdef</code>'s interwoven throughout the code that it seems impossible to simply refactor the code for each algorithm.</p>

<p>I've been told that the reasoning behind this is that this is supposed to be a real-time system that will be dealing with millisecond units of time, and the code in this component is called so many times that having an <code>if</code> check would adversely affect our performance. If you want to try another algorithm, you have to set the appropriate flags and recompile so that performance is optimized.</p>

<p>So my question for you all is this:<br>
<i><br>
Is there any way that I can get rid of these macros and instead use command-line arguments without a heavy hit to performance and without reworking the logic and the code?
</i></p>

<p>One of the options I was considering was trying to have compiled versions of this component for each of the possible combinations of algorithms, and then pick the version that would be defined by the combination of provided command-line arguments. But according to my friend, the number of combinations is just too many for this to be feasible. I haven't worked out the numbers myself, but I'll take his word for it considering how much work he put into this code. </p>

<p>Thanks in advance for any advice!</p>
","<c++><refactoring><command-line-arguments><preprocessor>","3","108","2010-07-14 01:31:53"
"3244506","Xcode is stuck when trying to refactor a class","<p>Xcode gets stuck if I try to rename a class via refactoring. </p>

<p>It shows ""Applying Changes"" window and says ""Please wait while changes are made."" But changes are never made. It's stuck!</p>

<p>How can I solve this problem?</p>
","<iphone><xcode><refactoring>","1","82","2010-07-14 08:35:59"
"3252132","Batch refactor ""using"" statement declarations in C# across multiple files","<p>I have a bunch of c# code I inherited that has ""using"" statement declarations like this</p>

<pre><code>using Foo;
using NS1=Bar.x.y.z;
</code></pre>

<p>and I've been asked to make our codebase consistent with regard to namespacing - the policy is simply that </p>

<ul>
<li><p>1 some namespaces should always be fully qualified (no aliases) - for example things inside ""Foo"" above should always be fully qualitied.</p></li>
<li><p>2 some namesapces like Bar.x.y.a should always be accessed through a specific using alias (""NS1"" in the above example)</p></li>
</ul>

<p>To illustrate what is desired, </p>

<p>if this is the BEFORE code</p>

<pre><code>using FOO;
int x = SomeClass1.SomeStaticMethodMethod(1); // where SomeClass1 is in ""FOO""
var y = new Bar.x.y.z.SomeClass2()
</code></pre>

<p>this is what is desired AFTER</p>

<pre><code>using NS1 = Bar.x.y.z;
int x = Foo.SomeClass1.SomeStaticMethodMethod(1); // where SomeClass1 is in ""FOO""
var y = new NS1.SomeClass2()
</code></pre>

<p>Of course I can do all this manually. But I have a lot of files to Fix. I'm looking for a tool that can do this over many files (100s of .CS files). I even have the latest version of Resharper (5.1) which doesn't seem to let me do this. (Actually resharper is in fact causing more problems because it loves adding using statements I don't want)</p>

<p>Are there tools or techinques I can use to simplify my task? I am allowed to purchase more dev tools so commercial tools <em>are</em> an option for me.</p>
","<c#><namespaces><resharper><refactoring>","0","167","2010-07-15 02:43:55"
"3257749","OK, so I'm not a beginner anymore. What comes next?","<p>In a certain sense, I'm <em>still</em> very much a beginner, but I don't need to read <em>C++ Primer</em> or <em>Learn C++ in 21 Days</em>, or at least, I only take a peek every now and then for reference's sake. So what is my problem?</p>

<p>Basically, I started to write a small game to help my process of learning. Along the way, I've learned most of anything that you need to know to be called 'fluent' in C++. I know all about overloading, templates, exceptions, RTTI, polymorphism, etc. I've also taken another small step forward and started using the STL and its containers and algorithms. Recently I started reading about the Boost library. I also read some good material about design patterns and actually applied a couple of ideas to this game of sorts.</p>

<p>But now the whole thing has ground to a stop after about 3k lines of code. Why? It's not that I don't know the language or don't have the ideas. But knowing the vocabulary and having the ideas does not make one a novelist. Even knowing how to write sentences is not enough. You have to understand flow, structure, and all the rest to write a successful novel. </p>

<p>In my practical case, I'm tending to waste a lot of time <em>structuring</em> the code so as to work properly, e.g. I'm losing track of whether to send a certain kind of event before another. The program obviously compiles fine, but the runtime behaviour may not be exactly as intended. I'm also losing track of who owns what, who should take care of what, and so forth. Maybe I'm not strong enough when it comes to algorithms, or maybe the culprit is object oriented design - I'm not sure.</p>

<p>The truth is that the code is starting to look a lot like a chaotic mess, not so much in terms of the actual <em>appearance</em> of the code as in terms of the <em>ideas</em> themselves and their interrelation. The maintenance time has become too much already. </p>

<p>Anyway, sorry for the longish post, but I was wondering what to learn next. I've had a look at the books thread on SO, which is wonderful, but I was hoping for a rather more specific direction. I need to spend less time on the rewriting and more on the actual writing.</p>
","<design><language-agnostic><refactoring>","253","6322","2010-07-15 16:34:27"
"3258769","Is there a way to use default arguments that are the result of a function call in VB.NET?","<p>I have a whole slew of database access functions which assume a particular connection string.  Within my application I call</p>

<pre><code>myList = DB_MyTable.GetTableItems()
</code></pre>

<p>and within <code>GetTableItems()</code> I have something like</p>

<pre><code>Dim connection As SqlConnection = MyDB.GetConnection
</code></pre>

<p>So the connection string is in one place in the code, and I call a method to get it.</p>

<p>What I'm running into now is I want to reuse the same database functions, but with a different connection string.  I can rewrite all of the functions like <code>DB_MyTable.GetTableItems()</code> easily because they're generated from a script, but within the main application code I'll need to take care of every function call that now needs to know what connection string I want to use.</p>

<p>I tried changing the arguments to <code>GetTableItems()</code> like this:</p>

<pre><code>Public Shared Function GetTableItems(Optional ByVal useThisString as String = MyDB.GetConnection) As List(Of MyItems)
</code></pre>

<p>in hopes of being able to pass in, by default, the string I'm already using in most of the code, but I got an error saying that the default value had to be a constant expression.  This would mean peppering a specific connection string everywhere, which I don't want to do.</p>

<p>Is there a way to accomplish what I'm after, or do I need to make the connection string a required argument and change all of the calls in my application to match the new signature?</p>

<p>Thanks as always!</p>
","<vb.net><refactoring><optional><optional-arguments>","0","24","2010-07-15 18:40:31"
"3263160","When to refactor a method","<p>This is intended to be more of a discussion than an outright question, hence I've made it community wiki. 
When do you choose to break a method into smaller methods. </p>

<p>Say I have a method that has one purpose, i.e. to load a configuration file</p>

<pre><code>public function configure($file){
    $info = path_info(file);
    $ext = $info['extension'];

    switch($ext){
    case 'ini':
    //code to parse ini files
    break;

    case 'xml':
    //code to parse xml files
    break;

    case 'php':
    //code to parse php files
    break;
}
</code></pre>

<p>}</p>

<p>personally, I'd break out to internal methods depending on the outcome of the switch - but say I have a more sequential method, a series of steps - i.e.</p>

<pre><code>public function doSequence(){
    $stepOne = //some database access to retrieve values
    $stepTwo = //the result of some interpretation of values
    $stepThree = //a fresh database interaction based on the interpreted values
    $stepFour = //prep values for return
    return $values
}
</code></pre>

<p>So, what is your guiding principle for refactoring methods into the appropriate level of granularity?</p>
","<php><refactoring>","1","105","2010-07-16 08:33:00"
"3264637","Test Driven Design - where did I go wrong?","<p>I am playing with a toy project at home to better understand Test Driven Design.  At first things seemed to be going well and I got into the swing of failing tests, code, passing test.</p>

<p>I then came to add a test and realised it would be difficult with my current structure and that furthermore I should split a particular class which had too many responsibilities.  Adding even more responsibilities for the next test was clearly wrong.  I decided to put aside this test, and refactor what I had.  This is where things started to go wrong.</p>

<p>It was difficult to refactor without breaking lots of tests at once, and then the only option seemed to be to make many changes and hope I ended up back at something where the tests passed again.  The tests themselves were valid, I just had to break nearly all of them while refactoring.  The refactoring (which I'm still not that happy with) took me five or six hours before I had returned to all tests passing.  The tests did help me along the way.</p>

<p>It feels like I got off the TDD track.  What do you think I did wrong?</p>

<p>As this is mostly a learning exercise I'm considering rolling back all that refactoring and trying to move forward again in a better fashion.</p>
","<language-agnostic><refactoring><tdd>","9","279","2010-07-16 12:06:15"
"3268247","Is there Zend or jQuery libraries that can do this basic calendar function for me?","<p>I have a calendar application, and in that calendar application, there is a ""mini view"" of a calendar.  That little widget only displays the days of the currently chosen month and when you click the number it opens a new page and sends GET data to that new page (to display MySQL info, etc.)</p>

<p>The point is: this little mini-calendar doesn't do much at all, and I'm working to turn it into a partial in Zend Framework MVC.  We have jQuery as well.  I'm wondering if there is any built-in code that will easily do what we are trying to do with our own code.</p>

<p>Our code (done procedurally):</p>

<pre><code>&lt;?php
    /***
      This script file is the left panel calendar (small)
    */

    //Required variables initializion starts (important in the case of create new event, to avoid PHP notices).

    $day    =    """";
    $month    =    """";
    $year    =    """";
    $sel    =    """";
    $what    =    """";
    $page    =    ""index.php"";
    $param    =    """";
    $index    =    """";
    $functionLast    =    ""goLastMonth"";
    $functionNext    =    ""goNextMonth"";
    $sendFunction    =    ""sendToForm"";

    if(isset($_GET['index'])) //if index page
    {
        $index    =    $_GET['index'];
    }
    if(isset($_GET['type'])) //if sype is set
    {
      $param    =    ""&amp;amp;type="".$_GET['type'];
    }
    if(isset($_GET['page'])) //if page is set
    {
        $page            =    ""calendar.php"";
        $param            =    '&amp;amp;page=calendar';
        $functionLast    =    ""getLastMonth"";
        $functionNext    =    ""getNextMonth"";
        $sendFunction    =    ""sendToTextBox"";
    }

    if(!isset($calWidth) &amp;&amp; !isset($calHeight)) //cal width /height check
    {
        $calWidth    =    CALENDAR_WIDTH;
        $calHeight    =    CALENDAR_HEIGHT;
    }

    if(isset($_GET[""day""])) //if day is set
        $day = $_GET[""day""]; //get it

    if(isset($_GET[""month""])) //if month is set
        $month = $_GET[""month""]; //..

    if(isset($_GET[""year""])) //..
        $year = $_GET[""year""]; //

    if(isset($_GET[""sel""]))
        $sel = $_GET[""sel""];

    if(isset($_GET[""what""]))
        $what = $_GET[""what""];

    if(isset($_GET['date']))
    {
        $date    =    $_GET['date'];
        list($year,$month,$day) = explode(""-"",$date); //split date into pieces
    }

    if($day == """") $day = date(""j"");  //if day is blank, get today

    if($month == """") $month = date(""m"");  //if month is blank, get this month

    if($year == """") $year = date(""Y""); //if year is blank, get this year
    //echo $day.""-"".$month.""-"".$year;die;
    //echo '&lt;br&gt;';
    if(!checkdate($month, $day, $year)) { //if not a valida date
      if(isset($_GET[""month""]))  { //try to get number of days for this month as this seems the last day of the month. for example if today is 31 of August and you are calling ?month=9&amp;year=2009 it gives you wrong results
        $day = date(""t"", strtotime($year . ""-"" . $month . ""-01"")); //so give you 30.
      }
    }

    $printabledate  = $year.""-"".$month.""-"".$day;

    $currentTimeStamp = strtotime(""$year-$month-$day"");
    $monthName = date(""F"", $currentTimeStamp);
    $numDays = date(""t"", $currentTimeStamp);
    $counter = 0;
?&gt;

&lt;br /&gt;
&lt;div id=""loading1"" class=""a_loading1""&gt;
    &lt;iframe src=""&lt;?php echo SITE_URL?&gt;/loading-msg.php"" scrolling=""no"" frameborder=""0""  class=""markup a_position""&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;table  class=""mini-cal-table""&gt;
    &lt;tr class=""tprowbgcolor""&gt;
        &lt;td class=""arrow"" colspan='1' align=""center""&gt;&lt;input type='button' class='buttonleft' onclick='&lt;?php echo ""$functionLast($month,$year,\""$page\"",\""$index\"")""; ?&gt;' onmousedown=""this.className='maincalbutton_active_left'"" onmouseout=""this.className='buttonleft'"" /&gt;&lt;/td&gt;
        &lt;td class=""title"" colspan='5'&gt;&lt;span class='title'&gt;&lt;?php echo $monthName . "" "" . $year; ?&gt;&lt;/span&gt;&lt;/td&gt;
        &lt;td class=""arrow"" colspan='1' align=""center""&gt;&lt;input type='button' class='buttonright' onclick='&lt;?php echo ""$functionNext($month,$year,\""$page\"",\""$index\"")""; ?&gt;' onmousedown=""this.className='maincalbutton_active_right'"" onmouseout=""this.className='buttonright'"" /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td class='wd-titles'&gt;Su&lt;/td&gt;
        &lt;td class='wd-titles'&gt;Mo&lt;/td&gt;
        &lt;td class='wd-titles'&gt;Tu&lt;/td&gt;
        &lt;td class='wd-titles'&gt;We&lt;/td&gt;
        &lt;td class='wd-titles'&gt;Th&lt;/td&gt;
        &lt;td class='wd-titles'&gt;Fr&lt;/td&gt;
        &lt;td class='wd-titles'&gt;Sa&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
&lt;?php
    for($i = 1; $i &lt; $numDays+1; $i++, $counter++)
    {
        $timeStamp = strtotime(""$year-$month-$i"");
        if($i == 1)
        {
        // Workout when the first day of the month is
        $firstDay = date(""w"", $timeStamp);

        for($j = 0; $j &lt; $firstDay; $j++, $counter++)
        echo ""&lt;td&gt;&amp;nbsp;&lt;/td&gt;"";
        }

        if($counter % 7 == 0) {
          echo ""&lt;/tr&gt;&lt;tr&gt;"";
        }

        if(date(""w"", $timeStamp) == 0) {
          //$class = ""class='weekend'"";
          $tdclass = ""weekend"";
        } else {
          if($i == date(""d"") &amp;&amp; $month == date(""m"") &amp;&amp; $year == date(""Y"")) {
            //$class = ""class='today'"";
            $tdclass = ""today"";
          }
          else {
            //$class = ""class='normal'"";
            $tdclass = ""normal"";
          }
        }
        $zero = """";
        if($i &lt; 10 )
        {
            $zero = ""0"";
        }
        $month = round($month);
        if($month &lt; 10)
        {
            $month = ""0"".$month;
        }
        $date  = $year.""-"".$month.""-"".$zero.$i;
?&gt;

&lt;td class=""&lt;?php echo $tdclass?&gt;""&gt;&lt;?php
    if(!isset($_GET['page']))    {
    ?&gt;&lt;a href='&lt;?php echo SITE_URL; ?&gt;/agenda.php?date=&lt;?php echo $year; ?&gt;-&lt;?php echo $month; ?&gt;-&lt;?php echo $zero.$i; ?&gt;'&gt;&lt;?php echo $i?&gt;&lt;/a&gt;

&lt;?php }    else    {
?&gt;

&lt;a onclick='&lt;?php echo ""$sendFunction($i,\""$date\"",$numDays,\""$index\"",\""$type\"")""; ?&gt;'&gt;&lt;?php echo $i?&gt;&lt;/a&gt;

&lt;?php

}
?&gt;&lt;/td&gt;

&lt;?php
    }
?&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;script language=""javascript"" type=""text/javascript""&gt;
    //&lt;![CDATA[
    function goLastMonth(month,year,page,index) {
    // If the month is January, decrement the year.
      if(month == 1) {
        --year;
        month = 13;
      }

      var url =

      document.location.href = page+""?month=""+(month-1)+""&amp;year=""+year+""&lt;?php echo $param?&gt;"";
    }

    function goNextMonth(month,year,page,index)
    {
        // If the month is December, increment the year.
        if(month == 12)
        {
            ++year;
            month = 0;
        }
        document.location.href = page+""?month=""+(month+1)+""&amp;year=""+year+""&lt;?php echo $param?&gt;"";
    }
    //]]&gt;
&lt;/script&gt;
</code></pre>
","<php><zend-framework><refactoring><calendar>","0","226","2010-07-16 19:33:08"
"3268420","jQuery: Fade Out - Do Something - Fade in Pattern","<p>I seem to regularly write jQuery code of a pattern similar to this:</p>

<p>Fade Out ==> Do Something Behind the Scenes ==> Fade In<br>
Illustrated below:  </p>

<pre><code>/// &lt;reference path=""jquery-1.4.2.js"" /&gt;
/// &lt;reference path=""jquery-1.4.2-vsdoc.js"" /&gt;
/// &lt;reference path=""jquery.validate-vsdoc.js"" /&gt;
var fade = ""slow"";

$(document).ready(function () {

    // Some event occurs
    $(""#Trigger"").change(function () {
        var id = $(this).find("":selected"").val();        

        // Fade out target while I do something
        $(""#Target"").fadeOut(fade, function () {
            if (id != """") {

                // Do Something
                $(""#Target"").load(
                    ""/Site/Controller/Action/""+id, null,
                    function () {

                        // Fade in Target
                        $(""#Target"").fadeIn(fade);
                    });
            }
        });
    });
});
</code></pre>

<p>This works fine, but the callback hierarchy gets pretty deep and <strong>I'm just wondering if there's an easier way to do this or a better technique that doesn't result in so many levels of callbacks</strong></p>
","<jquery><gui><refactoring><effects>","3","331","2010-07-16 19:57:10"
"3270458","how do I treat html in a loop when using MVC?","<p>Can someone please show me how to do this basic thing using Zend Framework MVC?</p>

<p>I'm looping over the timestamp data and populating my table that way.  i don't understand how I would pull my presentation HTML from this loop and stick it in the view?  Any help would be greatly appreciated!  </p>

<pre><code>&lt;table&gt;
&lt;?php
  $day = date(""j"");
  $month = date(""m"");
  $year = date(""Y"");        
  $currentTimeStamp = strtotime(""$year-$month-$day""); 
  $numDays = date(""t"", $currentTimeStamp); 
  $counter = 0; 

            for($i = 1; $i &lt; $numDays+1; $i++, $counter++) 
            { 
                $timeStamp = strtotime(""$year-$month-$i""); 
                if($i == 1) 
                { 
                // Workout when the first day of the month is 
                $firstDay = date(""w"", $timeStamp); 

                for($j = 0; $j &lt; $firstDay; $j++, $counter++) 
                echo ""&lt;td&gt;&amp;nbsp;&lt;/td&gt;""; 
                } 

                if($counter % 7 == 0) {
                  echo ""&lt;/tr&gt;&lt;tr&gt;""; 
                }

                    echo ""&lt;td&gt;"" .$i . ""&lt;/td&gt;"";

            }
?&gt; 
&lt;/table&gt;
</code></pre>

<p>I'm wanting to turn the above code into functions, but the HTML is throwing me off.</p>
","<php><mvc><zend-framework><refactoring>","0","198","2010-07-17 06:08:03"
"3286975","Refactor a C# Class","<p>I'm currently working on a local application, which has access to a SQL Server 2008 Express. What I did was create a Class that manages all the access and actions over the database (e.g. INSERT,DELETE,etc) but the class is growing really large, and has at least 40 methods. So my question was: Is there a way to refactor this kind of class? or is it normal to be that way?</p>
","<c#><visual-studio-2010><refactoring>","0","194","2010-07-20 04:11:28"
"3282530","Refactoring two methods with almost the same content","<p>I have 2 methods which have almost the same content:</p>

<pre><code>public string Method1(int someInt)
{
    if(someBoolean)
        return ""test"";

    if(someOtherBoolean)
    {
        return ""dfjakdsad"";
    }
    else
    {
        string myStr = getString(someInt)
    }
}

 public string Method2(myEnum myenum)
 {
    if(someBoolean)
        return ""test"";

    if(someOtherBoolean)
    {
        return ""dfjakdsad"";
    }
    else
    {
        string myStr = getString(myenum)
    }
 }
</code></pre>

<p>The differences are the method signatures and the single statement in the <code>else</code>, <code>string myStr = getString</code></p>

<p>Method1 is called from many places so it has to stay in some way. How would I refactor that?</p>
","<c#><refactoring>","3","211","2010-07-19 15:35:07"
"3283426","Refactor nested class - move to separate file - visual studio 2008","<p>I am looking for a way to extract a nested inner class so that it is in a separate file.  Is there an easy way to do this in Visual Studio 2008 (eg, using the refactor menu)?</p>

<p><em>EDIT</em></p>

<p>Maybe a refactoring menu option isn't necessary if manual refactoring is simple enough.</p>
","<c#><visual-studio-2008><refactoring>","1","478","2010-07-19 17:30:12"
"3297118","Method including SQLConnection - good approach?","<p>Hey, I currently have this method in my code:</p>

<pre><code>public static DataSet PrepareDataSet(some params)
{
    SqlConnection sqlConnection = new SqlConnection(ConfigurationSettings.AppSettings[""ConnectionString""]);
    SqlDataAdapter adapter = new SqlDataAdapter(Utils.EscapeProcedureName(...), sqlConnection);
    adapter.SelectCommand.CommandType = CommandType.StoredProcedure;

    //do some stuff with the adapter using the params

    sqlConnection.Open();
    DataSet dataSet= new DataSet();
    adapter.Fill(dataSet);
    sqlConnection.Close();
    return dataSet;
}
</code></pre>

<p>This code is called from an aspx.cs page. Is it a good approach to have the SQL connection stuff and the adapter inside the method? If not, how can that be refactored? Somehow I think this is not good for testing for example ...</p>

<p>Thanks for ur ideas :)      </p>
","<c#><refactoring><sqlconnection>","0","157","2010-07-21 07:35:25"
"3303085","Supporting Code Metrics with Case Studies","<p>I'm principally interested in case studies on code metrics, relating code readability to defect reduction, that justify taking seriously cyclomatic complexity or some similar metric.  Wikipedia has this example:</p>

<blockquote>
  <p>A number of studies have investigated
  cyclomatic complexity's correlation to
  the number of defects contained in a
  module. Most such studies find a
  strong positive correlation between
  cyclomatic complexity and defects:
  modules that have the highest
  complexity tend to also contain the
  most defects. For example, a 2008
  study by metric-monitoring software
  supplier Enerjy analyzed classes of
  open-source Java applications and
  divided them into two sets based on
  how commonly faults were found in
  them. They found strong correlation
  between cyclomatic complexity and
  their faultiness, with classes with a
  combined complexity of 11 having a
  probability of being fault-prone of
  just 0.28, rising to 0.98 for classes
  with a complexity of 74.</p>
</blockquote>

<p>This is good, but I'm hoping to know if there are more studies (or perhaps similar studies for other metrics, such as SLOC).</p>

<p>I also found an <a href=""http://www.ibm.com/developerworks/java/library/j-cq03316/index.html?S_TACT=105AGX02&amp;S_CMP=EDU"" rel=""nofollow"">article at IBM</a> that promotes monitoring CC values, but it lacks case-study support showing ROI figures.  Then there is <a href=""http://www.codinghorror.com/blog/2006/01/flattening-arrow-code.html"" rel=""nofollow"">Coding Horror article on ""arrow code""</a> which sites a summary of a case study, but does not offer the case study(ies) themselves nor the actual numbers which justified the conclusion:</p>

<blockquote>
  <p>Studies show a correlation between a
  program's cyclomatic complexity and
  its error frequency. A low cyclomatic
  complexity contributes to a program's
  understandability and indicates it is
  amenable to modification at lower risk
  than a more complex program. A
  module's cyclomatic complexity is also
  a strong indicator of its testability.</p>
</blockquote>

<p>Certainly cyclomatic complexity (CC) will help spot arrow-code, but I still need case studies that show ROI values.  For example, ""organization X incorporated a max CC of 10 on methods/functions, and reduced defects 20% in the following development iteration.""</p>

<p>Without that kind of data, it is difficult to get management to care.  Can anyone point me to a few hard studies?  Even just one would help...</p>
","<language-agnostic><refactoring><coding-style><complexity><code-metrics>","1","138","2010-07-21 19:35:08"
"3317866","Rename Unit Test when renaming class Visual Studio","<p>On a related note to <a href=""http://stackoverflow.com/questions/3317789/is-it-possible-to-automaticly-rename-the-unit-test-class-when-renaming-the-class"">this question</a>, which just came up:</p>

<p>I commonly follow the naming convention <code>LibraryClass</code> &lt;-> <code>LibraryClassTests</code> for my unit tests. However, when renaming <code>LibraryClass</code> using the default rename/refactor functionality in either Visual Studio, R# or CodeRush (I have tested both) the test file is not renamed, meaning I might have class called <code>LibraryClassTests</code>that tests the class <code>ClassWithNewName</code>.</p>

<p>Is there a way to configure Visual Studio and/or an extension to the same so that whenever I change the name of a file, the corresponding unit test is also changed?</p>
","<visual-studio><unit-testing><refactoring><naming-conventions>","1","103","2010-07-23 11:55:52"
"3318264","Resharper — fix multiple issues","<p>I'd like to select multiple issues in Inspection Results and fix it automatically. Is there any way to do that?</p>

<hr>

<p>EDIT:</p>

<p>I strongly encourage to vote for this feature here: <a href=""http://youtrack.jetbrains.net/issue/RSRP-126551"" rel=""nofollow"">http://youtrack.jetbrains.net/issue/RSRP-126551</a>.</p>
","<c#><refactoring><resharper>","4","388","2010-07-23 12:49:40"
"3318612","Refactoring SQL","<p>I must connect from my Rails app to a remote database on a Java application.</p>

<p>I have a query like this:</p>

<pre><code>find_by_sql(""select c_templateid, c_templateinfoid, c_startdate, c_enddate, c_active,
campaign, shortcode, prefix, c_descriptivename, c_description, c_templatename 
from (active_services aser join activity a on aser.c_primaryprefixid =
a.c_primaryprefixid ) join matrix_templateinfo using(c_templateinfoid) 
where campaign is not null)"")
</code></pre>

<p>I need to refactor it to the AR#find() method, because I want later add complex :conditions on it. I dont want convert them into string to append then later to the find_by_sql method.</p>

<pre><code>find(:all, 
  :select =&gt; ""c_templateid, c_templateinfoid, c_startdate, c_enddate, c_active,
  campaign, shortcode, prefix, c_descriptivename, c_description, c_templatename"",
# :joins =&gt; WHAT I SHOULD DO HERE ?
  :conditions =&gt; ""campaign is not null""
)
</code></pre>
","<sql><ruby-on-rails><postgresql><refactoring>","0","77","2010-07-23 13:36:58"
"3325329","Why does a ""T"" icon appear in Delphi's ""Search for Usages"" dialog?","<p>Instead of the normal IDE application icon, Delphi 2009 shows a small icon with a ""T"" in the ""Search for Usages"" dialog (see image below). What does this symbol mean?</p>

<p><img src=""http://www.mikejustin.com/images/littlet.png"" alt=""alt text""></p>
","<delphi><refactoring><delphi-2009><icons>","0","136","2010-07-24 13:44:58"
"3334294","ruby fast reading from std","<p>What is the fastest way to read from STDIN a number of 1000000 characters (integers), and split it into an array of one character integers (not strings) ? </p>

<pre><code>123456 &gt; [1,2,3,4,5,6]
</code></pre>
","<ruby><refactoring><profiling><performance>","0","179","2010-07-26 11:15:55"
"3333669","What is the recommended strategy of complete refactoring of a live product?","<p>Consider that you have ""System_A"" which is a web application. And System_A has simply 3 layers: UI, BusinessLayer and Data-Layer.</p>

<p>And now you want to make a widespread refactoring of System_A (the UI and BusinessLayer only) while it is working as a live product.</p>

<p>What should be the safest strategy of refactoring System_A and release the refactored product after a good testing -let's call it ""RF_SystemA""- in a way that it can be reversed to System_A even in case of an unexpected bug (without forcing the users to change their URLs)?</p>
","<web-applications><refactoring><software-engineering>","1","77","2010-07-26 09:36:36"
"3339284","Recommended references for classic ASP","<p>I have to dive into a big chunk of legacy ASP code. What ressources would you recommend reading in order to grasp the best practices of this platform (object orientation, configuration for i18n, ..)</p>
","<asp-classic><refactoring>","3","223","2010-07-26 21:54:33"
"3349861","Suffix Array Implementation in Java","<p>I'm looking to write an efficient n-order Markov chain method to generate random text strings given a set of example text.  I currently have a Java implementation that uses several layers of Maps, but it's clunky.  A suffix array would be perfect for my needs, but I'm not clear if that can be efficiently implemented  in Java.</p>

<p>In C I might do something like:</p>

<pre><code>char exampleText[MAX];
char *suffixArray[MAX];
...
while(n&lt;MAX &amp;&amp; suffixArray[n++] = &amp;exampleText[n]);
sort(suffixArray);
</code></pre>

<p>This gets gnarly in Java since I'd have to take substrings of <code>exampleText</code>, or turn <code>suffixArray</code> into an array of indices, or something else.</p>

<p>Any suggestions for a good approach to this in Java?</p>
","<java><string><refactoring><suffix-array>","1","513","2010-07-28 04:06:30"
"3350568","All Strings to resource","<p>Hi I'm Looking For a tool that help me to extract all strings of my code files to Resource File. I Used Coderush and Microsoft add on(resourcerefactoring.codeplex.com) for working with Resource files. but i had to extract strings to resources one by one.
Is there any better option?</p>
","<.net><string><refactoring><resources>","0","215","2010-07-28 06:59:48"
"3354017","Log statements prevent refactoring: how to help this?","<p>I have some relatively large legacy method that I would like to refactor. It fits ""Bulleted method"" type as specified in Michael Feathers' ""Working Effectively With Legacy Code"" and thus it could be split in several sequential methods in rather straight-forward way . But each of its sequential steps outputs some log message and forming that message requires much more data than for the step itself. So when I try to extract method, I end up with method having, say, 6 parameters. If I had removed those log statements I would have method with only 1 parameter. So I effectively cannot refactor anything. And I'm not allowed to just drop log statements.</p>

<p>A part of method looks like that: </p>

<pre><code>// much of code before
Device device = getDevice(deviceID);
boolean isFirstRegistration = false;

if (device == null) {
    /*logger.trace(
            ""DeviceId"", deviceID,
            ""ADM"", adminCode,
            ""Phone"", clientData.getPhone()
    );
    logger.info(""First registration of the device. Device ID - "" + deviceID);*/
    isFirstRegistration = true;
} else {
    /*logger.trace(
            ""DeviceId"", deviceID,
            ""ADM"", adminCode,
            ""Phone"", clientData.getPhone()
    );
    logger.info(""Device ID - "" + deviceID
            + "" has been previously registered by adminCode: ""
            + device.getAdminCode());*/
}
// much of code after
</code></pre>

<p>As you see, commented out logging statements. In this case I can extract method <code>boolean isFirstRegistration(String deviceId)</code>. But when they are uncommented, signature bloats up to <code>boolean isFirstRegistration(String deviceId, String adminCode, ClientData clientData)</code>. And that is not the most extreme case, just one from the first glimpse. Have you any ideas how should I refactor such method?</p>
","<logging><refactoring><legacy>","2","68","2010-07-28 14:43:01"
"3355163","django: how to evaluate a project for refactoring","<p>Has anyone of you done evaluation of a <code>django</code> project and how to improve/refactor it's code base? A pet project in company I work at is becoming more widely used and it would be good to improve its quality before further development. Are there any techniques or methodologies of analyzing <code>django</code> projects before we start putting more and more features into it? We wouldn't like to suddenly realise, that due to earlier poor choice we have to live with something really bad.</p>
","<django><refactoring><project-planning><evaluation>","2","83","2010-07-28 16:35:34"
"3347788","This pretty little jQuery code seems to not work.. anyone know why?","<p>If I run it. It returns no errors. And in firebug it does in fact select the proper elements in the DOM. </p>

<p>If I break it apart and do something like this :</p>

<pre><code>$('img[hspace]').css('marginLeft', ($('img[hspace]').attr('hspace') / 2) + 'px')
</code></pre>

<p>That works.</p>

<p>Here's the monster in its entirety.</p>

<pre><code>$('img[hspace]').each(function(el){
    var pixels = parseInt($(el).attr('hspace'));
    if(isNaN(pixels) || pixels &lt; 1)
        pixels = 0;
    else
        pixels = pixels / 2;
    $(el).css('marginLeft', pixels + 'px')
         .css('marginRight', pixels + 'px')
         .removeAttr('hspace');
});
</code></pre>

<p><b>Update</b></p>

<p>My HTML :</p>

<pre><code> `&lt;div class='grid_7'&gt;
        &lt;p&gt;&lt;p&gt;
            this is mys&lt;/p&gt;
        &lt;p&gt;
            &lt;img align=""left"" alt=""dude its me"" border=""10"" height=""168"" hspace=""30"" src=""http://s3.amazonaws.com/hq-photo/root/system/photos/6187/resized_orig/photo.jpg"" vspace=""10"" width=""130"" /&gt;&lt;/p&gt;
        &lt;p&gt;
            this is as good as it gets&lt;/p&gt;

        &lt;p&gt;
            this isasd&lt;/p&gt;
        &lt;p&gt;
            sdfasdfasdfasdfasd&lt;/p&gt;
        &lt;p&gt;
            asdfasdfasdf&lt;/p&gt;
        &lt;p&gt;

            asdfa&lt;/p&gt;
        &lt;p&gt;
            sdfasdfasdf&lt;/p&gt;
        &lt;p&gt;
            &amp;nbsp;&lt;/p&gt;
        &lt;p&gt;
            &amp;nbsp;&lt;/p&gt;
        &lt;p&gt;

            &amp;nbsp;&lt;/p&gt;
        &lt;p&gt;
            &amp;nbsp;&lt;/p&gt;
        &lt;p&gt;
            &amp;nbsp;&lt;/p&gt;
        &lt;p&gt;
            &lt;img align=""right"" alt=""it's also me"" border=""50"" height=""168"" hspace=""50"" src=""http://s3.amazonaws.com/hq-photo/root/system/photos/6187/resized_orig/photo.jpg"" vspace=""50"" width=""130"" /&gt;&lt;/p&gt;&lt;/p&gt;
      &lt;/div&gt;`
</code></pre>
","<javascript><jquery><refactoring>","3","117","2010-07-27 20:43:05"
"3363209","Visual studio refactoring a property of a viewmodel does not reflect in the View?","<p>I have a simple ViewModel class like</p>

<pre><code>public class TestViewModel
{
    public String Information { get; set; }
}
</code></pre>

<p>My View inherits from it and I got Intellisense kicking in. So far so good.</p>

<p>I have written these for tests in the View:</p>

<pre><code>&lt;%= Html.Encode(Model.Information) %&gt;
-- &lt;%= Html.Label(""Information"") %&gt;
-- &lt;%= Html.LabelFor(m =&gt; m.Information) %&gt;
-- &lt;%= Html.DisplayFor(m =&gt; m.Information) %&gt;
</code></pre>

<p>I simply rename the property Information to Information2 and let Visual Studio, or Resharper 5, do its magic. However what I experience is that none of the <em>properties</em> in the View get adjusted resulting in none functioning code.  </p>

<p>I was under the impression that refactoring would also update the view(s)? Am I doing something wrong or turned off some checkbox by accident in Visual Studio?</p>
","<asp.net-mvc><visual-studio-2008><refactoring><resharper>","1","123","2010-07-29 13:53:13"
"3366027","How can I extract all classes into separate file?","<p>I'm using the Resharper trial and VS2008. Is it possible to extract all classes from one file into a separate file? I'm able to do this using Resharper but it only seems to work for individual classes. This is to be used on a file that was auto-generated that is 65,000 lines long.</p>
","<visual-studio-2008><refactoring><resharper><extraction>","3","175","2010-07-29 19:00:05"
"3374622","Project Euler: Problem 1 (Possible refactorings and run time optimizations)","<p>I have been hearing a lot about Project Euler so I thought I solve one of the problems in C#. The problem as stated on the website is as follows:</p>

<blockquote>
  <p>If we list all the natural numbers
  below 10 that are multiples of 3 or 5,
  we get 3, 5, 6 and 9. The sum of these
  multiples is 23.</p>
  
  <p>Find the sum of all the multiples of 3
  or 5 below 1000.</p>
</blockquote>

<p>I wrote my code as follows:</p>

<pre><code>  class EulerProblem1
    {
        public static void Main()
        {
            var totalNum = 1000;
            var counter = 1;
            var sum = 0;

            while (counter &lt; totalNum)
            {
                if (DivisibleByThreeOrFive(counter))
                    sum += counter;

                counter++;
            }

            Console.WriteLine(""Total Sum: {0}"", sum);
            Console.ReadKey();
        }

        private static bool DivisibleByThreeOrFive(int counter)
        {
            return ((counter % 3 == 0) || (counter % 5 == 0));

        }
    } 
</code></pre>

<p>It will be great to get some ideas on alternate implementations with less verbosity/cleaner syntax and better optimizations. The ideas may vary from quick and dirty to bringing out the cannon to annihilate the mosquito. The purpose is to explore the depths of computer science while trying to improve this particularly trivial code snippet.</p>

<p>Thanks</p>
","<c#><algorithm><optimization><refactoring><project-euler>","2","784","2010-07-30 19:12:00"
"3375095","Please help transform Tsql ""implicit joins"" into explicit ones","<p>Sorry, I am pretty much an SQL noob. This has to work in MSFT SQL, Oracle as well as Sybase. In the following snippet I need to change an <code>inner join</code> between <code>IJ</code> and <code>KL</code> on <code>IJ.PO_id = KL.PO_id</code> into a <code>left join</code> also on <code>IJ.PO_id = KL.PO_id</code>. So, I believe I have to re-factor this. Well, implicit joins are not the most readable, at least in my co-worker's eyes. I guess I will agree until I develop my own taste. Sorry, I mangled the table and field names just in case.</p>

<pre><code>/* @IJ_id is an input stored proc patrameter. */
from AB, 
     CD,
     EF,
     GH,
     IJ,
     KL
where
    EF.EF_id = IJ.EF_id and
    IJ.EF_id = AB.EF_id and
    EF.ZY_id = IJ.ZY_id and
    IJ.ZY_id = AB.ZY_id and
    IJ.IJ_id = AB.IJ_id and
    IJ.IJ_id = @IJ_id and
    EF.XW_id = GH.GH_id and
    AB.VU_code = CD.VU_code and
    IJ.TS &gt; 0 and
    IJ.RQ = 0 and
    EF.RQ = 0 and
    AB.RQ = 0 and
    IJ.PO_id = KL.PO_id;
</code></pre>

<p>Now, my difficulty is that there is a lot going on in the where clause. Things that do not look like <code>a.b = c.d</code> will remain in the where clause, but not all stuff that does look like <code>a.b = c.d</code> look easy to convert into an explicit join. The difficult part is that ideally the conditions would be between neighbors - <code>AB+CD</code>, <code>CD+EF</code>, <code>EF+GH</code>, <code>GH+IJ</code>, <code>IJ+KL</code> but they are not that organized right now. I could re-order some, but ultimately I do not want to forget my goal: I want the new query to be no slower, and I want the new query to be no less readable. It seems that I might be better off hacking just the part that I need to change, and leave it mostly the same. I am not sure if I can do that.</p>

<p>If you understood my intent, please suggest a better query. if you did not, then please tell me how I can improve the question. Thanks.</p>
","<tsql><refactoring><performance><left-join><inner-join>","4","213","2010-07-30 20:19:30"
"3370140","How to refactor this Ruby code aiming to change an hash's symbols into strings?","<p>I just wrote this piece of code but I'm not quite happy about it.</p>

<pre><code>data = {}
options.each{ |k,v| data.merge!({k.to_s =&gt; v}) }
</code></pre>

<p>Basically I have:</p>

<pre><code>{:a =&gt; ""something"", :b =&gt; ""something else"", :c =&gt; ""blah""}
</code></pre>

<p>... and I want ...</p>

<pre><code>{""a"" =&gt; ""something"", ""b"" =&gt; ""something else"", ""c"" =&gt; ""blah""}
</code></pre>

<p>... in order to send it to a gem that do not handle symbols for some reason. In the code I wrote options is the original hash and data is the updated one, but if I could only use 1 variable it'd be even better.</p>

<p>How would you guys refactor my code?</p>
","<ruby><refactoring><refactor-my-code>","1","149","2010-07-30 09:18:14"
"3384553","Need suggestions regarding Interface refactoring","<p>I have inherited a project that has an awkwardly big interface declared (lets call it IDataProvider). There are methods for all aspects of the application bunched up inside the file. Not that it's a huge problem but i'd rather have them split into smaller files with descriptive name. To refactor the interface and break it up in multiple interfaces (let's say IVehicleProvider, IDriverProvider etc...) will require massive code refactoring, because there are a lot of classes that implement the interface. I'm thinking of two other ways of sorting things out: 1) Create multiple files for each individual aspect of the application and make the interface partial or 2) Create multiple interfaces like IVehicleProvider, IDriverProvider and have IDataProvider interface inhertit from them.</p>

<p>Which of the above would you rather do and why? Or if you can think of better way, please tell.</p>

<p>Thanks</p>
","<interface><refactoring>","0","92","2010-08-02 01:54:43"
"3387914","Can eclipse convert/refactor a method to a class?","<p>This seems like it should be fairly straight-forward, but I can't see anything obvious.  What I basically want to do it to point at a method and refactor->extract class.  This would take the method in question to a new class with that method as top level public API.  The refactoring would also drag any required methods and variables along with it to the new class, deleting them from the old class if nothing else in the old class is using it.  </p>

<p>This is a repetitive task I often encounter when refactoring legacy code.  Anyway, I'm currently using Eclipse 3.0.2, but would still be interested in the answer if its available in a more recent version of eclipse.  Thanks!</p>
","<java><eclipse><class><refactoring><methods>","4","678","2010-08-02 12:51:23"
"3390528","Best Practices for MySQL Encryption?","<p>I'm looking for guidance on encrypting fields (and/or tables if possible) for MySQL. I will settle for a decent tutorial but I'd really like specific tips on managing the transition from an unencrypted schema to one utilizing encrypted fields. Thanks!</p>
","<mysql><security><database-design><encryption><refactoring-databases>","4","904","2010-08-02 18:12:37"
"3398917","How to refactor this code","<p>I am currently refactoring some old code. I am looking for directions on the best design pattern to use here. 
I am thinking of the factory pattern but I am not sure if that's the best way to go or not. </p>

<p>So here is a brief outline of the pseudocode. Class Foo has the core business logic in it.</p>

<pre><code>Class Foo{
    private List&lt;Things&gt; stuff;
    private static Integer count; 
    //getter setter for stuff

    public Foo(List&lt;Things&gt; stuff){
        this.stuff = stuff; 
        this.count=1;
    }

    //the following 3 methods are 90% similar

    public List&lt;Newthings&gt; doSomeThingFirst(){
        //uses the list stuff and also increments the static member count for each entry in List&lt;NewThings&gt; based on certain conditions
    }

    public List&lt;Newthings&gt; doSomethingSecond(){
        //uses the list stuff and also increments the static member count for each entry in List&lt;NewThings&gt; based on certain conditions
    }

    public List&lt;Newthings&gt; doSomethingThird(){
        //uses the list stuff and also increments the static member count for each entry in List&lt;NewThings&gt; based on certain conditions
    }

    //in the future there may be doSomethingFourth(), doSomethingFifth() ... etc.

}


The caller of class Foo looks something like below.

Class SomeServiceImpl{
    public List&lt;Things&gt; getAllFoo(List&lt;Things&gt; stuff){
        Map&lt;Integer,NewThings&gt; fooList = new HashMap&lt;Integer,NewThings&gt;();
        Foo foo = new Foo(stuff);
        fooList.put(1,foo.doSomeThingFirst());
        fooList.put(2,foo.doSomeThingSecond());
        fooList.put(3,foo.doSomeThingThird());
            return new ArrayList&lt;Things&gt;(fooList.values());

    }
}
</code></pre>

<p>Let me know how do you think this code should be refactored for maintainability and reuse or is it fine as is?</p>

<p>Thanks for your inputs. </p>
","<java><design-patterns><refactoring>","1","284","2010-08-03 17:12:05"
"3400377","What is the best way to handle the restriction of an API?","<p>Our core domain so far has an abstraction called PersonName with methods for firstName, lastName, middleInitial etc. As we are expanding the domain to Spain, we figured that they only talk in terms of name, firstSurname and secondSurname i.e. middleInitial etc have no significance to them.</p>

<p>The PersonName interface is currently being used at many places in the current API and the SpainPersonName should also be used at the same places. So, my option is to extend SpainPersonName from PersonName. But, if i do this then I will end up exposing the API for firstName, middleInitial etc which are not applicable for Spain domain.</p>

<p>My question is how best we can refactor the current abstractions still keeping the backward compatibility? Any refactoring or design suggestions are greatly appreciated.</p>
","<design><language-agnostic><api><refactoring>","0","56","2010-08-03 20:08:12"
"3405278","Do very long methods always need refactoring?","<p>I face a situation where we have many very long methods, 1000 lines or more.</p>

<p>To give you some more detail, we have a list of incoming high level commands, and each <S>generates</S> results in a longer (sometime huge) list of lower level commands. There's a factory creating an instance of a class for each incoming command. Each class has a process method, where all the lower level commands are <S>generated</S> added in sequence. As I said, these sequences of commands and their parameters cause quite often the process methods to reach thousands of lines. </p>

<p>There are a lot of repetitions. Many command patterns are shared between different commands, but the code is repeated over and over. That leads me to think refactoring would be a very good idea.</p>

<p>On the contrary, the specs we have come exactly in the same form as the current code. Very long list of commands for each incoming one. When I've tried some refactoring, I've started to feel uncomfortable with the specs. I miss the obvious analogy between the specs and code, and lose time digging into newly created common classes.</p>

<p>Then here the question: in general, do you think such very long methods would always need refactoring, or in a similar case it would be acceptable?
(unfortunately refactoring the specs is not an option)</p>

<hr>

<p>edit: 
I have removed every reference to ""generate"" cause it was actually confusing. It's not auto generated code.</p>

<pre><code>class InCmd001 {

  OutMsg process ( InMsg&amp; inMsg ) {

     OutMsg outMsg = OutMsg::Create();

     OutCmd001 outCmd001 = OutCmd001::Create();
     outCmd001.SetA( param.getA() );
     outCmd001.SetB( inMsg.getB() );

     outMsg.addCmd( outCmd001 );

     OutCmd016 outCmd016 = OutCmd016::Create();
     outCmd016.SetF( param.getF() );

     outMsg.addCmd( outCmd016 );

     OutCmd007 outCmd007 = OutCmd007::Create();
     outCmd007.SetR( inMsg.getR() );

     outMsg.addCmd( outCmd007 );

     // ......

     return outMsg;
  }
}
</code></pre>

<p>here the example of one incoming command class (manually written in pseudo c++)</p>
","<c++><refactoring>","19","1261","2010-08-04 12:01:22"
"3407409","Design pattern to refactor switch statement","<p>I have something like the following in the header</p>

<pre><code>class MsgBase
{
  public:
    unsigned int getMsgType() const { return type_; }
    ...
  private:
    enum Types { MSG_DERIVED_1, MSG_DERIVED_2, ... MSG_DERIVED_N };
    unsigned int type_;
    ...
};

class MsgDerived1 : public MsgBase { ... };
class MsgDerived2 : public MsgBase { ... };
...
class MsgDerivedN : public MsgBase { ... };
</code></pre>

<p>and is used as</p>

<pre><code>MsgBase msgHeader;
// peeks into the input stream to grab the
// base class that has the derived message type
// non-destructively
inputStream.deserializePeek( msgHeader ); 
unsigned int msgType = msgHeader.getMsgType();

MsgDerived1 msgDerived1;
MsgDerived2 msgDerived2;
...
MsgDerivedN msgDerivedN;

switch( msgType )
{
  case MSG_DERIVED_1:
    // fills out msgDerived1 from the inputStream
    // destructively
    inputStream.deserialize( msgDerived1 );
    /* do MsgDerived1 processing */
    break;
  case MSG_DERIVED_2:
    inputStream.deserialize( msgDerived2 );
    /* do MsgDerived1 processing */
    break;
  ...
  case MSG_DERIVED_N:
    inputStream.deserialize( msgDerivedN );
    /* do MsgDerived1 processing */
    break;
}
</code></pre>

<p>This seems like the type of situation which would be fairly common and well suited to refactoring.  What would be the best way to apply design patterns (or basic C++ language feature redesign) to refactor this code?</p>

<p>I have read that the Command pattern is commonly used to refactor switch statements but that seems only applicable when choosing between algorithms to do a task.  Is this a place where the factory or abstract factory pattern is applicable (I am not very familiar with either)?  Double dispatch?</p>

<p>I've tried to leave out as much inconsequential context as possible but if I missed something important just let me know and I'll edit to include it.  Also, I could not find anything similar but if this is a duplicate just redirect me to the appropriate SO question.</p>
","<c++><design-patterns><refactoring>","4","685","2010-08-04 15:59:58"
"3409124","Java 1.4 to Java 1.5 - Rewrite code and avoid the @SupressWarnings","<p>I have an old personal project written in Java 1.4 that I am porting to 1.5 (in which I am a still newbie) for version 2. Besides adding new features to it and refactoring code, I am also migrating to generic collections, annotations etc.</p>

<p>There is a particular piece of code that I don't know how to change to 1.5 and don't want to add a @SupressWarnings on it. It goes like this:</p>

<pre><code>if (value instanceof Comparable) {
  isMatch = (((Comparable) value).compareTo(selectedValue) == 0);
} else {
  //fallback to equals
  isMatch = selectedValue.equals(value);
}
</code></pre>

<p>It is just a simple comparison with an extensive match in compareTo() or defaulting to plain equals() if not a Comparable type.</p>

<p>I am getting a : <code>Comparable is a raw type. References to generic type Comparable&lt;T&gt; should be parameterized</code> warning.</p>

<p>How do I modify the above code to 1.5 and clear the warning. Or is there no choice but to add @SuppressWarnings?</p>

<p>Thanks!     </p>
","<java><generics><refactoring>","2","437","2010-08-04 19:31:24"
"3416550","C# Refactoring: How would you refactor 2 methods that do the same except that they use a different Interface","<p>Having 2 different interfaces is a must. </p>

<p>How would you refactor this?</p>

<p>Should I refactor this code at all?</p>

<pre><code>private void CreateInstanceForProviderA()
{
    a = FactorySingleton.Instance.CreateInstanceA(""A"");

    if (a == null)
    {
        ShowProviderNotInstanciatedMessage();
        return;
    }

    a.Owner = Handle.ToInt32();
    lbl_Text.Text = a.Version();
}

private void CreateInstanceForProviderB()
{
    b = FactorySingleton.Instance.CreateInstanceB(""B"");

    if (b == null)
    {
        ShowProviderNotInstanciatedMessage();
        return;
    }

    b.Owner = Handle.ToInt32();
    lbl_Text.Text = b.Version();
}
</code></pre>

<p>If there would be a common interface, I could write:</p>

<pre><code>private void CreateInstanceForProvider(string provider)
{

    p = FactorySingleton.Instance.CreateInstanceB(provider);
    // p is shared over the whole class
    if (p == null)
    {
        ShowProviderNotInstanciatedMessage();
        return;
    }

    var tmpProvider = p as ICommonProvider;

    tmpProvider .Owner = Handle.ToInt32();
    lbl_Text.Text = tmpProvider .Version();
}
</code></pre>
","<c#><refactoring><refactor-my-code>","2","300","2010-08-05 15:50:38"
"3412935","How to refactor this routine to avoid the use of recursion?","<p>So I was writing a <a href=""http://en.wikipedia.org/wiki/Merge_sort"" rel=""nofollow"">mergesort</a> in <strong>C#</strong> as an <strong>exercise</strong> and although it worked, looking back at the code, there was room for improvement.</p>

<p>Basically, the second part of the algorithm requires a routine to <strong>merge two sorted lists</strong>. </p>

<p>Here is my way too long implementation that could use some refactoring: </p>

<pre><code>private static List&lt;int&gt; MergeSortedLists(List&lt;int&gt; sLeft, List&lt;int&gt; sRight)
{
    if (sLeft.Count == 0 || sRight.Count == 0)
    {
        sLeft.AddRange(sRight);
        return sLeft;
    }
    else if (sLeft.Count == 1 &amp;&amp; sRight.Count == 1)
    {
        if (sLeft[0] &lt;= sRight[0])
            sLeft.Add(sRight[0]);
        else
            sLeft.Insert(0, sRight[0]);
        return sLeft;
    }
    else if (sLeft.Count == 1 &amp;&amp; sRight.Count &gt; 1)
    {
        for (int i=0; i&lt;sRight.Count; i++)
        {
            if (sLeft[0] &lt;= sRight[i])
            {
                sRight.Insert(i, sLeft[0]);
                return sRight;
            }
        }
        sRight.Add(sLeft[0]);
        return sRight;
    }
    else if (sLeft.Count &gt; 1 &amp;&amp; sRight.Count == 1)
    {
        for (int i=0; i&lt;sLeft.Count; i++)
        {
            if (sRight[0] &lt;= sLeft[i])
            {
                sLeft.Insert(i, sRight[0]);
                return sLeft;
            }
        }
        sLeft.Add(sRight[0]);
        return sLeft;
    }
    else
    {
        List&lt;int&gt; list = new List&lt;int&gt;();
        if (sLeft[0] &lt;= sRight[0])
        {
            list.Add(sLeft[0]);
            sLeft.RemoveAt(0);
        }
        else
        {
            list.Add(sRight[0]);
            sRight.RemoveAt(0);
        }

        list.AddRange(MergeSortedLists(sLeft, sRight));
        return list;
    }       
}
</code></pre>

<p>Surely this routine can be improved/shortened by removing <em>recursion</em>, etc. There are even other ways to merge 2 sorted lists. So <strong>any</strong> refactoring is welcome. </p>

<p>Although I do have an answer, I'm curious as to how would other programmers would go about improving this routine. </p>

<p>Thank you!</p>
","<c#><algorithm><refactoring><mergesort>","4","306","2010-08-05 08:26:10"
"3425801","NetBeans refactor class: java.lang.NoClassDefFoundError","<p>I just came across an error when using NetBeans, and I wanted to post my findings (possible this is old news). Perhaps this will save some people the headache of debugging a similar problem that I just encountered. I don't think I'm abusing anything here... stack overflow's SEO is pretty good :)</p>

<p>I refactored a class in NetBeans (JavaFX project), and from that point on I got a ""java.lang.NoClassDefFoundError"" for that particular refactored class.</p>

<p>I fixed the error by simply doing a ""Clean and Build Project."" This apparently deleted whatever cache file or erroneous file/class reference. I don't think this is a Netbeans bug... hoping it was just one of those ""flukey"" moments.</p>

<p>Cheers!</p>
","<netbeans><refactoring><classnotfoundexception>","1","788","2010-08-06 16:33:50"
"3427824","Dictionary of Primes","<p>I was trying to create this helper function in C# that returns the first n prime numbers. I decided to store the numbers in a dictionary in the <code>&lt;int,bool&gt;</code> format. The key is the number in question and the bool represents whether the int is a prime or not. There are a ton of resources out there calculating/generating the prime numbers(SO included), so I thought of joining the masses by crafting another trivial prime number generator.</p>

<p>My logic goes as follows:</p>

<pre><code>public static Dictionary&lt;int,bool&gt; GetAllPrimes(int number)
    {
        Dictionary&lt;int, bool&gt; numberArray = new Dictionary&lt;int, bool&gt;();


        int current = 2;
        while (current &lt;= number)
        {
            //If current has not been marked as prime in previous iterations,mark it as prime
            if (!numberArray.ContainsKey(current))
                numberArray.Add(current, true);

            int i = 2;
            while (current * i &lt;= number)
            {
                if (!numberArray.ContainsKey(current * i))
                    numberArray.Add(current * i, false);
                else if (numberArray[current * i])//current*i cannot be a prime
                    numberArray[current * i] = false;
                i++;

            }
            current++;
        }
        return numberArray;
    }
</code></pre>

<p>It will be great if the wise provide me with suggestions,optimizations, with possible refactorings. I was also wondering if the inclusion of the Dictionary helps with the run-time of this snippet.</p>
","<c#><algorithm><data-structures><refactoring><primes>","1","232","2010-08-06 21:10:35"
"3437566","Refactoring Form.ShowDialog() code to MVP","<p>I have a WinForm and few properties that are set on it.<br>
for example : Name,Address are accepted on the Form.<br>
(many more properties in actual example)</p>

<p>The current implementation is somewhat similar to </p>

<pre><code>frmName frmView = new  frmName (); //frmName  is WINFORM 
frmView.Name= ""ABC""; //any valid string or read this from file
frmView.Address=""SomeAddress""; //any valid address or read this from file

if (frmView.ShowDialog() == DialogResult.OK)
{
    //OK CLICK PROCESS and
    // get new values edited by user
     string name = frmView .Name;
     string address = frmView.Address;
     doProcessing(name,address);
}
else{
  //Ignore cancel click..
}
</code></pre>

<p>how do i convert this to a <a href=""http://en.wikipedia.org/wiki/Model-view-presenter"" rel=""nofollow"">MVP</a> based Winform application.<br>
Also need to refactor the processing done on <strong><em>ShowDialog()</em></strong> to the Presenter/Model<br>
(dunno exactly where to do it)?<br>
Also need to avoid writing code on the form itself.(Passive view)</p>

<p>Thanks All.</p>
","<winforms><design-patterns><refactoring><mvp>","3","455","2010-08-09 05:35:25"
"3437666","What article discusses ""Viewing code from 10000 feet""?","<p>A few years ago I read an article about a neat way to analyze a large code-base.</p>

<p>The idea was to zoom out so far that patterns of indentation and block length are all that is really visible.</p>

<p>The author wrote about printing out code with very small fonts and looking at the results from 10 feet back. I believe the author also had some tools for reformatting code and producing images for this technique, in such a way that paper could be avoided.</p>

<p>I can't find the right search query to bring this up.  Anyone have any ideas?</p>
","<refactoring><code-analysis>","3","211","2010-08-09 06:04:42"
"3447221","how to refactor this jQuery(only AJAX URL different)","<pre><code>function one(R) {
  # do some thing..
  $.ajax({
    'url': '/one?search=' + R.val(),
  #some thing common here

}

function two(R) {
  # do some thing..
  $.ajax({
    'url': '/two?search=' + R.val(),
  #some thing common here

}
</code></pre>

<p>well, since I'm just doing jQuery, but I guess this can get improve, refactor?</p>
","<jquery><refactoring>","-1","51","2010-08-10 08:34:08"
"3450979","DRYing out C# for WPF windows with the same fields","<p>I have two windows in my WPF app:  a login window and an options window.  Both have the same form with a user name and password field, as well as some other fields for providing credentials.  I want some code that knows there will be a <code>txt_userName</code> <code>TextBox</code> available, for example, and can do things based on that.  I was thinking I could make some kind of <code>IHaveCredentialsForm</code> interface and have both <code>LoginWindow</code> and <code>OptionsWindow</code> implement it, but when I tried, I got ""'MyNamespace.LoginWindow' does not implement interface member 'MyNamespace.IHaveCredentialsForm.txt_userName'"".  Here's my interface so far:</p>

<pre><code>interface IHaveCredentialsForm
{
    TextBox txt_userName { get; set; }
}
</code></pre>

<p>I was thinking I got the error because <code>LoginWindow</code> is a <code>partial</code> class that inherits from <code>Window</code>.  I can definitely access a <code>TextBox</code> called <code>txt_userName</code> inside the methods of <code>LoginWindow</code>, though I haven't explicitly defined such a property.  It magically appeared from having a <code>TextBox</code> with that name in LoginWindow.xaml, I assume.</p>

<p>How can I go about DRYing this out?  I already have a method for doing stuff with <code>string</code> values for the user name, password, etc., but it seems redundant to have two different classes that are passing in <code>txt_userName.Text, pwb_password.Password, ...</code>--the same arguments to the same method.</p>

<p>While I'm at it, how could I share a chunk of XAML (the credentials form) between two different windows?</p>
","<c#><wpf><refactoring><interface><dry>","0","88","2010-08-10 16:03:50"
"3458667","How do you go about refactoring the front-end of a large website?","<p>I have a very large website that I need to refactor the front-end of due to maintainabilty concerns and performance issues:</p>

<p><strong>Whats tricky</strong>:</p>

<ul>
<li>Lots of overcomplicated scripts</li>
<li>Over-complicated CSS with a whopping filesize</li>
<li>No selenium tests in place</li>
<li>No js tests in place</li>
<li>Back end developers concerned anything breaking</li>
<li><strong>The site has been live for a while and the client is happy</strong></li>
</ul>

<p><strong>Tools available</strong>:</p>

<ul>
<li>Multiple servers for testing versions on </li>
<li>Continuos integration setup</li>
<li>Version control</li>
</ul>

<p>Advice on how I should approach this would be most appreciated.</p>
","<javascript><jquery><css><refactoring><front-end>","1","164","2010-08-11 13:19:05"
"3459433","Auto-capitalizing all method names for port from Java to .NET","<p>I am using <a href=""http://www.ikvm.net"" rel=""nofollow"">IKVM</a> to compile a large Java library project to a .NET DLL. In so doing, however, the method names are staying according to the Java convention of method names NOT being capitalized - but I want the .NET dll to be used in .NET projects and so would like the method names to be capitalized.</p>

<p>The only exception would be methods which are overloads of JDK methods such as toString() or such - these will have to remain in lower-case.</p>

<p><strong>How should I go about automatically renaming all methods (which are not overloads of JDK methods!), making them into capitalized names?</strong></p>

<p>Note that I've tried using an obfuscator like Proguard but keep running into settings issues and would love a different solution - but if you know of any <strike>easy</strike> way to do it with Proguard, please let me know!</p>
","<java><.net><refactoring><proguard><ikvm>","0","77","2010-08-11 14:33:35"
"3461308","What's the most effective way to refactor this simple method?","<p>I have implemented a very simple method:</p>

<pre><code>private String getProfileName(String path) {
    String testPath = null;
    for (int i = 0; i &lt; path.length(); i++) {
       testPath = path.substring(0, i);
          if ( testPath.endsWith(""1"") || testPath.endsWith(""2"") || testPath.endsWith(""3"") || testPath.endsWith(""4"") || testPath.endsWith(""5"") || testPath.endsWith(""6"") || testPath.endsWith(""7"") || testPath.endsWith(""8"") || testPath.endsWith(""9"") ) {
            break;
          }
    }
    return testPath.substring(0, (testPath.length() - 1));
}
</code></pre>

<p>I don't like the whole method because I think it's more complicated than necessary, especially the if condition.</p>

<p>So I thought of a way to refactor this method. First I thought of using Regex to replace the if condition, but isn't regex a little bit too much for this simple case?</p>

<p>Any other ideas how to reafctor this?</p>
","<java><refactoring>","5","435","2010-08-11 17:49:48"
"3461615","How to avoid instanceof calls?","<p>I defined this simple method:</p>

<pre><code>public static boolean isBorder(int x, int y) throws CollisionDetectionException {
        try {
            if ( (levelItems[x][y] instanceof StaticGameObject &amp;&amp; levelItems[x][y].isVisible()) ||
                (levelItems[x-1][y] instanceof StaticGameObject &amp;&amp; levelItems[x-1][y].isVisible()) ||
                (levelItems[x][y+1] instanceof StaticGameObject &amp;&amp; levelItems[x][y+1].isVisible()) ||
                (levelItems[x][y-1] instanceof StaticGameObject &amp;&amp; levelItems[x][y-1].isVisible()) ||
                (levelItems[x-1][y-1] instanceof StaticGameObject &amp;&amp; levelItems[x-1][y-1].isVisible()) ||
                (levelItems[x-1][y+1] instanceof StaticGameObject &amp;&amp;levelItems[x-1][y+1].isVisible()) ||
                (levelItems[x+1][y] instanceof StaticGameObject &amp;&amp; levelItems[x+1][y].isVisible()) ||
                (levelItems[x+1][y+1] instanceof StaticGameObject &amp;&amp; levelItems[x+1][y+1].isVisible()) ||
                (levelItems[x+1][y-1] instanceof StaticGameObject &amp;&amp; levelItems[x+1][y-1].isVisible()) ) {
                return true;
            } else {
                return false;
            } 
        } catch (ArrayIndexOutOfBoundsException e) {
            throw new CollisionDetectionException(""Collision couldn't be checked because checking position "" + x + ""/"" + y + "" caluclated values below (0/0)"");
        }
    }
</code></pre>

<p>As you can see i have a 2dimensional array. Now i want to check a specific position ((x/y) -> the method arguments), if there are any visible StaticGameObject in the neighbouring fields of the 2dimensional array.</p>

<p>The levelItems array consists of so called GameObject. StaticGameObject is a a direct subclass of GameObject.</p>

<p>Any hints how to improve this method?</p>
","<java><refactoring>","2","701","2010-08-11 18:29:28"
"3462248","What is the cleanest way to duplicate base/parent.pm's functionality for non-object perl modules?","<p>I'm not thinking too clearly right now and possibly overlooking something simple. I've been thinking about this for a while and been searching, but can't really think of any sensible search queries anymore that would lead me to what i seek.</p>

<p>In short, I'm wondering how to do module inheritance, in the way base.pm/parent.pm do it for object-oriented modules; only for Exporter-based modules.</p>

<p>A hypothetical example of what i mean:</p>

<p>Here's our script. It originally loaded Foo.pm and called baz() from it, but baz() has a terrible bug (as we'll soon see), so we're using Local/Patched/Foo.pm now which should fix the bug. We're doing this, because in this hypothetical case we cannot change Foo (it is a cpan module under active development, you see), and it is huge (seriously).</p>

<pre><code>#!/usr/bin/perl

# use Foo qw( baz [... 100 more functions here ...] );
use Local::Patched::Foo qw( baz [... 100 more functions here ...] );
baz();
</code></pre>

<p>Here's Foo.pm. As you can see, it exports baz(), which calls qux, which has a terrible bug, causing things to crash. We want to keep baz and the rest of Foo.pm though, without doing a ton of copy-paste, especially since they might change later on, due to Foo still being in development.</p>

<pre><code>package Foo;
use parent 'Exporter';
our @EXPORT = qw( baz [... 100 more functions here ...] );
sub baz { qux(); }
sub qux { print 1/0; }            # !!!!!!!!!!!!!
[... 100 more functions here ...]
1;
</code></pre>

<p>Lastly, since Foo.pm is used in MANY places, we do not want to use Sub::Exporter, as that would mean copy-pasting a bandaid fix to all those many places. Instead we're trying to create a new module that acts and looks like Foo.pm, and indeed loads 99% of its functionality still from Foo.pm and just replaces the ugly qux sub with a better one.</p>

<p>What follows is what such a thing would look like if Foo.pm was object-oriented:</p>

<pre><code>package Local::Patched::Foo;
use parent 'Foo';
sub qux { print 2; }
1;
</code></pre>

<p>Now this obviously will not work in our current case, since parent.pm just doesn't do this kinda thing.</p>

<p>Is there a clean and simple method to write Local/Patched/Foo.pm (using any applicable CPAN modules) in a way that would work, short of copying Foo.pm's function namespace manually?</p>
","<perl><refactoring><module>","6","87","2010-08-11 19:51:31"
"3466651","PMD code smell detection and refactoring","<p>(I develop using JAVA and want to implement plugin in eclipse which can detect code smell and automate refactoring)</p>

<p>1) Initialy, I would like to find a smell detector library in order to get the smell existing in the class. I installed PMD plugin in Eclipse and try using it.
I want to get all information which is represented in a views of Eclipse (Violation Outline View and Violation Overview View) by using PMD library. because I want to use this information further instead of only seeing it. Please suggest me the tutorials or examples. I saw only the page like javadoc listing the class in PMD library. </p>

<p>2) And also are there any tools for detecting code smell.</p>

<p>3) could you give the example of library for automating refactoring and the tutorial</p>

<p>Thank you very much</p>
","<refactoring><code-smell><automated-refactoring>","1","380","2010-08-12 10:17:34"
"3467061","Refactoring - which pattern to use in this example?","<p>I have a function which is processing rows from an excel file.In this function,I have a for loop.Now,once a row is extracted,we check for various conditions.If any condition is false,we continue with next row.Can this code be made more structured using a pattern?</p>

<pre><code> foreach (System.Data.DataRow dr in ds.Tables[0].Rows)
                {

                    Product prod = GetProduct(dr);
                    if (prod == null)
                    {
                        IndicateNotInserted(dr, ""InvalidProduct"");
                        continue; 
                    }



                    if (IsProductExpired())
                    {
                        IndicateNotInserted(dr, ""Expired"");
                        continue; 
                    }
                    ProcessRow(dr);
</code></pre>
","<refactoring><code-review>","4","96","2010-08-12 11:21:35"
"3468192","Refactoring with dynamically typed language","<p>Ok, I'm not trying to start a flame war here, and I know the argument between static and dynamic languages has been hashed out many times, including here. But I have a very practical question that hopefully someone here can shed some light on. Sorry for the length, but this is not a simple question with probably not a simple answer.</p>

<p>Ruby, PHP, and Javascript are pretty popular languages these days, and they have a lot of people that defend them and argue that being dynamically typed doesn't hold the developer back. I'm new to these languages and would like to start using them for bigger projects, but here's a basic refactoring scenario that comes up all the time at work(work == C#), and I'm wondering what the approach would be in Ruby - I chose Ruby because it's OO.</p>

<p>Ok, I'm using Ruby, and I build a Customer object. It has methods for loading/saving/deleting from the database. It is good and people use it. I add more methods for other things and people use it more. I add a method for calculating order history based on some parameters. By now this class is being used all over the system. Then, one day I decide to change the parameters on the GetOrderHistory method. So I:</p>

<ul>
<li>add the new parameters to the method</li>
<li>rewrite the code of the method to use the new parameters</li>
<li>change the client code I had in mind to pass the new parameters and use this modified method</li>
</ul>

<p>But now what? I have dozens/hundreds/whoknows how many other places in the system that need to be changed. In a dynamic OO language like Ruby or Javascript, how would I go about this?</p>

<p>Off the top of my head, not knowing Ruby very well, I can think of two dumb answers:</p>

<ol>
<li>100% Code coverage. I test the entire app and every time it breaks I see if it's that method and fix it</li>
<li>Find and Replace. I use the text search to look for that method. But I could have other objects with the same method names.</li>
</ol>

<p>So is there a good answer to this? It seems the IDE would have a hard time. If I had code such as </p>

<pre><code>c = Customer.new
</code></pre>

<p>it would be able to figure it out, but what if it's</p>

<pre><code>c= SomeFunctionThatProbablyReturnsACustomerButMightReturnOtherThings()
</code></pre>

<p>So what approach would you Ruby experts take in this case?</p>
","<ruby><dynamic><refactoring>","2","132","2010-08-12 13:33:44"
"3468330","Java Generics Refactoring and Ambiguity","<p>I have an old untyped class pre Java1.5 and need to refactor it using Java Generics to get more type security in the code.</p>

<p>Old Code looks like this:</p>

<pre><code>class Foo { 
  void setInput(Object input) {...}
}
</code></pre>

<p>Now this <em>input</em> could be some object but it may also be an array, nasty stuff. Making a generic version of it seems not to be trivial, I tried:</p>

<pre><code>class Foo&lt;E&gt; {
  void setInput(E input) {...}
  void setInput(E[] input) {...}
}
</code></pre>

<p>The problem is that this is ambiguous for example for calls:</p>

<pre><code>Foo f = Foo&lt;SomeClassyClass&gt;();
f.setInput(null);
</code></pre>

<p>Is there some good solution to this problem or do I need to take a completely other approach?</p>

<p>Thanks,
Patrick</p>
","<java><generics><refactoring>","1","73","2010-08-12 13:47:15"
"3470972","Building a long query and have a lot of if statements - is there a more elegant way?","<p>I have to build a query based on certain conditions.  Is there a better way of doing it than the way I have done below?  It works fine but I can see it getting out of hand fairly quickly if there were more conditions since I check if any previous conditions had been met every time I check a new one.</p>

<pre><code>    $sql = ""SELECT DISTINCT fkRespondentID FROM tblRespondentDayTime"";

    if (!empty($day) || !empty($time) || !empty($sportID)) {

        $sql .= "" WHERE"";

        if (!empty($day)) {
            $sql .= "" fldDay='$day'"";
        }

        if (!empty($time)) {
            if (!empty($day)) {
                $sql .= "" AND"";
            }
            $sql .= "" fldTime='$time'"";
        }

        if (!empty($sportID)) {
            if (!empty($day) || !empty($time)) {
                $sql .= "" AND"";
            }
            $sql .= "" fkRespondentID IN (SELECT fkRespondentID FROM tblRespondentSport WHERE fkSportID='$sportID')"";
        }

    }
</code></pre>
","<php><mysql><refactoring><coding-style>","7","189","2010-08-12 18:52:40"
"3478109","How can I refactor/extend the following model","<p>I currently have a cache implementation (using arrays) for the heavy computations performed during the simulation. The structure of the cache is as follows:</p>

<p><img src=""http://i.imgur.com/kGAhj.png"" alt=""alt text""></p>

<p>The way it works:</p>

<pre><code>CalculationsAbstract calculationsCache = new CalculationsCache();

// Constructor of CalculationsCache
public CalculationsCache()
{
   this.Proxy = new Calculations();
   Proxy.Proxy = this;
}

calculationsCache.CalculateValue1();    
// Checks ""Value1"" array for existing value, if not, the actual computation is called
// via Proxy object, value retrieved is cached in array then returned to user.
</code></pre>

<p>Now, I'm trying to add new computations which are specific to a certain scenario, and wouldn't be appropriate for them to be placed in <code>CalculationsAbstract</code>, <code>Calculations</code> and <code>CalculationsCache</code>, however ScenarioA would still use existing calculations in the old classes.</p>

<p>I'm trying to add the new calculations and their arrays in new classes named <code>ScenarioACalculations</code> and <code>ScenarioACalculationsCache</code>, just like it was done for Value1, Value2,...etc  but I'm confused as to how these new classes would fit into the existing model. </p>

<p>This is what I tried to do:</p>

<pre><code>internal interface IScenarioACalculations 
{
    float GetScenarioAValue5();
}

ScenarioACalculations : Calculations, IScenarioACalculations 
ScenarioACalculationsCache : CalculationsCache, IScenarioACalculations 
</code></pre>

<p>Given that throughout my project, I only hold a reference to type <code>CalculationsAbstract</code> (as in the code example above), and I can't cast my <code>IScenarioACalculations</code> object to <code>CalculationsAbstract</code>, what would be the best way to add ScenarioA calculations and possibly ScenarioB...etc in the future ?</p>

<p>Sorry for making this long.</p>

<p>Thank you.</p>
","<c#><design-patterns><oop><caching><refactoring>","1","106","2010-08-13 14:59:58"
"3482255","How can I refactor this simple Ruby snippet?","<p>I have a class that looks like this:</p>

<pre><code>class Base &lt; Library
  prelude ""some-value""        # from Library
  def foo; ...; end

  prelude ""some-other-value""  # from Library
  def bar; ...; end

  # ... others
end
</code></pre>

<p>I'd like to refactor it into something like the following:</p>

<pre><code>class Base &lt; Library
  # what goes here to bring FooSupport and BarSupport in?
end

class FooSupport (&lt; ... inherit from something?)
  prelude ""...""   # Need a way to get Library prelude.
  def foo; ...; end
end

class BarSupport (&lt; ... inherit from something?)
  prelude ""...""   # Need a way to get Library prelude.
  def bar; ...; end
end
</code></pre>

<p>How can I do that?</p>
","<ruby><refactoring>","0","53","2010-08-14 06:08:40"
"3478354","Refactoring library of eclipse","<p>It is possible to implement the refactoring by using Eclipse library (JDT,LTK) without involving of the wizards. I would like to get benefit from refactoring feature of eclipse but I wan't to provide input for refactoring by other ways (that is not entering in the wizard) such as reading from file, etc.</p>

<p>If possible , Please suggest me how</p>
","<eclipse><refactoring>","1","77","2010-08-13 15:28:18"
"3484181","python reorganize codes","<p>Sorry I dont know how to add a comment with the format, so I post another question with code here, as I am new to python, seems that there are many better ways to reorgnize the codes to make it better:</p>

<pre><code>def min_qvalue(self):
    s = 0
    q = 1
    for i in range(len(self.results)):
        if self.results[i].score &gt; s:
            s = self.results[i].score
            q = self.results[i].qvalue
    return q
</code></pre>

<p>For the above code, should not be the best piece, any improvements possible? thanks :)</p>
","<python><refactoring>","0","118","2010-08-14 16:31:58"
"3480291","Best way to deal with conflated business and presentation code?","<p>Considering a hypothetical situation where an old, legacy presentation library has been maintained over the years, and has gradually had more and more business logic coded into it through a process of hasty corrections and lack of proper architectural oversight. Alternatively, consider a business class or namespace that is not separated from presentation by assembly boundaries, and was thus capable of referencing something like System.Windows.Forms without being forced to add a reference (a much more sobering action than a simple using clause).</p>

<p>In situations like this, it's not unimaginable that the business code used by this UI code will eventually be called upon for reuse. What is a good way to refactor the two layers apart to allow for this?</p>

<p>I'm loosely familiar with design patterns--at least in principle anyway. However, I don't have a whole ton of practical experience so I'm somewhat unsure of my intuitions. I've started along the path of using the Strategy pattern for this. The idea is to identify the places where the business logic calls up to UI components to ask the user a question and gather data, and then to encapsulate those into a set of interfaces. Each method on that interface will contain the UI-oriented code from the original workflow, and the UI class will then implement that interface.</p>

<p>The new code that wants to reuse the business logic in question will also implement this interface, but substitute either new windows or possibly pre-fab or parameterized answers to the questions originally answered by the UI components. This way, the biz logic can be treated as a real library, albeit with a somewhat awkward interface parameter passed to some of its methods.</p>

<p>Is this a decent approach? How better should I go about this? I will defer to your collective internet wisdom.</p>

<p>Thanks!</p>
","<c#><design-patterns><refactoring><strategy-pattern><three-tier>","4","110","2010-08-13 19:59:22"
"3491877","How can I improve this long-winded Python code?","<p>I have a data structure like this:</p>

<pre><code>items = [
    ['Schools', '', '', '32'],
    ['Schools', 'Primary schools', '', '16'],
    ['Schools', 'Secondary schools', '', '16'],
    ['Schools', 'Secondary schools', 'Special ed', '8'],
    ['Schools', 'Secondary schools', 'Non-special ed', '8'],
]
</code></pre>

<p>It's a list of spending items. Some are aggregates, e.g. <code>items[0]</code> is aggregate spending on all schools, and <code>items[2]</code> is aggregate spending on secondary schools. Those that are not aggregates are <code>items[1],</code> <code>items[3]</code> and <code>items[4]</code>. </p>

<p>How can I elegantly reduce the list so it only shows non-aggregate items? In pseudocode:</p>

<pre><code>for each item in items
   check if item[1] is blank, if it is
       check if item[0] matches another item’s[0]
       if it does and if that item’s[1] isn’t blank
           delete item
   check if item[2] is blank, if it is
       check if item[1] matches another item’s[1]
       if it does and if if that item’s[2] isn’t blank
           delete item 
</code></pre>

<p>Here's my (lame!) attempt so far:</p>

<pre><code>for i in range(len(items)):
    i -= 1
    if items[i]:
        if items[i][1] == """":
            for other_item in items:
                if items[i][0]==other_item[0] and other_item[1]!="""":
                    items_to_remove.append(i)
                    continue
        elif items[i][2]=="""":
            for other_item in items:
                if items[i][1] == other_item[1] and other_item[2] != """":
                    items_to_remove.append(i)
                    continue
new_items = [ key for key,_ in groupby(items_to_remove)]
new_items.sort(reverse=True)  
for number in new_items:
    temp_item = items[number]
    items.remove(temp_item)
</code></pre>

<p>This is just so ugly. What can I do better?</p>

<p>NB: I could use dictionaries instead of lists, if that would make life easier :)</p>
","<python><refactoring>","0","169","2010-08-16 09:17:14"
"3494618","Eclipse Extract Constant String from Existing Constant String","<p>Say I've got an existing constant string:</p>

<pre><code>private final static String LOREM_IPSUM = ""Lorem Ipsum"";
</code></pre>

<p>Is there a way in Eclipse to quickly extract a substring of this as another constant such that I could end up with something like:</p>

<pre><code>private final static String LOREM = ""Lorem"";
private final static String IPSUM = ""Ipsum"";
private final static String LOREM_IPSUM = LOREM + "" "" + IPSUM;
</code></pre>

<p>In this particular case, two refactorings (one for LOREM and one for IPSUM) would suffice.</p>
","<eclipse><refactoring>","0","243","2010-08-16 15:26:21"
"3494748","Best approach to refactor code to a newer version","<p>This question is related to my experience with FOSS as a student.
Sorry I might be a bit subjective, but working with a certain approach here and would want to know if I am on the right track.</p>

<p>I am involved in project,where I am supposed to refactor code which has been already written by someone else but was never included in the main trunk.
The core code stays the same but as the GUI of the project has evolved changes needed to be made before it can be integrated.</p>

<p>My Approach till now has been:</p>

<ol>
<li>Separate the core from GUI dependent code</li>
<li>Copy+Paste all the core code(As it should work )</li>
</ol>

<p>For sometime I had no problems but now for a class on which my code depends, I am facing problems as the newer version has a different constructor and has different looking code.</p>

<p>What is the best way out in such cases?</p>

<p>Understanding all the code will take time. And I am beginner working on bigger project.</p>
","<refactoring>","2","95","2010-08-16 15:37:19"
"3506867","Tramp Data vs. Testability","<p>I'm not doing much new development right now, but a lot of refactoring of older C# subsystems whose original requirements no longer support new and I'll add unexpected requirements. I'm also now using Rhino Mocks and unit tests where possible (vs 2008).</p>

<p>The dilemma for me is that to make the methods testable and mockable, I need to define clear ""contracts"" using interfaces. However, if I do this, a lot of the global data that many of the classes use turns into tramp data, passed from method to method until it gets to its intended user; this looks ugly, and is against my sensibilities, but ... can be mocked. Making a mixed bag class with a lot of static global properties is a more attractive option but not Rhino testable. Is there a middle ground between the two? Testable but not too trampy? Pattern perhaps?</p>

<p>You should also understand that these applications run on an in-house corporate developed platform, so there are a lot of helper classes and services that are instantiated once per application, and then are used throughout the application, for example a database accessor helper class. Another example is using configuration files that are read once, and used throughout the application by different methods for various reasons.</p>

<p>Your thoughts appreciated. Thanks - Old Man.</p>
","<c#><design-patterns><architecture><refactoring><rhino-mocks>","0","181","2010-08-17 20:54:50"
"3511115","rewrite small piece of python code","<p>I have lots of small pieces of code that look like:</p>

<pre><code>for it in &lt;iterable&gt;:
  if &lt;condition&gt;:
     return True/False
</code></pre>

<p>Is there a way I can rewrite this piece of code with a lambda expression ? I know I can factor it out in a small method/function, but I am looking for some lambda thing if it can be done.</p>
","<python><refactoring>","2","135","2010-08-18 10:32:27"
"3518972","Automatic refactoring tools?","<p>Is there a tool that will scan your code and suggest which refactoring to perform, based on duplicate code segments that it finds?</p>

<p>Let's say I'm specifically interested in C#/Java, but I'm open for tools in other languages as well.</p>
","<refactoring>","2","245","2010-08-19 05:29:24"
"3520023","How does Git track history during a refactoring?","<p>I understand well how Git can support file moves : as it uses file hash, a ""added"" file is easily detected as beeing same as the ""removed"" one.</p>

<p>My question is about refactoring : considering Java, the package declaration changes so the file content will NOT be the same. In such case, how does Git determine that the ""added"" file shares history with the ""removed"" one ? Does it check for ""most similar content"" assuming I only made minor changes, or similar non-deterministic solution ?</p>
","<git><refactoring><hash><dvcs>","9","910","2010-08-19 08:38:02"
"3530714","Visual Studio Refactor for vb.net","<p>why visual Studio Does not have Refactor tool for vb.net by default ?
but it has this tool for c#.
for example extract method and etc.
thanks all.</p>
","<vb.net><visual-studio-2010><refactoring>","4","1171","2010-08-20 12:14:17"
"3531947","If db query A does not return enough results, run query B: how to optimize?","<p>I am looking for a good design pattern, or best practice to achieve a situation of ""either this query, or else that other query"", with best performance and least overhead. </p>

<p>Business logic/program of demans says ""all items since Foo"", unless that returns less then three items, then ""all items"". 
I am refactoring the current code, and cannot come up with a good way to achieve this logic.</p>

<p>Current pseudo-code (Drupal/PHP):</p>

<pre><code>&lt;?php
$result = db_query(
'SELECT n.uid FROM og_ancestry oga ' .
'INNER JOIN node n on n.nid = oga.nid ' .
'WHERE oga.group_nid = %d AND n.created &gt; %d GROUP BY n.uid ' .
'ORDER BY cnt DESC LIMIT %d', $group_nid, $since, $limit);


while ($row = db_fetch_array($result)) {
  $uids[] = $row['uid'];
}

if (count($uids) &lt; 3) {
  $result = db_query(
    'SELECT n.uid FROM og_ancestry oga ' .
    'INNER JOIN node n on n.nid = oga.nid ' .
    'WHERE oga.group_nid = %d GROUP BY n.uid ' .
    'ORDER BY cnt DESC LIMIT %d', $group_nid, $limit);

  while ($row = db_fetch_array($result)) {
    $uids[] = $row['uid'];
  }
}
//...do something with the result.
?&gt;
</code></pre>

<p>This code feels ""not right"", first of all because of DRY: it contains the same query, with one minor difference. I can change that by a bit smarter query-building. </p>

<p>But worse is the fact that I need to hammer the database (query is quite heavy) only to find out that in more then half of the cases, I need to throw away the result and query the db again.</p>

<p>How would you approach such a case?</p>
","<php><mysql><refactoring>","5","139","2010-08-20 14:43:37"
"3538109","What is the cleanest way to extend this design for tree-rewriting?","<p>I have a tree of objects, where each object has a <code>std::vector</code> of pointers to its children. The class of the object has a <code>rewrite()</code> method that is recursively applied to alter the object and its children, typically with the following transformations, where <code>[N]</code> is the object being rewritten and <code>(M)</code> is the element that <code>rewrite()</code> returns:</p>

<pre>
                 (A)
 [A]             / \               [A]
 / \     -->    B   X               |    -->    (B)
B   C                \              B
                      C
</pre>

<p>What's the cleanest way of extending this setup to allow transformations like this?</p>

<pre>
    A             X
    |            / \
   [B]   -->    C   A
    |               |
    C              (Y)
</pre>

<p>That is, those that re-root the tree, move an element, insert a new element, and return the inserted element. I'm having a hard time coming up with something nice that also involves minimal refactoring. Thoughts?</p>
","<c++><refactoring><tree><rewrite>","0","81","2010-08-21 15:54:07"
"3538384","Error in liquibase table naming with hsqldb (in memory).Need a workaround","<p>I'm using liquibase on a project and i just realize what makes my build fails.i've successfully use command line generateChangeLog against the same schema in mysql and included that file in my master-change-log file.   </p>

<p>For test environment i use hsqldb.Now all the table name are hyphen separated apart from language.Since my build were failing i opened my mydb.script and all the hyphen separated Tables name were in capital but language looks like this </p>

<pre><code>CREATE MEMORY TABLE SOME_TABLE(ID BIGINT NOT NULL,OBJ_VESION INTEGER DEFAULT 0 NOT NULL,REQUESTER_PHONE VARCHAR(20),FORM_CODE VARCHAR(100),DATE_STARTED TIMESTAMP,DATE_ENDED TIMESTAMP,LAST_ACTIVITY TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,SOME_TABLE_STATUS VARCHAR(255),CONSTRAINT PK_INCOMING_MESSAGE_SESSION PRIMARY KEY(ID))  

CREATE MEMORY TABLE ""language""(ID BIGINT NOT NULL,CODE VARCHAR(10),NAME VARCHAR(50),DESCRIPTION VARCHAR(255),CONSTRAINT PK_LANGUAGE PRIMARY KEY(ID))
</code></pre>

<p>and in the change log file they look like this </p>

<pre><code>&lt;changeSet author=""highjo (generated)"" id=""1282409084036-10""&gt;
    &lt;createTable tableName=""some_table""&gt;
        &lt;column name=""id"" type=""BIGINT""&gt;
            &lt;constraints nullable=""false"" primaryKey=""true""/&gt;
        &lt;/column&gt;
        &lt;column defaultValueNumeric=""0"" name=""obj_vesion"" type=""INT""&gt;
            &lt;constraints nullable=""false""/&gt;
        &lt;/column&gt;
       &lt;!-- ... --&gt;
    &lt;/createTable&gt;
&lt;/changeSet&gt;
&lt;changeSet author=""highjo (generated)"" id=""1282409084036-11""&gt;
    &lt;createTable tableName=""language""&gt;
        &lt;column name=""id"" type=""BIGINT""&gt;
            &lt;constraints nullable=""false"" primaryKey=""true""/&gt;
        &lt;/column&gt;
        &lt;column name=""code"" type=""VARCHAR(10)""/&gt;
        &lt;!-- .... --&gt;
    &lt;/createTable&gt;
&lt;/changeSet&gt;
</code></pre>

<p>as you can notice they are all in small letters in the changelog file.I've tried changing in the change log language to capital, and in the script it is in capital just that it still has the double quote. :( </p>

<p>How it is possible to fix this? thanks for reading.</p>
","<java><refactoring><hsqldb><changeset><liquibase>","0","314","2010-08-21 17:54:37"
"3545544","How to refactor a class that is serialized in .NET?","<p>I have a C# class that is serialized to disk by the <a href=""http://msdn.microsoft.com/en-us/library/system.runtime.serialization.formatters.binary.binaryformatter(v=VS.100).aspx"" rel=""nofollow"">BinaryFormatter</a>, such as this example:</p>

<pre><code>// Version 3.0
[Serializable]
public class Person
{
    public string FullName;

    [OptionalField(VersionAdded=2)]
    public string NickName;
    [OptionalField(VersionAdded=2)]
    public DateTime BirthDate;

    [OptionalField(VersionAdded=3)]
    public int Weight;
}
</code></pre>

<p>Later, I want to refactor this class by one or more of the following<br>
- Change its name<br>
- Change its namespace<br>
- Move to another assembly  </p>

<p>As far as I can tell, the binary file can only be de-serialized if a class with the exact same name, namespace and assembly name is available. </p>

<p>How do I work around this?<br>
Is it possible to map the de-serialization to a different class name, namespace and assembly without breaking <a href=""http://msdn.microsoft.com/en-us/library/ms229752(VS.80).aspx"" rel=""nofollow"">Version Tolerant Serialization</a>?</p>
","<.net><serialization><refactoring><versioning><binaryformatter>","2","286","2010-08-23 07:37:40"
"3549902","type conversion for user defined classes","<p>I have a lot of classes which are basically equivalent, ie have almost the same functions in all respect.  Let's call them A and B. There are hundreds of methods that are using A and now due to code changes I have to change them to B. </p>

<p>Is there a way by which I can program a mapping between A and B such that I have minimal code changes?</p>
","<java><refactoring>","2","194","2010-08-23 17:06:33"
"3554041","Refactor to take either NameValueCollection and KeyValueConfigurationCollection as parameter?","<p>Example code :</p>

<p><strong>EDITED</strong> : clarified example. Sorry for any confusion. </p>

<pre><code>        using System.Collections.Specialized;
        using System.Configuration;

    ...

        // get collection 1

        NameValueCollection c1 = ConfigurationManager.AppSettings;

        // get collection 2

        ExeConfigurationFileMap map = new ExeConfigurationFileMap();
        map.ExeConfigFilename = ""c:\\SomeConfigFile.config"";
        Configuration config = ConfigurationManager.OpenMappedExeConfiguration(map, ConfigurationUserLevel.None);
        KeyValueConfigurationCollection c2 = config.AppSettings.Settings;

        // do something with collections

        DoSomethingWithCollection(c1);
        DoSomethingWithCollection(c2);
...

    private void DoSomethingWithCollection(KeyValueConfigurationCollection c)
    {
        foreach(KeyValueConfigurationElement el in c)
        {
            string key = el.Key;
            string val = el.Value;
            // do something with key and value
        }
    }

    private void DoSomethingWithCollection(NameValueCollection c)
    {
        for(int i=0; i &lt; c.Count; i++)
        {
            string key = c.GetKey(i);
            string val = c.Get(i);
            // do something with key and value
        }
    }
</code></pre>

<p>There are currently two versions of DoSomethingWithCollection to take either a NameValueCollection or KeyValueConfigurationCollection. </p>

<p>Is there a cleaner way of doing this, so that there is just one version of DoSomethingWithCollection  ? </p>

<p>Thanks.</p>
","<c#><.net><refactoring><.net-2.0>","2","476","2010-08-24 06:42:48"
"3554779","How to optimize/refactor such code?","<p>In the current project, there are lots of GetData() method, which
get different kind of data from hand written database at run time,
and set them in different fields in a class.
The projects then have such methods.</p>

<pre><code>void GetData(Datatype type, int&amp; value);
void GetData(Datatype type, double&amp; value);
void GetData(Datatype type, long&amp; value);
void GetData(Datatype type, longlong&amp; value);
....
</code></pre>

<p>There are lots of data types, so, these method are often called
with a switch with lots of branches.</p>

<pre><code>void GetData(Datatype type, int&amp; value)
{
     switch(type)
     {
       Type1:
        value = GetDataFromDB1(TYPE1);
        Type2:
              value = .. //get from different source
        ...

     }   
</code></pre>

<p>}</p>

<pre><code>void GetData(Datatype type, double&amp;　value)
....
</code></pre>

<p>As you see, the the GetData()s are classified according to the second param.
And within each single GetData(), there are lots of branches.
Is this a reasonable method to get data?</p>
","<c++><oop><optimization><refactoring>","2","201","2010-08-24 08:42:42"
"3554867","Refactoring advice and tools","<p>I have some code that consists of a lot (several hundreds of LOC) of uggly conditionals i.e.</p>

<pre><code>SomeClass someClass = null;

if(""foo"".equals(fooBar)) {
    // do something possibly involving more if-else statments
    // and possibly modify the someClass variable among others...
} else if(""bar"".equals(fooBar)) {
    // Same as above but with some slight variations
} else if(""baz"".equals(fooBar)) {
    // and yet again as above
} 
    //... lots of more else ifs
} else  {
    // and if nothing matches it is probably an error... 
    // so there is some error handling here
}

// Some code that acts on someClass
GenerateOutput(someClass);
</code></pre>

<p>Now I had the idea of refactoring this kind of code something along the lines of:</p>

<pre><code>abstract class CheckPerform&lt;S,T,Q&gt; {
    private CheckPerform&lt;T&gt; next;
    CheckPerform(CheckPerform&lt;T&gt; next) {
        this.next = next;
    }

    protected abstract T perform(S arg);
    protected abstract boolean check(Q toCheck);

    public T checkPerform(S arg, Q toCheck) {
        if(check(toCheck)) {
            return perform(arg);
        } 

        // Check if this CheckPerform is the last in the chain...
        return next == null ? null : next.checkPerform();
    }
}
</code></pre>

<p>And for each if statment generate a subclass of CheckPerform e.g.</p>

<pre><code>class CheckPerformFoo extends CheckPerform&lt;SomeInput, SomeClass, String&gt; {
    CheckPerformFoo(CheckPerform&lt;SomeInput, SomeClass, String&gt; next) {
        super(next);
    }

    protected boolean check(String toCheck) {
        // same check as in the if-statment with ""foo"" above""
        returs ""foo"".equals(toCheck);
    }

    protected SomeClass perform(SomeInput arg) {
        // Perform same actions (as in the ""foo"" if-statment) 
        // and return a SomeClass instance (that is in the 
        // same state as in the ""foo"" if-statment) 
    }
}
</code></pre>

<p>I could then inject the diffrent CheckPerforms into eachother so that the same order of checks are made and the corresponding actions taken. And in the original class I would only need to inject one CheckPerform object. Is this a valid approach to this type of problem? The number of classes in my project is likely to explode, but atleast I will get more modular and testable code. Should I do this some other way?</p>

<p>Since these if-else-if-...-else-if-else statments are what I would call a recurring theme of the code base I would like to do this refactoring as automagically as possible. So what tools could I use to automate this? </p>

<p>a) Some customizable refactoring feature hidden somewhere in an IDE that I have missed (either in Eclipse or IDEA preferably)
b) Some external tool that can parse Java code and give me fine grained control of transformations
c) Should I hack it myself using Scala?
d) Should I manually go over each class and do the refactoring using the features I am familiar with in my IDE?</p>

<p>Ideally the output of the refactoring should also include some basic test code template that I can run (preferably also test cases for the original code that can be run on both new and old as a kind of regression test... but that I leave for later).</p>

<p>Thanks for any input and suggestions!</p>
","<java><tools><refactoring>","1","143","2010-08-24 08:56:04"
"3558897","Can I DRY up these jQuery calls?","<p>Is there a way to DRY this jQuery up?</p>

<pre><code>&lt;script type=""text/javascript""&gt;
  $('form input#search').watermark('search...');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  $('form input#post_title').watermark('title');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  $('form input#post_tag_list').watermark('tag (separate tags with a comma)');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  $('form input#post_name').watermark('name (optional)');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  $('form input#post_email').watermark('email (optional)');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  $('form textarea#post_content').watermark('message');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  $('form input#comment_commenter').watermark('name (optional)');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  $('form input#comment_email').watermark('email (optional)');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  $('form textarea#comment_body').watermark('reply');
&lt;/script&gt;
&lt;script type=""text/javascript""&gt;
  jQuery(document).ready(function() {
    jQuery(""abbr.timeago"").timeago();
  });
&lt;/script&gt;
</code></pre>

<p>It seems awfully repetitive.</p>

<p>EDIT:
I added placeholder elements to all my forms. My app is HTML5 so it's okay. I used this code:</p>

<pre><code>&lt;script type=""text/javascript""&gt;
  jQuery(function(){
    jQuery(""abbr.timeago"").timeago();
    jQuery('form input, form textarea').each(
      function(){
        jThis = jQuery(this);
        jThis.watermark(jThis.attr('placeholder'));
      }
    }
  );
&lt;/script&gt;
</code></pre>

<p>Chrome renders the placeholders with or without JS, while FF 3.6.8 and Opera 10.61 show empty input/textarea boxes. Should I be using <code>$</code> instead of <code>jQuery(function(){...</code> ? Or does it matter?</p>

<p>note: I'm using jQuery 1.4.2</p>
","<jquery><refactoring><dry>","4","175","2010-08-24 16:53:44"
"3561659","How can I abstract out a repeating try catch pattern in C++","<p>I have a pattern that repeats for several member functions that looks like this:</p>

<pre><code>int myClass::abstract_one(int sig1)
{
  try {
    return _original-&gt;abstract_one(sig1);
  } catch (std::exception&amp; err) {
    handleException(err);
  } catch (...) {
    handleException();
  }
}

bool myClass::abstract_two(int sig2)
{
  try {
    return _original-&gt;abstract_two(sig2);
  } catch (std::exception&amp; err) {
    handleException(err);
  } catch (...) {
    handleException();
  }
}

[...]

int myClass::abstract_n(bool sig3a, short sig3b)
{
  try {
    return _original-&gt;abstract_n(sig3a, sig3b);
  } catch (std::exception&amp; err) {
    handleException(err);
  } catch (...) {
    handleException();
  }
}
</code></pre>

<p>Where abstract one through n are methods of a pure virtual abstract interface for which myClass and _original are concrete implementations.</p>

<p>I don't like that this pattern repeats in the code and would like to find a way to eliminate the repeating try / catch pattern and code as a single abstraction, but I can't think of a good way to do this in C++ without macros.  I would think that there is a way with templates to do this better.</p>

<p>Please suggest a clean way to refactor this code to abstract out the repeated pattern.</p>
","<c++><templates><refactoring>","12","444","2010-08-24 22:57:25"
"3563591","How should a size-limited stl-like container be implemented?","<p>While refactoring, I wanted to change an array where entries are added to an std::vector, but for compatibility (persistency, downgrading,...), it still needs to have an upper limit.<br>
What is the best way (elegant, stl-like, limited extra code) to have an stl-like container which is limited in size, so you know that inserting an entry fails?</p>

<p><strong>Edit</strong>:<br>
To clarify: I would like an stl-like container, that starts empty, that you can fill with entries and possibly remove entries and that iterate over the filled-in entries, but that doesn't allow to put in more than e.g. 50 entries, so almost like a sequential contrainer, but with an upper-limit.  </p>
","<c++><stl><refactoring>","2","337","2010-08-25 07:12:54"
"3569020","Refactoring a function definition","<p>I am using Pydev on Eclipse to write python code. I am new to Pydev and to Eclipse. I love the feature where by I can use rightClick -> Refactoring -> Rename... to rename a variable. </p>

<p>I was wondering if there is something similar to change a function everywhere in the project, if I change its definition.</p>

<p>For example, suppose I initially have:</p>

<pre><code>def myFunction(a, b):
    body of the function
    return blah
</code></pre>

<p>I use this function in other files of the project. Say, </p>

<pre><code>thisVar = myFunction(a, b)
</code></pre>

<p>Now I feel the need to change the function definition to account for an additional parameter.</p>

<pre><code>def myFunction(a, b, c):
    body of the function
    return blah
</code></pre>

<p>Is there something in eclipse or pydev such that it will automatically change</p>

<pre><code>thisVar = myFunction(a, b)
</code></pre>

<p>to</p>

<pre><code>thisVar = myFunction(a, b, c)
</code></pre>

<p>Thanks for your help.</p>
","<python><eclipse><refactoring><pydev>","0","278","2010-08-25 18:22:16"
"3573107","refactor my if statement code","<p>I've been messing with this bit of code for over an hour trying to rearrange it different ways. Is there any easier way to write it?</p>

<pre><code>   if x is not Number      ;// if x is string
   {
      if y is not Number      ;// x, y both strings
      {
         Eval(x)
         Eval(y)
         return
      }
      else                    ;// x is string, y is Number
      {
         Eval(x)
         Scale(y)
         return
      }
   }
   else if y is not Number    ;// x is Number, y is string
   {
      Scale(x)
      Eval(y)
      return
   }
   else                       ;// both are numbers
   {
      Scale(x)
      Scale(y)
      return   
   }
</code></pre>
","<refactoring><if-statement><pseudocode><refactor-my-code>","1","155","2010-08-26 07:59:17"
"3573399","Is it possible to use ""eval"" to define just one function (as opposed to one for each)?","<p>today, i am defining a set of variables in a hash that I use in various functions all over the model and the controller.</p>

<p>From the code below, you see that I am defining functions like get_stats, get_fans to target the exact variable. </p>

<p>My question is, would it be possible to define just one function? </p>

<p><strong>NOW:</strong></p>

<pre><code>REQ={:USER_STATS_IN_NETWORK =&gt;1 ,
     :FANS_IN_NETWORK =&gt; 2}


USER_STATS_IN_NETWORK_TYPE_ID =REQ[:USER_STATS_IN_NETWORK]
get_stats= some_function(params,USER_STATS_IN_NETWORK_TYPE_ID)


FANS_IN_NETWORK_TYPE_ID = REQ=[:FANS_IN_NETWORK_TYPE_ID]
get_fans= some_function(params,FANS_IN_NETWORK_TYPE_ID)

repeat for 10-over times...
</code></pre>

<p>** WANT TO ACHIEVE:**</p>

<pre><code>REQ={:USER_STATS_IN_NETWORK =&gt;1 ,
     :FANS_IN_NETWORK =&gt; 2}

#get_* =&gt; return some_function(:*) , without defining all of them explicitly
#example: get_user_stats =&gt; returns some_function(:USER_STATS_IN_NETWORK)
</code></pre>
","<ruby-on-rails><ruby><refactoring><eval>","2","141","2010-08-26 08:36:01"
"3573694","Mapping module imports in Python for easy refactoring","<p>I have a bunch of Python modules I want to clean up, reorganize and refactor (there's some duplicate code, some unused code ...), and I'm wondering if there's a tool to make a map of which module uses which other module.</p>

<p>Ideally, I'd like a map like this:</p>

<pre><code>main.py
 -&gt; task_runner.py
  -&gt; task_utils.py
  -&gt; deserialization.py
   -&gt; file_utils.py
 -&gt; server.py
  -&gt; (deserialization.py)
  -&gt; db_access.py

checkup_script.py
re_test.py
main_bkp0.py
unit_tests.py
</code></pre>

<p>... so that I could tell which files I can start moving around first (file_utils.py, db_access.py), which files are not used by my main.py and so could be deleted, etc. (I'm actually working with around 60 modules)</p>

<p>Writing a script that does this probably wouldn't be <em>very</em> complicated (though there are different syntaxes for import to handle), but I'd also expect that I'm not the first one to want to do this (and if someone made a tool for this, it might include other neat features such as telling me which classes and functions are probably not used).</p>

<p>Do you know of any tools (even simple scripts) that assist code reorganization?</p>

<p>Do you know of a more exact term for what I'm trying to do? Code reorganization?</p>
","<python><tools><refactoring><module><python-module>","5","216","2010-08-26 09:18:15"
"3576897","How should I restructure a large Perl script?","<p>I have a more or less large Perl script of ~ 1000 lines. The script accepts a few arguments and it runs straight forward. No modules, no functions. The script could be divided into three parts, initialization part, arguments parsing part and work part, but I don't know how to do that. Everything must be kept in a single file. Please, can anyone give me instructions/advice how to structure my Perl script?</p>

<p>Thanks.</p>
","<perl><refactoring><abstraction>","4","240","2010-08-26 15:52:25"
"3577685","Matching a function name","<p>I need a regex that matches all instances of a particular PHP function name in given a piece of code.</p>

<p>The regex should match <code>foo</code> in:</p>

<pre><code>foo(""qwe"");
function foo($param);
return foo();
</code></pre>

<p>An not match <code>foo</code> in:</p>

<pre><code>my_foo(""qwe"");
foo_bar();
""some foo string""
</code></pre>
","<php><regex><refactoring>","0","55","2010-08-26 17:22:32"
"3580872",".NET refactoring, DRY. dual inheritance, data access and separation of concerns","<p>Back story:</p>

<p>So I've been stuck on an architecture problem for the past couple of nights on a refactor I've been toying with.  Nothing important, but it's been bothering me.  It's actually an exercise in <a href=""http://en.wikipedia.org/wiki/Don%27t_repeat_yourself"" rel=""nofollow"">DRY</a>, and an attempt to take it to such an extreme as the DAL architecture is <em>completely</em> DRY.  It's a completely philosophical/theoretical exercise.</p>

<p>The code is based in part on one of <a href=""http://twitter.com/JohnMacIntyre"" rel=""nofollow"">@JohnMacIntyre</a>'s refactorings which I recently convinced him to blog about at <a href=""http://whileicompile.wordpress.com/2010/08/24/my-clean-code-experience-no-1/"" rel=""nofollow"">http://whileicompile.wordpress.com/2010/08/24/my-clean-code-experience-no-1/</a>.  I've modified the code slightly, as I tend to, in order to take the code one level further - usually, just to see what extra mileage I can get out of a concept... anyway, my reasons are largely irrelevant.</p>

<p>Part of my data access layer is based on the following architecture:</p>

<pre><code>abstract public class AppCommandBase : IDisposable { }
</code></pre>

<p>This contains basic stuff, like creation of a command object and cleanup after the AppCommand is disposed of.  All of my command base objects derive from this.</p>

<pre><code>abstract public class ReadCommandBase&lt;T, ResultT&gt; : AppCommandBase
</code></pre>

<p>This contains basic stuff that affects all read-commands - specifically in this case, reading data from tables and views.  No editing, no updating, no saving.</p>

<pre><code>abstract public class ReadItemCommandBase&lt;T, FilterT&gt; : ReadCommandBase&lt;T, T&gt; { }
</code></pre>

<p>This contains some more basic generic stuff - like definition of methods that will be required to read a single item from a table in the database, where the table name, key field name and field list names are defined as required abstract properties (to be defined by the derived class.</p>

<pre><code>public class MyTableReadItemCommand : ReadItemCommandBase&lt;MyTableClass, Int?&gt; { }
</code></pre>

<p>This contains specific properties that define my table name, the list of fields from the table or view, the name of the key field, a method to parse the data out of the IDataReader row into my business object and a method that initiates the whole process.</p>

<p>Now, I also have this structure for my ReadList...</p>

<pre><code>abstract public ReadListCommandBase&lt;T&gt; : ReadCommandBase&lt;T, IEnumerable&lt;T&gt;&gt; { }
public class MyTableReadListCommand : ReadListCommandBase&lt;MyTableClass&gt; { }
</code></pre>

<p>The difference being that the List classes contain properties that pertain to list generation (i.e. PageStart, PageSize, Sort and returns an IEnumerable) vs. return of a single DataObject (which just requires a filter that identifies a unique record).</p>

<p>Problem:</p>

<p>I'm hating that I've got a bunch of properties in my MyTableReadListCommand class that are identical in my MyTableReadItemCommand class.  I've thought about moving them to a helper class, but while that may centralize the member contents in one place, I'll still have identical members in each of the classes, that instead point to the helper class, which I still dislike.</p>

<p>My first thought was dual inheritance would solve this nicely, even though I agree that dual inheritance is usually a code smell - but it would solve this issue very elegantly.  So, given that .NET doesn't support dual inheritance, where do I go from here?</p>

<p>Perhaps a different refactor would be more suitable... but I'm having trouble wrapping my head around how to sidestep this problem.</p>

<p>If anyone needs a full code base to see what I'm harping on about, I've got a prototype solution on my DropBox at <a href=""http://dl.dropbox.com/u/3029830/Prototypes/Prototype%20-%20DAL%20Refactor.zip"" rel=""nofollow"">http://dl.dropbox.com/u/3029830/Prototypes/Prototype%20-%20DAL%20Refactor.zip</a>.  The code in question is in the DataAccessLayer project.</p>

<p>P.S. This isn't part of an ongoing active project, it's more a refactor puzzle for my own amusement.</p>

<p>Thanks in advance folks, I appreciate it.</p>
","<c#><oop><inheritance><refactoring><dry>","5","389","2010-08-27 02:10:40"
"3582885","Updating a codebase to meet standards","<p>If you've got a codebase which is a bit messy in respect to coding standards - a mix of different conventions from different people - is it reasonable to give one person the task of going through every file and bringing it up to meet standards?</p>

<p>As well as being tremendously dull, you're going to get a mass of changes in SVN (or whatever) which can make comparing versions harder. Is it sensible to set someone on the whole codebase, or is it considered stupid to touch a file <em>only</em> to make it meet standards? Should files be left alone until some 'real' change is needed, and then updated?</p>

<hr>

<p><em>Tagged as C++ since I think different languages have different automated tools for this.</em></p>
","<c++><refactoring><coding-style>","2","144","2010-08-27 09:32:31"
"3583032","validity of classic ASP include pattern","<p>Here is a pattern I am thinking about in ASP :</p>

<p>Imagine you have a file <strong>main.asp</strong> that contains</p>

<pre><code>&lt;!--#include file=""1.asp""--&gt;
</code></pre>

<p><strong>code of 1.asp</strong></p>

<pre><code>   ...my code...
</code></pre>

<p>Do you think it is valid to refactor this as</p>

<p><strong>main.asp</strong></p>

<pre><code>Dim defined_1_asp = false
&lt;!--#include file=""1.asp""--&gt;
</code></pre>

<p><strong>1.asp</strong></p>

<pre><code>if (not defined_1_asp) then
    defined_1_asp = true
    ...my code...
end if
</code></pre>

<p>This way I could refactor all my SSI includes while making sure they are executed only once. Of course, the content of the includes would be included, but execution would be protected by the if.</p>

<p>I read that the <strong><em>if</em></strong> statement does not have its own scope in classic ASP so it seems to me that the behavior of the code would not be impacted by the refactoring.</p>

<p>Would I hit a bottleneck if the same files are SSI-included several times ?</p>

<p>Thanks a lot for your help,</p>

<p>Jerome Wagner</p>
","<asp-classic><refactoring><server-side-includes>","0","209","2010-08-27 09:52:08"
"3585912","Merits of Bash Script v. Python Script for Shell-Command-Heavy Utility","<p>I need to write a script to do the following:</p>

<ol>
<li>Monitor a queuing system, which is accessible by shell commands.</li>
<li>Create directories from templates using a mix of inline text editing, cp/mv, command line scripts, and compiled c++ programs.</li>
<li>Check for error conditions.</li>
<li>Write files on error conditions.</li>
</ol>

<p>Note: 2D arrays would be mildly useful to my program, but I'm currently making due with several 1D arrays (due to the limitations of Bash script's arrays).</p>

<p>Those tasks all seems somewhat ""shell heavy"" in so much as it can easily be implemented with a bunch of shell commands, so I thought Bash scripting would be a natural way to go.  My results thus far have been good, but before I begin refactoring and finalizing my code, I was wondering whether it'd be better to port it to Python.  I've read in numerous places that Python is ""superior"" to bash.  I've done a bit of Python scripting and as far as I can tell, that's because it has more built in libraries and has support for object-oriented programming.  However, all the scripts I've seen using shell commands, such as this one:
<a href=""http://magazine.redhat.com/2008/02/07/python-for-bash-scripters-a-well-kept-secret/"" rel=""nofollow"">http://magazine.redhat.com/2008/02/07/python-for-bash-scripters-a-well-kept-secret/</a></p>

<p>Implement obnoxious syntax, like having to define commands as variables, like so:</p>

<pre><code>#You could add another bash command here
#HOLDING_SPOT=""""""fake_command""""""

#Determines Home Directory Usage in Gigs
HOMEDIR_USAGE = """"""
du -sh $HOME | cut -f1
""""""

#Determines IP Address
IPADDR = """"""
/sbin/ifconfig -a | awk '/(cast)/ { print $2 }' | cut -d':' -f2 | head -1
""""""
</code></pre>

<p>...and requiring wrapper functions and other fun.</p>

<p>Am I just being silly or does that seem less intuitive?  Is there a speed advantage for use with Python that would outweigh the simplicity advantage of Bash when it comes to shell script commands?  Or is the syntax of bash (no 2D arrays, brace/parentheses intricacies) reason to jump to Python?</p>
","<python><performance><bash><refactoring><shell>","3","696","2010-08-27 15:49:06"
"3592861","Adding a key only to a hash based on an if statement","<p>Typically, we define a hash as</p>

<pre><code>h={:a=&gt;val1, :b=&gt;val2}
</code></pre>

<p>However, i want to add a condition to only add in the key :b if val2 is not a nil value. Something like</p>

<pre><code>h={:a=&gt;val1}
h[:b]=val2 if val2
</code></pre>

<p>But can it be encapsulated in a single line?</p>
","<ruby><refactoring>","1","460","2010-08-28 23:10:56"
"3593580","Rails partial overloaded with logic needs refactor","<p>How would you refactor this logic filled partial?</p>

<pre><code>&lt;%- for post in @posts -%&gt;
  &lt;div class=""post""&gt;
    &lt;%= link_to post.title, post %&gt;

    &lt;%- if post.name.empty? -%&gt;

    &lt;%- else -%&gt;   
      &lt;span class=""name""&gt;
        by 
        &lt;%- if post.email.blank? -%&gt;
          &lt;%= post.name %&gt;
        &lt;%- else -%&gt;
          &lt;a href=""mailto:&lt;%= post.email %&gt;""&gt;&lt;%= post.name %&gt;&lt;/a&gt;
        &lt;%- end -%&gt;
      &lt;/span&gt;
    &lt;%- end -%&gt;

    &lt;span class=""time""&gt;
      active &amp;#32; &lt;%= timeago(post.updated_at) %&gt;
    &lt;/span&gt;

    &lt;%- if post.comments.empty? -%&gt;
      &lt;span class=""reply""&gt;
        &lt;%= link_to 'reply', :controller =&gt; 'posts', :action =&gt; 'show', :id =&gt; post %&gt;
      &lt;/span&gt;
    &lt;% else %&gt;
      &lt;span class=""reply""&gt;
        &lt;%= link_to pluralize(post.comments.count, 'reply'), :controller =&gt; 'posts', :action =&gt; 'show', :id =&gt; post %&gt;
      &lt;/span&gt;
    &lt;%- end -%&gt;

    &lt;p&gt;&lt;%= sanitize post.content,
 :tags =&gt; %w(a embed img object p param),
 :attributes =&gt; %w(allowfullscreen allowscriptaccess href name src type value) %&gt;&lt;/p&gt;

    &lt;%- unless controller.controller_name == ""tags"" -%&gt;
      &lt;%- unless post.tag_list.nil? || post.tag_list.empty? -%&gt;
        &lt;%- post.tags.each do |t| -%&gt;
          &lt;div class=""tag""&gt;&lt;%= link_to t.name.titleize, tag_path(t) %&gt;&lt;/div&gt;
        &lt;%- end -%&gt;
      &lt;%- end -%&gt;
    &lt;%- end -%&gt;

    &lt;%- unless post.comments.empty? -%&gt;
      &lt;div class=""comments""&gt;
        &lt;%= render :partial =&gt; post.firstcomments %&gt;
        &lt;%- if post.comments.count &gt;= 4 -%&gt;
          &lt;%= link_to 'more...', :action =&gt; 'show', :id =&gt; message %&gt;
        &lt;%- end -%&gt;
      &lt;/div&gt;
    &lt;%- end -%&gt;
  &lt;/div&gt;
&lt;%- end -%&gt;
</code></pre>

<p>Notes:
post.firstcomments just returns the 3 latest posts. 
Using Rails 3 and Ruby 1.9.2.
I haven't looked into the sanitize portion of the code, and I realize Rails 3 escapes everything by default, so it can safely be ignored for now unless someone knows how to convert it.</p>

<p>My models are clean and my controllers are decent but this partial is awful. It does what it needs to do but it takes up most of the rendering time when refreshing the page. Comments, suggestions and code are much appreciated. Thank you for reading my question.</p>
","<ruby-on-rails><refactoring><ruby-on-rails-3><partial-views><refactor-my-code>","0","129","2010-08-29 04:59:16"
"3618357","Code refactoring on bad system design","<p>I am a junior software engineer who've been given a task to take over a old system. This system has several problems, based on my preliminary assessment. </p>

<ol>
<li>spaghetti code</li>
<li>repetitive code</li>
<li>classes with 10k lines and above</li>
<li>misuse and over-logging using log4j </li>
<li>bad database table design</li>
<li>Missing source control -> I have setup Subversion for this</li>
<li>Missing documents -> I have no idea of the business rule, except to read the codes</li>
</ol>

<p>How should I go about it to enhance the quality of the system and resolve such issues? I can think of using static code analysis software to resolve any bad coding practice.</p>

<p>However, it can't detect any bad design issues or problems. How should I go about resolving these issues step by step?</p>
","<java><design><refactoring><legacy-code>","21","908","2010-09-01 13:11:46"
"3618581","Our code sucks and I'm powerless to fix it. Help!","<p>Our code sucks.  Actually, let me clarify that.  Our <em>old</em> code sucks.  It's difficult to debug and is full of abstractions that few people understand or even remember.  Just yesterday I spent an hour debugging in an area that I've worked for <strong>over a year</strong> and found myself thinking, ""Wow, this is really painful.""  It's not anyone's fault - I'm sure it all made perfect sense initially.  The worst part is usually It Just Works...provided you don't ask it to do anything outside of its comfort zone.</p>

<p>Our new code is pretty good.  I think we're doing a lot of good things there.  It's clear, consistent, and (hopefully) maintainable.  We've got a Hudson server running for continuous integration and we have the beginnings of a unit test suite in place.  The problem is our management is laser-focused on writing New Code.  There's no time to give Old Code (or even old New Code) the TLC it so desperately needs.  At any given moment our scrum backlog (for six developers) has about 140 items and around a dozen defects.  And those numbers aren't changing much.  We're adding things as fast as we can burn them down.</p>

<p>So what can I do to avoid the headaches of marathon debugging sessions mired in the depths of Old Code?  Every sprint is filled to the brim with new development and showstopper defects.  Specifically...</p>

<ul>
<li>What can I do to help maintenance and refactoring tasks get high enough priority to be worked?</li>
<li>Are there any C++-specific strategies you employ to help prevent New Code from rotting so quickly?</li>
</ul>
","<c++><unit-testing><refactoring><scrum><maintainability>","25","1348","2010-09-01 13:32:18"
"3621388","How to select/remove elements from a Dictionary<string, List<string>> based on some criteria","<p>I am trying to remove elements from a <code>Dictionary&lt;string, List&lt;string&gt;&gt;</code> in C# when the count of the <code>list&lt;string&gt;</code> is lesser than or equal to 1. 
I got some code working but it is not elegant and I have a gut feeling that this can be done elegantly in linq. </p>

<p>This is the code I have now</p>

<pre><code>        Dictionary&lt;string,List&lt;string&gt;&gt; FindAnagrams(List&lt;string&gt; dictionary)
        {
            Dictionary&lt;string, List&lt;string&gt;&gt; anagrams = new Dictionary&lt;string, List&lt;string&gt;&gt;();
            foreach (string word in dictionary)
            {
                char[] charArray=word.ToCharArray();
                Array.Sort(charArray);
                string sorted=new string(charArray);
                if (anagrams.ContainsKey(sorted))
                    anagrams[sorted].Add(word);
                else
                    anagrams.Add(sorted, new List&lt;string&gt;() { word });
            }
            List&lt;string&gt; nonAnagrams = new List&lt;string&gt;();
            foreach (var sorted in anagrams.Keys)
                if (anagrams[sorted].Count == 1)
                    nonAnagrams.Add(sorted);
            foreach(string word in nonAnagrams)
                anagrams.Remove(word);               
            return anagrams;
        }
</code></pre>

<p>Below is how far I got using linq but this ain't working.</p>

<pre><code>var realAna = from keys in anagrams.Keys
              where anagrams[keys].Count &gt;1
              select anagrams.values;
</code></pre>

<p>To put the problem in context I am trying to find anagrams from a dictionary, I consider a words as having anagrams if the <strong>sorted key has more than one value</strong> associated with it.</p>
","<c#><linq><string><refactoring>","1","514","2010-09-01 19:18:20"
"3623202","Code duplication refactoring tool for VB","<p>I need a very specific tool for VB (or multi-language). I thought I would ask if one already exists, before I start making one myself (probably, in python).</p>

<p>What I need:</p>

<ul>
<li>The tool must crawl, recursivelly or not, a path, searching for a list of extension, such as .bas, .frm, .xxx</li>
<li>Then, It has to parse that files, searching for functions, routines, etc.</li>
<li>And finally, it must output what it found. </li>
</ul>

<p>I based this on the idea of,  ""reducing code redundance"", in an scenario where, bad programmers make a lot of functions that do the same thing, sometimes with the same name, sometimes not. There are 4 cases:</p>

<ul>
<li>Case 1: Same name, Same content.</li>
<li>Case 2: Same name, Diff content.</li>
<li>Case 3: Diff name, Same content.</li>
<li>Case 4: Diff name, Diff Content.</li>
</ul>

<p>So, the output, should be something like this</p>

<pre><code>===========================================================================
RESULT
===========================================================================
Errors:
---------------------------------------------------------------------------
==Name, ==Content --&gt; 3: (Func(), Foo(), Bar()) In files (f,f2,f3)
!=Name, ==Content --&gt; 2: (Func() + Func1(), Bar() + Bar1()) In Files (f4)

---------------------------------------------------------------------------
Warnings:
==Name, !=Content --&gt; 1 (Foobar()) In Files (f19)

---------------------------------------------------------------------------
</code></pre>

<p>This is to give you an idea of what I need. </p>

<p>So, the question is: is there any tool that acomplish something similar to this???</p>

<p>P.S: Yes, we should write good code, in first instance, but, you know, stuff happens.</p>
","<refactoring><code-duplication>","2","178","2010-09-02 01:20:32"
"3625197","What's a good alternative, general name to the HibernateUtil class?","<p>I have a HibernateUtil class which is the standard by the book (<code>Hibernate in action</code>) class.<br>
It gets a session, flushes and closes it. begins,commits and rollbacks transactions and build the sessionFactory.<br>
Currently, by mistake, this is called HibernateSessionFactory in our package.<br>
I want to refactor it to a more appropriate name but the name HibernateUtil bothers me as I'd like to choose a more general name something like <code>PersistentManagerUtil</code>.<br>
Is there a good java convention or consensus about such a name?  </p>

<p><strong>EDIT</strong>
The reason I want to make it more general is that I want to minimilize the ""Exposure"" to the specific ORM implementation. Most of the public methods of the class have void as a return type so they do not return Hibernate classes/interfaces. The only exception to this is the getSession which returns an org.hibernate.Session. The reason I was thinking this direction is because I want to switch over to JPA and have hibernate as the implementation and so have a bit more freedom.
Why not change it to EntityManagerUtil? As in hibernate's docs they say EntityManager is equivelant to Session and that EntityManagerFactory is equivelant to HibernateSessionFactory.</p>

<p>Thanks in advance,<br>
Ittai </p>
","<java><hibernate><refactoring><naming-conventions>","0","255","2010-09-02 08:22:40"
"3625527","Bulk change HTML content using jQuery","<p>I have several <code>td</code>s, with ids = row[0], row[2] row[4] and so on.</p>

<pre><code>&lt;td id=""row[4]""&gt;02:45&lt;/td&gt;
&lt;td id=""row[6]""&gt;03:45&lt;/td&gt;
</code></pre>

<p>The content in these are times like 03:45, 04:45 which I want to change to 03:15, 04:15 etc. using jQuery.</p>

<p><strong>EDIT:</strong></p>

<p>I ended up with this:</p>

<pre><code> jQuery('td[id^=""row""]').each(function(){
    min = parseInt(jQuery(this).text().substr(3,2)) + 30;
    min %= 60;
    new_time = jQuery(this).text().substr(0,3) + min;
    jQuery(this).text(new_time);
  });
</code></pre>

<p>Is there a neater way to do this now ?</p>
","<javascript><jquery><refactoring>","1","285","2010-09-02 08:53:43"
"3629734","How should I refactor this?","<p>I would like to collect and store all this info into an array.</p>

<p>I have the following, how should I refactor this? </p>

<pre><code>require 'rubygems'
require 'nokogiri'
require 'open-uri'

@urls = %w{http://url_01.com http://url_02.com http://url_03.com}

@link_01_arr = []
@link_02_arr = []
@link_03_arr = []

link_01 = Nokogiri::HTML(open(""#{@urls[0]}""))
@link_01_arr[0] = link_01.at(""title"").inner_html
@link_01_arr[1] = link_01.at("".content"").inner_html
@link_01_arr[2] = link_01.at("".date"").inner_html
</code></pre>

<p>I tried doing this instead but it turned out significantly slower. i guess because there is more request this way.</p>

<pre><code>@urls = %w{http://url_01.com http://url_02.com http://url_03.com}

@titles_arr = @urls.map do |url|
  Nokogiri::HTML(open(url)).at(""title"").inner_html
end

@content_arr = @urls.map do |url|
  Nokogiri::HTML(open(url)).at("".content"").inner_html
end

@date_arr = @urls.map do |url|
  Nokogiri::HTML(open(url)).at("".date"").inner_html
end
</code></pre>
","<ruby><refactoring><nokogiri>","1","93","2010-09-02 17:48:44"
"3642718","Optimize javascript 1.2 for сompatibility with prototype 1.6","<p>I got this code, along with CMS 
when I try to add code using prototype 1.6
piece of code will be the first one and it will work
but second not work</p>

<p>this first piece </p>

<pre><code>&lt;script language=""JavaScript1.2""&gt;
var slidemenu_width='120px'
var slidemenu_reveal='11px'
var slidemenu_top='78px'

var ns4=document.layers?1:0
var ie4=document.all
var ns6=document.getElementById&amp;&amp;!document.all?1:0

if (ie4||ns6)
document.write('&lt;div id=""slidemenubar2"" style=""left:'+((parseInt(slidemenu_width)-parseInt(slidemenu_reveal))*-1)+'px; top:'+slidemenu_top+'; width:'+slidemenu_width+'"" onMouseover=""pull()"" onMouseout=""draw()""&gt;')
else if (ns4){
document.write('&lt;style&gt;\n#slidemenubar{\nwidth:'+slidemenu_width+';}\n&lt;\/style&gt;\n')
document.write('&lt;layer id=""slidemenubar"" left=0 top='+slidemenu_top+' width='+slidemenu_width+' onMouseover=""pull()"" onMouseout=""draw()"" visibility=hide&gt;')
}

var sitems=new Array()

///////////Edit below/////////////////////////////////

//siteitems[x]=[""Item Text"", ""Optional URL associated with text""]

sitems[0]=[""Tools"", ""cp.php?ac=magic&amp;view=me""]
sitems[1]=[""Presents"", ""gift.php?do=view""]


var target=""""

/////////////////////////////////////////////////////////

if (ie4||ns4||ns6){
for (i=0;i&lt;sitems.length;i++){
if (sitems[i][1])
document.write('&lt;a href=""'+sitems[i][1]+'"" target=""'+target+'""&gt;')
document.write(sitems[i][0])
if (sitems[i][1])
document.write('&lt;/a&gt;')
document.write('&lt;br/&gt;\n')
}
}

function regenerate(){
window.location.reload()
}
function regenerate2(){
if (ns4){
document.slidemenubar.left=((parseInt(slidemenu_width)-parseInt(slidemenu_reveal))*-1)
document.slidemenubar.visibility=""show""
setTimeout(""window.onresize=regenerate"",400)
}
}
window.onload=regenerate2

rightboundary=0
leftboundary=(parseInt(slidemenu_width)-parseInt(slidemenu_reveal))*-1

if (ie4||ns6){
document.write('&lt;/div&gt;')
themenu=(ns6)? document.getElementById(""slidemenubar2"").style : document.all.slidemenubar2.style
}
else if (ns4){
document.write('&lt;/layer&gt;')
themenu=document.layers.slidemenubar
}

function pull(){
if (window.drawit)
clearInterval(drawit)
pullit=setInterval(""pullengine()"",10)
}
function draw(){
clearInterval(pullit)
drawit=setInterval(""drawengine()"",10)
}
function pullengine(){
i    f ((ie4||ns6)&amp;&amp;parseInt(themenu.left)&lt;rightboundary){
themenu.left=parseInt(themenu.left)+10+""px"";
}
else if(ns4&amp;&amp;themenu.left&lt;rightboundary)
themenu.left+=10
else if (window.pullit){
themenu.left=0
clearInterval(pullit)
}
}

function drawengine(){
if ((ie4||ns6)&amp;&amp;parseInt(themenu.left)&gt;leftboundary){
themenu.left = parseInt(themenu.left)-10+""px"";
}
//themenu.left=parseInt(themenu.left)-10+""px""
else if(ns4&amp;&amp;themenu.left&gt;leftboundary)
themenu.left-=10
else if (window.drawit){
themenu.left=leftboundary
clearInterval(drawit)
}
}
&lt;/script&gt;
</code></pre>

<p>second peace is my code it use prototype</p>

<p>I think the problem of conflict versions js ?
How to alter the code to get rid javascript 1.2?</p>
","<javascript><refactoring><prototypejs>","0","83","2010-09-04 14:42:08"
"3647639","WCF client proxy class renaming problem","<p>Perhaps others have encountered the same problem.  It seems the default class name for a WCF client proxy is Service1Client.  When I delete the service reference and recreate it the name keeps coming up the same.  (Although it does give me the opportunity to name the namespace.)</p>

<p>When I chose Refactor/Rename on Service1Client (ie: the class name for the proxy), it fails with the following message:</p>

<p>The file 'Service References\myNameSpace\References.cs' could not be refactored.  The current object is autogenerated by the Wcf Client Generator and cannot be renamed.</p>
","<wcf><automated-refactoring>","1","248","2010-09-05 20:15:40"
"3651426","Why does IntelliJ delete my files when I do refactor? So I lost all my work","<p>I did right-click > refactor > move from the project menu, ""Move everything from .../../ to another directory"" > OK selected a different folder, and wham, all my data is gone.
I did a grep -r in the project tree to find it, and a find . -iname '<em>mydataas</em>' still nothing shows up. Its gone.</p>

<p>Why does Intellij do this?</p>
","<java><refactoring><intellij-idea>","0","177","2010-09-06 12:25:00"
"3664693","How to turn off file and folder refactoring in netbeans 6.9 or 7.0 beta 2","<p>i want to turn off annoying file refactoring as I have a php project and it is useless</p>

<p>If i click a folder and press f2 to rename that folder, it won't let me do it without going through the refactoring dialogue, which is buggy so that makes it worse.</p>

<p>For example when I hit ""do not refactor"" checkbox, the affirmative action button says ""preview""... what does that even mean?</p>

<p>And then to make matters worse, sometimes it refuses to rename a file or folder and I can't work out why.</p>

<p>Any ideas?</p>
","<php><netbeans><refactoring>","5","296","2010-09-08 04:44:33"
"3670806","Form_Load() 'event' or Override OnLoad()","<p>I would like someone to try and explain the difference between these.  More specifically, example usage scenario's.  </p>

<p>I am refactoring some <strong>Windows Form</strong> code and a <code>Form</code> has some code in the <code>Form_Load()</code> event and also in a <code>protected override void OnLoad()</code> event that calls <code>base.OnLoad(e);</code>  Now I traced it and the Override fires first and then immediately fires off the event version.</p>

<p>So, which one is typically used and why?  </p>

<p>Thanks,</p>
","<.net><winforms><events><refactoring><override>","7","782","2010-09-08 18:29:36"
"3676438","Can Resharper learn to recognize linked files when refactoring?","<p>Is it possible to make resharper include linked files when refactoring?</p>

<p>Consider a solution setup with the following projects:</p>

<pre><code>Backend
Services //Depends on 'Backend' and 'Services.Shared'
Services.Shared
Services.Shared.Silverlight //This project links all sourcecode in 'Services.Shared'
Frontend //Depends on 'Services.Shared' through 'Services.Shared.Silverlight'
</code></pre>

<p>When renaming a class in the 'Services.Shared' project, Resharper makes sure all is good and well in 'Services' and updates any references, but 'Frontend' which ""indirectly"" depends on 'Services.Shared', is not updated along with the refactoring.</p>

<p>Im aware that there is also problems with renaming of the file during refactor, since Resharper will rename the file in 'Services.Shared' making the link in 'Services.Shared.Silverlight' invalid.</p>

<p>But im wondering what people do, if anything at all, to make refactoring less painfull in this situation?</p>
","<refactoring><resharper>","3","81","2010-09-09 12:21:29"
"3680885","What are some useful emacs functions for refactoring?","<p>For now I've stuck with <code>multi-occur-in-matching-buffers</code> and <code>rgrep</code>, which, while powerful, is still pretty basic I guess.</p>

<p>Eventhough I realize anything more involved than matching a regexp and renaming will need to integrate with <code>CEDET's semantic bovinator</code>, I feel like there is still room for improvement here.</p>

<p>Built-in functions, packages, or custom-code what do you find helpful getting the job done ?</p>

<p>Cheers</p>
","<emacs><refactoring><elisp>","3","431","2010-09-09 21:59:29"
"3681000","How to refactor legacy code effectively and efficiently?","<blockquote>
  <p><strong>Possible Duplicates:</strong><br>
  <a href=""http://stackoverflow.com/questions/871238/what-should-i-keep-in-mind-in-order-to-refactor-huge-code-base"">What should I keep in mind in order to refactor huge code base?</a><br>
  <a href=""http://stackoverflow.com/questions/144734/when-is-it-good-if-ever-to-scrap-production-code-and-start-over"">When is it good (if ever) to scrap production code and start over?</a>  </p>
</blockquote>



<p>I am currently working with some legacy source code files. They have quite a few problems because they were written by a database expert who does not know much about Java. For instance,</p>

<ol>
<li>Fields in classes are public. No getters and setters.</li>
<li>Use raw types, not parameterized types.</li>
<li>Use <code>static</code> unnecessarily. </li>
<li>Super long method names.</li>
<li>Methods need too many parameters.</li>
<li>Repeat Yourself frequently.</li>
</ol>

<p>I want to modify them so that they are more object-oriented. What are some best practices and effective/efficient approaches?</p>
","<java><refactoring>","3","464","2010-09-09 22:25:18"
"3688656","How to Replace (and not just move) Conditional Logic with Strategy?","<p>In <a href=""http://www.informit.com/store/product.aspx?isbn=9780321213358&amp;aid=3B419801-6640-4A1F-A653-6CD00295FCDD"" rel=""nofollow"">Refactoring to Patterns</a> the author replaces the conditional logic by having the client use Loan factory methods where each uses the appropriate Strategy for the given arguments. However, I feel like it has passed the conditional logic code to the client, which must choose based on the arguments which Loan factory method to call. Isn't that moving rather than replacing?</p>

<p>The DP book hammers on the same illusion:</p>

<p>For example, without strategies, the code for breaking text into lines could look like</p>

<pre><code>void Composition::Repair () {
    switch (_breakingStrategy) {
    case SimpleStrategy:
        ComposeWithSimpleCompositor();
        break;
    case TeXStrategy:
        ComposeWithTeXCompositor();
        break;
    // ...
    }
    // merge results with existing composition, if necessary
}
</code></pre>

<p>The Strategy pattern eliminates this case statement by delegating the linebreaking task to a Strategy object:</p>

<pre><code>void Composition::Repair () {
    _compositor-&gt;Compose();
    // merge results with existing composition, if necessary
}
</code></pre>

<p>Yes, but how does one choose from which Strategy class to instantiate compositor? Conditional logic?
I see that if the context had a hieararcy, then the conditional logic would be even farther away, since each subclass could instantiate the appropriate Strategy, but that would have also applied to Composition::repair() where each subclass would directly call ComposeWithSimpleCompositor instead of 
ComposeWithTeXCompositor.</p>
","<design-patterns><refactoring>","2","376","2010-09-10 21:58:32"
"3696041","Refactor before or after ship?","<p>In a world where most ship dates are dictated by business needs, programmers usually ship code that works. Often, structure and efficiency of code being shipped become moot when you know code works. Unless production quality is specified (api to an algorithm for example), for code running into few hundred lines, shippable code equals code that works.</p>

<p>My question is this:  Give an ETA for a feature, would you code until feature works and be done? Or would you get it to work as quickly as possible and refactor for release quality? </p>

<p>My inclination is towards the latter though it sounds like more work. When code that works is taken apart for algorithmic efficiency and patterns, it is a joyful experience putting it all together. Besides, it gets all that non-functional love - less bugs, performant, extensible, secure.. I don't think I am good at writing the best code first time. So this approach works well for me.</p>

<p>I'd like to know which one is preferred and why? I am not looking for industry-wide approach, just individual propensities so I can gauge likeness of thought.</p>
","<language-agnostic><refactoring><shipping>","6","210","2010-09-12 18:37:29"
"3698424","Reasons for refactoring tools for C/C++ to be so limited","<p>What is the problem that no <strong>industrial level</strong> refactoring tool for C/C++ have been created, I only need a tool that ""just works""?</p>

<p>What I mean by ""industrial level"" is a quality provided by JetBrains products (IntelliJ, ReSharper), or above. Any available solutions (including Visual Assist from Tomato Software or <a href=""http://www.eclipse.org/cdt"" rel=""nofollow"">Eclipse CDT</a>) are not mature enough.</p>

<p>Below are advantages for a start-up to drive such a project.</p>

<ul>
<li> alleviation of C++ boring syntax (making development more fun);</li>
<li>C++ is evolving (0x version is coming hence a lot of work for such tool implementers);</li>
<li>marketing niche is broader than anything else (a lot of written C++ code, a lot of active C++ projects), even taking into account Web (HTML/JavaScript) projects;</li>
<li>C++ is chosen for system problems where each bug found by tool at compile time is a survival (a lot of corporations or governments should be interested in);</li>
<li>such tool can decrease project compilation time;</li>
</ul>

<p>The only drawback is technical challenges... but looking at what Google, Microsoft, Intel, etc. are doing, there should be no unsolvable technical problems. </p>

<ol>Lets summarize:
<li>it is possible to implement such product </li>
<li>it is enormously profitable </li>
<li>it doesn't exist</li>
</ol>

<p>No one wants make a profit? Collusion ;) ? Whats is the reason?</p>
","<c++><tools><refactoring><quality>","8","633","2010-09-13 07:12:33"
"3698669","Tutorial for speeding up SQL queries?","<p>Is there a good tutorial out there how to speed up/refactor SQL Queries? I googled a bit, but did not find anything useful.</p>

<p>Thanks :-)</p>
","<sql><tsql><optimization><refactoring>","0","90","2010-09-13 07:58:20"
"3702473","Defining a callback function for a given value","<p>In Java, is it possible to associate some object (i.e. a String) with a function to be called ?</p>

<p>I have two similar menus and both have a onClickListener with some code like this:</p>

<pre><code>if (item.id==0) {
 doSomeFunction(argument);
}
else if (item.id==1) {
 doSomeOtherFunction();
}
else if (item.id==2) {
 doStuff(arg2);
}
else {

}
</code></pre>

<p>I would just like to have an object (i.e. Hashtable) that would allow me to define associations between ""item.id"" -> ""code to execute"". </p>

<p>Example: </p>

<pre><code>0 -&gt; doSomeFunction(argument);
1 -&gt; doSomeOtherFunction();
2 -&gt; doStuff(arg2);
</code></pre>

<p>As a result I could skip these conditionals and just perform a function call of the function stored for a given item.id.</p>

<p>For example, with Lisp I could associate the item.id with a function and then use Lisp's ""funcall"" to call that function.</p>

<p>Is there a standard way to do something like this in Java?</p>

<p>Are there alternative solutions to skip the conditionals?</p>

<p>Please note that the called functions may need to receive parameters.</p>

<p>Thanks.</p>
","<java><android><refactoring><callback>","0","372","2010-09-13 16:38:53"
"3704280","proper C refactoring","<p>I have the following files: <code>a.h</code>, <code>a.c</code>, <code>b1.c</code>, <code>b2.c</code> and in both b1 and b2 I have some macro definitions which are identical.</p>

<p>Is it ok if I move them in <code>a.h</code> or is it more common to leave them in the file where they are being used ? Which way is the proper way to do it in C ?</p>
","<c><refactoring>","4","125","2010-09-13 20:46:58"
"3705515","Can CodeRush with Refactor Pro and CodeItRight co-exist?","<p>Does anyone know if these two products can coexist? 
Will these tools get in eachothers way?</p>
","<tools><refactoring><software-tools>","1","86","2010-09-14 01:10:44"
"3706463","Am I breaking the ""Law of Demeter""?","<p>I just recently became aware of the <a href=""http://en.wikipedia.org/wiki/Law_of_Demeter"" rel=""nofollow"">Law of Demeter</a>.</p>

<p>Like a lot of things, I realized that it was something that I was already doing but did not have a name for.  There are a few places though that I seem to violate it.</p>

<p>For example...</p>

<p>I might have an Address object:</p>

<pre><code>public class Address : IAddress
{
   public string StreetAddress { get; set; }
   public string City { get; set; }
   public int Zip { get; set; }
}
</code></pre>

<p>and a Customer object:</p>

<pre><code>public class Customer : ICustomer
{
   private IAddress address;

   Customer()
   {
      Address = null;
   }
   public string Name { get; set; }
   public IAddress
   {
      get
      {
         if (address == null)
         {
            address = new Address();
         }
         return address;
      }
      set
      {
         address = value;
      }
   }
}
</code></pre>

<p>Ok, this is fake code so you probably do not have to jump on me to use IoC to eliminate the <code>new Address()</code> or anything but it is pretty much an example of what I am doing.  I did not include the interfaces as I am hoping they are obvious.</p>

<p>I would then use it in my code for stuff like <code>int zip = customer.Address.Zip;</code> and <code>customer.Address.City = ""Vancouver"";</code></p>

<p>As I understand it, I am violating the Law of Demeter by manipulating details of Address from Customer.</p>

<p>Then again, it seems like the framework does as well.  After all, wouldn't address.City.Length be a violation?  Should I be adding methods to Address to handle accessing string properties?  Probably not.  So, why clutter up Address?</p>

<p>I cannot really just add methods to Address that relate only to customer.  I have Member, Employee, Dependent, Vendor, Employer, etc. objects that all have addresses too.</p>

<p>Is there a better way to handle this?  What kinds of problems am I risking if I use Address the way I am now?</p>

<p>For the Java folks, the Address class might look something more like the following if it helps:</p>

<pre><code>public class Address extends AddressInterface
{
   private String m_city;

   public String getCity() { return m_city; }
   public void setCity(String city) { m_city = city; }
}
</code></pre>

<p>I must admit that <code>customer.getAddress().setCity(""Vancouver"");</code> rings more alarms than <code>customer.Address.City = ""Vancouver"";</code> did for me.  Maybe I should switch to Java for a while.</p>
","<oop><refactoring><object>","9","361","2010-09-14 06:05:42"
"3713184","Effect of refactoring on program speed","<p>As a programmer I use to follow TDD, beginning by writing a simple version of my code then heavily refactoring it. When refactoring I usually just <em>listen to my code</em>. I search for <a href=""http://wiki.java.net/bin/view/People/SmellsToRefactorings"" rel=""nofollow"">bad smells and then refactor the code to remove smells</a>. Typically I will introduce new methods to avoid repeating code, move class members around to put them nearer to the point where they are used, try to avoid passing around too much parameters (solution may be to introduce new objects, or store some parameters in current object at instantiation time) and so on.</p>

<p>The rules I follow are designed to make code simpler, easier to read and to maintain. That is the main reason I'm doing all this.</p>

<p>But as a side effect, it also produce faster code, and from my first-hand experience that is especially true when I'm writing C++ code. It is less obvious when writing Python code, (my second most often used OO programming language), as the cost of introduction of new functions can be high in Python, but for C++ all I have to do is to make them inline. In the last few month I ported a large program from C to C++ and on the way it became both much simpler and much faster.</p>

<p>On the other hand I've often heard (and read) people arguing that OO programming is slower by design that non-OO programming. And I've heard that especially about C++.</p>

<p>What I wonder is what makes them say so, as it is so different from my personal experience.</p>

<p>I wonder about the methods and habits they have when writing OO code. Do they also use refactoring as I do, or may mostly follow design patterns, or heavily use STL ? And from where comes the slowness they perceive. What could they have done differently that would give them more speed have they not done it the Object Oriented way ?</p>

<p>Any feedback from OO programmers would be welcome either if they get more speed as I perceive I do, or the opposite they get slower code. Concrete examples would be most appreciated.</p>

<p><strong>EDIT</strong>: looking at first answers, I believe I have not been clear enough in my question. The question is not about is OO faster or slower than non-OO programming on theoretical ground. But from practical experience what kind of OO practises could lead to slower C++ code that equivalent programs writtent using C. My claim and personal experience is that Refactoring that I see as an OO practise (not as a definition of what OO is) makes programs faster. Comments on answers suggests that heavy use of iostreams would make C++ programs slower, but that should not generally be true for most of STL content. I have a strong feeling that over-engeeneering, abuse of UML design before coding or abuse of design patterns could lead to performance issues, but as it is not the pathes I'm following daily I have no first hand experience and may be completely wrong.</p>
","<c++><oop><optimization><refactoring><code-smell>","1","351","2010-09-14 21:50:05"
"3717420","Is there a benefit to using a return statement that returns nothing?","<p>I'm refactoring a large javascript document that I picked up from an open source project.  A number of functions use inconsistent return statements.  Here's a simple example of what I mean:</p>

<pre><code>var func = function(param) {
    if (!param) {
        return;
    }
    // do stuff
    return true;
}
</code></pre>

<p>Sometimes the functions return boolean, sometimes strings or other things.  Usually they are inconsistently paired with a simple <code>return;</code> statement inside of a conditional.</p>

<p>The problem is that the code is complex.  It is a parser that uses a multitude of unique RegEx matches, creates and destroys DOM nodes on the fly, etc.  Preliminary testing shows that, in the above example, I could change the <code>return;</code> statement to become <code>return false;</code>, but I'm concerned that I may not realize that it had a negative impact (i.e. some feature stopped working) on the script until much later.</p>

<p>So my questions:  Is there a benefit to using a blank return statement?  Could this have been intentionally coded this way or was it just lazy? Can I change them all to <code>return false;</code>, or <code>return null;</code> or do I need to dig through every call and find out what they are doing with the results of those functions?</p>
","<javascript><refactoring><return-value><inconsistency>","5","705","2010-09-15 12:08:36"
"3720174","How to remove CSS spaghetti in legacy web app?","<p>After working on several large web applications, and seeing gigantic style sheets with no clear structure, I'd really love to know if people have found ways to keep their css clean for large and complicated web apps. </p>

<p>How do you move from a legacy, mess of css to cleaned up, nicely cascading, DRY stylesheets?</p>

<p>The app I'm currently working on has 12000 lines of css. It's grown to this size organically as early on there were no standards or review of the css, the only rule was to make the app match the design. Some of the problems we constantly have:</p>

<ul>
<li><p>Conflicting styles: one developer adds a .header { font-weight: bold;} but .header was already used in other modules and shouldn't be bold in those.</p></li>
<li><p>Cascading problems: Foo widget has a .header but it also contains a list of Bar widgets with .header classes.</p>

<ul>
<li>If we define .foo .header { ... } and .bar .header { ... } anything not explicitly overwritten in foo will show up in bar.</li>
<li>If we define .foo > .header and .bar > .header but later need to modify foo to wrap header in a div, our styles break.</li>
</ul></li>
<li><p>Inheritance problems, we constantly redefine widget fonts to 11px/normal because some top container uses a 12px / 18 px line height.</p></li>
<li><p>Fighting against widget libraries, using libraries such as dojo/dijit or jquery ui that add tons of styles to be functional means that our code is littered with places where we have to override the library styles to get things looking just right. There are ~2000 lines of css just for tweaking the builtin dijit styles</p></li>
</ul>

<hr>

<p>We're at a point where we're thinking of implementing the following rules:</p>

<p><strong>Namespace all new widget classes</strong> - if you have a widget foo all sub-classnames will be .foo_ so we get: .foo, .foo_header, .foo_content, .foo_footer. This makes our css essentially FLAT, but we see no other way to organize our code going forward without running into the legacy styles or the cascading problems I mentioned above.</p>

<p><strong>Police generic styles</strong> - have a small handful of generic classes that are only to be applied in very specific situations. e.g. .editable - apply to portions of a sentence that should invoke an editor - should only contain text nodes.</p>

<p><strong>Leverage css compiler mixins</strong> To avoid repeatedly defining the same styles in different widgets, define and use mixins. Although we worry the mixins will get out of control too.</p>

<p>How else can we move from css mess that constantly introduces regressions to something maintainable going forward.</p>
","<css><web-applications><refactoring><legacy>","6","270","2010-09-15 17:33:48"
"3723716","Is there a more modern, OO version of ""Let's Build a Compiler""?","<p>Is there a more modern, maybe object-oriented, equivalent to Jack Crenshaw's ""<a href=""http://compilers.iecc.com/crenshaw/"" rel=""nofollow"">Let's Build a Compiler</a>"" series?</p>

<p>A while back I stumbled across ""<a href=""http://compilers.iecc.com/crenshaw/"" rel=""nofollow"">Let's Build a Compiler</a>"" and could just not resist writing some code.  I wrote a recursive-descent C compiler in C# that output .NET CIL.  ""Write once, leak everywhere"" was my slogan.</p>

<p>Too bad I did not realize until too late that parsing C is a nightmare.</p>

<p>I am now interested in writing a Java compiler in Java that outputs .NET CIL or assemblies with the goal of being self-bootstrapping.  I was hoping there might some newer tutorials kicking around.</p>

<p>As an aside, would you spend more time with up-front design or would you just write a ton of tests to support the ability to mercilessly refactor.  Thinking back, I am leaning towards the latter.  The compiler worked but the code was really awful.</p>
","<java><compiler><oop><refactoring><recursion>","26","1270","2010-09-16 04:30:10"
"3725565","Shortening this IF statement","<p>I don't like wide code, especially when it forces me to scroll.  So having written this:</p>

<pre><code>If _item.SubItems(pd.perioddate).Text = ""N/A"" Or _item.SubItems(pd.perioddate).Text = String.Empty Then
            dtpDeadlineforAP.Checked = False
End If
</code></pre>

<p>Is there a decent way to thin it down, make it more elegant?</p>
","<.net><vb.net><refactoring>","2","154","2010-09-16 10:03:20"
"3733871","Rails Paperclip 'class methods' and validations refactor?","<p>I've been breaking the DRY principle a bit in a project built with Paperclip for media storage. I've added assets to certain models, such as AlbumPhotoFile, AlbumSoundFile and so on, using the following code :</p>

<pre><code># Asset is a regular &lt; ActiveRecord::Base class 
class AlbumPhotoFile &lt; Asset
  has_attached_file :pic, :url =&gt; ""foo"", :path =&gt; ""bar""
  validates_attachment_presence :pic, :message =&gt; ""can't be blank""
  validates_attachment_content_type :pic, :content_type =&gt; [""foo"", ""bar""]
end
</code></pre>

<p>Scaling to some more requirements, I had to attach photos to other models, say CityPhotoFile. I want to keep the validations and has_attached_file fu the same as in other PhotoFile-type models. I have just copy-pasted the code from a PhotoFile model to the other, is there a better method for that ?</p>

<p>There aren't any Paperclip-related errors, the storage and display works fine, I just wanted to know if this type of operation can be put in a module or something like that, for DRY's sake.</p>

<p>Just bouncing off the code is really getting ugly. I can provide more details if I haven't made my intentions clear in this space :-).</p>

<p>Thank you in advance !</p>
","<ruby-on-rails><activerecord><refactoring><paperclip>","0","168","2010-09-17 08:47:15"
"3741744","Pulling Up Interface Implementation into base class","<p>I'm using a library which requires my views to implement an interface, which is only a dependency property and get\set accessor for it. The only difference is the OwnerType in the DP's Register method. AFAIK, duplicate code is bad, and I've forgotten to change OwnerType after pasting several times now :) So I figure I should try and move this up into the base class, and have it determine the type. After some messing around, I got it to work, by initializing it in the constructor, with GetType() to determine the type. The only problem is when the view gets destroyed, and gets recreated later which causes an ArgumentException that the DP is already registered.</p>

<ol>
<li>Is this refactoring a good idea?</li>
<li>Am I doing it right? :)</li>
<li>If 1 and 2 are true, how can I check if the DP is already registered?</li>
</ol>

<p>@Carl:
I'm not sure if the dependency properties ever were unregistered. I'm not even sure if dependency properties can be unregistered :)</p>

<p>Here was the original class, the code-behind of a xaml view (This and its base class are my creations):</p>

<pre><code>[ViewnameToViewLookupKeyMetadata(""StartView"", typeof (StartView))]
public partial class StartView : IWorkSpaceAware
{
   public EditorStartView()
   {
       InitializeComponent();
   }


   public static readonly DependencyProperty WorkSpaceContextualDataProperty =
       DependencyProperty.Register(""WorkSpaceContextualData"", typeof(object), typeof(StartView),
                                   new FrameworkPropertyMetadata((WorkspaceData)null));

   public WorkspaceData WorkSpaceContextualData
   {
       get { return (WorkspaceData) GetValue(WorkSpaceContextualDataProperty); }
       set { SetValue(WorkSpaceContextualDataProperty, value); }
   }
}
</code></pre>

<p>The metadata attribute simply associates a lookup string with a type.</p>

<p>I think it works because the register is only ever done once, when view is created the first time.</p>

<p>In the base class the Register seems to have to be in the constructor, so I can use GetType() as the OwnerType. So, when the view is created again, it tries to register again, causing the ArgumentException.</p>

<p>The interface is simple:</p>

<pre><code>public interface IWorkSpaceAware
{
    WorkspaceData WorkSpaceContextualData { get; set; }
}
</code></pre>

<p>Found Solution:</p>

<p>I changed the Register OwnerType to typeof(MyViewBase), and put the assignment back in the field.</p>
","<c#><refactoring><interface>","0","104","2010-09-18 12:47:23"
"3735589","Refactor $(document).ready(), currently have 2 instances","<p>I've got following JavaScript functions but want to refactor the $(document).ready() as I've got 2 instance of it. How can I achieve this?</p>

<pre><code>FlashMessenger = {
    init: function() {
        setTimeout(function() {
            $("".flash"").fadeOut(""slow"", function () {
                $("".flash"").remove();
            });
        }, 5000);
    }
}

SelectLanguage = {
    init: function() {
        $('#selectLanguageId').change(function() {
            $('#frmSelectLanguage').submit();
        });
    }
}

$(document).ready(FlashMessenger.init);
$(document).ready(SelectLanguage.init);
</code></pre>
","<javascript><jquery><refactoring>","3","217","2010-09-17 13:13:07"
"3736276","Is there any safe refactoring tool for .net (or at least c#)?","<p>I recently read Michael C. Feathers' book <code>Working effectively with legacy code</code> and came across the point where he mentioned a way to test the safety of automatic refactoring tools.</p>

<p>My question is: <strong>Are there any safe refactoring tools for the .net platform?</strong>; that means tools which only allow real refactorings and e.g. don't allow the <code>inline variable</code> refactoring on the <code>temp</code> variable in the following example, or at least show a warning that I am changing logic.</p>

<pre><code>class Program
{
    private static int _x;

    static void Main()
    {
        int temp = Test();
        for (int i = 0; i &lt; 10; ++i)
        {
            Console.WriteLine(temp);
        }
        Console.ReadKey();
    }


    private static int Test()
    {
        return ++_x;
    }
}
</code></pre>

<p>I've tested this example on the refactoring tools <code>Resharper</code> and <code>Coderush + Refactor pro</code> with the latest versions and both failed the test and allowed the refactoring to:</p>

<pre><code>class Program
{
    private static int _x;

    static void Main()
    {
        for (int i = 0; i &lt; 10; ++i)
        {
            Console.WriteLine(Test());
        }
        Console.ReadKey();
    }

    private static int Test()
    {
        return ++_x;
    }
}
</code></pre>
","<c#><.net><tools><refactoring><safe>","2","434","2010-09-17 14:36:26"
"3755698","How do I refactor this to reduce the number of java classes needed?","<p>I have the following two classes and I am starting to see a pattern that even with my little Java background is screaming for a fix.   Every new Object is going to require a set of Actions and the number of classes could grow out of hand.  How do I refactor this into a generic <code>DeleteAction</code> class?</p>

<p>I know some of the answers will be use Hibernate, or JPA, or some Framework, but at the moment I can't utilize any of those tools.   Oh, and our server only has jdk 1.4 (don't ask!). Thanks.</p>

<pre><code>public class DeleteCommitmentAction implements ControllerAction {

  public void service(HttpServletRequest request, HttpServletResponse response) throws ServletException {

    CommitmentListDAO clDAO = new CommitmentListDAO();
    CommitmentItemForm ciForm = new CommitmentItemForm(clDAO);
    CommitmentItem commitmentItem = ciForm.deleteCommitmentItem(request);

    RequestDispatcher view = request.getRequestDispatcher(""views/commitmentView_v.jsp"");
    view.forward(request, response);
  }
}
</code></pre>

<p>.</p>

<pre><code>public class DeleteProgramAction implements ControllerAction {

  public void service(HttpServletRequest request, HttpServletResponse response) throws ServletException {

    ProgramDAO prgDAO = new ProgramDAO();
    ProgramForm prgForm = new ProgramForm(prgDAO); 
    ProgramForm prg = prgForm.deleteProgram(request);

    RequestDispatcher view = request.getRequestDispatcher(""views/programView_v.jsp"");
    view.forward(request, response);
  }
}
</code></pre>

<p>The approach that I think I need to take is to make interfaces.  Starting with the DAO, I have created the following interface.</p>

<pre><code>public interface GenericDao {
  public void create(Object object, STKUser authenticatedUser) throws DAOException;
  public void retreive(String id, STKUser authenticatedUser) throws DAOException;
  public void update( final Object object, STKUser authenticatedUser) throws DAOException;
  public void delete(String id, STKUser authenticatedUser) throws DAOException;
}
</code></pre>

<p>And then in my DeleteAction class I tried this </p>

<pre><code>GenericDao gDAO = new GenericDao();
</code></pre>

<p>but Eclipse is stating ""Cannot instantiate the type GenericDao""  So now I am lost.</p>

<p><strong>Update: Based on Péter Török's answer, here is what I have:</strong></p>

<p>This is the servlet specific for handling operations on Commitment Items:</p>

<pre><code>protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    String schema = General_IO.getSchemaPath(""TPQOT_463_COMMITMENT"", request.getServerName());
    CommitmentListDAO clDAO = new CommitmentListDAO();
    CommitmentItemForm ciForm = new CommitmentItemForm(clDAO);
    CommitmentItem commitmentItem = new CommitmentItem();

    // I think this is the Application Controller Strategy
    actionMap.put(null, new ListCommitmentsAction());
    actionMap.put(""list"", new ListCommitmentsAction());
    actionMap.put(""view"", new ViewCommitmentItemAction(schema));
    //actionMap.put(""delete"", new DeleteCommitmentAction(schema));
    // Change to the Generic DeleteAction and pass in the parameters
    actionMap.put(""delete"", new DeleteAction(ciForm, commitmentItem, schema,  ""views/commitmentDeleteConfirm_v.jsp"",  ""views/commitmentView_v.jsp"" ));
    // When happy with this approach, change other actions to the Generic Versions.


    actionMap.put(""sqlConfirmDelete"", new DeleteCommitmentConfirmAction());
    actionMap.put(""edit"", new EditCommitmentItemAction(schema));
    actionMap.put(""sqlUpdate"", new UpdateCommitmentItemAction1(schema));
    actionMap.put(""new"", new NewCommitmentFormAction(schema));
    actionMap.put(""sqlInsert"", new InsertCommitmentItemAction1(schema));

    String op = request.getParameter(""method"");
    ControllerAction action = (ControllerAction) actionMap.get(op);

    if (action != null) {
        action.service(request, response);
    } else {
        String url = ""views/errorMessage_v.jsp"";
        String errMessage = ""Operation '"" + op + ""' not a valid for in '"" + request.getServletPath() + ""' !!"";
        request.setAttribute(""message"", errMessage);
        request.getRequestDispatcher(url).forward(request, response);
    }
}
</code></pre>

<p>And here is the Generic DeleteAction:</p>

<pre><code>public class DeleteAction implements ControllerAction {

  private Form form;
  private Object obj;
  private String schema = null;
  private String xPage;
  private String yPage;

  public DeleteAction(Form form, Object item, String schema, String yPage, String xPage) {
    this.form = form;
    this.item = item;  //passed in javabean??
    this.schema = schema;
    this.xPage = xPage;
    this.yPage = yPage;
  }

  public void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    item = form.delete(request);

    /* Database schema is described in xml files.
    Hash maps of field names, sizes, and titles; foreign key names, titles, 
    lookup tables; and primary keys information are used to dynamically 
    build HTML forms in the views.
    */      
    HashMap test = ReadTableSchema.returnSchema(schema);
    HashMap hshFields = (HashMap) test.get(""hshFields"");
    HashMap hshForeignKeys = (HashMap) test.get(""hshForeignKeys"");
    HashMap hshPrimaryKeys = (HashMap) test.get(""hshPrimaryKeys"");

    request.setAttribute(""hshFields"", hshFields);
    request.setAttribute(""hshPrimaryKeys"", hshPrimaryKeys);
    request.setAttribute(""hshForeignKeys"", hshForeignKeys);

    request.setAttribute(""item"", item);
    request.setAttribute(""form"", form);
    request.setAttribute(""pageName"", ""Delete"");

    //Check for deletion authorization if successful forward to the confirmation page
    if (form.isSucces()) {
      request.setAttribute(""message"", ""Please confirm permanent deletion of the data below."");
      RequestDispatcher view = request.getRequestDispatcher(yPage);
      view.forward(request, response);
    } else {
      // Not authorized to delete the data so just re-display
      RequestDispatcher view = request.getRequestDispatcher(xPage);
      view.forward(request, response);
    }
  }
}
</code></pre>

<p>then here is the interface (right now just for delete) that will be used by all forms.</p>

<pre><code>public interface CRUD {
    public Object delete(HttpServletRequest request);
}
</code></pre>
","<java><web-applications><refactoring>","1","260","2010-09-20 21:34:41"
"3767077","Refactor my C# code : if-else statement and code repetition","<p>Given:</p>

<pre><code>private void UpdataFieldItems(List&lt;FieldItemBase&gt; existingFieldItems, List&lt;FieldItemBase&gt; selectedFieldItems)
    {
        List&lt;FieldItemBase&gt; newFieldItemsSelected;
        var fieldSelectionChanges = GetFieldSelectionChanges(out newFieldItemsSelected);//retuns a Flagged enum

        if (Coding.EnumHas(fieldSelectionChanges, FieldSelectionChanges.AddedFieldItem))
        {
            StartEditMode();
            SetColumnDescriptorsToAdd(newFieldItemsSelected);
            UpdateItems(selectedFieldItems);

            SetColumnsToShow();
            CustomizeAlignmentAndCellFormatters(_tfaTableGrid.TableGrid);

            if (_tfaTableGrid.TableGrid.ColumnDescriptors.Count() &gt; 0)
            {
                SetAdditionalFirstGroupedColumn();
            }

            StopEditMode();
        }

        else if (Coding.EnumHas(fieldSelectionChanges, FieldSelectionChanges.Summary))
        {
            StartEditMode();

            UpdateItems(fieldItems);
            SetColumnsToShow();

            if (_tfaTableGrid.TableGrid.ColumnDescriptors.Count() &gt; 0)
            {
                SetAdditionalFirstGroupedColumn();
            }

            StopEditMode();

        }

        else if (Coding.EnumHas(fieldSelectionChanges, FieldSelectionChanges.Order) ||
                 Coding.EnumHas(fieldSelectionChanges, FieldSelectionChanges.AddedCustomFieldItem) ||
                 Coding.EnumHas(fieldSelectionChanges, FieldSelectionChanges.RemovedItem))
        {
            UpdateItems(fieldItems);
            SetColumnsToShow();

        }
            Invalidate();
    }

//Coding.cs
public static bool EnumHas(FieldSelectionChanges selectionChanges, FieldSelectionChanges valueToCheck)
        {
            return (selectionChanges &amp; valueToCheck) == valueToCheck;
        }
</code></pre>

<p>I am willing to refactor the above code.
There are two things that i don't like about the code above:</p>

<p>1) Writing same method calls in different cases, its not being possible to pull out the common method calls from these cases.</p>

<p>2) The readability of this code is very bad. It would be very confusing to understand and debug, if later needed.</p>

<p>Can someone suggest a design pattern for this code? or some way to improve upon the above two concerns?</p>

<p>Thanks for your interest.</p>
","<c#><design-patterns><refactoring><refactor-my-code>","1","641","2010-09-22 07:17:34"
"3767659","How to refactor conditional logic in javascript?","<p>I inherited a largish JavaScript (MooTools) application for browsing and configuring products.</p>

<p>In it there's a function that tracks the products' configured state. Other functions are called depending on what state the product is in.</p>

<p>I extended it to add some new features, but have ended up with a mess of nested conditionals inside a big switch statement.</p>

<p>My question is, how do you refactor conditional logic? Is there a general (or JS specific) pattern / technique for tracking state?</p>

<p><strong>Update:</strong> here's a pseudo-version of the function to illustrate the problem:</p>

<pre><code>switchToVariation: function(link) {

  // set the variables      
  // before switch, set state    

  switch ( nextType ) {   
    case 'type1':
      if ( prevType == 'type1' ) {        
        if ( nextIsSameVariation ) {            
          // do stuff                                           
        } else {                                                                              
          if ( nextIsSomethingElse ) {              
            // do stuff
          }          
          // more stuff                      
        }
      } else {        
        // different stuff        
      }
      break;

    case 'type2':        
      if ( prevWasType1 ) {
        // stuff
      } else {
        if (nextIsSameStyle) {
          // stuff
        }
        // more stuff
      }    
      break;    

    default:                       
      // default stuff        
  }          

  // after switch, set state

}
</code></pre>
","<javascript><refactoring><conditional>","2","164","2010-09-22 08:51:26"
"3768552","Avoiding repetition when using callback functions and asynchronous requests","<p>I am writing some Javascript/jQuery code that requires me to make lots of requests to various APIs. I have come across this problem many times and this is just a basic example of one instance of it. </p>

<p>The code makes an asynchronous request to a server and then if a condition with the returned data is not met, the code makes another request. The second request has a callback that contains much of the same logic as its parent. I know that I am avoiding repetition by calling the <code>returnFunction</code> in each callback but is there a way to avoid this altogether?</p>

<pre><code>var container = [];

$.getJSON(""http://www.url.com/api/?callback=?"", 
{ data: ""mydata"" }, 
function(data) {
    if(!data.length) {
        // No results
    } else {

        // Put the results into an array
        $(data).each(function(k, v){
            container.push(v.some_data);
        });

        // If the query did not return enough results
        if(data.length &lt; limit) {
            var number_missing = limit - data.length;

            // Get some more results and append to the array
            myFunctionToGetSomethingElse(number_missing, function(response){

                // Add these results to the array
                $(response).each(function(k, v){
                    container.push(v.some_data);
                });

                // Do something with this data
                returnFunction(response);
            });

        } else {
            // Do something with the result
            returnFunction(data);
        }
    }
});
</code></pre>

<p>How would you recommend I avoid the repetition of the code inside the callbacks? Is this the only possible way?</p>
","<javascript><jquery><refactoring><callback>","1","220","2010-09-22 11:01:20"
"3772973","How to perform 'move field' refactoring on active-record models","<p>This is a fairly common refactoring, Martin Fowler calls it 'move field'. Given 3 models:</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_one :contact_details
  has_one :address
end

class ContactDetails &lt; ActiveRecord::Base
end

class Address &lt; ActiveRecord::Base
end
</code></pre>

<p>how do I refactor, including migration, the has_one address from Person to ContactDetails? Afterwards the models would look like:</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_one :contact_details
end

class ContactDetails &lt; ActiveRecord::Base
  has_one :address
end

class Address &lt; ActiveRecord::Base
end
</code></pre>
","<ruby-on-rails><activerecord><refactoring><migration><rails-migrations>","0","70","2010-09-22 19:39:24"
"3775416","What are the best practices for preventing SQL creep?","<p>I have a webapp written in PHP using a MySQL database backend. This question could just as easily apply to any language and application trying to use an SQL database and MVC OOP design.</p>

<p><strong>How do you keep your SQL code restricted to the Model?</strong></p>

<p>There's a rather longer story specific to my case behind the question.  As previously mentioned I'm working on a PHP/MySQL/AJAX website.  I designed it using OOP and MVC design principles - with a Model, View and Controller.  I managed to keep the view elements - such as markup and styling - restricted completely to the View and to make them reusable fairly easily.  I thought I had done the same with SQL code.  But as work has progressed, it's become pretty clear that the Model needs some serious refactoring.</p>

<p>The way I'd found to keep the SQL in the Model was to encapsulate every single SQL query in its own Query object.  And then when I needed to call some SQL in the View or Controller I would access the query through a factory.  No SQL code exists in the Controller or the View.</p>

<p>But this has become extraordinarily tedious.  I don't think I'm actually gaining anything by doing this and am spending far too much time creating queries with names like ""SelectIdsFromTableWhereUser"".  The factory for the queries is approaching thousands of lines.  A bit of searching in Eclipse has revealed that the vast majority of these queries are used in one or two places and never again.  Not good.</p>

<p>I know that in good MVC you want to keep the SQL completely separate from the Controller or the View.  But at this point, it seems to me like it would have been better to just place the SQL where it was needed in the code and not bother trying to bury it and database code deep in the Model.  These queries are only being used once, why bother encapsulating them?  </p>

<p>Is it that important to keep the SQL separate from Controller or the View?  What is gained by doing this?  What is lost by allowing it to spread?  How do you solve this problem?</p>

<p><strong>Edit</strong> Per request, here's a little more detail on my model.</p>

<p>There are two portions to it.  The Tables portion and the Queries portion.  The Tables portion holds the domain objects - mostly designed as wrappers around class objects that are exact analogues of the tables in the database.  For example, there might be a database table <code>Foo</code> that has fields <code>id</code>, <code>name</code>, and <code>type</code>.  There will be a Table object (<code>class FooTable</code>) that has an array with fields 'id', 'name' and 'type'.  It would look like this:</p>

<pre><code>class FooTable extends MySQLTable {
    private $id;
    private $data;
    private $statements;

    public function __construct($id, $data=NULL, $populate=false) {
         // Initialize the table with prepared statements to populate, update and insert.  Also,
         // initialize it with any data passed in from the $data object.
    }

    public function get($field) {}
    public function set($field, $value) {}
    public function populate() {}
    public function update() {}
    public function insert() {}
}
</code></pre>

<p>If there's a <code>fooBar</code> database table that has a one to many relation (one <code>Foo</code> many <code>Bars</code>) with fields <code>id</code>, <code>fooID</code>, and <code>bar</code> then there will be a <code>FooBar</code> Table object (<code>class FooBarTable</code>) which will look pretty much exactly the same as the above <code>FooTable</code>.</p>

<p>The <code>FooTable</code> and many <code>FooBarTable</code> objects will both be contained in the <code>Foo</code> object.  Give the <code>Foo</code> object factory an id to a <code>Foo</code> table and it populates itself with <code>Foo</code>'s data and all of its <code>Bar</code>s and their data.     </p>

<p>The Query objects are used for pulling out those <code>Foo</code> ids in the order they are needed.  So, if I want the <code>Foo</code> objects ordered by date, vote or name, I need a different query object to do it.  Or if I want to select all <code>Foo</code> objects that have a <code>Bar</code> in a certain range.  I need a query object.</p>

<p>Most of the time I use the Table objects (the wrappers, not the base tables) to interact with the database.  But when it comes to selecting which table objects, that's where the queries come in.</p>

<p>During original design I didn't think there would be too many queries and I thought they were going to be things that would see reuse.  Since there might be several places where I'd want the <code>Foo</code>s in date order.  But it hasn't worked out that way.  There are way more of them than anticipated and most of them are one offs, used once in some View or Command and then never again.  I also thought the queries might encapsulate fairly complex SQL and it would be good to have them as objects so that I would always be sure to give them the data they needed and it would be a relatively sanitized environment in which to test the SQL query itself.  But again, it didn't work out that way.  Most of them contain pretty simple SQL.</p>
","<mysql><mvc><design-patterns><language-agnostic><refactoring>","4","134","2010-09-23 04:16:25"
"3777016","Code refactoring","<p>I am about to starting to work on a project which involves refactoring and modifying existing code which is in c &amp; c++. The code is a bloated one and is in huge volume. Of course since the code needs to be modified, an understanding of the code has to be developed and in a very short span of time since we have some pretty time pressed project schedule. Can anyone please suggest any open source tools which will help in achieving the above. 
In short what I am looking for is tool which can:</p>

<ol>
<li>Reverse engineering tools which will help understand the design.</li>
<li>Sequence generator tools which will help draw sequences at run time(Most probably we will be able to run the code, but not in the initial stages atleast) or through code examination.</li>
<li>Good code browsing tools to study the existing code base.</li>
<li>Suitable tool which can auto refactor code with minimal efforts.</li>
</ol>

<p>Please do tell me about any experiences,preferences or favorites worth looknig out for.</p>

<p>[EDIT] Came up with a list of tools to help in above. Here's the list:</p>

<ol>
<li><p>Graphviz &amp; DOxygen<br>
Generate UML class diagrams from existing code base</p></li>
<li><p>Umlstudio (http://www.pragsoft.com/prod_umls.html)<br>
Creating an object model for your OO legacy code is the best approach to analysing, understanding and maintaining it. UMLStudio can automatically convert C++, Java, CORBA IDL, PHP 5, and Ada 95 code into OOA&amp;D notation faster than any other CASE tool. </p></li>
<li><p>codedrawer for C++(http://www.codedrawer.com/)<br>
The CodeDrawer converts source code to visual based diagrams. Class, struct, and any elements of source code can be shown diagrams. It also shows the logics of a fuction and a method. The CodeDrawer helps understand source code of your  project</p></li>
<li><p>Imagix for c, c++ &amp; java (http://www.imagix.com/)<br>
Reverse engineering and visualization of source code lead to improved program comprehension. Speeds: 
Learning Unfamiliar Code 
Change Impact Analysis 
Integrating Open Source Code 
Code Reuse 
Software Maintenance</p></li>
<li><p>agilej (http://www.agilej.com/)<br>
AgileJ StructureViews is a plug-in for the Eclipse Java IDE which generates highly customisable UML class diagrams on an industrial scale, ideal for agile development or exploration of any existing Java codebase.</p></li>
<li><p>MaintainJ (www.maintainj.com)<br>
If you can run the code base then MaintainJ generates UML sequence and class diagrams at runtime when you run a particular use case.</p></li>
<li><p>reverse engineering tool(http://www.neiljohan.com/projects/reverse/)<br>
Generates class diagrams and relations between classes from java source code.</p></li>
<li><p>source Insight  (www.sourceinsight.com)
Great source browsing software</p></li>
</ol>

<p>One more, Thanks to Steve Townsend<br>
Klocwork (http://www.klocwork.com/products/insight/architect-code-visualization/)</p>
","<c++><refactoring><automated-refactoring>","8","1067","2010-09-23 09:34:11"
"3783206","Rails: any way to refactor this ActiveRecord code?","<p>I have a piece of code that checks that a survey response picked by user to a survey question is in fact one of valid choices:</p>

<pre><code>Question.find_by_id(question_id).question_choices.all(:select =&gt; 'id').map {|x| x.id}.include?(user_choice_id)
</code></pre>

<p>Is there an easier way?
Thanks!</p>
","<ruby-on-rails><ruby><activerecord><refactoring>","1","69","2010-09-23 23:26:27"
"3787905","Refactoring in eclipse: how to add field,getter,setter to all implementations of an interface?","<p>how can I add a field, getter and setter to all implementations of MyInterface (in the current project or folder?)</p>
","<eclipse><refactoring>","2","431","2010-09-24 14:14:15"
"3787941","Refactoring of model for testing purpose","<p>I want to refactor my model so I can properly write a unit test for it. But I have some dependencies. Can anybody point me in the right direction how I can remove these dependencies?</p>

<pre><code>class Customer
{
    public function save(array $data, $id = NULL)
    {
        // create or update
        if (empty($id)) {
            $customer = new \Entities\Customer();
        } else {
            $customer = $this-&gt;findById((int) $id);
        }

        $birthday = new DateTime();
        list($day, $month, $year) = explode(""/"", $data['birthday']);
        $birthday-&gt;setDate($year, $month, $day);

        $customer-&gt;setFirstName($data['firstName']);
        $customer-&gt;setLastName($data['lastName']);
        $customer-&gt;setCompany($data['company']);
        $languageModel = new Application_Model_Language();
        $customer-&gt;setLanguage($languageModel-&gt;findById($data['language']));
        $resellerShopModel = new Application_Model_ResellerShop();
        $customer-&gt;setResellerShop($resellerShopModel-&gt;findById($data['resellerShop']));
        $customer-&gt;setEmail($data['email']);
        $customer-&gt;setPhone($data['phone']);
        $customer-&gt;setGender($data['gender']);
        $customer-&gt;setBirthday($birthday);
        $customer-&gt;setType($data['type']);
        $customerSectorModel = new Application_Model_CustomerSector();
        $customer-&gt;setSector($customerSectorModel-&gt;findById($data['sector']));
        $customerReferenceModel = new Application_Model_CustomerReference();
        $customer-&gt;setReference($customerReferenceModel-&gt;findById($data['reference']));
        if (isset($data['password'])) {
            $customer-&gt;setPassword($this-&gt;_hashPassword($data['password']));
        }

        return $customer;
    }
}
</code></pre>
","<php><refactoring><model><phpunit><doctrine2>","2","126","2010-09-24 14:17:02"
"3778778","Identifying repeated code within PHP project","<p>I have a single PHP file within a legacy project that is at least a few thousand lines long. It is predominantly separated up into a number of different conditional blocks by a switch statement with about 10 cases. Within each case there is what appears to be a very similar - if not exact duplicate - block of code. What methods are available for me identifying these blocks of code as being either the same - or close to the same - so I can abstract that code out and begin to refactor the entire file? I know this is possible in very manual terms (separate each case statement in the code into individual files and Diff) but i'm interested in what tools i could be using to speed this process up.</p>

<p>Thanks.</p>
","<php><refactoring><copy-paste><code-duplication>","11","242","2010-09-23 13:23:13"
"3779981","""Cosmetic"" clean-up of old, unknown code. Which steps, which order? How invasive?","<p>When I receive code I have not seen before to refactor it into some sane state, I normally fix ""cosmetic"" things  (like converting <code>StringTokenizers</code> to <code>String#split()</code>, replacing pre-1.2 collections by newer collections, making fields <code>final</code>, converting C-style arrays to Java-style arrays, ...) while reading the source code I have to get familiar with.</p>

<p>Are there many people using this strategy (maybe it is some kind of ""best practice"" I don't know?) or is this considered too dangerous, and not touching old code if it is not absolutely necessary is generally prefered? Or is it more common to combine the ""cosmetic cleanup"" step with the more invasive ""general refactoring"" step?</p>

<p>What are the common ""low-hanging fruits"" when doing ""cosmetic clean-up"" (vs. refactoring with more invasive changes)?</p>
","<java><collections><refactoring><legacy>","7","297","2010-09-23 15:34:47"
"3796812","Challenges of refactoring unit-tests to be maintainable and readable when dealing with List<T> objects","<p>In the book <a href=""http://artofunittesting.com/"" rel=""nofollow""><em>The Art of Unit Testing</em></a> it talks about wanting to create maintainable and readable unit tests. Around page 204 it mentions that one should try to avoid multiple asserts in one test and, perhaps compare objects with an overridden Equals method. This works great when we have only one object to compare the expected vs. actual results. However what if we have a list (or collection) of said objects.</p>

<p>Consider the test below. I have more than one assert. In fact, there are two separate loops calling asserts. In this case I will end up with 5 assertions. 2 to check the contents of one list exist in another, and 2 vice versa. The 5th comparing the number of elements in the lists.</p>

<p>If anyone has suggestions to improve this test, I'm all ears. I am using MSTest at the moment, though I replaced MSTest's Assert with NUnits for the fluent API (Assert.That). </p>

<p><strong>Current Refactored Code:</strong></p>

<pre><code>        [TestMethod]
#if !NUNIT 
        [HostType(""Moles"")]
#else
        [Moled]
#endif
        public void LoadCSVBillOfMaterials_WithCorrectCSVFile_ReturnsListOfCSVBillOfMaterialsThatMatchesInput()
        {
            //arrange object(s)            
            var filePath = ""Path Does Not Matter Because of Mole in File object"";
            string[] csvDataCorrectlyFormatted = { ""1000, 1, Alt 1, , TBD, 1, 10.0, Notes, , Description, 2.50, ,A"",
                                                   ""1001, 1, Alt 2, , TBD, 1, 10.0, Notes, , Description, 2.50, ,A"" };

            var materialsExpected = new List&lt;CSVMaterial&gt;();
            materialsExpected.Add(new CSVMaterial(""1000"", 1, ""Alt 1"", ""TBD"", 1m, 10.0m, ""Notes"", ""Description"", 2.50m,""A""));
            materialsExpected.Add(new CSVMaterial(""1001"", 1, ""Alt 2"", ""TBD"", 1m, 10.0m, ""Notes"", ""Description"", 2.50m,""A""));

            //by-pass actually hitting the file system and use in-memory representation of CSV file
            MFile.ReadAllLinesString = s =&gt; csvDataCorrectlyFormatted;

            //act on object(s)                        
            var materialsActual = modCSVImport.LoadCSVBillOfMaterials(filePath);

            //assert something happended            
            Assert.That(materialsActual.Count,Is.EqualTo(materialsExpected.Count));
            materialsExpected.ForEach((anExpectedMaterial) =&gt; Assert.That(materialsActual.Contains(anExpectedMaterial)));
            materialsActual.ForEach((anActualMaterial) =&gt; Assert.That(materialsExpected.Contains(anActualMaterial)));
        }
</code></pre>

<p><strong>Original Multi-Assert Unit-Test:</strong></p>

<pre><code> ...
            //1st element
            Assert.AreEqual(""1000"", materials[0].PartNumber);
            Assert.AreEqual(1, materials[0].SequentialItemNumber);
            Assert.AreEqual(""Alt 1"", materials[0].AltPartNumber);
            Assert.AreEqual(""TBD"", materials[0].VendorCode);
            Assert.AreEqual(1m, materials[0].Quantity);
            Assert.AreEqual(10.0m, materials[0].PartWeight);
            Assert.AreEqual(""Notes"", materials[0].PartNotes);
            Assert.AreEqual(""Description"", materials[0].PartDescription);
            Assert.AreEqual(2.50m, materials[0].UnitCost);
            Assert.AreEqual(""A"", materials[1].Revision);
            //2nd element
            Assert.AreEqual(""1001"", materials[1].PartNumber);
            Assert.AreEqual(1, materials[1].SequentialItemNumber);
            Assert.AreEqual(""Alt 2"", materials[1].AltPartNumber);
            Assert.AreEqual(""TBD"", materials[1].VendorCode);
            Assert.AreEqual(1m, materials[1].Quantity);
            Assert.AreEqual(10.0m, materials[1].PartWeight);
            Assert.AreEqual(""Notes"", materials[1].PartNotes);
            Assert.AreEqual(""Description"", materials[1].PartDescription);
            Assert.AreEqual(2.50m, materials[1].UnitCost);
            Assert.AreEqual(""A"", materials[1].Revision);
        }
</code></pre>
","<unit-testing><list><refactoring><code-readability><code-maintainability>","0","148","2010-09-26 06:22:38"
"3805516","Delphi: Maintainability Virtual vs Virtual Abstract","<p>I was writing a bunch of code a few months ago and now I'm adding stuff to it.  I realized I wrote a bunch of functions that descend from a class that has about 2/3rds of its functions abstract and the remaining 1/3rd virtual.  </p>

<p>I'm pretty much sick of seeing:</p>

<pre><code>function descendent.doSomething() : TList;
begin
   inherited;
end;
</code></pre>

<p>when I've got this for the base class:</p>

<pre><code>function descendent.doSomething() : TList;
begin
   result := nil;
end;
</code></pre>

<p>and would hate to wind up with:</p>

<pre><code>function descendent.doSomething() : TList;
begin

end;
</code></pre>

<p>and then wonder why something didn't work.</p>

<p>I like using abstract functions because the compiler will let you know if you're liable to get an abstract error because you didn't implement some functions. </p>

<p>My question is, because I'm still a relatively new Delphi programmer and I've never had to maintain anything 8 years hence, is it worth taking the time to <a href=""http://programmers.stackexchange.com/questions/6055/awesomest-programming-plant/6062#6062"">prune your code</a> in this manner (i.e. remove functions that just have inherited in them and change your base class functions from abstract to concrete)</p>
","<delphi><refactoring><coding-style><maintainability>","8","293","2010-09-27 15:52:56"
"3806977","Partial Mocking As Code Smell?","<p>Why is there so much hating going on about 'partial mocking' and the code that requires it?</p>

<p>Here's an (theoretical) example implementation:</p>

<pre><code>public ComplexResult1 operationA(Stimulus a) {
    {
        ...
        result = ...;
    }
    auditTheChange(a);
}
public ComplexResult2 operationB(Stimulus b) {
    {
        ...
        result = ...;
    }
    auditTheChange(b);
    return result;
}
void auditTheChange(Stimulus stim) {
    // do a bunch of stuff to record the change
    // and interact with another outside service
}
</code></pre>

<p>Now, in my understanding this is well refactored code.</p>

<p>If I want to UNIT test operationA and operationB, <em>and</em> ensure that auditing happens in each scenario, <em>but without</em> having to test the specifics of the audit code, I would use partial mocking.</p>

<p>What am I not seeing/understanding that causes so many projects (EasyMock, Mockito, etc.) to recommend refactoring?</p>
","<java><refactoring><mocking><partial-mocks>","4","459","2010-09-27 19:06:56"
"3809958","How to approach a function that has slightly different behavior when called the first time?","<p>This is a very general programming question that I just want to put out there and see if anyone has any thoughts on it. It shows up time and time again: I have a function <code>somefunction()</code> which is called a lot, but the very first time its called I want it to behave just a bit differently. Here's an example:</p>

<pre><code>first_time = true;
somefunction(){
  // bunch of code...
  if (first_time)
  {
    first_time = false;
    // do it this way...
  }
  else
  {
    // do it that way...
  }
  // bunch of code...
}
</code></pre>

<p>3 approaches come to mind: </p>

<ul>
<li><p>You can do as in the example above
where you the notion of ""first time""
is explicit. Usually the ""first time""
check is just a boolean check hence
its very cheap - but still, when you
are doing this in a timer that fires
off every few hundred milliseconds,
it feels hack-ish.</p></li>
<li><p>You duplicate the function and just change the few lines of code that need to be changed when its called the first time and call one function at the start and the other function every other time. Especially if the function is big this looks really ugly IMO.</p></li>
<li><p>You break up <code>somefunction()</code> and create separate functions for where the code is exactly the same. You then create wrapper functions for the first time and everytime else that utilize these smaller functions. I think this approach is best and is what I'm going to use in my situation involving a timer.</p></li>
</ul>

<p>Thoughts? Its my first time asking a general question like this and I hope it creates some interesting discussion :)</p>
","<function><refactoring><behavior><first-time>","1","68","2010-09-28 05:34:28"
"3801262","why doesn't my refactored ruby using inject work?","<p>I tried to do some refactoring to convert an each block into an inject, but it didn't work and I don't understand why. </p>

<p>Here's the code that works before refactoring:</p>

<pre><code>class String
  # Build the word profile for the given word. The word profile is an array of
  # 26 integers -- each integer is a count of the number of times each letter
  # appears in the word. 
  #
  def profile
    profile = Array.new(26) { 0 }
    self.downcase.split(//).each do |letter|
      # only process letters a-z
      profile[letter.ord - 'a'.ord] += 1 unless letter.ord &gt; 'z'.ord
    end
    profile
  end
end
</code></pre>

<p>and here's my refactor that doesn't work:</p>

<pre><code>class String
  # Build the word profile for the given word. The word profile is an array of
  # 26 integers -- each integer is a count of the number of times each letter
  # appears in the word. 
  #
  def profile
    self.downcase.split(//).inject(Array.new(26) {0}) do |profile, letter|
      # only process letters a-z
      profile[letter.ord - 'a'.ord] += 1 unless letter.ord &gt; 'z'.ord 
    end
  end
end
</code></pre>

<p>When I try and execute the refactored method I'm getting</p>

<pre><code>`block in profile': undefined method `[]=' for 1:Fixnum (NoMethodError)
</code></pre>

<p>If I understand that correctly, it's doesn't like the array reference operator on the profile object in my refactored version, which implies that the initialiser passed to inject isn't working. Is that understanding correct? And if so, why not?</p>

<p>Thanks!</p>
","<ruby><refactoring><inject>","3","82","2010-09-27 05:14:34"
"3826668","Which book should I buy? Working Effectively with Legacy Code or Refactoring: Improving the Design of Existing Code?","<p>I am working with a few programs in PHP 4, ASP classic and C# (.NET 2). They were all created by different people with different styles. None of them have any unit tests and there are very few comments. I would like to be able to effectively add new features to the code while refactoring small parts along the way and I am wondering which book to buy. </p>

<p>The two books that I have narrowed it down to are: 
<strong><a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">Refactoring: Improving the Design of Existing Code</a></strong> and <strong><a href=""http://rads.stackoverflow.com/amzn/click/0131177052"" rel=""nofollow"">Working Effectively with Legacy Code</a></strong>.</p>

<p><img src=""http://ecx.images-amazon.com/images/I/51RCXGPXQ8L._SL500_AA300_.jpg"" /> <strong>VS</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src=""http://ecx.images-amazon.com/images/I/51T4YZ3HieL.jpg"" width=""227"" /></p>

<p>Both books have gotten good reviews, but I was wondering if someone who has read them would suggest one over the other for my needs or if I should just go ahead and buy both (in that case, which one should I read first?). </p>
","<books><refactoring><legacy-code>","3","201","2010-09-29 23:38:41"
"3830534","How to protect yourself when refactoring non-regression tests?","<p>Are there specific techniques to consider when refactoring the non-regression tests?  The code is usually pretty simple, but it's obviously not included into the safety net of a test suite...</p>

<p>When building a non-regression test, I first ensure that it really exhibits the issue that I want to correct, of course.  But if I come back later to this test because I want to refactor it (e.g. I just added another very similar test), I usually can't put the code-under-test back in a state where it was exhibiting the first issue.  So I can't be sure that the test, once refactored, is still exercising the same paths in the code.</p>

<p>Are there specific techniques to deal with this issue, except being extra careful?</p>
","<testing><refactoring>","0","68","2010-09-30 12:39:56"
"3831400","How to avoid false positives using a mockist approach in unit tests?","<p>Since the datastructure of my application domain is becoming pretty complex as of late, I started reading up on mock objects. Soon a simple question came to my mind, but the answer has proven to be quite the headache so far. So here goes:</p>

<p>We have a class 'Foo' with 'bar' as one of its methods:</p>

<pre><code>class Foo {
    public String bar(int i){
        if(i == 1) return ""arrr!"";
    }
}
</code></pre>

<p>And we have a class Pirate calling Foo.bar(1); in one of its methods:</p>

<pre><code>class Pirate {
    public String yell(){
        Foo foo = new Foo();
        return foo.bar(1);
    }
</code></pre>

<p>Now we mock the Foo class  in the unit test of the Pirate class because Foo happens to have a plethora of other dependencies:</p>

<pre><code>@Test
public void returnsPirateString() {
    Pirate blackBeard = new Pirate();
    Foo fooMock = mock(Foo.class);
    fooMock.expectAndReturn(""bar"",1,""arrr!""); //expects 'bar' function to be called once and returns ""arrr!""
    assertEquals(blackBeard.yell(),""arrr!"");
}
</code></pre>

<p>What happens now, is that if we refactor method bar to return null instead of ""arrr!"", our test will keep running happily while our program does not work the way we want it to. This may result in a possible debugging nightmare.</p>

<p>Using a mockist approach instead of the classical testing approach to unit testing, most of the time all ""helper"" objects get mocked, and only the tested object remains unmocked, so the previously stated problem can occur quite often as well.</p>

<p>What can be done to prevent this problem while mocking? </p>
","<unit-testing><refactoring><mocking>","1","81","2010-09-30 14:13:21"
"3833831","StackOverflowError while Refactoring","<p>I'm trying to refactor a package name (pretty near the root of the project hierarchy), and I'm getting the following error (flash builder 4):</p>

<pre><code>A fatal error occurred while performing the refactoring

An unexpected exception occurred while creating a change object.  See the error log for more details.
</code></pre>

<p>The log file looks like this....</p>

<pre><code>!ENTRY org.eclipse.ltk.ui.refactoring 4 10000 2010-09-30 10:57:25.134
!MESSAGE Internal Error
!STACK 0
java.lang.reflect.InvocationTargetException
    at org.eclipse.jface.operation.ModalContext.run(ModalContext.java:421)
    at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.run(RefactoringWizardDialog2.java:330)
    at org.eclipse.ltk.ui.refactoring.RefactoringWizard.createChange(RefactoringWizard.java:583)
    at org.eclipse.ltk.ui.refactoring.RefactoringWizard.computeUserInputSuccessorPage(RefactoringWizard.java:422)
    at org.eclipse.ltk.ui.refactoring.UserInputWizardPage.computeSuccessorPage(UserInputWizardPage.java:74)
    at org.eclipse.ltk.ui.refactoring.UserInputWizardPage.getNextPage(UserInputWizardPage.java:114)
    at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.nextOrPreviewPressed(RefactoringWizardDialog2.java:495)
    at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.access$2(RefactoringWizardDialog2.java:492)
    at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2$1.widgetSelected(RefactoringWizardDialog2.java:691)
    at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:228)
    at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
    at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1003)
    at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3880)
    at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3473)
    at org.eclipse.jface.window.Window.runEventLoop(Window.java:825)
    at org.eclipse.jface.window.Window.open(Window.java:801)
    at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation$1.run(RefactoringWizardOpenOperation.java:143)
    at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:70)
    at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation.run(RefactoringWizardOpenOperation.java:155)
    at com.adobe.flexbuilder.as.editor.ui.navigator.FlexPackageExplorerRenameAction.renamePackage(FlexPackageExplorerRenameAction.java:171)
    at com.adobe.flexbuilder.as.editor.ui.navigator.FlexPackageExplorerRenameAction.run(FlexPackageExplorerRenameAction.java:143)
    at org.eclipse.ui.actions.BaseSelectionListenerAction.runWithEvent(BaseSelectionListenerAction.java:168)
    at org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:584)
    at org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:501)
    at org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:411)
    at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
    at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1003)
    at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3880)
    at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3473)
    at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2405)
    at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2369)
    at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2221)
    at org.eclipse.ui.internal.Workbench$5.run(Workbench.java:500)
    at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
    at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:493)
    at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)
    at com.adobe.flexbuilder.standalone.FlexBuilderApplication.start(FlexBuilderApplication.java:109)
    at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:194)
    at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
    at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
    at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:368)
    at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:179)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
    at java.lang.reflect.Method.invoke(Unknown Source)
    at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:559)
    at org.eclipse.equinox.launcher.Main.basicRun(Main.java:514)
    at org.eclipse.equinox.launcher.Main.run(Main.java:1311)
Caused by: java.lang.StackOverflowError
    at com.adobe.flexbuilder.codemodel.mxml.MXMLData$2.getMXMLVersion(MXMLData.java:501)
&lt;-- snipped 1022 additional identical lines..--&gt;
    at com.adobe.flexbuilder.codemodel.mxml.MXMLData$2.getMXMLVersion(MXMLData.java:501)
Root exception:
java.lang.StackOverflowError
    at com.adobe.flexbuilder.codemodel.mxml.MXMLData$2.getMXMLVersion(MXMLData.java:501)
&lt;-- snipped 1022 additional identical lines..--&gt;
    at com.adobe.flexbuilder.codemodel.mxml.MXMLData$2.getMXMLVersion(MXMLData.java:501)
</code></pre>

<p>Any ideas what is wrong...and what I can do to fix it ?  I queried google for it, and didn't turn up anything useful with the parameters I tried.</p>
","<flex><eclipse><refactoring>","4","783","2010-09-30 18:51:09"
"3838967","Can I automatically refactor an entire java project and rename uppercase method parameters to lowercase?","<p>I'm working in a java project where a big part of the code was written with a formatting style that I don't like (and is also non standard), namely all method parameters are in uppercase (and also all local variables).</p>

<p>On IntellJ I am able to use ""Analyze -> Inspect Code"" and actually find all occurrences of uppercase method parameters (over 1000).  </p>

<p>To fix one occurrence I can do ""refactor > rename parameter"" and it works fine (let's assume there is no overlapping).</p>

<p>Is there a way to automagically doing this refactor (e.g: rename method parameter starting with uppercase to same name starting with lowercase)?</p>
","<java><ide><refactoring><intellij-idea>","9","744","2010-10-01 12:07:52"
"3841934","Need help refactoring this Javascript if/else statement","<p>Here's my current if/else statement:</p>

<pre><code>var current_class = $(this).closest(""article"").attr(""class"")

if (current_class == 'opened')
{
  $(this).closest(""article"").removeClass('opened');
  $(this).closest(""article"").addClass('closed');
}
else
{
  $(this).closest(""article"").removeClass('closed');
  $(this).closest(""article"").addClass('opened');
}
</code></pre>

<p>Is there a shorter way to write all of that? Just seems...overweight. :)</p>
","<javascript><refactoring><if-statement>","1","157","2010-10-01 18:12:59"
"3845435","whats the best pattern for removing this duplication","<p>I have the following code I am trying to consolidate. (here are two examples) but with this repeated pattern of checking if fields are null then if they are different and if yes, then setting the new value into the old value.  </p>

<p>What is the best way to rewrite this to avoid duplication?</p>

<pre><code>if (String.IsNullOrEmpty(f.FirstName))
    {
    if (exisingPerson.FirstName != f.FirstName)
        {
        change = true;
        exisingPerson.FirstName = f.FirstName;
        }
    }

if (String.IsNullOrEmpty(f.LastName))
    {
    if (exisingPerson.LastName != f.LastName)
        {
        change = true;
        exisingPerson.LastName = f.LastName;
        }
    }
</code></pre>
","<c#><refactoring>","1","108","2010-10-02 11:23:04"
"3851094","Refactoring long statement in Python","<p>I have a very long conditional statement for deciding what action to take for a pair of variables a and b.</p>

<pre><code>action = 0 if (a==0) else 1 if (a&gt;1 and b==1) else 2 if (a==1 and b&gt;1) else 3 if (a&gt;1 and b&gt;1) else -1
</code></pre>

<p>While it is nice with the compactness (in lines;) ) of this statement, it must exist a more elegant way to do this?</p>
","<python><refactoring><if-statement><conditional>","1","193","2010-10-03 18:48:09"
"3855699","C# IDisposable object for entire class","<p>The project that I'm working on at the moment uses an IDisposable object in every method in a class. It has started getting tedious re-typing the using block at the start of every method, and was wondering if there was a way to specify a disposable variable for use in every method of the class?</p>

<pre><code>public static class ResourceItemRepository
{
    public static ResourceItem GetById(int id)
    {
        using (var db = DataContextFactory.Create&lt;TestDataContext&gt;())
        {
            // Code goes here...
        }
    }
    public static List&lt;ResourceItem&gt; GetInCateogry(int catId)
    {
        using (var db = DataContextFactory.Create&lt;TestDataContext&gt;())
        {
            // Code goes here...
        }
    }
    public static ResourceItem.Type GetType(int id)
    {
        using (var db = DataContextFactory.Create&lt;TestDataContext&gt;())
        {
            // Code goes here...
        }
    }
}
</code></pre>
","<c#><refactoring><using-statement><reusing-code>","2","181","2010-10-04 13:34:27"
"3855452","Generalizing / Refactoring the code","<p>My code is something like this :</p>

<pre><code>if(country == china)
{
getCNData();

}

else {
getDefaultDataForallCountries();

}
</code></pre>

<p>Now I need to add similar logic as CN for some other country say  US . The option available to me is to  add one more country check in if condition and make it like </p>

<pre><code>if(country ==china &amp;&amp; country==US){
getCNandUSData();

}

else {
getDefaultDataForallCountries();


}.
</code></pre>

<p>1) I am somehow not comfortable to go for this solution as this is not generic . What if tomorrow I need to have same CN logic applied to another country say france . Can you please suggest me how can I make my code better and more generic.</p>

<p>2) Also I am not comfortable with the naming conventions. If say I go with my approach of adding US in If condition , Should I refactor the class name and function name to getCNAndUSData () ?</p>

<p>I am not sure here of what is the correct way to deal with such existing code. 
Appreciate your comments.</p>
","<c++><refactoring>","2","171","2010-10-04 13:00:54"
"3855594","How can this IF statement code snippet be Refactored?","<p>I've read a lot of Refactoring literature as of late and a common theme I see in examples is the reduction of lots of IF statements. The below is a very simple code block that first checks to see if an email address is supplied and if so, then proceeds to validate the email address. I typically see a lot of this type of code which always looks a bit messy, especially if there are multiple variables.</p>

<pre><code>if (string.IsNullOrEmpty(email)) {

    throw new ApplicationException(""Email Address Required"");
}

else {

    if (!ValidationService.EmailAddressIsValid(email)) {
        throw new ApplicationException(""Invalid Email Address"");
    }

}
</code></pre>

<p>My question is, is this example perfectly acceptable? Does it smell? How might one refactor this snippet?</p>
","<c#><syntax><refactoring><code-review>","2","306","2010-10-04 13:21:31"
"3859270","What's the OO way of refactoring these two very similar classes in PHP?","<p>I have a class like the following:</p>

<pre><code>class DreamsImagesStore
{
  public $table = 'dreams_images';

  public function insertNewDreamImage($dream_id, $pid)
  {
    try {
      $values = array($dream_id, $pid);
      $sth = $this-&gt;dbh-&gt;prepare(""INSERT INTO {$this-&gt;table}
                                (dream_id, pid)
                                VALUES (?, ?)"");
      if($sth-&gt;execute($values)) {
        return true;
      }
    } catch(PDOException $e) {
      $this-&gt;errorLogger($e);
    }
  }
...
}
</code></pre>

<p>I'm going to be implementing a new class called InterestsImagesStore wherein the only differences between these classes will be the value of <code>$table</code>, <code>$dream_id</code> will be <code>$interest_id</code>, and <code>dream_id</code> in <code>SQL</code> will be <code>interest_id</code>.</p>

<p>I know there's a better way to do this, and I'll be implementing similar classes in the future which have such small differences.</p>

<p><strong>What's the best object-oriented way to refactor my code to avoid duplication and increase maintainability?</strong></p>
","<php><oop><refactoring><refactor-my-code>","5","120","2010-10-04 21:27:25"
"3857289","rule of thumb when coding large nested functional blocks","<p>I’ve been coding in c# for a while now and generally have a good idea about the rule of thumb for coding standards. I’ve been recently encourage by my colleges to adopt a results based approach to coding functional blocks rather than nesting blocks of logic and am seeking your advice. Below is an example of what I’m talking about, where the result of one situation is used to determine the code path rather than nesting. It’s been suggested that this approach is easier to read, especially if the result would require several layers of nesting, however I prefer to uses <a href=""http://www.codinghorror.com/blog/2007/03/curlys-law-do-one-thing.html"" rel=""nofollow"">Curly’s Law</a> and refactor methods and functions where nesting becomes to deep.</p>

<pre><code>private void MethodOne()
    {

        bool CarryOn = false;

        // first layer
        if (ValidationRuleOne() == true)
        {
            CarryOn = true;

        } else {

            CarryOn = false;
        }

        // second layer
        if (CarryOn) 
        {
            CarryOn = ValidationRuleTwo();

        } else {

            CarryOn = false;
        }

        // third layer
        if (CarryOn)
        {
            CarryOn = ValidationRuleThree();

        } else
        {

            CarryOn = false;
        }

    }
</code></pre>

<p>This approach just seems wrong to me as I would suggest that the method should be rewriten as ..</p>

<pre><code>        private void MethodOne()
    {



        // first layer
        if (ValidationRuleOne() == true)
        {

            // second layer
            if (ValidationRuleTwo() == true)
            {

                // third layer
                if (ValidationRuleThree() == true)
                {


                }

            }
        }

    }
</code></pre>

<p>If the nesting becomes too complex then I would suggest that the method/function structure needs to be rethought to group logical groups of functionality together into additional methods or functions are required?</p>

<p>Any thoughts greatly appreciated.</p>

<p>Regards, </p>

<p>Tim</p>
","<c#><refactoring>","4","188","2010-10-04 16:39:10"
"3858956","Eclipse/Java: Is there a way to move a field from one class to its helper class and update the references automatically?","<p>I'm working on code that's a bit of a mess right now and am doing a lot of refactoring.</p>

<p>Is there a way to move a field from one class to its helper class and update the references automatically?  The below chicken-scratch UML shows what I'm doing manually right now.  Class <code>C1</code> has private <code>field</code> and owns <code>Helper</code> before the refactoring.  After the refactoring, all references in <code>C1'</code> to <code>field</code> get changed to <code>helper.getField()</code> and <code>helper.setfield()</code> as appropriate.</p>

<p><img src=""http://i.stack.imgur.com/OxIqn.png"" alt=""UML Diagram""></p>

<p>I've used Eclipse's refactoring capabilities quite a bit, but I can't figure out a way to automate this.</p>

<p>For instance, ideally I would drag the private field/attribute/member from one class to another and hope that Eclipse asks me how I want to handle the unresolved references.  It offers no suggestions and breaks all of the references.</p>

<p>The operation that I've been repeating is to separate knowledge and behavior that doesn't really belong in the current class.  I'm moving attributes and behavior that references certain fields out of the original class into a new ""helper"" class.  </p>

<p>The first step in my refactoring is to move the attributes.  A reference to the helper class exists as a field in the class I'm refactoring from.  In order not to break the code during the refactoring, I think it would be nice if Eclipse offered to to generate getters and setters and update the references so that they use the getters/setters in the new class.</p>

<p>Thanks!</p>
","<java><eclipse><refactoring><automated-refactoring>","5","646","2010-10-04 20:42:12"
"3863336","optimising aggregates with and without a condition in ms sql","<p>I would like to get a sum from a column, with and without a condition. The code I have now is</p>

<pre><code>SELECT regular.id, regular.sum as regularsum, special.sum as specialsum FROM 
(SELECT Sum(stuff) as sum, id FROM table
 WHERE commonCondition = true
 GROUP BY id) as regular
INNER JOIN 
(SELECT Sum(stuff) as sum, id FROM table
 Where commonCondition = true AND specialCondition = true
 GROUP BY id) as special
ON regular.id = special.id
</code></pre>

<p>Which works, but seems very inefficient, not to mention ugly. the table is fairly large, so some optimisation would be welcome.</p>

<p>How can I write this in a better, more efficent way?</p>
","<sql><optimization><refactoring><aggregate><refactor-my-code>","1","70","2010-10-05 11:50:10"
"3870889","Refactoring: Getting rid of an optional variable for a function","<p>Here's the situation; below is a piece of PHP code which is frequently reused.</p>

<pre><code>if (! isset($_REQUEST['process_form'])
{
   // render form
   echo ""&lt;form&gt;"";
   // snipped

   // important bit! Remember which id we are processing
   echo ""&lt;input hidden='id' value='$id'&gt;"";

   // snipped
} else {
  // process the form
}
</code></pre>

<p>I wish to encapsulate this into a function, akin to</p>

<pre><code>  class ProcessForm() {
   function execute(array $request, $id) { };
  }
</code></pre>

<p>The issue here is; the $id parameter is only needed when rendering the form. When processing the form after a user input or through an AJAX handler, I don't need the $id at all. </p>

<p>How could I refactor to get rid of the optional variable $id?</p>
","<php><refactoring>","0","31","2010-10-06 08:56:37"
"3882280","Is there a ReSharper-like tool for C++ projects?","<p>I'm searching tool like ReSharper for  C++.  I want to  have a more flexible refactoring tool than Visual Assist. It is really really good but if there exists a tool like ReSharper for C++, I want to know the tool's name.</p>
","<c++><refactoring>","1","1739","2010-10-07 13:48:25"
"3883380","Namespace refactoring tool for Eclipse?","<p>I'm doing some housekeeping on some files, and I need to move some classes to a new namespace.  Currently I have to manually edit the files, but I was wondering if there's a more efficient way of doing this?</p>

<p>I heard about ReSharper for Visual Studio does what I need, but is there a similar tool for Eclipse?</p>
","<c++><eclipse><refactoring><namespaces><eclipse-plugin>","1","243","2010-10-07 15:44:19"
"3890450","How to detect useless Delphi units in the interface and implementation uses clauses?","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/881778/how-can-i-identify-and-get-rid-of-unused-units-in-the-uses-clause-in-delphi-7"">How can I identify and get rid of unused units in the &ldquo;uses clause&rdquo; in Delphi 7 ?</a>  </p>
</blockquote>



<p>Is there a wizard/tool to automatically detect all useless units?</p>

<p>If in the current unit I ""use classes"" but in practice I don't need it I can of course manually remove Classes. But how can I do this automatically for all units in a project? Is there a way different than ""delete one, try to compile, if succesful save""?</p>

<p>Of course often what happens is that you drop a component on the form, some units are added, you delete the component and the units are not removed.</p>

<p>Or I refactor code, I move some classes in another unit.</p>
","<delphi><refactoring>","2","277","2010-10-08 12:29:05"
"3893867","moving tables between databases","<p>For a bit fall cleaning, I am moving 25 tables between MySQL databases (different pieces of hardware).  This is not the WHOLE database, just 25 tables out of a few hundred...  These tables don't really belong in there, I won't go into why for NDA reasons.</p>

<p>Now, this is going to break a lot of code and sql queries.</p>

<p>What is the best way to go about doing this?</p>

<ol>
<li><p>Move them all over at once. </p></li>
<li><p>Move them over 1 by 1</p></li>
</ol>

<p>--</p>

<p>Moving them over all at once, is kind of nice.  Might be some outages and broken code that I missed, but moving them as a block is much faster, less time spent in pushing code out.</p>

<p>Moving them over one by one is kind of nice, less chance of big stuff breaking, but a LOT more time will be spent micromanaging the work, redundant work, and deploying.</p>

<p>Is it possible for me to mirror the tables between two databases for a while? A federated table perhaps?</p>

<p>--</p>

<p>Misc info: There are 25 tables are all related by content to each other.  </p>

<p>I cannot shutdown the databases for hours at a time, about 5 minutes of downtime would be acceptable.</p>

<p>--</p>

<p>What is the best way to go about moving all of this data and keeping the code, sql, and me in great shape?</p>

<p>Could I federate the tables as a way of replicating the tables to a new database?</p>

<p>-daniel</p>
","<mysql><database><database-design><refactoring><refactoring-databases>","1","295","2010-10-08 19:54:26"
"3895867","Dynamically checking the value of a radio button (refactoring question)","<p>I wrote this jsfiddle based largely on the example  <a href=""http://www.techiegyan.com/2008/07/09/using-jquery-check-boxes-and-radio-buttons/"" rel=""nofollow"">found here</a>. The example is over 2 years old so I was wondering if there is an easier way to check the value of a radio button than gobs of <code>if, elseif, else</code> statements. My values are going to be <code>disabled, both, footer, header</code> so with only four not too bad. I'm just trying to learn how to write better Javascript. </p>

<p>Html:</p>

<pre><code>&lt;input type=""radio"" name=""rdio"" value=""1"" checked=""checked"" /&gt; 1
&lt;input type=""radio"" name=""rdio"" value=""2"" /&gt; 2
&lt;input type=""radio"" name=""rdio"" value=""3"" /&gt; 3
&lt;div id=""div_1""&gt; Div 1 Content&lt;/div&gt;
&lt;div id=""div_2""&gt; Div 2 Content&lt;/div&gt;
&lt;div id=""div_3""&gt; Div 3 Content&lt;/div&gt;
</code></pre>

<p>Javascript:</p>

<pre><code>$('#div_1,#div_2,#div_3').css('display','none');
$(""input[name=rdio]"").change(function() {
    if ($(""input[name=rdio]:checked"").val() == '1') {
        $('#div_1').show();
        $('#div_2,#div_3').hide();

    }
    else if ($(""input[name='rdio']:checked"").val() == '2') {
        $('#div_2').show();
        $('#div_1,#div_3').hide();
    }
    else {
        $('#div_3').show();
        $('#div_2,#div_1').hide();
    }

    });
</code></pre>

<p>JSFiddle to play around with: <a href=""http://www.jsfiddle.net/bs54j/1/"" rel=""nofollow"" title=""http://www.jsfiddle.net/bs54j/1/"">http://www.jsfiddle.net/bs54j/1/</a></p>

<p><strong>UPDATE: To revise question</strong><br>
So I posted this before realizing what I would actually be doing so here is an updated fiddle with the actual code I'm using: <a href=""http://jsfiddle.net/BandonRandon/BsupQ/3/"" rel=""nofollow"">http://jsfiddle.net/BandonRandon/BsupQ/3/</a> </p>

<p>New Html:</p>

<pre><code>&lt;h2&gt; What to show? &lt;/h2&gt;
&lt;input type=""radio"" name=""show_custom_header_footer"" value=""disabled"" checked=""checked"" /&gt; Disabled
&lt;input type=""radio"" name=""show_custom_header_footer"" value=""both"" /&gt; Both
&lt;input type=""radio"" checked name=""show_custom_header_footer"" value=""header"" /&gt; Header
&lt;input type=""radio"" name=""show_custom_header_footer"" value=""footer"" /&gt; Footer
   &lt;div id=""header_footer_options""&gt;
       This is the main content div of all the options
       &lt;p id=""custom_header""&gt;Custom Header:&lt;br/&gt; &lt;textarea rows=""2"" cols=""100"" name=""custom_header""&gt; Custom Header Code&lt;/textarea&gt;&lt;/p&gt;

       &lt;p id=""custom_footer""&gt;Custom Footer:&lt;br/&gt; &lt;textarea rows=""2"" cols=""100"" name=""custom_footer""&gt;Custom Footer Code&lt;/textarea&gt;&lt;/p&gt;&lt;/div&gt;
</code></pre>

<p>New Javascript:</p>

<pre><code> //show hide custom header/footer depending on settings
$('#header_footer_options').hide();
//check status on change
$(""input[name='show_custom_header_footer']"").change(function() {
    if ($(""input[name='show_custom_header_footer']:checked"").val() == 'disabled') {
        $('#header_footer_options').fadeOut(500);
    }
    else if ($(""input[name='show_custom_header_footer']:checked"").val() == 'both') {

        $('#header_footer_options').fadeIn();
        $('#custom_header,#custom_footer').fadeIn();
    }
    else if ($(""input[name='show_custom_header_footer']:checked"").val() == 'header') {
        $('#header_footer_options').fadeIn();
        $('#custom_header').fadeIn();
        $('#custom_footer').hide();
    }
    else if ($(""input[name='show_custom_header_footer']:checked"").val() == 'footer') {
        $('#header_footer_options').fadeIn();
        $('#custom_footer').fadeIn();
        $('#custom_header').hide();

    }
    else {
        $('#header_footer_options').hide();
    }
});
//check status on page load
if ($(""input[name='show_custom_header_footer']:checked"").val() == 'disabled') {
    $('#header_footer_options').hide();
}
else if ($(""input[name='show_custom_header_footer']:checked"").val() == 'both') {

    $('#header_footer_options').show();
    $('#custom_header,#custom_footer').show();
}
else if ($(""input[name='show_custom_header_footer']:checked"").val() == 'header') {
    $('#header_footer_options').show();
    $('#custom_header').show();
    $('#custom_footer').hide();
}
else if ($(""input[name='show_custom_header_footer']:checked"").val() == 'footer') {
    $('#header_footer_options').show();
    $('#custom_footer').show();
    $('#custom_header').hide();

}
else {
    $('#header_footer_options').hide();
} 
</code></pre>

<p>Probably the biggest thing that needs to be refactored is the show/hide on load I feel like I have a ton of extra crap code in there. I'm not looking for a handout just a suggestion on how to make this work better/faster/stronger. </p>
","<javascript><jquery><refactoring><radio-button>","1","697","2010-10-09 05:51:31"
"3897683","Simplifying overly complicated LINQ query - queries","<pre><code>public partial class MembershipModule : BaseEntity&lt;MembershipModule&gt;
{
    /// &lt;summary&gt;
    /// Returns wheter a module is accessible
    /// &lt;/summary&gt;
    public static bool IsAccessible(MembershipModule module)
    {
        // In absence of a module, no security applies to the page
        if(module == null)
            return true;

        return module.IsAccessible();
    }

    /// &lt;summary&gt;
    /// Returns whether the module is accessible
    /// &lt;/summary&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public bool IsAccessible()
    {
        // Skip unnecessary querying
        if(!MembershipUser.Connected)
            return this.Enabled &amp;&amp; this.OfflineAccess;

        Guid accessGuid = MembershipAction.AccessGuid;

        // ModuleActions for this MembershipModule and the Access Action
        IQueryable&lt;MembershipModuleAction&gt; accessMA =
            from ma in LinqUtil.Context.MembershipModuleActions
            where ma.ModuleId.Equals(this.Id) &amp;&amp; ma.ActionId.Equals(accessGuid)
            select ma;

        // RolePrivileges that grant access on this MembershipModule for the Current MembershipUser
        IQueryable&lt;bool&gt; accessRP =
            from rp in LinqUtil.Context.MembershipRolePrivileges
            where accessMA.Contains(rp.MembershipModuleAction)
            select rp.MembershipRole.MembershipUsers.Contains(MembershipUser.Current);

        return this.Enabled &amp;&amp; (this.OfflineAccess || accessRP.ToList().FirstOrDefault());
    }

    /// &lt;summary&gt;
    /// Returns all accessible modules that can be accessed by the logged user
    /// &lt;/summary&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static IEnumerable&lt;MembershipModule&gt; GetAccesible()
    {
        // Skip unnecessary querying
        if(!MembershipUser.Connected)
            return LinqUtil.Context.MembershipModules.Where(m =&gt; m.Enabled &amp;&amp; m.OfflineAccess).ToList();

        Guid accessGuid = MembershipAction.AccessGuid;

        // ModuleActions for any MembershipModule with the Access Action
        IQueryable&lt;MembershipModuleAction&gt; accessMA =
            from ma in LinqUtil.Context.MembershipModuleActions
            where LinqUtil.Context.MembershipModules.Any(m =&gt; m.Enabled &amp;&amp; m.Id.Equals(ma.ModuleId)) &amp;&amp; ma.ActionId.Equals(accessGuid)
            select ma;

        // RolePrivileges that grant access on those MembershipModule for the Current MembershipUser
        IQueryable&lt;MembershipRolePrivilege&gt; accessRP =
            from rp in LinqUtil.Context.MembershipRolePrivileges
            where accessMA.Any(ma =&gt; rp.MembershipModuleAction.Id.Equals(ma.Id)) &amp;&amp; rp.MembershipRole.MembershipUsers.Any(u =&gt; u.Id.Equals(MembershipUser.Current.Id))
            select rp;

        // Accessible modules
        var modules =
            from m in LinqUtil.Context.MembershipModules
            where accessMA.Any(ma =&gt; ma.MembershipModule.Id.Equals(m.Id)) &amp;&amp; accessRP.Any(rp =&gt; rp.MembershipModuleAction.ModuleId.Equals(m.Id))
            select m;

        return modules.ToList();
    }

    /// &lt;summary&gt;
    /// Menu Items that can be displayed on the current web page
    /// &lt;/summary&gt;
    public static IEnumerable&lt;MembershipModule&gt; GetMenuItems(string uriPrefix)
    {
        IEnumerable&lt;MembershipModule&gt; list = GetAccesible();

        return list.Where(m =&gt; m.UriPrefix.Equals(uriPrefix) &amp;&amp; m.MenuItem).OrderBy(m =&gt; m.Position);
    }
}
</code></pre>

<p>This currently works, but for some reason I can't help but to think the code looks ugly (particularly the two very similar static and instance functions that get me the accessible pages</p>

<p>Any thoughts on how to refactor this to look more appealing?</p>

<p><strong>Bonus question:</strong></p>

<pre><code>Guid accessGuid = MembershipAction.AccessGuid;
</code></pre>

<p>Without using that line, and just calling <code>MembershipAction.AccessGuid</code> in my query, I get an error telling me something obscure:</p>

<blockquote>
  <p>Class member
  MembershipAction.AccessGuid is
  unmapped.</p>
</blockquote>

<p>The tricky parts comes here: in the static <code>GetAccessible()</code> function this doesn't happen. I can just add <code>MembershipAction.AccessGuid</code> to the query, but it's in the instance <code>IsAccessible()</code> function that I get this problem.</p>

<p>For the record, here's MembershipAction:</p>

<pre><code>public partial class MembershipAction : BaseEntity&lt;MembershipAction&gt;
{
    public const string AccessPrivilege = ""Access"";

    private static Guid accessGuid = Guid.Empty;
    public static Guid AccessGuid
    {
        get
        {
            if(accessGuid == Guid.Empty)
            {
                IQueryable&lt;Guid&gt; query = from a in LinqUtil.Context.MembershipActions
                                         where a.Name.Equals(AccessPrivilege)
                                         select a.Id;

                accessGuid = query.ToList().FirstOrDefault();
            }

            return accessGuid;
        }
    }
}
</code></pre>
","<c#><linq><query><refactoring>","1","239","2010-10-09 20:09:31"
"3901908","rails refactoring tips","<p>I have been building a large scale rails app and it has come time to refactor it.</p>

<p>What tips can you offer me, or resources can you point me to? I am especially interested in making my database calls more efficient.</p>
","<ruby-on-rails><database><refactoring>","1","100","2010-10-10 19:42:35"
"3905928","Some Serious SQL Query Optimization Needed (MySQL)","<p>Here's my current query:</p>

<pre><code>SELECT IFNULL(sum(open_for), 0) total, count(IF(open_for &gt; 0, 1, null)) wins, count(IF(open_for &lt; 0, 1, null)) losses FROM `sport_points` WHERE (sportable_id = 1 and sportable_type = 'Team' and game_time &gt; '2010-07-13 11:39:58 UTC'
</code></pre>

<p>It basically returns this aggregated data:</p>

<p>TEAM A</p>

<ul>
<li>open_for </li>
<li>total: 2000 </li>
<li>wins: 20 </li>
<li>losses: 12</li>
</ul>

<p>Now, imagine there are about 6 other columns in the table that I need execute separate queries to get all the column-specific aggregate data for one team.  For example:</p>

<pre><code>SELECT IFNULL(sum(FINAL_FOR), 0) total, count(IF(open_for &gt; 0, 1, null)) wins, count(IF(open_for &lt; 0, 1, null)) losses FROM `sport_points` WHERE (sportable_id = 1 and sportable_type = 'Team' and game_time &gt; '2010-07-13 11:39:58 UTC'
</code></pre>

<p>TEAM A</p>

<ul>
<li>final_for</li>
<li>total: 4000</li>
<li>wins: 40</li>
<li>losses: 18</li>
</ul>

<p>The problem with this approach is that I have to run about 6 separate queries for all the columns on well over 200 teams. It's a serious load problem.</p>

<p>Ideally, the query would return all the column-specific aggregate data for one team -- in one query.  It would look like this in the result:</p>

<p>TEAM A</p>

<ul>
<li>open_for_total </li>
<li>open_for_wins</li>
<li>open_for_losses </li>
<li>final_for_total</li>
<li>final_for_wins </li>
<li>final_for_losses</li>
</ul>

<p>...etc...</p>
","<mysql><refactoring>","0","77","2010-10-11 11:55:15"
"3909944","php refactoring and better coding for php?","<p>i have this process that is the heart of my app, that im creating, but for some reason i feel like its the worst way to do it(instinct) , and i wanted to see if thier is something wrong with this process, and am i approaching it in a bad way! p.s. the code works fine, just refactoring problem.</p>

<p>the process is:</p>

<p>users go to homepage, they see thier latest activities, by other site memebers(home.php),</p>

<pre><code> //function to bring the latest activities from database
   $results=function getUserUpdates($_SESSION['user_id'];


while($row = mysql_fetch_array($results))

      {
//another function to format the activities in a social stream
          echo formatUpdate($row['user_note'],$row['dt'],$row['picture'],$row['username'],$row['id'],$row['reply_id'],$row['reply_name'],$row['votes_up'],$row['votes_down']);


      }
</code></pre>

<p>i have put the function codes in pastie.</p>

<p>formatUpdate function <a href=""http://pastie.org/1213958"" rel=""nofollow"">http://pastie.org/1213958</a></p>

<p>getUserUpdates function <a href=""http://pastie.org/1213962"" rel=""nofollow"">http://pastie.org/1213962</a></p>

<p><strong>EDIT</strong> both functions are from different files they are included in home.php,
formatUpdate from functions.php
getUserUpdates from queries.php</p>
","<php><mysql><performance><refactoring><code-readability>","0","90","2010-10-11 21:02:53"
"3906204","Java source refactoring of 7000 references","<p>I have a huge problem. My supervisors want me to change a piece of java code which can effect whole project.  </p>

<p>I need to change the signature of the <code>void log(String)</code> method which should take two more arguments (<code>Class c, String methodName</code>).
Eclipse obtained 7000 references to that method and if i change it, the whole project will go down. It will take weeks for me to fix those stuff manually.</p>

<p>I need a refactoring tool that can help me to do this fast. (I believe that can be done fast by a appropriate factoring tool)<br>
I am using Eclipse. As far as I see, refactoring plugin of Eclipse is gonna be bitchy.<br>
Any suggestions/helps?</p>
","<java><tools><ide><source><automated-refactoring>","17","618","2010-10-11 12:34:28"
"3914481","Common refactoring pattern for Rails model","<p>Is there a pattern to refactor such a construct into a readable single line?</p>

<pre><code>def show_section
  @news = News.all_active
  @news = @news.where(:section =&gt; params[:section]) unless params[:section] == ""all""
  @news = @news.all
end
</code></pre>

<p>I use Rails 3 and Ruby 1.9.2</p>
","<ruby-on-rails><ruby><refactoring>","0","215","2010-10-12 12:08:58"
"3921341","Adding nameof to C# through backdoors","<p>Well, I am not alone who is being sick of magical strings which are constantly used just to do data binding -- see:</p>

<p><a href=""http://stackoverflow.com/questions/1329138/how-to-make-databinding-type-safe-and-support-refactoring"">http://stackoverflow.com/questions/1329138/how-to-make-databinding-type-safe-and-support-refactoring</a></p>

<p>However I am concerned with performance of this solution and much more typing -- each time you would like to use nameof you have to type a lambda. So I am thinking of more brute-force method -- writing a function nameof and external program, that will change each .cs file before it is compiled. </p>

<pre><code>public string nameof&lt;T&gt;(T obj,string name = null)
{
  return name;
}
</code></pre>

<p>You would use it this way</p>

<pre><code>nameof(the_object.MyProperty);
</code></pre>

<p>The key lies in external program helping nameof -- it would search for any call of the nameof, and simply replace</p>

<pre><code>nameof(X.Y.Z)
</code></pre>

<p>or</p>

<pre><code>nameof(X.Y.Z,""s"")
</code></pre>

<p>into</p>

<pre><code>nameof(X.Y.Z,""Z"")
</code></pre>

<p>My question is -- what limitations, pitfalls of this approach do you see? Or maybe .Net 5.0 with built-in nameof will be shipped next week, so it make no sense to start writing a program for it? ;-)</p>

<p>Thank you in advance for your thoughts, recommendations, and so on.</p>
","<c#><data-binding><refactoring>","1","134","2010-10-13 06:41:55"
"3924239","how to refactor a Delphi unit with 10000 lines with no documentation?","<p>I have been assigned the task to refactor a Delphi unit. Wow. 10000 lines of code, no documentation, tons of copy and paste code.</p>

<p>THere are many methods made with copy and paste that could be refactored, anyway I am lost in all those lines, I have the interface section where I can ""find my way"", but in general what do yuo suggest for tackling this kind of task?</p>

<p>Thanks.</p>
","<delphi><refactoring>","9","779","2010-10-13 13:33:38"
"3938287","Creating a SQL Server trigger to transition from a natural key to a surrogate key","<p><strong>Backstory</strong></p>

<p>At work where we're planning on deprecating a Natural Key column in one of our primary tables. The project consists of 100+ applications that link to this table/column; 400+ stored procedures that reference this column directly; and a vast array of common tables between these applications that also reference this column.</p>

<p>The Big Bang and Start from Scratch methods are out of the picture. We're going to deprecate this column one application at a time, certify the changes, and move on to the next... and we've got a lengthy target goal to make this effort practical.</p>

<p>The problem I have is that a lot of these applications have shared stored procedures and tables. If I completely convert all of Application A's tables/stored procedures Application B and C will be broken until converted. These in turn may break applications D, E, F...Etc. I've already got a strategy implemented for Code classes and Stored Procedures, the part I'm stuck on is the transitioning state of the database.</p>

<p>Here's a <strong>basic</strong> example of what we have:</p>

<pre><code>Users
---------------------------
Code          varchar(32) natural key

Access
---------------------------
UserCode      varchar(32) foreign key
AccessLevel   int
</code></pre>

<p>And we're aiming now just for transitional state like this:</p>

<pre><code>Users
---------------------------
Code          varchar(32) 
Id            int         surrogate key

Access
---------------------------
UserCode      varchar(32)   
UserID        int         foreign key      
AccessLevel   int
</code></pre>

<p>The idea being during the transitional phase un-migrated applications and stored procedures will still be able to access all the appropriate data and new ones can start pushing to the correct columns -- Once the migration is complete for all stored procedures and applications we can finally drop the extra columns.</p>

<p>I wanted to use SQL Server's triggers to automatically intercept any new Insert/Update's and do something like the following on each of the affected tables:</p>

<pre><code>CREATE TRIGGER tr_Access_Sync
ON Access
INSTEAD OF INSERT(, UPDATE)
AS
BEGIN
  DIM @code as Varchar(32)
  DIM @id as int

  SET @code = (SELECT inserted.code FROM inserted)
  SET @id = (SELECT inserted.code FROM inserted)

  -- This is a migrated application; find the appropriate legacy key
  IF @code IS NULL AND @id IS NOT NULL
     SELECT Code FROM Users WHERE Users.id = @id

  -- This is a legacy application; find the appropriate surrogate key
  IF @id IS NULL AND @code IS NOT NULL
     SELECT Code FROM Users WHERE Users.id = @id

  -- Impossible code:
  UPDATE inserted SET inserted.code=@code, inserted.id=@id
END
</code></pre>

<p><strong>Question</strong></p>

<p>The 2 huge problems I'm having so far are:</p>

<ol>
<li>I can't do an ""AFTER INSERT"" because NULL constraints will make the insert fail.</li>
<li>The ""impossible code"" I mentioned is how I'd like to cleanly proxy the original query; If the original query has x, y, z columns in it or just x, I ideally would like the same trigger to do these. And if I add/delete another column, I'd like the trigger to remain functional.</li>
</ol>

<p>Anyone have a code example where this could be possible, or even an alternate solution for keeping these columns properly filled even when only one of values is passed to SQL?</p>
","<sql-server><database><tsql><triggers><refactoring-databases>","4","251","2010-10-14 23:07:20"
"3938453","Does anyone have a tool which can automatically attempt to refactor javascript to a more prototype/oo style?","<p>It looks to me like it might be possible to, in many cases, automatically perform some of the refactoring required to turn a functional and/or class style javascript source into a more prototype/non-class based oo source. </p>

<p>Has anyone made a serious attempt at writing a tool that does this kind of automatic refactoring?</p>
","<javascript><automated-refactoring>","0","57","2010-10-14 23:51:40"
"3940165","How to find duplicates method in Visual Studio?","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/204177/what-tool-to-find-code-duplicates-in-c-projects"">What tool to find code duplicates in C# projects?</a>  </p>
</blockquote>



<p>I have to refactor a C# batch that has a lot of duplicates method in different files (Copy and Paste bonanza); essentially I would like to create a common librabry for all of this methods replicated on many .cs files. </p>

<p>Do you know if Visual Studio out of the box or some third party tools could help me to find duplicates method inside this messy codebase?</p>
","<c#><visual-studio><refactoring>","1","131","2010-10-15 07:06:21"
"3940730","ASP.Net MVC help with refactoring","<p>I'm quite new to both ASP.Net and MVC.</p>

<p>I got the following code in my master page:</p>

<pre><code>  &lt;div id=""main-menu"" class=""menu""&gt;
  &lt;%
   var items = (IList&lt;CompanyName.Framework.Web.MenuItem&gt;)ViewData[""MainMenu""];
   if (items.Count &gt; 0)
   {
    %&gt;&lt;ul&gt;&lt;%
    foreach (var item in items)
    {
     if (!string.IsNullOrEmpty(item.RequiredRole) &amp;&amp; !System.Threading.Thread.CurrentPrincipal.IsInRole(item.RequiredRole))
      continue;

     %&gt;&lt;li&gt;&lt;a href=""&lt;%= item.Uri %&gt;""&gt;&lt;%= item.Title %&gt;&lt;/a&gt;&lt;/li&gt;&lt;%
    }
    %&gt;&lt;/ul&gt;&lt;%
   }
  %&gt;
 &lt;/div&gt;
</code></pre>

<p>Can I move the code to another file or refactor the code in any way?</p>

<p><strong>edit:</strong></p>

<p>My ApplicationController that all controllers derive:</p>

<pre><code>public class ApplicationController : Controller
{
    List&lt;MenuItem&gt; _mainMenu = new List&lt;MenuItem&gt;();
    List&lt;MenuItem&gt; _contextMenu = new List&lt;MenuItem&gt;();

    protected IList&lt;MenuItem&gt; MainMenu
    {
        get { return _mainMenu; }
    }

    protected IList&lt;MenuItem&gt; ContextMenu
    {
        get { return _contextMenu; }
    }

    protected string PageTitle { get; set; }

    protected override void OnResultExecuting(ResultExecutingContext filterContext)
    {
        ViewData[""PageTitle""] = PageTitle;
        ViewData[""MainMenu""] = MainMenu;
        ViewData[""ContextMenu""] = ContextMenu;
        base.OnResultExecuting(filterContext);
    }
}
</code></pre>
","<asp.net><asp.net-mvc><refactoring>","3","241","2010-10-15 08:45:48"
"3940851","Java modules communication","<p>I have one module written on Java - web service module which accepts request  process it(some business rules here), saves(modify or delete) values in db (using Hibernate) and then send status response). Is it reasonable to refactor that module so at the end there will be 2 modules  - 1 is web service module and 2 - processing module where business rules applied and db processes made? and if yes then what is the good practices for information exchange between modules ? 
Thanks !</p>
","<java><refactoring><decoupling>","1","104","2010-10-15 09:06:09"
"3929962","Which agile practices are compatible with game development?","<p>Lately I've been a lot into agile methodologies. Some papers I've read at Martin Fowler's website looked thoroughly unflawed to me to say the least, and I was wondering what agile practices are most suited to game development, <strong>particularly for small-budget, small-sized and inexperienced team projects</strong> (bold because it's really important).</p>

<p>Concepts such as refactoring look like they could absolutely combine with a small and inexperienced team. The idea of ""embracing the change"" also combines with inexperienced teams whose ideas twist and turn all the time. But things like TDD are rather problematic.</p>

<p>It's hard and suboptimal to test a class that interacts with Direct3D, for example. It doesn't make much sense.</p>

<p>I'd be most deeply grateful if you could list a bunch of practices that made sense for game development. Ones that aid in the organization of artistic production are a plus. Citations of real-world cases are another plus.</p>

<p>Thanks in advance.</p>

<p>edit --</p>

<p>Plus, my team is composed of 3 people: one programmer, one graphics designer and one programmer/graphics designer combomix. We do <em>not</em> have a client, so we must make all decisions alone.</p>

<p>I've read in an article by Fowler that agile sort of depends on developer-client interaction, but he also mentioned that clients unwillingly to adhere to agile could still be well-served by agile development (the article was called <a href=""http://www.martinfowler.com/articles/newMethodology.html"" rel=""nofollow"">New Methodology</a>). How does that apply to my case?</p>

<p><strong>Conclusions --</strong></p>

<p>I think questions at StackOverflow can help others too, so I'll try to summarize my thoughts on the subject here.</p>

<ul>
<li><p>Through the use of mock objects, even hard-to-test elements such as graphics interfaces and their relationship to client classes might be manageable.</p>

<p>For example, instead of letting every client of the interface truly test its use under many conditions (fullscreen/windowed mode switch, for example, which affects almost everything in the game), they could be tested against a mock that seemingly to them behaves the same as the original class, and additionally test that mock's fidelity to the original object.</p>

<p>That way, the slow part (actually opening the window and stuff) is only done once in checking the mock's fidelity to the implementation, and everything else just run smooth over the mock. [thanks to <a href=""http://stackoverflow.com/users/21475/cameron"">Cameron</a>]</p></li>
<li><p>A <a href=""http://video.google.com/videoplay?docid=8135690990081075324"" rel=""nofollow"">BDD mindset</a> aids at easening the paranoid seek for thorough testing of units, ""replacing"" testing by specification of actual behaviours, not squeezed units which in many cases are better off let untested (or only indirectly tested, if you prefer putting it that way) to avoid too much one-to-one test vs. unit (class, method, variable, etc) parity, which adds to test (now ""specification"") fragility. [thanks to <a href=""http://stackoverflow.com/users/89731/kludge"">Kludge</a>]</p></li>
</ul>
","<game-development><refactoring><tdd><agile>","10","293","2010-10-14 03:55:13"
"3942205","Need help with AS3 Class Design - Refactoring","<p>I have a ""<strong>Course</strong>"" class which contains collection of ""<strong>CourseItems</strong>"".<br>
Each <strong>CourseItem</strong> has a <strong>folder</strong> associated with it(for its files).<br>
I need to add the CourseItem to a Zip file and after zipping it encrypting.<br>
Using FZip and As3crypto I can do the zip and encrypt the zip file.<br>
Whether to do Encryption or not is upto the user .<br>
Currently my code looks similar to (ignore sytax):  </p>

<p><strong>Edit: I will try to add some more info + more description</strong><br>
    Basically a Course is a folder(user selectable) with subfolders(courseitems).<br>
    mapping subfolder structure to the courseitem object(s).  </p>

<pre><code>       //main code
    var encryptCourse:Boolean;
     encryptCourse=true; // read from user..checkbox
    var course:Course = new Course(""path_coursefolder"");//from user input

     course.createCourseItems();

    //read course folder and create ""courseitem"" for each subfolder
    //and save in ""courseItems"" collection
 //after creating pack course - zip and encrypt
   course.Pack(encryptCourse);//encryptCourse bool encrypt course or not



 class Course
     {
               var courseItems:Array; //set when creating
               public function Pack()
               {
                     for each (var item:CourseItem in courseItems)
                        {
                           item.addEventListener(""ZIP_COMPLETE"",onitemzip);
                           item.zip();                     
                        } 
               }    

         private function onitemzip(e:Event)
          { 
              //if user selected to encrypt..do encryption 
             //now  i want to call the encrypt method :(
             //item.Encrypt() //cant call this,,how to refer to ""item""??
          }
      }

            class CourseItem
            {
              var files:Array; //set when creating
              var _courseZipfile;
              public function ZIP()
              {
                var ziputil = new Ziputil()
                 ziputil.createZip(""some_name"",files);
                 ziputil.addEventListener(Event.Complete,onZipComplete);
              }

               private function onZipComplete(e:Event)
               {
                 dispatchEvent(new ZipEvent(""ZIP_COMPLETE""));   
                 //dispatch and update progess
                 //COULD CALL ENCRYPT HERE..but want to avoid.   
               }

              public function Encrypt()
              {
                //encrypt zip file here
                //event of encrypt finish 
              }
            }
</code></pre>

<p>Basically in above design I want to call ""Encrypt"" method  of CourseItem in Course after Zipping.</p>

<p>Note : i had earlier changed the courseitem class.<br>
I had tried moving pack inside CourseItem then i cud handle encryption after zip.<br>
But by this i strongly couple Zip and encrypt methods.<br>
After zipping -> encrypt is called compulsarily .<br>
i want refactor my code in such a way that both methods<br>
 zip and encrypt are independant of each other?<br>
How can i do the same ..     </p>

<p>Thanks all</p>
","<actionscript-3><oop><refactoring>","0","144","2010-10-15 12:28:02"
"3945368","When/why should I start using a database?","<p>I'm currently in the process of evaluating the design, and possible reimplementation of an in-house app our engineers use.</p>

<p>Although the application handles large amounts of data. Only two sets of values (floats) are saved along with a simple name and description of the data. In my opinion the current application is in overkill territory using a normalized access database to store what evaluates to 7 fields of strings and floats.</p>

<p>At what point do you start looking at transitioning from a flat file or serialized XML to a relational database or vice versa?</p>
","<database><refactoring>","5","135","2010-10-15 19:18:02"
"3948440","Do external (editor-independent) refactoring tools exist?","<p>Does a refactoring (able do conscious language-aware rename classes/variables renaming and replace simple constructions instead of doing dumb string search-and-replace) tool exist which can be used without IDE/editor?</p>

<p>I am particularly interested in Scala, C# and PHP languages.</p>
","<refactoring>","2","58","2010-10-16 10:07:37"
"3953687","Porting C++ to C#","<p>C++ and C# are quite simmilar programming languages, in my opinion. If a C++ code needs to be ported to platform where C# is the only supported platform, how much work will need to be done?</p>

<p>Should I get ready, that most of the C++ code will need to be rewritten to C#? Or, because of language simmilarities, should refactoring be quite easy and straightforward? </p>

<p>I am aware, that it will depend on the application itself, but I am asking in general.</p>
","<c#><c++><refactoring>","3","472","2010-10-17 14:48:16"
"3963704","Refactoring Similar Code Across Data Types","<p>I am working in Java, inserting data from HashMaps of certain types into a SQL database. It has produced some code like this:</p>

<pre><code>for ( String key : strings.keySet() ) {
    result_set.updateString(key, strings.get(key));
}

for ( String key : booleans.keySet() ) {
    result_set.updateBoolean(key, booleans.get(key));
}

for ( String key : dates.keySet() ) {
    result_set.updateDate(key, dates.get(key));
}
</code></pre>

<p>I am used to Ruby, where code like this would take up one line and I can't believe I have to do it like this in Java. I must be wrong. Is there a better way? I assume using Generics? I tried using result_set.updateObject(key, object) but it gave me ""SQLException: Unable to convert between java.util.Date and VARCHAR.""</p>
","<java><generics><refactoring>","2","72","2010-10-18 21:52:04"
"3966294","UnitTesting a class that returns a complex dataset","<p>After months of frustration and of time spent in inserting needles in voodoo dolls of previous developers I decided that it is better try to refactor the legacy code.</p>

<p>I already ordered <a href=""http://rads.stackoverflow.com/amzn/click/0131177052"" rel=""nofollow"">Micheal Feather's book</a>, I am into <a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">Fowler's refactoring</a> and I made some sample projects with <a href=""http://dunit.sourceforge.net/"" rel=""nofollow"">DUnit</a>.</p>

<p>So even if I don't master the subject I feel it is time to act and put some ideas into practice.</p>

<p>Almost 100% of the code I work on has the business logic trapped in the UI, moreover all is procedural programming (with some few exceptions). The application started as quick &amp; dirty and continued as such.</p>

<p>Now writing tests for all the application is a meaningless task in my case, but I would like to try to unittest something that I need to refactor.</p>

<p>One of the complex tasks one big ""TForm business logic class"" does is to read DB data, make some computations and populate a scheduler component. I would like to remove the reading DB data and computation part and assign to a new class this task. Of course this is a way to improve the current design, it is not the best way for starting from scratch, but I'd like to do this because the data returned by this new class is useful also in other ways, for example now I've been ask to send e-mail notifications of scheduler data.</p>

<p>So to avoid a massive copy and paste operation I need the new class.</p>

<p>Now the scheduler is populated from a huge dataset (huge in size and in number of fields), probably a first refactoring step could be obtaining the dataset from the new class. But then in the future I'd better use a new class (like TSchedulerData or some other name less bound to scheduler) to manage the data, and instead of having a dataset as result i can have a TSchedulerData object.</p>

<p>Since refactor occurs at at small steps and tests are needed to refactor better I am a little confused on how to proceed.</p>

<p>The following points are not clear to me:</p>

<p>1) how to test a complex dataset? Should I run the working application, save one result set to xml, and write a test where I use a TClientDataSet containing that xml data?</p>

<p>2) How much do I have to care about TSchedulerData? I mean I am not 100% sure I will use TSchedulerData, may be I will stick with the Dataset, anyway thinking of creating complex tests that will be discarded in 2 weeks is not appealing for a DUnitNewbee. Anyway probably this is how it works. I can't imagine the number of bugs that I would face without a test.</p>

<p>Final note: I know someone thinks rewriting from scratch is a better option, but this is not an option. ""The application is huge and it is sold today and new features are required today not to get out of business"". This is what I have been told, anyway refactoring can save my life and extend the application life.</p>
","<delphi><unit-testing><refactoring><legacy-code>","4","242","2010-10-19 07:56:26"
"3968461","How to separate a Inno Setup script into multiple files?","<p>I have two setup scripts that share common code. It is possible to refactor them?
One way of doing that is having a file for common code which will be referenced by each script.
Is this possible?</p>
","<refactoring><inno-setup><multiple-files>","1","517","2010-10-19 12:48:46"
"3971224","Cleaning up a large, legacy Java project","<p>I've been assigned to do some work on a huge Java project, and the influence of several iterations of developers is obvious.  There is no standard coding style, formatting, naming conventions or class structure.  It's a good day when I come across a class with Javadoc, and unit testing is a happy daydream.</p>

<p>So far those of us on the project have been ""blending in"", adapting to the existing convention of whatever class we're working on, but the time is coming to impose some order and consistency.</p>

<p>It's a daunting challenge, and I'm looking for any advice people might have on such a task.  Are there any strategies that have been particularly effective, or pitfalls to look out for?  Is it even a good idea to try?</p>

<p>Edit to add:  I don't want to give the impression that the project is bad - it is in fact solidly designed and largely well-written.  It's just feeling its age and the inevitability of maintenance...</p>
","<java><refactoring><formatting><legacy><code-structure>","9","544","2010-10-19 17:57:57"
"3983113","A type with ""Manager"" in the name - candidate for refactoring?","<p>I found a thesis on <a href=""http://www.gamedev.net/community/forums/topic.asp?topic_id=573392&amp;whichpage=1&#3660010"" rel=""nofollow"">forums</a>:</p>

<blockquote>
  <p>If you have a type with ""Manager"" in
  the name, it's a candidate for
  refactoring.</p>
</blockquote>

<p>One answer:</p>

<blockquote>
  <p>I know it's considered a code ""smell""</p>
</blockquote>

<p>So... Why? Is this thesis correct?</p>

<p>There are many managers out there. For example, Ogre3d uses them a lot, and this engine really has a clean architecture.</p>
","<oop><architecture><refactoring><manager>","3","135","2010-10-20 23:28:46"
"3971699","jQuery delegate optimization","<p>what is the best way to optimize the following snippets that uses delegate()?</p>

<pre><code>jQuery('.menu').delegate('li.gallery', 'hover', function () { jQuery(this).children('.submenu').toggleClass('hide show'); });
jQuery('.menu').delegate('li.interior', 'hover', function () { jQuery(this).children('.submenu').toggleClass('hide show'); });
jQuery('.menu').delegate('li.exterior', 'hover', function () { jQuery(this).children('.submenu').toggleClass('hide show'); });


&lt;li class=""gallery""&gt; 
                    &lt;span&gt;gallery&lt;/span&gt; 
                    &lt;ul class=""submenu hide""&gt; 
                        &lt;li class=""interior""&gt; 
                            &lt;a href=""/gallery/interior""&gt;Interior&lt;/a&gt; 
                            &lt;ul class=""submenu hide""&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=master-bedroom""&gt;Master Bedroom&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=living-room""&gt;Living Room&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=dining-room""&gt;Dining Room&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=kitchen""&gt;Kitchen&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=bathroom""&gt;Bathroom&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=foyer""&gt;Foyer&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=study""&gt;Study&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=sunroom""&gt;Sunroom&lt;/a&gt;&lt;/li&gt;                                
                                &lt;li&gt;&lt;a href=""/gallery/interior?gallery=guest-room""&gt;Guest Room&lt;/a&gt;&lt;/li&gt;                                                              
                            &lt;/ul&gt; 
                        &lt;/li&gt; 
                        &lt;li class=""exterior""&gt; 
                            &lt;a href=""/gallery/exterior""&gt;Exterior&lt;/a&gt; 
                            &lt;ul class=""submenu hide""&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/exterior?gallery=landscapes""&gt;Landscape&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/exterior?gallery=gardens""&gt;Gardens&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/exterior?gallery=cottages""&gt;Cottages&lt;/a&gt;&lt;/li&gt; 
                                &lt;li&gt;&lt;a href=""/gallery/exterior?gallery=entry-driveway""&gt;Entry/Driveway&lt;/a&gt;&lt;/li&gt;                                                                                              
                            &lt;/ul&gt; 
                        &lt;/li&gt;                       
                    &lt;/ul&gt; 
                &lt;/li&gt;
</code></pre>
","<jquery><optimization><refactoring><refactor-my-code>","1","282","2010-10-19 18:58:53"
"3973204","Eclipse JDT: Is there a refactoring to replace direct field accesses with setter/getter methods?","<p>I know I can generate setters and getters for fields in the Eclipse source menu, but I'm very surprised it doesn't offer to replace the direct field accessors with calls to the newly created methods.</p>

<p>Does anyone know how to do this short of manual search and replace?</p>

<p>Thanks!</p>
","<java><eclipse><refactoring><jdt><getter-setter>","4","243","2010-10-19 22:11:44"
"3972568","Java Date getDate() deprecated, refactored to use calendar but looks ugly","<p>Eclipse is warning that I'm using a deprecated method:</p>

<pre><code>eventDay = event.getEvent_s_date().getDate();
</code></pre>

<p>So I rewrote it as</p>

<pre><code>eventDay = DateUtil.toCalendar(event.getEvent_s_date()).get(Calendar.DATE);
</code></pre>

<p>It seems to work but it looks ugly.  My question is did I refactor this the best way?  If not, how would you refactor?  I need the day number of a date stored in a bean.</p>

<p>I ended up adding a method in my DateUtils to clean it up</p>

<p><code>eventDay = DateUtil.getIntDate(event.getEvent_s_date());</code></p>

<pre><code>public static int getIntDate(Date date) {
    return DateUtil.toCalendar(date).get(Calendar.DATE);
}
</code></pre>
","<java><date><refactoring>","2","2825","2010-10-19 20:39:25"
"3991483","Delphi: How to move a class out of a unit;avoid circular references","<blockquote>
  <p><strong>Question:</strong> i want to split two classes out to their own file, while avoiding circular references.</p>
</blockquote>

<p>i have a unit with some classes (and some enumerations and constants). Anyone will recognize <a href=""http://cartalk.com"" rel=""nofollow"">Click and Clack the tappet brothers</a>:</p>

<pre><code>unit Cartalk;

interface

type
   TSolution = (solTransmission, solBrakes, solGremlins);

   TTappetBrother = class(TObject)
   public
      function GetSolution: TSolution; virtual; abstract;
   end;

   TClick = class(TTappetBrother)
   public      
      function GetSolution: TSolution; override;
   end;

   TClack = class(TTapperBrother)
   public
      function GetSolution: TSolution; override;
   end;

implementation

function TClick.GetSolution: TSolution;
begin
   Result := solTransmission;
end;

function TClack.GetSoltution: TSolution;
begin
   Result := solGremlins;
end;

end.
</code></pre>

<p>Now obviously my two classes <code>TClick</code> and <code>TClick</code> are quite complex. For manageability i'd like to split <code>TClick</code> and <code>TClack</code> out to their own units <strong><em>while not breaking any existing external code</em></strong>.</p>

<p>My first crack at it would be:</p>

<pre><code>unit Cartalk;

interface

uses
   Cartalk_Click, Cartalk_Clack;

type
   TSolution = (solTransmission, solBrakes, solGremlins);

   TTappetBrother = class(TObject)
   public
      function GetSolution: TSolution; virtual; abstract;
   end;

   TClick = Cartalk_Click.TClick; //alias brought in from Cartalk_Click.pas

   TClack = Cartalk_Clack.TClack; //alias brought in from Cartalk_Clack.pas

 implementation

 end.
</code></pre>

<p>Perfect, i have all the same classes available in <code>Cartalk.pas</code>, now i just have to write <code>Cartalk_Click.pas</code> and <code>Cartalk_Clack.pas</code>:</p>

<pre><code>unit Cartalk_Click;

interface

type
   TClick = class(TTappetBrother)
   public      
      function GetSolution: TSolution; override;
   end;

implementation

function TClick.GetSolution: TSolution;
begin
   Result := solTransmission;
end;

end.
</code></pre>

<p>Problem, of course, is that <code>TTappetBrother</code> and <code>TSolution</code> are not declared in this unit. So we add a reference to where they live to the <code>uses</code>, watch it fail, and reach the heart of my question:</p>

<pre><code>unit Cartalk_Click;

interface

uses
   Cartalk;

type
   TClick = class(TTappetBrother)
   public      
      function GetSolution: TSolution; override;
   end;

implementation

function TClick.GetSolution: TSolution;
begin
   Result := solTransmission;
end;

end.
</code></pre>

<p>There is now a circular reference between <code>Cartalk</code> and <code>Cartalk_Click</code>.</p>

<p><strong>Note:</strong> Of course i don't have a Cartalk unit, with Click and Clack the tapper brothers - this is just an example. In reality i have 3 classes, 20 enumerations, and 293 constants in my unit.</p>
","<delphi><refactoring><circular-dependency><delphi-5><circular-reference>","3","208","2010-10-21 20:09:56"
"4001268","When is it time to refactor code?","<p><strong>On on hand:</strong><br>
1. You never get time to do it.<br>
2. ""Context switching"" is mentally expensive (difficult to leave what you're doing in the middle of it).<br>
3. It usually isn't an easy task.<br>
4. There's always the fear you'll break something that's now working.</p>

<p><strong>On the other:</strong><br>
1. Using that code is error-prone.<br>
2. Over time you might realize that if you had refactored the code the first time you saw it, that would have saved you time on the long run.    </p>

<p>So my question is - Practically - When do you decide it's time to refactor your code?  </p>

<p>Thanks.</p>
","<language-agnostic><refactoring>","3","271","2010-10-22 21:56:59"
"4002525","Silverlight Custom Grid with Fixed Header and Column, required refactoring","<p>I’m trying to build the custom grid with fixed Header and Column in Silverlight. I don’t know whether SL has built in functionality to build this or not because I’m very new to SL. Please take a look the following code. I don’t think that this is the right way to build this. If you don’t mind, please refactor my code and advise me the right way.</p>

<p>MainPage.xaml</p>

<pre><code>&lt;UserControl x:Class=""SilverlightApplication1.MainPage""
xmlns=""http://schemas.microsoft.com/winfx/2006/xaml/presentation""
xmlns:x=""http://schemas.microsoft.com/winfx/2006/xaml""
xmlns:d=""http://schemas.microsoft.com/expression/blend/2008""
xmlns:mc=""http://schemas.openxmlformats.org/markup-compatibility/2006""
mc:Ignorable=""d""
d:DesignHeight=""300"" d:DesignWidth=""400""&gt;

&lt;Canvas x:Name=""LayoutRoot"" Background=""White""&gt;

&lt;/Canvas&gt;
&lt;/UserControl&gt;
</code></pre>

<p>MainPage.xaml.cs</p>

<pre><code>using System.Net;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Shapes;
using System.Windows.Controls.Primitives;

namespace SilverlightApplication1
{
    public partial class MainPage : UserControl
    {

        private Grid theGrid =  new Grid();
        private Canvas gridContainer = new Canvas();

        private Canvas colHeader = new Canvas();
        private StackPanel colHeaderContainer = new StackPanel();

        private Canvas rowHeader = new Canvas();
        private StackPanel rowHeaderContainer = new StackPanel();

        private Canvas scrollableGrid = new Canvas();

        private Border firstRowfirstColCell = new Border();

        private ScrollBar hScrollBar = new ScrollBar();
        private ScrollBar vScrollBar =  new ScrollBar();

        public MainPage()
        {
            InitializeComponent();

            BuildTheGrid();
        }

        private void BuildTheGrid()
        {
            for (int i = 0; i &lt;= 10; i++)
            {
                ColumnDefinition cdef = new ColumnDefinition();
                cdef.Width = new GridLength(100);
                theGrid.ColumnDefinitions.Add(cdef);
            }

            for (int i = 0; i &lt;= 8; i++)
            {
                RowDefinition rdef = new RowDefinition();
                rdef.Height = new GridLength(50);
                theGrid.RowDefinitions.Add(rdef);
            }

            for (int i = 0; i &lt;= 10; i++)
            {
                for (int j = 0; j &lt;= 8; j++)
                {
                    Border mbrd = new Border();
                    mbrd.BorderBrush = new SolidColorBrush(Colors.Black);
                    mbrd.BorderThickness = new Thickness(1);
                    mbrd.Width = 100;
                    mbrd.Height = 50;                  
                    mbrd.SetValue(Grid.RowProperty, j);
                    mbrd.SetValue(Grid.ColumnProperty, i);
                    StackPanel sp = new StackPanel();
                    sp.AllowDrop = true;
                    sp.Background = new SolidColorBrush(Colors.LightGray);
                    sp.SetValue(Grid.RowProperty, j);
                    sp.SetValue(Grid.ColumnProperty, i);                                       
                    theGrid.Children.Add(sp);
                    theGrid.Children.Add(mbrd);
                }
            }

            gridContainer.Children.Add(theGrid);


            Canvas.SetLeft(scrollableGrid, 350);
            Canvas.SetTop(scrollableGrid, 150);
            scrollableGrid.Children.Add(gridContainer);
            scrollableGrid.Width = 100;

            RectangleGeometry recClip = new RectangleGeometry();
            recClip.Rect = new Rect(0, 0, 880, 350);

            scrollableGrid.Clip = recClip;

            this.LayoutRoot.Children.Add(scrollableGrid);



            hScrollBar.Orientation = Orientation.Horizontal;
            Canvas.SetLeft(hScrollBar, 250);
            Canvas.SetTop(hScrollBar, 500);
            hScrollBar.Width = 980;

            hScrollBar.ViewportSize = 100;
            hScrollBar.Maximum = 220;            
            hScrollBar.Minimum = 0;
            hScrollBar.SmallChange = 10;
            hScrollBar.LargeChange = 15;
            hScrollBar.Value = 0;

            hScrollBar.Scroll += hScrollBar_Scroll;

            this.LayoutRoot.Children.Add(hScrollBar);


            vScrollBar.Orientation = Orientation.Vertical;
            Canvas.SetLeft(vScrollBar, 1230);
            Canvas.SetTop(vScrollBar, 100);
            vScrollBar.Height = 400;

            vScrollBar.ViewportSize = 100;
            vScrollBar.Maximum = 100;           
            vScrollBar.Minimum = 0;
            vScrollBar.SmallChange = 5;
            vScrollBar.LargeChange = 10;
            vScrollBar.Value = 0;

            vScrollBar.Scroll += vScrollBar_Scroll;

            this.LayoutRoot.Children.Add(vScrollBar);


            colHeaderContainer.Orientation = Orientation.Horizontal;
            for (int i = 0; i &lt;= 10; i++)
            {
                Border mbrd = new Border();
                mbrd.BorderBrush = new SolidColorBrush(Colors.Black);
                mbrd.BorderThickness = new Thickness(1);
                mbrd.Width = 100;
                mbrd.Height = 50;
                colHeaderContainer.Children.Add(mbrd);
            }
            colHeader.Children.Add(colHeaderContainer);
            Canvas.SetLeft(colHeader, 350);
            Canvas.SetTop(colHeader, 100);

            RectangleGeometry colHeaderrecClip = new RectangleGeometry();
            colHeaderrecClip.Rect = new Rect(0, 0, 880, 50);

            colHeader.Clip = colHeaderrecClip;


            this.LayoutRoot.Children.Add(colHeader);


            rowHeaderContainer.Orientation = Orientation.Vertical;
            for (int i = 0; i &lt;= 8; i++)
            {
                Border mbrd = new Border();
                mbrd.BorderBrush = new SolidColorBrush(Colors.Black);
                mbrd.BorderThickness = new Thickness(1);
                mbrd.Width = 100;
                mbrd.Height = 50;
                rowHeaderContainer.Children.Add(mbrd);
            }

            rowHeader.Children.Add(rowHeaderContainer);
            Canvas.SetLeft(rowHeader, 250);
            Canvas.SetTop(rowHeader, 150);

            RectangleGeometry rowHeaderrecClip = new RectangleGeometry();
            rowHeaderrecClip.Rect = new Rect(0, 0, 100, 350);

            rowHeader.Clip = rowHeaderrecClip;

            this.LayoutRoot.Children.Add(rowHeader);


            this.LayoutRoot.Children.Add(firstRowfirstColCell);
            firstRowfirstColCell.BorderBrush = new SolidColorBrush(Colors.Black);
            firstRowfirstColCell.BorderThickness = new Thickness(1);
            firstRowfirstColCell.Width = 100;
            firstRowfirstColCell.Height = 50;
            Canvas.SetLeft(firstRowfirstColCell, 250);
            Canvas.SetTop(firstRowfirstColCell, 100);

            theGrid.MouseWheel += theGrid_MouseWheel;

        }

        private void hScrollBar_Scroll(object sender, ScrollEventArgs e)
        {
            gridContainer.SetValue(Canvas.LeftProperty, -hScrollBar.Value);
            colHeaderContainer.SetValue(Canvas.LeftProperty, -hScrollBar.Value);
        }

        private void vScrollBar_Scroll(object sender, ScrollEventArgs e)
        {
            gridContainer.SetValue(Canvas.TopProperty, -vScrollBar.Value);
            rowHeaderContainer.SetValue(Canvas.TopProperty, -vScrollBar.Value);
        }

        private void theGrid_MouseWheel(object sender, MouseWheelEventArgs e)
        {
            vScrollBar.Value += e.Delta &gt; 0 ? -vScrollBar.LargeChange : vScrollBar.LargeChange;
            gridContainer.SetValue(Canvas.TopProperty, -vScrollBar.Value);
            rowHeaderContainer.SetValue(Canvas.TopProperty, -vScrollBar.Value);
        }

    }
}
</code></pre>
","<silverlight><refactoring><grid>","1","351","2010-10-23 04:48:22"
"4004138","Cleanly duplicate an instance of a baseclass or subclass in C++?","<p>In the trivial example inheritance hierarchy:</p>

<pre><code>class Food
{
    virtual ~Food();
};

class Fruit : public Food
{
    virtual ~Fruit();
};

class Apple: public Fruit
{
    virtual ~Apple();
}

class Vegetable: public Food
{
    virtual ~Vegetable();
}
</code></pre>

<p>I wish to create a method that can clone an object from its subclass or baseclass instance:</p>

<pre><code>Apple* apple1 = new Apple();
Apple* clone1 = apple1-&gt;clone();

Food* food1 = apple1;
Apple* clone2 = food1-&gt;clone();
</code></pre>

<p>I see a few possible solutions to the problem: </p>

<ul>
<li><p>Use polymorphism to create a virtual function that is explicitly defined for each subclass.</p></li>
<li><p>Use a templated factory method to take an instance of a class and the type of the subclass to create the new instance.</p></li>
<li><p>Register an id with each class and subclass that is stored elsewhere to lookup which subclass to create on calling a baseclass clone function.</p></li>
</ul>

<p>None of these seem ideal, but I'm leaning more towards the third solution as it simplifies calling the clone function without requiring a definition to be written for every subclasses (for which there will be a lot).</p>

<p>However, I'm very much open to any suggestions, are there better ways of doing this?</p>
","<c++><templates><refactoring><polymorphism><factory>","2","173","2010-10-23 13:18:37"
"3993267","How do I refactor closing a stream in Java?","<p>Due to my company's policy of using Eclipse and using Eclipse's code-autofix, the following code pattern appears excessively in the codebase:</p>

<pre><code>InputStream is = null;
try {
    is = url.openConnection().getInputStream();
    // .....
} catch (IOException e) {
    // handle error
} finally {
    if (is != null) {
        try {
            is.close();
        } catch (IOException e) {
            // handle error
       }
    }
}
</code></pre>

<p>IMO it's extremely fugly and hard to read, especially the portion within the finally block (is there really a need to catch 2 instances of IOException?). Is there anyway to streamline the code such that it looks cleaner?</p>
","<java><refactoring><error-handling><stream>","1","121","2010-10-22 01:27:40"
"4005540","Is there a refactoring tool for SQL Server Database","<p>I would like to know if does anybody know a freeware refactoring tool, in which I could rename some table columns and get those names also renamed in my stored procedures.</p>

<p>Does it exist?</p>
","<sql-server><refactoring>","2","126","2010-10-23 18:46:24"
"4011104","How can I refactor a large block of if statements in Java?","<p>I recently profiled some code using JVisualVM, and found that one particular method was taking up a lot of execution time, both from being called often and from having a slow execution time. The method is made up of a large block of if statements, like so: (in the actual method there are about 30 of these)</p>

<pre><code>    EcState c = candidate;

    if (waypoints.size() &gt; 0)
    {
        EcState state = defaultDestination();
        for (EcState s : waypoints)
        {
            state.union(s);
        }
        state.union(this);
        return state.isSatisfied(candidate);
    }

    if (c.var1 &lt; var1)
        return false;
    if (c.var2 &lt; var2)
        return false;
    if (c.var3 &lt; var3)
        return false;
    if (c.var4 &lt; var4)
        return false;
    if ((!c.var5) &amp; var5)
        return false;
    if ((!c.var6) &amp; var6)
        return false;
    if ((!c.var7) &amp; var7)
        return false;
    if ((!c.var8) &amp; var8)
        return false;
    if ((!c.var9) &amp; var9)
        return false;

    return true;
</code></pre>

<p>Is there a better way to write these if statements, or should I look elsewhere to improve efficiency?</p>

<p>EDIT: The program uses evolutionary science to develop paths to a given outcome. Specifically, build orders for Starcraft II. This method checks to see if a particular evolution satisfies the conditions of the given outcome.</p>
","<java><refactoring><if-statement><decomposition>","2","449","2010-10-25 00:05:49"
"4024807","Workflow for renaming a class when using Visual Studio with Perforce","<p>(I am new to perforce and am trying to avoid getting myself into problems, I have hit problems doing this with other source code control systems)</p>

<p>When I rename I class I need to</p>

<ul>
<li>Change the class name it’s self</li>
<li>Get Visual Studio to Refactor all the code that uses the class</li>
<li>Rename the file in the Visual Studio project</li>
<li>Rename the file in Perforce</li>
<li>Check the changes into perforce</li>
<li>Then maybe merge the change from my working branch into the main branch</li>
</ul>

<p>What’s the best way to do the above with perforce?  What issues to I need to be aware of?</p>
","<visual-studio><refactoring><perforce>","0","245","2010-10-26 14:38:51"
"4024835","Does this Rails 3 Controller method make me look fat?","<p>This is a new application, and I have an index method on a Search controller. This also serves as the home page for the application, and I'm trying to decide if I am headed down the wrong path from a design pattern perspective.</p>

<p>The method is already 35 lines long.  Here is what the method does:</p>

<p>3 lines of setting variables to determine what ""level"" of hierarchical data is being searched.</p>

<p>Another 10 lines to populate some view variables based on whether a subdomain was in the request or not.</p>

<p>A 10 line section to redirect to one of two pages based on:</p>

<p>1) If the user does not have access, and is signed in, and has not yet requested access, tell them ""click here to request access to this brand"".</p>

<p>2) If the user does not have access, is signed in, and has already requested access, tell them ""so and so is reviewing your request"".</p>

<p>Another 10 lines to build the dynamic arel.</p>

<p>I can't get it straight in my head how to separate these concerns, or even if they should be separated. I appreciate any help you can offer!</p>
","<ruby-on-rails><design-patterns><refactoring><ruby-on-rails-3><separation-of-concerns>","3","166","2010-10-26 14:42:16"
"4027517","Better way of refactoring this?","<p>I have the following classes:</p>

<pre><code>public abstract class BaseClass
{
    private readonly double cachedValue;

    public BaseClass()
    {
         cachedValue = ComputeValue();
    }

    protected abstract double ComputeValue()          
}


public class ClassA : BaseClass
{
    protected override double ComputeValue()  { ... }            
}

public class ClassB : BaseClass
{
    protected override double ComputeValue()  { ... }                
}
</code></pre>

<p>where <code>ComputeValue()</code> is a time consuming computation. </p>

<p>Problem is, there are other methods in the <code>ClassA</code> and <code>ClassB</code> which require the value returned from <code>ComputeValue()</code>. I was thinking of adding a protected property named 'CachedValue' in BaseClass but I find this approach to be redundant and confusing to other programmers who might not be aware of its existence, and might call ComputeValue() directly. </p>

<p>The second option is to use nullable type at the derived class level as I don't necessarily require the computation to be done in the constructor in BaseClass, lazy computation might be a better option:</p>

<pre><code>protected override double ComputeValue()  
{
    if(cachedValue.HasValue)
    {
        return (double) cachedValue;
    }

    // Do computation
    cachedValue = ...

    return cachedValue;
}        
</code></pre>

<p>but I feel I could do better. </p>

<p>What are your thoughts on this ?</p>

<p>Thank you.</p>

<p>Edit: Just to clarify, I'm trying to prevent <code>ComputeValue()</code> from getting called more than once by enforcing the use of '<code>cachedValue</code>'.</p>
","<c#><.net><inheritance><refactoring>","1","238","2010-10-26 20:03:24"
"4035448","What Are The Motivations And Benefits Of Refactoring?","<p>Why do we do refactoring? What are the benefits of refactoring? What problems can be avoided by performing refactoring the code of a software tool?</p>
","<refactoring>","0","142","2010-10-27 16:28:31"
"4044362","Is using “feature branches” compatible with refactoring?","<p><strong>“<em>feature branches</em>”</strong>  is when each feature is developed in its own branch and only merged into the main line when it has been tested and is ready to ship. This allows the product owner to choose the features that go into a given shipment and to “park” feature that are part written if more important work comes in (e.g. a customer phones up the MD to complain).</p>

<p><strong>“<em>refactoring</em>”</strong> is transforming the code to improve its design so as to reduce to cost of change. Without doing this continually you tend to get uglier code bases which is more difficult to write tests for.</p>

<p>In real life there are always customers that have been <strong>sold</strong> new features and <strong>due to politics</strong> all the customers have to see that progress is being made on “their” group of features. So it is very rarely that there is a time without a lot of half-finished features sitting on branches. </p>

<p>If any refactoring has been done, the merging in the “feature branches” become a lot harder if not impossible.</p>

<p><strong>Do we just have to give up on being able to do any refactoring?</strong></p>
","<version-control><refactoring><branch><feature-branch>","9","220","2010-10-28 15:24:24"
"4044505","Refactoring JavaScript and PHP code [Job Interview]","<p>recently I had a job interview. I had two tasks:</p>

<p><strong>1) to refactor a JavaScript code</strong></p>

<pre><code>// The library 'jsUtil' has a public function that compares 2 arrays, returning true if
// they're the same. Refactor it so it's more robust, performs better and is easier to maintain.
/**
  @name jsUtil.arraysSame
  @description Compares 2 arrays, returns true if both are comprised of the same items, in the same order
  @param {Object[]} a Array to compare with
  @param {Object[]} b Array to compare to
  @returns {boolean} true if both contain the same items, otherwise false
  @example
  if ( jsUtil.arraysSame( [1, 2, 3], [1, 2, 3] ) ) {
    alert('Arrays are the same!');
  }
*/
// assume jsUtil is an object

jsUtil.arraysSame = function(a, b) {
  var r = 1;
  for (i in a) if ( a[i] != b[i] ) r = 0;
    else continue;
    return r;
}
</code></pre>

<p><strong>2) To refactor a PHP function that checks for a leap year</strong></p>

<pre><code>&lt;?php
/*
  The class 'DateUtil' defines a method that takes a date in the format DD/MM/YYYY, extracts the year
  and works out if it is a leap year. The code is poorly written. Refactor it so that it is more robust
  and easier to maintain in the future.

  Hint: a year is a leap year if it is evenly divisible by 4, unless it is also evenly
  divisible by 100 and not by 400.
*/

class DateUtil {
    function notLeapYear ($var) {
        $var = substr($var, 6, 4);
        if (! ($var % 100) &amp;&amp; $var % 400) {
            return 1;
        }
        return $var % 4;
    }
}


$testDates = array('03/12/2000', '01/04/2001', '28/01/2004', '29/11/2200');

/* the expected result is
* 03/12/2000 falls in a leap year
* 01/04/2001 does not fall in a leap year
* 28/01/2004 falls in a leap year
* 29/11/2200 does not fall in a leap year
*/
?&gt;

&lt;? $dateUtil = new DateUtil(); ?&gt;
&lt;ul&gt;
  &lt;? foreach ($testDates as $date) { ?&gt;
    &lt;li&gt;&lt;?= $date ?&gt; &lt;?= ($dateUtil-&gt;notLeapYear($date) ? 'does not fall' : 'falls') ?&gt; in a leap year&lt;/li&gt;
  &lt;? } ?&gt;
&lt;/ul&gt;
</code></pre>

<p>I think I cope with the task but I am not quite sure, I still don't have an answer from them and it's been about a week. Could you give an example of your approach to this tasks? I'd really appreciate. Later I can post my solutions/code.</p>

<p>OK here are my answers to the questions.</p>

<pre><code>&lt;?php // Always use full/long openning tags not 

$start = microtime(true);

class DateUtil {

    /**
     * The date could be used in other 
     * class methods in the future.
     * Use just internally.
     **/
    var $_date; 

    /**
     * The constructor of the class takes
     * 1 argument, date, as a string and sets
     * the object parameter _date to be used
     * internally. This is compatable only in PHP5
     * for PHP4 should be replaced with function DateUtil(...)
     */
    public function __construct( $date = '' ) {
        $this-&gt;_date = $date;
    }

    /**
     * Setter for the date. Currently not used.
     * Also we could use _set magical function.
     * for PHP5.
    **/
    public function setDate( $date = '' ) {
        $this-&gt;_date = $date;
    }

    /**
     * Gettre of the date. Currently not used.
     * Also we could use _get magical function.
     * for PHP5.
    **/
    public function getDate() {
        return $this-&gt;_date;
    }

    public function isLeapYear( $year = '' ) {
        // all leap years can be divided through 4
        if (($year % 4) != 0) {
            return false;
        }

        // all leap years can be divided through 400
        if ($year % 400 == 0) {
            return true;
        } else if ($year % 100 == 0) {
            return false;
        }

        return true;
    }
}

$dates = array('03/12/2000', '01/04/2001', '30/01/2004', '29/11/2200');
$dateUtil = new DateUtil();

foreach($dates as $date) {
    /** 
     * This processing is not done in the class
     * because the date format could be different in 
     * other cases so we cannot assume this will allways 
     * be the format of the date
     * 
     * The php function strtotime() was not used due to 
     * a bug called 2K38, more specifically dates after and 2038
     * are not parsed correctly due to the format of the UNIX 
     * timestamp which is 32bit integer.
     * If the years we use are higher than 1970 and lower
     * than 2038 we can use date('L', strtotime($date));
    **/
    $year = explode('/', $date);
    $year = $year[2];
    $isLeap = $dateUtil-&gt;isLeapYear($year);

    echo '&lt;pre&gt;' . $date . ' - ';
    echo ($isLeap)? 'Is leap year': 'Is not leap year';
    echo '&lt;/pre&gt;';
}

echo 'The execution took: ' . (microtime(true) - $start) . ' sec';
?&gt;
</code></pre>

<p>JavaScript</p>

<pre><code>/***************************************************/

jsUtil = new Object();

jsUtil.arraysSame = function(a, b) {


    if( typeof(a) != 'object') {
        // Check if tepes of 'a' is object
        return false;
    } else if(typeof(a) != typeof(b)) {
        // Check if tepes of 'a' and 'b' are same
        return false;
    } else if(a.length != b.length) {
        // Check if arrays have different length if yes return false
        return false;
    }

    for(var i in a) {
        // We compare each element not only by value
        // but also by type so 3 != '3'
        if(a[i] !== b[i]) {
            return false;
        }
    }

    return true;
}

// It will work with associative arrays too
var a = {a:1, b:2, c:3};
var b = {a:1, b:2, c:3};    // true
var c = {a:1, b:2, g:3};    // false
var d = {a:1, b:2, c:'3'};  // false

var output = '';

output += 'Arrays a==b is: ' + jsUtil.arraysSame( a, b );
output += '\n';
output += 'Arrays a==c is: ' + jsUtil.arraysSame( a, c );
output += '\n';
output += 'Arrays a==d is: ' + jsUtil.arraysSame( a, d );

alert(output);
</code></pre>
","<php><javascript><refactoring><interview-questions>","2","659","2010-10-28 15:36:49"
"4046177","Refactor the namespaces in a SOLUTION","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/4809197/whats-the-best-way-to-do-a-bulk-namespace-rename-on-a-large-c-sharp-application"">What&#39;s the best way to do a bulk namespace rename on a large c# application?</a>  </p>
</blockquote>



<p>I am changing the Default Namespace for my projects in the solution.
I can use Resharper for example to adjust the namespaces for me in ONE project.
but I am looking for some tool that can adjust the namespaces in the whole SOLUTION.
I am using VS2008 pro.  is there a refacotring tool that can adjust the namespaces in the all projects of my solution? ( it is about 60 projects in the solution! pain!)</p>
","<refactoring><namespaces>","0","234","2010-10-28 18:46:44"
"4046222","Name for factoring out repeated code into separate function","<p>I'm trying to find research/advice on a particular code refactoring pattern, but I'm finding it hard to locate, since I'm not sure whether there's a good name for it.  It's very similar to factoring out repeated code, except the code wasn't repeated in the first place: it was just stashed away in a conditional branch of a larger function, accessible via a parameter of that function.</p>

<p>In pseudocode, the before:</p>

<pre><code>function frobnicate(id, check_only = false) {
    if id cannot be frobnicated
        return false
    if check_only
        return true
    // frobnicate id
    return true
}

// example calls:
okay_to_frobnicate = frobnicate(id, true)
frobnicate_success = frobnicate(id)
</code></pre>

<p>After:</p>

<pre><code>function can_be_frobnicated(id) {
    if id cannot be frobnicated
        return false
    else
        return true
}

function frobnicate(id) {
    if not can_be_frobnicated(id)
        return false
    // frobnicate id
    return true
}

// example calls:
okay_to_frobnicate = can_be_frobnicated(id)
frobnicate_success = frobnicate(id)
</code></pre>

<p><strong>Edit</strong>: added example calls.  Wasn't clear that the removed parameter was part of the refactoring.</p>
","<design><design-patterns><language-agnostic><refactoring><code-smell>","0","105","2010-10-28 18:52:57"
"4046468","good refactoring or bad?","<p>Given the following code:</p>

<pre><code>    status = row[COL_STATUS]

    if status == ""idle"":
        row[COL_EDITABLE] = True
        row[COL_FONTSTYLE] = pango.STYLE_NORMAL
        row[COL_WEIGHT] = pango.WEIGHT_NORMAL
    elif status == ""DCed"":
        row[COL_EDITABLE] = True
        row[COL_FONTSTYLE] = pango.STYLE_ITALIC
        row[COL_WEIGHT] = pango.WEIGHT_NORMAL
    else:
        row[COL_EDITABLE] = False
        row[COL_FONTSTYLE] = pango.STYLE_NORMAL
        row[COL_WEIGHT] = pango.WEIGHT_BOLD
</code></pre>

<p>Would the following be a net beneficial refactoring, in your opinion?</p>

<pre><code>    d = {""idle"": (True,  pango.STYLE_NORMAL, pango.WEIGHT_NORMAL),
         ""DCed"": (True,  pango.STYLE_ITALIC, pango.WEIGHT_NORMAL),
         None:   (False, pango.STYLE_NORMAL, pango.WEIGHT_BOLD)}
    e,f,w = d.get(status, d[None])
    row[COL_EDITABLE] = e
    row[COL_FONTSTYLE] = f
    row[COL_WEIGHT] = w
</code></pre>

<p>What if there were more cases or more row components to edit?</p>
","<python><coding-style><refactoring>","0","128","2010-10-28 19:25:25"
"4051810","Example of Delphi refactoring involving data aware controls and datamodules with direct access to db tables","<p>I am trying to define the best way to refactor the project I am working on.</p>

<p>Due to lack of good design almost all project is made up of:</p>

<p>1) forms containing business logic</p>

<p>2) huge datamodules (1 per form + some extra ones)</p>

<p>3) some units that contain common code (libraries)</p>

<p>There is no OOP (except for some small areas), code reuse it is at a minimum level.</p>

<p>One problem is also that dataaware controls are used, so it was very simple to drop many datasets+datasources on the datamodules and link directly to the DB in an highly coupled manner. </p>

<p>Ideally i would like to extract classes, like TCustomer, TEmployee, to get advantage os encapsulation and to make it possible to create new UI in the future without duplicating all code.</p>

<p>Anyway my question is: how do I can keep dealing with dataaware controls? Should I implement a function that returns a dataset, and I link the dataawarecomponent.datasource to the function result?</p>

<pre><code>function TCustomer.LoadByID(aCustomerID: integer): TDataset
</code></pre>

<p>?</p>
","<delphi><refactoring><datamodule><data-aware>","6","358","2010-10-29 12:24:40"
"4053749","I have a method in program.cs that I want to transfer to its own class","<p>How can I transfer pigTalk() into its own class?</p>

<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace FunctionTest
{
    public class Program
    {
        public static void pigTalk(string sentence)
        {
            try
            {
                while (sentence != ""exit"")
                {
                    string firstLetter;
                    string afterFirst;
                    string pigLatinOut = """";
                    int x;
                    string vowel = ""AEIOUaeiou"";

                    string[] pieces = sentence.Split();

                    foreach (string piece in pieces)
                    {
                        afterFirst = piece.Substring(1);
                        firstLetter = piece.Substring(0, 1);
                        x = vowel.IndexOf(firstLetter);

                        if (x == -1)
                        {
                            pigLatinOut = (afterFirst + firstLetter + ""ay "");
                        }
                        else
                        {
                            pigLatinOut = (firstLetter + afterFirst + ""way "");
                        }
                        Console.Write(pigLatinOut);
                    }
                }
            }
            catch (Exception e)
            {
                Console.WriteLine(e.ToString());
            }
        }

        public static void Main(string[] args)
        {
            Console.WriteLine(""Enter a sentence to convert into PigLatin"");
            string sentence = """";

            sentence = Console.ReadLine();

            pigTalk(sentence);
        }
    }
}
</code></pre>
","<c#><class><methods><refactoring>","0","346","2010-10-29 16:11:07"
"4054972","Refactor: Multiple params in find query","<p>Need some help refactoring this if/else block that builds the conditions for a find query.</p>

<pre><code>if params[:status] &amp;&amp; params[:carrier]
  conditions = [""actual_delivery IS NOT NULL AND actual_delivery &gt; scheduled_delivery AND status_id = ? AND carrier_id = ?"", status.id, carrier.id]
elsif params[:status]
  conditions = [""actual_delivery IS NOT NULL AND actual_delivery &gt; scheduled_delivery AND status_id = ?"", status.id]
elsif params[:carrier]
  conditions = [""actual_delivery IS NOT NULL AND actual_delivery &gt; scheduled_delivery AND carrier_id = ?"", carrier.id]
else
  conditions = [""actual_delivery IS NOT NULL AND actual_delivery &gt; scheduled_delivery""]
end

@packages = Package.find(:all, :conditions =&gt; conditions)
</code></pre>
","<ruby-on-rails><refactoring>","1","180","2010-10-29 18:56:30"
"4059702","Java - Enum with array field","<p>I want to store a list names and individual nicknames for each name as an Enum in Java. The number of nicknames will not vary. The purpose is to be able to get a full name from a nickname. Currently I have implemented this like so:</p>

<pre><code>public enum Names {

    ELIZABETH(new String[] {""Liz"",""Bet""}),    
    ...
    ;

    private String[] nicknames;

    private Names(String[] nicknames)
    {
        this.nicknames = nicknames
    }


    public Names getNameFromNickname(String nickname) {
       //Obvious how this works
    }
}
</code></pre>

<p>I quite dislike having to repeat <code>new String[] {...}</code>, so I wondered if anyone could suggest an alternative, more concise, method of implementing this?</p>

<p>Cheers,</p>

<p>Pete</p>
","<java><arrays><refactoring><enums><constants>","1","668","2010-10-30 16:57:21"
"4063828","How to mark and remove unwanted code (methods, properties) from a .net (C#) project","<p>I have received a legacy .Net c# solution with many class library projects to review, re-factor and reuse. This solution is not used anywhere and lying in the code junkyard. The solution is compiling properly though.</p>

<p>There are 4 primary methods, that is needed from the main class library. I just want to retain all the subsequent classes, methods, properties used by these 4 methods from all the other projects in the solution and strip off all the other codes which is junk for me. Currently, i am going by manual tracing from these 4 main methods in Visual Studio 2010's ""Call Hierarchy"" feature.</p>

<p>Is there a automated process to quickly identify the related codes to my main methods and extract it to brand new shiny solution (which hopefully builds successfully) so that i just have to see the relevant code devoid of other codes that is not needed by my four main methods.</p>

<p>Thanks.</p>
","<c#><refactoring>","1","157","2010-10-31 16:00:23"
"4067795","What are the most frequent steps an Objective-C programmer will go through to refactor his code?","<p>Are there frequent processes which the programmer will go through? Or does everyone have different coding habits?</p>
","<objective-c><refactoring>","1","48","2010-11-01 09:35:24"
"4067960","How to create a method parameter object with ReSharper in a few second?","<p>Is it possible to select all the parameters of a method and ask ReSharper to create a class from those parameters as a ""method parameter object?""</p>

<p>Thanks</p>
","<.net><design-patterns><refactoring><resharper>","5","160","2010-11-01 10:05:48"
"4057791","PHP Refactoring Tool","<p>Is there any PHP refactoring tool that would transform a huge noodle code to a proper function based one?</p>
","<php><refactoring>","3","229","2010-10-30 07:52:22"
"4077980","How can I change access modifiers of more than one method in one shot by using ReSharper?","<p>Is there a short-cut in ReSharper to change more than one method's access-modifiers from something to something else? </p>

<p>Let's say I will choose methods: </p>

<pre><code>public void Method_1(){...}
private void Method_2(){...}
private void Method_3(){...}
public void Method_4(){...}
</code></pre>

<p>And by using ReSharper I will change the acess-modifiers of them to internal.</p>

<p>Is this possible?</p>
","<.net><refactoring><resharper><access-modifiers><renaming>","0","141","2010-11-02 13:14:12"
"4086306","How to explain why a developer should avoid case statements and create some new classes?","<p>I have a few times needed to try and explain to a developer why they should change a class which has multiple instances of </p>

<pre><code>switch(m_type) {
  case TYPE_A:
    ...
    break;

  case TYPE_A:
    ...
    break

  ...
}
</code></pre>

<p>Where m_type is a (final) reference to an enum defining what type of instance this is.   </p>

<p>Whenever I see this I think it's time to split the class out into multiple subclasses where the concrete class you create then defines the type. The argument I always get back is <em>'It didn't seem worth creating all these classes with hardly any code in, what are they going to have in there? like 2 methods or something!'</em></p>

<p>The best explanation I've seen is that unnecessary control logic should be avoided. If the code can be restructured to remove or avoid a branch, if, switch, etc. it should. If not, then use the control statement that is the most appropriate. From <a href=""http://c2.com/cgi/wiki?CaseStatementsConsideredHarmful"" rel=""nofollow"">here</a> but I'm not convinced this will be well received since the dev in question always thinks their code isn't too complex anyway so probably won't get why it matters.</p>

<p>This is a common enough mistake though with a very common attitude to why it exists, has anyone had any luck helping a developer understand the mistake they are making?</p>

<p>Thanks,</p>

<p>Robin</p>
","<oop><language-agnostic><refactoring><management><code-smell>","2","272","2010-11-03 10:54:37"
"4089011","refactoring and using a counter?","<p>I have the following structure:</p>

<pre><code>$text_1 = $this-&gt;getValue('value_1');
$text_2 = $this-&gt;getValue('value_2');
$text_3 = $this-&gt;getValue('value_3')
</code></pre>

<p>And also the following:</p>

<pre><code>    foreach($text_1 as $t_1)
    {
        if(!$first)
        {
            $string_1 .= "","";

        }
        $first = false;
        $string_1 .= $t_1;
    }

    foreach($text_2 as $t_2)
    {
        if(!$first)
        {
            $string_2 .= "","";

        }
        $first = false;
        $string_2 .= $t_2;
    }

    foreach($text_3 as $t_3)
    {
        if(!$first)
        {
            $string_3 .= "","";

        }
        $first = false;
        $string_3 .= $t_3;
    }
</code></pre>

<p>I was wondering if this could be re-factored to use a counter, like in a for loop, to replace the _1, _2, _3 etc from my code?</p>
","<php><refactoring>","0","70","2010-11-03 16:03:09"
"4079203","More Ruby-esque way to code this?","<p>I've got a method I'm calling expired? which is simply meant to check to see if its been more than 24 hours since my object has been updated, and if so return true. Here is my method, but although it works, it feels dirty, can anybody think of a better way to achieve my goal?</p>

<pre><code>DAY_IN_SECS = 86400

def expired?
  return true unless (Time.now &lt;=&gt; self.updated_at + DAY_IN_SECS) == -1
end
</code></pre>
","<ruby-on-rails><ruby><refactoring><metaprogramming>","1","161","2010-11-02 15:28:44"
"4091928","Xcode -- moving a variable and associated property from one class to another","<p>I find myself doing this pretty often.  Currently I am cut/pasting the variable declaration, the property, the @synthesize, and usually also the release call in the dealloc method.  That's four copy and pastes.  Is there an easy way to do all of that at once.</p>
","<xcode><refactoring>","1","114","2010-11-03 21:37:35"
"4107363","Wide Method Call VB.NET","<p>I've just written this:</p>

<pre><code>ldb.Update(emp.Code,emp.number, ""text"", String.Empty, ""EMP"", emp.scheme, emp.status, emp.tod, emp.timestamp, emp.Code, emp.oldfrmd)
</code></pre>

<p>Its far to wide! How can I shorten this method call?  The problem is this isn't my method, so I can't edit it.</p>
","<vb.net><refactoring><code-review>","1","58","2010-11-05 15:27:38"
"4115355","Netbeans and refactoring code inside edited-protected block written by Matisse gui","<p>I wrote a swing lib and i used it into my project with matisse.</p>

<p>Now i want do some name-packaging-change, a very simple operation but the problem is refactoring can't touch the code written by matisse (locked for editing).</p>

<p>So the question is:
There is a smart way to refactor all without opening my java classes in external file-editor and hand-replace what i have to replace?</p>

<p>Thank all.</p>

<p>PS. Why a great and powerful IDE like Netbeans fall in this kind of troubles?</p>
","<java><netbeans><refactoring><matisse>","1","224","2010-11-06 21:52:03"
"4124578","Java Refactor led to a Circular reference","<p>I have this sort of code in a desktop app</p>

<p>This is just a JPanel that contains buttons and that sort of thing.</p>

<pre><code>class ApplicationPanel {

   private Listener listener;

   public ApplicationPanel(){
      this.listener = new Listener(this);
   }
}
</code></pre>

<p>This adds the events to the controls in the JPanel above.</p>

<pre><code>class Listener {

   private ApplicationPanel panel;

   public Listener(ApplicationPanel panel){
      this.panel = panel;
   }
}
</code></pre>

<p>Caller code would be like this</p>

<pre><code>public void main(String[] args){
   ApplicationPanel panel = new ApplicationPanel();
}
</code></pre>

<p>If I try to apply dependency injection
And factories(later to be changed for Guice)</p>

<pre><code>class ApplicationPanel {

   private Listener listener;

   public ApplicationPanel(){
      this(new Listener());
   }

   public ApplicationPanel(Listener listener){
      this.listener = listener;
   }
}

class Listener {

   private ApplicationPanel panel;

   public Listener(){
      this(new ApplicationPanel());
   }

   public Listener(ApplicationPanel panel){
      this.panel = panel;
   }
}
</code></pre>

<p>Caller code would be like this
As you can see, there's a circular dependency in this code
Whats the best way to solve this?</p>

<pre><code>public void main(String[] args){
   Listener listener = new Listener(panel);
   ApplicationPanel panel = new ApplicationPanel(listener);

}
</code></pre>
","<java><refactoring><dependency-injection>","3","239","2010-11-08 14:05:54"
"4129543","Constantly refactoring my own code... a very bad practice","<p>I have a strange question here.</p>

<p>Am I the only programmer here that constantly feels like I must rewrite / refactoring my own codes ?</p>

<p>Sometimes I do it only because I <em>think</em> the speed might be improved, or simply because I believe
the code could be easily imported in a later project.</p>

<p>Hey, sometimes only because it looks <em>cleaner</em> for my eyes.</p>

<p>Am I sick ? Am I too perfectionism ? Am I the only one having that problem ?</p>
","<refactoring><perfectionism>","14","450","2010-11-09 00:55:25"
"4130118","How can I improve this jQuery Gmail-like interface?","<p><strong>EDIT 3:</strong> I've gotten this working by ignoring the advice given below and listening on the window, but only when an <code>input</code>, <code>text</code> field, or <code>textarea</code> is not focused. I'm not sure if this is the best way to be handling this issue, though.</p>

<p><a href=""http://jsfiddle.net/gXPES/5/"" rel=""nofollow"">http://jsfiddle.net/gXPES/5/</a></p>

<hr>

<p><strong>EDIT 2:</strong> I've tried addressing the <code>keydown</code> issue by applying <code>focus</code> and <code>blur</code> handlers to <code>input</code>s. Then I only listen for events when <code>var focus_on_input == true</code>. But it seems that not all is well. This is preventing some behaviors, but causing other, more bizarre behavior. For example, when I <kbd>tab</kbd> out of the input field, pressing <kbd>J</kbd> and <kbd>K</kbd> will jump to the top or bottom of the list. If I <code>click</code> elsewhere and shift focus, this issue is fixed. Any thoughts?</p>

<hr>

<p><strong>EDIT:</strong> Thanks to answerer help, I've limited the selectors when listening for <code>keydown</code> so that I can still type characters elsewhere, but I'm running into a new issue. When I press <kbd>J</kbd> or <kbd>K</kbd> the arrow nav jumps to the top or bottom of the task list. And when I press <kbd>C</kbd> or <kbd>#</kbd> it will notify me that no tasks are selected. <kbd>X</kbd> functions as it should and does not select a task.</p>

<hr>

<p>Hosting <a href=""http://jsfiddle.net/gXPES/"" rel=""nofollow"">this code on JSFiddle</a> since there's no possible way to comment on it in its entirety here. I've posted all my JS, CSS, and HTML used for the interface itself.</p>

<p>I'm designing a Gmail-inspired UI for task management using jQuery on the front-end (and PHP on the back-end, though it's largely irrelevant to this).</p>

<p>I'm still relatively new to jQuery development and so I realize <strong>I'm doing a number of things wrong</strong>. Until now, I simply haven't known <strong>what exactly</strong> I'm doing wrong nor <strong>how to fix it</strong>. I was hoping some more learned souls might help me (and others, hopefully) figure out how to refactor jQuery code for a larger-sized application.</p>

<p>To start, here are a number of things I would like to know how to do better:</p>

<ol>
<li><p>Call this code only when the task interface is active.</p></li>
<li><p>Improve the listening for the <code>keydown</code> event. Currently I listen for <kbd>J</kbd>, <kbd>K</kbd>, <kbd>X</kbd>, <kbd>Shift+3</kbd>, and <kbd>C</kbd>. I will also be listening on <kbd>E</kbd> for task editing, but haven't yet implemented edits. <strong>The problem with the listeners</strong> is related to my first concern, which <strong>is that they are always on</strong>. This means that pressing <kbd>J</kbd> while in a <code>&lt;textarea&gt;</code>, for example, will not result in the default behavior.</p></li>
<li><p>Use less HTML in my code.</p></li>
<li><p>Make my code generally more DRY.</p></li>
</ol>

<p>Any thoughts, no matter how critical, are more than welcome. Again, I realize I am not following best practices here, but that's because I'm dumb to them. I want to learn, and hope to use this opportunity to do so.</p>

<p>Cheers!</p>
","<jquery><gui><refactoring><gmail><refactor-my-code>","6","909","2010-11-09 02:59:10"
"4122960","Refactoring models from one django app into two","<p>I've got an app which has grown too big and I'd like to split it into two. It's not an easy task code-wise, but I'm more afraid of the database migrations I'll have to perform. Is there a proven way of doing such kind of thing?</p>

<p>Currently my thoughts are something like this:</p>

<ul>
<li>Use south</li>
<li>Copy models to another app</li>
<li>Make a data migration to copy relevant models from one app to the other</li>
<li>Make another migration that removes the now unused models from the old app</li>
<li>Will have to make a script that does those operations in correct order</li>
</ul>

<p>Has anybody done anything like this?</p>
","<django><django-models><refactoring>","0","43","2010-11-08 10:19:50"
"4136279","Code refactoring of 2 duplicate methods","<p>Basically I have 2 methods that are similar in functionality. The only difference is the class container that are different. What I am trying to achieve is to unify these 2 methods and somehow have the container be dynamic.</p>

<p>here are the 2 methods:</p>

<pre><code>-(NSMutableArray*) parseRequest:(NSArray*)elements {
    NSMutableArray *currentStruct = [NSMutableArray array];
    for (id element elemets) {
        // This is where the difference is
        FriendRequest *friend = [[FriendRequest alloc] init];

        if(nickname != nil) {
            friend.nickname = [element objectAtIndex:0];
        }
        [currentStruct addObject:friend];   
        [friend release];

    }
    return currentStruct;
}
</code></pre>

<p>Second:</p>

<pre><code>-(NSMutableArray*) parseRequest:(NSArray*)elements {
    NSMutableArray *currentStruct = [NSMutableArray array];
    for (id element elemets) {
        // This is where the difference is
        Friend *friend = [[Friend alloc] init];

        if(nickname != nil) {
            friend.nickname = [element objectAtIndex:0];
        }
        [currentStruct addObject:friend];   
        [friend release];

    }
    return currentStruct;
}
</code></pre>
","<iphone><objective-c><refactoring><nsmutablearray>","1","79","2010-11-09 16:55:31"
"4136738","find dead JavaScript code?","<p>We are refactoring a legacy web app and as a result are ""killing"" quite a lot of JavaScript code but we're afraid of deleting what we think is dead code due to not being sure.  Is there any tool / technique for positively identifying dead code in JavaScript?</p>
","<javascript><refactoring><dead-code>","12","992","2010-11-09 17:41:13"
"4158045","How to write this in a simpler way","<pre><code>i = 0
for x in range(0, 5):
    for y in range(0, 5):
        if 0 == outputAfterLearning[i]:
            image.putpixel((x, y), (0, 0, 0))
        elif 1 == outputAfterLearning[i]:
            image.putpixel((x, y), (255, 255, 255))
        i += 1

for x in range(0, 5):
    for y in range(5, 10):
        if 0 == outputAfterLearning[i]:
            image.putpixel((x, y), (0, 0, 0))
        elif 1 == outputAfterLearning[i]:
            image.putpixel((x, y), (255, 255, 255))
        i += 1

for x in range(5, 10):
    for y in range(0, 5):
        if 0 == outputAfterLearning[i]:
            image.putpixel((x, y), (0, 0, 0))
        elif 1 == outputAfterLearning[i]:
            image.putpixel((x, y), (255, 255, 255))
        i += 1

for x in range(5, 10):
    for y in range(5, 10):
        if 0 == outputAfterLearning[i]:
            image.putpixel((x, y), (0, 0, 0))
        elif 1 == outputAfterLearning[i]:
            image.putpixel((x, y), (255, 255, 255))
        i += 1
</code></pre>

<p>As you can see, I am iterating over an image using 5x5px squares and setting pixels in them.</p>

<p>The above code is obviosuly for image with dimensions 10x10px but I would like to write the above code in a more general way so I can use it for larger images (say 30x30px) without adding 32 new for loops.</p>
","<python><optimization><refactoring>","3","108","2010-11-11 18:45:18"
"4159340","Transition from thread model to actors","<p>Trying to get a handle on how to think in terms of actors instead of threads. I'm a bit stumped on the following use case:</p>

<blockquote>
  <p>Consider a system that has a producer process that creates work (e.g. by reading data from a file), and a number of worker processes that consume the work (e.g. by parsing the data and writing it to a database). The rates at which work is produced and consumed can vary, and the system should remain robust to this. For example, if the workers can't keep up, the producer should detect this and eventually slow down or wait.</p>
</blockquote>

<p>This is pretty easy to implement with threads:</p>

<pre><code>val producer:Iterator[Work] = createProducer()
val queue = new LinkedBlockingQueue[Work](QUEUE_SIZE)
val workers = (0 until NUM_WORKERS) map { i =&gt;
  new Thread() { 
    override def run() = {
      while (true) {
        try {
          // take next unit of work, waiting if necessary
          val work = queue.take()
          process(work)
        }
        catch {
          case e:InterruptedException =&gt; return
        }
      }
    }
  }
}

// start the workers
workers.foreach(_.start())

while (producer.hasNext) {
  val work = producer.next()
  // add new unit of work, waiting if necessary
  queue.put(work)
}

while (!queue.isEmpty) {
  // wait until queue is drained
  queue.wait()
}

// stop the workers
workers.foreach(_.interrupt())
</code></pre>

<p>There's nothing really wrong with this model, and I've successfully used it before. This example is probably overly verbose, as using an Executor or CompletionService would fit this task well. But I like the actor abstraction, and think it's easier to reason about in many cases. Is there a way to rewrite this example using actors, especially making sure that there are no buffer overflows (e.g. full mailboxes, dropped messages, etc)?</p>
","<scala><concurrency><refactoring><actor>","7","416","2010-11-11 21:15:15"
"4159395","Method refactoring","<p>How many lines of code can a method have with a good design before you need to make the design better? </p>
","<design><refactoring>","3","121","2010-11-11 21:23:22"
"4159693","Refactoring code smells in ASP.NET Web Forms Code Behind Files: Is it wise? Is it risky? Is it a waste of time?","<p>Given a <a href=""http://stackoverflow.com/questions/114342/what-are-code-smells-what-is-the-best-way-to-correct-them/114352#114352"">long method</a> with <a href=""http://stackoverflow.com/questions/114342/what-are-code-smells-what-is-the-best-way-to-correct-them/116414#116414"">Pac-Man ifs</a>, would it be wise to:</p>

<ol>
<li>Break down code blocks into regions.</li>
<li>Then refactor code blocks into methods.</li>
</ol>

<p>Or would it be best to leave it alone?</p>

<p>Would it be risky?<br>
Would it be a waste of time?</p>

<p>In the absence of automated unit-tests, I'm trying to understand the risk-reward relationship associated with this manuever.</p>
","<refactoring><codebehind><code-smell><asp.net-webforms><code-regions>","0","150","2010-11-11 22:00:45"
"4172545","C++ code purity question","<p>I'm working in C++ enviroment and:<br>
a) We are forbidden to use exceptions<br>
b) It is application/data server code that evaluates lot of requests of different kinds</p>

<p>I have simple class encapsulating result of server operation that is also used internally for lot of functions there.</p>

<pre><code>class OpResult
{
  .....
  bool succeeded();
  bool failed(); ....
  ... data error/result message ...
};
</code></pre>

<p>As I try to have all functions small and simple, lot of blocks like this are arising:</p>

<pre><code>....
OpResult result = some_(mostly check)function(....);
if (result.failed())
  return result;
...
</code></pre>

<p>The question is, is it bad practise to make macro looking like this and use it everywhere?</p>

<pre><code>#define RETURN_IF_FAILED(call) \
  {                            \
    OpResult result = call;    \
    if (result.failed())       \
      return result;           \
  }
</code></pre>

<p>I understand that someone can call it nasty, but is there a better way?
What other way of handling results and avoiding lot of bloat code would you suggest?</p>
","<c++><refactoring><error-handling><results>","8","298","2010-11-13 12:44:18"
"4173989","Should I declare my Swing components as instance variables, or just return them from functions?","<p>I am just getting started with JAVA and I am trying to figure out what the best practice for declaring variables would be, esp in regards to GUI components. I am trying to keep my functions as small as possible, but I am not sure if I should declare all my components as instance variables for my GUI class. </p>

<p>In this code, I was thinking to only declare major parts of the gui, such as the frame, panel, menuBar and the menus themselves, but I am not sure which parts I should be declaring as instance variables and what parts should be encapsulated.</p>

<pre><code>class MyClass {

    public JFrame frame;
    public JPanel panel;
    public JMenuBar menuBar;
    public JMenu fileMenu;
    public JMenu editMenu;

    ....
    public void setUpEditMenu() {
          editMenu = new JMenu(""Edit"");
          editMenu.add(getEditMenuItem());
    }

    public JMenuItem getEditMenuItem() {
          JMenuItem menuItem = new JMenuItem(""Preferences"");
          return menuItem;
    }
}
</code></pre>
","<java><gui><swing><refactoring>","1","170","2010-11-13 18:11:08"
"4178128","To DRY or not to DRY? On avoiding code duplication and retaining cohesion","<p>I've got a question concerning code duplication and refactoring, hope it's not too general. Say you've got a rather small piece of code (~5 lines) which is a sequence of function invocations <em>that is - not a very low level</em>. This code is repeated in several places, so it would probably be a good idea to extract a method here. However, in this particular example, this new function would suffer from low cohesion (which manifests itself, among others, by having a hard time finding a good name for the function). The reason for that is probably because this repeated code is just a part of a bigger algorithm - and it's difficult to divide it into well named steps.</p>

<p>What would you suggest in such scenario?</p>

<p>Edit:</p>

<p>I wanted to keep the question on a general level, so that more people can potentially find it useful, but obviously it would be best to back it up with some code sample. The example might not be the best one ever (it smells in quite a few ways), but I hope it does its job:</p>

<pre><code>class SocketAction {

    private static class AlwaysCreateSessionLoginHandler extends LoginHandler {
        @Override
        protected void onLoginCorrect(SocketAction socketAction) throws IllegalAccessException, IOException {
            Server.checkAllowedDeviceCount(socketAction._sess.getDeviceID());
            socketAction.registerSession();
            socketAction._sess.runApplication();
        }
    }

    private static class AutoConnectAnyDeviceLoginHandler extends LoginHandler {
        @Override
        protected void onLoginCorrect(SocketAction socketAction) throws IllegalAccessException, IOException {
            if (Server.isUserRegistered(socketAction._sess.getUserLogin())) {
                Log.logSysInfo(""Session autoconnect - acquiring list of action threads..."");
                String[] sa = Server.getSessionList(socketAction._sess.getUserID());
                Log.logSysInfo(""Session autoconnect - list of action threads acquired."");
                for (int i = 0; i &lt; sa.length; i += 7) {
                    socketAction.abandonCommThreads();
                    Server.attachSocketToSession(sa[i + 1], socketAction._commSendThread.getSock());
                    return;
                }
            }
            Server.checkAllowedDeviceCount(socketAction._sess.getDeviceID());
            socketAction.registerSession();
            socketAction._sess.runApplication();
        }
    }

    private static class OnlyNewSessionLoginHandler extends LoginHandler {
        @Override
        protected void onLoginCorrect(SocketAction socketAction) throws IllegalAccessException, IOException {
            socketAction.killOldSessionsForUser();
            Server.checkAllowedDeviceCount(socketAction._sess.getDeviceID());
            socketAction.registerSession();
            socketAction._sess.runApplication();
        }
    }
}
</code></pre>
","<language-agnostic><refactoring><code-duplication>","7","230","2010-11-14 15:26:05"
"4190059","rename refactor in eclipse","<p>While developing Eclispe plugin, I am able to programmatically rename a class-field using the following code.</p>

<pre><code>RenameSupport renameSupport = RenameSupport.create(field, newName, RenameSupport.UPDATE_REFERENCES);
renameSupport.perform(workbench.getShell(), workbench);
</code></pre>

<p>But it applies the changes to the actual source files. Is there anyway that can be prevented? I just need the renamed code internally (for performing some other computations), must not change the actual source. </p>

<p>Please suggest.</p>
","<java><refactoring><rename><eclipse-plugin-dev>","1","452","2010-11-16 00:04:21"
"4191289","How to write elegant perl code without ref","<p>Help me code this scenario better. Let's say I have a baseclass named ""car"", and two derived
classes named ""Ferrari"" and  ""Chevrolet"". Now I have an new class named ""ParkingLot"", which should know what the car it is operating on, to customize the lot-size and other attributes. </p>

<p>Now back to the problem. The current codebase that Iam working on is very matured, and it's complete written in Perl OOPS. The ""ParkingLot"" constructor will always be passed with the car object (instantiated much before this) as an argument. The code(Parking Lot) uses this argument, does a ref on object pointer to find whether the class is ""Ferrari""/""Chevrolet"" and does some very specific operations based on the car Type. This example, I would say is a ""tip of the iceberg"" and these kind of code is littered everywhere throughout the code making it more unmaintainable.</p>

<p>Tommorow, if I want to add a new car, that my parking Lot should support, then it's becomes a nightmare to check for references all through the code and do the changes manually. What would you do  to rework the code to make it more elegant and maintainable?</p>
","<perl><oop><refactoring>","1","153","2010-11-16 04:41:09"
"4192096","Which is more efficient a method returning a Func<bool> or returning bool?","<p>I am refactoring some LINQ queries and am trying to determine the most efficient refactor.</p>

<p>The original line is a query similar to:</p>

<pre><code>  static void Main() {
     var list = new List&lt;string&gt; { ""A"", ""BB"", ""CCC"" };
     var shortList = list.Any(name =&gt; name.Length == 1);
  }
</code></pre>

<p>I can refactor out the string length check to a method as follows:</p>

<pre><code>  static void Main() {
     var list = new List&lt;string&gt; { ""A"", ""BB"", ""CCC"" };
     var shortList = list.Any(name =&gt; IsShort(name));
  }

  private static bool IsShort(string name) {
     return name.Length == 1;
  }
</code></pre>

<p>OR, I can refactor out the complete Func to a method:</p>

<pre><code>  static void Main() {
     var list = new List&lt;string&gt; { ""A"", ""BB"", ""CCC"" };
     var shortList = list.Any(IsShortFunc());
  }

  private static Func&lt;string, bool&gt; IsShortFunc() {
     return name =&gt; name.Length == 1;
  }
</code></pre>

<p>The question is, which is more efficient at run time?</p>
","<.net><refactoring><performance>","1","98","2010-11-16 07:53:21"
"4214132","What C++ refactorings do you use in practice?","<p>I'm going to create the comparison table of existing automated C++ refactoring tools as well as explore an ability of creation of such tool, free and open-source.</p>

<p>My question is: what refactorings do you really use in your everyday work? There are obvious things like renaming variable/class/method, but is there something specific for C++, like dealing with templates, STL, copy constructors, initializers, etc., etc?</p>

<p>I'm interested in building of realistic picture of all that little problems that C++ developer is facing each day in his coding and that could be automated at least in theory. I'm talking to my colleagues but that's probably not enough.</p>

<p>Thanks in advance.</p>
","<c++><refactoring><automated-refactoring>","5","258","2010-11-18 11:14:46"
"4217612","Eclipse CDT move-file and rename-file refactoring?","<p>Is there a way in Eclipse CDT to do the following automatic refactorings?</p>

<ol>
<li><strong>move file</strong>: move a source/header file to another project folder and have every <em>#include</em> directive relative to the moved file automatically updated</li>
<li><strong>rename file</strong>: rename a source/header file and have every <em>#include</em> directive relative to the renamed file automatically updated</li>
</ol>

<p>If there is no such feature in CDT, is there another tool for Linux that would easily let me do this?</p>

<p>Thank you very much.</p>
","<c++><file><refactoring><eclipse-cdt>","3","410","2010-11-18 17:14:33"
"4217860","Code review tool for prep for large change to codebase","<p>I have to perform a large change to a codebase that consists of a handful of different types of changes that need to be applied in hundreds of different locations, spread out over hundreds of thousands of lines.</p>

<p>I have an idea for a tool that can help me with this, but as I'm sure I'm not the only one with this idea, I wonder if it's already been written.</p>

<p>Let me outline how it would work:</p>

<ul>
<li>First, a bit like grep with context, it would collect a set of ""interesting"" chunks of code based on a regular expression; there may be thousands of these locations.</li>
<li>Then, let me iterate through chunks, marking each in turn as Interesting or Uninteresting. This is basically automating as much as possible of the manual job of whittling down potential change locations to actual change locations.</li>
<li>Finally, let me apply a transformation (e.g. sed-style substitution) to all selected Interesting locations.</li>
</ul>

<p>Does this tool already exist?</p>

<p>I'm thinking of writing this tool myself if I can't find a pre-existing one.</p>
","<refactoring><code-review><mechanize>","7","171","2010-11-18 17:43:48"
"4219474","Inline all static imports in eclipse","<p>I was cleaning up some code and happened upon <code>com.example.StringHelper</code> that contained 6 or 7 <code>public static</code> methods (for example <code>concatStrings(String...)</code>, but no member fields. There were a number of classes subclassing this class just so they could call <code>concatStrings(str1, str2)</code> without prefixing it with the class like so: <code>StringHelper.concatStrings(str1, str2)</code>.</p>

<p>I didn't want them subclassing a class just for that reason, so I broke a bunch off. I pasted the following static import into the top of any file subclassing it after removing the <code>extends StringHelper</code>:</p>

<pre><code>import static com.example.StringHelper.*;
</code></pre>

<p>Eclipse simplified this into specific imports for only the methods being used.</p>

<p><strong>Question</strong>: Is there a simple way to have Eclipse ""inline"" these static imports? Can I get it to remove the actual static import and prefix every call with <code>StringHelper.</code> instead?</p>

<p><strong>Note</strong>
This is a simplified contrived example, so please don't complain about why we need a StringHelper in the first place.</p>
","<java><eclipse><refactoring>","0","469","2010-11-18 20:51:58"
"4208058","Creating custom XML widgets for Android UI","<p>I'm trying to encapsulate certain layouts that I've made, to help me dry up my android xml ui files. </p>

<p>I have the following code:</p>

<pre><code>        &lt;LinearLayout
            android:id=""@+id/LinearLayout02""
            android:layout_height=""wrap_content""
            android:layout_width=""fill_parent""
            android:orientation=""horizontal""&gt;

            &lt;TextView
                style=""@style/text_view_small""
                android:id=""@+id/time""&gt;&lt;/TextView&gt;
            &lt;TextView
                style=""@style/text_view_small""
                android:id=""@+id/number_of_worlds""&gt;
            &lt;/TextView&gt;
        &lt;/LinearLayout&gt;
</code></pre>

<p>I want to simply convert it to the following</p>

<pre><code>&lt;DoubleTextView&gt;&lt;/DoubleTextView&gt;
</code></pre>

<p>Once done I want to be able to use the ""widgit"" in other xml files.
Are there any particular resources or examples that I can look at to help me figure out how to do this?</p>
","<android><refactoring><android-ui><android-xml><advice>","0","633","2010-11-17 18:57:37"
"4221344","Question about Auto-Implemented Properties C#","<p>I have this code:</p>

<pre><code>void Main()
{
    List&lt;Employee&gt; employeeList;

    employeeList = new List&lt;Employee&gt;
    {
        {new Employee(""000001"", ""DELA CRUZ, JUAN T."")},
        {new Employee(""000002"", ""GOMEZ, MAR B."")},
        {new Employee(""000003"", ""RIVERA, ERWIN J."")}
    };

    employeeList.Dump();
}

public class Employee
{
    public string EmployeeNo { get; set; }
    public string Name { get; set; }

    public Employee(string employeeNo, string name)
    {
        this.EmployeeNo = employeeNo;
        this.Name = name;
    }   
}
</code></pre>

<p>How should I make a new instance of Employee class using the properties only and add that instance to the employeeList (I mean not using the class constructor of employee)?</p>

<p>I already made a solution but it's too lengthy. How should I shorten it?</p>

<pre><code>void Main()
{   
    List&lt;Employee&gt; employeeList;

    #region - I want to shorten these lengthy codes. 
    Employee employee1 = new Employee();
    employee1.EmployeeNo = ""000001"";
    employee1.Name = ""DELA CRUZ, JUAN T."";

    Employee employee2 = new Employee();
    employee2.EmployeeNo = ""000002"";
    employee2.Name = ""GOMEZ, MAR B."";
    // other employees...
    #endregion

    employeeList = new List&lt;Employee&gt;
    {
        employee1,
        employee2
    };

    employeeList.Dump();
}

public class Employee
{
    public string EmployeeNo { get; set; }
    public string Name { get; set; }    
}
</code></pre>
","<c#><refactoring>","1","116","2010-11-19 01:25:53"
"4226284","How to convince a colleague that code duplication is bad?","<p>A colleague of mine was implementing a new feature in a project we work on together and he did it by taking a file containing the implementation of a similar feature from the same project, creating a copy of it renaming all the global declarations and slightly modifying the implementation. So we ended up with two large files that are almost identical apart from renaming.</p>

<p>I tried to explain that it makes our project more difficult to maintain but he doesn't want to change anything saying that it is easier for him to program in such way and that there is no reason to fix the code if it ""ain't broke"".</p>

<p>How can I convince him that such code duplication is a bad thing?</p>

<p>It is related to <a href=""http://stackoverflow.com/q/2490884/471164"">this questions</a>, but I am more interested in the answers targeted to a technical person (another programmer), for example a reference to an authoritative source like a book would be great.
I have already tried simple arguments and haven't succeeded.</p>
","<refactoring><coding-style><copy-paste><code-duplication>","14","667","2010-11-19 15:08:34"
"4232338","Refactor my code: Conditions based on different variables","<p>Given:</p>

<pre><code>internal void Configure(ButtonEventArgs args, IBroker broker, FunctionEntry entry)
        {
            int phase = broker.TradingPhase;

            if (args.Button == ItemType.SendAutoButton)
            {                              
                if (phase == 1)
                {
                    entry.SetParameter(""ANDealerPrice"", -1);
                    entry.SetParameter(""ANAutoUpdate"", 4);
                }
                else if (phase == 2)
                {
                    entry.SetParameter(""ANDealerPrice"", -1);
                    entry.SetParameter(""ANAutoUpdate"", 2);
                }
            }

            if (phase == 1)
            {
                if (broker.IsCashBMK)
                {
                    entry.SetParameter(""Value"", 100);

                }
                else if (broker.IsCross)
                {

                    entry.SetParameter(""Value"", 200);

                }
            }
}
</code></pre>

<p>I am looking for suggestions to refactor the code above.
As suggested by Fowler: ""Replace condition with Strategy/polymorphism"", i fail to implement an effective code on these line. Since there are multiple conditions, base on mutiple variables.</p>

<p>Please suggest if there could be a pattern that could eliminate these error-prone and ugly conditions (code smell).</p>

<p>Thanks for your interest.</p>

<p>Edit: 
1) My intention is to apply Open-Closed principle here, so that if tommorrow if there is a change in logic i can extend these conditions by introducing a new class.
2) Please don't mind the magic numbers, in real scenario i have valid constant/source for them.</p>
","<c#><design-patterns><refactoring><refactor-my-code>","3","187","2010-11-20 10:48:46"
"4238960","How to refactor this Objective-C code","<p>I have two methods in a DB helper class that do basically the same thing for two different database entities, and I would like to refactor them to avoid duplicating code.</p>

<p>The first entity:</p>

<pre><code>- (void) insertOrUpdateEntityA:(NSDictionary*)data {
    sqlite3_stmt *exists_stmt;
    if(sqlite3_prepare_v2(database, RMSQLEntityAExists, -1, &amp;exists_stmt, NULL) == SQLITE_OK) {
        [RMStoreDB bindPrimaryKey:exists_stmt data:data from:1];
        if (sqlite3_step(exists_stmt) == SQLITE_ROW) {
            int count = sqlite3_column_int(exists_stmt, 1);
            sqlite3_stmt *update_stmt;
            if (count) { // Update
                if (sqlite3_prepare_v2(database, RMSQLEntityAUpdate, -1, &amp;update_stmt, NULL) == SQLITE_OK) {
                    int index = [RMStoreDB bindEntityA:update_stmt data:data from:1];
                    [RMStoreDB bindPrimaryKey:update_stmt data:data from:index];
                }
            } else { // Insert
                if (sqlite3_prepare_v2(database, RMSQLEntityAInsert, -1, &amp;update_stmt, NULL) == SQLITE_OK) {
                    int index = [RMStoreDB bindPrimaryKey:update_stmt data:data from:1];
                    [RMStoreDB bindEntityA:update_stmt data:data from:index];
                }           
            }
            sqlite3_step(update_stmt);
            sqlite3_finalize(update_stmt);
        }           
    }
    sqlite3_finalize(exists_stmt);
}
</code></pre>

<p>The second entity:</p>

<pre><code> - (void) insertOrUpdateEntityB:(NSDictionary*)data {
    sqlite3_stmt *exists_stmt;
    if(sqlite3_prepare_v2(database, RMSQLEntityBExists, -1, &amp;exists_stmt, NULL) == SQLITE_OK) {
        [RMStoreDB bindPrimaryKey:exists_stmt data:data from:1];
        if (sqlite3_step(exists_stmt) == SQLITE_ROW) {
            int count = sqlite3_column_int(exists_stmt, 1);
            sqlite3_stmt *update_stmt;
            if (count) { // Update
                if (sqlite3_prepare_v2(database, RMSQLEntityBUpdate, -1, &amp;update_stmt, NULL) == SQLITE_OK) {
                    int index = [RMStoreDB bindEntityB:update_stmt data:data from:1];
                    [RMStoreDB bindPrimaryKey:update_stmt data:data from:index];
                }
            } else { // Insert
                if (sqlite3_prepare_v2(database, RMSQLEntityBInsert, -1, &amp;update_stmt, NULL) == SQLITE_OK) {
                    int index = [RMStoreDB bindPrimaryKey:update_stmt data:data from:1];
                    [RMStoreDB bindEntityB:update_stmt data:data from:index];
                }           
            }
            sqlite3_step(update_stmt);
            sqlite3_finalize(update_stmt);
        }           
    }
    sqlite3_finalize(exists_stmt);
}
</code></pre>

<p>The differences are the constants used for the SQL statements (<code>RMSQLEntityAExists</code>, <code>RMSQLEntityBExists</code>, etc.) and the method used to bind the data to the SQLite statement (<code>bindEntityA</code> and <code>bindEntityB</code>). The latter is what I'm finding particularly challenging to generalize.</p>

<p>How do I refactor these two methods? Should I?</p>
","<objective-c><sqlite><refactoring><refactor-my-code>","1","415","2010-11-21 16:43:56"
"4238902","Refactoring / layout of functional Scala","<p>This one liner...</p>

<pre><code> Console.println(io.Source.fromFile(""names.txt"").getLines.mkString.split("","").map{x:String =&gt; x.slice(1, x.length -1)}.sortBy { x =&gt; x}.zipWithIndex.map{t =&gt;{ (t._2 +1)*(t._1.map{_.toChar - ""A""(0).toChar + 1}.sum)}}.sum);
</code></pre>

<p>... is my solution to <a href=""http://projecteuler.net/index.php?section=problems&amp;id=22"" rel=""nofollow"">Project Euler problem 22</a>. It seems to work, and it's written in (my attempt at) functional style.</p>

<p>This example is a bit extreme, but my question is a bit more general - how do you prefer to write/format/comment functional style code? The functional approach seems to encourage a sequence of method calls, which I find can get unreadable, and also leaves nowhere obvious to put comments.</p>

<p>Also, when I write procedural code, I find I write small methods each with one purpose and with meaningful names. When I write functional code, I seem to be developing a habit that produces lines a little like the one above, where (to me) the meaning is difficult to decipher - and also the individual computations are difficult to re-use elsewhere. Quite a lot of the functional code examples I see on the web are similarly terse (to me) obscure.</p>

<p>What should I be doing? Writing little functions for each part of the computatation with names meaningful in the current context? (even if they're little more than a wrapper for map, say?)</p>

<p>For the example I've given, what are better ways of writing it, and presenting it?</p>

<p>(Like all style questions, this one is subjective. There's no reason it should get argumentative, though!)</p>
","<scala><refactoring><functional-programming><coding-style>","12","357","2010-11-21 16:30:56"
"4256820","Quality Assurance of Legacy Code being refactored","<p>Our team is planning to re-factor some of the module in legacy code base.Its a web application written in java.  It has no unit tests at all.</p>

<p>I asked developer to write a junit for existing functionality before re-factoring, but I am sure that will not be very extensive.</p>

<p>what are the other measures (blackbox / whitebox / processes) i can take to make sure the re-factoring doesn't disturb any existing functionality.</p>

<p>the current system is pretty stable and has been running more than 8 years.</p>

<p>Thanks
Gray</p>
","<refactoring><qa>","2","110","2010-11-23 14:11:06"
"4266335","Are there any techniques to split a method with a flag argument?","<p>I have a method with a flag argument. I think that passing a boolean to a method is a bad practice (complicates the signature, violates the ""each method does one thing"" principle). I think splitting the method into two different methods is better. But if I do that, the two methods would be very similar (code duplication).</p>

<p>I wonder if there are some general techniques for splitting methods with a flag argument into two separate methods. </p>

<p>Here's the code of my method (Java):</p>

<pre><code>int calculateNumOfLiveOrDeadNeighbors(Cell c, int gen, boolean countLiveOnes) {
   int x = c.getX();
   int y = c.getY();
   CellState state;
   int aliveCounter = 0;
   int deadCounter = 0;
   for (int i = x - 1; i &lt;= x + 1; i++) {
      for (int j = y - 1; j &lt;= y + 1; j++) {
         if (i == x &amp;&amp; j == y)
            continue;
         state = getCell(i, j).getCellState(gen);
         if (state == CellState.LIVE || state == CellState.SICK){
            aliveCounter++;
         }
         if(state == CellState.DEAD || state == CellState.DEAD4GOOD){
            deadCounter++;
         }
      }
   }
   if(countLiveOnes){
      return aliveCounter;
   }
   return deadCounter;
}
</code></pre>
","<java><refactoring><flags><coding-style>","7","205","2010-11-24 11:41:21"
"4276406","Are there any refactoring tools for Emacs C++ Programming?","<p>Just like eclipse does, extracting function, renaming a variable, and so on</p>
","<c++><eclipse><emacs><refactoring>","2","551","2010-11-25 11:17:10"
"4272998","Preventing others from calling a function based on a condition, but always allowing the class to call it?","<p>I wasn't sure how to call this. Basically I have a Label widget. It has an auto size feature. The problem is I do not know who calls setSize(); I need to know if the class called it or if the user of the label called it because you cannot resize an auto sizing widget. I cannot directly change the size because, well 1, it's not very OO, and 2 I cannot access it because the size is in the base class. I can only override setSize() but without knowing who called it, I cannot filter out anyone.</p>

<p>Thanks</p>
","<c++><refactoring>","0","58","2010-11-25 01:21:37"
"4279165","What Kind of C# Refactoring Options Exist for Visual Studio (and C#)?","<p>Having now read Martin Fowler's ""Refactoring,"" I would like to know what refactoring options are available in Visual Studio (Express especially, and for C# especially). The built-in IDE seems to just have Rename Variable and Extract Method; what's surprising is that 2003 (non-express) has around half-a-dozen refactorings.</p>

<p>What kind of tools and options are available, other than the IDE and refactoring by hand? I primarily use Express versions of Visual Studio, so brownie points for finding something that'll work without Visual Studio Professional.</p>
","<c#><visual-studio-2010><tools><refactoring><visual-studio-express>","1","209","2010-11-25 16:35:14"
"4280871","Refactoring a class","<p>I have two almost identical classes, in fact every member function is identical, every member is identical, every member function does exactly the same thing. The only difference between those classes is the way I can define variable of their type:</p>

<pre><code>AllocFactorScientific&lt;102,-2&gt; scientific;
AllocFactorLinear&lt;1.2&gt; linear;  
</code></pre>

<p>Here are headers for them:  </p>

<pre><code>template&lt;double&amp;&amp; Factor&gt;
struct AllocFactorLinear;

template&lt;short Mantissa, short Exponent, short Base = 10&gt;
struct AllocFactorScientific
</code></pre>

<p>My question is how can I refactor those functions out of those classes that would allow me to have just one set of functions and not two sets of identical functions.</p>
","<c++><refactoring><c++0x>","5","146","2010-11-25 21:10:05"
"4283501","MySQL Join and inner selects","<p>I currently have a query</p>

<blockquote>
  <p>SELECT id FROM table1 WHERE {filters on table1} AND id NOT IN (SELECT table1ID FROM table2 WHERE condition = 0)</p>
</blockquote>

<p>Table1 has a 1 - Many relationship with table2 and I'm looking for all the IDs that have no entries in table2 with condition=0.</p>

<p>Is there any way to rewrite this query without the inner select? I'm been scratching my head about it for a while now and any pointers would be welcome.</p>
","<mysql><select><join><refactoring>","1","66","2010-11-26 08:11:21"
"4285298","Will call to function which calls assert will be removed in Release ver of a program?","<p>If I have something like:  </p>

<pre><code>static long double calcFactor_(const short mantissa, const short exponent,const short base = Derived::internals_.base_)
        {
            assert(mantissa &gt; 0);
            assert(mantissa &lt; NumericLimits&lt;short&gt;::max);
            assert(exponent &lt; NumericLimits&lt;short&gt;::max);
            assert(exponent &gt; NumericLimits&lt;short&gt;::min);
            assert(base &lt; NumericLimits&lt;short&gt;::max);
            assert(base &gt; NumericLimits&lt;short&gt;::min);
            return mantissa * ::pow(static_cast&lt;long double&gt;(base),exponent);
        }  
</code></pre>

<p>and in other places in my program I'm also using those identical calls to assert, so I would like to move it out of this fnc body to the separate fnc and place only call to this fnc in places where I have those calls to assets now. But correct me if I'm wrong: Those calls to assert will be removed in release ver but if I have:  </p>

<pre><code>void Assert (//neccesary args here)
{
assert(mantissa &gt; 0);
                assert(mantissa &lt; NumericLimits&lt;short&gt;::max);
                assert(exponent &lt; NumericLimits&lt;short&gt;::max);
                assert(exponent &gt; NumericLimits&lt;short&gt;::min);
                assert(base &lt; NumericLimits&lt;short&gt;::max);
                assert(base &gt; NumericLimits&lt;short&gt;::min);
}
</code></pre>

<p>will call to this fnc be also removed from release ver or not? And another Q I think that instead of asserts here I should have if(!condition) checks because what is the benefit of having asserts if they will be removed in a final ver. What do you think?</p>
","<c++><refactoring><assert>","1","155","2010-11-26 12:31:31"
"4293323","Finding Implicit Communication in Classes","<p>I am currently refactoring a very useful but poorly designed class in C++, and I'm running into a problem with the design: rather passing data around using arguments to methods, the data is passed around by setting private state variables in the class. This makes it very difficult for me to diagram out how data moves through functions. It's my weekend task to try and remove this style of passing data around as much as possible, as makes the program very impossible to understand from just the method signatures, as the signatures only tell a part of the story. I've decided </p>

<p>My current approach to test if a method communicates using private class-level variables is the following:</p>

<ol>
<li>Edit the method and make it a function rather than a method, which removes its access to the  state variables in the class.</li>
<li>Edit all of the calls to the method so that they call the function rather than the method.</li>
<li>Compile, see if anything breaks. Make a list of accessors to add to the original class.</li>
<li>Run the unit tests to see if I've broken anything in a very subtle way.</li>
</ol>

<p>Is there a better way of doing this, perhaps one that can be easily automated? Is this refactoring a well-known technique that I can cite if I show it to other people? </p>

<p>The only mention of this problem that I've found so far is this quote from <a href=""http://www.codersatwork.com/"" rel=""nofollow"">Coders at Work</a> via the <a href=""http://en.wikipedia.org/wiki/Object-oriented_programming"" rel=""nofollow"">Object-oriented programming Wikipedia entry</a>:</p>

<p>""The problem with object-oriented languages is they've got all this implicit environment that they carry around with them. You wanted a banana but what you got was a gorilla holding the banana and the entire jungle."" - Joe Armstrong</p>

<p>Edit in response to a good question from <a href=""http://stackoverflow.com/users/129570/oli-charlesworth"">Oli Charlesworth</a>:</p>

<p>I understand that the point of OOP is to sometimes communicate through state variables of the class. The difficulty with my current case is that there are currently 78 different data members in the class, many of which are key-value pairs of strings to other data types, and there are undocumented implicit dependencies on the order in which they need to be initialized. It's possible that given a sufficiently smart programmer working with this class would be easy, but it's currently very difficult for me. I think that several of these data types could be abstracted into their own classes, but before I can do that I need to understand more clearly how the data members interact with each other.</p>
","<c++><design><testing><refactoring>","2","101","2010-11-27 18:58:28"
"4293411","How to efficiently refactor in a qooxdoo project","<p>I am just working on a big qooxdoo project and want to refactor it. For example, i want to move a class, that is referenced quite often from one package path (app.ui.) to another (app.view.), change variable names. Normal refactoring stuff.</p>

<p>In comparision to Delphi or C#, this seems to be terribly painful with a qooxdoo javascript project. </p>

<p>Is there any easy and uncomplicated way to do this? </p>

<p>FYI: I edit the project with gedit in linux mint.</p>
","<javascript><refactoring><package><qooxdoo>","0","110","2010-11-27 19:16:12"
"4299770","Refactoring switch statement for Data to different types of data","<p>My mission is to refactor a switch statement that was poorly written (it makes the cyclomatic complexity spike).  In short, there is a class that parses a file for various values.  </p>

<pre><code>class foo
{
    //a sampling of the fields.  Each have their appropriate property
    private string _name;
    private short _location;
    private int _lineNumber;
    private List&lt;string&gt; _siblings;

    internal foo (StreamReader reader)
    {
        _siblings = new List&lt;string&gt;()
        while (!reader.EndofFile)
        {
            switch (reader.ReadLine())
            {
               case ""Name"":
                  _name = reader.ReadLine();
                  break;
               case ""Location"":
                  _location = short.Parse(reader.ReadLine());
                  break;
               case ""Line Number"":
                  _lineNumber = int.Parse(reader.ReadLine());
                  break;
               case ""Brother"":
               case ""Sister"":
                  _siblings.Add(reader.ReadLine());
                  break;
               //etc
            }
        }
    }
    //Other methods and such
}
</code></pre>

<p>I have read up on the topic and while there seems to be plenty of help, it all seems to be pointing at the Strategy design pattern, which (I believe) would overkill my problem.  In my project, there are multiple classes like this, with some of them having upwards of 25 case statements (so kudos to those who can come up with an idea of and interface or abstract class)</p>

<p>I have thought about using a <code>Dictionary&lt;String, TValue&gt;</code> as described by <a href=""http://simpleprogrammer.com/2010/08/17/pulling-out-the-switch-its-time-for-a-whooping/"" rel=""nofollow"">John Sonmez</a>, but then what would TValue be?</p>

<p>Any help would be greatly appreciated.</p>
","<c#><design><dictionary><refactoring><switch-statement>","2","272","2010-11-28 23:32:00"
"4301214","DotNetOpenAuth - How would the ""View"" interact with this","<p>I've been looking at refactoring my login controller for better code readability.  In doing so, I came across the <a href=""http://www.dotnetopenauth.net/developers/code-snippets/programmatic-openid-relying-party/"" rel=""nofollow"">Programmatic OpenID Relying Party example</a> that looks like this</p>

<pre><code>using DotNetOpenAuth.Messaging;

public ActionResult LogOn()
{
    var openid = new OpenIdRelyingParty();
    IAuthenticationResponse response = openid.GetResponse();

    if (response != null)
    {
        switch (response.Status)
        {
            case AuthenticationStatus.Authenticated:
                FormsAuthentication.RedirectFromLoginPage(
                    response.ClaimedIdentifier, false);
                break;
            case AuthenticationStatus.Canceled:
                ModelState.AddModelError(""loginIdentifier"",
                    ""Login was cancelled at the provider"");
                break;
            case AuthenticationStatus.Failed:
                ModelState.AddModelError(""loginIdentifier"",
                    ""Login failed using the provided OpenID identifier"");
                break;
        }
    }           

    return View();
}

[System.Web.Mvc.AcceptVerbs(HttpVerbs.Post)]
public ActionResult LogOn(string loginIdentifier)
{
    if (!Identifier.IsValid(loginIdentifier))
    {
        ModelState.AddModelError(""loginIdentifier"",
                    ""The specified login identifier is invalid"");
        return View();
    }
    else
    {
        var openid = new OpenIdRelyingParty();
        IAuthenticationRequest request = openid.CreateRequest(
            Identifier.Parse(loginIdentifier));

        // Require some additional data
        request.AddExtension(new ClaimsRequest
        {
            BirthDate = DemandLevel.NoRequest,
            Email = DemandLevel.Require,
            FullName = DemandLevel.Require
        });

        return request.RedirectingResponse.AsActionResult();
    }
}
</code></pre>

<p>Now this looks heaps cleaner and easier to read than what I used from the downloadable examples. (I downloaded the most recent version and this is the example they give - which is the same example I built my app on 5 months ago.)</p>

<pre><code>    [ValidateInput(false)]
    public ActionResult Authenticate(string returnUrl) {
        var response = openid.GetResponse();
        if (response == null) {
            // Stage 2: user submitting Identifier
            Identifier id;
            if (Identifier.TryParse(Request.Form[""openid_identifier""], out id)) {
                try {
                    return openid.CreateRequest(Request.Form[""openid_identifier""]).RedirectingResponse.AsActionResult();
                } catch (ProtocolException ex) {
                    ViewData[""Message""] = ex.Message;
                    return View(""Login"");
                }
            } else {
                ViewData[""Message""] = ""Invalid identifier"";
                return View(""Login"");
            }
        } else {
            // Stage 3: OpenID Provider sending assertion response
            switch (response.Status) {
                case AuthenticationStatus.Authenticated:
                    Session[""FriendlyIdentifier""] = response.FriendlyIdentifierForDisplay;
                    FormsAuthentication.SetAuthCookie(response.ClaimedIdentifier, false);
                    if (!string.IsNullOrEmpty(returnUrl)) {
                        return Redirect(returnUrl);
                    } else {
                        return RedirectToAction(""Index"", ""Home"");
                    }
                case AuthenticationStatus.Canceled:
                    ViewData[""Message""] = ""Canceled at provider"";
                    return View(""Login"");
                case AuthenticationStatus.Failed:
                    ViewData[""Message""] = response.Exception.Message;
                    return View(""Login"");
            }
        }
        return new EmptyResult();
    }
</code></pre>

<p>Now that example has too many if statements for my liking, and with the extra processing that I have to add in (<code>activity logging</code> and <code>checking for new user</code> or <code>add to existing account</code>), it starts getting really messy really quick.</p>

<p>Unfortunately, if I were to refactor my code to look more like the first example, I'm stuck on one small problem.  How does the View interact with this?  I mean, it's looking for <code>openid.GetResponse()</code>, but how do I submit that response?</p>

<p>Like I said, if I can get this working, it looks as though it'll be a lot cleaner than my current way.</p>
","<asp.net-mvc><refactoring><openid><dotnetopenauth>","1","199","2010-11-29 06:00:48"
"4329772","Refactoring an eConnect method that uses a single stored procedure","<p>I'm writing a program to modify some invoices in GP10 using eConnect. Some of the invoices require the distributions to be reset because the totals do not add up correctly due to various other (not important for this question) processes; this is accomplished through this program. Additionally, most of the invoices will be moved to a different batch (think buckets if you're not familiar with GP), also using this program.</p>

<p>Both of these tasks are accomplished by processing the same type of file through eConnect. This is the method that processes that file:</p>

<pre><code>public bool PersistAllChangesInDynamics()
    {
        //instantiate the proper eConnect object for updating the invoice.
        eConnectType eConnect = new eConnectType();
        SOPTransactionType transType = new SOPTransactionType();
        transType.taSopHdrIvcInsert = this.ConvertToSopHdrIvcInsertXml();
        //Adjust fields to reset distributions.
        transType.taSopHdrIvcInsert.UpdateExisting = 1;
        transType.taSopHdrIvcInsert.CREATEDIST = 1;

        SOPTransactionType[] updateInvTypeArray = { transType };
        eConnect.SOPTransactionType = updateInvTypeArray;

        //serialize and process the document.
        XmlDocument eConnectDoc = eConnectHelper.SerializeEConnectDoc(eConnect);
        return eConnectHelper.ProcessEConnectDoc(eConnectDoc);
    }
</code></pre>

<p>My question revolves around this bit of code:</p>

<pre><code>    transType.taSopHdrIvcInsert.UpdateExisting = 1; //updates the batch changes
    transType.taSopHdrIvcInsert.CREATEDIST = 1; //re-creates the distributions
</code></pre>

<p>The taSopHdrIvcInsert is the object provided by eConnect to persist any changes to invoices. As far as I'm aware, there isn't an object that ONLY re-creates distributions. Whenever I process the document, eConnect calls a similarly named stored procedure on the Dynamics db to save those changes correctly. UpdateExisting and CREATEDIST are <em>optional</em> parameters for that SP.</p>

<p>Sometimes, I will only need to update the batch (or other parts of the invoice), or only re-create distributions, but other times, I'll need to do both. Re-creating the distributions doesn't cause any undesirable changes, you always want to distributions to be correct for every invoice. I haven't tested for any time savings between doing just one thing at a time; since the object is calling a SP on the server side, I don't see where it would take significantly different amounts of time.</p>

<p>Do any of you see any reason to re-factor this into 2-3 different methods to keep each desired function separate?</p>
","<c#><performance><refactoring><dynamics-gp>","0","210","2010-12-01 22:24:15"
"4333749","Abstracting exception checking","<p>I have a range of methods that use the same exception handling.</p>

<p>How can I abstract out the exception checking into a separate function?</p>

<p>See example below, thanks a lot for your help folks!</p>

<pre><code>def a
  code
  begin
    rescue 1...
    rescue 2...
    rescue 3...
    rescue 4...
  end
end

def b
  code
  begin
    rescue 1...
    rescue 2...
    rescue 3...
    rescue 4...
  end
end
</code></pre>
","<ruby-on-rails><ruby><exception-handling><refactoring>","3","96","2010-12-02 10:10:31"
"4333452","How to refactor thousands of lines of Java code? Is there any tool available?","<p>In our application we have two or three classes which contains the entire Java Swing application logic. These two or three classes contain around 7k lines of code.</p>

<p>Now I have been assigned the task to refactor this Java code.</p>

<p>How do I start? Is there any tool available that will do the refactoring or at least guide us?</p>
","<java><swing><refactoring>","1","369","2010-12-02 09:29:18"
"4341607","jQuery code refactoring help needed","<p>An update to before, here's what I'm dealing with:</p>

<pre><code>&lt;body&gt;
&lt;div class=""header""&gt; &lt;img class=""imgLogo"" src=""img/vegtablelogo.jpg""&gt; &lt;/div&gt;
&lt;div id=""thumbsContainer""&gt;
  &lt;div class=""thumb"" id=""carrotThumb""&gt; &lt;img id=""showCarrot"" class=""imgThumb"" src=""img/carot.jpg"" onClick=setupVeg(""showCarrot"", ""carrotBig"") /&gt; &lt;/div&gt;
  &lt;div class=""hidden"" id=""carrotBig""&gt; &lt;img class=""imgBig"" src=""img/carot.jpg"" /&gt; &lt;/div&gt;
  &lt;div class=""thumb"" id=""brocThumb""&gt; &lt;img id=""showBroc"" class=""imgThumb"" src=""img/brocoli.jpg"" onClick=setupVeg(""showBroc"", ""brocBig"") /&gt; &lt;/div&gt;
  &lt;div class=""hidden"" id=""brocBig""&gt; &lt;img class=""imgBig"" src=""img/brocoli.jpg"" /&gt; &lt;/div&gt;
&lt;/div&gt;
&lt;!-- end thumbs container --&gt; 

&lt;script&gt;
var active = """";

function setupVeg(thumbVeg, hiddenVeg) {
    $(""#"" + thumbVeg).click(function() {
        if (active != hiddenVeg) {
            $(""div.hidden"").hide(""fast"");
            $(""#"" + hiddenVeg).show(""fast"", function() {});
            active = hiddenVeg;
        }
        else {
            $(""div.hidden"").hide(""fast"");
            active="""";
        }
    });
}

$(""div.hidden"").click(function () {
    $(""div.hidden"").hide(""fast"");
    isAnyBig=false;
});

&lt;/script&gt;
&lt;/body&gt;
</code></pre>

<p>This code is not working unfortunately. I have borrowed from suggested solution below.</p>

<p>Would be nice if it did work!
Any suggestions, most welcome.</p>
","<javascript><jquery><refactoring>","1","91","2010-12-03 01:08:34"
"4347959","How do I Extract a Method That Assigns Two Values?","<p>Extract Method (a refactoring from Fowler's book) works great if your method doesn't assign any values. If it assigns one value, that becomes the return value of the extracted method. What if it assigns two values?</p>

<p>Some C# code to illustrate:</p>

<pre><code>private void someBigFunction() {
 doSomething();
 doSomethingElse();

 // start extraction here
 string first = Database.Select(...);
 // ...
 // next is dependent on the value of ""first""
 int next = Database.Select(...);
 // ...
 // stop extraction here

 doMoreUselessStuff();
}
</code></pre>

<p>The exact code or values are not important here. The point is extracting this method. (The two values are linked, so it makes sense to have them in the same method -- and not to make two methods.)</p>

<p>Possible answers to this question would be ""return both in an array,"" ""return them both in a pair-like data structure,"" or ""use out parameters (pass by reference)"" -- but I'm looking for something cleaner. (The actual code is in Delphi, not C#)</p>
","<refactoring>","0","53","2010-12-03 17:04:04"
"4349606","Refactoring crazy inheritance hierarchies of value objects - How to get a list of all fields and types?","<p>So basically, I need to manually adjust an inheritance hierarchy.  I'd like for the classes to be perfect, no extra fields, and they're just DTO's.  However, it's really easy to get lost and add duplicate fields, and it's really hard to see if what I'm looking for is already there.  Something I'd really love to have is a way to list all the fields within a class, including its inherited fields (private too).  Like a flattened field-only view with no getters and setters cluttering everything up.</p>

<p>I've found a way to show it in netbeans with right-click/File members, but I can't copy-paste and save it in a text file or anything.</p>

<p>Basically just these columns:</p>

<pre><code>Name     Type            Superclass
id       int  
theDate  java.util.Date  com.something.AbstractDTO
...
</code></pre>

<p>Anyone know how to do it, or a better way to do what I'm trying to do?</p>
","<java><ide><refactoring><dto><dto-mapping>","4","187","2010-12-03 20:33:55"
"4350378","Mutual friendship and pointers: What Pattern or anti-pattern is this?","<p>In studying the C++ source of a massive app, I find this pattern (the syntax for the example may be sketchy, but the essential details are there):</p>

<pre><code>class A  :  X
   friend B;
   B *parent;
   ...stuff...

class B  : Y
   friend A;
   A *myhelper;
   ...stuff...
</code></pre>

<p>Perhaps it is meaningful that class B is really named AHelper, but I'm more curious about this fairly symmetrical relation between two classes.   Is this part of one of the standard GoF patterns, or an established anti-pattern?  Is there some concept or way of understanding this besides the details, a whole greater than the parts? </p>

<p>Would it make sense to combine A and B into one class?  There is the matter of each class being inherited from other classes X, Y.  I am eager to refactor this code to make it more maintainable and smaller.</p>
","<c++><design-patterns><refactoring><class-design><friend>","2","179","2010-12-03 22:21:58"
"4350668","Is it possible\advisable to refactor a Spring MVC application to use another MVC framework?","<p>I am just getting started using Spring and am currently reading <a href=""http://rads.stackoverflow.com/amzn/click/1933988134"" rel=""nofollow"">Spring in Action</a> to ramp up.  In citing the benefits of Spring vs. EJBs, the book makes the statement: </p>

<blockquote>
  <p>""With Spring, components are typically
  not required to implement, extend, or
  use any Spring-specific classes or
  interfaces, making it possible to
  reuse the components anywhere, even in
  the absence of Spring.""</p>
</blockquote>

<p>My application is currently using Spring MVC.  I can see how the above statement holds true for my application's business logic, as the use of dependency injection has completely decoupled our beans from the Spring framework.  But what about the MVC stuff, which in this case is a web application?  I am curious as to whether it would be possible to swap out Spring MVC in my application with another MVC framework in the future.    </p>

<p>My question is twofold:<br>
1) Should I view the web tier as tightly coupled to the Spring framework and assume that a change in my MVC would necessitate the creation of a new web application to support it?  </p>

<p>2) If not, what would be involved in decoupling the web application from Spring?  I can already guess that in the absence of the Spring framework, all of the annotations would need to be removed from the controllers and the associated code would need to be refactored to support the new MVC framework.  </p>

<p>I am particularly interested in the insights of anyone who has been through this process.</p>
","<java><spring-mvc><refactoring>","1","83","2010-12-03 22:58:53"
"4367327","How to rewrite code that navigates node list","<p>I have just written some code, which as i was writing i thought, this is going to be a nice generic method for searching for a particular node. When i finished i actually realised it was a mess :D </p>

<pre><code>public String sqlReading(String fileName, String path, String nodeId )
{
    XmlDocument doc = new XmlDocument();
    doc.Load(fileName);

    XmlNodeList names = doc.SelectNodes(path);
    foreach (XmlNode xmlDocSearchTerm in names)
    {
        //if the attribute of the node i start at is the same as where i am now
        if (xmlDocSearchTerm.Attributes.Item(0).Value.ToString().Equals(nodeId))
        {
            //get a list of all of its child nodes
            XmlNodeList childNodes = xmlDocSearchTerm.ChildNodes;

            foreach (XmlNode node in childNodes)
            {
                //if there is a node in here called gui display, go inside
                if (node.Name.Equals(""GUIDisplay""))
                {
                    XmlNodeList list = node.ChildNodes;
                    //find the sqlsearchstring tag inside of here
                    foreach (XmlNode finalNode in list)
                    {
                        if (finalNode.Name.Equals(""sqlSearchString""))
                        {
                            return node.InnerText;
                        }
                    }
                }
            }
        }
    }
    return """";
}
</code></pre>

<p>What i intended to do was based on a path - i would start and check to see if the element had the id i was looking for, if it did then i wanted to get inside there and not stop going until i got to the sqlsearchstring tag which was buried two levels deeper. I have managed that, but the issue here is that now i seem to have almost hardcoded a path to the tag opposed to looping there. How could i change my code to stop me from doing this?</p>

<p>Its from the second foreach where its going wrong imo.</p>

<p>Thanks</p>
","<c#><refactoring>","1","136","2010-12-06 14:21:42"
"4383777","How to systematically remove and re-factor unused C# code?","<p>I have copied an older open source project (C# 2.0-ish, VS2010).
It does what I need, but it is not great and there is too much junk code.
I think only 20% of it is being used. I would like to remove everything that I do not need, before I can start to re-factor. Are there any tools that can help me do this?</p>
","<c#><refactoring>","1","114","2010-12-08 02:55:45"
"4387454","Is refactoring of tests/spec a good idea?","<p>When I see in my test code specs like this for every controller:</p>

<pre><code>it ""#new displays input controls for topic title and keywords"" do

  ensure_im_signed_in
  get :new

  assert_response :success
  assert_select ""input#topic_title""
  assert_select ""input#topic_keywords_input""
  assert assigns :topic
end
</code></pre>

<p>I want to refactor it and replace with some one-liner like this:</p>

<pre><code>its_new_action_displays_input_form :topic, %w(input#topic_title input#topic_keywords_input)
</code></pre>

<p>and implementation:</p>

<pre><code>def its_new_Action_displays_input_form field, inputs
  it ""#new displays input controls for #{inputs.join "", ""}"" do
    ensure_im_signed_in
    get :new
    assert_response :success
    for css in inputs
      assert_select css
    end
    assert assigns field
  end
end
</code></pre>

<p>What are the advantages of either keeping verbose version or refactoring to terser version?</p>

<p>I see only problem with refactored version is that RSpec does not show backtrace for the failed test.</p>
","<ruby-on-rails><testing><refactoring><tdd><rspec>","2","147","2010-12-08 12:33:35"
"4388718","Rewrite this array manipulation using a lambda function?","<p>I have this routine which alters all elements within an array...</p>

<pre><code>    for (int i = 0; i &lt; sOutputFields.GetUpperBound(0); i ++)
    {
        sOutputFields[i] = clsSQLInterface.escapeIncoming(sOutputFields[i]);
    }
</code></pre>

<p><code>sOutputFields</code> is a one dimensional <code>string</code> array. <code>escapeIncoming()</code> is a function which returns a <code>string</code>.</p>

<p>I thought this could be re-written thus..</p>

<pre><code>    sOutputFields.Select(el =&gt; clsSQLInterface.escapeIncoming(el));
</code></pre>

<p>..but this appears to do nothing (though does not throw an exception). So I tried..</p>

<pre><code>    sOutputFields = 
       (string[])sOutputFields.Select(el =&gt; clsSQLInterface.escapeIncoming(el));
</code></pre>

<p>..but I get this exception at execution time..</p>

<p><strong>""Unable to cast object of type 'WhereSelectArrayIterator`2[System.String,System.String]' to type 'System.String[]'.""</strong></p>

<p>how to fix?</p>
","<c#><lambda><refactoring>","2","563","2010-12-08 14:42:14"
"4390484","Just because something works, does it mean you don't have to refactor?","<p>I just saw this line of code in the WP codebase.</p>

<pre><code>if ( $user_id = wp_validate_auth_cookie( '', apply_filters( 'auth_redirect_scheme', '' ) ) ) {
}
</code></pre>

<p>Um. Yeah. two method calls and an assignment statement in an if statement.</p>

<p>So, my guess is, nobody is refactoring this.</p>

<p>Are there any reasons why?</p>
","<refactoring>","3","113","2010-12-08 17:37:59"
"4381963","VisualStudio Asp.NET MVC FindAllReferences in .aspx page","<p><strong>Is there a way to find all references of an HTML helper method in the views?</strong>  </p>

<p>In VisualStudio, when using the ""FindAllReferences"" option on a method (or when refactoring), only the references in .cs files are returned, while references in an .aspx page are not found.</p>

<p>NOTE: Using the ""Find and Replace"" tool is not what I'm looking for.</p>
","<asp.net><visual-studio><refactoring>","1","19","2010-12-07 21:49:48"
"4411555","Method/Pattern to convert Win32 messages to WPF events?","<p>We are currently converting an MFC application to WPF. This application is part of a suite of applications (all developed using MFC) which share a large code base. In said code base, the applications communicate with each other via windows messages.</p>

<p>There are currently no plans to convert any other applications to WPF (or even .NET). We are converting this application because it's a morass of spaghetti and hacks created by a developer that is no longer with the company.</p>

<p>Since we only want to convert the single application to WPF, we need to have the ability to communicate between WPF and MFC applications.</p>

<p>So my question is a two-parter:</p>

<p>1) Is there a way to receive messages in WPF posted to an HWND from an MFC application (we would then translate it to an Event for handling within the WPF app)?</p>

<p>2) Is there a way to post a message to a Win32 HWND that belongs to another process from WPF?</p>

<p>I know it's possible to host WPF content in a Win32 window and vise versa, however that is not what we want to do. Unfortunately it looks like we have to adapt a WPF project to our old Win32 method of inter-process communication.</p>

<p>Thanks.</p>
","<wpf><mfc><refactoring><messaging><interprocess>","0","231","2010-12-10 17:24:51"
"4403583","How can I rewrite this code so that it uses plyr/ddply as intended?","<p><strong>Background</strong></p>

<p>I have a dataframe of probability distributions that I would like to calculate statistical summaries for: </p>

<pre><code>priors &lt;- structure(list(name = c(""theta1"", ""theta2"", ""theta3"", ""theta4"", 
  ""theta5""), distn = c(""gamma"", ""beta"", ""lnorm"", ""weibull"", ""gamma""), 
   parama = c(2.68, 4, 1.35, 1.7, 2.3), paramb = c(0.084, 7.2, 0.69, 0.66, 3.9),
   another_col = structure(c(3L, 4L, 5L, 1L, 2L
   ), .Label = c(""1"", ""2"", ""a"", ""b"", ""c""), class = ""factor"")), 
   .Names = c(""name"", ""distn"", ""parama"", ""paramb"", ""another_col""), row.names = c(""1"",
   ""2"", ""3"", ""4"", ""5""), class = ""data.frame"")
</code></pre>

<p><strong>Approach</strong></p>

<p>Step 1: I wrote a function to calculate the summaries and returning <code>mean(lcl, ucl)</code></p>

<pre><code> summary.stats &lt;- function(distn, A, B) {
  if (distn == 'gamma'  ) ans &lt;- c(A*B,                       qgamma(c(0.05, 0.95), A[ ], B))
  if (distn == 'lnorm'  ) ans &lt;- c(exp(A + 1/2 * B^2),        qlnorm(c(0.05, 0.95), A, B))
  if (distn == 'beta'   ) ans &lt;- c(A/(A+B),                   qbeta( c(0.05, 0.95), A, B))
  if (distn == 'weibull') ans &lt;- c(mean(rweibull(10000,A,B)), qweibull(c(0.05, 0.95), A, B))
  if (distn == 'norm'   ) ans &lt;- c(A,                         qnorm( c(0.05, 0.95), A, B))
  ans &lt;- (signif(ans, 2))
  return(paste(ans[1], ' (', ans[2], ', ', ans[3],')', sep = ''))
}
</code></pre>

<p>Step 2: I would like to add a new column to my dataframe called <code>stats</code></p>

<pre><code>priors$stats &lt;- ddply(priors, 
                     .(name, distn, parama, paramb), 
                     function(x)  summary.stats(x$distn, x$parama, x$paramb))$V1
</code></pre>

<p><strong>Question 1:</strong></p>

<p>what is the proper way to do this? I get an error when I try </p>

<pre><code>                ddply(priors, 
                     .(name, distn, parama, paramb),
                     transform, 
                     stats = function(x)  summary.stats(x$distn, x$parama, x$paramb))
</code></pre>

<p><strong>Question 2:</strong> (extra credit)</p>

<p>Is there a more efficient way to code the <code>summary.stats</code> function, i.e., with less 'if's'?</p>

<p><em>update</em></p>

<p>Thanks to Shane and Joshua for clearing this up for me. </p>

<p>I also found a question that should be helpful for others trying to <a href=""http://stackoverflow.com/questions/2074606/doing-a-plyr-operation-on-every-row-of-a-data-frame-in-r"">do a plyr operation on every row of a dataframe</a></p>
","<r><refactoring><plyr>","1","182","2010-12-09 22:00:53"
"4420982","Ajax Design/Refactoring help when rendering new content - like list items and divs","<p>I consistently come across this code smell where I am duplicating markup, and I'm not really sure how to fix it. Here's a typical use case scenario:</p>

<p>Let's say we'd like to post comments to some kind of article. Underneath the article, we see a bunch of comments. These are added with the original page request and are generated by the templating engine (Freemarker in my case, but it can be PHP or whatever).</p>

<p>Now, whenever a user adds a comment, we want to create a new <em>li</em> element and inject it in the current page's list of comments. Let's say this <em>li</em> contains a bunch of stuff like:</p>

<ol>
<li>The user's avatar</li>
<li>Their name</li>
<li>A link to click to their profile or send them a private message</li>
<li>The text they wrote</li>
<li>The date they wrote the comment</li>
<li>Some ""edit"" and ""delete"" links/buttons if the currently logged in user has permission to do these actions.</li>
</ol>

<p>Now, all of these things were already written in our template that originally generated the page... so now we have to duplicate it inside of Javascript! </p>

<p>Sure, we can use another templating language - like Jquery's Template plugin - to ease the pain generating and appending this new <em>li</em> block... but we still end up with duplicate html markup that is <em>slightly</em> different because we can't use macros or other conveniences provided to us by the templating language.</p>

<p>So how do we refactor out the duplication? Is it even possible, or do we just put up with it? What are the best practices being used to solve this problem?</p>
","<javascript><ajax><templates><refactoring><duplication>","2","104","2010-12-12 09:18:29"
"4427940","Removing duplication of code for calls to ""RouteCollection.MapRoute()"" and ""AreaRegistrationContext.MapRoute()""","<p>Basically as the title says when using Areas in ASP.NET MVC2.0 I've ended up with the following ""MapRoute"" handling code being duplicated for ""RouteCollection"" and AreaRegistrationContext"".    Both objects are outside of my control (i.e. in the .NET MVC framework) but don't appear to inhereit from any common interface / base class.  Can anyone recommend a way to remove the code duplication in this situation?</p>

<pre><code>    public void Map(RouteCollection routes)
    {
        if (Details != null)
        {
            if (Namespaces != null)
                routes.MapRoute(Name, Url, Details, Namespaces);
            else
            {
                routes.MapRoute(Name, Url, Details);
            }
        }
        else
        {
            if (Namespaces != null)
                routes.MapRoute(Name, Url, Namespaces);
            else
            {
                routes.MapRoute(Name, Url);
            }
        }
    }

    public void Map(AreaRegistrationContext context)
    {
        if (Details != null)
        {
            if (Namespaces != null)
                context.MapRoute(Name, Url, Details, Namespaces);
            else
            {
                context.MapRoute(Name, Url, Details);
            }
        }
        else
        {
            if (Namespaces != null)
                context.MapRoute(Name, Url, Namespaces);
            else
            {
                context.MapRoute(Name, Url);
            }
        }
    }
</code></pre>
","<c#><asp.net-mvc><refactoring>","0","283","2010-12-13 10:36:55"
"4428407","C# socket refactoring (data sending)","<p>Imagine that <code>Byte[] refArchiveData</code> is around 30-100 mbytes of size. I want to send it to server using <code>NetworkStream stream</code> object:</p>

<pre><code>            TcpClient client = new TcpClient(server, port);

            Byte[] refLengthBytes = new Byte[4];
            Byte[] refArchiveData = null;

            refArchiveData = File.ReadAllBytes(""C:/Temp/Python25.zip"");

            Console.WriteLine(""Archive data length is {0}"", refArchiveData.Length);

            NetworkStream stream = client.GetStream();

            refLengthBytes = System.BitConverter.GetBytes(refArchiveData.Length);

            stream.Write(refLengthBytes, 0, 4);

            stream.Write(refArchiveData, 0, refArchiveData.Length);

            stream.Close();

            client.Close();
</code></pre>

<p>How i must modify the part of code where i send my archive? Maybe split it by chunks of 256-512 bytes?</p>

<p>Thank you for any advice!</p>
","<c#><sockets><networking><refactoring>","3","102","2010-12-13 11:36:27"
"4431694","How to join two files in a version control system","<p>I am doing a refactoring of my C++ project containing many source files.
The current refactoring step includes joining two files (say, <code>x.cpp</code> and <code>y.cpp</code>) into a bigger one (say, <code>xy.cpp</code>) with some code being thrown out, and some more code added to it.</p>

<p>I would like to tell my version control system (Perforce, in my case) that the resulting file is based on two previous files, so in future, when i look at the revision history of <code>xy.cpp</code>, i also see all the changes ever done to <code>x.cpp</code> and <code>y.cpp</code>.</p>

<p>Perforce supports renaming files, so if <code>y.cpp</code> didn't exist i would know exactly what to do. Perforce also supports merging, so if i had 2 different versions of <code>xy.cpp</code> it could create one version from it. From this, i figure out that joining two different files is possible (not sure about it); however, i searched through some documentation on Perforce and other source control systems and didn't find anything useful.</p>

<p>Is what i am trying to do possible at all?<br>
Does it have a conventional name (searching the documentation on ""merging"" or ""joining"" was unsuccessful)?</p>
","<version-control><refactoring><perforce>","10","168","2010-12-13 17:37:31"
"4440198","Refactoring advice: maps to POJOs","<p>I currently am part of a project where there is an interface like this:</p>

<pre><code>public interface RepositoryOperation {

    public OperationResult execute(Map&lt;RepOpParam, Object&gt; params);  
}
</code></pre>

<p>This interface has about ~100 implementers.</p>

<p>To call an implementer one needs to do the following:</p>

<pre><code>final Map&lt;RepOpParam, Object&gt; opParams = new HashMap&lt;RepOpParam, Object&gt;();
opParams.put(ParamName.NAME1, val1);
opParams.put(ParamName.NAME2, val2);
</code></pre>

<p>Now I think that there is obviously something wrong with anything with a<code>&lt;Something, Object&gt;</code> generic declaration.</p>

<p>Currently this causes a caller of a <code>OperationImpl</code> to have to actually read the code of the operation in order to know how to build the argument map. (and this is not even the worst of the problems, but I don't want to cite them all since they are fairly obvious)</p>

<p>After some discussion I managed to convince my colleagues to let me do some refactoring.</p>

<p>It seems to me that the simplest 'fix' would be to change the interface like so:</p>

<pre><code>public interface RepositoryOperation {

    public OperationResult execute(OperationParam param);  
}
</code></pre>

<p>After all the concrete operations will define (extend) their own OperationParam and the needed arguments would be visible to everybody. (which is the 'normal way' to do things like that IMHO)</p>

<p>So as I see it since the interface implementers are quite numerous I have several choices:</p>

<ol>
<li><p>Try to change the interface and rewrite all the Operation calls to use objects instead of maps. This seems the cleanest, but I think that since the operations are a lot it might be too much work in practice. (~2 weeks with tests probably)</p></li>
<li><p>Add an additional method to the interface like so:</p>

<pre><code>public interface RepositoryOperation {
    public OperationResult execute(Map&lt;String, Object&gt; params);
    public OperationResult execute(OperationParam params);  
}
</code></pre>

<p>and fix the map calls whenever I come across them during functionality implementation.</p></li>
<li><p>Live with it (please no !).</p></li>
</ol>

<p>So my question is.</p>

<p>Does anyone see a better approach for 'fixing' the maps and if you do would you fix them with method 1 or 2 or not fix them at all. </p>

<p><strong>EDIT:</strong>
Thanks for the great answers. I would accept both Max's and Riduidel's answers if I could, but since I can't I'm leaning a bit more towards Riduidel's.</p>
","<java><architecture><refactoring><map><clarity>","2","111","2010-12-14 14:29:57"
"4440912","SQL Server refactor a column from varchar(50) to uniqueidentifier and surrounding issues","<p>I have a table <code>message</code> in a database that has almost a million rows. It has a <code>externalId</code> column which is <code>varchar(50)</code>. The values stored in it are guid but I want to update this column to be <code>uniqueidentifier</code>.</p>

<p>So I think I am going to add a new column which is <code>uniqueidentifier</code>. Copy all the values across to this column and then drop the original column. Then I will rename this column to <code>externalId</code>.</p>

<p>My problem is there are hundreds of stored procs etc and I need to make sure that I don't break anything. I also have to grep through all the code and make changes so that we expect a Guid and not a string. (I am using C#)</p>

<p>Does anyone have some tips or recommendations?</p>

<p>Would I be better do just duplicate this column and not touch the existing column and make any code that does a select on it use the guid column instead of the string (currently it sometimes times-out!). I would also have to update any code then that inserts into this table to also insert a guid...)</p>

<p>I love legacy crap .......................</p>
","<sql><sql-server><refactoring>","1","333","2010-12-14 15:42:10"
"4444133","When and Why would a Child class declare a static instance member of the parent class?","<p>This is another design pattern in some legacy code that I couldn't find much about on google. In this case a child class extends its abstract parent, but then turns right around and declares a static instance of the parent:</p>

<pre><code>public abstract class MessageBase {
    protected DAOFactory factory;
    // method declarations
}

public class EDWMessage extends MessageBase {
    private static MessageBase instance;

    public static MessageBase getInstance(Properties properties) {
        if (instance == null) {
            instance = new EDWMessageTransaction(properties, null);
        }
        return instance;
    }
//more code
}
</code></pre>

<p>I'm not sure I understand what would drive this design pattern (if it is a known pattern). Is this a sort of convenience pattern to avoid declaring each member variable of the parent as static? Or is it meant to allow multiple children classes to each have one instance of the parent. But if that's the case, why the excessive use of inheritance over just plain composition?</p>

<p>The rest of the code gives no indication as to why it would be done this way. Any thoughts or ideas would be much appreciated. Thanks!</p>

<p>P.S. I seem to be running in to a lot of interesting <a href=""http://stackoverflow.com/questions/4441275/in-java-why-have-a-code-block-with-no-keywords-just-curly-brackets"">design</a> <a href=""http://stackoverflow.com/questions/4304638/should-a-parent-class-ever-reference-child-classes"">patterns</a> in this legacy code that I don't know how to handle. Thanks to everyone who has helped me out already.</p>

<p>Edit: Expanding the code sample. Will edit again as I discover someplace that actually uses this code. Yay for no documentation.</p>
","<java><design-patterns><refactoring><legacy-code>","3","145","2010-12-14 20:55:27"
"4448907","Search 'grep-alike' through PostgreSql functions","<p>When refactoring PostgreSql functions (and more specific: while searching for 'unused' functions) it would be handy to have a function available to search for a specific string within the function definitions.</p>

<p>Does anyone know if this is the best approach (trying to 'grep'-search the function definitions) or are there alternative methods available?</p>

<p>How would one implement this functionality?</p>
","<postgresql><refactoring><stored-functions>","0","235","2010-12-15 10:26:46"
"4453746","Refactoring to avoid duplicate code","<p>I'm trying to factor out some repetitive code, but it starts to smell funky now.
Say I start out with this not quite right, but you catch my drift:</p>

<pre><code>    public virtual OrganisationEntity Get(int id)
    {
        SqlCommand command = new SqlCommand();
        command.CommandText = @""SELECT t.Id, t.Description FROM Organisation t Where t.Id = @Id"";
        command.Parameters.Add(""@id"", SqlDbType.Int).Value = id;

        List&lt;OrganisationEntity&gt; entities = new List&lt;OrganisationEntity&gt;();

        SqlDataReader reader = Database.ExecuteQuery(command, ConnectionName.Dev);

        while (reader.Read())
        {
            OrganisationEntityMapper mapper = Mapper;
            entities = mapper.MapAll(reader);
        }

        return entities.First&lt;OrganisationEntity&gt;();
    }
</code></pre>

<p>It's pretty obvious every other Get(int id) methode has, apart from the query the same form, so my next step would be to make a base class, RepositoryBase looking like:</p>

<pre><code>public abstract class RepositoryBase&lt;T&gt; where T : new()
{
    /// &lt;summary&gt;
    /// 
    /// &lt;/summary&gt;
    public abstract EntityMapperBase&lt;T&gt; Mapper { get; }

    public virtual T Get(int id)
    {

        List&lt;T&gt; entities = new List&lt;T&gt;();

        SqlDataReader reader = Database.ExecuteQuery(Command, ConnectionName);

        while (reader.Read())
        {
            EntityMapperBase&lt;T&gt; mapper = Mapper;
            entities = mapper.MapAll(reader);
        }

        return entities.First&lt;T&gt;();
    }
}
</code></pre>

<p>To add some generic funkyness, but this is also where it gets ugly.
First of all, Database.ExecuteQuery expects a SqlCommand and an enum, so I though, ok, then I'll add 2 properties, which I'll just fire up with some stuff.
THen I realize I don't need the int id parameter here anymore, since I construct the query in a subclass, so I might as well pass the command and connectionName as parameters, I want the connectionName to be dependend of the OrganisationRepository anyway (others need another string):</p>

<pre><code>public class OrganisationRepository : RepositoryBase&lt;OrganisationEntity&gt;
{
    protected override EntityMapperBase&lt;OrganisationEntity&gt; Mapper
    {
        get
        {
            return new OrganisationMapper();
        }            
    }

    public override OrganisationEntity Get(int id)
    {
        SqlCommand command = new SqlCommand();
        command.CommandText = @""SELECT t.Id, t.Description FROM Organisation t Where t.Id = @Id"";
        command.Parameters.Add(""@id"", SqlDbType.Int).Value = id;
        return base.Get(command, ConnectionName.Dev);
    }
}
</code></pre>

<p>But, oops, ofcourse, now the method signatures aren't in sync anymore... oops!
So, basically I'm wondering. It just feels nasty, but don't know exactly why.
On one hand I'd like to factor out repetetive code as much as possible, but now it leaves me with this!</p>

<p>How do I refactor this to (more) proper OO? Should I just forget factoring out the query strings and write alot of duplicate?</p>
","<c#><oop><design><refactoring>","1","391","2010-12-15 19:00:11"
"4454867","Rails3 – refactor redirect call","<p>Refactor this:  </p>

<pre><code>redirect_to ""http://#{@school.id}"" + '.' + request.domain + request.port_string + '/'
</code></pre>

<p>That is inside the School controller:</p>

<pre><code>def create
    @school = School.new(params[:school]) 

    if @school.save
      redirect_to ""http://#{@school.id}"" + '.' + request.domain + request.port_string + '/'
    else
      render ""new"", :layout =&gt; nil
    end
end
</code></pre>

<p>So that it redirect to:</p>

<pre><code>subdomain.domain.dom/
</code></pre>

<p>Routes:</p>

<p>resources :schools
  root :to => ""schools#show""</p>

<p>Things tried:</p>

<pre><code>redirect_to(:host=&gt;@school.id + '.' + request.domain + request.port_string)
</code></pre>

<p>Fail because it redirect to <a href=""http://subdomain.domain.dom/schools"" rel=""nofollow"">http://subdomain.domain.dom/schools</a></p>

<p>And How do I pass a :notice?</p>

<p>I have this in the view:</p>

<pre><code>&lt;% if flash[:notice] -%&gt;
    &lt;div id=""info_panel""&gt;
    &lt;%= flash[:notice] -%&gt;
    &lt;/div&gt;
&lt;% end -%&gt;
</code></pre>

<p>And this in the controller:</p>

<pre><code>flash[:notice] = ""School created""
redirect_to(school_base(@school.id))                  
</code></pre>
","<ruby-on-rails><refactoring>","0","126","2010-12-15 21:04:27"
"4455357","Changing Eclipse's refactor tool behavior","<p>I'm in the process of refactoring a large amount of code.  Eclipse's refactor tool is extremely handy for this, but I'm running into a bit of a snag.  </p>

<p>For example, the original file has these imports:</p>

<pre><code>import com.a.TestClass;
import com.b.TestClass;
import com.b.BClass;
</code></pre>

<p>In refactoring, I move and rename <strong>com.b.BClass</strong> to <strong>com.a.AClass</strong> so Eclipse will insert AClass into alphabetic order on the import list:</p>

<pre><code>import com.a.AClass;
import com.a.TestClass;
import com.b.TestClass;
</code></pre>

<p>This is normally a nice feature, but in my case it's a bit of a hassle since it's harder to figure out how to merge correctly.  Is there any way to change this behavior?</p>
","<java><eclipse><refactoring>","1","138","2010-12-15 21:56:52"
"4447451","how should i refactor a piece of code that is present in many different functions, but has return statement in it","<p>The code snippet is coming from django view code, but it doesn't matter much.</p>

<p>Let's say I have the following piece of code...</p>

<pre><code>def unsubscribe(request):
  #start of block
  user = request.user
  sid = request.POST.get('subscription_id')
  try:
    sub = Subscription.objects.get(id=sid)
  except ObjectDoesNotExist:
    return ajax_response(False, [('subscription', 'Given subscription does not exist.')])
  if sub.user != user:
    return ajax_response(False, [('subscription', 'Invalid permission.')])
  #end of block.
  sub.is_active = False
  sub.save()
  return ajax_response(True)
</code></pre>

<p>and say, I have another function <code>resubscribe()</code> that does exactly same thing as the above function, except it does <code>sub.is_active = True</code>.</p>

<p>In that case, what would be the best way to organize the code, so that code between <code>#block</code> and <code>#endblock</code> aren't duplicated? I guess in general, this question can be written as:</p>

<blockquote>
  <p>There's a block of code that is copy-and-pasted over many different functions. however, this block of code contains <code>return</code> statement. in that case, what would be the best way to abstract this piece of logic out?</p>
</blockquote>

<p>EDIT: fixed code snippet.</p>

<p>EDIT2: Actually, the easy way to solve this question is by creating a function say, toggle_active_status, which takes <code>request</code> and a boolean. (I figured it out after posting out the question).</p>

<p>However, i'm wondering about the case where the different logic between the functions is more than 1 line... like, say, code between #block and #endlbock only does input validation, and potentially any arbitrary application logic can come after. </p>
","<python><django><refactoring>","0","90","2010-12-15 06:57:13"
"4479206","Could this PHP code be simplified or improved?","<p>I was wondering if the following code could be refactored/improved/simplified?  I'm posting this here, as I'd like another programmer's perspective/view; it's always good to see what others would do.</p>

<pre><code>&lt;?php

function moderateTopic($topic_id, $action = NULL) {
    $locked_query       = ""SELECT topic_id FROM forum_topics WHERE status = 'locked' AND topic_id = '{$topic_id}'"";
    $locked_count       = totalResults($locked_query);
    $announcement_query = ""SELECT topic_id FROM forum_topics WHERE topic_type = 2 AND topic_id = '{$topic_id}'"";
    $announcement_count = totalResults($announcement_query);
    $sticky_query        = ""SELECT topic_id FROM forum_topics WHERE topic_type = 3 AND topic_id = '{$topic_id}'"";
    $sticky_count       = totalResults($sticky_query);

    if (is_null($action) == FALSE) {
        switch ($action) {
            case 1:
                if ($locked_count &gt; 0) {
                    $topic_query = ""UPDATE forum_topics SET status = 'unlocked' WHERE topic_id = '{$topic_id}'"";
                } else {
                    $topic_query = ""UPDATE forum_topics SET status = 'locked' WHERE topic_id = '{$topic_id}'"";
                }
                doQuery($topic_query);
                break;
            case 2:
                if ($announcement_count &gt; 0) {
                    $topic_query = ""UPDATE forum_topics SET topic_type = 1 WHERE topic_id = '{$topic_id}'"";
                } else {
                    $topic_query = ""UPDATE forum_topics SET topic_type = 2 WHERE topic_id = '{$topic_id}'"";
                }
                doQuery($topic_query);
                break;
            case 3:
                if ($sticky_count &gt; 0) {
                    $topic_query = ""UPDATE forum_topics SET topic_type = 1 WHERE topic_id = '{$topic_id}'"";
                } else {
                    $topic_query = ""UPDATE forum_topics SET topic_type = 3 WHERE topic_id = '{$topic_id}'"";
                }
                doQuery($topic_query);
                break;
            case 4:
                header('Location: ' . urlify(9, $topic_id));
                break;
            case 5:
                header('Location: ' . urlify(11, $topic_id));
                break;
        }
        header('Location: ' . urlify(2, $topic_id));
    } else {
        $locked       = $locked_count &gt; 0 ? 'Unlock' : 'Lock';
        $announcement = $announcement_count &gt; 0 ? 'Unannounce' : 'Announce';
        $sticky       = $sticky_count &gt; 0 ? 'Unsticky' : 'Sticky';

        return &lt;&lt;&lt;EOT
&lt;div style=""float: right;""&gt;
&lt;form method=""POST""&gt;
&lt;select name=""action"" onChange=""document.forms[0].submit();""&gt;
&lt;option value=""""&gt;- - Moderate - -&lt;/option&gt;
&lt;option value=""1""&gt; =&amp;gt; {$locked}&lt;/option&gt;
&lt;option value=""2""&gt; =&amp;gt; {$announcement}&lt;/option&gt;
&lt;option value=""3""&gt; =&amp;gt; {$sticky}&lt;/option&gt;
&lt;option value=""4""&gt; =&amp;gt; Move&lt;/option&gt;
&lt;option value=""5""&gt; =&amp;gt; Delete&lt;/option&gt;
&lt;/select&gt;
&lt;/form&gt;
&lt;/div&gt;
EOT;
    }
}

?&gt;
</code></pre>
","<php><refactoring>","0","127","2010-12-18 17:35:01"
"4470256","Is there anyone who have used GUTS(GUICE UTILITIES TOOLS SWING)?","<p>We have a huge Java Swing application. Now we want to remove couplings from all the components so that we can reuse them.</p>

<p>I came across this tool called GUTS which is based on GUICE for Swing applications. Has anyone used it?</p>

<p><a href=""http://kenai.com/projects/guts/pages/Home"" rel=""nofollow"">http://kenai.com/projects/guts/pages/Home</a></p>

<p>It will be better if I go for this tool for decoupling components code and better manageable Swing app? Or some other tools some of you might know.</p>

<p>One more tool is there that ease GUI building effort but not possibly reducing couplings between components.</p>

<p><a href=""http://code.google.com/p/javabuilders/"" rel=""nofollow"">http://code.google.com/p/javabuilders/</a></p>

<p>So what do you think which should be better. Please give some insights on this if any of you came across this kind of design dillema.</p>

<p>Thanks in advance.</p>
","<java><swing><refactoring><dependency-injection>","2","182","2010-12-17 12:02:52"
"4484810","Refactoring a huge class to lots of tiny classes","<p>I have a wonderful opportunity to refactor out old and ""smelly"" code<br>
into a much better designed class family.   </p>

<p>I have the basic design skeleton figured out, implemented and <strong>tested</strong>.   </p>

<p>However, I reached a point where I have a big ""Manager"" class<br>
that does manage what it is supposed to manage (lets suppose some tricky task queue),<br>
but it is also responsible for some other stuff, which were not my first intention for this class.  </p>

<p>Creating a set of new classes </p>

<pre><code>class OperationAPerformer
{
    void PerformA(input){...}
}

class OperationBPerformer
{
    void PerformB(input){...}
}
</code></pre>

<p>feels like not the right solution.
Keeping the logic for OperationA, OperationB in the manager class
seems to inflate the Manager class with no good design reason</p>

<p>Any suggestions?
Thanks!</p>

<p>Ok, so I can't post all my code here
but basic design (or skeleton)</p>

<pre><code>InitEventHandler  
SubmitEventHandler  
CancelEventHandler  
SuccessEventHandler  
FailureEventHandler  
ProgressReportedEventHandler  
TimeOutEventHandler
</code></pre>

<p>...<br>
The event handlers update some parameters
and do some management work like after failure recovery,
UI parameters update and the like..</p>

<p>OperationA and OperationB are related, but make up for lots of code
that disguises the main skeleton of the class  </p>

<p>Related Ops<br>
SaveProducts()
   SaveStepA
   SaveStepB
...  </p>

<p>ValidateResponses
    ValidatePartA
    ValidatePartB
...  </p>

<p>Creating a class like  </p>

<pre><code>class Validator
{
   public bool Validate(Response resp) {...}
   private bool PartA(...){...}
   private bool PartB(...){...}
}
</code></pre>

<p>seems inappropriate because the class is only a set of related methods...
is it enough justification to create a class?</p>
","<design><refactoring><coding-style>","0","152","2010-12-19 19:59:24"
"4489662","Refactoring session variables","<p>I'm visiting an app that's been in use for the past 2+ years and it is in desperate need of refactoring.  It is of my own work, but you know what it's like when you visit old code again.</p>

<p>Anyway I've been using the <a href=""http://sourcemaking.com/refactoring"" rel=""nofollow"">excellent advice at sourcemaking</a> to refactor and the code is already looking much better.</p>

<p>The problem now is there are loads of Session[""variable""] sprinkled throughout the code, so what's the most accepted way to refactor these out?  I found <a href=""http://www.codeproject.com/KB/session/wrapthosesessionvariables.aspx?msg=2229362"" rel=""nofollow"">this article at code project</a> but apparently it can be quite dangerous.</p>
","<asp.net><session><refactoring><session-variables><refactor-my-code>","0","80","2010-12-20 12:36:14"
"4493705","MySQL to PostgreSQL: How to modify this SQL query?","<p>I have this MySQL query that makes use of <code>MONTH()</code> and <code>YEAR()</code>:</p>

<pre><code>SELECT 
  MONTH(created_at) AS month, 
  YEAR(created_at) AS year 
FROM users 
GROUP BY MONTH(created_at), YEAR(created_at) 
ORDER BY YEAR(created_at), MONTH(created_at)
</code></pre>

<p>How would I modify that query to work with PostgreSQL?</p>
","<sql><mysql><query><postgresql><refactoring>","2","177","2010-12-20 20:37:25"
"4491002","Refactoring Data Contracts","<p>I want to add DataMember attributes for the properties in a class
Is there any way to automatically add the attribute maybe some refactoring tool.</p>
","<wcf><refactoring>","1","47","2010-12-20 15:21:07"
"4504794","Paranoid: avoiding code duplication in/after loops","<p>I've got a bit strange question on code duplication. There are lots of loops like this:
</p>

<pre><code>    $prev_name = null;
    $clone = null;

    while($row = mysql_fetch_assoc($res)){
      if($prev_name != $row['req']){    
        if($prev_name){
          while($clone &lt;= $end){            
            echo '&lt;td&gt;-&lt;/td&gt;';              
            $clone-&gt;step();
          }
          echo '&lt;/tr&gt;';
        }
        echo '&lt;tr&gt;&lt;td&gt;' . htmlspecialchars($prev_name = $row['req']) . '&lt;/td&gt;';                                                                                                                                    
        $clone = clone $start;        
      }

      $rowdate = date_create($row['date']);
      while($clone &lt; $rowdate){         
        echo '&lt;td&gt;-&lt;/td&gt;';
        $clone-&gt;step();
      }

      echo '&lt;td&gt;' . $row[$field] . '&lt;/td&gt;';
      $clone-&gt;step();
    }

    if($prev_name){
      while($clone &lt;= $end){
        echo '&lt;td&gt;-&lt;/td&gt;';
        $clone-&gt;step();
      }
      echo '&lt;/tr&gt;';
    }
</code></pre>

<p></p>

<p>as you see if() after loop is the same as 2-nd if() in loop. is it possible to reduce this kind of duplication?</p>
","<refactoring>","0","60","2010-12-21 23:05:10"
"4513889","Making one value ""special""","<p>What is the ""computer science"" term for the practice of assigning a special meaning to one of a type's values?  For example a numeric variable called ""amount_to_transfer"" where the special value ""0"" means ""entire account balance"" or a date value ""spouse_date_of_birth"" where ""1/1/1800"" means ""unmarried"".</p>

<p>I happen to feel that this is quite a bad ""smell"", but I'd like to have a name for it, and if possible, some blog post or article about why it's bad and how to fix it.</p>
","<refactoring><code-smell>","8","102","2010-12-22 21:24:27"
"4524190","How to refactor in Grails","<p>I'm doing a project that requires some refactoring.</p>

<p>My domain class is like:</p>

<pre><code>Book {

static belongsTo[category: category]
Category category;
String name;

}

Category {

static hasMany [books: Book]
String name;
Category parent;

}
</code></pre>

<p>Now I want to change that one book may <em>belongsTo</em> many categories. I know how to transform the domains, but overwhelmed by the fact that I must change every single appearance of category in my view/controller/service.</p>

<p>For example, when a book can be in 2 categories, I no longer can use the navigator like ""Sciences > Math > Math for elemental class"".</p>

<p>I'm new in this project, so that I also fear that I may broke something while trying to repair the code.</p>

<p>Did anyone have the same experience? Is there any tip that can help reduce the complexity of this refactoring work?</p>
","<grails><refactoring><grails-domain-class>","2","259","2010-12-24 04:22:05"
"4513635","Refactoring in WPF w/Blend 4 + Visual Studio 2010","<p>I've been playing around with refactoring in Visual Studio 2010 (Express) and Blend 4, and I've found that it's a little picky, but I want to make sure I'm doing it right, so...questions:</p>

<p>1) It seems like the best way to refactor (rename say a UserControl, including the xaml and cs filenames) is to do it from Visual Studio within the cs file. Is that correct?</p>

<p>1a) What's the easiest way to rename a control when you're working in Blend? (I do this often.)</p>

<p>2) In the Java tools I'm used to, renaming always implies refactoring (automatically changing not only class names but file names also).  But in Blend/VS, it seems there's a distinction between the two?</p>

<p>3) Is there a use for renaming a control rather than refactoring, or is rename just for things like resources rather than xaml/cs files?</p>

<p>4) Why doesn't refactoring a class name change the file name to match automatically?</p>
","<.net><wpf><visual-studio><refactoring><expression-blend>","1","238","2010-12-22 20:57:14"
"4527906","Refactoring static methods into instance methods in Eclipse","<p>How can I refactor</p>

<pre><code>class Plugh {
    static void foo(Bar bar);
}
</code></pre>

<p>into</p>

<pre><code>class Bar {
    void foo();
}
</code></pre>

<p>using Eclipse? IOW make the static methods into instance methods of one of the arguments.</p>
","<java><eclipse><refactoring>","3","465","2010-12-24 18:59:34"
"4528805","Do ruby on rails programmers refactor?","<p>I'm a Java programmer who started programming Ruby on Rails one year ago. I like the language, rails itself and the principles behind them. But something that bothers me is that Ruby programmers don't seem to refactor.</p>

<p>I noticed that there is a big lack of tools for refactoring in Ruby / Rails. Some IDE's, like Aptana and RubyMine seem to offer some very basic refactoring, but nothing really big compared to Eclipse's Java refactorings.</p>

<p>Then there is another fact: most railers (even the pros) prefer some lightweight editors, like VIM or TextMate, instead of IDEs. Well, with these tools you just get zero refactoring (only regex with find/replace).</p>

<p>This leaves me this impression that rails programmers don't refactor. It might be just a false impression, of course, but I would like to hear the opinion of people who work professionally with ruby on rails. </p>

<p>Do you refactor? If you do, how do you do it,with which tools? If not, why not?</p>
","<ruby-on-rails><ruby><refactoring>","9","624","2010-12-25 00:08:22"
"4531098","Can you help me refactor this piece of clojure code to produce a seq?","<p>I want to produce a seq that I can later do a (map) over. It should look like this:</p>

<pre><code>((0 0) (0 1) (0 2) (0 3) ... (7 7))
</code></pre>

<p>The piece of code I have to do it right now seems very, very ugly to produce such a simple result. I need some help getting this straight.</p>

<pre><code>(loop [y 0 x 0 args (list)]  
  (if (and (= y 7) (= x 7))  
    (reverse (conj args (list y x)))  
    (if (= x 7)  
    (recur (+ y 1) 0 (conj args (list y x)))  
    (recur y (+ x 1) (conj args (list y x))))))  
</code></pre>
","<refactoring><clojure>","2","141","2010-12-25 17:57:15"
"4532699","How can I refactor this Rails 3 code?","<p>Can anybody figure a way to refactor this further?</p>

<pre><code>@hourly_pay = {}
HourlyPay.all.each { |hp| @hourly_pay[t(""hourly_pay.#{hp.amount}"")] = hp.amount }
</code></pre>

<p>Thanks!</p>

<hr>

<p>Edit: based on the answers I've received, here's how I refactored</p>

<pre><code>HourlyPay.all.map(&amp;:amount).index_by { |hp| t(""hourly_pay.#{hp.amount}"") }
</code></pre>

<p>Placing this into my model directly, this becomes</p>

<pre><code>  def self.get_options
   all.map(&amp;:amount).index_by { |hp| I18n.t(""hourly_pay.#{hp.amount}"") }
  end
</code></pre>

<p>However, I'm not sure if this is more calculation intensive, since I'm calling <code>map</code> on the values returned from the database, and then calling <code>index_by</code> on that.
Since my HourlyPay model only includes an <code>id</code> and an <code>amount</code>, I'm not worried about selecting everything. However, if I had a lot more fields, I would do the following instead:</p>

<pre><code>def self.get_options
 select(:amount).map(&amp;:amount).index_by { |hp| I18n.t(""hourly_pay.#{hp.amount}"") }
end
</code></pre>

<p>So only the amount field is selected</p>

<p>Thanks for the responses!</p>
","<ruby-on-rails><refactoring><ruby-on-rails-3><refactor-my-code>","2","149","2010-12-26 04:05:11"
"4532730","Eclipse refactoring plugins","<p>I am after more <strong>refactoring</strong> options than the default that comes in Eclipse 3.6. Can anyone list any other plugins that do refactoring and what they do ?</p>

<p>My original problem was i wanted to re-order some type parameter declarations in some classes and unfortunately for me the default refactorings in Eclipse did not support moving them around...</p>
","<eclipse><refactoring><eclipse-jdt>","1","672","2010-12-26 04:18:08"
"4559569","An elegant way of linking global methods and logging the results","<p>Imagine I have a set of global methods that aren't associated with any specific classes. Each method takes exactly one object and returns exactly one object of various types.</p>

<p>I want to be able to link these methods together so that the object returned by one method gets passed as a parameter to the next method and so on.
Extension methods are the easiest and most elegant way I can think of for accomplishing this:</p>

<pre><code>var result = someObj.ExtensionMethod1().ExtensionMethod2().ExtensionMethod3();
</code></pre>

<p>However, I also have a <code>log</code> method which takes an object parameter and I want to pass the result of each method to this <code>log</code> method. For example:</p>

<pre><code>var result1 = someObj.ExtensionMethod1();
log(result1);
var result2 = result1.ExtensionMethod2();
log(result2);
var result3 = result2.ExtensionMethod3();
log(result3);
</code></pre>

<p>Is there a more elegant of way of doing this so I won't have to create temporary variables to pass every time I call a method?</p>
","<c#><design-patterns><refactoring><extension-methods>","1","135","2010-12-30 02:33:15"
"4560741","refactoring this block","<p>I'm refactoring some code that wasn't written by me. This block sets the value of <code>$val</code> but I want to clean it up a bit. Obviously I can't use the tertiary operator here. What other ways I can make this code cleaner?</p>

<pre><code>  if (isset($vars[$input])) {
       $val = $vars[$input];
  } elseif (isset($this-&gt;getI['io'])) {
       $val = $this-&gt;getI['io'];
  } elseif (isset($vars[5])) {
       $val = $vars[5];
  } else {
       $val = 10;
  }
</code></pre>
","<php><refactoring>","0","77","2010-12-30 07:09:35"
"4557584","Tips for refactoring a 20K lines library","<p><strong>I've already awarded a 100 point bounty to mario's answer, but might start a second 100 point bounty if I see new good answers coming in. This is why I'm keeping the question open and will not choose a final answer, despite having awarded the bounty to mario.</strong> </p>

<p>This might seem like a simple question (study the code and refactor) but I'm hoping those with lots more experience can give me some solid advice. </p>

<p>The library is an open source 20,000 line library that's all in a single file and which I haven't written myself. The code looks badly written and the single file is even a bigger problem, because it freezes eclipse for half a minute at least every time I want to make a change, which is one of the reasons I think it's worth it to refactor this library into smaller classes.</p>

<p>So aside from reading the code and trying to understand it, are there common (or not so common) tips when refactoring a library such as this? What do you advise to make my life a little easier? </p>

<p>Thanks to everyone for your comments.</p>
","<php><oop><library><open-source><refactoring>","26","1267","2010-12-29 20:28:15"
"4568254","Structuring a Silverlight Application without MVVM","<p>I have inherited a Silverlight application (using wcf services) that doesn't have a lot of structure to it (a lot of code in the code behind, some utility classes, 3 separate pages).  </p>

<p>I have about a day to clean it up a bit so I can't really restructure it to use a MVVM pattern... and to be honest I don't think I have enough experience with MVVM to even do that well to the entire application even if I had more time.</p>

<p>Given those constraints any advice on changes that could help? </p>

<p>thanks.</p>
","<silverlight><architecture><refactoring>","0","115","2010-12-31 05:20:21"
"4580760","How can I automatically refactor my classes to use the default namespace for the folder they're in?","<p>I've been playing around with the structure of my project, and I'd like to reset the namespaces of my classes to what the default would be. That is, the default namespace for the project, plus each of the folders in the hierarchy.</p>

<p>It's not as simple as just find + replace, since I've both added and renamed some folders, and files from some namespaces were split into multiple other namespaces. I'm using VS 2010. </p>
","<visual-studio-2010><refactoring><namespaces>","2","220","2011-01-02 22:07:31"
"4586594","Mix and match class in C++/MFC","<p>I'm trying to re-factor a code base, and there is some common functionality among unrelated classes that I'd love to unite. I would like to add that functionality in common base class, but I'm not sure if it's clean and good approach.</p>

<p>Say I have <code>CMyWnd</code> class and <code>CMyDialogEx</code> class, both different, so they cannot inherit from one base class. I want to add a button to both classes and add the message handlers to both classes as well.</p>

<p>So I'd like to do something like this:</p>

<pre><code>CMyWnd : public CWnd, public COnOkBtnFunctionality, public COnCancelBtnFunctionality
CMyDialogEx: public CWnd, public COnOkBtnFunctionality
</code></pre>

<p>Where <code>COnOkBtnFunctionality</code> would define <code>CButton m_buttonOk</code>, and all the <code>afx_msg</code> functions it should have. And so on.</p>

<p>Is this approach doable/good? Or are there better patterns I should resort to?</p>
","<c++><class><mfc><refactoring>","1","145","2011-01-03 17:15:10"
"4588604","how do i refactor this code?","<p>i have .net 3.5 and i would like to make a generic method.  how do i refactor this code?</p>

<pre><code>            case (int)Enums.SandwichesHoagies.Cheeses:
                if (this.Cheeses.Where(x =&gt; x.Id == product.ProductId).SingleOrDefault() == null)
                {
                    var newCheese = new Cheese
                    {
                        Id = product.ProductId,
                        Name = product.Name,
                        PriceValue = product.Price.HasValue ? (double)product.Price.Value : 0.00
                    };

                    this.Cheeses.Add(newCheese);
                }
                else
                {
                    foreach (var cheese in this.Cheeses.Where(cheese =&gt; cheese.Id == product.ProductId))
                    {
                        this.Cheeses.Remove(cheese);
                        break;
                    }
                }

                foreach (var cheese in Cheeses) cheese.Type = string.Empty;

                if (this.Cheeses.Count &gt; 0) Cheeses.First().Type = ""Cheeses:"";

                break;

            case (int)Enums.SandwichesHoagies.Meats:
                if (this.Meats.Where(x =&gt; x.Id == product.ProductId).SingleOrDefault() == null)
                {
                    var newMeat = new Meat
                    {
                        Id = product.ProductId,
                        Name = product.Name,
                        PriceValue = product.Price.HasValue ? (double)product.Price.Value : 0.00
                    };

                    this.Meats.Add(newMeat);
                }
                else
                {
                    foreach (var meat in this.Meats.Where(meat =&gt; meat.Id == product.ProductId))
                    {
                        this.Meats.Remove(meat);
                        break;
                    }
                }

                foreach (var meat in Meats) meat.Type = string.Empty;

                if (this.Meats.Count &gt; 0) Meats.First().Type = ""Meats:"";

                break;
</code></pre>
","<c#><asp.net><linq><generics><refactoring>","2","196","2011-01-03 21:36:44"
"4590268","Rails 3 refactoring issue","<p>The following view code generates a series of links with totals (as expected):</p>

<pre><code>&lt;% @jobs.group_by(&amp;:employer_name).sort.each do |employer, jobs| %&gt;
    &lt;%= link_to employer, jobs_path() %&gt; &lt;%= ""(#{jobs.length})"" %&gt;
&lt;% end %&gt;
</code></pre>

<p>However, when I refactor the view's code and move the logic to a helper, the code doesn't work as expect.</p>

<p>view:</p>

<pre><code>&lt;%= employer_filter(@jobs_clone) %&gt;
</code></pre>

<p>helper:</p>

<pre><code>def employer_filter(jobs)
    jobs.group_by(&amp;:employer_name).sort.each do |employer,jobs|
        link_to employer, jobs_path()
    end   
end
</code></pre>

<p>The following output is generated:</p>

<pre><code>&lt;Job:0x10342e628&gt;#&lt;Job:0x10342e588&gt;#&lt;Job:0x10342e2e0&gt;Employer A#&lt;Job:0x10342e1c8&gt;Employer B#&lt;Job:0x10342e0d8&gt;Employer C#&lt;Job:0x10342ded0&gt;Employer D#
</code></pre>

<p>What am I not understanding?  At first blush, the code seems to be equivalent.</p>
","<refactoring><view><group-by><ruby-on-rails-3><helpers>","0","175","2011-01-04 02:52:14"
"4592352","Number of parameters for a constructor","<p>I have a class that needs 12 parameters to be passed to its constructor. So I think that there is something wrong with the design of this class.</p>

<p>I would like to ask if there is any design pattern or a general collection of rules regarding the design of a class, especially its constructor.</p>
","<c++><design-patterns><parameters><refactoring><constructor>","19","742","2011-01-04 09:56:56"
"4595228","Help on refactor code duplication, using() try{} catch{}","<p>I have taken over a project that uses WCF-services. The code have some ”code smells” and I want to Refactor these smells and I need advice on how to refactor a code duplication smell.
Every method that is called by the WCF service looks like this:</p>

<pre><code>public Result MyMethod(string aString, string bString)
{
    string methodName = MethodBase.GetCurrentMethod().Name;
    using (LogService log = LogFactory.Create())
    {
        try
        {
             &lt;stmts&gt;
             log.Info(methodName, ""Created entity xyz"");
             &lt;stmts&gt;
        }
        catch (Exception ex)
        { 
            log.Error(methodName, ex.message);
        }

    }
}
</code></pre>

<p>Question is how do I refactor this code? Every WCF call uses this ""code template"". </p>
","<c#><refactoring>","0","165","2011-01-04 15:22:29"
"4603719","Neatest/most idiomatic way to rewrite this If in C#","<p>I have this <code>if-else</code> statement which does what I want. What it's doing is pretty straightforward as you should be able to tell.</p>

<pre><code>if (width != null &amp;&amp; height != null)
{
    if (top != null &amp;&amp; left != null)
    {
        ret.type = VMLDimensionType.full;
    }
    else
    {
        ret.type = VMLDimensionType.size;
    }
}
else
{
    if (top != null &amp;&amp; left != null)
    {
        ret.type = VMLDimensionType.positon;
    }
    else
    {
        ret.type = VMLDimensionType.unset;
    }
}
</code></pre>

<p>The <code>enum</code> being referred to is:</p>

<pre><code>private enum VMLDimensionType
{
    unset = 0,
    full = 1,
    size = 2,
    position = 3
}
</code></pre>

<p>It's so straightforward I'm sure there's a much more terse and more readable way to express this. </p>

<p>NB If it wasn't for the ridiculous 'one-brace per line' rule that VS imposes by default I probably wouldn't be so bothered. Eg in VB I could lose about 10 lines from this code block! (any thoughts on that as an aside?)</p>
","<c#><refactoring><code-snippets><code-readability><conditional-statements>","2","180","2011-01-05 11:52:40"
"4607495","Help me clean up this crazy lambda with the out keyword","<p>My code looks ugly, and I know there's got to be a better way of doing what I'm doing:</p>

<pre><code>private delegate string doStuff(
    PasswordEncrypter encrypter, RSAPublicKey publicKey,
    string privateKey, out string salt
);

private bool tryEncryptPassword(
    doStuff encryptPassword,
    out string errorMessage
)
{
    ...get some variables...
    string encryptedPassword = encryptPassword(encrypter, publicKey,
        privateKey, out salt);
    ...
}
</code></pre>

<p>This stuff so far doesn't bother me.  It's how I'm calling <code>tryEncryptPassword</code> that looks so ugly, and has duplication because I call it from two methods:</p>

<pre><code>public bool method1(out string errorMessage)
{
    string rawPassword = ""foo"";
    return tryEncryptPassword(
        (PasswordEncrypter encrypter, RSAPublicKey publicKey,
            string privateKey, out string salt) =&gt;
            encrypter.EncryptPasswordAndDoStuff( // Overload 1
                rawPassword, publicKey, privateKey, out salt
            ),
        out errorMessage
    );
}

public bool method2(SecureString unencryptedPassword,
    out string errorMessage)
{
    return tryEncryptPassword(
       (PasswordEncrypter encrypter, RSAPublicKey publicKey,
           string privateKey, out string salt) =&gt;
           encrypter.EncryptPasswordAndDoStuff( // Overload 2
               unencryptedPassword, publicKey, privateKey, out salt
           ),
       out errorMessage
   );
}
</code></pre>

<p>Two parts to the ugliness:</p>

<ul>
<li>I have to explicitly list all the parameter types in the lambda expression because of the single <code>out</code> parameter.</li>
<li>The two overloads of <code>EncryptPasswordAndDoStuff</code> take all the same parameters except for the first parameter, which can either be a <code>string</code> or a <code>SecureString</code>.  So <code>method1</code> and <code>method2</code> are pretty much identical, they just call different overloads of <code>EncryptPasswordAndDoStuff</code>.</li>
</ul>

<p>Any suggestions?</p>

<p><strong>Edit (solution):</strong> I ended up using Jeff's suggestion and altering the overloads of <code>EncryptPasswordAndDoStuff</code> to return an instance of <code>EncryptionResult</code>.  Then I didn't need an explicitly defined <code>delegate</code>, and I used the following code:</p>

<pre><code>private bool tryEncryptPassword(KeysAndEncrypter keys,
    Func&lt;EncryptionResult&gt; encryptPassword,
    out string errorMessage
) { ... }

private class KeysAndEncrypter
{
    public RSAPublicKey PublicKey { get; set; }
    public string PrivateKey { get; set; }
    public PasswordEncrypter Encrypter { get; set; }
}
</code></pre>

<p>And here was the contents of <code>method1</code>, with <code>method2</code> being very similar:</p>

<pre><code>string rawPassword = ""foo"";
KeysAndEncrypter keys = getEncryptionKeys();
return tryEncryptPassword(keys, () =&gt;
    keys.Encrypter.EncryptPasswordAndDoStuff(
        rawPassword, keys.PublicKey, keys.PrivateKey
    ),
    out errorMessage
);
</code></pre>
","<c#><lambda><delegates><refactoring><refactor-my-code>","0","185","2011-01-05 18:00:59"
"4611731","Abstracting functions / avoiding repetition in functions","<p>I need some advice on abstracting the <code>find</code> and <code>check-callback</code> functions. The code works fine, but it seems that there is a lot of unnecessary repetition. Is there a more elegant way to re-write them?</p>

<pre><code>;; Model
(define-struct contact (name phone))
(define phonebook (list (make-contact 'adam 5551212)
                        (make-contact 'brian 5552323)
                        (make-contact 'chris 5558888)))

;; find: (string-&gt;symbol, string-&gt;number) item (listof items) -&gt; symbol/number/false
(define (find type item pb)
  (cond
    [(empty? pb) false]
    [(equal? (string-&gt;symbol item) (contact-name (first pb))) (contact-phone (first pb))]
    [(equal? (string-&gt;number item) (contact-phone (first pb))) (contact-name (first pb))]
    [else (find type item (rest pb))]))

;; Controller
(define (check-callback b)
  (cond
    [(number? (find string-&gt;symbol (text-contents a-text-field) phonebook))
     (draw-message a-msg (number-&gt;string (find string-&gt;symbol (text-contents a-text-field) phonebook)))]
    [(symbol? (find string-&gt;number (text-contents a-text-field) phonebook))
     (draw-message a-msg (symbol-&gt;string (find string-&gt;number (text-contents a-text-field) phonebook)))]
    [else (draw-message a-msg ""Not found"")]))


;; View
(define a-text-field
  (make-text ""Enter a name or phone number""))

(define a-msg
  (make-message """"))

(define a-button
  (make-button ""Search"" check-callback))

(create-window
 (list (list a-text-field)
       (list a-button)
       (list a-msg)))
</code></pre>
","<refactoring><functional-programming><scheme><racket>","1","136","2011-01-06 04:25:35"
"4622633","Automated way to Extract Interfaces from a Java Class","<p>I've got a collection of concrete Classes which define an API, and I would like to extract the Interface of these classes (ie: essentially the type hierarchy and public methods) from the actual implementation of the API.</p>

<p>So for example if one of the public classes in the API is </p>

<pre><code> public class Foo extends Bar {
     /* some fields which I don't care about */

     public void method() {
     /* implementation here */
     } 

     public void otherMethod() {
     /* implementation goes here */
     }

    /* some non public methods which I don't care about */

 }
</code></pre>

<p>I would like to break into an interface and an implementation</p>

<p>ie</p>

<pre><code>public interface FooInterface extends BarInterface {
    public void method();
    public void otherMethod()
}

 public class Foo implements FooInterface {
  /* etc etc */
 }
</code></pre>

<p>and </p>

<p>Is there a tool I can use to do this separation in automated way, or am I going to have to roll my own program to do the job? It needs to be a tool that requires minimal interaction.</p>
","<java><tools><interface><refactoring>","2","383","2011-01-07 04:56:10"
"4628401","How do write conditional statement in a single line? rails","<p>I am trying to say this </p>

<pre><code>self.preferred_amount * object.each{|li|li.variant}.collect{|li|li.weight}
</code></pre>

<p>The only problem is that certain weights equal nil.</p>

<p>Being that the case, I would like to add that if they do equal nil, make them equal 0.</p>

<p>Is there any way to incorporate this logic in the same line?</p>

<p>Or is there a way I can make this statement even more refactored than it is?</p>
","<ruby-on-rails><ruby><refactoring>","1","681","2011-01-07 17:30:40"
"4629149","refactoring Quartz jobdata","<p>I had to refactor a class like this:</p>

<p>Class Person in package com.core has a reference to Class Address which is in the same package. I had to move Address to a new package com.core.location. This was simple on the java side, however, there are some quartz triggers which have com.core.Person referencing the old com.core.Address class as part of their job data map. It could be anywhere in the Map.</p>

<p>I have tried a few approaches, like writing an adapter which acts like a common ground between 2 java programs that eventually replace the ols class with the new one. What would be the best way to resolve this?</p>

<p>Thanks,
Chris.</p>
","<java><update><refactoring><triggers><quartz>","1","134","2011-01-07 18:54:35"
"4621261","Is it better to reuse SqlCommand when executing the same SQL query several times?","<p>When querying the database with the same query but different parameters, is it better to:</p>

<ul>
<li>do it in a single using,</li>
<li>or to create two separate queries?</li>
</ul>

<p><strong>Example of a single using:</strong></p>

<pre><code>using (SqlCommand addProduct = new SqlCommand(@""insert into [Products].[Products] ([Name], [Price]) values (@name, @price)"", sqlConnection))
{
    // Insert the first product.
    addProduct.Parameters.AddWithValue(""@name"", ""Product 1"");
    addProduct.Parameters.AddWithValue(""@price"", 41F);
    int countAffectedRows = addProduct.ExecuteNonQuery();
    Debug.Assert(countAffectedRows == 1, ""Wrong number of rows affected."");

    addProduct.Parameters.Clear();

    // Insert the second product.
    addProduct.Parameters.AddWithValue(""@name"", ""Product 2"");
    addProduct.Parameters.AddWithValue(""@price"", 49.9);
    countAffectedRows = addProduct.ExecuteNonQuery();
    Debug.Assert(countAffectedRows == 1, ""Wrong number of rows affected."");
}
</code></pre>

<p><strong>Example of the same code using two separate queries:</strong></p>

<pre><code>// Insert the first product.
using (SqlCommand addProduct = new SqlCommand(@""insert into [Products].[Products] ([Name], [Price]) values (@name, @price)"", sqlConnection))
{
    addProduct.Parameters.AddWithValue(""@name"", ""Product 1"");
    addProduct.Parameters.AddWithValue(""@price"", 41F);
    int countAffectedRows = addProduct.ExecuteNonQuery();
    Debug.Assert(countAffectedRows == 1, ""Wrong number of rows affected."");
}

// Insert the second product.
using (SqlCommand addProduct = new SqlCommand(@""insert into [Products].[Products] ([Name], [Price]) values (@name, @price)"", sqlConnection))
{
    addProduct.Parameters.AddWithValue(""@name"", ""Product 2"");
    addProduct.Parameters.AddWithValue(""@price"", 49.9);
    int countAffectedRows = addProduct.ExecuteNonQuery();
    Debug.Assert(countAffectedRows == 1, ""Wrong number of rows affected."");
}
</code></pre>

<p>In my opinion, the second one must be preferred, because:</p>

<ul>
<li>it makes it more clear to see where the SQL command is disposed and how much times it is executed,</li>
<li>it is easier to modify if, in future, for some reason, the query must be modified in one case, but not in the other,</li>
<li>the first one makes it easy to forget the <code>SqlCommand.Parameters.Clear()</code>.</li>
</ul>

<p>On the other hand, the first sample is more explicit about the fact that the query is the same in both cases, and that only parameters change.</p>
","<c#><refactoring><readability>","3","1111","2011-01-06 23:52:23"
"4633578","Replace a method call","<p>I want to achieve below task:<br>
1. I need to search Html.Resource(""key"") in my application and replace it with GetResource(""key"",object)<br>
2. The GetResource method has two parameters: the first parameter should be the same as the original method,""key"" in this case, and I need to pass in the second parameter which is variable.<br>
3. I need to replace only when the Html.Resource(""key"") occurs inside certain tags like  td and div else I need not replace it.</p>

<p>Thanks in advance     </p>
","<refactoring>","0","63","2011-01-08 11:11:37"
"4648242","Is this a good approach to dealing with tagging?","<p>Can this code be optimized or re-factored? Is this an optimal approach to tagging?</p>

<p>The following code is a callback in my posts model. It creates a record that associates a tag with a post in a QuestionsTags joiner table. When necessary, if a given tag does not already exist in the tags table, the function creates it, then uses its id to create the new record in the QuestionsTags table.</p>

<p>The difficulty with this approach is the QuestionsTags table depends on data in the tags table which may or may not exist.</p>

<p>The function assumes the following tables: </p>

<pre><code>tags(id, tagName),
posts(tags) // Comma delimited list
questionsTags(postId, tagId)
</code></pre>

<p>The idea is to loop over a delimited list of tags submitted with a post and check to see if each tag already exists in the tags table</p>

<p><strong>If tag exists:</strong></p>

<ol>
<li>Check to see if there's already a QuestionTag record for this post and this tag in the QuestionTags table.</li>
<li>If yes, do nothing (the association already exists)</li>
<li>If no, create a new QuestionTag record using the id of the existing tag and the postId</li>
</ol>

<p><strong>If tag does not already exist:</strong></p>

<ol>
<li>Create the new tag in the tags table</li>
<li>Use its id to create a new QuestionsTags record </li>
</ol>

<p>Code</p>

<pre><code>/**
* @hint Sets tags for a given question.
**/
private function setTags()
{
    // Loop over the comma and space delmited list of tags
    for (local.i = 1; local.i LTE ListLen(this.tags, "", ""); local.i = (local.i + 1))
    {
        // Check if the tag already exists in the database
        local.tag = model(""tag"").findOneByTagName(local.i);
        // If the tag exists, look for an existing association between the tag and the question in the QuestionTag table
        if (IsObject(local.tag))
        {
            local.questionTag = model(""questionTag"").findOneByPostIdAndTagId(values=""#this.postId#,#local.tag.id#"");
            // If no assciatione exists, create a new QuestionTag record using the tagId and the postId
            if (! IsObject(local.questionTag))
            {
                local.newQuestionTag = model(""questionTag"").new(postId = this.id, tagId = local.tag.id);
                // Abort if the saving the new QuestionTag is unsuccesful
                if (! local.newQuestionTag.save())
                {
                    return false;
                }
            }
        }
        // If the tag does not exist create it
        else
        {
            local.newTag = model(""tag"").new(tagName = local.i, userId = this.ownerUserId);
            // Abort if the the new tag is not saved successfully
            if (! local.newTag.save())
            {
                return false;
            }

            // Otherwise create a new association in the QuestionTags table using the id of the newly created tag and the postId
            local.newQuestionTag = model(""questionTag"").new(postId = this.id, tagId = local.newTag.id);
            // Abort if the new QuestionTag does not save correctly
            if (! local.newQuestionTag.save())
            {
                return false;
            }
        }
    }
}
</code></pre>

<p>FYI: I'm using CFWheels in my application, which explains the ORM functions used.</p>
","<mvc><coldfusion><refactoring><tagging><cfwheels>","1","100","2011-01-10 15:12:38"
"4649498","Refactoring—good practise in Sockets—simple server-client Swing appl","<p>I have written a simple server - client program with Swing interface using singleton and observer pattern. Each client connects to the server and can send messages. The server forwards the messages it receives to the rest of the clients. The clients are using a GUI which allows them to connect and disconnect to the server at any time. 
The program works pretty well because I have try - catch everywhere that handle each exception that may occur. But if you play with it you will see in the console a million of exceptions. That is probably because of poor design but i have tried my best to do a clean code. 
so the question is : </p>

<p>Can anybody give me hints and advises on how to refactor the code to be more correct and clean (Especially when it comes to disconnect a client from the server)?</p>

<p>There is a main method in the <code>CustomServer</code> class to start the server and a
main method  in the Controller to start the client (with GUI).</p>

<p>Thank you for your kind help!</p>

<p>Here is the code:</p>

<p>CustomServer class </p>

<pre><code>package model;
import java.io.*;
import java.net.*;
import controller.Controller;


public class CustomServer extends Thread{
private ServerSocket ss = null;;



public CustomServer() throws Exception {
    ss = new ServerSocket(4444);
    this.start();
}

@Override
public void run(){
    while (true){
        try {
            Socket connSoc = ss.accept();
            new Connect(connSoc);
        } catch (IOException e) {
            e.printStackTrace();
            try{
                ss.close();
            }catch (Exception e1) {
                e1.printStackTrace();
            }
        }

    }
}

private class Connect extends Thread{
    ObjectOutputStream out;
    ObjectInputStream in;

    public Connect(Socket connSoc) {
        final IOController server = IOController.getInstance();
        try {
            out = new ObjectOutputStream(connSoc.getOutputStream());
            in = new ObjectInputStream(connSoc.getInputStream());
            server.add(in, out);
        }catch (Exception e) {
            e.printStackTrace();
            try{
                connSoc.close();
            }catch (Exception ex) {
                e.printStackTrace();
            }
        }
        this.start();
    }
}



public static void main(String[] args) throws Exception{
    new CustomServer();
}

}
</code></pre>

<p>CustomClient Class</p>

<pre><code>package model;
import java.io.*;
import java.net.*;
import java.util.*;

public class CustomClient extends Observable{

private Socket connSocket;
private ObjectOutputStream out;
private ObjectInputStream in;
private boolean isOn = true;
private Thread receiver;

public CustomClient() throws Exception{
        System.out.println(""inside CClient"");
        Socket soc = new Socket();
        soc.connect(new InetSocketAddress(InetAddress.getLocalHost(), 4444));
        out = new ObjectOutputStream(soc.getOutputStream());
        in = new ObjectInputStream(soc.getInputStream());
}

public void transmit(Object obj){
    System.out.println(""CClient - transitmin - start"");
    try {
        out.writeObject(obj);
        out.flush();
    } catch (IOException e) {
        e.printStackTrace();
    }
    System.out.println(""CClient - transitmin - end"");
}

public void reveive(){
    System.out.println(""CClient - recieve - start"");
    receiver = new Thread(new Runnable() {
        @Override
        public void run() {
            while (isOn){
                Object obj = null;
                try {
                    obj = in.readObject();
                    setChanged();
                } catch (Exception ex){
                    ex.printStackTrace();

                }
                if (hasChanged()){
                    notifyObservers(obj);
                }
            }

        }
    });
    receiver.start();
    System.out.println(""CClient - recieve - end"");

}

public void closeConnection(){
    try{
        in.close();
    } catch (Exception e) {
        System.err.println(""CAUGHT"");
        e.printStackTrace();
    }
    try{
        out.close();
    } catch (Exception e) {
        System.err.println(""CAUGHT"");
        e.printStackTrace();
    }
    finally {
        try {
            isOn = false;
            in = null;
            out = null;
            connSocket.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        connSocket = null;
    }
}

public Socket getSocket(){
    return connSocket;
}

}
</code></pre>

<p>IOController class</p>

<pre><code>package model;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.ArrayList;

public class IOController{

ArrayList&lt;ObjectInputStream&gt; ins = new ArrayList&lt;ObjectInputStream&gt;();
ArrayList&lt;ObjectOutputStream&gt; outs = new ArrayList&lt;ObjectOutputStream&gt;();
private static IOController instance = new IOController();

private IOController() {    
}

public static IOController getInstance(){
    return instance;
}

public void add(final ObjectInputStream in, final ObjectOutputStream out){
    ins.add(in);
    outs.add(out);
    new Connect(in);
}

private class Connect extends Thread{
    ObjectInputStream in;

    public Connect(ObjectInputStream in) {
        this.in = in;
        this.start();
    }

    @Override
    public void run() {
        boolean isOn = true;
        ArrayList&lt;ObjectOutputStream&gt; toBeRemoved = new ArrayList&lt;ObjectOutputStream&gt;();
        while(isOn){
            try {
                Object obj = in.readObject();
                for (ObjectOutputStream out : outs){
                    try {
                        out.writeObject(obj);
                        out.flush();
                    }catch (Exception ex){
                        toBeRemoved.add(out);
                        ex.printStackTrace();
                    }
                }
                for (ObjectOutputStream oos : toBeRemoved){
                    outs.remove(oos);
                }
            }catch (Exception ex){
                ins.remove(in);
                isOn = false;
                in = null;
                ex.printStackTrace();
            } 
        } 
    }
}
}
</code></pre>

<p>Controller class</p>

<pre><code>package controller;
import java.awt.*;
import view.GUI;
import model.CustomClient;

public class Controller {

private GUI gui;
private CustomClient client;


public Controller() {
    gui = new GUI();
    gui.addConnectButtonActionListener(new ConnectButtonActionListener());
    gui.addTextFieldKeyListner(new TextFieldKeyListener());
    gui.addDisconnectButtonActionListener(new DisconnectButtonActionListener());
    gui.addCustomWindowListener(new GuiWindowListener());
}

private class DisconnectButtonActionListener implements ActionListener{

    @Override
    public void actionPerformed(ActionEvent e) {
        client.closeConnection();
        client = null;
        gui.getDisconnectButton().setEnabled(false);
        gui.getConnectButton().setEnabled(true);
    }
}


private class ConnectButtonActionListener implements ActionListener{

    @Override
    public void actionPerformed(ActionEvent e) {
        try { 
            client = new CustomClient();
            client.addObserver(gui);
            client.reveive();
            gui.getConnectButton().setEnabled(false);
            gui.getDisconnectButton().setEnabled(true);
        }catch (Exception ex) {
            ex.printStackTrace();
        }
    }
}

private class TextFieldKeyListener extends KeyAdapter{

    @Override
    public void keyReleased(KeyEvent e) {
        if (e.getKeyCode()==KeyEvent.VK_ENTER){
            String msg = gui.getTextField().getText();
            gui.getTextField().setText("""");
            if (client != null){
                client.transmit(msg);
            }
        }
    }
}

private class GuiWindowListener extends WindowAdapter{

    @Override
    public void windowClosing(WindowEvent e) {
        try{
            if (client != null){
                client.closeConnection();
                client = null;
            }
        }catch (Exception e2) {

        }
        System.out.println(""closed"");


    }
}

public static void main(String[] args) {
    new Controller();
    }
}
</code></pre>

<p>and  GUI class</p>

<pre><code>package view;
import java.awt.*;
import java.awt.event.*;
import java.util.*;
import javax.swing.*;
public class GUI extends JFrame implements Observer{

private JTextField textField;
private JTextArea displayArea;
private JButton connectButton;
private JButton disconnectButton;

public GUI() {
    init();
    setDefaultCloseOperation(EXIT_ON_CLOSE);
    SwingUtilities.invokeLater(new Runnable() {

        @Override
        public void run() {
            pack();
            setVisible(true);
            textField.requestFocusInWindow();
        }
    });
}

public void addConnectButtonActionListener(ActionListener al){
    connectButton.addActionListener(al);
}
public void addDisconnectButtonActionListener(ActionListener al){
    disconnectButton.addActionListener(al);
}
public void addTextFieldKeyListner(KeyListener kl){
    textField.addKeyListener(kl);
}

public void addCustomWindowListener(WindowListener guiWindowListener) {
    addWindowListener(guiWindowListener);

}

public void appendText(String text){
    displayArea.append(""\n""+ text);
}

private void init() {
    JPanel panel = new JPanel();
    JPanel southPanel = new JPanel();
    JPanel northPanel = new JPanel();

    connectButton = new JButton(""connect"");
    connectButton.setFocusable(false);
    disconnectButton = new JButton(""disconnect"");
    disconnectButton.setFocusable(false);
    textField = new JTextField(20);
    displayArea = new JTextArea();
    displayArea.setEditable(false);
    displayArea.setPreferredSize(new Dimension(300,250));

    panel.setLayout(new BorderLayout());
    southPanel.setLayout(new FlowLayout());
    northPanel.setLayout(new FlowLayout());

    northPanel.add(displayArea);
    southPanel.add(connectButton);
    southPanel.add(disconnectButton);

    panel.add(textField,BorderLayout.CENTER);
    panel.add(southPanel, BorderLayout.SOUTH);
    panel.add(northPanel, BorderLayout.NORTH);
    this.getContentPane().add(panel);

    disconnectButton.setEnabled(false);

    System.out.println(textField.hasFocus());
}


public JTextField getTextField() {
    return textField;
}

public void setTextField(JTextField textField) {
    this.textField = textField;
}

public JTextArea getDisplayArea() {
    return displayArea;
}

public void setDisplayArea(JTextArea displayArea) {
    this.displayArea = displayArea;
}

public JButton getConnectButton() {
    return connectButton;
}

public void setConnectButton(JButton connectButton) {
    this.connectButton = connectButton;
}

public JButton getDisconnectButton() {
    return disconnectButton;
}

public void setDisconnectButton(JButton disconnectButton) {
    this.disconnectButton = disconnectButton;
}

@Override
public void update(Observable observable, Object object) {
    displayArea.append(""\n""+(String)object);
}
}
</code></pre>
","<java><multithreading><sockets><refactoring><refactor-my-code>","2","298","2011-01-10 17:18:43"
"4650240","Refactor: Javascript block","<p>Need some help refactoring this code:</p>

<pre><code>$(""span[rel=color_content]"").ColorPicker({
  onChange: function (hsb, hex, rg) {
    $(""span[rel=color_content]"").css('background-color', '#' + hex);
  }
});
$(""span[rel=color_link]"").ColorPicker({
  onChange: function (hsb, hex, rg) {
    $(""span[rel=color_link]"").css('background-color', '#' + hex);
  }
});
$(""span[rel=color_selected]"").ColorPicker({
  onChange: function (hsb, hex, rg) {
    $(""span[rel=color_selected]"").css('background-color', '#' + hex);
  }
});
$(""span[rel=color_page]"").ColorPicker({
  onChange: function (hsb, hex, rg) {
    $(""span[rel=color_page]"").css('background-color', '#' + hex);
  }
});
$(""span[rel=color_player]"").ColorPicker({
  onChange: function (hsb, hex, rg) {
    $(""span[rel=color_player]"").css('background-color', '#' + hex);
  }
});
</code></pre>

<p>The only thing changing between each is the contents of the <code>rel</code> attribute.</p>
","<javascript><jquery><refactoring>","0","90","2011-01-10 18:45:55"
"4650966","Converting an AWT application to SWT/JFace","<p>I am currently toying with the idea of converting a small/medium sized project from AWT to SWT, although Swing is not totally out of the picture yet. 
I was thinking about converting the main window to an SWT_AWT bridge object, but I have no idea how the semantics for this work. After that, I plan to update dialog for dialog, but not necessarily within one release. Is this possible?</p>

<p>Has someone done a conversion like this and can give me some hints? Is there maybe even a tutorial somewhere out there?  Is there maybe even a tool that can automate parts of this? I have tried googling, but to no avail.</p>

<p>Update: One additional thing is: Currently, this is a netbeans project. Might be of help or not, I don't know. </p>
","<java><refactoring><swt><awt>","2","457","2011-01-10 20:05:12"
"4651004","Is there something like .NET Reflector for Qt?","<p>Once I've seen a nice tool called .NET Reflector. It can show the entire object hierarchy of .Net binaries/apps (sorry if the term is wrong).
Is there something like this for Qt? As Qt has very good QMetaObject abilities, it should be possible to traverse object-trees, call methods(slots), change properties, etc.</p>

<p>I am currently re-factoring a Qt project. The naming of variables is very domain specific and I am not the expert in this domain. So, it is difficult for me to map a widget-variable to the widget on the screen. Such tool would be a great help for me to understand the code.</p>

<p>Thank you very much in advance!</p>
","<qt><reflection><refactoring>","2","221","2011-01-10 20:09:45"
"4651959","Is there a more elegant way to achieve a ""cheat code"" implementation for a game in C++?","<p>I have been learning C++ by diving into a project, a simple 2d game. I have attempted to implement a set of cheats but I'm seriously novice at string manipulation. I'm sure there would be a more elegant way to achieve what I would like than my code below. </p>

<p>As requested, <code>stringBuffer</code> is just a string that contains the last 12 pressed characters. I prepend it because it's trimmed at the end later with resize, and hence my cheats have to be backwards. I'm very much a noob at string manipulation, and I know something is wrong here, which I why I asked for it to be looked at and possibly improved.</p>

<pre><code>//The following code is in my keyPressed function
cheatBuffer = (char)key + cheatBuffer;
cheatBuffer.resize(12);
string tempBuffer;
string cheats[3] = {""1taehc"",""2taehc"",""3taehc""};
for(int i = 0;i &lt; 3;i++){
    tempBuffer = cheatBuffer;
    tempBuffer.resize(cheats[i].size());
    if(cheats[i] == tempBuffer){
        switch(i){
            case 1:
                //activate cheat 1
                break;
            case 2:
                //active cheat 2
                break;
            case 3:
                //active cheat 3
                break;
        }
    }
}
</code></pre>

<p>The codes are ""cheat1"", ""cheat2"" and ""cheat3"" respectively. I can't help thinking that this could be a lot better. Any insight would be greatly appreciated.</p>
","<c++><game-development><refactoring>","1","194","2011-01-10 21:57:04"
"4657570","How can I compare two lists and find the differences between them?","<p>The following function compares a new list of items to an old one and finds the differences: </p>

<ol>
<li>Items that have been deleted from the old list</li>
<li>Items that were added to the new list (not present in the original list).</li>
</ol>

<p>I wrote two loops to achieve this, and they produced the following output:</p>

<blockquote>
  <p>oldItems = ""an, old, list"" ---> Items To Delete: 'an,old'</p>
  
  <p>newItems = ""a, new, list"" ---> Items To Create: 'new'</p>
</blockquote>

<p>The first issue is <code>a</code> should show up in the items to create, but I believe because it's a substring of <code>an</code> it's not getting picked up.</p>

<p>The second issue(?) is I doing two loops seems inefficient. Can the code be refactored?</p>

<pre><code>public function testList() hint=""Compares two lists to find the differences.""
{
    local.oldItems = ""a, new, list"";
    local.newItems = ""an, old, list"";
    local.toDelete = """";
    local.toCreate = """";

    // Loop over newItems to find items that do not exist in oldItems 
    for (local.i = 1; local.i LTE ListLen(local.newItems, "", ""); local.i++)
    {
        if (! ListContains(local.oldItems, ListGetAt(local.newItems, local.i, "", "")))
        {
            local.toCreate = ListAppend(local.toCreate, ListGetAt(local.newItems, local.i, "", ""));
        }
    }

    // Loop over old items to find items that do not exist in newItems
    for (local.i = 1; local.i LTE ListLen(local.oldItems, "", ""); local.i++)
    {
        if (! ListContains(local.newItems, ListGetAt(local.oldItems, local.i, "", "")))
        {
            local.toDelete = ListAppend(local.toDelete, ListGetAt(local.oldItems, local.i, "", ""));
        }
    }

    writeDump(var=""Items To Delete: '"" &amp; local.toDelete &amp; ""'"");
    writeDump(var=""Items To Create: '"" &amp; local.toCreate &amp; ""'"", abort=true);
}
</code></pre>
","<string><list><coldfusion><refactoring>","1","1006","2011-01-11 12:24:28"
"4661135","ActionScript 3 Optimization - improving performance with large #'s of objects","<p>I'm devloping some library classes for flocking/steering behaviours on large numbers of objects (2000+). I'm finding that at &lt; 500 instances, performance is reasonable. As the numbers increase, framerate bogs down.</p>

<p>I've seen remarkable performance with libraries such as Flint or Box2D with ridiculous #'s of particles / objects, so it should be possible to optimize / refactor my code to be a bit better.</p>

<p>I'm aware of the basic optimizations, such as bitwise operations and optimized for loops. Are there any more fundamental approaches I should be considering? For example, currently each instance is a vector-based MovieClip. Would working with BitmapData be more efficient?</p>
","<performance><optimization><actionscript><refactoring><particles>","0","453","2011-01-11 18:21:11"
"4665569","Safest way to change variable names in a project","<p>So I've been working on a relatively large project by myself, and I've come to realise that some of the variable names earlier on were.. less than ideal.</p>

<p>But how does one change variable names in a project easily? Is there such a tool that can go through a project directory, parse all the files, and then replace the variable names to the desired one? It has to be smart enough to understand the language I imagine.</p>

<p>I was thinking of using regexp (sed/awk on linux?) tools to just replace the variable name, but there were many times where my particular variable is also included as a part of strings.</p>

<p>There's also the issue about changing stuff on a c++ namespace, because there is actually two classes in my project that share the same name, but are in different namespaces.</p>

<p>I remember visual studio being able to do this, but what's the safest and most elegant way to do this on linux?</p>
","<c++><refactoring><coding-style><source-code><variable-names>","6","443","2011-01-12 05:15:56"
"4668675","Replacing class name in serialized data","<p>I want to replace the String ""com.oldpackage.className"" with ""com.newPackage.className"" in a stream of serialized data. This serialized data is read from the DB and updated after replacing the string.</p>

<p>I am facing some problems while doing the same. If you already guessed it, this is part of a refactoring exercise. Are there any libraries that would help me in manipulating the serialized data? If you can also please comment on any precautions or caveats, it would be of great help.</p>

<p>Thanks a lot,
Chris.
P.S: Both the old class and the new class do not declare a serialversion ID as part of its fields.</p>
","<java><serialization><refactoring>","4","433","2011-01-12 12:16:42"
"4679056","Code Smell in Dynamic Expression","<p>This code solves an interesting puzzle outlined in <a href=""http://www.programgood.net/2011/01/13/DynamicOperatorsGuernseyChallenge.aspx"" rel=""nofollow"">http://www.programgood.net/2011/01/13/DynamicOperatorsGuernseyChallenge.aspx</a></p>

<p><strong>Problem:</strong>  There seems to be lots of repeating here.. DRY (Don't Repeat Yourself) principle springs to mind here.  Anyone see a refactor?</p>

<pre><code>        string opZ = """";
        string opA = """";
        string opB = """";
        string opC = """";
        string opD = """";
        for (int h = 1; h &lt;= 2; h++) // making the first number positive or negative
        {
            if (h == 1) opZ = """";
            if (h == 2) opZ = ""-"";

            for (int i = 1; i &lt;= 4; i++)
            {
                if (i == 1) opA = ""*"";
                if (i == 2) opA = ""/"";
                if (i == 3) opA = ""+"";
                if (i == 4) opA = ""-"";
                for (int j = 1; j &lt;= 4; j++)
                {
                    if (j == 1) opB = ""*"";
                    if (j == 2) opB = ""/"";
                    if (j == 3) opB = ""+"";
                    if (j == 4) opB = ""-"";
                    for (int k = 1; k &lt;= 4; k++)
                    {
                        if (k == 1) opC = ""*"";
                        if (k == 2) opC = ""/"";
                        if (k == 3) opC = ""+"";
                        if (k == 4) opC = ""-"";
                        for (int l = 1; l &lt;= 4; l++)
                        {
                            if (l == 1) opD = ""*"";
                            if (l == 2) opD = ""/"";
                            if (l == 3) opD = ""+"";
                            if (l == 4) opD = ""-"";
                            string expression = opZ + 1 + opA + 3 + opB + 5 + opC + 7 + opD + 9;
                            DataTable dummy = new DataTable();
                            double result = Convert.ToDouble(dummy.Compute(expression, string.Empty));
                            if (result == 3)
                                Debug.WriteLine(expression + "" = 3"");

                            if (result == 47)
                                Debug.WriteLine(expression + "" = 47"");

                            if (result == 18)
                                Debug.WriteLine(expression + "" = 18"");

                        }
                    }
                }
            }
        }
</code></pre>
","<c#><refactoring>","0","187","2011-01-13 10:32:17"
"4687678","What tools can I use to view diff of two sections of the same file?","<p>I'm trying to refactor a python module in which the main problem is duplicate code.</p>

<p>Is there any tool that I can use to view diff of two selected sections, so that I can see the difference between those almost-the-same codes?</p>
","<python><tools><refactoring><diff>","2","122","2011-01-14 03:21:03"
"4689670","Refactoring common method header and footer","<p>I have the following chunk of header and footer code appearing in alot of methods. Is there a cleaner way of implementing this?</p>

<pre><code> Session sess = factory.openSession();
 Transaction tx;
 try {
     tx = sess.beginTransaction();
     //do some work
     ...
     tx.commit();
 }
 catch (Exception e) {
     if (tx!=null) tx.rollback();
     throw e;
 }
 finally {
     sess.close();
 }
</code></pre>

<p>The class in question is actually an EJB 2.0 SessionBean which looks like:</p>

<pre><code>public class PersonManagerBean implements SessionBean {
    public void addPerson(String name) {
        // boilerplate
        // dostuff
        // boilerplate
    }

    public void deletePerson(Long id) {
        // boilerplate
        // dostuff
        // boilerplate
    }
}
</code></pre>
","<java><refactoring>","1","91","2011-01-14 09:37:30"
"4693229","Dynamic Dispatch without Virtual Functions","<p>I've got some legacy code that, instead of virtual functions, uses a <code>kind</code> field to do dynamic dispatch.  It looks something like this:</p>

<pre><code>// Base struct shared by all subtypes
// Plain-old data; can't use virtual functions
struct POD
{
    int kind;

    int GetFoo();
    int GetBar();
    int GetBaz();
    int GetXyzzy();
};

enum Kind { Kind_Derived1, Kind_Derived2, Kind_Derived3 /* , ... */ };

struct Derived1: POD
{
    Derived1(): kind(Kind_Derived1) {}

    int GetFoo();
    int GetBar();
    int GetBaz();
    int GetXyzzy();

    // ... plus other type-specific data and function members ...
};

struct Derived2: POD
{
    Derived2(): kind(Kind_Derived2) {}

    int GetFoo();
    int GetBar();
    int GetBaz();
    int GetXyzzy();

    // ... plus other type-specific data and function members ...
};

struct Derived3: POD
{
    Derived3(): kind(Kind_Derived3) {}

    int GetFoo();
    int GetBar();
    int GetBaz();
    int GetXyzzy();

    // ... plus other type-specific data and function members ...
};

// ... and so on for other derived classes ...
</code></pre>

<p>and then the <code>POD</code> class's function members are implemented like this:</p>

<pre><code>int POD::GetFoo()
{
    // Call kind-specific function
    switch (kind)
    {
    case Kind_Derived1:
        {
        Derived1 *pDerived1 = static_cast&lt;Derived1*&gt;(this);
        return pDerived1-&gt;GetFoo();
        }
    case Kind_Derived2:
        {
        Derived2 *pDerived2 = static_cast&lt;Derived2*&gt;(this);
        return pDerived2-&gt;GetFoo();
        }
    case Kind_Derived3:
        {
        Derived3 *pDerived3 = static_cast&lt;Derived3*&gt;(this);
        return pDerived3-&gt;GetFoo();
        }

    // ... and so on for other derived classes ...

    default:
        throw UnknownKindException(kind, ""GetFoo"");
    }
}
</code></pre>

<p><code>POD::GetBar()</code>, <code>POD::GetBaz()</code>, <code>POD::GetXyzzy()</code>, and other members are implemented similarly.</p>

<p>This example is simplified.  The actual code has about a dozen different subtypes of <code>POD</code>, and a couple dozen methods.  New subtypes of <code>POD</code> and new methods are added pretty frequently, and so every time we do that, we have to update all these <code>switch</code> statements.</p>

<p>The typical way to handle this would be to declare the function members <code>virtual</code> in the <code>POD</code> class, but we can't do that because the objects reside in shared memory.  There is a lot of code that depends on these structs being plain-old-data, so even if I could figure out some way to have virtual functions in shared-memory objects, I wouldn't want to do that.</p>

<p>So, I'm looking for suggestions as to the best way to clean this up so that all the knowledge of how to call the subtype methods is centralized in one place, rather than scattered among a couple dozen <code>switch</code> statements in a couple dozen functions.</p>

<p>What occurs to me is that I can create some sort of adapter class that wraps a <code>POD</code> and uses templates to minimize the redundancy.  But before I start down that path, I'd like to know how others have dealt with this.</p>
","<c++><refactoring><metaprogramming><template-meta-programming>","6","497","2011-01-14 16:21:05"
"4694085","How can I make the Resharper Add-on accept RequestID as a parameter instead of RequestId","<p>Given the following function:</p>

<pre><code>public SomeClass(int RequestID)
{
  // blah
}
</code></pre>

<p>Resharper complains that my parameter should be <code>requestId</code> (which doesn't make sense first of all, because the .NET API uses <code>UpperCamelCase</code> most of the time for their public methods. I went into the configuration and changed the <code>lowerCamelCase</code> to <code>UpperCamelCase</code>.</p>

<p>Now Resharper complains that instead of <code>RequestID</code>, it should be <code>RequestId</code>. Thats a little better, but I'm the kind of guy that likes <code>ID</code> and not <code>Id</code>. Anyone got a configuration fix for this?</p>
","<c#><refactoring><resharper>","0","126","2011-01-14 17:38:36"
"4694831","Entities used to serialize data have changed. How can the serialized data be upgraded for the new entities?","<p>I have a bunch of simple entity instances that I have serialized to a file.  In the future, I know that the structure of these entities (ie, maybe I will rename Name to Header or something).  The thing is, I don't want to lose the data that I have saved in all these old files.  What is the proper way to either</p>

<ol>
<li>load the data from the old entities into new entities </li>
<li>upgrade the old files so that they can be used with new entities</li>
</ol>

<p>Note: I think I am stuck with binary serialization, not xml serialization.</p>

<p>Thanks in advance!</p>

<p><strong>Edit:</strong>  So I have an answer for the case I have described.  I can use a dataContractSerializer and do something like</p>

<pre><code>[DataMember(""bar"")]
private string foo;
</code></pre>

<p>and change the name in the code and keep the same name that was used for serialization.  But what about the following additional cases:</p>

<ol>
<li>The original entity has new members which can be serialized</li>
<li>Some serialized members that were in the original entity are removed</li>
<li>Some members have actually changed in function (suppose that the original class had a FirstName and LastName member and it has been refactored to have only a FullName member which combines the two)</li>
</ol>

<p>To handle these, I need some sort of interpreter/translator deserialization class but I have no idea what I should use</p>
","<c#><serialization><refactoring><model><domain-driven-design>","1","133","2011-01-14 19:00:54"
"4700015","I can't delete a method using eclipse refactoring?","<p>I have a method which I want to delete. This method is being called from n number of classes. I want to delete this method using refactoring and also make eclipse delete all calls to this method rather than go and clean up in each file. I could not find a straight way to do this from refactor (I am using ganymede)</p>
","<eclipse><refactoring>","0","527","2011-01-15 14:14:12"
"4713697","Any good C++ refactoring tools that could handle this scenario","<p>I have a large C++ code base that contains a couple of functions for error logging that I'm planning to rewrite, defined as follows;</p>

<pre><code>void LogError(ErrorLevel elvl,LPCTSTR Format,...);  // Literal version
void LogError(ErrorLevel elvl,UINT ResourceID,...); // Resource version
</code></pre>

<p>I'm planning to rewrite these as a single function</p>

<pre><code>void LogError(ErrNo No,...);
</code></pre>

<p>ErrNo in this case is will be an enum, used to look up the rest of the error details from an external file.  While I'm using and love Visual Assist, it doesn't appear to be up to this kind of thing.  I'm thinking the easiest way to carry out this refactor is to write a small program that uses the results of a search output to find all the occurences of this function, e.g. </p>

<pre><code>    c:\cpp\common\Atlas\Comps\LSADJUST.cpp
        LSAFormNormalEquations (174):    LogError(elvl_Error,IDS_WINWRN0058,i+1,TravObs.setup_no,TravObs.round_no
        LSAFormNormalEquations (180):    LogError(elvl_Error,IDS_WINWRN0059,i+1,TravObs.setup_no,TravObs.round_no
        LSAFormNormalEquations (186):    LogError(elvl_Error,IDS_WINWRN0060,i+1,TravObs.setup_no,TravObs.round_no
    c:\cpp\common\Atlas\Comps\LSADJUSTZ.CPP
        LSAFormNormalEquationsZ (45):    LogError(elvl_Note,_T(""Adjusting heights by least squares""));
    c:\cpp\Win32\Atlas\Section\OptmizeSectionVolumes.cpp
        OnSectionOptimizeVolumes (239):    LogError(elvl_Note,""Shifted section at chainage %0.1lf by %0.3lf"",Graph.c1,Offset);
</code></pre>

<p>and then parse and modify the source.  Are there any other tools that could simplify this task for me?  If looked at a <a href=""http://stackoverflow.com/questions/1388469/is-there-a-working-c-refactoring-tool"">related question</a> which suggets there isn't much out there.  I don't mind spending a small amount for a reasonably easy to use tool, but don't have the time or budget for anything more than this.</p>
","<c++><refactoring>","0","188","2011-01-17 13:32:24"
"4718954","divide large VC++ .NET GUI header file","<p>I've inherited a GUI in the format of a 10,000 line Visual C++ .NET <code>Form1.h</code> file and 3 megabyte <code>Form1.resx</code>. The previous author essentially put down lots of buttons to mock up the interface, implemented a few things, and then ran out of steam. My task is to finish it. The management does not want to lose their ""investment"" on it, and I'd rather keep whatever is done as well.</p>

<p>Is there anything I can do to divide this monster into smaller files, and perhaps even organize it somewhat? Right now, it's large enough that editing tasks are slow. It can only get slower. The existing functionality is implemented directly in the <code>Form1.h</code> file, so preferably I'd rather keep the actions/events attached to the UI elements.</p>

<p>I just figured out how to create a new managed resource file and copy-paste UI elements, but that doesn't include certain properties such as names, or events.</p>
","<.net><gui><refactoring><visual-c++-2005>","0","84","2011-01-17 23:19:51"
"4735729","Remove & sort ""using"" statements in Visual Studio 2008?","<p>Is there a way to automate the ""Removal &amp; Sorting"" of ""using"" statements in Visual Studio 2008?</p>
","<c#><visual-studio-2008><refactoring><maintenance>","0","202","2011-01-19 13:23:22"
"4738304","How to refactor a codebase that uses spring autowiring","<p>I've inherited two fairly non-trivial codebases that uses spring for configuring the applications. Now I need to reconfigure the applications. But lots of the configuration is provided through autowiring so it is almost impossible to find out what the actual configuration is.  </p>

<p>The projects are moderately sized, some 20-ish maven modules per project including  integration test modules and such. Most modules define a few application contexts for various purposes, that contain one or two local spring config files along with one or two from the core modules it depends on. The result is a myriad of configurations, and that I cannot alter a class or variable name (or setter method) without risking breaking dependencies in some upstream or downstream module, even if no such dependency is visible anywhere in the project. </p>

<p>How do I work effectively with autowired dependencies in spring?</p>

<p>Can anyone, perhaps someone who actually likes autowiring, provide some insight into how you work with them effectively?</p>

<p>(I also inherited a small project that combines xml-files, autowiring and annotation-driven config, making dependency relations completely intractable, but I'll save those annotations for a separate question later)</p>
","<java><spring><refactoring><autowire>","7","425","2011-01-19 17:06:44"
"4739983","Refactoring Implicit Interface Implementation into Explicit Interface Implementation","<p>I have inherited a C# code base; there are couple of classes that are implementing multiple interfaces and also have additional public methods. I want to refactor these classes such that implicit interface public methods are refactored to explicit interface implementations so that I can find out easily what additional public methods exisits and can decide something about them accordingly..</p>

<p>Is there (preferably free) refactoring addin (I am using Visual Studio 2010 Ultimate) or tool available that can do this?</p>
","<c#><visual-studio-2010><refactoring>","0","138","2011-01-19 19:52:22"
"4753194","Converting recursion into iteration - looking for easily understandable tutorial covering complicated recursion","<p>I was trying to teach a junior co-worker how to convert recursive subroutine to iterator (she gets stack overflows), and ran into trouble trying to explain the process in an easy to understand way. <strong><em>I</em></strong> can do it, but I don't know how to explain it well to someone who doesn't.</p>

<p>So, what I am looking for is a good tutorial which shows how to take a sample complicated recursive subroutine and turn it into a loop.</p>

<p>Please note that the example in the tutorial should be <strong>complicated</strong>; I'm <strong>not</strong> looking for a trivial tail recursion example. To be more specific, the example should ideally show examples of:</p>

<ul>
<li><p>more than one recursive call within the same subroutine.</p></li>
<li><p>more than one return statement within the same subroutine (including some after a recursive call and some independent of them)</p></li>
<li><p>Recursive calls happening in the middle of nested control structure (e.g. <code>if ($x) { statement 0; if ($y) { statement1; statement2; $res = recursive_call(); $statement 3; optional return; }; statement_end; }</code></p></li>
</ul>

<p>It should be a practical tutorial with detailed code samples - the generic ""well store the parameters on a stack"" hand waving that most of my Googling turned up is very nice but not helpful to a beginner.</p>

<p>Any non-functional language will do (C++, Java, Perl, pseudocode, whatever), although the specific code in question is in Perl.</p>

<p><strong>The part that REALLY makes it hard to explain intelligently is of course multiple calls inside control structures - you basically need to re-enter them into the correct point when popping the stack.</strong></p>
","<algorithm><perl><recursion><refactoring><iteration>","5","302","2011-01-20 22:07:09"
"4747652","Long parameter list in constructor in Java","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/439574/whats-the-best-way-to-refactor-a-method-that-has-too-many-6-parameters"">What&#39;s the best way to refactor a method that has too many (6+) parameters?</a>  </p>
</blockquote>



<p>If a constructor has a long parameter list, should we consider it bad style and refactor it? If yes, how?</p>
","<java><refactoring><coding-style>","2","626","2011-01-20 13:24:39"
"4760074","Advice on working with legacy code","<p>I need some advice on how to work with legacy code.</p>

<p>A while ago, I was given the task to add a few reports to a reporting app. written in Struts 1, back in 2005. No big deal, but the code is quite messy. No usage of Action forms, and basically the code is one huge action, and a lot of if-else statements inside. Also, no one here has functinal knowledge on this. We just happend to have it in our contract.</p>

<p>I'm quite unhappy about this, and not sure how to proceed. This application is invisible: Few people (but all very important) use it, so they don't care whether my eyes bleed while reading the code, standards, etc.</p>

<p>However, i feel that a technical debt is to be paid. How should I proceed on this? Continue down the if-else road, or try to do this requirement the right way, ignoring the rest of the project?. Starting a huge refactor, risking my deadline?</p>

<p>Any help will be appreciated.</p>

<p>Thanks in advance.</p>
","<refactoring><legacy-code>","1","353","2011-01-21 14:42:40"
"4771234","Stopping execution in refactored php code?","<p>I have just refactored a php page to make it slightly easier to extend and maintain in the future and gotten stuck on quite a simple problem.</p>

<p>I have broken one method up into 3.</p>

<p>largemethod() has become something like this:</p>

<pre><code>nowsmallmethod(){
  doSomeChecks();
  assignProduct();
  giveFeedbacktoUser();
}
</code></pre>

<p>This is all good and well, the problem I am having is with doSomeChecks();</p>

<pre><code>doSomeChecks(){
 if(something that shouldnt be true is true){
    return Controller-&gt;redirectBk();
 }
}
</code></pre>

<p>The crux of the problem is that Controller-redirectBk first redirects when nowsmallmethod() has been completed. This means that the user is assigned a product even if a test fails. I am using a php framework called Silverstripe so I cant really change the behavior of Controller->redirectBk(). If I didnt have the checks in their own method then everything would work fine because the ""return Controller->redirectBk();"" would stop execution and redirect back. <strong>Whats the best way to stop execution in nowsmallmethod() when a test fails?</strong> I realise i could return a status code for an error and then stop execution but it seems an ugly way. Is there not a more elegant way? Another option would be if i could return something like this in doSomeChecks(), ""return (return $controller->redirectBk())"" but this is not valid php syntax and not particularly easy to read. Any help would be hugely appreciated.</p>

<p>Enjoy your weekend!
Cheers
Nick</p>
","<php><oop><testing><refactoring>","0","54","2011-01-22 23:11:17"
"4774951","Type safe objectdatasources","<p>Is there any way to make asp.net objectdatasources to be type safe. Meaning I get a compile time error if parameters or datatypes change during refactoring?</p>

<p>Does anyone know any other method? Or can recommend any other way to do it? I find manual binding tedious. What is other people doing?</p>

<p>Thanks</p>
","<c#><asp.net><refactoring><objectdatasource>","0","84","2011-01-23 16:37:53"
"4767960","Where in the NetBeans 6.9.1 source code is the code for scanning Java files and finding all the methods, variables, imports etc","<p>I'm looking for a sample or possibly even code I can use which scans Java files and tells me key pieces of information about each class, which i can then use much like the NetBeans refactoring and go to source features do.</p>
","<java><netbeans-6.9><automated-refactoring>","0","393","2011-01-22 13:07:13"
"4768370","Are there any tools out there to refactor the coding-style of a java code base?","<p>Normally, when doing some work on an existing project, I would just go with whatever style is already established in the code base. But our team has to maintain multiple small to medium sized projects which all differ slightly in coding style. It would be more efficient and less confusing if we could cleanup these differences. </p>

<p>So I'm looking for a tool that allows me to refactor the existing style. Lots of features are already provided by standard code formatting tools, like changing the indentation style. What I'm missing is a tool that allows me to strip the prefixes of field and parameter names. In some projects all members are prefixed with ""m"", all parameters are prefixed with ""p"" and static members are prefixed with ""s"". </p>

<p>The tool should be able to handle cases like: </p>

<pre><code>void setValue(String pValue) {
  mValue = pValue;
}
</code></pre>

<p>Which should become: </p>

<pre><code>void setValue(String value) {
  this.value = value;
}
</code></pre>

<p>The tool should generate a warning in a case like this: </p>

<pre><code>void setValue(String pValue) {
  int value = 42
}
</code></pre>

<p>I know every major IDE provides the refactor: rename feature. What I'm looking for though is a tool which processes a whole code base without me needing to go over each parameter/field individually. </p>

<p><strong>Edit</strong></p>

<p>A lot of the answers mention tools to re-format source code or check the code base against a set of style rules. I'm aware that those tools exist. What I'm specifically looking for is an advanced tool that allows me to remove scope specific variable name prefixes. </p>
","<java><tools><refactoring><coding-style>","7","254","2011-01-22 14:26:54"
"4779364","Refactoring code in Symfony 1.4","<p>Specifically, for example, what is the best way to refactor code to be used in the model class? </p>
","<refactoring><symfony-1.4>","1","225","2011-01-24 06:46:10"
"4794548","How to refactor code without IDE functionality (in VIM or TextMate)?","<p>I wonder how do programmers refactor code that is written in languages like Ruby, Python?</p>

<p>Assuming You get code after 'previous' guy - so You cannot be sure about quality of tests and their coverage.</p>

<p>Do You use any specific approach?</p>
","<refactoring>","1","435","2011-01-25 14:22:00"
"4802646","Import statement after function definition -- How can I make it more pythonic?","<p>I wrote the following piece of code and I think it's lame:</p>

<pre><code>def findfile1(wildcard):
    """"""Returns path of the first matched file. Using win32file.
    &gt;&gt;&gt; findfile1(""D:\\Python26\\*.exe"")
    'D:\\Python26\\python.exe'
    """"""
    return filepath

def findfile2(wildcard):
    ""Same as above, but using glob.""
    return filepath

try:
    import win32file
    findfile = findfile1
except ImportError:
    import glob
    findfile = findfile2

if __name__ == '__main__':
    f = findfile('D:\\Python26\\*.exe')
</code></pre>

<p>The functions are defined before the required modules are imported, and the overall structure just seems a bit weird to me.  </p>

<p>What is the common way for such problems? How can I make it more pythonic?</p>
","<python><refactoring><import>","1","221","2011-01-26 08:46:58"
"4806651",".NET Entity serialization: Load updated entities from legacy versions of files?","<p>Here is the situation</p>

<ol>
<li>I created an entity.  It has a first and last name field</li>
<li>I serialized some instances to a file</li>
<li>Now I have updated the entity.  Instead of having first and last name, I just have have a FullName field and I have removed the first and last name properties</li>
<li>I want to deserialize the instances I created in step (2) to this new version</li>
</ol>

<p>What is the proper method to write a translator for this in C#?  Is there some class that does it?</p>

<p>Note:  I have previously asked a similar question but I did not phrase it the same way.  I received a very good answer on how to handle a situation where a field name changes, but I did not get an answer for how to handle this new situation.  You can view the old question here <a href=""http://stackoverflow.com/questions/4694831/entities-used-to-serialize-data-have-changed-how-can-the-serialized-data-be-upg"">Entities used to serialize data have changed.  How can the serialized data be upgraded for the new entities?</a></p>
","<c#><serialization><refactoring>","1","186","2011-01-26 15:56:03"
"4815016","Does eclipse have a free Java refactoring plugin that can extract a class including both fields and methods?","<p>This refactoring example is available in IntelliJ IDEA so based on the questions:</p>

<p><a href=""http://stackoverflow.com/questions/708164/java-refactoring-tools"">Java refactoring tools</a></p>

<p><a href=""http://stackoverflow.com/questions/615334/a-tool-like-resharper-but-for-java"">A tool like ReSharper, but for Java?</a></p>

<p>I suspect the answer to my question is no, but I'm hoping things might have changed since these questions were asked?</p>
","<java><eclipse><plugins><refactoring>","0","243","2011-01-27 10:10:42"
"4817773","How to make refactoring less ""destructive""?","<p>Currently performing a fairly major refactoring of an application due to a very late major requirement change.</p>

<p>I always feel when I'm doing this sort of thing that I'm not approaching it in a very disciplined manner. My application is likely to go days/weeks at a time in a state where it either doesn't build or requires commenting out huge swathes of code just to get it to compile. </p>

<p>I don't like checking into source control in this state so I often feel I have no fall back if I make a big mistake. I am literally right now destroying my application, and I'm holding 100 different threads in my head. Like one of those people you read about who takes their car engine apart out of curiosity and then realises they have no idea how to put it all back together again.</p>

<p>Are there any good resources out there which discuss how to approach refactoring in a more incremental and less destructive manner? Can anyone offer any advice? Or does everyone feel like this?</p>
","<oop><design><language-agnostic><refactoring>","9","360","2011-01-27 14:44:20"
"4819647","Help with recurring javascript countdown and timezones","<p><strong>Goal:</strong> 
To create a countdown to our next available live stream. </p>

<p><strong>Details:</strong> 
We live stream six times a week all (PST).<br> 
 1. Sunday at 8:00 a.m.<br>
 2. Sunday at 10:00 a.m.<br>
 3. Sunday at 12:00 p.m.<br>
 4. Sunday at 6:30 p.m.<br>
 5. Wednesday at 7:00 p.m.<br>
 6. Saturday at 10:00 a.m.</p>

<p><strong>My approach:</strong> 
Originally I check what day it is and what time it is then create the countdown to the next stream. This works fine for our timezone (PST) and any that are relatively close. </p>

<p><strong>Problem:</strong> 
Checking first the day breaks my approach for people in timezones that put them a day ahead of us. For example if someone from London checks the site on Thursday at 2:30 a.m. (GMT) my code would start the countdown to the Saturday 10:00 a.m. stream instead of the Wednesday at 7:00 p.m. (PST) which would start in 30 mins.</p>

<p><em>I'm sure what I have done can be cleaned up and improved, tell me how.</em></p>

<p><strong>My code:</strong></p>

<pre><code>// Countdown
function countDown( addDay, hour, min ) {
    var newCount = new Date(); 
    newCount = new Date(newCount.getFullYear(), newCount.getMonth(), newCount.getDate() + addDay, hour, min); 
    $('#service_countdown').countdown({until: $.countdown.UTCDate(-8, newCount)}); 
}

var day_ref, day, addDay, hour, min;
addDay = 0;
hour = 0;
min = 0;
day = {};

day_ref = new Date();
day = {""day"" : day_ref.getDay(), ""hour"" : day_ref.getHours(), ""min"" : day_ref.getMinutes()};

// It's Sunday
if ( day.day === 0 ) {

    if ( day.hour &lt; 8 ) {
          hour = 8;
        countDown(addDay, hour, min);
    } 
    else if ( day.hour &lt; 10 ) {
          hour = 10;
        countDown(addDay, hour, min);
    } 
    else if ( day.hour &lt; 12 ) {
          hour = 12;
        countDown(addDay, hour, min);
    }
    else if ( day.hour &lt;= 18 &amp;&amp; day.min &lt; 30 ) {
          hour = 18;
           min = 30;
        countDown(addDay, hour, min);
    } 
    else {
        addDay = 3;
          hour = 19;
        countDown(addDay, hour, min);
    }
} 
// It's Monday
else if ( day.day === 1 ) {
    addDay = 2;
      hour = 19;
    countDown(addDay, hour, min);
} 
// It's Tuesday
else if ( day.day === 2 ) {
    addDay = 1;
      hour = 19;
    countDown(addDay, hour, min);
} 
// It's Wednesday
else if ( day.day === 3) {

    if ( day.hour &lt; 19 ) {
          hour = 19;
        countDown(addDay, hour, min);
    } else {
        addDay = 3;
          hour = 10;
        countDown(addDay, hour, min);
    }
} 
// It's Thursday
else if ( day.day === 4 ) {
    addDay = 2;
      hour = 10;
    countDown(addDay, hour, min);
} 
// It's Friday
else if ( day.day === 5 ) {
    addDay = 1;
      hour = 10;
    countDown(addDay, hour, min);
} 
// All that's left is Saturday
else {

    if ( day.hour &lt; 10 ) {
          hour = 10;
        countDown(addDay, hour, min);
    } else {
        addDay = 1;
          hour = 8;
        countDown(addDay, hour, min);
    }
}
</code></pre>

<p>Thanks in advance for any help!</p>
","<javascript><refactoring><timezone><countdown>","0","312","2011-01-27 17:22:36"
"4819996","Is it better create a library with several functions or create classes?","<p>I'm developing a software to comunicate with a device.</p>

<p>The software will send commands for the device. The device has to answer using the protocol below:</p>

<pre><code>&lt;STX&gt;&lt;STX&gt;&lt;COMMAND&gt;[&lt;DATA_1&gt;&lt;DATA_2&gt;...&lt;DATA_N&gt;]&lt;CHKSUM&gt;&lt;ETX&gt;
</code></pre>

<p>where:</p>

<pre><code>&lt;STX&gt; is the Start of TeXt (0x55);
&lt;COMMAND&gt; can be 0x01 for read, 0x02 for write, etc;
&lt;DATA&gt; is any value;
&lt;CHKSUM&gt; is the checksum;
&lt;ETX&gt; is the End of TeXt (0x04).
</code></pre>

<p>So, I have to validate the received data.</p>

<p>Then, the received data:</p>

<ul>
<li>cannot be empty;</li>
<li>must have 3 or more characters;</li>
<li>must have an header  in the first two characters of the string data;</li>
<li>must have a ""footer""  in the last character of the string data;</li>
<li>must hava a valid CheckSum.</li>
</ul>

<p>If the answer is valid, then I can handle the data. But before I'll have to extract this data from the response received.</p>

<p>Ok, this is a relatively easy task. Beforetime I would do it on a procedural way, using only one function and putting many if's.</p>

<p>Now I'm studying more about good programming practices, things seem to be getting harder to do.</p>

<p>To validate the device answer, is better create a class ""ValidateReceivedData"" for example and pass the received data in the constructor of this class? And then create a public method called ""IsReceivedDataValid"" that check all steps given above?</p>

<p>Or maybe would be better create a library with with several functions to validate the received data?</p>

<p>I'd like to use unit test too.</p>

<p>As I said before, I'm studying more to make better code. But I realize that I'm spending more time now to code than before. And there are too many questions that are arising, but in my view they seem easy to solve, but I'm not getting.</p>
","<oop><design><refactoring>","3","79","2011-01-27 17:56:40"
"4809197","What's the best way to do a bulk namespace rename on a large c# application?","<p>First, a little background.</p>

<p>Currently namespaces and assemblies in our codebase (~60 assemblies, thousands of classes) looks like</p>

<pre><code>WidgetCompany.Department.Something
</code></pre>

<p>We have now been spun off such that we are selling the software that drives a WidgetCompany, so we 'd like to rename the namespaces &amp; assemblies</p>

<pre><code>NewCompany.Something
</code></pre>

<p>Under normal circumstances I'd probably just stick with the old namespace, but the problem is our customers don't want to see the name of one of their competitors anywhere in the application.  In the off chance that they see a stack trace, assembly properties etc, it shouldn't show up.  It's not meant to hide our associates or do anything sinister, we just need to make sure that people know we are a separate entity, separate management, and they don't need to worry about data being shared etc.</p>

<p>Now the question.  What is the best way to perform this type of all encompassing rename?
The following would need to change:</p>

<ul>
<li>Namespace for (almost) every class in
the application </li>
<li>Every <code>using</code> statement in the application which references the old names</li>
<li>Folder structure for each project</li>
<li>References between projects which rely on changed folder structure</li>
<li>.Sln files which reference the changed folder structure</li>
<li>Any references to
those classes which are fully
qualified (should be few and far
between) </li>
<li>Any references to those
classes in xml config files (config
sections etc) </li>
<li>AssemblyInfo.cs files for every assembly </li>
<li>AssemblyName in every .csproj file</li>
</ul>

<p>Am I stuck with the find-replace-pray strategy or is there something better?</p>
","<c#><.net><visual-studio><refactoring>","9","422","2011-01-26 19:42:28"
"4823840","Dead code detection in ruby","<p>Does anyone know of a production worthy package commercial or OSS that can detect which lines of code have been executed or not?</p>

<p>We're looking around for some tools that can help us detect dead code in a production environment, running Ruby On Rails 1.8.7</p>

<p>-daniel</p>
","<ruby-on-rails><ruby><refactoring><dead-code>","5","570","2011-01-28 01:16:31"
"4825286","jquery code refactoring tools","<p>Is there any tools that helps refactoring my javascript(jquery) code? For small snippet it doesn't matter but while developing new jquery plugin there will be lines of code where refactoring is required for sure. </p>

<p>Thanks in advance :)</p>
","<javascript><jquery><jquery-plugins><refactoring>","2","218","2011-01-28 05:52:17"
"4826086","How ConvertAll<Guid>(Guid.Parse) works?","<p>First I had this kind of line</p>

<pre><code>List&lt;Guid&gt; ratingComparisonIds = ratingComparison.ConvertAll&lt;Guid&gt;(o =&gt; Guid.Parse(o));
</code></pre>

<p>Then ReSharper gave me a hint that I could convert it to method group. Result of that operation is this</p>

<pre><code>List&lt;Guid&gt; ratingComparisonIds = ratingComparison.ConvertAll&lt;Guid&gt;(Guid.Parse);
</code></pre>

<p>I am confused about the syntax.. how and why does it work? I mean there is no parameters for the parse method. Magic I would say.</p>

<p><strong>Update</strong></p>

<p>Even more compact conversion </p>

<pre><code>List&lt;Guid&gt; ratingComparisonIds = ratingComparison.ConvertAll(Guid.Parse);
</code></pre>
","<c#><refactoring>","2","207","2011-01-28 08:02:19"
"4841542","refactor jquery code","<p>How can I remove the code at the end <code>data(""autocomplete"")...</code> and put it in a function?</p>

<pre><code>    var input = $(""#CountryL"");

    $(input).autocomplete({
        minLength: 0,
        source: $(input).data('url')
    }).data(""autocomplete"")._renderItem = function (ul, item) {
        var tmp = $(""&lt;div&gt;"").setTemplate($(""#""+$(input).data('template')).html());
        tmp.processTemplate(item);
        $(""&lt;li&gt;&lt;/li&gt;"").data(""item.autocomplete"", item)
                      .append($(tmp).html())
                      .appendTo(ul);
        return;
    }; 
</code></pre>

<p>I'd like to be able to do:</p>

<pre><code>function templateOverride(object){

 object.data(""autocomplete"")._renderItem = function (ul, item) {
        var tmp = $(""&lt;div&gt;"").setTemplate($(""#""+$(input).data('template')).html());
        tmp.processTemplate(item);
        $(""&lt;li&gt;&lt;/li&gt;"").data(""item.autocomplete"", item)
                      .append($(tmp).html())
                      .appendTo(ul);
        return;
}


var input = $(""#CountryL"");

$(input).autocomplete({
        minLength: 0,
        source: $(input).data('url')
}).templateOverride(this);
</code></pre>
","<jquery><refactoring>","1","150","2011-01-30 06:33:11"
"4843493","Any pointers on using Ropevim? Is it a usable library?","<p>Rope is a refactoring library for Python and RopeVim is a Vim plugin which calls into Rope.</p>

<p>The idea of using RopeVim seems great to me, is there any documentation on ""getting started"" with RopeVim?</p>

<p>I've followed what documentation there is: <a href=""https://bitbucket.org/agr/ropevim/src/tip/README.txt"" rel=""nofollow"">https://bitbucket.org/agr/ropevim/src/tip/README.txt</a></p>

<p>I suppose I'm looking for:</p>

<ul>
<li>look at this blog post / article
/ link it makes it all make sense.</li>
<li>alternate recommendations like
""forget about RopeVim"", it doesn't
work very well or say ""use this
instead of ropevim"".</li>
</ul>
","<python><vim><refactoring><rope>","15","2318","2011-01-30 14:47:47"
"4846400","Extjs ajax code refactor","<p>I have this kind of ajax code repeated lot of places. How can I refactor this into a single method so it will still allow different behavior on success or failure.</p>

<pre><code>Ext.Ajax.request({
    url : 'ajax.php' , 
    params : { action : 'getDate' },
    method: 'GET',
    success: function ( result, request ) { 
    Ext.MessageBox.alert('Success', 'Data return from the server: '+     result.responseText); 
    },
    failure: function ( result, request) {  Ext.MessageBox.alert('Failed', result.responseText); 
    } 
});
</code></pre>
","<javascript><refactoring><extjs>","4","881","2011-01-30 23:44:59"
"4847994","Java refactoring related to type conversion","<p>Possible ways to refactor the code which had Java interface solely used to define lots of constants.. You can now imagine how this class is used to access these consts.</p>
","<java><refactoring>","0","111","2011-01-31 05:45:44"
"4855714","Restructuring Suggestions to remove lots of generic constraints","<p>I'm trying to figure out if there's a better way to structure some code. Although it currently works, it always gets at me due to the complexity and crazy nature that it feels to have with generics constraints. I'd be interested to know if anyone has an idea for a neater solution.</p>

<p>I've included a class diagram to make things a little easier. 
<img src=""http://i.stack.imgur.com/E8krK.png"" alt=""enter image description here""></p>

<p>This is all going within a library, and I wanted to try and keep all my type safety where I can. The library has 3 layers of increasing complexity. Which I'll explain in a moment.</p>

<p>I'm using Generics to make all the types work. For example a Route is actually a <code>List&lt;T&gt;</code> where <code>T</code> is a Visit. Now because I've got the 3 layers, I want to be able to access properties on these Visits (and the Nodes that they correspond to) from the Route itself (and to make it easier to consume). So that actually makes a <code>Route&lt;Visit&lt;Node&gt;&gt;</code>. Once you add that to a Solution which needs to be strongly typed <code>Solution&lt;Route&lt;Visit&lt;Node&gt;&gt;&gt;</code> things get complicated.</p>

<p>This results in some kinda unslightly code:</p>

<pre><code>public abstract class Solution&lt;TSolution, TRoute, TVisit, TNode, TResource&gt;
   where TSolution : Solution&lt;TSolution, TRoute, TVisit, TNode, TResource&gt;, new()
   where TRoute : Route&lt;TRoute, TVisit, TNode, TResource&gt;, new()
   where TVisit : Visit&lt;TVisit, TNode&gt;, new()
   where TNode : Element&lt;TNode&gt;
   where TResource : Resource&lt;TResource&gt;
</code></pre>

<p>It all works nicely, but I have to define these constraints at each class/level. At each level of complexity I create some simple consumable class such as the following, essentially hiding the generic constraints which would make it impossible to consume.</p>

<pre><code>Level1.Solution : Common.Solution&lt;Solution, Route, Visit, Node, Resource&gt;
</code></pre>

<p>They have also been made recursive based on advice from this <a href=""http://stackoverflow.com/questions/3626937/how-to-use-inheritance-when-using-generic-constraints"">question</a> to allow me to extend the class. For example a Level2.Solution will needs to be able to specify a Level2.Route as one of the constraints, normally this won't work (co/contra variance and generics) without the recursion.</p>

<p>All in all, it works, but is a bit cringy to say the least. Anyone have any ideas how this can be re-worked nicely?</p>
","<c#><generics><refactoring><refactor-my-code>","2","109","2011-01-31 20:27:05"
"4852905","Sourcing AppSettings from database & cache","<p>At my office, it has been deemed that we are to put our AppSettings for the Web.Config in the database.  As such, I created the following, but have some doubts about a couple aspects of the code.</p>

<p><strong>So my question is:</strong><br/>
The line containing ""Cache cache = new Cache()"" in the UTILITY class is probably wrong because it creates a NEW cache object.</p>

<p>Q: So, what should I be doing for that line?</p>

<p>...any help is appreciated.</p>

<p><strong>The overall objective was to be able to make a call like this:</strong><br/></p>

<pre><code>Utility.GetConfigurationValue(ConfigurationSection.AppSettings, ""myVariable"");
</code></pre>

<p>...and have it retrieve from the cache or the database auto-magically.<br/></p>

<p><strong>THE UTILITY CODE:</strong><br/></p>

<pre><code>public static class Utility
{
    #region ""Configurations""

    public static String GetConfigurationValue(ConfigurationSection section, String key)
    {
        Configurations config = new Configurations();
        Cache cache = new Cache(); // &lt;--- This is probably wrong!!!!

        if (!cache.TryGetItemFromCache&lt;Configurations&gt;(out config))
        {
            config.List(SNCLavalin.US.Common.Enumerations.ConfigurationSection.AppSettings);
            cache.AddToCache&lt;Configurations&gt;(config, DateTime.Now.AddMinutes(15));
        }

        var result = (from record in config
                      where record.Key == key
                      select record).FirstOrDefault();

        return (result == null) ? null : result.Value;
    }

    #endregion
}
</code></pre>

<p><strong>THE EXTENSION CODE:</strong><br/></p>

<pre><code>public static class Extensions
{
    #region ""System.Web.Caching""

    public static void Remove&lt;T&gt;(this Cache cache) where T : class
    {
        cache.Remove(typeof(T).Name);
    }
    public static void AddToCache&lt;T&gt;(this Cache cache, object item, DateTime absoluteExpiration) where T : class
    {
        T outItem = null;
        if (cache.TryGetItemFromCache&lt;T&gt;(out outItem))
            return;

        cache.Insert(typeof(T).Name,
                item,
                null,
                absoluteExpiration,
                System.Web.Caching.Cache.NoSlidingExpiration,
                System.Web.Caching.CacheItemPriority.Normal,
                null);
    }
    public static bool TryGetItemFromCache&lt;T&gt;(this Cache cache, out T item) where T : class
    {
        item = cache.Get(typeof(T).Name) as T;
        return item != null;
    }

    #endregion
}
</code></pre>

<p><strong>THE LIST-CLASS CODE:</strong><br/></p>

<pre><code>public class Configurations : List&lt;Configuration&gt;
{
    #region CONSTRUCTORS

    public Configurations() : base()
    {
        initialize();
    }
    public Configurations(int capacity) : base(capacity)
    {
        initialize();
    }
    public Configurations(IEnumerable&lt;Configuration&gt; collection) : base(collection)
    {
        initialize();
    }

    #endregion

    #region PROPERTIES &amp; FIELDS

    private Crud _crud;

    #endregion

    #region EVENTS
    #endregion

    #region METHODS

    private void initialize()
    {
        _crud = new Crud(""CurrentDbConnection"");
    }

    public Configurations List(ConfigurationSection section)
    {
        using (DbCommand dbCommand = _crud.Db.GetStoredProcCommand(""spa_LIST_SecConfiguration""))
        {
            _crud.Db.AddInParameter(dbCommand, ""@Section"", DbType.String, section.ToString());

            _crud.List(dbCommand, PopulateFrom);
        }

        return this;
    }

    public void PopulateFrom(DataTable table)
    {
        this.Clear();

        foreach (DataRow row in table.Rows)
        {
            Configuration instance = new Configuration();
            instance.PopulateFrom(row);
            this.Add(instance);
        }
    }

    #endregion
}
</code></pre>

<p><strong>THE ITEM-CLASS CODE:</strong><br/></p>

<p>public class Configuration
{
    #region CONSTRUCTORS</p>

<pre><code>public Configuration()
{
    initialize();
}

#endregion

#region PROPERTIES &amp; FIELDS

private Crud _crud;

public string Section { get; set; }
public string Key { get; set; }
public string Value { get; set; }

#endregion

#region EVENTS
#endregion

#region METHODS

private void initialize()
{
    _crud = new Crud(""CurrentDbConnection"");
    Clear();
}

public void Clear()
{
    this.Section = """";
    this.Key = """";
    this.Value = """";
}
public void PopulateFrom(DataRow row)
{
    Clear();

    this.Section = row[""Section""].ToString();
    this.Key = row[""Key""].ToString();
    this.Value = row[""Value""].ToString();
}

#endregion
</code></pre>

<p>}</p>
","<c#><asp.net><caching><refactoring><web-config>","2","470","2011-01-31 15:53:58"
"4865331","VB.Net Refactor to Remove Code Duplication","<p>This is a simplified version of a class that I have in my project. Since the Bonus is figured the exact same way in each function I want to remove the obvious code duplication that appears here and make the three different functions into one. However I am not sure how to provide the argument that this new function would require. </p>

<p>For instance I am currently just passing the argument like this from code</p>

<p><strong>lblVolumeBonus.Content = TestClass.VolumeBonusAmountStore(bonus).</strong></p>

<p>I think I have to basically turn this logic around and call it with something like</p>

<p><strong>lblVolumeBonus.Content = TestClass.VolumeBonusAmountStore(BonusTrackerBO.StoreBonus)</strong> </p>

<p>but I am not sure of the correct syntax or whether I am on the right track at all.</p>

<p>Can someone help get me in the right direction?</p>

<pre><code>Public Class TestClass
Public Shared Function StoreBonus(ByVal bonus As BonusTrackerBO.StoreBonus) As Double

    Dim myBonus As Double = bonus.TicketAmount
    Return myBonus * 5

End Function

Public Shared Function DistrictBonus(ByVal bonus As BonusTrackerBO.DistrictBonus) As Double

    Dim myBonus As Double = bonus.TicketAmount
    Return myBonus * 5

End Function

Public Shared Function CompanyBonus(ByVal bonus As BonusTrackerBO.CompanyBonus) As Double

    Dim myBonus As Double = bonus.TicketAmount
    Return myBonus * 5

End Function
End Class
</code></pre>

<p><strong>Edit:</strong> It may not make a difference but I should have made clear that there are other factors in the equation (I was just trying to keep it simple). So is the answer the same when there are other callbacks to the bonus like bonus.MaximumAmount, bonus.MinimumAmount? There are 5 callbacks to the bonus object and the amounts are different depending on whether it is a Store, District or Company asking.</p>
","<vb.net><refactoring>","0","117","2011-02-01 16:42:57"
"4866873","Replace conditional with polymorphism - nice in theory but not practical","<p>""Replace conditional with polymorphism"" is elegant only when type of object you're doing switch/if statement for is already selected for you.  As an example, I have a web application which reads a query string parameter called ""action"". Action can have ""view"", ""edit"", ""sort"", and etc. values.  So how do I implement this with polymorphism?  Well, I can create an abstract class called BaseAction, and derive ViewAction, EditAction, and SortAction from it. But don't I need a conditional to decided which flavor of type BaseAction to instantiate?  I don't see how you can entirely replace conditionals with polymorphism.  If anything, the conditionals are just getting pushed up to the top of the chain.</p>

<p>EDIT:</p>

<pre><code>public abstract class BaseAction
{
    public abstract void doSomething();
}

public class ViewAction : BaseAction
{
    public override void doSomething() { // perform a view action here... }
}

public class EditAction : BaseAction
{
    public override void doSomething() { // perform an edit action here... }
}

public class SortAction : BaseAction
{
    public override void doSomething() { // perform a sort action here... }
}


string action = ""view"";  // suppose user can pass either ""view"", ""edit"", or ""sort"" strings to you.
BaseAction theAction = null;

switch (action)
{
    case ""view"":
        theAction = new ViewAction();
        break;

    case ""edit"":
        theAction = new EditAction();
        break;

    case ""sort"":
        theAction = new SortAction();
        break;
}

theAction.doSomething();    // So I don't need conditionals here, but I still need it to decide which BaseAction type to instantiate first. There's no way to completely get rid of the conditionals.
</code></pre>
","<refactoring><polymorphism><conditional>","0","502","2011-02-01 19:08:45"
"4878160","Combining loops in algorithm","<p>I want to perform a specific-type of search.  I do not know if it has a name, but I can describe it, and have working code for its execution.</p>

<p>For a 2-dimensional matrix, starting at point 0,0 and working down-right, the search generation would look like:</p>

<ul>
<li>&nbsp;&nbsp;1,&nbsp;&nbsp;4,&nbsp;&nbsp;9, 16, ...  </li>
<li>&nbsp;&nbsp;2,&nbsp;&nbsp;3,&nbsp;&nbsp;8, 15, ... </li>
<li>&nbsp;&nbsp;5,&nbsp;&nbsp;6,&nbsp;&nbsp;7, 14, ...</li>
<li>10, 11, 12, 13, ...</li>
<li>...</li>
</ul>

<p>So the first search loop would inspect 1, the second loop inspects 2, 3, 4, the third loop inspects 5, 6, 7, 8, 9, etc.</p>

<p>The code to produce this search is:</p>

<pre><code>$row_search = 0;
$point_not_found = true;

while ($point_not_found &amp;&amp; $row_search &lt; $matrix_height/2)
{
    $current = array(0, $row_search);

    while ($current[0] &lt; $row_search)
    {
        if (searchForPoint( $matrix, $current ) !== false)
            $point_not_found = false;

        ++$current[0];
    }

    if (!$anchor_not_found)
        break;

    while ($current[1] &gt;= 0)
    {
        if (searchForPoint( $matrix, $current ) !== false)
            $point_not_found = false;

        --$current[1];
    }

    ++$row_search;
}
</code></pre>

<p>I am unhappy with how the search is broken into two loops, as the code within the loops is nearly identical.  Can you suggest a way to either combine or nest the loops and eliminate redundant calls to searchForPoint?</p>
","<php><refactoring><while-loops>","2","96","2011-02-02 18:11:27"
"4882497","Type Code vs Enum for refactoring?","<p>Type code (i.e., 1,2,3 (open,close,unused)) is being used in my project and I would like to refactor that part of code. Should I follow Replace type code with class as mentioned in <em>Refactoring Improve the design of existing code</em> or just using enum is sufficient? C# is my programming language.</p>
","<c#><enums><refactoring>","1","324","2011-02-03 03:46:31"
"4896516","Separate project for only images - need refactoring?","<p>I have webapp project (tomcat + jsp + spring)</p>

<p>I want all images move to different project. It'll give me possible to change images by redeploy only one war. </p>

<p>The biggest problem which I have is when I'll move images to new project I need change all paths in jsp, css files. Is there any solution without big refactoring? (maybe Filter which mapping all calling /images/* to /ProjectWithImages/images/*? Is performance good for this solution?) </p>
","<java><jsp><servlets><refactoring><servlet-filters>","0","51","2011-02-04 09:41:23"
"4907027","how to simplify/improve an Erlang code?","<p>How a good Erlang programmer would write this code ?</p>

<pre><code>loop(expr0) -&gt;  
    case expr1 of   
    true -&gt;  
       A = case expr2 of  
               true -&gt; ...;  
               false -&gt; ...  
           end;
    false-&gt;  
       A = case expr3 of  
               true -&gt; ...;  
               false -&gt; ...  
           end  
  end,  
loop(expr4(A)).
</code></pre>
","<refactoring><erlang>","2","162","2011-02-05 13:12:32"
"4908981","Long method chains in Java and refactoring techniques","<p>How do Java programmers deal with long method chains? Sometimes one or two methods will have results that depend on the same long method chains being called on a several objects and it seems like overkill to add methods to the class just to deal with one or two localized instances of long chains. In languages with first class functions I just usually define some kind of one off function in the block with the long method chain to factor some things out and shorten the method chain so what would be the equivalent in Java?</p>
","<java><refactoring><method-chaining><repetition>","1","238","2011-02-05 19:07:41"
"4909140","refactoring sql in php","<p>What is a good place to put sql commands so they do not appear in the main code, how can this be done? How can sql commands such as the following be refactorised:</p>

<pre><code>function select_Query($sql, $link)
{
    $query = mysqli_query($link, $sql);

    if (!$query)
    {
        echo ""Failure""; #   TODO: LOG THIS
    }

    $data = array();
    while ($row = mysqli_fetch_array($query) )
    {
        $data[] = $row;
    }    

    return $data;
}


$query = select_Query(""SELECT thread.title, thread.id as t_id,
                         thread.content
                         FROM thread
                         LIMIT $start, 30"", $link);
</code></pre>

<p>How would you factorise the $query var part to generalise it for other sql statements - as that is fairly simple sql, however when several joins are used sql commands take up several lines in my code, I don't want to mix them with my php code.</p>
","<php><sql><refactoring>","0","35","2011-02-05 19:29:39"
"4916862","Refactoring form code in php","<p>I get three values from a form (thread_title, thread_content and thread_tags):</p>

<p>This is the code to check their lengths:</p>

<pre><code>$errors = array();

$thread_title = filter_input(INPUT_POST, 'thread_title');
$thread_content = filter_input(INPUT_POST, 'thread_content');
$thread_tags = filter_input(INPUT_POST, 'thread_tags');


if (strlen($thread_title) &lt; 20 )
{
    $errors['thread_title'] = 'Title is too short, minimum is 20 characters.';    
}

if (strlen($thread_content) &lt; 30 )
{
    $errors['thread_content'] = 'Content is too short, minimum is 30 characters.';
}

if (strlen($thread_tags) &lt; 3)
{
    $errors['thread_tags'] = 'Tags must be atleast 3 characters.';
}
</code></pre>

<p>I repeat this in the reply.php file:</p>

<pre><code>if (strlen($reply_content) &lt; 20)
{
    $errors['reply_content'] = 'Reply must be atleast 20 characters.';
}
</code></pre>

<p>.etc</p>

<p>If the errors array is empty I then clean the data and submit it to the database. How can this code be made cleaner, refactored?</p>

<p>I know I can use something like PEAR QUICK_FORM (2.0?), however that is still in alpha and the error messages appear as a JS popup in that and not next to the required field.</p>
","<php><refactoring>","0","51","2011-02-06 23:14:01"
"4913725","PHP code refactoring","<p>How would you refactor something like this:</p>

<pre><code>$start = $_GET['s'];
if (!is_int($start) || $start &lt; 0)
{
    $start = 0;
}
</code></pre>

<p>Here I need start to equal 0 or greater, however later on I will need it to equal 1 or greater. How would this be made into a function?</p>
","<php><refactoring>","0","99","2011-02-06 14:03:17"
"4925047","Code Duplication Detection - Delphi","<p>Does anyone know a good tool to find duplicate code in a delphi program like SolidSDD?</p>
","<delphi><refactoring>","3","562","2011-02-07 18:35:46"
"4914076","Can this jQuery animation code be made more elegant?","<p>fairly new to jQuery, and i have come up with some animation code which works, but it looks very ugly.</p>

<pre><code>function help() {

    $(""#searchBox"").click(function(){
        $('#search_text_1').stop(true,true).hide();
        $('#search_text_2').stop(true,true).hide();
        $('#search_text_3').stop(true,true).hide();
        $('#search_text_4').stop(true,true).hide();
        $('#search_text_5').stop(true,true).hide();
        $('#free_search_help_1').stop(true,true).hide();
        $('#free_search_help_2').stop(true,true).hide();
        $('#free_search_help_3').stop(true,true).hide();
        $('#free_search_help_4').stop(true,true).hide();
        $('#free_search_help_5').stop(true,true).hide();
  });

    $('#search_text_1').delay(1000).fadeIn(500).delay(4000).fadeOut(500, function() {
        $('#search_text_2').fadeIn(500).delay(4000).fadeOut(500, function() {
            $('#search_text_3').fadeIn(500).delay(4000).fadeOut(500, function() {
                $('#search_text_4').fadeIn(500).delay(4000).fadeOut(500, function() {
                    $('#search_text_5').fadeIn(500);
                });
            });
        });
    });

    $('#free_search_help_1').delay(1000).fadeIn(500).delay(4000).fadeOut(500, function() {
        $('#free_search_help_2').fadeIn(500).delay(4000).fadeOut(500, function() {
            $('#free_search_help_3').fadeIn(500).delay(4000).fadeOut(500, function() {
                $('#free_search_help_4').fadeIn(500).delay(4000).fadeOut(500, function() {
                    $('#free_search_help_5').fadeIn(500);
                });
            });
        });
    });

}
</code></pre>

<p>I am particularly concerned with the click function to stop the animations, seems a bit hacky to me. I did try calling .stop() on a class that was assigned to all the divs that were being animated, but this didn't seem to work (no errors).</p>

<p>I also tried:</p>

<pre><code>$(""div:animated"").stop(true,true);
</code></pre>

<p>but this only worked if the click happened during the fades, and not the delays.</p>
","<jquery><animation><refactoring><refactor-my-code>","0","105","2011-02-06 15:06:51"
"4914913","How do I include a Module into another Module (Refactor AASM code and custom states into Module)","<p>I'm trying to refactor a superfat model which has quite a few lines of ActsAsStateMachine code related to the states and transitions, and I was hoping to refactor this to a module call CallStates.  </p>

<pre><code>#in lib/CallStates.rb
module CallStates
    module ClassMethods
        aasm_column :status
        aasm_state :state1
        aasm_state :state2
        aasm_state :state3
    end

    def self.included(base)
        base.send(:include, AASM)
        base.extend(ClassMethods)
    end
end
</code></pre>

<p>And then in the model</p>

<pre><code>include CallStates
</code></pre>

<p>My question concerns how to include Module behavior into a Module such that a single Module can be included into the model.  I've tried class_eval do as well to no avail.  Thanks for any insightful thoughts you have on the matter.</p>
","<ruby><refactoring>","3","305","2011-02-06 17:29:44"
"4944081","Refactoring: Extracting interface","<p>I am refactoring my existing code. I've extracted interfaces from my existing classes. I have created a separate class library which holds all such interfaces. 
My problem is I have some classes with structures and enums. These classes also have some methods returning these structures and enums. </p>

<p>I want to extract interface from these class. But I am now worried about the structures and enums. I can't have these structures and enums extracted in my interface and hence methods returning structure and enums do not reflect easily in extraction.</p>

<p>How can I overcome this situation wherein I want to have structure and enums in my extracted interface? Do I need to break the structure and have to use it as members of interface? How can I define methods returning structure in interface?</p>
","<c#-3.0><refactoring><extraction>","1","78","2011-02-09 11:14:19"
"4965596","GWT, Eclipse Plugin how to rename project along with .gwt.xml file? Am getting error when try to do so","<p>I've spent a while searching on this and nothing that I find seems relevant specifically to my issue. I am making RPC calls so I wanted to change the path to one of my web services.</p>

<p>It was something like <code>mytestproject</code> and wanted to change it to <code>finalprojectname</code></p>

<p>I went to the <code>mytestproject.gwt.xml</code> file and changed 
<code>&lt;module rename-to='mytestproject'&gt;</code> to <code>&lt;module rename-to='finalprojectname'&gt;</code></p>

<p>I then ran it through and got an error that <code>[ERROR] Unable to find 'org/ediscovery/gwt/mytestproject.gwt.xml' on your classpath; could be a typo, or maybe you forgot to include a classpath entry for source?</code></p>

<p>I then changed <code>mytestproject.gwt.xml</code> to <code>finalprojectname.gwt.xml</code> but still got the same result.</p>

<p>I've looked through every possible file and can't find why it thinks the project is still named <code>mytestproject</code>. I have cleaned and rebuilt the project, etc but still the same. I am still fairly new to Java so maybe I am missing something obvious. I would greatly appreciate if anyone can offer any advice. Thanks</p>
","<java><eclipse><gwt><refactoring><classpath>","1","988","2011-02-11 04:21:10"
"4967784","Can you get the biggest length of a String.Split in a one liner?","<p>In the below piece of code, is there a way to not need a foreach? All that needs to happen is that if a single of the split parts exceeds a length, i can set it as invalid.</p>

<p>My colleage is sure he used a one line piece of code for this but google left me with no evidence of this.</p>

<pre><code>                else if (lineSplit[11].Length &gt; Constant.EstimatedBirthdatesofChildren)
            {
                var estimatedBirthdatesofChildren = lineSplit[11].Split('~');
                foreach (String estimatedBirthdatesofChild in estimatedBirthdatesofChildren)
                {
                    if (estimatedBirthdatesofChild.Length &gt; Constant.EstimatedBirthdatesofChild) valid = false;
                }
            }
</code></pre>
","<c#><string><refactoring><split>","1","113","2011-02-11 10:11:23"
"4969589","How could I reduce PHP code with lots of isset checks and repetitive, but variable generation arguments?","<p>Greetings. I am struggling to reduce a code segment that looks rather lengthy, leaving me unconvinced about its essentiality. It's a function to generate a multitude of session arrays used to fill out forms, and it has me verifying the existence of certain values in the argument array, with cases for every single one to generate the requested arrays. Here goes:</p>

<pre><code>function prepOptional($formData) {

    $baseInfo=getBaseInfo();

    $_SESSION['fooData'] = (isset($formData['cbFoo']) ? prepBaseForm($baseInfo, 'foo',
            'Option foo') : '');

    $_SESSION['opt1Data'] = (isset($formData['cbOpt1']) ? prepBaseForm($baseInfo, 'opt1',
            'Option 1') : '');

    $_SESSION['barData'] = (isset($formData['cbBar']) ? prepBaseForm(prepOtherArray($formData), 'bar',
            'Option bar', 'Optional argument') : '');

}
</code></pre>

<p>The function accepts a formdata array as argument, and depending on the contained values it generates the corresponding arrays in session; this happens only after checking the existence of the matching flag, hence the issets and the ternary operator.</p>

<p>The called function, prepBaseForm, separates the appending of the second and third arguments, corresponding to a filename and a friendly name, to the first argument, which is an array; it also accepts an optional fourth parameter, indicating a file to concatenate to the filled form.</p>

<p>If the value is not present in the array, the code intentionally clears the corresponding session variable to '' in order to keep the generation order intact (to this end: is there a better way of doing this, considering that there are scenarios in which the given generation order will be broken?).</p>

<p>The actual code has about twenty generation blocks with this format, and it's getting quite lengthy; one optimization I thought of was to loop through the given fields and generalize the generation process, but as you can see, many times the arguments differ, or the input array for the prepBaseForm function has to be generated another way. Any ideas on how I could tackle this refactoring? Thanks in advance for your response.</p>
","<php><refactoring>","4","139","2011-02-11 13:33:52"
"4972568","Delphi style: How to structure data modules for unit-testable code?","<p>I am looking for some advice about structuring Delphi programs for maintainability. I've come to Delphi programming after a couple of decades of mostly C/C++ though I first learned to program with Turbo Pascal, so I'm not uncomfortable with the basic language. In my previous experience with C++ and C#, I became a TDD convert through using cxxtest and NUnit.</p>

<p>I have inherited this program that I am now responsible for maintaining. It consists mainly of forms, and a couple of data modules. The application business logic and data access is mainly scattered about the forms, and the data modules are mostly just places for global ADO objects to live. The database access is generally done by referring to a global instance of TADOQuery or TADOCommand, formatting SQL text right into the relevant property of the object, and calling its Open or Execute method.</p>

<p>I am trying to get the business logic into a degree of encapsulation where it can be unit-tested. I've seen <a href=""http://stackoverflow.com/questions/549369/how-if-to-refactor-a-delphi-program-using-only-forms-and-data-modules/549649#549649"">this answer</a> and it makes perfect sense as far as abstracting logic from forms. I am wondering what the best practices are for data access. My thinking is that the data modules should expose a sort of app-specific mini-API (probably with all virtual methods) so that they can be replaced with mock objects for testing. The link at <a href=""http://stackoverflow.com/questions/472944/unit-testing-delphi-data-modules/473079#473079"">this other answer</a> shows some examples that lead me to believe I'm on the right track, but I'm still interested in seeing some kind of best practices document about data modules. Most of the pages that I can find through Google present the same kind of examples about all the cool stuff you can do at design time with hooking up data-bound controls to queries and that sort of thing, which I'm not very interested in at the moment.</p>
","<delphi><unit-testing><refactoring><datamodule>","10","707","2011-02-11 18:16:00"
"4983543",".net: how to optimize this code?","<p>Please help me optimize/ refactor this code.....</p>

<pre><code>private sub test
        Call PopulateColorsWithMasterIdentity(Colors, Id)
        Call PopulatePartsWithMasterIdentity(Parts, Id)
        Call PopulateSaloonsWithMasterIdentity(Saloons, Id)
End sub

Private Sub PopulateColorsWithMasterIdentity(ByRef MyList As List(Of entclsCriticalPartSetColor), ByVal Id As Integer)

    For index As Byte = 0 To MyList.Count - 1
        MyList.Item(index).CriticalPartsSetId = Id
    Next
End Sub

Private Sub PopulatePartsWithMasterIdentity(ByRef MyList As List(Of entclsCriticalPartSetPart), ByVal Id As Integer)

    For index As Byte = 0 To MyList.Count - 1
        MyList.Item(index).CriticalPartsSetId = Id
    Next
End Sub

Private Sub PopulateSaloonsWithMasterIdentity(ByRef MyList As List(Of entclsCriticalPartSetSaloon), ByVal Id As Integer)

    For index As Byte = 0 To MyList.Count - 1
        MyList.Item(index).CriticalPartsSetId = Id
    Next
End Sub
</code></pre>

<p>*<strong><em>EDIT</em>*</strong></p>

<p>Actually, Is it possible to use ""Polymorphism""? I mean, instead of having 3 different parts of populateXXXWithMasterIdentity, can I have one PopulateListWithMasterIdentity like this one:</p>

<pre><code>Private Sub PopulateListWithMasterIdentity(MyList As IList(Of entclsCriticalPartsBase), Id As Integer)
    .....
End Sub
</code></pre>

<p>Thank you</p>
","<.net><vb.net><optimization><refactoring>","1","157","2011-02-13 10:01:35"
"4978341","Moose module with errors, need help finding the cause","<p>I'm trying to refactor my tests for <a href=""http://search.metacpan.org/#/dist/Dist-Zilla-Plugin-Catalyst"" rel=""nofollow"">Dist::Zilla::Plugin::Catalyst</a> to be more DRY,trying to use Moose for the task, but I'm running into issues, and for the life of me I can't figure out what they are, some of it has appeared to be order initialization issues.</p>

<p><em>note: code is probably not the best, suggestions welcome</em></p>

<blockquote>
t/01-PluginCatalystNew.t ....... Can't call method ""subdir"" on an undefined value at /home/xenoterracide/projects/Dist-Zilla-Plugin-Catalyst/.build/8kE7QQR_FL/t/lib/DZPCshared.pm line 26.
</blockquote>

<p>Here's the Moose Module, </p>

<pre><code>use strict;
use warnings;
package DZPCshared;
use Path::Class;
use Moose;
use namespace::autoclean;

has 'appname' =&gt; (
    is       =&gt; 'ro',
    required =&gt; 1,
);

has 'tempdir' =&gt; (
    is       =&gt; 'ro',
    required =&gt; 1,
);

has 'directories' =&gt; (
    isa      =&gt; 'ArrayRef[Str]',
    traits   =&gt; ['Array'],
    is       =&gt; 'ro',
    required =&gt; 1,
    lazy     =&gt; 1,
    default  =&gt; sub {
        my $self = shift;
        my $mr   = dir( $self-&gt;tempdir )-&gt;subdir('mint');
        my $mrl  = $mr-&gt;subdir('lib');
        my $mrr  = $mr-&gt;subdir('root');
        my $mrs  = $mr-&gt;subdir('script');
        my $mrt  = $mr-&gt;subdir('t');
        my $mrri = $mr-&gt;subdir('root')-&gt;subdir('static')-&gt;subdir('images');
        return my $directories = [ $mr, $mrl, $mrr, $mrs, $mrt, $mrri ];
    },
);

has 'scripts' =&gt; (
    isa      =&gt; 'ArrayRef[Str]',
    traits   =&gt; ['Array'],
    is       =&gt; 'ro',
    default  =&gt; sub {
        my $self = shift;
        my ( $mr, $mrl, $mrr, $mrs, $mrt, $mrri ) = @{ $self-&gt;directories };
        my $lc_app = lc $self-&gt;appname;
        return my $scripts = [
            $mrs-&gt;file  ( $lc_app . '_cgi.pl'     ),
            $mrs-&gt;file  ( $lc_app . '_create.pl'  ),
            $mrs-&gt;file  ( $lc_app . '_fastcgi.pl' ),
            $mrs-&gt;file  ( $lc_app . '_server.pl'  ),
            $mrs-&gt;file  ( $lc_app . '_test.pl'    ),
        ];
    },
);

has 'files' =&gt; (
    isa      =&gt; 'ArrayRef[Str]',
    traits   =&gt; ['Array'],
    is       =&gt; 'ro',
    default  =&gt; sub {
        my $self = shift;
        my ( $mr, $mrl, $mrr, $mrs, $mrt, $mrri ) = @{ $self-&gt;directories };
        my $lc_app = lc $self-&gt;appname;
        return my $files = [
            $mr-&gt;file   ( $lc_app . '.conf'               ),
            $mrl-&gt;file  ( $self-&gt;app_name . '.pm'               ),
            $mrl-&gt;subdir( $self-&gt;app_name )-&gt;subdir('Controller')-&gt;file('Root.pm'),
            $mrr-&gt;file  ( 'favicon.ico'                   ),
            $mrri-&gt;file ( 'btn_120x50_built.png'          ),
            $mrri-&gt;file ( 'btn_120x50_built_shadow.png'   ),
            $mrri-&gt;file ( 'btn_120x50_powered.png'        ),
            $mrri-&gt;file ( 'btn_120x50_powered_shadow.png' ),
            $mrri-&gt;file ( 'btn_88x31_built.png'           ),
            $mrri-&gt;file ( 'btn_88x31_built_shadow.png'    ),
            $mrri-&gt;file ( 'btn_88x31_powered.png'         ),
            $mrri-&gt;file ( 'btn_88x31_powered_shadow.png'  ),
            $mrri-&gt;file ( 'catalyst_logo.png'             ),
            $mrt-&gt;file  ( '01app.t'                       ),
        ];
    },
);

__PACKAGE__-&gt;meta-&gt;make_immutable;
1;
</code></pre>

<p>and the test</p>

<pre><code>#!/usr/bin/perl
use strict;
use warnings;
use Test::More;

if ( $Moose::VERSION &gt;= 1.9902 and $Moose::VERSION &lt; 2.0 ) {
    plan skip_all =&gt; 'Module is broken on Devel Moose, don\'t test';
}

use Dist::Zilla::Tester;
use Path::Class;
use FindBin;
use lib ""$FindBin::Bin/lib"";
use DZPCshared;

my $tzil = Minter-&gt;_new_from_profile(
    [ Default =&gt; 'default' ],
    { name =&gt; 'CatApp' },
    { global_config_root =&gt; dir('corpus/mint')-&gt;absolute },
);

$tzil-&gt;mint_dist;

my $dzpcs = DZPCshared-&gt;new({
    appname =&gt; $tzil-&gt;name,
    tempdir =&gt; $tzil-&gt;tempdir,
});

subtest 'catalyst files exist' =&gt; sub {
    my $should_exists = [ @{$dzpcs-&gt;files}, @{$dzpcs-&gt;scripts} ];

    foreach ( @{$should_exists} ) {
        ok  ( -e $_ , ""$_"" . ' exists' );
    }
};

subtest 'catalyst scripts should be executable' =&gt; sub {
    plan skip_all =&gt; 'skip failing executable tests on windows' if $^O eq 'MSWin32';
    my $should_exec = @{$dzpcs-&gt;scripts};

    foreach ( @{$should_exec} ) {
        ok  ( -x $_ , ""$_"" . ' exists' );
    }
};
done_testing;
</code></pre>

<p><em>(note: p.s. not sure a minimal test case is possible in this)</em></p>

<p><em>(note: also the <a href=""https://github.com/xenoterracide/Dist-Zilla-Plugin-Catalyst/blob/0.13/t/01-PluginCatalystNew.t"" rel=""nofollow"">previous version</a> worked)</em></p>
","<perl><refactoring><reference><moose>","1","131","2011-02-12 13:38:06"
"4995525","Is there a way to see a list of a class' methods with their length (no of lines) in Eclipse?","<p>When refactoring a class that is too large, to get an overview of ""problematic"" methods I find it useful to see a list of all methods, with the number of lines of each method.</p>

<p>Eclipse of course has a list of the methods of a class (breadcrumbs, Outline view), but I can't see a way to show the number of lines for each method.</p>

<p>Is there a way to see this, in Eclipse, or using some other tool?</p>
","<java><eclipse><refactoring>","1","75","2011-02-14 17:55:14"
"4995842","why doesn't eclipse-python have magic refactor?","<p>Eclipse is able to utilize compiled bytecode to enable ""magic refactor"" functionality--renaming methods, tracing up and down class hierarchies and tracing through method calls.</p>

<p>What technical barriers exist that make this harder to do for languages like Python and Javascript?</p>
","<javascript><python><eclipse><refactoring><automated-refactoring>","1","248","2011-02-14 18:28:27"
"5002955","Refactoring PHP OOP - How to get the object without passing a parameter?","<p>I need to refactor this code to not use a parameter when using the ""save()"" method. </p>

<p>The code is:</p>

<p>Person.php
    

<pre><code>class Person {

    public $name;
    public $age;
    public $country;

    public function save($object) {

        $api = new ReflectionClass($object);

        foreach($api-&gt;getProperties() as $propertie)
        {
            print $propertie-&gt;getName() . "" - "" . $propertie-&gt;getValue($object) . "" | "";    
        }       
    }

}

?&gt;
</code></pre>

<p>Example_usage.php
    

<pre><code>include_once('person.php');

$p = new Person();

$p-&gt;name = 'Mary';
$p-&gt;age = '28';
$p-&gt;country = 'Italy';
$p-&gt;save($p);

?&gt;
</code></pre>

<p>My question. How can I use the ""save()"" method like this:</p>

<pre><code>$p-&gt;save();
</code></pre>

<p>It is possible to pass the $p object in other way than passing the parameter in the ""save()"" method?</p>
","<php><oop><refactoring>","0","185","2011-02-15 11:19:36"
"4999261","How can I make this more object-oriented?","<p>I'm a rails noob trying to follow the DRY methods of those who've come before me.
I know that I'm doing something wrong – I'm just not sure what that is or how to overcome it.</p>

<p>Basically, my question is how can I make this code more object-oriented?</p>

<p>I have a class Podcast, which at this point just contains a bunch of class methods that scrape various data from around the web.</p>

<p>So, for example, this class method tries to discover a podcast twitter or facebook feed from their website:</p>

<pre><code>def self.social_discovery(options = {})
  new_podcasts_only = options[:new_podcasts_only] || false
  if new_podcasts_only
    podcast = Podcast.find(:all, :select =&gt; 'id, siteurl, name', :conditions =&gt; ['created_at &gt; ? and siteurl IS NOT ?', Time.now - 24.hours, nil])
    Podcast.podcast_logger.info(""#{podcast.count}"")
  else
    podcast = Podcast.find(:all, :select =&gt; 'id, siteurl, name', :conditions =&gt; ['siteurl IS NOT ?', nil])
  end

  podcast.each do | pod |
    puts ""#{pod.name}""
    begin 
      # Make sure the url is readable by open-uri
      if pod.siteurl.include? 'http://'
        pod_site = pod.siteurl
      else
        pod_site = pod.siteurl.insert 0, ""http://""
      end

      # Skip all of this if we're dealing with a feed
      unless pod_site.downcase =~ /.rss|.xml|libsyn/i
        pod_doc = Nokogiri.HTML(open(pod_site))
        pod_name_fragment = pod.name.split("" "")[0].to_s
        if pod_name_fragment.downcase == ""the""
          pod_name_fragment = pod.name.split("" "")[1].to_s unless pod.name.split("" "")[1].to_s.nil?
        end
        doc_links = pod_doc.css('a')

        # If a social url contains part of the podcast name, grab that
        # If not, grab the first one you find within our conditions
        # Give Nokogiri some room to breathe with pessimistic exception handling
        begin
          begin         
            twitter_url = doc_links.find {|link| link['href'] =~ /twitter.com\// and link['href'].match(/#{pod_name_fragment}/i).to_s != """" unless link['href'] =~ /share|status/i}.attribute('href').to_s 
          rescue Exception =&gt; ex
            if doc_links.find {|link| link['href'] =~ /twitter.com\// unless link['href'] =~ /share|status/i}.nil?
              twitter_url = nil
            else       
              twitter_url = doc_links.find {|link| link['href'] =~ /twitter.com\// unless link['href'] =~ /share|status/i}.attribute('href').to_s
            end
          end

          begin    
            facebook_url = doc_links.find {|link| link['href'] =~ /facebook.com\// and link['href'].match(/#{pod_name_fragment}/i).to_s != """" unless link['href'] =~ /share|.event/i}.attribute('href').to_s
          rescue Exception =&gt; ex
            if doc_links.find {|link| link['href'] =~ /facebook.com\// unless link['href'] =~ /share|.event/i}.nil?
              facebook_url = nil
            else       
              facebook_url = doc_links.find {|link| link['href'] =~ /facebook.com\// unless link['href'] =~ /share|.event/i}.attribute('href').to_s
            end
          end
        rescue Exception =&gt; ex
          puts ""ANTISOCIAL""
        # Ensure that the urls gets saved regardless of what else happens
        ensure
          pod.update_attributes(:twitter =&gt; twitter_url, :facebook =&gt; facebook_url)            
        end

        puts ""#{twitter_url}"" + ""#{facebook_url}""
        Podcast.podcast_logger.info(""#{twitter_url}"" + ""#{facebook_url}"")
      end
    rescue Exception =&gt; ex
      puts ""FINAL EXCEPTION: #{ex.class} + #{ex.message}""
    end
  end  
end
</code></pre>

<p>Again, I know this is bad code.  Please help me understand <strong>why</strong>?
I will be forever in your debt.</p>

<p>Thanks,</p>

<p>Harris</p>
","<ruby-on-rails><oop><architecture><refactoring><class-method>","0","102","2011-02-15 02:01:11"
"5010633","Refactoring this 3n+1 problem solution","<p>What can be improved in this solution of the 3n+1 problem?</p>

<pre><code>#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt;
#include &lt;utility&gt;

typedef std::vector&lt;int&gt; int_vec;
typedef std::pair&lt;int,int&gt; int_pair;
typedef std::vector&lt;int_pair&gt; pair_vec;

int cycle_length(int number) {
    int n = number, length = 1;
    while (n != 1) {
        if (n % 2 == 0) {
            n /= 2;
        } else {
            n *= 3;
            ++n;
        }
        ++length;
    }
    return length;
}

int max_cycle_length(int_pair val) {
    int_vec tmp;
    for (int i = val.first; i &lt;= val.second; ++i) {
        tmp.push_back(cycle_length(i));
    }
    return *std::max_element(tmp.begin(), tmp.end());
}

int main () {
    int a, b;
    pair_vec numbers;
    while (std::cin &gt;&gt; a &gt;&gt; b) {
        numbers.push_back(std::make_pair(a, b));
    }
    for (pair_vec::iterator it = numbers.begin(); it != numbers.end(); ++it) {
        std::cout &lt;&lt; it-&gt;first &lt;&lt; ' ' &lt;&lt; it-&gt;second &lt;&lt; ' '
                  &lt;&lt; max_cycle_length(*it)&lt;&lt; '\n';
    }
    return 0;
}
</code></pre>
","<c++><refactoring>","0","202","2011-02-15 23:09:19"
"5021138","How to refactor a top-level class or interface to an inner one in Eclipse?","<p>I have an interface that I want to move inside another type.  Is there any way to get Eclipse to help me make that change?  The same change could also be applied to a class to move it inside another.</p>

<p>Basically, I'm looking for the reverse of <em>Convert Member Type to Top Level</em>. I hoped it would be Move, but that only offers packages as targets.</p>
","<java><eclipse><refactoring>","5","215","2011-02-16 19:27:01"
"5025502","Help refactoring jquery snippet from ajax call","<p>I'm trying to refactor this code. I have this jquery ajax call</p>

<pre><code>    $.ajax({
       url: 'addMember',
       type: 'post',
       data: data,
       dataType: 'json',
       success: function(msg) {                                             
        if(msg.validate === false) {    // if there are validation errors...
                if(msg.firstName != '') {
                    $('input[name=""firstName""]').parents('p').before(msg.firstName);
                    $('input[name=""firstName""]').parents('p').prev('p').addClass('message error');
                    $('input[name=""firstName""]').addClass('error');
                    $('input[name=""firstName""]').after('&lt;span class=""check-error""&gt;&lt;/span&gt;');
                }
                if(msg.lastName != '') {
                    $('input[name=""lastName""]').parents('p').before(msg.lastName);
                    $('input[name=""lastName""]').parents('p').prev('p').addClass('message error');
                    $('input[name=""lastName""]').addClass('error');
                    $('input[name=""lastName""]').after('&lt;span class=""check-error""&gt;&lt;/span&gt;');
                }
                if(msg.email != '') {
                    $('input[name=""email""]').parents('p').before(msg.email);
                    $('input[name=""email""]').parents('p').prev('p').addClass('message error');
                    $('input[name=""email""]').addClass('error');
                    $('input[name=""email""]').after('&lt;span class=""check-error""&gt;&lt;/span&gt;');
                }
         }
    .......etc
</code></pre>

<p>I tried doing this but that didn't work</p>

<pre><code>$.each(msg, function(k, v)) {
    console.log('msg.k = '+msg.k);
});
</code></pre>

<p>Suggestions?</p>
","<jquery><ajax><json><refactoring>","1","80","2011-02-17 05:46:38"
"5026244","Find usage of a particular method when called with a particular subtype","<p>I'm refactoring the nasty out of a largeish codebase and need to find where a particular method, accepting instances of a fairly general interface, is called with a particular implementation of that interface.</p>

<p>For example, in the <code>NastyStatic</code> is the <code>DoBadThings(IBusinessObject)</code> method. I have about 50 classes that implement <code>IBusinessObject</code> in my business library, including <code>DontHurtMe : IBusinessObject</code>.</p>

<p>How can I find every call to <code>NastyStatic.DoBadThings(foo)</code>, but only where <code>foo</code> is an instance of <code>DontHurtMe</code>?</p>

<p>EDIT: I'm after some sort of static analysis tool. Setting a dynamic watch in <code>DoBadThings</code> (or similar) and running the application isn't really an option. It will already throw an exception due to changes I've made to <code>DontHurtMe</code>, and there are far too many code paths to find all usages that way (at least until it goes live and my users start complaining).</p>
","<c#><.net><refactoring><code-analysis>","4","133","2011-02-17 07:38:25"
"5028415","Is this code unduplicateable?","<p>I have <code>if ($this-&gt;_userexists()) return false;</code> in two functions. They became</p>

<pre><code>function exitifuserexists() {
    if ($this-&gt;_userexists()) return false;
}
</code></pre>

<p>It exits itself, but must exit the caller. How to make two ""if this that"" with two ""function calls""?</p>
","<php><refactoring><code-smell>","1","68","2011-02-17 11:37:32"
"5020099","PHP - how to tell the object whos its creator?","<p>HI!</p>

<p>basicly what I ask u to tell me is <strong>how to put a ""parent"" reference into the object</strong></p>

<p>I need it to make example of ""extracting method with method object"" - one of mostly used refactoring in Java or C#</p>

<p>in Java refering to ""parent object"" looks like this:</p>

<pre><code>class someClass {
  MyObject myObj = new MyObject(this);
}
</code></pre>

<p>and thats it :)</p>

<p>but I dont know, how to do the same in PHP</p>

<p>maybe if its imposible you would tell me how you extract your methods out of your classes to new class, that has to do what that method did.</p>

<p>so in other words...</p>

<p>1 - I have class with big and hard to read / refactor method.<br>
2 - I extract that method to new class, giving it fields in place of parameters and method like ""execute"" - to proced all that this class has to do for me.<br>
3 - I put object of my class to my old function class and I call its method ""execute"" - so the all logic that was in my_big_method is done.</p>
","<php><object><refactoring>","1","138","2011-02-16 17:48:42"
"5042755","PHP - simple refactor","<p>I have the following code:</p>

<pre><code>$image_1 = $value-&gt;getElementsByTagName(""Image1"");
$image1  = $image_1-&gt;item(0)-&gt;nodeValue;

$image_2 = $value-&gt;getElementsByTagName(""Image2"");
$image2  = $image_2-&gt;item(0)-&gt;nodeValue;
</code></pre>

<p>Is there an easier way, to not repeat code If I need $image_3 ?</p>

<p>i.e. how can I refactor this?</p>

<p>Thanks</p>

<p>UPDATE:</p>

<p>I am using the $images_x variables in further code, that also needs refactoring:</p>

<p>UPDATE 2: - My full code:</p>

<pre><code>$image_1 = $value-&gt;getElementsByTagName(""Image1"");
$image1  = $image_1-&gt;item(0)-&gt;nodeValue;

$image_2 = $value-&gt;getElementsByTagName(""Image2"");
$image2  = $image_2-&gt;item(0)-&gt;nodeValue;

$image_3 = $value-&gt;getElementsByTagName(""Image3"");
$image3  = $image_3-&gt;item(0)-&gt;nodeValue;

$filename_1 = basename($image1);
$ch = curl_init ($image1);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_BINARYTRANSFER,1);
$rawdata_1=curl_exec ($ch);
curl_close ($ch);
$fp = fopen(Mage::getBaseDir('media') . DS . 'import/'.$filename_1,'w');
fwrite($fp, $rawdata_1);
fclose($fp);

$filename_2 = basename($image2);
$ch = curl_init ($image2);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_BINARYTRANSFER,1);
$rawdata_2=curl_exec ($ch);
curl_close ($ch);
$fp = fopen(Mage::getBaseDir('media') . DS . 'import/'.$filename_2,'w');
fwrite($fp, $rawdata_2);
fclose($fp);

$filename_3 = basename($image3);
$ch = curl_init ($image3);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_BINARYTRANSFER,1);
$rawdata_3=curl_exec ($ch);
curl_close ($ch);
$fp = fopen(Mage::getBaseDir('media') . DS . 'import/'.$filename_3,'w');
fwrite($fp, $rawdata_3);
fclose($fp);

$product-&gt;addImageToMediaGallery(Mage::getBaseDir('media') . DS . 'import/' .  $filename_1, array('image', 'small_image','thumbnail'), false, false);
$product-&gt;addImageToMediaGallery(Mage::getBaseDir('media') . DS . 'import/' .  $filename_2, array('image', 'small_image','thumbnail'), false, false);
$product-&gt;addImageToMediaGallery(Mage::getBaseDir('media') . DS . 'import/' .  $filename_3, array('image', 'small_image','thumbnail'), false, false);
</code></pre>
","<php><refactoring>","1","162","2011-02-18 14:54:37"
"5046755","I use C-Style casts in my C++ project, is it worth refactoring to C++ casts?","<p>I use C-Style casts in my 15K lines C++ project, 90% of the times for casts between child and base classes.</p>

<p>Even when I read that it is bad to use them, and that they can result in severe errors, as they are not type safe as the C++ casts, I still <em>feel</em> perfectly fine and comfortable with using them.</p>

<p>I have not experienced a single bug in my project so far that was caused by, for example, an accidentally mistyped C-Style cast - really.</p>

<p>The main reason I was not using them until now:</p>

<ul>
<li>I didn't know enough about them yet</li>
<li>I didn't like their syntax, they are more verbose and harder to read for me</li>
</ul>

<p>My questions:</p>

<ul>
<li>(Why) Should I refactor my project to use C++-style casts?</li>
<li>Why should I use C++-style casts for my future projects?</li>
</ul>

<p>I use as good as all other advantages C++ offers me, from OOP including virtual and abstract base classes, namespaces, the STL, and so on.</p>

<p>Just not the new type casting syntax. - So the argument ""<em>Why aren't you just using C then?</em>"" doesn't count for me</p>
","<c++><refactoring><casting>","40","1169","2011-02-18 21:26:53"
"5047173","How to automate detection of copied code in large code base?","<p>I am looking for an automated way to detect when code is being copied and pasted as part of development on a large code base.  We are primarily working in C++.  The intention is to detect this with high probability and few false positives in an automated fashion such that changes doing this can be rejected.</p>

<p>It is all to easy for developers to fear the unknown of some code and instead copy it for their usage and make a small tweak instead of working on the master copy in a way that works for all.  I want to detect and stop such short cuts that will make the code harder to maintain.</p>

<p>Can anyone suggest an automated way to try and detect such cases?  Can this be applied after the fact to find areas that have already slipped through before the introduction of this automated solution.</p>
","<c++><refactoring><automated-tests><code-review><code-duplication>","6","335","2011-02-18 22:16:48"
"5048121","Making my JavaScript/jQuery cleaner","<p>I'm trying to improve how clean my JavaScript/jQuery is and was wondering if anyone has any pointers.</p>

<p>When I look at this is just doesn't look clean... </p>

<pre><code>if (window.jQuery) {
    (function ($) { 

        var podCaption = function ($scope, settings) { 

            this._settings = $.extend({  
                openHeight : 75,
                expandHeight : 120,
                shrinkHeight : 30,
                closeHeight : 15,
                timer : ''
            }, settings); 
            this._elements = { 
                scope : $scope,
                caption : $('.slider-information', $scope)
            };  

            this.init();
        };

        podCaption.prototype.init = function() {
            var _this = this; 

            $('.photo-more', _this._elements.caption).live('click', function() {  
                _this.expand(_this);
            });

            _this._elements.caption.mouseenter(function() {  
                _this.open(_this);
            }).mouseleave(function() {
                _this._settings.timer = setTimeout(function() { 
                    _this.shrink(_this);
                }, 1000);
            }); 
        };

        podCaption.prototype.changeImage = function(photoIndex, image) {
            var _this = this; 

            //Shrink out content 
            _this.close(_this, function() { 
                //Build content - NOTE i'm actually doing some template stuff here but I'm trying to make the code a little less verbose for the question at hand 
                _this._elements.caption.empty();
                _this._elements.caption.append('&lt;div&gt;&lt;div class=""photo-description""&gt;..&lt;/div&gt;&lt;div class=""photo-more""&gt;...&lt;/div&gt;&lt;div class=""photo-info""&gt;...&lt;/div&gt;&lt;/div&gt;'); 

                _this.open(_this, function() {   
                    _this._settings.timer = setTimeout(function() { 
                        _this.shrink(_this);
                    }, 4500);
                });
            }); 
        }; 

        podCaption.prototype.expand = function(_this, callback) {
            clearTimeout(_this._settings.timer);

            var caption = _this._elements.caption;
            $('.photo-more', caption).hide();
            $('.photo-info', caption).fadeIn(); 
            caption.animate({ height : _this._setting.expandHeight, opacity : 0.8 }, 500, callback);
        }

        podCaption.prototype.open = function(_this, callback) {
            clearTimeout(_this._settings.timer);

            _this._elements.caption.animate({ height : _this._setting.openHeight, opacity : 0.8 }, 500, callback);
        }

        podCaption.prototype.close = function(_this, callback) {
            clearTimeout(_this._settings.timer);

            var caption = _this._elements.caption;
            caption.children().fadeOut();
            caption.animate({ height : _this._setting.closeHeight, opacity : 0.2 }, 400, callback);
        }

        podCaption.prototype.shrink = function(_this, callback) {
            clearTimeout(_this._settings.timer);

            var caption = _this._elements.caption;
            $('.photo-info', caption).fadeOut(function() { $('.photo-more', caption).show(); });
            caption.animate({ height : _this._setting.shrinkHeight, opacity : 0.3 }, 400, callback);
        }

        $.fn.podCaption = function (options) {
            return new podCaption(this, options);
        };  
    })(jQuery);
}  
</code></pre>
","<javascript><jquery><refactoring>","2","367","2011-02-19 00:54:42"
"5058745","Refactoring in Visual studio 2010 express","<p>Help or suggestion will do.</p>

<p>I'm installing the Visual Studio Express 2010, i know we cannot use resharper with express edition. i need know do i have any other alternate tool that i can use with visual studio Express 2010 edition.</p>

<p>Sameer,</p>
","<visual-studio-2010><refactoring>","1","922","2011-02-20 17:38:24"
"5059351","Refactoring Practice/Workbook","<p>I recently saw the <a href=""http://rads.stackoverflow.com/amzn/click/0321109295"" rel=""nofollow"">Refactoring Workbook</a> while I was cruising Amazon the other day. I haven't actually gotten to read it yet, but it presents an interesting idea. The most enticing part of a ""workbook"" is that we can finally have every day practice for dealing with tough problems in a systematic way.</p>

<p>Onto the question. Does such a resource exist online or in other books? I know someone is going to suggest Open Source, but some of those projects require understanding of a huge context. I'm looking for something I can pick up, read a few pages, and refactor. Consistently.</p>

<p>As a side note, if such a resource doesn't exist online - it'd be a <em>gold mine</em> of an idea.</p>
","<books><refactoring>","1","73","2011-02-20 19:14:55"
"5063849","Rails: fetch records at once for has_many and has_many :through associations","<p>Given the following models:</p>

<p><strong>User</strong></p>

<pre><code>class User &lt; ActiveRecord::Base
  has_many :given_loans,    :class_name =&gt; ""Loan"", :foreign_key =&gt; ""lender_id""
  has_many :received_loans, :class_name =&gt; ""Loan"", :foreign_key =&gt; ""borrower_id""
  has_many :borrowed_books, :class_name =&gt; ""Book"", :foreign_key =&gt; ""borrower_id"", :through =&gt; :received_loans
  has_many :own_books,      :class_name =&gt; ""Book"", :foreign_key =&gt; ""owner_id""
end
</code></pre>

<p><strong>Book</strong></p>

<pre><code>class Book &lt; ActiveRecord::Base
  belongs_to :owner,     :class_name =&gt; ""User"", :foreign_key =&gt; ""owner_id""
  has_many   :loans,     :foreign_key =&gt; ""borrowed_book_id""
  has_many   :borrowers, :through =&gt; ""loans"",   :foreign_key =&gt; ""borrowed_book_id""
end
</code></pre>

<p><strong>Loan</strong></p>

<pre><code>class Loan &lt; ActiveRecord::Base
  belongs_to :borrowed_book, :class_name =&gt; ""Book"", :foreign_key =&gt; ""borrowed_book_id""
  belongs_to :borrower,      :class_name =&gt; ""User"", :foreign_key =&gt; ""borrower_id""
  belongs_to :lender,        :class_name =&gt; ""User"", :foreign_key =&gt; ""lender_id""
end
</code></pre>

<p>These relationships seem to work fine. </p>

<p>Now I'd like to query all books for a user, including both the borrowed books and the owned books, which I'm currently doing like this:</p>

<pre><code>def books
  own_books + borrowed_books
end
</code></pre>

<p>This method naturally causes two SQL queries, though:</p>

<pre><code>Book Load (0.4ms)  SELECT ""books"".* FROM ""books"" WHERE (""books"".owner_id = 1)
Book Load (0.3ms)  SELECT ""books"".* FROM ""books"" INNER JOIN ""loans"" ON ""books"".id = ""loans"".borrowed_book_id WHERE ((""loans"".borrower_id = 1))
</code></pre>

<p>Furthermore I'm not able to run active record methods such as <code>limit</code> or order against this selection, which would be nice to have. After all I'm fetching the books from the same table.</p>

<p><em>I'm assuming that there's a better (more ""Rails'"") and more efficient way of doing this. Anyone care to point me into the right direction</em>? Cheers!</p>

<hr>

<p>P.S.: A possible solution that came to mind was to define a query for a <code>has_many :books</code> relationship, but that didn't seem quite right either.</p>
","<ruby-on-rails><query><refactoring><associations>","0","287","2011-02-21 08:44:22"
"5067609","Java: Convenient way to refactor the application","<p>We have an agile enterprise application built on JSP and Servlet without any design strategy. </p>

<p>This application was built in early 2002 considering 1000 users. After 2002, we received lots of requests from the marketing partners.  </p>

<p>Currently, the application has lots of spaghetti code with lots of Ifs and elses. One class has more than 20,000 lines of code with a huge body of functions without abstraction.</p>

<p>Now, we need to support billions of records, 
what we need to do immediately and gradually?</p>

<p>We have to refactor the application? 
Which framework, we need to use?
How the usage of the framework will be helpful to the end users?
How to convince the leaders to do the refactoring?
How to gain the faster response time as compare to the current system?</p>
","<java><jsp><servlets><java-ee><refactoring>","-1","122","2011-02-21 15:11:52"
"5068100","How to factorise python test cases with nosetests","<p>I have several functions on graph f(), g() and h() that implements different algorithms for the same problem. I would like to unit-test these functions using unittest framework.</p>

<p>For each algorithm, several constraints should always be valid (such as empty graph, graph with only one node, and so on). The code for those common constraints checking should not be duplicated. So, the test architecture I started to design was the following:</p>

<pre><code>class AbstractTest(TestCase):
  def test_empty(self):
      result = self.function(make_empty_graph())
      assertTrue(result....) # etc..
  def test_single_node(self):
      ...
</code></pre>

<p>Then the specific test cases</p>

<pre><code>class TestF(AbstractTest):
  def setup(self):
      self.function = f
  def test_random(self):
      #specific test for algorithm 'f'

class TestG(AbstractTest):
  def setup(self):
      self.function = g
  def test_complete_graph(self):
      #specific test for algorithm 'g'
</code></pre>

<p>... And so on for each algorithm</p>

<p>Unfortunately,  nosetests, tries to execute each test in AbstractTest and it does not work since the actual self.function is specified in subclasses. I tried setting <code>__test__ = False</code> in the AbstractTest Case, but in this case, no test is executed at all (since this field is inherited I suppose). I tried with abstract base class (abc.ABCMeta) without success. I have read about MixIn without any result (I am not really confident with it).</p>

<p>I am quite confident I am not the only one that try to factorize the test code. How do you do that in Python? </p>

<p>Thanks.</p>
","<python><unit-testing><oop><refactoring><nosetests>","2","288","2011-02-21 15:55:56"
"5073589","Refactor linq statement","<p>I have a linq expression that I've been playing with in LINQPad and I would like to refactor the expression to replace all the tests for <code>idx == -1</code> with a single test. The input data for this is the result of a free text search on a database used for caching Active Directory info. The search returns a list of display names and associated summary data from the matching database rows. I want to extract from that list the display name and the matching Active Directory entry. Sometimes the match will only occur on the display name so there may be no further context. In the example below, the string ""Sausage"" is intended to be the search term that returned the two items in the <em>matches</em> array. Clearly this wouldn't be the case for a real search because there is no match for <em>Sausage</em> in the second array item.</p>

<pre><code>var matches = new [] 
{
    new { displayName = ""Sausage Roll"", summary = ""|Title: Network Coordinator|Location: Best Avoided|Department: Coordination|Email: Sausage.Roll@somewhere.com|"" },
    new { displayName = ""Hamburger Pattie"",  summary = ""|Title: Network Development Engineer|Location: |Department: Planning|Email: Hamburger.Pattie@somewhere.com|"" },
};

var context = (from match in matches
                let summary = match.summary
                let idx = summary.IndexOf(""Sausage"")
                let start = idx == -1 ? 0 : summary.LastIndexOf('|', idx) + 1
                let stop = idx == -1 ? 0 : summary.IndexOf('|', idx)
                let ctx = idx == -1 ? """" : string.Format(""...{0}..."", summary.Substring(start, stop - start))
                select new { displayName = match.displayName, summary = ctx, })
                .Dump();
</code></pre>

<p>I'm trying to create a list of names and some context for the search results if any exists. The output below is indicative of what <em>Dump()</em> displays and is the correct result:</p>

<pre><code>displayName        summary 
----------------   ------------------------------------------
Sausage Roll       ...Email: Sausage.Roll@somewhere.com...
Hamburger Pattie
</code></pre>

<p>Edit: Regex version is below, definitely tidier:</p>

<pre><code>Regex reg = new Regex(@""\|((?:[^|]*)Sausage[^|]*)\|"");      
var context = (from match in matches
                let m = reg.Match(match.summary)
                let ctx = m.Success ? string.Format(""...{0}..."", m.Groups[1].Value) : """"
                select new { displayName = match.displayName, context = ctx, })
                .Dump();
</code></pre>
","<c#><linq><refactoring>","1","175","2011-02-22 03:03:18"
"5076035","Alternative Pattern to Strategy","<p>I have a piece of code where I started to put the strategy pattern in place, say as follows:</p>

<pre><code>IStrategy
StrategyA : IStrategy
StrategyB : IStrategy
StrategyC : IStrategy
</code></pre>

<p>The interface just has a Calculate method on it. After implementing, it turned out that all 3 concrete types had identical code for the Calculate method and two identically named Properties, just with different values set.</p>

<p>So to remove duplication I made the interface an abstract class and moved the method and properties down to that, just setting the base properties with their respective values from within construction of the concrete types.</p>

<p>Now I know patterns aren't hard and fast rules, merely guidelines, but I've warped this so far from the guidelines that I can't help but think there's another pattern I should be looking at?</p>

<p>Can anyone suggest any other approaches please, that leave me so it would be easy to add on new 'Strategies' down the line. It may turn out that we need to alter the logic in some of these new cases, so how could I structure that so I don't have repeating code, but have a flexible design that lets me alter things down the line?</p>

<p>Thanks.</p>
","<design><design-patterns><refactoring><strategy-pattern>","2","231","2011-02-22 09:00:19"
"5080230","Temporarily Facading asmx Web Service With WCF Service","<p>I have an application that is an asmx web service written in .NET 2.0 with some business logic and a repository sitting underneath it.</p>

<p>The plan is that this web service will serve as the API for applications that want the data that it saves and retrieves.</p>

<p>Longer term, I know that the web service is likely to be replaced by a WCF service when the .NET 2.0 code base is refactored and becomes a .NET 4 codebase.</p>

<p>In order to reduce the impact on consumers of the API, I am considering whether it is a good idea to drop a WCF service as a facade over the asmx service. This will remain in place while the .NET 2.0 code is refactored. When there is no .NET 2.0 code left, the asmx service will disappear and the WCF service will talk to the business logic without an asmx service in the way.</p>

<p>My questions are</p>

<p>What kind of performance overhead will this cause?</p>

<p>Is there a better solution to this problem?</p>
","<.net><wcf><web-services><refactoring>","3","125","2011-02-22 15:36:01"
"5082723","C++: Code from the beginning of my project of significantly lesser quality","<p>I've started a rather large 2D game engine project a few months ago, and I began noticing:</p>

<p>The code from the first one or two months is quite different to the more recent one:</p>

<ul>
<li>The naming of variables feels a bit different</li>
<li>Some code style aspects are different</li>
<li>I'm sometimes wondering why I named some function that way, and can easily think of a better name</li>
<li>The code feels rather messy</li>
<li><p>There are parts where almost instantly a better way of doing it comes to my mind</p></li>
<li><p>The code seems as if its quality was significantly lower</p></li>
</ul>

<p>However, at the time I wrote it, I was watching out to do everything right the same way as I do now.</p>

<p>Now, for my questions:</p>

<ul>
<li><p>Is this a common situation, even in large commercial-style projects?</p></li>
<li><p>Should I consider investing (a lot of) time in refactoring and maybe even rewriting the affected code?</p></li>
<li><p>Is it normal that as a project grows and changes, large parts of code have to be refactored or rewritten from ground up? Is this bad?</p></li>
</ul>
","<c++><game-development><refactoring><project-management>","14","360","2011-02-22 19:13:09"
"5084558","Extending Active Record to reduce redundancy","<p>Suppose I have two classes in a Rails application:</p>

<pre><code>class Subject &lt; ActiveRecord::Base  
  def children?
    Subject.where(:parent_id =&gt; self.id).length &gt; 0
  end

 def children
   Subject.where(:parent_id =&gt; self.id)
 end 
end


class Region &lt; ActiveRecord::Base  
  def children?
    Region.where(:parent_id =&gt; self.id).length &gt; 0
  end

 def children
   Region.where(:parent_id =&gt; self.id)
 end 
end
</code></pre>

<p>What would be the best way to reduce the redundant class methods? Would I extend ActiveRecord with two new methods? If so, how could I write those two new methods to be available for both classes?</p>

<p>Thanks,
Mike</p>
","<ruby-on-rails><ruby><refactoring>","2","126","2011-02-22 22:06:00"
"5086896","C++ Different constant member in each derived class, how to move function to remove duplication in access?","<p>I have derived classes that differ in some constant attribute.  In all derived classes, I have a function that returns attribute.  Is there a way to move the get_x function into the base class to remove the duplication?  I have looked in this thread and a lot of google searches but I couldn't find exactly what I want:
<a href=""http://stackoverflow.com/questions/2682063/c-initializing-base-class-constant-static-variable-with-different-value-in-de"">C++ : Initializing base class constant static variable with different value in derived class ?</a></p>

<pre><code>class Derived1: public Base{
    static const attribute x = SOME_ATTRIBUTE1;
    attribute get_x(){
        return x;
    }
};

class Derived2: public Base{
    static const attribute x = SOME_ATTRIBUTE2;
    attribute get_x(){
        return x;
    }
};
</code></pre>

<p>I would hope that it would look something like this, but this doesn't work because x isn't defined in base.  I've also tried extern, static const attribute x, etc.</p>

<pre><code>class Derived1: public Base{
    static const attribute x = SOME_ATTRIBUTE1;
};

class Derived2: public Base{
    static const attribute x = SOME_ATTRIBUTE2;
};

class Base{
    attribute get_x(){
        return x;
    }
};
</code></pre>

<p>Thanks.</p>
","<c++><inheritance><static><refactoring><code-duplication>","1","489","2011-02-23 04:08:42"
"5092284","Android project Refactor greyed out","<p>I renamed a project in Eclipse via 'Refactor > Rename' as suggested in <a href=""http://stackoverflow.com/questions/3845913/easy-way-to-rename-a-project-in-android/3846417#3846417"">this answer</a>.</p>

<p>I now want to rename it again, but the Refactor menu has <em>only one</em> menu item now (Android > Extract Android String...) which is also greyed out!</p>

<p>I am using Eclipse 3.6.1 with the latest Android SDK 9.</p>

<p>Why is that and how to I restore this to normal?</p>

<p><strong>Update (1):</strong> After following Sankar Ganesh's suggestion (selecting a string), the Refactor menu appeared again. I then selected the Rename... menu item again and I received the following error message box:</p>

<p><img src=""http://i.stack.imgur.com/c87ng.png"" alt=""enter image description here""></p>

<p>This is much better than the previous situation, in which I had no idea why the Refactor menu had been disabled and what to do. Still, I don't understand why this is and what rules I should follow when using the Refactor function. I only wanted to rename a project... that's all. :)</p>

<p><strong>Update (2):</strong> I just tried the same exact operation again again (Refactor > Rename while the project is selected in Project Explorer) and it worked! (without issuing the message box shown above).</p>

<p>What's going on?</p>

<p>Must be a bug, because this is clearly <em>inconsistent</em>.</p>
","<android><eclipse><refactoring><eclipse-plugin>","1","521","2011-02-23 14:36:29"
"5094630","How to simplify or dry syntax of this jquery code","<p>I'm doing the same selection on a whole bunch of radio button groups. The only thing that changes is the <code>name</code>. </p>

<pre><code>var fcolor = $(this).closest('.branch').find('input[name=""fcolor""]:checked').val();
var bcolor = $(this).closest('.branch').find('input[name=""bcolor""]:checked').val();
var sidec = $(this).closest('.branch').find('input[name=""sidec""]:checked').val();
var linec = $(this).closest('.branch').find('input[name=""linec""]:checked').val();
</code></pre>

<p>How do I simplify this code so I'm not repeating code like this?</p>
","<javascript><jquery><refactoring>","2","134","2011-02-23 17:37:24"
"5110379","Tools for refactoring?","<p>I use netbeans on my work and find that some things are hard to do refactoring. What tools do you recommend for me?</p>
","<java><netbeans><refactoring><refactor-my-code><automated-refactoring>","1","206","2011-02-24 20:56:56"
"5113578","Common method for populating different Objects similar structure","<p>I have two objects CreateDocumentHeader and RetrieveDocumentHeader which have very similar structure. I'm reading each of the object and populating a DTO.  I don't want to create different methods for each object. How can I write a single method for populating them. Here are the two classes.</p>

<pre><code>public class CreateDocumentHeaderType {
    protected CreateAdminRecordType administrativeRecord;
    protected CreateControlRecordType controlRecord;
    public CreateAdminRecordType getAdministrativeRecord() {
        return administrativeRecord;
    }
    public void setAdministrativeRecord(CreateAdminRecordType value) {
        this.administrativeRecord = value;
    }
    public CreateControlRecordType getControlRecord() {
        return controlRecord;
    }
    public void setControlRecord(CreateControlRecordType value) {
        this.controlRecord = value;
    }
}

public class RetrieveDocumentHeaderType {
    protected RetrieveAdminRecordType administrativeRecord;
    protected RetrieveControlRecordType controlRecord;
    public RetrieveAdminRecordType getAdministrativeRecord() {
        return administrativeRecord;
    }
    public void setAdministrativeRecord(RetrieveAdminRecordType value) {
        this.administrativeRecord = value;
    }
    public RetrieveControlRecordType getControlRecord() {
        return controlRecord;
    }
    public void setControlRecord(RetrieveControlRecordType value) {
        this.controlRecord = value;
    }
}
</code></pre>

<p>AdminstrativeRecord and ControlRecord for both the versions also have similar structures.</p>
","<java><refactoring>","1","78","2011-02-25 04:22:46"
"5114797","Re-factor of code in Rails 2.3 Application","<p>I have a fairly simple Rails application that allows users to manage their clients and create a case for each client. When a case is created the details are sent to two email addresses (different content in each email) and using a gem, sends the information to <em><code>FreeagentCentral</code></em>.</p>

<p>I have implemented <em><code>delayed_job</code></em> which is working well for the <em><code>Freeagent API</code></em> call, but I think there is probably a better, lower overhead, method of sending the emails. It seems to take quite a while.</p>

<p>I currently have the following code in my Rails 2.3 application. </p>

<p><strong>kases_controller.rb</strong></p>

<pre><code># POST /kases
# POST /kases.xml
  def create
    @company = Company.find(params[:kase][:company_id])
    @kase = @company.kases.new(params[:kase])

    if @kase.save
        UserMailer.deliver_makeakase(""dropbox@1223111.domain.highrisehq.com"", ""Highrise"", @kase) if params[:sendtohighrise]
        UserMailer.deliver_makeakaseteam(""surveymanager@domain.co.uk"", ""Highrise"", @kase) if params[:notify_team_of_creation]
        @kase.delay.create_freeagent_project(current_user) if params[:send_to_freeagent]

        redirect_to(@kase)

        #flash[:notice] = 'Case was successfully created.'
        flash[:notice] = fading_flash_message(""Case was successfully created."", 5)
      else
        render :new
      end        
  end
</code></pre>

<p><strong>user_mailer.rb</strong></p>

<pre><code>def makeakase(email, name, kase, bccemails = [])
      recipients email
      from ""info@domain.co.uk""
      subject ""FW: Case creation from Survey Manager""
      bcc bccemails
      sent_on Time.now
      body :name =&gt; name, :kase =&gt; kase
  end

  def makeakaseteam(email, name, kase = [])
      recipients email
      from ""info@domain.co.uk""
      subject ""A new case has been created.""
      sent_on Time.now
      body :name =&gt; name, :kase =&gt; kase
      content_type ""text/html""
  end
</code></pre>

<p>I am looking for any advice on slimming down the number of emails sent, or a way of adding the emails to the delayed jobs.</p>

<p>I use PostmarkApp for sending the emails, which is another gem. Details of which can be found here: <a href=""https://github.com/wildbit/postmark-gem"" rel=""nofollow"">postmark-gem</a></p>
","<ruby-on-rails><email><refactoring><controller>","0","65","2011-02-25 07:43:27"
"5121458","Xcode -- mass renaming of classes","<p>I want to rename about 100 classes in my Xcode project.  It would be painful to change every filename, then do a search and replace on the name of each class in question.</p>

<p>Is there a better way?</p>

<p>The change in question involves changing a prefix -- think of what Apple would need to do if they decided to rename all the classes in their ""NS"" framework to start with ""MS"".  Unfortunately, the two caps in question do start some words in the project which are not among the class names in question.</p>
","<xcode><refactoring><rename>","1","534","2011-02-25 19:03:23"
"5130060","C++: Most class functionality lies in header files","<p>I have noticed that in my projects, class headers tend to grow while the respective source files almost stay the same size.</p>

<p>Actually, I have most methods implemented <code>inline</code> in the class header. It's the mass of simple getters / setters or other functions with 2-3 lines only which I want to keep at the class definition.</p>

<ul>
<li>Is the concentration of method implementations in the class header a bad habit? If yes, why? Should I think about refactoring?</li>
</ul>
","<c++><design-patterns><refactoring><code-smell>","2","172","2011-02-26 22:05:32"
"5130592","refactoring will_paginate attributes in a controller query","<p>Hey. I am using the following line over and over in my controller index queries. Does it makes sense to create a new application method to re-use it? Any suggestions on how I could extract this and perhaps pass the <code>:per_page</code> attribute a variable parameter? </p>

<pre><code>paginate :page =&gt; params[:page], :per_page =&gt; 12
</code></pre>

<p>Thanks for your time!</p>
","<ruby-on-rails><ruby-on-rails-3><refactoring><helper>","0","137","2011-02-27 00:09:33"
"5134711","Eclipse: add import to a bunch of classes","<p>I have 60 or so Java classes in an Eclipse project that I am reorganizing (everything was in the default package, ick!) that need to import another package in the project (newly created by other refactoring).</p>

<p>I would rather not do a <code>Ctrl+Shift+O</code> on every file. Is there someway I can speed this up?</p>
","<java><eclipse><refactoring>","5","134","2011-02-27 17:32:42"
"5135051","refactoring ruby method","<p>this is a simple question...</p>

<p>Does this method can be refactored?</p>

<pre><code>def sum
  total = 0
  [1,2,3,4].each do |num|
    total += num
  end
  total
end
</code></pre>

<p>thanks for your help!</p>
","<ruby><loops><refactoring>","1","136","2011-02-27 18:36:59"
"5138371","I've created a disaster. Please point out a coding strategy to refactor this","<p><strong>UPDATE</strong></p>

<p>So far I've cut it down significantly:</p>

<pre><code>  # Gets the user's Wall
  # I used object methods so they can be called by other methods, such as #second_wall()
  def read_wall(fbuserid)
     @result ||= graph.get_connections(fbuserid, 'feed')
  end

  def second_wall(fbuserid)
     @second ||= @result.next_page
  end

  def third_wall(fbuserid)
     @third ||= @second.next_page
  end

  def fourth_wall(fbuserid)
       fourth ||= @third.next_page
   end

  # Collects your friends' wall Posts and puts the IDs into an array
  # the number array contains method names that will be called
  # This is done to read 100 wall posts
  def get_post_ids(fbuserid)
     var = []   
     number = [read_wall(fbuserid), second_wall(fbuserid), third_wall(fbuserid), fourth_wall(fbuserid)]
     number.each do |iterate|
        num ||= iterate
        for i in 0..25
           if find_nil(num, [i,'id']).nil? == false
              var &lt;&lt; num[i]['id']
           end
        end
     end
</code></pre>

<p>Originally, I had everything in the base method #read_wall(). I'm not sure what happened with the array, but when I tried:</p>

<p><code>array = result + second + third + fourth</code>. I was left with data from only the original result. So I created this working disaster. <strong>Can you please help me refactor this?</strong></p>

<pre><code>   # Gets the user's Wall
      def read_wall(fbuserid)
         result ||= graph.get_connections(fbuserid, 'feed')
      end

  def second_wall(fbuserid)
     result ||= graph.get_connections(fbuserid, 'feed')
     second ||= result.next_page
  end

  def third_wall(fbuserid)
       result ||= graph.get_connections(fbuserid, 'feed')
       second ||= result.next_page
       third ||= second.next_page
  end

  def fourth_wall(fbuserid)
        result ||= graph.get_connections(fbuserid, 'feed')
        second ||= result.next_page
        third ||= second.next_page
        fourth ||= third.next_page
   end

  # Collects your friends' wall Posts and puts the IDs into an array
  def get_post_ids(fbuserid)
     x ||= read_wall(fbuserid)
     var = []
     for i in 0..25
        if find_nil(x, [i,'id']).nil? == false
           var &lt;&lt; x[i]['id']
        end
     end

     second_wall ||= second_wall(fbuserid)
       for i in 0..25
          if find_nil(second_wall, [i,'id']).nil? == false
             var &lt;&lt; second_wall[i]['id']
          end
       end

      third_wall ||= third_wall(fbuserid)
        for i in 0..25
           if find_nil(third_wall, [i,'id']).nil? == false
              var &lt;&lt; third_wall[i]['id']
           end
        end

      fourth_wall ||= fourth_wall(fbuserid)
         for i in 0..25
            if find_nil(fourth_wall, [i,'id']).nil? == false
                 var &lt;&lt; fourth_wall[i]['id']
            end
         end

      @get_post_ids = var
  end
</code></pre>
","<ruby><refactoring>","1","91","2011-02-28 05:01:35"
"5140260","Alternative descriptions for 'refactoring' that make a manager happy?","<p>My boss does not ever want to hear the word <em>refactoring</em> again, because whenever he asks a person what he is working, they reply ""<em>I'm refactoring!</em>""</p>

<p>I need to find alternative descriptions for refactoring that can make a manager happy. Thesaurus.com does not find anything for refactoring, any ideas what I should tell him when he asks what I am doing?</p>
","<refactoring><project-management><manager>","2","96","2011-02-28 09:38:51"
"5143970","Changing entity-classes problem with development for app-engine","<p>My problem is pretty much obvious: </p>

<ol>
<li>I had a class named <code>TaskDescription</code> which corresponded to a kind (table) in App Engine Datastore. 
Then I've renamed it to <code>TaskContent</code> and all stored data is seems to be lost now (because class name which is the so-called <code>kind</code> name is a part of the path to the stored data).</li>
<li>I realize that almost the same problem will occur every time I rename a single field in any entity-class. </li>
</ol>

<p>Nothing is perfect in this world and I have doubts that it's possible to create all and absolutely correct entities from scratch and never change them after that.</p>

<p>So, how to deal with this issue? </p>
","<java><google-app-engine><refactoring><nosql><datastore>","1","113","2011-02-28 15:31:21"
"5154714","Automatic way to put all classes in separate files","<p>I've started to refactor/clean up big project. Some of files contains few small classes or few enums (yeah, it is very messy;/ ).<br>
 Is there some method or tool to automatically divide files with few enums/classes and create separate files for each of them?</p>

<p>As Fredrik Mörk said - Resharper is very good tool and has possibility to do what I need. But of course as almost all good tools it costs (for one it is cheap, for another not:) ).  </p>

<p>Maybe there is some free tool for such simple refactoring? (my boss will not pay for Resharper - he told me that I need 'hammer' not a whole workshop:) )</p>
","<c#><visual-studio-2008><tools><refactoring>","3","167","2011-03-01 12:48:23"
"5158570","Refactoring: Making a game engine more modular and how","<p>My game engine consists of a range of loosely coupled modules, which can be loaded and unloaded. </p>

<p>Some examples are: The base module, handling window management and responding to OS events, entity manager, Lua manager, physics manager.</p>

<p>Right now, these modules are organized as namespaces, and their state is defined through local variables in the respective source files. Each of the namespaces has an Open(), Close() and Update() function.</p>

<p>Now, I don't really like the solution with <strong>namespaces</strong> anymore.</p>

<ul>
<li><p>It's not flexible enough</p></li>
<li><p>Even if it might not be needed in reality, having the plain ability of creating multiple instances of a module seems proper</p></li>
<li><p>It seems like I'm not making use of OOP here - a module base class with a virtual Update() member function would sound more reasonable</p></li>
<li><p>It's harder to ensure that when the module is closed and reopened, all of the variables will be reset too (A class with constructors and destructors would be easier)</p></li>
<li><p>You can't properly have the modules managed without explicitly calling Open(), Close() and Update()</p></li>
</ul>

<p>So, my idea would have been to use <strong>classes</strong> for each of the modules, derived from a module base class. The module class instances would be handled by the ModuleManager class, which  updates them.</p>

<p>But the solution with OOP brings up the problem of how the modules should communicate. Right now, the base module told the console module to print something via <code>console::print()</code></p>

<ul>
<li><p>How can I work around this problem without having to use something like <code>g_ModuleManager.GetConsoleModule()-&gt;print()</code>?</p></li>
<li><p>How could this module manager work in detail?</p></li>
</ul>

<p>And my final question:</p>

<ul>
<li><p>Do you have any further tips for me on the topic of writing a modular game engine in C++ with OOP?</p></li>
<li><p>Are there any design patterns that could help me in this situation, or maybe even concrete reading material?</p></li>
</ul>
","<c++><game-development><refactoring><module><modularity>","7","314","2011-03-01 18:14:42"
"5169233","How to group extension methods?","<p>I have a static class with bunch of extension methods for various types. Is there any utility or the way to split it into several classes - separate class for the each target type.  </p>
","<c#><.net><refactoring><extension-methods>","3","151","2011-03-02 14:54:19"
"5175523","is there a way to predict what to refactor as assembly to achieve biggest boost to .NET compiler build performance?","<p>suppose build time for a project is taking a long time. So, I want to plan a refactoring project to make some parts of it as separate assembly to avoid recompilation. Now, there are many things that I could try refactoring, so it would be nice to identify those modules that would give me the most build time reduction bang for the effort.</p>

<p>So how do I do that? Can I make predictions based on crude human-countable metrics like number of lines or methods? Or can I use some sort of profiler for compiler that would measure compiler's speed at handling various modules or even make oracular pronouncements/recommendations about which modules are most asking for refactoring?</p>
","<.net><compiler><refactoring><build-process><profiler>","0","41","2011-03-03 01:14:41"
"5166927","Retrieving values of the fields which have specified type","<p>I have the following code which is a private method inside the form and retrieve all context menus from the form. I feel, that it is not that concise as it should be. Would be grateful for any suggestions.</p>

<pre><code>  private IEnumerable&lt;ContextMenuStrip&gt; GetContextMenus()
    {
        var type = this.GetType();
        var fields = type.GetFields(BindingFlags.NonPublic | BindingFlags.Instance);
        var contextMenus = fields.Where(f =&gt; f.GetValue(this).GetType() == typeof(ContextMenuStrip));
        var menus = contextMenus.Select(f=&gt; f.GetValue(this));
        return menus.Cast&lt;ContextMenuStrip&gt;();        
    }
</code></pre>
","<c#><.net><winforms><reflection><refactoring>","1","119","2011-03-02 11:39:12"
"5177512","Any tool can help refactor field into get/set pairs of method","<p>Wondering if there is tool to assist this kind of refactoring.</p>
","<java><refactoring><automated-refactoring>","1","326","2011-03-03 06:38:14"
"5179590","Are there any valid circumstances where foo=foo makes sense?","<p>Cleaning a handful of warnings on a <code>C#</code> project I have inherited, I found this code snippet:</p>

<pre><code>private bool _WriteValue(object FieldValue,..,..)
  ...
  if(MultipFactor!=1)
     FieldValue=((double)FieldValue)*MultipFactor;
  else
    FieldValue=FieldValue;
</code></pre>

<p>I've obviously burninated the <code>else</code> block without thinking too much, just wondering why the previous programmer has left that part. </p>

<ul>
<li>Was it just too lazy to delete it?  </li>
<li>Was it a courtesy for some future programmers to save some typing in case of specific changes?   </li>
<li>Is it hiding something dangerous?</li>
</ul>

<p>In your opinion, are there any valid circumstances where <code>foo=foo</code> makes sense?</p>

<hr>

<p>Some more details on the <code>_WriteValue</code> method:</p>

<p>The <code>_WriteValue</code> method is wrapped into different overloaded <code>WriteValue</code> methods that pass to the <code>object FieldValue</code> parameter, values of the following types: <code>int</code>, <code>long</code>, <code>string</code> and <code>Datetime</code>.</p>
","<c#><refactoring><legacy>","4","116","2011-03-03 10:38:18"
"5184583","Eliminating my explicit state passing via like, monads and stuff","<p>I'm working through the book <em>Land of Lisp</em> in F# (yeah weird, I know). For their first example text adventure, they make use of global variable mutation and I'd like to avoid it. My monad-fu is weak, so right now I'm doing ugly state passing like this:</p>

<pre><code>let pickUp player thing (objects: Map&lt;Location, Thing list&gt;) =
    let objs = objects.[player.Location]
    let attempt = objs |&gt; List.partition (fun o -&gt; o.Name = thing)
    match attempt with
    | [], _ -&gt; ""You cannot get that."", player, objs
    | thing :: _, things -&gt;
        let player' = { player with Objects = thing :: player.Objects }
        let msg = sprintf ""You are now carrying %s %s"" thing.Article thing.Name
        msg, player', things

let player = { Location = Room; Objects = [] }   

let objects =
    [Room, [{ Name = ""whiskey""; Article = ""some"" }; { Name = ""bucket""; Article = ""a"" }];
    Garden, [{ Name = ""chain""; Article = ""a length of"" }]]
    |&gt; Map.ofList

let msg, p', o' = pickUp player ""bucket"" objects
// etc.
</code></pre>

<p>How can I factor out the explicit state to make it prettier? (Assume I have access to a State monad type if it helps; I know there is sample code for it in F# out there.)</p>
","<f#><refactoring><functional-programming><monads>","5","255","2011-03-03 18:00:18"
"5185480","How to refactor variable type in Eclipse?","<p>I want to refactor code like this:</p>

<pre><code>int x=4;
int y=x;
System.out.println(y);
</code></pre>

<p>How can i do this automatically in Eclipse so x's type promotion to long would cause dependent variables to change their types also:</p>

<pre><code>long x=4;
long y=x;
System.out.println(y);
</code></pre>

<p>?</p>
","<java><eclipse><refactoring>","7","1779","2011-03-03 19:25:26"
"5193926","Subversion refactor trunk and still be able to merge changes to old branches","<p>What are the best practices in the situation where you refactor trunk in svn but cannot apply the refactor to older branches, yet you still need to be able to svn merge bugfixes from trunk to the branches?</p>

<p>To ask the question more specifically (if it helps - if you can answer the above, then feel free to ignore):</p>

<p>We want to move to Maven going forward, but we still need to maintain old releases - they cannot be touched except with customer sanctioned changes and bugfixes.</p>

<p>So, we need to refactor our folder structures around in trunk to get it as per maven - src/main/java, src/main/webapp etc (its currently a WTP project - src, WebContent instead of above).</p>

<p>But then going forward, we still need to be able to svn merge to the older branches which will still be in the old folder structure.</p>

<p>Is this possible? What are the best practices?</p>

<p>I know we can apply changes to trunk, and then also apply the changes to the branch manually, but this will result in a lot of pain for developers which we want to avoid.</p>

<p>Apologies if this is already answered or is obvious (I would have thought it would be, I feel like I'm asking an obvious question!)</p>

<p>Thanks in advance,
Justin</p>
","<svn><refactoring><branch>","1","167","2011-03-04 12:49:21"
"5187049","How to refactor method of class with a lot of arguments?","<p>everyone I have a problem with the legacy code in ASP.NET MVC Application,
 in this code there is a class Service in business logic layer. This class has method with 20 arguments this method creates an instance of object using this 20 arguments.
How to refactor this code, because this is a problem when the created objects is changed and it is need to change the arguments in method. 
This service class is used in the controller class and in unit test.
Help me with refactor this code
Thanks in advance.</p>

<p><strong>EDIT</strong> Additional information:</p>

<p>I can show the signature of the method</p>

<pre><code>public Qualification CreateQualification(string achievableCode, string achievableTitle,
        string accreditationRef, bool brandingPrefix, long brand, float guidedLearningHours, 
        int creditValue, long level, long type, long gradingType, long area, int subArea,
        DateTime accreditationStartDate, DateTime accreditationEndDate,
        DateTime lastCertDate, string nameOnCert, 
        long organisationId)
</code></pre>

<p>I think it is need to apply Kely and Chevex aproach for example I can extract some classes</p>

<p>one will be from parameters:</p>

<pre><code> long area, int subArea
</code></pre>

<p>other</p>

<pre><code>bool brandingPrefix, long brand,
</code></pre>

<p>And after extract sub classes I can use Introduce Parameter Object I correct understood?</p>
","<c#><refactoring>","4","251","2011-03-03 21:53:12"
"5188127","Refactoring/renaming within comments in Visual C# Express","<p>When refactor->renaming MyMethod in the following example in Visual C# 2010 Express, the method name 'MyMethod' in the comment won't be changed. </p>

<p>Usually that a comment isn't touched by refactor/rename is for good reasons, since how should the IDE know that it's not just some word but actually references the very method that it is refactoring.</p>

<p>So is there a way in which a word in a comment can be bound to a class/method/variable name within Visual C# 2010 Express, so that it's changed as well during refactoring/renaming?</p>

<p>If there are several ways what would be the easiest/cheapest way?
(cheapest - in case of plugins or commercial versions) </p>

<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1
{
  /// text for class MyClass
  public class MyClass
  {
    /// &lt;summary&gt;&lt;c&gt;MyMethod&lt;/c&gt; is a method in the &lt;c&gt;MyClass&lt;/c&gt; class.
    /// &lt;/summary&gt;
    public static void MyMethod(int Int1)
    {
    }
    /// text for Main
    public static void Main()
    {
      Console.ReadLine();
    }
  }

}
</code></pre>
","<c#><visual-studio><refactoring><comments><rename>","-1","241","2011-03-03 23:54:21"
"5201666","How to refactor these three functions in to one?","<p>There is only a one line difference and was wondering if it was at all possible!</p>

<pre><code>function sortHot() {
    var order = [];

    $(""#container"").children("".submission-preview"").each(
        function() {
            var key = $(this).attr('id');

            var value = $(""div#"" + key.replace(""sub"", ""votes"")).html() * key.replace(""sub"", """");

            order.push([key, value]);
        }
    );

    return order;
}

function sortNew() {
    var order = [];

    $(""#container"").children("".submission-preview"").each(
        function() {
            var key = $(this).attr('id');

            var value = key.replace(""sub"", """");

            order.push([key, value]);
        }
    );

    return order;
}

function sortTop() {
    var order = [];

    $(""#container"").children("".submission-preview"").each(
        function() {
            var key = $(this).attr('id');

            var value = $(""div#"" + key.replace(""sub"", ""votes"")).html();

            order.push([key, value]);
        }
    );

    return order;
}
</code></pre>
","<javascript><jquery><refactoring>","2","78","2011-03-05 04:25:49"
"5203587","as3- passing a rectangle to sprite.graphics.drawRect( )","<p>Is there a neat minimal way of doing this? (this produces an error):</p>

<pre><code>var freeSpace = shape.freeSpace() // returns Rectangle

var s:Sprite = new Sprite();

s.graphics.drawRect(freeSpace);
</code></pre>

<p>Just looking for a more cleaner way other than something like <code>.drawRect(freeSpace.x, freeSpace.y, freeSpace.w, freeSpace.h)</code></p>

<p>I know you can do it with <code>bitmapData.fillRect(rectangle)</code>, but need sprites in this case.</p>
","<actionscript-3><graphics><refactoring>","0","597","2011-03-05 11:43:32"
"5212609","Avoiding boilerplate code in a one-to-one association relationship","<p>Although I'm programming in C++, this is more of a general question about design.</p>

<p>I noticed that when I have objects in a one-to-one association relationship, there tend to be a lot of common methods between them, leading to boilerplate code that essentially directly calls methods of the inner class.</p>

<p>As an example, I have a class called <code>Tab</code> that represents a tab and it's corresponding widget. I also have a class called <code>Tabbable</code> that objects can inherit, so they can be displayed in tabs. A <code>Tab</code> can then take this <code>Tabbable</code> object and render itself correctly. Both these classes have a lot of similar methods relating to the title or icon for example.</p>

<pre><code>class ITabbable {
    public:
    ITabbable();
    virtual ~ITabbable();

    virtual string getTitle() = 0;
    virtual widget getContentWidget() = 0;


    // etc...
}


class Tab {
    public:
    Tab(ITabbable* tabbableObject);


    // lots of boilerplate code:
    string getTitle() {
        return m_tabbableObject-&gt;getTitle();
    }

    widget getContentWidget() {
        return m_tabbableObject-&gt;getContentWidget();
    }

    // etc...

    private:
    ITabbable* m_tabbableObject; // association relationship
}
</code></pre>

<p>A lot of code is duplicated and seems unnecessary. Inheritance definitely doesn't work here because you can't put a <code>Tab</code> in <code>Tab</code>.</p>

<p>Is this just something we have to deal with? Or are there ways around these situations?</p>
","<c++><design><refactoring><coding-style><boilerplate>","0","161","2011-03-06 18:46:19"
"5213340","How to refactor this code block to be simple and dynamic?","<pre><code>$(document).ready(function() {
    $('.watermark').focus(function() {
        if (this.className == 'watermark')
        {
            this.className = '';
            this.value = '';
        }
    });

    $('.watermark').blur(function() {
        if (this.value == '')
        {
            this.className = 'watermark';
            this.value = 'Type here';
        }
    });
});
</code></pre>

<p>I have this block of code that works perfectly except that it is not dynamic. I was wondering if there was an elegant way to reset the value to the original dynamically. I was thinking that maybe if you defined the original text in its ID or some other sort of attribute you could reset it that way.. or maybe you could use variables or arrays or tuples. What does SO think is the best way of doing it?</p>
","<javascript><jquery><refactoring><watermark>","0","122","2011-03-06 20:55:56"
"5216689","Mark as deprecated third party class","<p>I have some third part library <em>Foo</em> with class <em>FooBar</em>. I think that class <em>FooBar</em> is bad designed. I want write my own <em>MyBar</em> as adapter pattern. Can I mark original <em>FooBar</em> as <code>@Deprecated</code> without code modifications?</p>
","<java><refactoring><third-party><deprecated>","1","262","2011-03-07 06:48:19"
"5228125","How do I make this more idiomatic?","<p>So here is a function I translated from another language (Lisp), mostly verbatim-ish. It doesn't smell quite right to me though, what with using <code>ref</code>, <code>if</code> without <code>else</code>, etc. How would you rewrite the second function below?</p>

<pre><code>let directEdges node edges =
    List.filter (fun (a, b) -&gt; a = node) edges

let getConnected node edges =
    let visited = ref Set.empty
    let rec traverse node =
        if not (Set.contains node !visited) then
            visited := Set.add node !visited
            directEdges node edges 
            |&gt; List.iter (fun (a, b) -&gt; traverse b)
    traverse node        
    !visited
</code></pre>

<p>Edit: There's also no requirement that the code even use a Set; the original just used a list.</p>
","<f#><refactoring><idiomatic>","1","128","2011-03-08 03:51:46"
"5233764","Refactoring and Decoupling Rails controllers: can they call eachother?","<p>I have the following situation in a Ruby on Rails app:</p>

<ul>
<li>user fills in a form (a comment), gets to see an omniauth page where she can choose the authentication method (openId, Twitter, Facebook and the likes).</li>
<li>omniauth is filled in, on success user returns, gets a session and the initial form data is processed (comment is published).</li>
</ul>

<p>I all works, except that I have my logic spread around in, what I consider, an ugly way; the <code>SessionsController</code> now creates the comment on successfull authentication. </p>

<p>What is a good way to decouple things like this? Should the <code>Comment</code> module hook into (listen to) the SessionsController? Or should the SessionsController simply call some methods on the <code>CommentsController</code> or <code>Comment</code> class to save a comment on successfull authentication? Are there any patterns that I can get myself familiar with, that solve these kind of issues?</p>
","<ruby-on-rails><refactoring><decoupling>","0","124","2011-03-08 14:24:27"
"5234309","How would I refactor this code to be more object-oriented?","<h2>UPDATE</h2>

<p>So I followed the advice of '<a href=""http://stackoverflow.com/questions/5234309/how-would-i-refactor-this-code-to-be-more-object-oriented/5234433#5234433"">justkt</a>' and '<a href=""http://stackoverflow.com/questions/5234309/how-would-i-refactor-this-code-to-be-more-object-oriented/5234495#5234495"">xtofl</a>' and made some huge changes to my code. I think this is a better design, but please still provide feedback and suggestions for improvements.</p>

<p>Firstly, I created some enumerations...</p>

<pre><code>var SymbolName = {
    alpha : 0,
    beta : 1,
    // ... etc...
};
Object.freeze(SymbolName);

var TypeOfSymbol = {
    GreekSymbol : 0,
    // ... etc...
};
Object.freeze(TypeOfSymbol);
</code></pre>

<p>... then I refactored my <code>Symbol</code> class by taking out all of the member variables I had previously and making it into an object that remembers 4 values per <code>Symbol</code>...</p>

<pre><code>function Symbol(name, id, value, type) {

    var name = name;
    var id = id;
    var value = value;
    var type = type;

    this.getName = function() {
        return name;
    };

    this.getID = function() {

        return id;
    };

    this.getValue = function() {

        return value;
    };

    this.getMathMLTag = function() {

        var tag;
        switch (Number(type)) {

            case TypeOfSymbol.GreekSymbol:

                tag = 'mi';
                break;

            default:

                tag = 'mo';
                break;
        }
        return tag; 
    };
};
</code></pre>

<p>Now, to create and access these <code>Symbol</code> objects, I created a <code>Symbols</code> object that has an array of all possible <code>Symbol</code> objects...</p>

<pre><code>function Symbols() {

    var theSymbols = new Array();

    // new Symbol(name, id, value, type)
    theSymbols[SymbolName.alpha] = new Symbol('alpha', 'symbol_' + SymbolName.alpha, '&amp;#x03B1;', TypeOfSymbol.GreekSymbol);
    // ... etc...

    this.getSymbol = function(symbolID) {

        return theSymbols[symbolID];
    };
};
</code></pre>

<p>So now everything is easy. I declare a variable <code>var symbols = new Symbols();</code> and if I want to get symbols, I can just do:</p>

<pre><code>symbols.getSymbol(SymbolName.alpha); // get the Symbol object
symbols.getSymbol(SymbolName.alpha).getValue(); // get the Symbol value
symbols.getSymbol(SymbolName.alpha).getID(); // get the Symbol ID
</code></pre>

<p>This easily allows me to create the <code>&lt;div&gt;</code>s for each <code>Symbol</code> easily:</p>

<pre><code>$.fn.AppendGreekSymbols = function() {
    var symbol;
    var mathTag;
    var openingTags;
    var closingTags;

    // lower-case Greek Alphabet
    var index = SymbolRanges.GreekSymbolsStartIndex;

    for (index; index &lt;= SymbolRanges.GreekSymbolsEndIndex; index++) {

        symbol = symbols.getSymbol(index);

        openingTags = '&lt;div id=\""' + symbol.getID() + '\"" class=\""symbol ' + symbol.getName() + '\""&gt;';
        mathTag = '&lt;math display=\""block\""&gt;&lt;' + symbol.getMathMLTag() + '&gt;';
        closingTags = '&lt;/' + symbol.getMathMLTag() + '&gt;&lt;/math&gt;&lt;/div&gt;';

        $('.greek-symbols').append(openingTags + mathTag + symbol.getValue() + closingTags);
    }
};
</code></pre>

<p>Also, I can define 1 click handler for all <code>Symbol</code> objects easily:</p>

<pre><code>$(function() {

    $('div.symbol').click(function() {

        var targetSymbolID = $(this).attr('id').split('_')[1];
        var symbol = symbols.getSymbol(targetSymbolID);
        $().InsertSymbol(symbol);
    });
});
</code></pre>

<p>... and that's it! Yay! I think this was a great change... I feel very proud of this refactoring process and the design I came up with. What do you guys think?</p>

<h2>Original Post</h2>

<p>I have a <code>Symbol</code> class that looks something like this:</p>

<pre><code>function Symbol() {
    // I need to define some functions in here  
};
Symbol.prototype.alpha = ""&amp;#x03B1;"";
Symbol.prototype.Alpha = ""A"";
Symbol.prototype.beta = ""&amp;#x03B2;"";
Symbol.prototype.Beta = ""B"";
Symbol.prototype.gamma = ""&amp;#x03B3;"";
Symbol.prototype.Gamma = ""&amp;#x0393;"";
Symbol.prototype.delta = ""&amp;#x03B4;"";
Symbol.prototype.Delta = ""&amp;#x0394;"";
... and so on for nearly 500 symbols...
</code></pre>

<p>Each symbol will individually be put in it's own <code>&lt;div class=""symbol alpha""&gt;</code> element, but <code>alpha</code> would be a class name corresponding to the symbol name... so there are other elements like this, such as <code>&lt;div class=""symbol beta""&gt;</code>, <code>&lt;div class=""symbol gamma""&gt;</code>, etc... So to do this, I would have a lot of repetitive code:</p>

<pre><code>var symbol = new Symbol();
$('.greek-symbols').append('&lt;div class=""symbol alpha""&gt;' + symbol.alpha + '&lt;/div&gt;');
$('.greek-symbols').append('&lt;div class=""symbol beta""&gt;' + symbol.beta + '&lt;/div&gt;');
$('.greek-symbols').append('&lt;div class=""symbol gamma""&gt;' + symbol.gamma + '&lt;/div&gt;');
... etc...
</code></pre>

<p>Now, what I want to do is set up a click event handler for each symbol and its corresponding <code>&lt;div&gt;</code> container. Again, I would have a lot of repetitive code, like so:</p>

<pre><code>$('div.symbol.alpha').click(function() {

    $().InsertSymbol(symbol.alpha);
});
$('div.symbol.beta').click(function() {

    $().InsertSymbol(symbol.beta);
});
... and so on...
</code></pre>

<p>I'm thinking there is a better way to do this. Ideally, I would like to have only one event handler that would parse out the symbol name from the class, look it up in the <code>Symbol</code> class, and do work that way. So...</p>

<pre><code>$('div.symbol').click(function() {

    // I know the following code doesn't correctly parse out the correct class,
    // I'll worry about that later, but the idea is clear
    var symbolName = $(this).attr('class'); // parse out the correct class, the symbol name
    $().InsertSymbol(Symbol.getSymbol(symbolName));
});
</code></pre>

<p>... and in the <code>Symbol</code> class, I would have this <code>getSymbol()</code> function that would take a name and look up the symbol and return the correct one. However, I'm not sure how to do this in JavaScript/jQuery. How would I set up this logic? I don't know if JavaScript has a HashMap class, like the way Java has, so what would be a good way to look up these symbols?</p>

<p>Let me know if I need to clarify further.</p>

<p><strong>p.s. I welcome any suggestions on sources/references for good object-oriented design</strong></p>
","<javascript><jquery><oop><refactoring>","1","191","2011-03-08 15:12:18"
"5229057","Best Practices for refactoring controls and functionality out of a XIB","<p>I have a regular custom <code>UIViewController</code> that loads a regular iPhone-screen-sized XIB. But I have a <code>subview</code> in the XIB that consists of a few components (<code>UILabel</code>, <code>UITextField</code>, <code>UIButton</code>) that I'd like to factor into a separate XIB, and move the logic controlling these components out of the <code>UIViewController</code>, possibly to a custom <code>UIView</code> object that would load the custom XIB.</p>

<p>I've searched Apple documentation without much luck, and searched for an answer here, but I can't seem to find a clean way of creating a custom <code>UIView</code>, instantiating it in a XIB, and dropping it into another XIB. Is there a clean way of moving this view into it's own XIB and the logic controlling it out of the custom <code>UIViewController</code>, so I can use it on multiple screens of my app?</p>

<p>(I'm not married to the idea of putting this functionality into a custom <code>UIView</code>, it just seemed like the obvious way of doing it to me. I'm open to any clean way of factoring this into it's own component.)</p>
","<iphone><uiview><refactoring><interface-builder><xib>","0","156","2011-03-08 06:19:06"
"5245432","Rails: Is it possible to write view helpers with HAML syntax?","<p>During refactoring it would be quite handy just to copy part of HAML template and paste it to helper's code. Currently in such cases 1) I have to rewrite that part of view from scratch 2) I have to use that verbose syntax like content_tag or haml_tag. </p>

<p>I know that it's possible to define partials with HAML systax that will serve as helper. Though 1) as for me it's inconvinient to create a separate file for each small tiny function 2) invocation syntax for partial is quite verbose.</p>

<p>Ideally i'd like my *_helper class to look like this:</p>

<pre><code>- def some_helper(*its_args)
  .some_class
    = some_ruby_expression
  %some_tag#some_id
    - another_expression do
      etc
</code></pre>

<p>or at least like this:</p>

<pre><code>define_haml_helper :some_helper, [:arg1, :arg2], %{
  .some_class
    = some_ruby_expression
  %some_tag#some_id
    - another_expression do
      etc
}
</code></pre>

<p>Is there a plugin that solves my issue?</p>

<p>Alternatively, maybe you can describe how do you refactor HAML snippets to reusable elements (helpers/functions/partials/builders/etc)?</p>
","<ruby-on-rails><mvc><refactoring><haml><view-helpers>","6","745","2011-03-09 11:58:38"
"5253105","Batch renaming to enforce some style compliance","<p>I have looked a little bit here and there to find a tool that inspect the code and do batch renaming to enforce some style compliance.</p>

<p>Some tools, like Checkstyle &amp; PMD, are fine to list all problems and are OK for most of my projects. But this week, I have to cleanup some ""legacy"" source code, with way too much renaming to do. </p>

<p>I was not able to find a tool that can provide some refactoring features like : ""add prefix to all parameters / private members / ... if not compliant""... Just to do the ""no-brain"" work.</p>

<p>Is there a way to do it in eclipse ? </p>

<p>(I have some old KSH scripts that can do the job, but I would like to know if there is a way to use eclipse to do the job.)</p>
","<java><eclipse><refactoring><naming-conventions><code-review>","5","190","2011-03-09 22:34:10"
"5253300","Resharper refactoring to remove magic strings","<p>Is there such a thing?  Either as a part of the product or a plugin?  I can't see to find it.</p>

<p>I want to go from:</p>

<pre><code>public DataTable Fetch() {
    return ExecuteDataTable(_ConnectionString, ""pr_DetectAffectedOrderLines"");
}
</code></pre>

<p>to:</p>

<pre><code>private const string SP_DETECT_AFFECTED_ORDER_LINES;

public DataTable Fetch() {
    return ExecuteDataTable(_ConnectionString, SP_DETECT_AFFECTED_ORDER_LINES);
}
</code></pre>
","<c#><refactoring><resharper>","1","308","2011-03-09 22:54:21"
"5257634","Recommendations for books on refactoring and API design","<p>I'm looking for some good books on refactoring and API design. I'm planning a framework based on jQuery for a large django app that needs major work. It doesn't really matter what language the book uses, as the concepts can surely be applied anywhere.</p>
","<language-agnostic><books><refactoring><software-engineering>","2","428","2011-03-10 09:23:40"
"5261687","Speed Up Parsing Algorithm","<p>I'm trying to parse some ddump files, could you please help me speed up my algorithm?<br>
It takes 216 ms for each loop!! that is way too much. I would like to have it around 40-50 ms per loop.   Maybe by using RegExp?</p>

<p>Here is my algrithm:</p>

<p><pre> while (pos &lt; EntireFile.Length &amp;&amp; (/*curr = */EntireFile.Substring(pos, EntireFile.Length - pos)).Contains("" class""))
            {
                w.Reset();
                w.Start();
                pos = EntireFile.ToLower().IndexOf("" class"", pos) + 6;
                int end11 = EntireFile.ToLower().IndexOf(""extends"", pos);
                if (end11 == -1)
                    end11 = EntireFile.IndexOf(""\r\n"", pos);
                else
                {
                    int end22 = EntireFile.IndexOf(""\r\n"", pos);
                    if (end22 &lt; end11)
                        end11 = end22;
                }
                //string opcods = EntireFile.Substring(pos, EntireFile.Length - pos);
                string Cname = EntireFile.Substring(pos, end11 - pos).Trim();
                pos += (end11 - pos) + 7;
                pos = EntireFile.IndexOf(""{"", pos) +1;</p>

<code>            int count = 1;
            string searching = EntireFile.Substring(pos, EntireFile.Length - pos);
            int searched = 0;
            while (count != 0)
            {
                if (searching[searched] == '{')
                    count++;
                else if (searching[searched] == '}')
                    count--;

                searched++;
            }
            string Content = EntireFile.Substring(pos, searched);
            tlist.Add(new TClass() { ClassName = Cname, Content = Content });
            pos += searched;

            if (pos % 3 == 0)
            {
                double prc = ((double)pos) * 100d / ((double)EntireFile.Length);
                int prcc = (int)Math.Round(prc);
                wnd.UpdateStatus(prcc);
                wnd.Update();
            }
            mils.Add((int)w.ElapsedMilliseconds);
        }
</code></pre>

<p></p>

<p>Any help would be greatly appreciated.</p>
","<c#><algorithm><parsing><refactoring><enhancement>","4","255","2011-03-10 15:14:39"
"5262803","How can I apply the ""move method"" refactoring with IntelliJ IDEA?","<p>I want to be able to move an instance method from one class to another class (""Move method"" from Fowler's ""Refactoring"") in IntelliJ IDEA. Unfortunately, when I try ""Move..."" (cmd: F6), it tells me that ""There are no methods that have a reference type. Would you like to make method  static and then move?"" I do not want to make my method static, I want it to be an instance method on the other class instead.</p>

<p>My code example:</p>

<pre><code>public class TheClass {

  public void doStuff(){
     int i = themethod();
  }

  private int theMethod() {
    System.out.println( ""Hello World!"" );
    return 0;
  }
}

public class OtherClass {

}
</code></pre>

<p>Say I want to move <code>theMethod</code> from <code>TheClass</code> to <code>OtherClass</code>. Is there an automatic refactoring in IDEA for this, and if so: How do I apply it?</p>
","<refactoring><intellij-idea><automatic>","2","233","2011-03-10 16:38:07"
"5263394","Simplifying multiple ifs dealing with flag enum","<p>I have some code like this:</p>

<pre><code>[Flags]
public enum someEnumFlag : long
...

if (someFlagEnum)
    if (!foo()) return;
if (someFlagEnum)
    if (!bar()) return;
// repeat similar lines...
</code></pre>

<p>For each <code>someFlagEnum</code>, some method is called and it returns a <code>bool</code>. If any of return values is <code>false</code>, the entire operation fails. Therefore <code>return</code>.</p>

<p>How can I simplify this? I want that ""premature return"" part intact, so I don't think <code>foreach</code> is viable here. (Correct me if I'm wrong)</p>

<p><strong>Note: This <code>someFlagEnum</code> is very large (20+ flags).</strong></p>

<p>Edited code. Yes, that enum is really <code>System.Enum</code>.</p>
","<c#><refactoring>","2","148","2011-03-10 17:27:26"
"5271034","Git: massive refactor keeping changes log","<p>Is it possible to do a massive refactor that involves moving and renaming many directories without losing Git change tracking?</p>
","<git><refactoring>","3","286","2011-03-11 09:19:42"
"5281487","C++ Factory using lua","<p>I had a script with:</p>

<ul>
<li>Custom language used only for data</li>
<li>Was loaded using a Script class from C++</li>
<li>I had tags like Type, etc</li>
<li>An interface to get a value for a tag - Script::GetValue(Tag, T&amp; value)</li>
</ul>

<p>The script was used like this:</p>

<pre><code>Script* script(""someFile"");
script->GetValue(""Type"", type);
Object* obj = CreateObject(type);
obj->Load(script);
</code></pre>

<p>Where Load functions from object was used to load the rest of obj parameters.
Now I changed the script language to lua. My questions is:</p>

<p>Should I keep this way of creating objects(use lua only for data) or should I expose the factory in lua and use it from lua, something like this(in lua):</p>

<pre><code>CreateObject(""someType"")
SetProperty(someObj, someProperty, someValue)
</code></pre>

<p>First of all I want to know which is faster, first or second approach. Do you have other suggestions? Because I'm refactoring this part I'm open to other suggestions. I want to keep lua because is fast, easy to integrate, and small.</p>
","<c++><refactoring><lua><factory>","2","199","2011-03-12 08:27:28"
"5282301","How to get a name of the element of the project?","<p>I am interested both in built-in feature or a workaround, it does not matter.</p>

<p>My problem is similar to the question ""how to get a name of the field/property of the object"" -- so you could not write </p>

<pre><code>  ""MyField"" 
</code></pre>

<p>anymore, but </p>

<pre><code>  NameOf(MyField)
</code></pre>

<p>Now, one level up -- and you have not a class, but a project, and not a field, but element of the project -- report, dataset, and so on. I would like to switch from writing:</p>

<pre><code>  LoadReport(""MyReport.rdlc"");
</code></pre>

<p>to </p>

<pre><code>  LoadReport(NameOf(Project.MyReport)+"".rdlc"");
</code></pre>

<p>Of course this is rough idea.</p>

<p>If you wonder why -- because when refactoring, I would like to have all names replaced automatically. </p>

<p><strong>The question is -- is this possible, and if yes -- how?</strong></p>

<h2>Edits</h2>

<ol>
<li>Please note refactoring is done in design-time, so getting the actual name can be done in runtime, but binding to it has to be done in design time, not in runtime (so pure reflection is ruled out).</li>
</ol>
","<c#><visual-studio-2010><refactoring>","0","121","2011-03-12 11:48:08"
"5288368","Advantages & Disadvantages of Dependency-Injecting Non-Instantiable Objects","<p>What, in your opinion, are the advantages and disadvantages of dependency-injecting non-instantiable objects in <strong>JavaScript</strong>?</p>

<p>Some context you may want to explore are: </p>

<ul>
<li><strong>Unit-testing</strong>
<ul>
<li>Is it worth dep-injecting it? After all, you can overwrite the non-instantiable ""static"" dependency to a fake object for each test even without dep-injection.</li>
</ul></li>
<li><strong>Refactoring</strong>
<ul>
<li>Will it become more difficult to locate &amp; refactor the non-instantiable dependency?</li>
</ul></li>
<li><strong>Readability</strong>
<ul>
<li>Which implementation is easier to follow? Is the implicitness or explicitness important to you?</li>
</ul></li>
<li><strong>File-size</strong></li>
</ul>

<p><br/></p>

<h2>Code</h2>

<p>Non-instantiable object:</p>

<pre><code>WindowFactory = {
  buildWindow: function() {
     return {};
  }
};
</code></pre>

<p>Dependency-Injected:</p>

<pre><code>(House = function(windowFactory) {
  this.windowFactory = windowFactory;
}).prototype = {
  build: function() {
    var window = this.windowFactory.buildWindow();
  }
};

var house = new House(WindowFactory);
</code></pre>

<p>vs. The Non-Dependency-Injected variant:</p>

<pre><code>(House = function() {
}).prototype = {
  build: function() {
    var window = WindowFactory.buildWindow();
  }
};

var house = new House();
</code></pre>

<p><br/></p>

<h2>Context</h2>

<p>My primary goal is to make the code above testable. I've gotten into a 
habit of externalizing instantiable dependencies (e.g <code>var window = new 
Window(); var house = new House(window);</code>). This helps when unit- 
testing instantiable objects (e.g. <code>House</code>), since instead of the real 
dependencies (<code>Window</code>) I can instantiate the object with a fake (<code>var 
fakeWindow = {}; var house = new House(fakeWindow);</code>), and not have to 
worry about redundantly testing the dependencies while testing my 
object. (This form of dependency-injection is also useful when testing 
objects that depend on some data being retrieved via XHR, DOM-events, 
sessionStorage, or cookie.) </p>

<p>Now, when the dependency is an instantiable object itself, the 
benefits are clear to me; but when the dependency is a non- 
instantiable object (e.g. WindowFactory in the code above), I have 
second thoughts about the usefulness. </p>
","<javascript><unit-testing><dependency-injection><refactoring>","1","299","2011-03-13 08:50:55"
"5299397","How to find all initializations of instance variables in a Java package?","<p>I'm in the midst of converting a legacy app to Spring. As part of the transition, we're converting our service classes from an ""instantiate new ones whenever you need one"" style to a Springleton style, so I need a way to make sure they don't have any state.</p>

<p>I'm comfortable on the *nix command-line, and I have access to IntelliJ (this strikes me as a good fit for Structural Search and Replace, if I could figure out how to use it), and I could track down an Eclipse install, if that would help. I just want to make absolutely sure I've found all the possible problems.</p>

<p><strong>UPDATE</strong>: Sorry for the confusion. I don't have a problem finding places where the old constructor was being called. What I'm looking for is a ""bullet-proof"" why to search all 100+ service classes for any sort of internal state. The most obvious one I could think of (and the only one I've really found so far) is cases where we use memoization in the classes, so they have instance variables that get initialized internally instead of via Spring. This means that when the same Springleton gets used for different requests, data can leak between them.
Thanks.</p>
","<java><spring><refactoring><singleton><search-and-replace>","2","184","2011-03-14 13:45:34"
"5301824","How to get a list of classes in a project that are no longer needed by anything in that project","<p>Is there any way to generate a list of classes in a Java project that are no longer needed by any other classes in that project?</p>

<p>Here's a diagram to help illustrate the situation (I hope you enjoy my ASCII diagram since I don't have enough rep to use an image), where C and B depend on project A:</p>

<pre><code>         A
        / \
       /   \
      C     B
</code></pre>

<p>I started refactoring by moving code from B to A, so that it could be shared by C and B.  However, now that I'm getting close to finishing refactoring, I want to check to see if there are any classes that I moved to A that can now be moved back down to B (classes that are in A but aren't using by any code in A)</p>

<p>Is there some tool that I can use to generate a list of such classes for me?</p>
","<java><refactoring><dependencies>","7","117","2011-03-14 17:03:34"
"5303558","Disadvantages of switching from jQuery to Dojo","<p>I am considering using Dojo in some new projects (or at least including it),, Partially because of <a href=""http://stackoverflow.com/questions/4017469/is-it-possible-to-use-closure-compiler-advanced-optimizations-with-jquery/5260069#5260069"">it's compatibility with Google Closure Compiler's Advanced mode</a> which will (hopefully) entirely delete all unused code.</p>

<p>What would I lose? (besides familiarity with syntax)</p>

<p>(also, generally any tips on what is different would probably be helpful)</p>
","<javascript><jquery><library><refactoring><dojo>","5","959","2011-03-14 19:40:46"
"5304017","How to safely rename a class in Common project (shared by multiple solutions)","<p>I have a ""Common"" project shared by multiple solutions.</p>

<p>If I rename a class in the Common project, Visual Studio will refactor all code that uses that class, but on for the opened solution. Is it possible to force Visual Studio to refactor all solutions that use Common project?</p>
","<visual-studio><refactoring><project-management><projects-and-solutions>","0","130","2011-03-14 20:21:50"
"5307552","Eclipse refactoring fails -> Keeps throwing exceptions!","<p>I'm using Eclipse Helios and for every refactoring that spans multiple files it plainly fails! Nothing happens. On examining the logs here's the error that I see:</p>

<pre><code>!ENTRY org.eclipse.ltk.ui.refactoring 4 10000 2011-03-13 14:15:31.842
!MESSAGE Internal Error
!STACK 0

java.lang.reflect.InvocationTargetException
at org.eclipse.jface.operation.ModalContext.run(ModalContext.java:421)
at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.run(RefactoringWizardDialog2.java:330)
at org.eclipse.ltk.ui.refactoring.RefactoringWizard.internalPerformFinish(RefactoringWizard.java:573)
at org.eclipse.ltk.ui.refactoring.UserInputWizardPage.performFinish(UserInputWizardPage.java:153)
at org.eclipse.jdt.internal.ui.refactoring.reorg.RenameTypeWizardInputPage.performFinish(RenameTypeWizardInputPage.java:144)
at org.eclipse.ltk.ui.refactoring.RefactoringWizard.performFinish(RefactoringWizard.java:646)
at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.okPressed(RefactoringWizardDialog2.java:454)
at org.eclipse.jface.dialogs.Dialog.buttonPressed(Dialog.java:472)
at org.eclipse.jface.dialogs.Dialog$2.widgetSelected(Dialog.java:624)
at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:234)
at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1053)
at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:4066)
at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3657)
at org.eclipse.jface.window.Window.runEventLoop(Window.java:825)
at org.eclipse.jface.window.Window.open(Window.java:801)
at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation$1.run(RefactoringWizardOpenOperation.java:180)
at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:70)
at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation.run(RefactoringWizardOpenOperation.java:192)
at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation.run(RefactoringWizardOpenOperation.java:115)
at org.eclipse.jdt.internal.ui.refactoring.actions.RefactoringStarter.activate(RefactoringStarter.java:38)
at org.eclipse.jdt.internal.ui.refactoring.UserInterfaceStarter.activate(UserInterfaceStarter.java:62)
at org.eclipse.jdt.internal.ui.refactoring.reorg.RenameUserInterfaceStarter.activate(RenameUserInterfaceStarter.java:31)
at org.eclipse.jdt.ui.refactoring.RenameSupport.openDialog(RenameSupport.java:159)
at org.eclipse.jdt.ui.refactoring.RenameSupport.openDialog(RenameSupport.java:116)
at org.eclipse.jdt.internal.corext.refactoring.RefactoringExecutionStarter.startRenameRefactoring(RefactoringExecutionStarter.java:438)
at org.eclipse.jdt.internal.ui.refactoring.actions.RenameJavaElementAction.run(RenameJavaElementAction.java:203)
at org.eclipse.jdt.internal.ui.refactoring.actions.RenameJavaElementAction.run(RenameJavaElementAction.java:101)
at org.eclipse.jdt.ui.actions.RenameAction.run(RenameAction.java:108)
at org.eclipse.jdt.ui.actions.SelectionDispatchAction.dispatchRun(SelectionDispatchAction.java:274)
at org.eclipse.jdt.ui.actions.SelectionDispatchAction.run(SelectionDispatchAction.java:250)
at org.eclipse.jface.action.Action.runWithEvent(Action.java:498)
at org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:584)
at org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:501)
at org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:411)
at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1053)
at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:4066)
at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3657)
at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2640)
at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2604)
at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2438)
at org.eclipse.ui.internal.Workbench$7.run(Workbench.java:671)
at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:664)
at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)
at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:115)
at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:196)
at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:369)
at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:179)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:597)
at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:619)
at org.eclipse.equinox.launcher.Main.basicRun(Main.java:574)
at org.eclipse.equinox.launcher.Main.run(Main.java:1407)
Caused by: java.lang.NoClassDefFoundError: org/eclipse/jst/jsp/core/internal/java/search/JSPIndexManager
at org.eclipse.jst.jsp.core.internal.java.search.JSPSearchSupport.searchRunnable(JSPSearchSupport.java:424)
at org.eclipse.jst.jsp.core.internal.java.search.JSPSearchSupport.searchRunnable(JSPSearchSupport.java:349)
at org.eclipse.jst.jsp.ui.internal.java.refactoring.JSPRenameParticipant.createChangesFor(JSPRenameParticipant.java:215)
at org.eclipse.jst.jsp.ui.internal.java.refactoring.JSPRenameParticipant.createChange(JSPRenameParticipant.java:153)
at org.eclipse.ltk.core.refactoring.participants.ProcessorBasedRefactoring.createChange(ProcessorBasedRefactoring.java:308)
at org.eclipse.ltk.core.refactoring.CreateChangeOperation.run(CreateChangeOperation.java:124)
at org.eclipse.ltk.core.refactoring.PerformChangeOperation.run(PerformChangeOperation.java:209)
at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1975)
at org.eclipse.ltk.internal.ui.refactoring.WorkbenchRunnableAdapter.run(WorkbenchRunnableAdapter.java:87)
at org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:121)
Root exception:
java.lang.NoClassDefFoundError: org/eclipse/jst/jsp/core/internal/java/search/JSPIndexManager
at org.eclipse.jst.jsp.core.internal.java.search.JSPSearchSupport.searchRunnable(JSPSearchSupport.java:424)
at org.eclipse.jst.jsp.core.internal.java.search.JSPSearchSupport.searchRunnable(JSPSearchSupport.java:349)
at org.eclipse.jst.jsp.ui.internal.java.refactoring.JSPRenameParticipant.createChangesFor(JSPRenameParticipant.java:215)
at org.eclipse.jst.jsp.ui.internal.java.refactoring.JSPRenameParticipant.createChange(JSPRenameParticipant.java:153)
at org.eclipse.ltk.core.refactoring.participants.ProcessorBasedRefactoring.createChange(ProcessorBasedRefactoring.java:308)
at org.eclipse.ltk.core.refactoring.CreateChangeOperation.run(CreateChangeOperation.java:124)
at org.eclipse.ltk.core.refactoring.PerformChangeOperation.run(PerformChangeOperation.java:209)
at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1975)
at org.eclipse.ltk.internal.ui.refactoring.WorkbenchRunnableAdapter.run(WorkbenchRunnableAdapter.java:87)
at org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:121)
</code></pre>

<p>This error doesn't make much sense for me to be able to navigate around and even 'try' fixing it. For refactorings that are 'local' to the file/methods it seems to work fine. I've tried figuring this one out but just aghast! I tend to use the refactor feature A LOT. I'm working with J2EE + Glassfish v3. I have JARs for freemarker, restlet and that for DBUtils on the build path.</p>

<p>Any ideas? Has anyone encountered (and fixed :) this problem??</p>

<p>Thanks in advance!</p>
","<java><eclipse><web-applications><refactoring>","0","769","2011-03-15 04:30:02"
"5316760","Clean way to get ms elapsed since last loop?","<p>Is there a cleaner way to express the following?</p>

<pre><code>// initialize several vars here

long lastT = 0; 
while (looping) {
    long now = currentTimeMillis(); 
    long elapsed = now - lastT; 
    lastT = now;

    // code here
}
</code></pre>

<p>Presumably I only need <code>long elapsed=...</code> (and probably the loop itself), but the other lines can either be condensed, or moved elsewhere. But what's the best way to do that?</p>

<p>The language used is not important, though the above was written in Java.</p>
","<refactoring>","0","26","2011-03-15 19:13:56"
"5317432","Is using the HTML style tag bad practice? How else can I accomplish this?","<p>Currently I'm doing something like this:</p>

<pre><code>&lt;?php
if ($x == 0)
  $image = 'background-position: 0px -7px';
else
  $image = 'background-position: 0px -14px';
?&gt;
&lt;a class=""asdf"" style=""&lt;?php echo $image; ?&gt;""&gt;&lt;/a&gt;
</code></pre>

<p>Is this the recommended way to change an image based on a variable in HTML/PHP? Is there any way to refactor this?</p>
","<php><html><refactoring>","0","135","2011-03-15 20:11:59"
"5324903","Refactoring c++ template class based on template type","<p>Given class Foo</p>

<pre><code>template &lt;typename T&gt;
class Foo
{
public:

  ...other methods..

  void bar()
  {
    ...
    m_impl.doSomething();
    ...
  }

  void fun()
  {
    ...
    m_impl.doSomethingElse();
    ...
  }

  void fubar()
  {
    ...
  }

private:
  T m_impl;
};
</code></pre>

<p>I wanted to cater for situations where T is a boost::shared_ptr.
In this case the only change to class Foo is that it should invoke </p>

<pre><code>m_impl-&gt;doSomething();
</code></pre>

<p>instead of</p>

<pre><code>m_impl.doSomething();
</code></pre>

<p>I ended up defining FooPtr in the same header</p>

<pre><code>template &lt;typename T&gt;
class FooPtr
{
public:
  ...other methods..

  void bar()
  {
    ...
    m_pImpl-&gt;doSomething();
    ...
  }

  void fun()
  {
    ...
    m_pImpl-&gt;doSomethingElse();
    ...
  }

  void fubar()
  {
    ...
  }

private:
  boost::shared_ptr&lt;T&gt; m_pImpl;
};
</code></pre>

<p>Now while the approach works for all classes that I want to use with Foo,
the problem is that I have a lot of duplicate code lying around and any changes
I make to Foo, I also have to make to FooPtr.</p>

<p>How can I refactor the code? E.g. Is there any way that I can determine at compile time if T is of type boost::shared_ptr, and then specialise just the bar and fun methods to invoke the -> operator?</p>

<p>Edit:
Thanks for all the answers so far! I just need some time to work through them all and see which solution is the best fit for our software.</p>

<p>Edit 2:
@Matthieu: This is the test code I was using</p>

<pre><code>class FooImpl
{
public:
  void doIt()
  {
    cout &lt;&lt; ""A"" &lt;&lt; std::endl;
  }
};

int _tmain(int argc, _TCHAR* argv[])
{
  Foo&lt;FooImpl&gt; foo;
  foo.doSomething();
  return 0;
}
</code></pre>
","<c++><templates><refactoring><shared-ptr>","3","228","2011-03-16 11:59:01"
"5327405","are two loops more costly than one loop regrouping the code of the two ones in C#?","<p>this might be a silly question but...</p>

<p>Refactoring my code, I came up with a question I could not find any answer to:</p>

<p>assuming I have an object <code>MyDumyObject</code> containing String properties <code>Foo</code> and <code>Bar</code></p>

<p>assuming I also have a collection of <code>MyDumyObject</code> called <code>MyDumyCollection</code></p>

<p>is</p>

<pre><code>foreach(MyDumyObject obj in MyDumyCollection)
{
    obj.Foo = ""fooooooooo"";
    obj.Bar = ""baaaaaaaar"";
}
</code></pre>

<p>equivalent to</p>

<pre><code>foreach(MyDumyObject obj in MyDumyCollection)
{
    obj.Foo = ""fooooooooo"";
}

foreach(MyDumyObject obj in MyDumyCollection)
{
    obj.Bar = ""baaaaaaaar"";
}
</code></pre>

<p>?</p>

<p>I'm guessing: no
but I have been deceived by C# and the way the C# compiler works more than once previously, so I'm careful with my assumptions now, and I'd be glad for a confirmation or refutation.</p>

<p>subsidiary question:</p>

<p>is</p>

<pre><code>foreach(MyDumyObject obj in MyDumyCollection)
{
    obj.Foo = ""fooooooooo"";

    // ....

    obj.Foo = ""foooooooooooooooooooooooo"";
}
</code></pre>

<p>equivalent to</p>

<pre><code>foreach(MyDumyObject obj in MyDumyCollection)
{
    obj.Foo = ""fooooooooo"";
}

// ....

foreach(MyDumyObject obj in MyDumyCollection)
{
    obj.Foo = ""foooooooooooooooooooooooo"";
}
</code></pre>

<p>?</p>
","<c#><.net><optimization><refactoring>","0","105","2011-03-16 15:15:22"
"5337984","Refactor SQL query to return results into rows instead of columns","<p>I have a SQL query that need to be refactored. Basically the query gets all the producttypes  ordered by a specified customer. The problem is that the results are returned in columns instead of rows. This needs to be changed the other way around to make the query more generic. </p>

<p><strong>So this is what the query returns:</strong></p>

<pre><code>Name   ProductType1   ProductType2   ProductType3
--------------------------------------------------
Marc   PT09           P15            PT33
</code></pre>

<p><strong>And this is what it should be:</strong></p>

<pre><code>Name ProductType
----------------
Marc PT09
Marc P15
Marc PT33
</code></pre>

<p><strong>This is the query which I have simplified a bit:</strong></p>

<pre><code>SELECT 
      CustomerData.Name as Name
      Product1.productType as ProductType1,
      Product2.productType as ProductType2,
      Product3.productType as ProductType3
FROM
    (SELECT ProductID, Name
            FROM 
                Customer 
                Orders
      WHERE Customer.ID = 111
    ) as CustomerData

LEFT JOIN (SELECT DISTINCT CP.ProductID as ProductID,
                           PC.Type as ProductType
           FROM 
                CustomerProduct CP,
                ProductCategory PC
           WHERE
                PC.Category = 'A'
                AND CP.ProductCategoryID = PC.ID
           )  as Product1
           on CustomerData.ProductID = Product1.ProductID

LEFT JOIN (SELECT DISTINCT CP.ProductID as ProductID,
                           PC.Type as ProductType
           FROM 
                CustomerProduct CP,
                ProductCategory PC
           WHERE
                PC.Category = 'B'
                AND CP.ProductCategoryID = PC.ID
           )  as Product2
           on CustomerData.ProductID = Product1.ProductID

LEFT JOIN (SELECT DISTINCT CP.ProductID as ProductID,
                           PC.Type as ProductType
           FROM 
                CustomerProduct CP,
                ProductCategory PC
           WHERE
                PC.Category = 'C'
                AND CP.ProductCategoryID = PC.ID
           )  as Product3
           on CustomerData.ProductID = Product1.ProductID
</code></pre>

<p>So I have been thinking about splitting the joins into a separate stored proc and then call this as I need more productTypes but I can't seem to get this working. Anyone an idea on how to get this working ?</p>
","<sql><query><refactoring>","1","194","2011-03-17 10:48:36"
"5339216","Upgrade Classic ASP Javascript include to .net","<p>I'm working on an ASP.net 3.5 project that has evolved out of a Classic ASP project.  We have two old Javascript files that are included in a few pages and have never been updated properly.  The Javascript contains ASP.Net server tags and the files are saved with a .js.aspx extension.</p>

<p>The embedded VB.net refers to shared (static) properties in a class and also the ASP.net Session variable.  The class in question isn't imported in the Javascript files, so Visual Studio fails to compile the page.  However, when you load a page that includes these files, it works fine.</p>

<p>What is the correct way to update these files to .Net standards?  Should we avoid having server tags in Javascript files or is there a .Net way to mingle Javascript and server-side code in an includable file?</p>

<p>Thanks.</p>

<p><strong>Edit to answer question:</strong></p>

<p>The file is being included with &lt;!-- #include virtual=""myFile.js.aspx"" --&gt; inside a script tag.  The compiler error is: ""Name 'MyClass' is not declared"", where MyClass is the class being referenced.</p>
","<javascript><asp.net><asp-classic><refactoring><server-side-includes>","1","260","2011-03-17 12:50:03"
"5344016","Extact API from code library","<p>Hi is there a technique available to easily extract all of the namespaces and methods etc from a code library compiled in C# for asp.net?</p>

<p>I basically want to be able to print all available namespaces, methods, etc so that I can decide how to refactor.</p>
","<c#><asp.net><visual-studio><refactoring>","2","62","2011-03-17 19:13:09"
"5346636","Java replacement for C macros","<p>Recently I refactored the code of a 3rd party hash function from C++ to C. The process was relatively painless, with only a few changes of note. Now I want to write the same function in Java and I came upon a slight issue.</p>

<p>In the C/C++ code there is a C preprocessor macro that takes a few integer variables names as arguments and performs a bunch of bitwise operations with their contents and a few constants. That macro is used in several different places, therefore its presence avoids a fair bit of code duplication.</p>

<p>In Java, however, there is no equivalent for the C preprocessor. There is also no way to affect any basic type passed as an argument to a method - even autoboxing produces immutable objects. Coupled with the fact that Java methods return a single value, I can't seem to find a simple way to rewrite the macro.</p>

<p>Avenues that I considered:</p>

<ul>
<li><p><strong>Expand the macro by hand everywhere:</strong> It would work, but the code duplication could make things <em>interesting</em> in the long run.</p></li>
<li><p><strong>Write a method that returns an array:</strong> This would also work, but it would repeatedly result into code like this:</p>

<pre><code>long tmp[] = bitops(k, l, m, x, y, z);

k = tmp[0];
l = tmp[1];
m = tmp[2];
x = tmp[3];
y = tmp[4];
z = tmp[5];
</code></pre></li>
<li><p><strong>Write a method that takes an array as an argument</strong>: This would mean that all variable names would be reduced to array element references - it would be rather hard to keep track of which index corresponds to which variable.</p></li>
<li><p><strong>Create a separate class e.g. <code>State</code> with public fields of the appropriate type and use that as an argument to a method</strong>: This is my current solution. It allows the method to alter the variables, while still keeping their names. It has the disadvantage, however, that the <code>State</code> class will get more and more complex, as more macros and variables are added, in order to avoid copying values back and forth among different <code>State</code> objects.</p></li>
</ul>

<p>How would you rewrite such a C macro in Java? Is there a more appropriate way to deal with this, using the facilities provided by the standard Java 6 Development Kit (i.e. without 3rd party libraries or a separate preprocessor)?</p>
","<java><c><macros><refactoring>","1","535","2011-03-17 23:46:42"
"5347035","In Javascript, how can I refactor some repeated anonymous functions?","<p>The following code is redundant---the same anonymous function appears three times.</p>

<p>How do I refactor it?</p>

<pre><code>$("".operation"").resizable({
create: function(event, ui) {
    var width = $("".operation"").width()
    $(""#width span.text"").text(width)
},
resize: function(event, ui) {
    var width = $("".operation"").width()
    $(""#width span.text"").text(width)
},
stop: function(event, ui) {
    var width = $("".operation"").width()
    $(""#width span.text"").text(width)
},
})
</code></pre>
","<javascript><refactoring>","1","69","2011-03-18 01:14:08"
"5353624","How can I refactor a simple dynamic attribute?","<p>I have a form that handles four different types of facets of the same form. In my SQL column, I have the four different attributes. </p>

<p>Only one of them is going to have data in it.</p>

<pre><code>Distribution  =&gt;
   zip_code: nil
   me_topic: nil
   sex: nil
   age: nil
</code></pre>

<p>In order to differentiate between them, I wanted to set up a case statement, and add a <strong>dynamic</strong> attribute to the create call :</p>

<pre><code>@type = case params[:type]
  when ""zip""      then "":zip_code""
  when ""interest"" then "":me_topic""
  when ""sex""      then "":sex""
  when ""age""      then "":age""
end
@cur_item = Distribution.new(@type =&gt; params[:value])

# Unfortunately, this is not the proper way to create a dynamic attribute


@distribution = @email.distributions.create(params[:distributions])  
</code></pre>

<p>What is the proper syntax for completing this statement?</p>
","<ruby-on-rails><syntax><refactoring>","0","65","2011-03-18 14:45:17"
"5354042","Design Question : How can I refactor a validation check into another method","<p>I have a huge method of validate that I want to refactor. Here is an example. I have provided the initial validation, and my own suggestion. Do you think it's a good way to refactor it or there are better ways to refactor this?</p>

<p>Thanks,</p>

<pre><code>public void validate() {

   MyException myException= new MyException();
   try {
      if (!isRule1()) {
         throw MyException.invalidRule(Rule1);
      }
   }
   catch (MyException e) {
      myException.addWrappedException(e);
   }

   try{
       f (!isRule2()) {
             throw MyException.invalidRule(Rule2);
          }
       }
       catch (MyException e) {
          myException.addWrappedException(e);
   }

   ////continue checking...
}
</code></pre>

<p>and here is how I want to refactor them:</p>

<pre><code>public void validate() {


   MyException myException= new MyException();
   validateRule1(myException);
   validateRule2(myException);
   //continue validating....
}
private void validateRule1(myException){
   try {
      if (!isRule1()) {
         throw MyException.invalidRule(Rule1);
      }
   }
   catch (MyException e) {
      myException.addWrappedException(e);
   }
}
private void validateRule2(myException){
   try {
      if (!isRule2()) {
         throw MyException.invalidRule(Rule2);
      }
   }
   catch (MyException e) {
      myException.addWrappedException(e);
   }
}
</code></pre>
","<java><validation><design-patterns><refactoring>","0","104","2011-03-18 15:18:45"
"5357939","OOD: Code refactoring and best design (protected or getter/setter)","<p>Reading the code for a project, I noticed this situation, there are two classes as the following example:</p>

<pre><code>
class A {
    private class E aE;
    private class F aF;

    public A(){
        aE = new E();
        aF = new F();
    }

    public void foo1(){
        aE.bar();
        ...
        aF.poo();
    }
}

class B implements Runnable {
    private class E aE;
    private class F aF;

    public B(){
        aE = new E();
        aF = new F();
    }

    public void run(){
        ...
        x = aE.bar()
        ...
    }

}
</code></pre>

<p>I would refactoring this code in order to get a superclass A, but along this way it is better to make fields aE and aF protected in class A and use them in class B or add two methods in class A as getE() and getF() and use this method in class B ?</p>
","<java><oop><design><inheritance><refactoring>","0","134","2011-03-18 21:19:49"
"5379546","How to cleanup tabs with vim, adjust sts and sw?","<p>I created c++ files in vim with these tab settings</p>

<pre><code>set sts=4
set sw=4
</code></pre>

<p>meanwhile i use</p>

<pre><code>set sts=3
set sw=3
</code></pre>

<p>and want to change all the files.
Is this possible?</p>

<p><strong>EDIT</strong></p>

<p>I go with indent, a few other options come handy. </p>
","<vim><refactoring><tabs>","0","288","2011-03-21 15:07:39"
"5385905","Virtuemart is great, but how about its code and architecture?","<p>Virtuemart is the most popular e-commerce component for Joomla 1.5, the editor selected, total free and open source, with stunning strong power! So great, i like it. Thanks all the developers of Virtuemart.</p>

<p>But, my God, there is SQL query even in its themes, why, and why didn't Virtuemart coordinate MVC architecture of Joomla, and, seems no interest in re-factor to do that. It's so hard to develop base on Virtuemart.</p>

<p>I think there must be some great reasons in the hands of Virtuemart developers, Could anyone tell me the reasons or what the advantage of the architecture of Virtuemart ?</p>

<p>(Also i has the same problems with kunena, the great forum component.)</p>
","<mvc><refactoring><joomla><virtuemart>","0","180","2011-03-22 01:56:35"
"5386789","Refactoring a python function so that it can take any sized list","<p>How can I make this function take as input an arbitrary list size?</p>

<pre><code>def ugly_function(lst):
    for a in lst[0]:
        for b in lst[1]:
            for c in lst[2]:
                for d in lst[3]:
                    for e in lst[4]:
                        for f in lst[5]:
                            for g in lst[6]:
                                for h in lst[7]:
                                    if some_test([a,b,c,d,e,f,g,h]): 
                                        return [a,b,c,d,e,f,g,h]
</code></pre>
","<python><refactoring>","0","60","2011-03-22 04:26:04"
"5387587","XCode iPhone automatic property, synthesize and delloc","<p>I have been developing for iPhone from last 1-2 months and all the time for taking IBOutlet I use the following method to declare any property:</p>

<p>In .h files:</p>

<pre><code>@interface ....
{
     controlType varName;
}

@property() IBOutlet controlType varName;
</code></pre>

<p>In .m files:</p>

<p>at top -<pre><code>@synthesize varName;</p>

<p>in delloc method - [varName release];
</code></pre></p>

<p>Although the method is good but it isn't very good when its taking a couple of minutes just for declaring property.</p>

<p>Is there any automatic process for declaring properties, IBOutlets, IBActions or basic data variables.</p>

<p>I hope there should be some automatic methods for this scenario as this is a very basic process.</p>

<p>Thanks all.</p>
","<iphone><xcode><refactoring>","4","3318","2011-03-22 06:22:55"
"5378534","How can I refactor some repetitive HTML and CSS?","<p>How can I refactor the following repetitive HTML and CSS?</p>

<p>The code is about 10 rooms. The top of Room i is at 40*i pixels.</p>

<p>I used colons to indicate lines that I deleted.</p>

<p>HTML:</p>

<pre><code>&lt;div id=""room1""&gt;Room 1&lt;/div&gt;
&lt;div id=""room2""&gt;Room 2&lt;/div&gt;
:
&lt;div id=""room10""&gt;Room 10&lt;/div&gt;
</code></pre>

<p>CSS:</p>

<pre><code>#room1,
#room2,
:
#room10
{
:
    top: 40px;
:
}

#room2 {top: 80px}
#room3 {top: 120px}
#room4 {top: 160px}
:
#room10 {top: 400px}
</code></pre>
","<html><css><refactoring>","1","143","2011-03-21 13:51:32"
"5392801","When to choose Strategy over polymorphism when refactoring switch statement","<p>Can you give me specific reason when to choose stratergy over polymorphsim and vice versa.</p>

<p>Thanks a lot!</p>
","<design-patterns><refactoring>","2","270","2011-03-22 14:27:39"
"5400150","Big picture or guide on programming related topics?","<p>I was wondering if someone could give a big picture of how the following topics and others not mentioned are related:</p>

<ul>
<li>""code reuse""</li>
<li>""refactor""</li>
<li>""design pattern""</li>
<li>""coding/programming standard/style""</li>
<li>...</li>
</ul>

<p>I have heard of these from people's talk and books' names, but got overwhelmed by these names. May I get some organization and big picture from here?</p>

<p>Thanks and regards!</p>
","<design-patterns><refactoring><coding-style><code-reuse>","0","107","2011-03-23 02:20:35"
"5398747","Refactoring - Simplifying nested for loops in java","<p>I need to figure out how to improve following code:</p>

<pre><code>      for (DirCategory c1 : categories1) {
            c1.setCount(dirEntryService.getDirEntryCategoryCount(c1));
            log.debug(""c1: ""+c1.getCount()+"" - ""+c1.getName());
            dirCategoryService.persist(c1);

            List&lt;DirCategory&gt; categories2 = c1.getChildren();
            for (DirCategory c2 : categories2) {
                c2.setCount(dirEntryService.getDirEntryCategoryCount(c2));
                log.debug(""  c2: ""+c2.getCount()+"" - ""+c2.getName());
                dirCategoryService.persist(c2);

                List&lt;DirCategory&gt; categories3 = c2.getChildren();
                for (DirCategory c3 : categories3) {
                    c3.setCount(dirEntryService.getDirEntryCategoryCount(c3));
                    log.debug(""    c3: ""+c3.getCount()+"" - ""+c3.getName());
                    dirCategoryService.persist(c3);

                    List&lt;DirCategory&gt; categories4 = c3.getChildren();
                    for (DirCategory c4 : categories4) {
                        c4.setCount(dirEntryService.getDirEntryCategoryCount(c4));
                        log.debug(""      c4: ""+c4.getCount()+"" - ""+c4.getName());
                        dirCategoryService.persist(c4);

                        List&lt;DirCategory&gt; categories5 = c4.getChildren();
                        for (DirCategory c5 : categories5) {
                            c5.setCount(dirEntryService.getDirEntryCategoryCount(c5));
                            log.debug(""        c5: ""+c5.getCount()+"" - ""+c5.getName());
                            dirCategoryService.persist(c5);

                            List&lt;DirCategory&gt; categories6 = c5.getChildren();
                            for (DirCategory c6 : categories6) {
                                 c6.setCount(dirEntryService.getDirEntryCategoryCount(c6));
                                log.debug(""          c6: ""+c6.getCount()+"" - ""+c6.getName());
                                 dirCategoryService.persist(c6);
                            }
                        }
                    }
                }
            }
        }
</code></pre>

<p>I would really appreciate any help simplifying this ""thing""</p>
","<java><refactoring><for-loop><nested><simplification>","0","336","2011-03-22 22:41:57"
"5405183","Efficiently populating a POJO with a large amount of getters and setters","<p>I have a POJO which represents all the properties of my application. It contains a huge amount of Strings ints and booleans (class variables, and their getters/setters). </p>

<p>The problem is that every time a new property gets added, i have to add the variable, the getter, setter, the code that sets it from loading the property file and the code that uses the getter.</p>

<p>My Idea was to refactor this into a <code>getString(String stringToGet)</code>, <code>getInt</code> and <code>getBoolean</code> method that pulls from 3 hashmaps. The problem with doing it this way is that I can no longer use EL to get properties eg. <code>${Properties.telephoneNumber}</code></p>

<p>Anyone have any other ideas?</p>
","<java><refactoring><properties><getter-setter>","0","238","2011-03-23 12:22:58"
"5407762","Undelegate Method","<p>I'm trying to do a conversion from one 3rd party library to another (<code>gwt-ext</code> to <code>gxt</code>).  To help minimize upfront changes, and to ensure consistency and testability, we decided to create proxy classes that implement the old API and map them to the new API.</p>

<p>For example, something like <code>Panel</code> might now be a <code>ContentPanel</code>.  The old Panel may have had a method called <code>setEl(String name)</code> that should now map to <code>setElement(String name)</code>.  To facilitate this, we created a <code>Panel</code> class that contains a <code>ContentPanel</code>.  Then in Eclipse, we called <code>Source -&gt; Generate Delegate Methods...</code> to create the methods that both APIs might have in common.  Then any missing or changed APIs we create by had in our <code>Panel</code> class and pass along to the appropriate handler in our contained <code>ContentPanel</code>.  When we're done with this, we want to refactor out our class (basically Inlining) and have everything call the methods on 'ContentPanel' directly and use any magic we did in out hand implemented methods in every spot that the old method was called.  </p>

<p>What is the best way to do this?  I thought there was already a refactoring in Eclipse that could handle this, but I'm not finding it.</p>

<p>Of course if you think there is a better way to do a migration like this, I'm open to suggestions on that as well.</p>
","<java><eclipse><delegates><refactoring><migration>","1","55","2011-03-23 15:37:04"
"5407920","RSpec Refactoring Help","<p>I'm a big noob when it comes to testing or test-driven development, so I'm really struggling with testing my code. The biggest reason why is situations like this...</p>

<p>I have a model, <code>Photo</code>, which has the fields ""place"", ""city"", ""state"", and ""country"".</p>

<p>I created a method, ""location"", which can accept one argument, and will return either the minimum form, short form, or full form location. Here's the model code:</p>

<pre><code>def location( form=:full )
  usa = country.eql?('US') || country.eql?('United States')
  country_name = Carmen::country_name( self.country )

  if self.state.present?
    state_name = Carmen::state_name( self.state )
  end

  case [form, usa]
  when [:min, true] then ( self.city.blank? ? self.place : self.city )
  when [:min, false] then ( self.city.blank? ? self.place : self.city )
  when [:short, true] then [ ( self.city.blank? ? self.place : self.city ), state_name ].join(', ')
  when [:short, false] then [ ( self.city.blank? ? self.place : self.city ), country_name ].join(', ')
  when [:full, true] then [ self.place, self.city, state_name ].delete_if{|a| a.blank? }.join(', ')
  when [:full, false] then [ self.place, self.city, country_name ].delete_if{|a| a.blank? }.join(', ')
  else raise ""Invalid location format""
  end
end
</code></pre>

<p>As you can see that's fairly clean and concise. Now, here's my spec:</p>

<pre><code>describe ""location"" do

  before do
    @us = Photo.new(:place =&gt; ""Main St."", :city =&gt; ""Barville"", :state =&gt; ""TX"", :country =&gt; ""US"")
    @uk = Photo.new(:place =&gt; ""High St."", :city =&gt; ""Barchester"", :country =&gt; ""GB"")
    @it = Photo.new( :place =&gt; ""il Commune"", :city =&gt; ""Baria"", :state =&gt; ""AR"", :country =&gt; ""IT"" )
  end

  context ""minimum form"" do
    it ""should return city or place for US Photos"" do
      @us.location(:min).should == ""Barville""
      @us.city = """"
      @us.location(:min).should == ""Main St.""
    end

    it ""should return city or place for Internationals without states"" do
      @uk.location(:min).should == ""Barchester""
      @uk.city = """"
      @uk.location(:min).should == ""High St.""
    end

    it ""should return city or place for Internationals with states"" do
      @it.location(:min).should == ""Baria""
      @it.city = """"
      @it.location(:min).should == ""il Commune""
    end
  end

  context ""short form"" do
    it ""should return city,state or place,state for US photos"" do
      @us.location(:short).should == ""Barville, Texas""
      @us.city = """"
      @us.location(:short).should == ""Main St., Texas""
    end

    it ""should return city,country or place,country for Internationals without states"" do
      @uk.location(:short).should == ""Barchester, United Kingdom""
      @uk.city = """"
      @uk.location(:short).should == ""High St., United Kingdom""
    end

    it ""should return city,country or place,country for Internationals with states"" do
      @it.location(:short).should == ""Baria, Italy""
      @it.city = """"
      @it.location(:short).should == ""il Commune, Italy""
    end
  end

  context ""full form"" do
    context ""US Photos"" do
      it ""should return place, city, state"" do
        @us.location(:full).should == ""Main St., Barville, Texas""
      end

      it ""should return place, state if city is blank"" do
        @us.city = """"
        @us.location(:full).should == ""Main St., Texas""
      end

      it ""should return city, state if place is blank"" do
        @us.place = """"
        @us.location(:full).should == ""Barville, Texas""
      end
    end

    context ""Internationals without states"" do
      it ""should return place, city, state"" do
        @uk.location(:full).should == ""High St., Barchester, United Kingdom""
      end

      it ""should return place, state if city is blank"" do
        @uk.city = """"
        @uk.location(:full).should == ""High St., United Kingdom""
      end

      it ""should return city, state if place is blank"" do
        @uk.place = """"
        @uk.location(:full).should == ""Barchester, United Kingdom""
      end
    end
  end

  context ""Internationals with states"" do
    it ""should return place, city, state"" do
      @it.location(:full).should == ""il Commune, Baria, Italy""
    end

    it ""should return place, state if city is blank"" do
      @it.city = """"
      @it.location(:full).should == ""il Commune, Italy""
    end

    it ""should return city, state if place is blank"" do
      @it.place = """"
      @it.location(:full).should == ""Baria, Italy""
    end
  end
end
</code></pre>

<p>So, 98 lines of test code to test 17 lines of model code. That just seems insane to me. Plus the time it takes to test this out in RSpec is frankly a lot more than the time it takes to test it out in the console.</p>

<p>So, I have two questions:</p>

<ol>
<li>Surely there's a better way to do this. Can anyone suggest a refactoring?</li>
<li>Is this ratio of test code to model code normal, and if so, why is it worth the time?</li>
</ol>

<p>Thanks!!</p>

<p>-- EDIT --</p>

<p>Just to be clear, I'm mostly interested in a refactoring of the <strong>test code</strong>, not the location method.</p>
","<ruby-on-rails><ruby><testing><refactoring><rspec>","4","206","2011-03-23 15:47:03"
"5426431","How to refactor these if statements?","<p>I have this code:</p>

<pre><code>&lt;div id=""menu""&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;span id=""menulabel""&gt;Your Languages&lt;/span&gt;&lt;/li&gt;
        &lt;?php
        $hotClass = '';
        $newClass = '';
        $topClass = '';
        if ($sort == 'hot')
            $hotClass = 'active';
        else if ($sort == 'new')
            $newClass = 'active';
        else if ($sort == 'top')
            $topClass = 'active';
        ?&gt;
        &lt;li&gt;&lt;a id=""Hot"" href=""index.php?sort=hot&amp;page=1"" class=""&lt;?php echo $hotClass; ?&gt;""&gt;Hot&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a id=""New"" href=""index.php?sort=new&amp;page=1"" class=""&lt;?php echo $newClass; ?&gt;""&gt;New&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a id=""Top"" href=""index.php?sort=top&amp;page=1"" class=""&lt;?php echo $topClass; ?&gt;""&gt;Top&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
</code></pre>

<p>Depending on which sorting the page is using a different menu item is highlighted to show the user. However, I really dislike this code because the class is empty instead of not present when the list item is not active. Also, every if statement does basically the same thing. Is it possible to refactor this in to something more elegant and readable? Thanks.</p>
","<php><html><refactoring>","1","109","2011-03-24 22:40:04"
"5431260","Refactor ruby on rails","<p>What is best way to refactor in Ruby on Rails. I have a project where i would like to refactor several of my objects - extra properties and renaming of existing properties. How do i do this this the easiest way?? I created the different objects with scaffolding ""rails generate scaffold foo name:string....""
I do start from scratch or is there some cool ruby command, like ""rails refactor foo name:string"".. </p>
","<ruby-on-rails><refactoring>","0","137","2011-03-25 10:33:52"
"5431803","betterment of code in OO php","<p>I use php OO for my project. I have lots of families in my application around 7. So i have to use switch and do it in each file where i need to check the family. So i feel the performance is effected because of this. So is there any way so that i can eliminate these switch cases and use some design patters or something like that. The present idea is to have a separate code base for each family, which i am not satisfied with completely. So looking for various options to solve this issue.  </p>
","<php><refactoring>","2","93","2011-03-25 11:28:07"
"5433179","C code reshaper","<p>I am working with Matlab code generator. It is not possible to include code style guidelines. That's why I am looking for a tool to ""reshape"", rename and reformat the generated code according to my:</p>

<ul>
<li>Function banner conventions</li>
<li>File banner conventions</li>
<li>Naming conventions</li>
<li>And so on.</li>
</ul>

<p>Is there such a tool?</p>
","<c><refactoring><code-generation><reformatting>","0","83","2011-03-25 13:35:31"
"5434702","php - quick refactoring","<p>I have 2 methods, that are pretty much exactly the same and I'd likie someone to help me refactor them:</p>

<pre><code>public static function searchFromVideoRequest($word, $returnPropelObjects = false)
{
    $c = new Criteria();
    $c-&gt;addJoin(YoutubeVideoPeer::ID,ItemPeer::YOUTUBE_VIDEO_ID);
    $c-&gt;addSelectColumn(self::TITLE);
    $c-&gt;addSelectColumn(self::ID);
    $c-&gt;add(ItemPeer::TITLE, '%'.$word.'%', Criteria::LIKE);
    $c-&gt;addAnd(self::YOUTUBE_VIDEO_ID, null, Criteria::ISNOTNULL);
$c-&gt;addAscendingOrderByColumn(self::TITLE);
   if ($returnPropelObjects)
          return self::doSelect($c);

        $stmt = self::doSelectStmt($c);
        $results = array();
        while ($row = $stmt-&gt;fetch(PDO::FETCH_ASSOC)) {
          $results[] = $row;
        }
        return $results;
}

public static function searchFromFlickrRequest($word, $returnPropelObjects = false)
{
    $c = new Criteria();
    $c-&gt;addJoin(FlickrPhotoPeer::ID,ItemPeer::FLICKR_PHOTO_ID);
    $c-&gt;addSelectColumn(self::TITLE);
    $c-&gt;addSelectColumn(self::ID);
    $c-&gt;add(ItemPeer::TITLE, '%'.$word.'%', Criteria::LIKE);
    $c-&gt;addAnd(self::FLICKR_PHOTO_ID, null, Criteria::ISNOTNULL);
    $c-&gt;addAscendingOrderByColumn(self::TITLE);
   if ($returnPropelObjects)
          return self::doSelect($c);

        $stmt = self::doSelectStmt($c);
        $results = array();
        while ($row = $stmt-&gt;fetch(PDO::FETCH_ASSOC)) {
          $results[] = $row;
        }
        return $results;
}
</code></pre>

<p>Thanks</p>
","<php><refactoring>","0","129","2011-03-25 15:37:35"
"5437030","generating c++ refactoring script","<p>I have to perform refactoring of a medium size code block (&lt; 200K LOC). The scope is pretty moderate: rename some classes, move a few nested definitions up and down the class hierarchy, remove unused stuff.</p>

<p>It would be pretty straightforward to do it by hand but we will have to pick up bug fixes from the older code base for one or two years, and the project will change at least half of lines in the existing code.</p>

<p>So, I am planning to express the changes as a sequence of indent (supposedly astyle), sed script, and another indent.</p>

<p>My plans are: do conversion by hand, then develop the sed script that will yeld the same result. The former part is pretty clear, but developing bit sed script by hand does not seem particularly appealing but I do not have any better idea.</p>

<p>Please, help.</p>
","<c++><refactoring><sed>","0","113","2011-03-25 19:11:46"
"5460483","How to modify a java program from arrays to arraylist objects?","<pre><code>// sets up random number of markers in a
// one-dimensional array
// numMarkers markers in a board of size boardSize
public class SimpleDotCom
{
  // constants
  private final static int DEFAULT_MARKERS = 3;
  private final static int DEFAULT_BOARD_SIZE = 10;

  // data members
  private int[] markers; // stores the marker positions
  private int boardSize; // stores the size of the board
  private int endOfMarkers;

  // default constructor
  // 3 markers in a board of 10
  public SimpleDotCom()
  {
    this( DEFAULT_MARKERS, DEFAULT_BOARD_SIZE );
  }

  // constructor to set up
  // numMarkers and boardSize
  public SimpleDotCom( int numMarkers, int boardSize )
  {
    markers = new int[numMarkers];
    this.boardSize = boardSize;
    endOfMarkers = markers.length - 1;

    int i, j, randNum;
    int[] original = new int[boardSize];

    for ( i = 0; i &lt; original.length; i++ )
      original[i] = i;

    // scramble original
    for ( i = original.length - 1;
          i &gt;= original.length - markers.length;
          i-- )
    {
      randNum = (int) (Math.random() * (i+1) );
      // swap original[i] and original[randNum]
      j = original[i];
      original[i] = original[randNum];
      original[randNum] = j;
    }

    for ( i = 0; i &lt; markers.length; i++ )
      markers[i] = original[i+original.length-markers.length];
  } // end SimpleDotCom

  // check if the guess is a hit or a miss
  // precondition: guess is valid
  public String checkYourself( int guess )
  {
    for ( int i = 0; i &lt;= endOfMarkers; i++ )
      if ( markers[i] == guess )
      {
        markers[i] = markers[endOfMarkers];
        endOfMarkers--;
        return ""Hit"";
      }
    return ""Miss"";
  } // end checkYourself

  // returns the number of markers in the game
  public int numberOfMarkers()
  {
    return markers.length;
  } // end numberOfMarkers

  // returns the size of the board
  public int sizeOfBoard()
  {
    return boardSize;
  } // end sizeOfBoard
} // end SimpleDotCom
</code></pre>

<p>That is the program that I need to modify. I am to modify the arrays to arraylist objects and I don't know how to do it. Any information/adive is helpful. If you need to know anything eles ask and I will let you know. Again thanks for your help.</p>
","<java><arrays><homework><refactoring><arraylist>","0","203","2011-03-28 14:30:49"
"5463980","Cleaner way of abstraction","<p>I am refactoring some old code and struck regarding a design decision</p>

<pre><code>AbstractClassA
-Step 1
-Step 2
--Step 2.1
--Step 2.2
-Step 3
</code></pre>

<p>The above abstract class has abstract methods Step 1, Step 2 and Step 3. Step 2 always need to call methods 2.1 and 2.2. But in the current design, Step 2.1 and 2.2 are not declared as abstract and have been implemented and called in each and every inherited class. I am planning to refactor the code by pulling all these methods (including 2.1 and 2.2) into an interface. I am then planning to have abstract class implementation of this interface in which Step 2 would call 2.1 and 2.2. But somehow this doesn't seem neat. I want to know if this design is flawed?</p>

<pre><code>InterfaceA
-Step1
-Step2
-Step 2.1
-Step 2.2
-Step3
</code></pre>
","<c#><interface><refactoring>","2","101","2011-03-28 19:25:38"
"5475709","Is there a tool that can detect unused Java code based on a known set of ""used"" classes?","<p>I am looking for a tool that can take a large set of classes and search them for unused methods/variables when given a set of seed classes. My goal is to re-refactor the large set of classes so I can extract only the needed stuff &#8212; which is used by the seed classes &#8212; from it.</p>

<p>When I say seed classes, I mean a set of classes to be used as entry point for figuring out what is unused. For instance, if class A calls class B and class C calls class D, but the only seed class is class A, then class C and class D should both be considered unused classes. The tool I am looking for should be able to give the unused classes/methods/variables based on the set of seed classes. Does such a tool exist?</p>
","<java><tools><refactoring>","2","229","2011-03-29 16:20:12"
"5489081","Refactoring large data object","<p><strong>What are some common strategies for refactoring large ""state-only"" objects?</strong></p>

<p>I am working on a specific soft-real-time decision support system which does online modeling/simulation of the national airspace.  This piece of software consumes a number of live data feeds, and produces a once-per-minute estimate of the ""state"" of a large number of entities in the airspace.  The problem breaks down neatly until we hit what is currently the lowest-level entity.</p>

<p>Our mathematical model estimates/predicts upwards of 50 parameters for a timeline of several hours into the past and future for each of these entities, roughly once per minute.  Currently, these records are encoded as a single Java class with a lot of fields (some get collapsed into an <code>ArrayList</code>).  Our model is evolving, and the dependencies among the fields are not yet set in stone, so each instance wanders through a convoluted model, accumulating settings as it goes along.  </p>

<p>Currently we have something like the following, which uses a builder pattern approach to build up the contents of the record, and enforce what the known dependencies are (as a check against programmer error as evolve the mode.)  Once the estimate is done, we convert the below into an immutable form using a <code>.build()</code> type method.</p>

<pre><code>final class OneMinuteEstimate {

  enum EstimateState { INFANT, HEADER, INDEPENDENT, ... };
  EstimateState state = EstimateState.INFANT; 

  // ""header"" stuff
  DateTime estimatedAtTime = null;
  DateTime stamp = null;
  EntityId id = null;

  // independent fields
  int status1 = -1;
  ...

  // dependent/complex fields...
  ... goes on for 40+ more fields... 

  void setHeaderFields(...)
  {
     if (!EstimateState.INFANT.equals(state)) {
        throw new IllegalStateException(""Must be in INFANT state to set header"");
     }

     ... 
  }

}
</code></pre>

<p>Once a very large number of these estimates are complete, they are assembled into timelines where aggregate patterns/trends are analyzed.  We have looked at using an embedded database but have struggled with performance issues; we'd rather get this sorted out in terms of data modeling and then incrementally move portions of the soft-real-time code into an embedded data store.</p>

<p>Once the ""time sensitive"" pieces of this are done, the products are flushed to flat files and a database.</p>

<p><strong>Problems:</strong></p>

<ul>
<li>It's a giant class, with way too many fields.  </li>
<li>There is very little behavior encoded in the class; it's mostly a holder for data fields.</li>
<li>Maintaining the <code>build()</code> method is extremely cumbersome.</li>
<li>It feels clumsy to manually maintain a ""state machine"" abstraction merely for the purpose of ensuring that a large number of dependent modeling components are properly populating a data object, but it has saved us a lot of frustration as the model evolves.</li>
<li>There is a lot of duplication, particularly when the records described above are aggregated into very similar ""rollups"" which amount to rolling sums/averages or other statistical products of the above structure in time series.</li>
<li>While some of the fields could be clumped together, they are all logically ""peers"" of one another, and any breakdown we've tried has resulted in having behavior/logic artificially split and needing to reach two levels deep in indirection.</li>
</ul>

<p>Out of the box ideas entertained, but this is something we need to evolve incrementally.  Before anyone else says it, I'll note that one could suggest that our mathematical model is insufficiently crisp if the data representation for that model is this hard to get ahold of.  Fair point, and we're working that, but I think that's a side-effect of an R&amp;D environment with a lot of contributors, and a lot of concurrent hypotheses in play.</p>

<p>(Not that it matters, but this is implemented in Java.  We use HSQLDB or Postgres for output products.  We don't use any persistence framework, partly out of a lack of familiarity, partly because we have enough performance trouble with just the database alone and hand-coded storage routines... we're skeptical of moving towards additional abstraction.)</p>
","<java><class><refactoring><data-objects>","9","278","2011-03-30 16:17:46"
"5489140","Refactor packages of a jar","<p>I am having some troubles with a jar, and I want to rename all clases to avoid conflicts, but I only have the final jar :(</p>

<p>Classes in jar are in package as it:</p>

<p>org.foundation  and I want to be available in another jar as</p>

<p>org.foundation.oldversion</p>

<p>Is there any tool to do it ?</p>

<p>I don't want to decompile.</p>
","<java><refactoring><jar>","0","63","2011-03-30 16:23:44"
"5497790","Avoiding TDD making big refactorings harder","<p>I'm still relatively a beginner in TDD, and I often end up into the trap where I've designed myself into a corner at some point when trying to add a new piece of functionality.</p>

<p>Mostly it means that the API that grew out of the, say, first 10 requirements, doesn't scale when adding the next requirement, and I realize I have to do a big redesign on the existing functionality, including the structure, to add something the new stuff in a nice way.</p>

<p>This is fine, except in this case the API would then change, so all the initial tests would then have to change. This is usually a bigger thing than just renaming methods.</p>

<p>I guess my question is twofold: How should I have avoided getting into this position in the first place, and given that I get into it, what are safe patterns of refactoring the tests and allowing new functionality with a new API to grow?</p>

<p><strong>Edit</strong>: Lots of great answers, will experiment will several techniques. Marked as solution the answer I felt was most helpful.</p>
","<language-agnostic><refactoring><tdd><agile>","4","145","2011-03-31 09:32:29"
"5504463","Can't delete project libraries","<p>I want to delete Tomahawk libraries from one of my Eclipse projects, but I get this error:
<img src=""http://i.stack.imgur.com/mKjKX.png"" alt=""enter image description here""></p>

<p>Is this some kind of library pollution? Why cant I delete it? I did remove all xmlns calls I had on my pages and also removed calls to all classes from that .jar file.</p>
","<java><eclipse><library><java-ee><refactoring>","1","158","2011-03-31 18:20:04"
"5508727","'Ruby' way to check for regex match before using captures","<p>In a Ruby Sinatrat app, I'm looking to retrieve some numbers associated with strings that may or may not be present in my input.  For example: ""Cruisers #"" might or might not be present, and the # may be any integer. </p>

<p>In addition, where commas would be in normal English number notation (1,000 for one thousand), there will be a period in this notation (1.000 for one thousand).  </p>

<pre><code>match = /Cruiser\s*([\d.]*)/m.match(report)
match ?
   self.cruiser = match.captures[0].gsub(""."", """") :
   self.cruiser = 0
</code></pre>

<p>Seems like there should be a more compact, 'Ruby'ish way to do this - specifically, I'm looking for a way to combine the regex.match call and the conditional assignment into one statement.  Is this, or any other refactoring, possible here?  Thanks.</p>
","<ruby><regex><refactoring>","0","161","2011-04-01 03:07:00"
"5504672","Help refactor Ruby code","<p>Is there a better way to write this Ruby code? Please help to refactor.</p>

<pre><code>def get_code(val)
    case val
    when 0..20 then 'E2'
    when 20..32 then 'E1'
    when 33..40 then 'D'
    when 41..50 then 'C2'
    when 51..60 then 'C1'
    when 61..70 then 'B2'
    when 71..80 then 'B1'
    when 81..90 then 'A2'
    when 91..100 then 'A1'
    else 'A0'
    end
 end
</code></pre>
","<ruby><refactoring>","0","155","2011-03-31 18:40:07"
"5510929","How to delete jar files and other libraries that i don't need in eclipse?","<p>Somewhere in some of my projects or maybe in eclipse, there are some jar files that i dont use them any more, and now the console displays this warnings every time i build even if it has nothing to do with the current problem:</p>

<pre><code>WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.CalendarTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns582:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.ColumnTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.ColumnsHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns621:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.RowKeyConverterComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.DataFilterSliderTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.RowKeyConverterComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.RowKeyConverterComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.RowKeyConverterComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.RowKeyConverterComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.DataScrollerTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns676:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.DragSupportHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.DropDownMenuTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns691:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.DropSupportHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.FileUploadTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns721:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.GraphValidatorHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns814:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.PageTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.Paint2DTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.PanelMenuGroupTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.webapp.taglib.AjaxComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.ScrollableDataTableTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns886:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.SimpleTogglePanelTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns900:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.RowKeyConverterComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.SuggestionBoxTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.TabPanelTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.HtmlToolTipTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.TreeTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.richfaces.taglib.TreeNodeTagHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.taglib.html.facelets.ActionParamHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns1004:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.webapp.taglib.AjaxComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.webapp.taglib.AjaxComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns1019:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.webapp.taglib.AjaxComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.taglib.html.facelets.IncludeHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class '[ns1044:handler-class: null]' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.taglib.html.facelets.MediaOutputHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.webapp.taglib.AjaxComponentHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.taglib.html.facelets.AjaxPushHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
WARNING: JSF1029:  Application is versioned at 2.0 (either explicitly by the version of /WEB-INF/faces-config.xml or the lack of a /WEB-INF/faces-confg.xml), however class 'org.ajax4jsf.taglib.html.facelets.AjaxSupportHandler' depends on a legacy facelet class.  The facelet artifact represented by this class will not be registered.
</code></pre>

<p>How can i get rid of this libraries and avoid that this message. This is also making eclipse build my projects slower.</p>
","<java><eclipse><java-ee><refactoring><jar>","1","909","2011-04-01 08:38:24"
"5514247","DRYing up some Rails/HAML/jQuery view code","<p>I render an alert bar as a partial at the top of the screen that gets shown to the user for success/failure/notice flash messages.</p>

<p>I finally have it working for most scenarios, but the code itself is repetitive for a few parts and I am not sure how I can split it up more efficiently since I am relatively new to all of this.  My goal is to try not to repeat myself if possible or at least to minimize how much is repeated.</p>

<p>For instance, is there a way to place some of the javascript into a re-useable partial or helper function? Are there other obvious ways of making this code less repetitious?  </p>

<p>I'm not comfortable enough yet with Rails/Ruby to understand how to improve the code, so any tips you can provide are greatly appreciated!</p>

<pre><code>/ top alert area
#topAlertBar.shadow_medium.soft-hidden

- if flash.empty? &amp;&amp; !current_user.confirmed?
  - # User has yet to confirm their account
  - # and there AREN'T any flash messages to show

  #alertBarOffset.colordark.soft-hidden
    / placeholder for alert bar offset

  :javascript
    // Set the flash box content
    $('#topAlertBar').html('Please confirm your account by following the instructions sent to #{current_user.email}.  To resend your confirmation email, #{escape_javascript(link_to(""click here"", user_resend_confirmation_path(current_user), :class =&gt; ""inlinelink"", :method =&gt; :post, :remote =&gt; true))} #{escape_javascript(image_tag(""ajaxOrange.gif"", :class =&gt; ""soft-hidden mls mbs""))}.');

    // Slides down the top alert bar after page load
    $('#topAlertBar, #alertBarOffset').delay(250).slideDown(""fast"");

    // Shows &amp; hides AJAX loading GIF when necessary
    $('#topAlertBar a').click(function() {
      $(document).bind('ajaxSend', function(e, request, options) {
        $(""#topAlertBar img"").show();
      });
      $(document).bind('ajaxComplete', function(e, request, options) {
        $(document).unbind('ajaxSend', 'ajaxComplete');
        $(""#topAlertBar img"").hide();
      });
    });

- elsif !flash.empty? &amp;&amp; !current_user.confirmed?
  - # User has yet to confirm their account
  - # and there ARE flash messages to show

  #alertBarOffset.colordark.soft-hidden
    / placeholder for alert bar offset

  - [:error, :success, :notice].each do |key| 
    - unless flash[key].blank?
      - @msg = flash[key]
      - @key = key

  :javascript
    // Set the flash box content
    var $that = $('#topAlertBar');
    $that.html('#{@msg}').addClass('#{@key}').delay(250).slideDown(""fast"", function() {
      $(this).delay(2000).slideUp(""fast"", function () {
        // Remove any CSS modifiers
        $that.removeClass('#{@key}');

        // Set the flash box content
        $('#topAlertBar').html('Please confirm your account by following the instructions sent to #{current_user.email}.  To resend your confirmation email, #{escape_javascript(link_to(""click here"", user_resend_confirmation_path(current_user), :class =&gt; ""inlinelink"", :method =&gt; :post, :remote =&gt; true))} #{escape_javascript(image_tag(""ajaxOrange.gif"", :class =&gt; ""soft-hidden mls mbs""))}.');

        // Slides down the top alert bar after page load
        $('#topAlertBar, #alertBarOffset').slideDown(""fast"");

        // Shows &amp; hides AJAX loading GIF when necessary
        $('#topAlertBar a').click(function() {
          $(document).bind('ajaxSend', function(e, request, options) {
            $(""#topAlertBar img"").show();
          });
          $(document).bind('ajaxComplete', function(e, request, options) {
            $(document).unbind('ajaxSend', 'ajaxComplete');
            $(""#topAlertBar img"").hide();
          });
        });

      });
    });


- elsif !flash.empty?
  - # User is confirmed
  - # and there ARE flash messages to show

  - [:error, :success, :notice].each do |key| 
    - unless flash[key].blank?
      - @msg = flash[key]
      - @key = key

  :javascript
    // Set the flash box content
    var $that = $('#topAlertBar');
    $that.html('#{@msg}').addClass('#{@key}').delay(250).slideDown(""fast"", function() {
      $(this).delay(2000).slideUp(""fast"");
    });
</code></pre>
","<jquery><ruby-on-rails><refactoring><haml><dry>","0","602","2011-04-01 13:44:27"
"5517733","Best way to refactor this without making as many calls as I am?","<p>I am trying to cycle through a few of these blocks. They basically narrow down a number of people that fulfill a bunch of attributes.</p>

<p>I apologize if this seems really messy, but my database is really taking a toll processing this, and I know there's a better way. I'm just lost on strategy right now.</p>

<p><strong>My Code:</strong></p>

<p>def count_of_distribution</p>

<pre><code>#beginning with an array..
array_of_users = []

# any matching zip codes? ..
# zip_codes
@zip_codes = self.distributions.map(&amp;:zip_code).compact
unless @zip_codes.nil? || @zip_codes.empty? 
  @matched_zips = CardSignup.all.map(&amp;:zip_code) &amp; @zip_codes
  @matched_zips.each do |mz| 
    CardSignup.find(:all, :conditions =&gt; [""zip_code = ?"", mz]).each do |cs|
     array_of_users &lt;&lt; cs.id
    end
  end
end

# any matching interests?..
# interest
@topics = self.distributions.map(&amp;:me_topic).compact
unless  @topics.nil? || @topics.empty?
  @matched_topics = MeTopic.all.map(&amp;:name) &amp; @topics
  @matched_topics.each do |mt|
    MeTopic.find(:all, :conditions =&gt; [""name = ?"", mt]).each do |mt2|
      mt2.users.each do |u|
        array_of_users &lt;&lt; u.card_signup.id if u.card_signup
      end
    end
  end
end

# any matching sexes?..
# sex
@sexes = self.distributions.map(&amp;:sex).compact
unless @sexes.nil? || @sexes.empty?
  @matched_sexes = CardSignup.all.map(&amp;:sex) &amp; @sexes
  @matched_sexes.each do |ms|
    CardSignup.find(:all, :conditions =&gt; [""sex = ?"", ms]).each do |cs|
      array_of_users &lt;&lt; cs.id
    end
  end
end

  total_number = array_of_users.compact.uniq

  return total_number
end
</code></pre>

<p>This is the most embarressing results ever :</p>

<pre><code>Completed in 51801ms (View: 43903, DB: 7623) | 200 OK [http://localhost/admin/emails/3/distributions/new]
</code></pre>

<p><strong>UPDATED ANSWER</strong> It is truncated but still takes a huge toll on the DB</p>

<pre><code>  array_of_users = []

  @zip_codes = self.distributions.map(&amp;:zip_code).compact
  @sexes = self.distributions.map(&amp;:sex).compact

  @zips_and_sexes = CardSignup.find(:all, :conditions =&gt; [""gender IN (?) OR zip_code IN (?)"", my_sexes, my_zips])
  @zips_and_sexes.each{|cs| array_of_users &lt;&lt; cs.id }

  @topics = self.distributions.map(&amp;:me_topic).compact
  @all_topics = MeTopic.find(:all, :conditions =&gt; [""name IN (?)"", @topics])
  array_of_users &lt;&lt; CardSignup.find(:all, :conditions =&gt; [""user_id IN (?)"", @all_topics.map(&amp;:users)]).map(&amp;:id)
</code></pre>
","<ruby-on-rails><ruby><arrays><activerecord><refactoring>","0","154","2011-04-01 19:07:08"
"5518218","Refactoring generic compareTo method","<h2>What am I doing:</h2>

<p>I have a container class named <code>Os</code>, that can contains different type elements and also instances of class <code>Os</code>. When I compare this class, I want to see :</p>

<ul>
<li>shallow equals for elements</li>
<li>deep equals for <code>Os</code> elements</li>
</ul>

<p>I have ensured, that every single element contained in class:</p>

<ul>
<li>Can not be null.</li>
<li>Is comparable to same type elements.</li>
<li>Is immutable. Well, at least part that I'm checking.</li>
</ul>

<p>Following is what I have at the moment. </p>

<h2>Example:</h2>

<p>For example, this test case will pass.</p>

<pre><code>    Os o1 = Os.of(3, 4d, Os.of(""-""));
    Os o2 = Os.of(Os.of(Character.toString('-')), 4.0, new Integer(3));

    assertEquals(o1.toString(), ""[3, 4.0, [-]]"");
    assertEquals(o2.toString(), ""[[-], 4.0, 3]"");
    assertTrue(o1.reverse().compareTo(o2) == 0);
</code></pre>

<h2>Code example:</h2>

<p><code>compareTo</code> method:</p>

<pre><code>@Override
public int compareTo(final Os that) {
    final int BEFORE = -1;
    final int EQUAL = 0;
    final int AFTER = 1;
    int subresult = 0;
    Comparable&lt;?&gt; othis;
    Comparable&lt;?&gt; othat;

    if (that == null)
        return AFTER;
    if (this == that)
        return EQUAL;

    subresult = ((Integer) this.o.size()).compareTo(that.o.size());
    if (subresult &lt; 0)
        return BEFORE;
    else if (subresult &gt; 0)
        return AFTER;

    try {
        for (int i = 0; i &lt; this.o.size(); i++) {
            othis = this.o.get(i);
            othat = that.o.get(i);

            if (othis.getClass() == othat.getClass()) {
                if (othat instanceof Os) {
                    subresult = ((Os) othis).compareTo(((Os) othat));
                    if (subresult &lt; 0)
                        return BEFORE;
                    else if (subresult &gt; 0)
                        return AFTER;
                } else {
                    subresult = hackCMP(othis, othat);
                    if (subresult &lt; 0)
                        return BEFORE;
                    else if (subresult &gt; 0)
                        return AFTER;
                }
            } else {
                subresult = othis.getClass().getName()
                        .compareTo(othat.getClass().getName());
                if (subresult &lt; 0)
                    return BEFORE;
                else if (subresult &gt; 0)
                    return AFTER;
            }
        }
        return EQUAL;
    } catch (SecurityException e) {
        e.printStackTrace();
    } catch (IllegalArgumentException e) {
        e.printStackTrace();
    } catch (NoSuchMethodException e) {
        e.printStackTrace();
    } catch (IllegalAccessException e) {
        e.printStackTrace();
    } catch (InvocationTargetException e) {
        e.printStackTrace();
    }
    return BEFORE;
}

private static int hackCMP(Object val, Object val2)
        throws SecurityException, NoSuchMethodException,
        IllegalArgumentException, IllegalAccessException,
        InvocationTargetException {
    Method m = val.getClass().getMethod(""compareTo"", val.getClass());
    return (Integer) m.invoke(val, val2);
}
</code></pre>

<h2>Question:</h2>

<p>I would like to refactor the code. </p>

<p>For example: </p>

<ul>
<li>I would prefer not using <code>hackCMP</code> method, if possible.</li>
<li><p>Following code segment seems to repeat itself a lot. Can I replace it with something?</p>

<pre><code>        subresult = &lt;expression&gt;;
        if (subresult &lt; 0)
            return BEFORE;
        else if (subresult &gt; 0)
            return AFTER;
        //else ...
</code></pre></li>
</ul>

<p>What can I refactor and how to do it? </p>

<h2>Edit:</h2>

<p>@wolfcastle : Data is stored in <code>private final ImmutableList&lt;Comparable&lt;?&gt;&gt; o;</code>.</p>

<p>I'd like to mention, that every answer was useful. Following seems to work:</p>

<pre><code>@Override
public int compareTo(final Os that) {
    Ordering&lt;Iterable&lt;Comparable&lt;?&gt;&gt;&gt; order = //
    Ordering.natural().&lt;Comparable&lt;?&gt;&gt; lexicographical();
    int result = -1;

    try {
        result = ComparisonChain.start()
                .compare(this.o.size(), that.o.size())
                .compare(this.o, that.o, order).result();
    } catch (Exception e) { //ignore: type mismatch
    }

    return result;
}
</code></pre>
","<java><generics><refactoring>","2","451","2011-04-01 20:00:06"
"5522017","How to go about a large refactoring project?","<p>I am about to start planning a major refactoring of our codebase, and I would like to get some opinions and answers to some questions (I have seen quite a few discussions on similar topics, such as <a href=""http://stackoverflow.com/questions/108141/how-do-i-work-effectively-with-very-messy-legacy-code"">How do I work effectively with VERY messy legacy code</a>,  <a href=""http://stackoverflow.com/questions/330220/strategy-for-large-scale-refactoring"">Strategy for large scale refactoring</a>, but I have some specific questions (at the bottom):</p>

<p>We develop a complex application. There are some 25 developers working the codebase. Total man years put into the product to date are roughly 150.
The current codebase is a single project, built with ant. The high level goal of the project I'm embarking on is to modularize the codebase into its various infrastructures and applicative components.
There is currently no good separation between the various logical components, so it's clear that any modularization effort will need to include some API definitions and serious untangling to enable the separation.
Quality standards are low - there are almost no tests, and definitely no tests running as part of the build process.</p>

<p>Another very important point is that this project needs to take place in parallel to active product development and versions being shipped to customers.</p>

<p>Goals of project:</p>

<ul>
<li>allow reuse of components across different projects</li>
<li>separate application from infrastructure, and allow them to evolve independently</li>
<li>improve testability (by creating APIs)</li>
<li>simplify developers' dev env (less code checked out and compiled)</li>
</ul>

<p>My thoughts and questions:</p>

<ol>
<li>What are your thoughts regarding the project's goals? Anything you would change?</li>
<li>do you have experience with such projects? What would some recommendations?</li>
<li>I'm very concerned with the lack of tests - hence lack of control for me to know that the refactoring process is not breaking anything as i go. This is a catch 22, because one of the goals of this project is to make our code more testable...</li>
<li>I was very influenced by Michael Feathers' <a href=""http://rads.stackoverflow.com/amzn/click/0131177052"" rel=""nofollow"">Working Effectively With Legacy Code</a> . According to it, a bottom up approach is the way to solve my problem - don't jump head first into the codebase and try to fix it, but rather start small by adding unit tests around new code for several months, and see how the code (and team) become much better, to an extent where abstractions will emerge, APIs will surface, etc, and essentially - the modularization will start happening by itself.
Does anyone have experience with such a direction?
As seen in many other questions on this topic - the main problem here is managerial disbelief. ""how is testing class by class (and spending a lot of time doing so) is gonna bring us to a stable system? It's a nice theory which doesn't work in real life"". Any tips on selling this?</li>
</ol>

<p>Any feedback will be greatly appreciated!
Thank you for your time,
Ido</p>
","<refactoring><project-management><legacy>","5","311","2011-04-02 08:08:56"
"5525758","Function profiling woes - Visual Studio 2010 Ultimate","<p>I am trying to profile my application to monitor the affects of a function, both before and after refactoring. I have performed an analysis of my application and having looked at the Summary I've noticed that the <a href=""http://msdn.microsoft.com/en-us/library/ms182398.aspx"" rel=""nofollow"">Hot Path</a> list does not mention any of my functions used, it only mentions functions up to Application.Run()</p>

<p>I'm fairly new to profiling and would like to know how I could get more information about the Hot Path as demonstrated via the <a href=""http://msdn.microsoft.com/en-us/library/ms242741.aspx"" rel=""nofollow"">MSDN documentation</a>;</p>

<p><strong>MSDN Example:</strong></p>

<p><img src=""http://i.stack.imgur.com/QTy3B.jpg"" alt=""MSDN Example""></p>

<p><strong>My Results:</strong></p>

<p><img src=""http://i.stack.imgur.com/CpCiQ.jpg"" alt=""Hot Path Summary""></p>

<p>I've noticed in the Output Window there are a lot of messages relating to a failure when loading symbols, a few of them are below;</p>

<pre><code>Failed to load symbols for C:\Windows\system32\USP10.dll.  
Failed to load symbols for C:\Windows\system32\CRYPTSP.dll.
Failed to load symbols for (Omitted)\WindowsFormsApplication1\bin\Debug\System.Data.SQLite.dll.
Failed to load symbols for C:\Windows\system32\GDI32.dll.  
Failed to load symbols for C:\Windows\WinSxS\x86_microsoft.windows.common-controls_6595b64144ccf1df_6.0.7601.17514_none_41e6975e2bd6f2b2\comctl32.dll.
Failed to load symbols for C:\Windows\system32\msvcrt.dll. 
Failed to load symbols for C:\Windows\Microsoft.NET\Framework\v4.0.30319\nlssorting.dll.
Failed to load symbols for C:\Windows\Microsoft.Net\assembly\GAC_32\System.Data\v4.0_4.0.0.0__b77a5c561934e089\System.Data.dll.  Failed to load symbols for
C:\Windows\Microsoft.Net\assembly\GAC_32\System.Transactions\v4.0_4.0.0.0__b77a5c561934e089\System.Transactions.dll.
Unable to open file to serialize symbols: Error VSP1737: File could not be opened due to sharing violation: - D:\(Omitted)\WindowsFormsApplication1110402.vsp
</code></pre>

<p><em><strong>(Formatted using code tool so it's readable)</em></strong></p>

<p>Thanks for any pointers.</p>
","<c#><visual-studio-2010><refactoring><profiling>","4","1312","2011-04-02 20:48:47"
"5530188","Refactoring a big file in emacs","<p>I'm refactoring a big piece of code in one file in Emacs.</p>

<p>What is the best way to simplify jumping to several places in a big emacs buffer?
Currently I'm using search (C-S) and custom comments - ""markers"".
This becoming quiclkly unreliable.</p>

<p>Ideally I would like to have the same file open in several buffers, so I can switch between them using C-X B.</p>

<p>What are your solutions?</p>
","<emacs><refactoring>","2","218","2011-04-03 14:33:00"
"5530970","Ruby way: catch division by zero","<p>I have the following method to compute an average:</p>

<pre><code>def compute_average(a,b,c,d,e)
  total = [a,b,c,d,e].sum.to_f
  average = [a, 2*b, 3*c, 4*d, 5*e].sum / total
  average.round(2)
end
</code></pre>

<p>It's nothing special, but it has a problem that I expect all average equations have: it might divide by zero if inputs are all zero.</p>

<p>So, I thought of doing this:</p>

<pre><code>def compute_average(a,b,c,d,e)
  total = [a,b,c,d,e].sum.to_f
  if total==0
    average = 0.00
  else
    average = [a, 2*b, 3*c, 4*d, 5*e].sum / total
    average.round(2)
  end
end
</code></pre>

<p>... and that works, but it feels kludgy to me. Is there a more elegant, ""Ruby Way"" to avoid this division by zero problem?</p>

<p>What I'm wishing I had was an ""unless then"" operator, like...</p>

<pre><code>average = numerator / denominator unless denominator == 0 then 0
</code></pre>

<p>Any suggestions?</p>
","<ruby><refactoring><division-by-zero>","2","301","2011-04-03 16:48:44"
"5527233","RSpec: DRY way to test a set of values","<p>I have a <code>vote</code> model, which has a class method called <code>score</code>. Basically, I created a mathematical equation in a spreadsheet, and am attempting to reproduce this in ruby. However, my first go isn't working, so I really need to start adding a ton more tests.</p>

<p>The way I'd like to go about testing this is to take a stack of input and output values from my spreadsheet and test them each. So basically, the tests could be construed to look like this:</p>

<pre><code> inputs = [a,b,c] ... score.should == x
 inputs = [a,b,c,d] ... score.should == y
 inputs = [c,d] .... score.should == z
</code></pre>

<p>However, the shortest way I've actually found to write this in RSpec is giving an example for each case, approximately like this (simplified example, but should give you the idea):</p>

<pre><code>it ""should have a score of X"" do
  test_object = Votable.new(...)
  @user1.vote.create(:value=&gt;##, :votable=&gt;test_object)
  @user2.vote.create(:value=&gt;##, :votable=&gt;test_object)
  @user3.vote.create(:value=&gt;##, :votable=&gt;test_object)
  test_object.votes.score.should == X
end
</code></pre>

<p>So, the above works, but its a load of text for each example case, and to iron out the kinks and provide good test coverage I'd like to run about 20 or so test cases.</p>

<p>So, seriously, there must be a simpler way to set this up one time and then test a bunch of possible input/output combinations, right? Can anyone suggest a DRY way to do this kind of test in RSpec?</p>

<p>Thanks!</p>
","<ruby-on-rails><ruby-on-rails-3><refactoring><rspec><dry>","1","194","2011-04-03 02:44:26"
"5527484","Refactoring Problem XCode 4.0.1","<p>So i was trying to refactor the name of a class in XCode following the steps in my text book. I'm sure I'm doing everything right and I downloaded XCode off the App Store. Basically, whenever I right-click -> refactor -> name -> preview, xcode crashes. Here's the error:</p>

<p><code>
ASSERTION FAILURE in /SourceCache/DVTFoundation/DVTFoundation-227/Framework/Classes/Utilities/DVTTask.m:208</p>

<p>Details:  The launch path must be set before launching.</p>

<p>Object:   </p>

<p>Method:   -launchRunningTerminationHandlerOnQueue:error:terminationHandler:</p>

<p>Thread:   {name = (null), num = 15}</p>

<p>Hints:   None
</code></p>

<p>Any Ideas? </p>

<p>Thanks</p>

<p>P.S., sorry, i dont know how to using the quotes</p>

<p>EDIT: Fixed. I reinstalled with the package in side resources under ""Show Package Contents"" -> Resources -> XCODE and IOS SDK</p>
","<objective-c><refactoring>","1","362","2011-04-03 04:04:14"
"5538922","ASP.NET common functions","<p>I've got a complicated ASP.NET project (ASP.NET 2.0) and i'm trying to refactor the code a little. </p>

<p>Every page extends a base page called GenericPage which has a set of functions which are used in the page life-cycle (functions which access the session/HttpApplicationState object). There are also quite a few user controls which do a similar thing but extend a separate base class.</p>

<p>We are starting re-implement a lot of the code to use WebServices and they need to have access to the same functions. The WebServices will extend GenericWebService. </p>

<p>What's the best way to architect this given that both cannot extend from the same class given that one extends Page and one extends WebService? I don't want to duplicate the code in 3 separate base classes as it is getting increasingly difficult to maintain.</p>

<p>Is there a common place that I can put these non-static functions?</p>

<p>Thanks</p>
","<c#><refactoring><asp.net-2.0><multiple-inheritance>","2","283","2011-04-04 13:08:55"
"5549407","Refactoring tool in Eclipse","<p>My need is pretty simple: I want to change a method call <code>objClass1.method1()</code> by a call <code>objClass2.method2()</code> in my whole Eclipse project. Unfortunately, I can't find a plugin able to do this. Can you help?</p>

<p><strong>Edit:</strong> </p>

<p>To be more accurate, <code>objClass1</code> is part of a third party library, so I need to change the method calls. I can't start at the method definition. When I right-click on a method1 call, I have no ""rename"" option in my ""Refactor"" menu.</p>

<p>I don't want to change or rename my methods. I want to exchange one call by another in my whole project.</p>

<p>An example of what needs to be done:</p>

<p>Before refactoring:</p>

<pre><code>Injector injector=Guice.createInjector(new IContactModule());
</code></pre>

<p>After refactoring:</p>

<pre><code>Injector injector=IContactInjectorSingleton.getInjector();
</code></pre>

<p>And this needs to be done a several points in my project.</p>
","<java><eclipse><refactoring><eclipse-plugin>","3","427","2011-04-05 08:53:00"
"5550160","Is there any tools to help me refactor a method call from using position-based to name-based parameters","<p>I wish to transform code like:</p>

<pre><code>var p = new Person(""Ian"", ""Smith"", 40, 16)
</code></pre>

<p>To:</p>

<pre><code>var p = new Person(surname: ""Ian"", givenName:""Smith"", weight:40, age:16)
</code></pre>

<p>As a first step in making the code more readable,  I am willing to use a 3rd party refactoring tool if need be.</p>

<p>(Please do not tell me to use parameter objects and factor methods etc, these may come later once I can at least read the code!)   </p>
","<c#><c#-4.0><refactoring><named-parameters>","4","217","2011-04-05 10:01:59"
"5552994","How do I get rid of duplication in ruby when using clone?","<p>This method is just changing the id for any player_id that is found.  Reek hates it, but I can't find a way to refactor it in a meaningful way.</p>

<pre><code>(1..9).each { |n|
    n = n.to_s
    self.player_ids[n] = self.site_id.clone &lt;&lt; ""_"" &lt;&lt; self.player_ids[n].clone if self.player_ids[n]        
}
</code></pre>

<p>Do I just have to live with this duplication because the clone function doesn't allow me to:</p>

<pre><code>player_id = self.player_ids[n]
player_id = self.site_id.clone &lt;&lt; ""_"" &lt;&lt; player_id.clone if player_id
</code></pre>

<p>Sample input:</p>

<pre><code>{:player_ids =&gt; {""2"" =&gt; ""player_name1"", ""6"" =&gt; ""player_name4"", ""9"" =&gt; ""player_name9""}
</code></pre>

<p>output:</p>

<pre><code>{:player_ids =&gt; {""2"" =&gt; ""PRE_player_name1"", ""6"" =&gt; ""PRE_player_name4"", ""9"" =&gt; ""PRE_player_name9""}
</code></pre>
","<ruby><refactoring>","1","54","2011-04-05 13:54:22"
"5555572","C#: how to refactor when reflection is used to get methods by name?","<p>Suppose I get a MethodInfo in the following way:</p>

<pre><code>Assembly assembly = Assembly.Load(assemblyName);
Type type = assembly.GetType(nameSpaceName+"".""+className);
MethodInfo mi = type.GetMethod(""myMethod"", bf); // bf are the binding flags.
</code></pre>

<p>But later I decide to change the case/name of <code>myMethod</code>.</p>

<p>Is there a way to either:</p>

<ol>
<li>Refactor so that it changes the name in the string.</li>
<li>Change the reflection call so it gets the method without using the method's name as a string?</li>
</ol>

<p>The reason for this is so I can test my code which requires the use of reflection, but I'd rather not require that nobody ever change the name of the methods in the code.</p>
","<c#><reflection><refactoring>","2","192","2011-04-05 17:00:49"
"5546909","""Extract Variable"" in Visual Studio without ReSharper","<p>I don't have ReSharper at my current gig, and I miss the ""Extract Variable"" refactoring. I understand that it's possible to write your own refactoring ""snippet"" in VS. Does anybody have one that does this? </p>
","<visual-studio-2010><refactoring><code-snippets>","5","147","2011-04-05 03:36:53"
"5548374","How to rename/refactor a variable in Eclipse PDT in a Netbeans-like way","<p>In the NetBeans IDE, changing a variable name in the parameters of a function also changes all occurrences of that name in the function. How can I get that behavior with Eclipse PDT? There is a <strong>Refactor &rarr; Rename</strong> item in the context menu, but it let me refactor only the file name.</p>

<p>This issue has been open since 2006 and you can vote for it in <a href=""https://bugs.eclipse.org/bugs/show_bug.cgi?id=149818"" rel=""nofollow"">the PDT bug tracker #149818</a>. </p>
","<eclipse><refactoring><rename><pdt>","5","945","2011-04-05 07:05:43"
"5572324","Is it logical to use generics here?","<p>Originally the code is like this:</p>

<pre><code>public interface IApplicableSystem
{
    string Name { get; }

    void Apply ( );
}

public class Effector
{
    public string Name { get; set; }
}

public class EffectSystem : IApplicableSystem
{
    Effector Internal { get; set; }

    public string Name
    {
        get { return this.Internal.Name; }
    }

    RelayCommand applyCommand;
    public ICommand ApplyCommand
    {
        get
        {
            if ( applyCommand == null )
                applyCommand = new RelayCommand ( p =&gt; this.Apply ( ) );

            return applyCommand;
        }
    }

    public void Apply ( )
    {

    }

    public EffectSystem ( Effector value )
    {
        this.Internal = value;
    }
}
</code></pre>

<p>So there are many different types implementing <code>IApplicableSystem</code>, all where they differ is their <code>Name</code> property, <code>Apply</code> method and the type of the private <code>Internal</code> property that's used inside the class.</p>

<p>Should I use generic to make them like this?:</p>

<p>Is this reasonable? Mainly this reduces the amount of code in the other types implementing <code>IApplicableSystem</code>.</p>

<pre><code>public abstract class GenericSystem&lt;T&gt; : IApplicableSystem
{
    protected T Internal { get; set; }

    public virtual string Name
    {
        get { return String.Empty; }
    }

    RelayCommand applyCommand;
    public ICommand ApplyCommand
    {
        get
        {
            if ( applyCommand == null )
                applyCommand = new RelayCommand ( p =&gt; this.Apply ( ) );

            return applyCommand;
        }
    }

    public virtual void Apply ( )
    {

    }

    public GenericSystem ( T value )
    {
        this.Internal = value;
    }
}

public class EffectSystemGeneric : GenericSystem&lt;Effector&gt;
{
    public override string Name
    {
        get { return GetUniqueName ( base.Internal.Name ); }
    }

    public override void Apply ( )
    {
        Console.WriteLine ( ""Do something"" );
    }
}
</code></pre>
","<c#><.net><generics><refactoring>","1","119","2011-04-06 20:07:11"
"5579247","How to simplify choice (if)","<p>I have such a code as to make it better (modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1); - sending data to the controller)</p>

<pre><code> public class RecipeDosings
 {
    public string Product { get; set; }
    public string Persent { get; set; }
    public string Massa { get; set; }
    public string Bunker { get; set; }

    public RecipeDosings(string product, string persent, string massa, string bunker)
    {
        this.Product = product;
        this.Persent = persent;
        this.Massa = massa;
        this.Bunker = bunker;
    }
  }

 public List&lt;RecipeDosings&gt; resipeDosings = new List&lt;RecipeDosings&gt;();

        for (int i = 0; i &lt; resipeDosings.Count; i++)
        {
            if (resipeDosings[i].Bunker == ""Bunker 1"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);      
            }
            if (resipeDosings[i].Bunker == ""Bunker 2"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);
            }
            if (resipeDosings[i].Bunker == ""Bunker 3"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);
            }
            if (resipeDosings[i].Bunker == ""Bunker 4"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);
            }
            if (resipeDosings[i].Bunker == ""Bunker 5"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);
            }
            if (resipeDosings[i].Bunker == ""Bunker 6"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);
            }
            if (resipeDosings[i].Bunker == ""Bunker 7"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);
            }
            if (resipeDosings[i].Bunker == ""Bunker 8"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);
            }
            if (resipeDosings[i].Bunker == ""Bunker 9"")
            {
                modbus_master.SetValue(""x1"", Convert.ToInt32(resipeDosings[i].Massa) * 10, 1);
            }
        }
</code></pre>
","<c#><refactoring>","0","110","2011-04-07 09:58:25"
"5585146","Auto refactoring to string.Format","<p>I have a c# project in VS2008 that have a lot of lines of code that look like this:</p>

<pre><code>string s = ""bla blab"" + x + ""bla bla bla"" + y + .... ;
</code></pre>

<p>and I would like to covert those strings to a single string using string.Format(...).</p>

<p>I am currently using Resharper 5.0, and I can refactor a single line of code with one click.
The problem is that I have more that a 1000 lines like this, and I don't want to manually go over each line.</p>

<p>Is there a way to do this automatically? </p>

<p>Edit:
As Marc corrected me, I dont really need to do it,
but I have another very similar problem:
I got this code</p>

<pre><code> string s = ""aaaaaaaaaaaaaaaaaaaaaaaa"" +
                   ""aaaaaaaaaaaaaaaaaaaaaaaa"" +
                   ""aaaaaaaaaaaaaaaaaaaaaaaa"" +
                   ""aaaaaaaaaaaaaaaaaaaaaaaa"" +
                   ""aaaaaaaaaaaaaaaaaaaaaaaa"" +
                   ""aaaaaaaaaaaaaaaaaaaaaaaa"" +
                   ""aaaaaaaaaaaaaaaaaaaaaaaa"";
</code></pre>

<p>(the string is some sql query)</p>

<p>and I'd like to refactor it to one const string:</p>

<pre><code>string s = ""aaaaaaaaaaaaaaaaaa....aaaaa"";
</code></pre>

<p>(this time, it is more efficient, right?)</p>

<p>resharper can do this automatically per string,
but again, I'd like to do it a lot of times.</p>

<p>it would be great to keep the lines indentation:</p>

<pre><code>string s = @""aaaaaaaaaaaaaaaaaaaaaaaa
                    aaaaaaaaaaaaaaaaaaaaaaaa
                    aaaaaaaaaaaaaaaaaaaaaaaa
                    aaaaaaaaaaaaaaaaaaaaaaaa
                    aaaaaaaaaaaaaaaaaaaaaaaa
                    aaaaaaaaaaaaaaaaaaaaaaaa
                    aaaaaaaaaaaaaaaaaaaaaaaa"";
</code></pre>

<p>but just one long line is ok too.</p>

<p>thanks,
Lev.</p>
","<c#><visual-studio><string><automated-refactoring>","1","164","2011-04-07 17:31:40"
"5597173","Long parameter list where a group of parameters can be grouped to an existing class, but these parameters are not gleaned from an object","<p>The below code is the Long Parameter List Smell method.</p>

<pre><code>// Long Parameter List Smell
public void paint (Graphics gr, 
                   double x, double y, double width, double height,
                   Boolean shouldValidate){.....}
</code></pre>

<p>The below code is the caller method calling the above smell.</p>

<pre><code>// Caller
public void someMethod(......){
    double x = someMethod();
    double y = 200;
    double width = 100;
    double height = width/2;
    paint(gr, x, y, width, height, true);
}
</code></pre>

<p>We can notice that the parameters double x, double y, double width and double height sound like a <strong>Rectangle</strong> object. These parameter are not gleaned from an object so we cannot use Preserve Whole Object. The next option is Introduce Parameter Object. However,there is already the class Rectangle2D.Double that is the class in Java Library existing. </p>

<p>Should I group these parameters into the object of Rectangle2D.Double? The code that is refactored will be like the below. If it is ok to refactor this way. What can I call this type of refactoring?</p>

<pre><code>// Long Parameter List Smell
public void paint (Graphics gr, 
                    Rectangle2D.Double rec
                    Boolean shouldValidate){.....}


// Caller
public void someMethod(......){
    double x = someMethod();
    double y = 200;
    double width = 100;
    double height = width/2;        
    paint(gr, 
          new Rectangle2D.Double(x, y, width, height), 
          true);
}
</code></pre>
","<refactoring><code-smell><long-parameter-list>","0","146","2011-04-08 15:18:18"
"5600257","Factoring/Refactoring a program","<p>What does the term 'poorly factored' and 'refactoring' a program mean? Can you give a simple example to understand the basic difference ?</p>
","<c++><refactoring>","1","268","2011-04-08 20:07:40"
"5581165","Add simple business logic to repository in ASP>NET MVC 3 C#","<p>I have a question concerning an issue that has already been disputed many times in stackoverflow (I apologize for this) but no general answer has ever been given because of the subjectivity of the topic from one case to another: can we add business logic to the repository layer according to the repository pattern?
I have an MVC 3 application with ViewModels (that means I don't use the ViewData at all). The model is an LinqtoSQL EF of course connected to a database. Currently I am accessing the entities directly from the controllers which contain all the business logic and I wrap the data needed for the Views in specific ViewModels.
Now I am starting to refactor and I realized that the best way to avoid code duplication, besides optimizing the ViewModels, is to delegate all the queries to a repository, which communicates with the EF, and create tailored methods to be used by the controller.
Now, taking into account that I would like the repository to return actual objects and not expressions, I was thinking about delegating small pieces of business logic to the repository in order to make my code clearer. 
However for the sake of loose coupling, I would like to have your opinion. In the code shown below (which currently resides in the controller) all the variables except 
<strong>lprojectionPercactualValue</strong> are taken from the database. Therefore I wanted to move this piece of code to the repository and call a method with signature:</p>

<pre><code>public string getColor (int ItemId, float lprojectionPercactualValue);
</code></pre>

<p>The method needs the <strong>ItemId</strong> in order to retrieve the values specific for that Item. 
What do you think about this design decision? Is it better to leave the code in the controller, move to another method still in the controller (create a method or even a class dedicated) or move it to the repository as explained? </p>

<pre><code>if (litem.Ascending == true)
{
    if (lprojectionPercactualValue &lt; lminThreshold)
    {
        lcolor = ""RED"";
    }
    else if (lprojectionPercactualValue &gt; lminThreshold &amp;&amp; lprojectionPercactualValue &lt; lmedThreshold)
    {                                   
        lcolor = ""YELLOW"";
    }
    else //(percValue &gt;= item.Max_Threshold)
    {
        lcolor = ""GREEN"";
    }
}

else
{
    if (lprojectionPercactualValue &gt; lminThreshold)
    {
        lcolor = ""RED"";
    }
    else if (lprojectionPercactualValue &lt; lminThreshold &amp;&amp; lprojectionPercactualValue &gt; lmedThreshold)
    {
        lcolor = ""YELLOW"";
    }
    else //(percValue &lt;= item.Max_Threshold)
    {
        lcolor = ""GREEN"";
    }
}
</code></pre>
","<c#><asp.net-mvc-3><refactoring><repository-pattern><design-decisions>","1","790","2011-04-07 12:40:25"
"5581898","Extract nested try/finally blocks","<p>How would you ""extract"" nested try/finally blocks from a routine into a reusable entity? Say I have</p>

<pre><code>procedure DoSomething;
var
  Resource1: TSomeKindOfHandleOrReference1;
  Resource2: TSomeKindOfHandleOrReference2;
  Resource3: TSomeKindOfHandleOrReference3;
begin
  AcquireResource1;
  try
    AcquireResource2;
    try
      AcquireResource3;
      try
        // Use the resources
      finally
        ReleaseResource3;
      end;
    finally
      ReleaseResource2;
    end;
  finally
    ReleaseResource1;
  end;
end;
</code></pre>

<p>and want something like</p>

<pre><code>TDoSomething = record // or class
strict private
  Resource1: TSomeKindOfHandleOrReference1;
  Resource2: TSomeKindOfHandleOrReference2;
  Resource3: TSomeKindOfHandleOrReference3;
public
  procedure Init; // or constructor
  procedure Done; // or destructor
  procedure UseResources;
end;

procedure DoSomething;
var
  Context: TDoSomething;
begin
  Context.Init;
  try
    Context.UseResources;
  finally
    Context.Done;
  end;
end;
</code></pre>

<p>I want this to have the same exception-safety as the nested original. Is it enough to zero-initialize the ResourceN variables in <code>TDoSomething.Init</code> and do some <code>if Assigned(ResourceN) then</code> checks in <code>TDoSomething.Done</code>?</p>
","<delphi><refactoring><extract><try-finally>","0","274","2011-04-07 13:31:18"
"5603108","Builder Pattern or Telescoping constructor pattern- like pattern is better","<p>According to Effective Java 2ed <em>Item 2</em></p>

<blockquote>
  <p><strong>telescoping constructor pattern</strong>, in
  which you provide a constructor with
  only the required parameters, another
  with a single optional parameter, a
  third with two optional parameters,
  and so on, culminating in a
  constructor with all the optional
  parameters.</p>
</blockquote>

<p>An example of constructors of the class applying this pattern is borrowed from <a href=""http://stackoverflow.com/questions/328496/when-would-you-use-the-builder-pattern"">When would you use the Builder Pattern?</a></p>

<p><em>code set 1a</em></p>

<pre><code>Pizza(int size) { ... }        
Pizza(int size, boolean cheese) { ... }    
Pizza(int size, boolean cheese, boolean pepperoni) { ... }    
Pizza(int size, boolean cheese, boolean pepperoni, boolean bacon) { ... }
</code></pre>

<p>size is a <em>required</em> parameter.
cheese, pepperoni, and bacon are <em>optional</em> parameters.
Supposing that I would like to provide the constructor like below.</p>

<p><em>code set 1b</em></p>

<pre><code>Pizza(int size) { ... }        
Pizza(int size, boolean cheese) { ... }    
Pizza(int size, boolean pepperoni) { ... }    
Pizza(int size, boolean cheese, boolean pepperoni, boolean bacon, int price, int) { ... }
</code></pre>

<p>Another example is that</p>

<p><em>code set 2</em></p>

<pre><code>public AttributeKey(String key, Class&lt;T&gt; clazz)
public AttributeKey(String key, Class&lt;T&gt; clazz) 
public AttributeKey(String key, Class&lt;T&gt; clazz, @Nullable T defaultValue, boolean isNullValueAllowed)
public AttributeKey(String key, Class&lt;T&gt; clazz, @Nullable T defaultValue, boolean isNullValueAllowed, @Nullable ResourceBundleUtil labels)
</code></pre>

<p>The <strong>two latest example</strong> I gave <strong>didn't follow the characteristic of telescoping constructor</strong> as code set 1a did</p>

<ol>
<li>Are code set 1b and 2 included in telescoping constructor? if not, what is it called?</li>
<li>Comparing to using Builder Pattern, which one (between Builder and pattern of code set 1a,2) provides more benefits</li>
</ol>
","<design-patterns><parameters><constructor><refactoring><code-smell>","1","668","2011-04-09 05:30:32"
"5626521","C++ where I'll need local extension or foreign method?","<p>I'm not familiar with C++ enough to know where those 2 very similar refactorings (introduce local extension and introduce foreign method) will be needed. I know cases that forces to use those, but I can't figure sample classes that will need this ""trick"". I'm making C++ refactoring tutorial, to help new developers, but it looks like I need yours help too :)</p>

<p>If you used it, please tell me in where and why. Thanks in advance.</p>
","<c++><design-patterns><refactoring>","0","124","2011-04-11 19:34:45"
"5640829","Tool for helping with deduplication of Perl code?","<p>I'm looking for some tool/library that would scan given project tree, and report on code duplicates - i.e. blocks of code that are repeated in various files.</p>

<p>Is there anything like this?</p>

<p>As it is now, I have to view them (files) all, and search for duplicates, but it doesn't strike me as very efficient.</p>
","<perl><refactoring><code-duplication><deduplication>","3","162","2011-04-12 19:54:41"
"5641945","How can I refactor to get rid of an instance variable?","<p>I have tons of methods like this:</p>

<pre><code>def lab1
  setup
  business_processing
rescue Exception =&gt; e
  handle_error('custom error message for lab1', e)
end

def lab2
  setup
  business_processing
rescue Exception =&gt; e
  handle_error('custom errror message for lab2', e)
end
</code></pre>

<p>I refactored the code above into something like this:</p>

<pre><code>def lab1
  with_setup_and_error_handling do
    @error_message = 'error in lab1'
    business_processing
  end
end

def with_setup_and_error_handling(&amp;block)
  setup
  block.call
rescue Exception =&gt; e
  handle_error(@error_message, e)
end
</code></pre>

<p>The new code works but it causes <code>error_message</code> to be an instance variable. Is there a better way to refactor it?</p>

<p>When someone looks at the refactored code they see the instance variable, but it is not clear where it is being used so I am not happy with it.</p>
","<ruby><refactoring>","1","78","2011-04-12 21:39:21"
"5645683","One parameter or many","<p>I have two methods:</p>

<pre><code>BuildThing(Thing a);
BuildThings(IEnumerable&lt;Thing&gt; things);
</code></pre>

<p>Is this good from a clean code point of view?
Or is maybe it would be better to just use BuildThings and pass IEnumerable with only one Thing? Or use params?</p>

<p>Thanks.</p>
","<c#><methods><parameters><refactoring>","5","106","2011-04-13 07:14:37"
"5657433","How to handle the refactoring phase of TDD","<p>In the course of a TDD session, suppose I write a failing test, and then make it pass. I refactor by extracting code out of the original Unit, using refactorings such as Extract Class and Move Method. Now further suppose that my original test no longer covers the extracted code because the original code now mocks out its dependencies, as is correct for a Unit test.</p>

<p>Is it proper to go back and retrofit tests onto the extracted code? Or did I make a mistake in how I ended up with untested code during a refactoring? It feels like as my codebase is scaling, and I have to refactor, I'm retrofitting a lot of tests onto refactored code. This feels really awkward. Am I refactoring wrong?</p>
","<unit-testing><refactoring><tdd>","3","94","2011-04-14 00:59:57"
"5666415","Is it bad practice to remove and combine regression tests to speed up testing?","<p>I'm working on an app that integrates with a 3rd party web service. I currently have separate  integration / regression tests that call the web service to do the following:</p>

<ul>
<li>Modify Policy - Add Vehicle</li>
<li>Modify Policy - Remove Vehicle</li>
<li>Modify Policy - Add Multiple Vehicles</li>
<li>Modify Policy - Add Insured</li>
<li>...</li>
</ul>

<p>Most of these tests were created as bugs were found &amp; fixed. The 3rd party web service is slooow and I'm trying to speed the testing process up. Because each test calls the web service, combining them into one test that only calls the web service once would make things much faster.</p>

<p>Would combining these tests be bad practice because each test was written for a specific bug? My concern is that a mistake in refactoring could potentially allow a bug to be re-introduced later on.</p>
","<testing><language-agnostic><refactoring><integration-testing><regression-testing>","2","75","2011-04-14 16:26:59"
"5668891","Foo() vs this.Foo()","<p>I have a co-worker who uses a C# refactoring tool. The tool for some reason perfers:</p>

<pre><code>this.Foo()
</code></pre>

<p>over</p>

<pre><code>Foo()
</code></pre>

<p>Now we've asked him to turn it off simply because it's annoying to have all the code re-written automatically, but that's not the point.</p>

<p>Am I missing something, or is this just wrong? Why on earth would I want <code>this.Foo()</code>?</p>
","<c#><refactoring>","5","159","2011-04-14 19:54:04"
"5672809","Best Practices for Refactoring Test Code","<p>I currently have a job in QA and at my company everyone in QA writes automated tests. Recently I have been reading <a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">Refactoring: Improving the Design of Existing Code</a> by Martin Fowler. I have come to realize that a lot of our test classes and test utilities are very messy, redundant, and in dire need of refactoring. </p>

<p>Especially since I've been reading up on the topic, I am eager to dive in and clean things up, but there is one problem. In his book, Fowler emphasizes that unit testing the code under refactor is essential to prevent bugs from being introduced. Since the code I am trying to refactor is test code, it seems kind of silly to unit test it. Do any of you guys have suggestions on how to refactor or even design test code? Also, if it helps, the test framework we use is built on top of JUnit and therefore the test classes I'm referring to are descendants of TestCase.</p>

<p>Thanks!</p>
","<refactoring><automated-tests>","1","198","2011-04-15 05:42:21"
"5677573","Refactoring a sequence of pattern matching","<p>I have the following piece of code (shortened for the example):</p>

<pre><code>while (reader.ready()) {
    String line = reader.readLine();

    Matcher responseCodeMatcher = responseCodePattern.matcher(line); 
    if (responseCodeMatcher.matches()) {
        responseCode = Integer.parseInt(responseCodeMatcher.group(1));
        continue;
    }

    Matcher cacheControlMatcher = cacheControlPattern.matcher(line); 
    if (cacheControlMatcher.matches()) {
        cacheControl = CacheControl.parseString(responseCodeMatcher.group(1));
        continue;
    }

        ...

}
</code></pre>

<p>The patterns are all static final members of the class.
So I have a bunch of patterns and I want to find out for every line if it matches one of them, and if so - do something (which changes from pattern to pattern). Can you think of a way to nicely refactor this somehow? Perhaps a Collection of Patterns that I go over (and then how do I know what to do if it matches?) or some other idea.</p>
","<java><regex><refactoring>","2","144","2011-04-15 13:34:12"
"5677997","Refactoring lambda to method for event","<p>How to refactor a lambda event handler to the classical method using Resharper or Visual studio refactoring tools? The problem, apparently, because of closure. And it is not always possible to convert lambda event handler to the method.</p>
","<c#><events><lambda><refactoring><resharper>","0","125","2011-04-15 14:09:55"
"5679199","refactoring a database and application due to new requirements","<p>My application manages customer's complaints <strong>and has already been deployed into production</strong>. Each complaint has a code to identify it (for eaxmple ""late delivery""  ), a ""department"" type (wich is essentially the department responsible for that kind of complaint) and another ""model"" code which identifies the route through department's employees this complaint dossier has to follow (first to hr responsible then to hr big boss finally back to customer care). Each dossier has some common info and can have department specific infos, that's why i need deparment code.
For example Customer care get a complaint about ""rudeness"" of a call center operator, opens a dossier with code ABC and type ""HR"" (there's could be more HR dossier types). When the customer care has filled all the infos, forward it to hr(a mail is sent to the user configured in the system as HR responsible ). The hr employee fills his own section and send it back to customer care.</p>

<p>Till now each complaint code might have only one department and one model, now requirements have changed and i've two problems:</p>

<ol>
<li>Some complaints are identified by the same code but might be due to different departments . For example a complaint about employees rudeness could be sent to the department which rules the call centers or to the department which rules logistics</li>
</ol>

<p>i could solve this simply extending the table primary key to include the department (hoping they'll not decide the same code for the same department can follow different routes), changing application code might be a bit painful but it can be done : </p>

<p>Does extending primary keys to composite keys is a problem in Oracle or have side effects on existing records? the actual primary key is not used as foreign key anywere and all fields are filled.</p>

<ol>
<li>this is a quite more difficult problem (at least for me): marketing department (the rulers) wants a special dossier.They monitor time departments take to answer complaints and open a new type of dossier if they exceeds the standard time.
For the above example, if hr always needs the 30% more time to complete employees rudeness dossiers, marketing can open an ""inquire"" dossier about that complaint code directed to hr.<br>
Now, referring to point 1, i could add a new record for each complaint code having the second part of the key being the marketing code and associating it to a new model.This is going to double the rows of the table (which is already quite large). I see it very error prone for inserting new complaint codes. </li>
</ol>

<p>I know it's very hard to give an opinion without being able to see the schema and the code, but i would appreciate your opinion anyway</p>
","<oracle><database-design><refactoring>","1","90","2011-04-15 15:43:53"
"5682451","Is there any way to tell IntelliJ IDEA not to look at files during a search/replace or during refactorings?","<p>Basically my question is the topic ^</p>

<p>I have 4 files that are massive. I need to put them in resources under my maven project structure. Whenever I do a string-based refactoring or search/replace... I basically want the IDE to ignore these files altogether.</p>

<p>Yes, I know I can exclude them and do the replacements manually... but like I said, I want to remove any possibility that they can be modified through the IDE (without having to write-protect them I guess, or revert them all the time if the version control says they've been modified).</p>

<p>Is there any way I can exclude these files?</p>
","<file><refactoring><intellij-idea><search-and-replace><exclude>","4","358","2011-04-15 21:17:00"
"5682672","Help with creation of refactoring plugins in Eclipse?","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/1314208/writing-a-new-refactoring-plugin-for-eclipse"">Writing a new refactoring plugin for Eclipse?</a>  </p>
</blockquote>



<p>I'm looking for a way to add one or two refactorings to the Eclipse IDE (for Java code).</p>

<p>My idea was going to use some of the refactorings already available to implement my own although I am not sure this is entirely possible. I googled a bit but didn't find any info on which dependencies I must add to make my plugin capable of using Eclipse's already available refactoring classes.</p>

<p>If I'm able to use Eclipse's refactoring classes for my own purposes I won't even have to delve deep in Eclipse's AST stuff, which would definitively be a big plus.</p>

<p>Anyone has any info on this? Has anyone some experience in coming up with refactoring plugins?</p>

<p>Thanks</p>
","<java><eclipse><plugins><ide><refactoring>","2","142","2011-04-15 21:46:14"
"5684479","Help with automated renaming in C++","<p>Here is my issue: </p>

<p>I have a large library of code where all of the class names begin with Agui. For example:</p>

<pre><code>class AguiWidget
{

};

class AguiBitmap
{

};
</code></pre>

<p>also, all the hpp and cpp files are named like this also:
AguiWidget.hpp</p>

<p>etc.</p>

<p>The library also does not use a namespace.</p>

<p>all of the enums begin and use Agui:
ex:</p>

<pre><code>enum AguiKeyEnum
{
   AGUI_KEY_SPACE,
   AGUI_KEY_ENTER
};
</code></pre>

<p>The include guards also use ex:
AGUI_WIDGET_HPP</p>

<p>So,</p>

<p>My task is to remove all the Agui, AGUI references from the entire project (all the classes and enums), then to encapsulate all the classes into namespace agui.</p>

<p>What would be the easiest way to do this. I also need the hpp and cpp files to no longer have Agui in the filename.</p>

<p>I use MSVC 2008 as an IDE if that helps.</p>

<p>Thanks!</p>
","<c++><refactoring><automated-refactoring>","4","211","2011-04-16 04:29:46"
"5687903","PHP: Time & Date: easy substr problem, Need to split date and time from 1 string","<p>I have this string from eBay Web-Service.  </p>

<blockquote>
  <p>// 2Days  23Hours 37Minutes 50Seconds<br>
  $string = P2DT23H37M50S  <br/></p>
</blockquote>

<p>I was using the following code to extract and time and date:</p>

<blockquote>
  <p>$daysLeft = substr($string, 1, 1) . "" Days"";<br>
      $hoursLeft = substr($string, 4, 2) . "" Hours"";<br>
      $minutesLeft = substr($string, 7, 2) . "" Minutes"";<br>
      $secondsLeft = substr($string, 10, 2) . "" Seconds"";  </p>
</blockquote>

<p>But the problem is, When the hours, minutes and dates are only 1 Digit, the strings gets all messed up, I had it working initially, but Im kind of stuck to find a simple way to do it, I was going to write it in a bunch of If statements, but really want a more simple way to do this.</p>
","<php><web-services><refactoring><ebay><substr>","1","173","2011-04-16 16:30:33"
"5695835","exception has been caught while processing the refactoring 'Rename package'","<p>This refactoring function in Eclipse for package names used to work for me fine until... today:</p>

<p>This is the first time I am receiving this weird Refactoring error, and I have no idea what to make of it:</p>

<blockquote>
  <p>An exception has been  caught while
  processing the refactoring 'Rename
  Package'.</p>
  
  <p>Reason: Problems encountered while
  moving resources.</p>
  
  <p>Click 'Undo' to undo all successfully
  executed changes of the current
  refactoring. Click 'Abort' to abort
  the current refactoring.</p>
</blockquote>

<p>What could possibly explain this sudden ""change of heart"" and how do I fix it?</p>

<p><img src=""http://i.stack.imgur.com/BTsvK.png"" alt=""enter image description here""></p>
","<java><android><eclipse><refactoring>","2","959","2011-04-17 19:20:36"
"5694090","rarefying array with limit","<p>I have array of objects form AR
I want to rarefy them, with limit.</p>

<p>Current method looks like:</p>

<pre><code>  def rarefied_values(limit = 200)
    all_values = self.values.all
    rarefied_values = []

    chunk_size = (all_values.size / limit.to_f).ceil
    if all_values.size &gt; limit
      all_values.each_slice(chunk_size) do |chunk|
        rarefied_values.push(chunk.first)
      end
      return rarefied_values
    else
      return all_values
    end
  end
</code></pre>

<p>Any hints for refactoring?</p>
","<ruby-on-rails><ruby><refactoring>","0","327","2011-04-17 14:31:13"
"5709568","Is rename refactoring working for somebody in strongly typed razor views?","<p>I have a model that looks like this:</p>

<pre><code>public class Person
{
     public string PostalCode {get;set;}
}
</code></pre>

<p>Then I have a razor view</p>

<pre><code>@model MvcApp1.Person

Your location is: @Model.PostalCode
</code></pre>

<p>When I am using Visual Studio's 2010 rename refactoring (Ctrl+R,R) the property gets renamed on the model class, but stays the same in the view.</p>

<p>My understanding is that since the view is strongly typed, renaming should have also happened in the view. </p>

<p>What am I doing wrong?</p>
","<asp.net-mvc><visual-studio-2010><razor><refactoring><strongly-typed-view>","6","229","2011-04-18 22:18:39"
"5711198","Can we refactor these methods?","<p>I have classes with methods implemented as follow:</p>

<pre><code>void methodOne() {
    try {
        getHelper().doActionOne();
    } catch ( Exception ex ) {
        throw new CustomException( ex );
    }
}

void methodTwo() {
    try {
        getHelper().doActionTwo();
    } catch ( Exception ex ) {
        throw new CustomException( ex );
    }
}

void methodThree() {
    try {
        getHelper().doActionThree();
    } catch ( Exception ex ) {
        throw new CustomException( ex );
    }
}


void methodFour;
void methodFive;
...
</code></pre>

<p>Is there a better way to do this? These codes make me uncomfortable.</p>

<p><strong>EDIT:</strong>
Sorry for unclear example. I'm implementing GenericDao class with Hibernate, the real code is something like this:</p>

<pre><code>class GenericDaoImpl&lt;T, PK&gt; {

    PK create( T object ) {
        try {
           getSession().save( object );
        } catch( Exception ex ) {
           throw new DataAccessLayerException( ex );// wrap any exception to my exception
        }
    }

   T read( PK id ) {
       try {
           getSession().get( T.class, id );
       } catch ( Exception ex ) {
           throw new DataAccessLayerException( ex );
       }

   }

  void update( T object );
  void delete( T object );

}
</code></pre>
","<java><design><methods><refactoring><coding-style>","2","117","2011-04-19 03:13:36"
"5727653","Rails 3 - Refactor ruby conditions","<p>I'd like to know if there is a simpler way to do these 2 conditions in ruby :</p>

<pre><code>if params[:action] == 'index' || params[:action] == 'show'
</code></pre>

<p>and</p>

<pre><code>if !(comment = (session[:my_params].include?(:comment) rescue nil)).nil?
</code></pre>

<p>Thanks in advance</p>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring>","1","219","2011-04-20 08:41:00"
"5727790","Converting all functions into classes","<p>I was reading the book <em>Refactoring: Improving the Design of Existing Code</em> by Fowler, where it says to replace function calls with same names classes and call constructors of that class in place of original function call. </p>

<p>My question is is it a good idea to convert all the functions(more or less, except very trivial ones) into objects so that the code becomes more modular? </p>

<p>Thanks, </p>
","<c++><design><refactoring><oop>","4","219","2011-04-20 08:53:32"
"5726880","Variable names must not start with 'm_' : StyleCop Rule 1308 - Why is it considered a bad (or not good/standard) practice?","<p>I have started using the StyleCop and it gives warning wherever there is a variable declared like <code>m_VariableName</code>. </p>

<p>The warning message is : <code>Variable names must not start with 'm_'</code>. This is StyleCop rule <code>SA1308</code>.</p>

<p>I can turn this rule off. But </p>

<p>1) I would like to know why is it a bad practice or considered to be a bad practice to declare variable names starting with 'm_'?</p>

<p>2) Does the underscore character has a special meaning for Visual Studio refactoring? (I heard it from one of the senior developers.)</p>
","<c#><.net><refactoring><naming-conventions><stylecop>","4","550","2011-04-20 07:23:22"
"5739061","Refactor via regex help (c style to c# style)","<p>I'm converting some C code to C#, and all is going well, however i'd like to jiggle things around so that:</p>

<pre><code>Util.SetStart(someObject, somePoint);
</code></pre>

<p>...gets refactored to:</p>

<pre><code>someObject.StartPoint = somePoint;
</code></pre>

<p>I think this is more than resharper can handle, and it seems the perfect candidate for regex replacement, however my regex knowledge is limited. If i'm mistaken, and this can be done in Resharper, i'd love to know!</p>

<p>As a side note, if I could use LINQ in place of regex that'd be awesome.</p>
","<c#><regex><refactoring><resharper>","0","66","2011-04-21 03:08:51"
"5741146","Template refactoring","<p>Let's imagine we have several type of elements, and we want to create a 
'manager' for every type of them.  The manager takes care of the
creation, activation/deactivation and removal for any of the elements
(we assume the user will no create/destroy the instances of these elements
without using the manager.
A very simple example of the code would be something like this:</p>

<pre><code>template &lt;class T&gt;
class NonCachedElementMngr
{
public:
    NonCachedElementMngr():
        rmCounter(0)
    {}

    ~ NonCachedElementMngr()
    {
        T* element = 0;
        if(mElements.size() &gt; 0)
        {
            typename std::set&lt;T*&gt;::iterator it;
            for(it = mElements.begin(); it != mElements.end(); ++it)
            {
                element = *it;
                element-&gt;deactivate();
                delete element;
            }
        }
    }

    T* create()
    {
        T* element = new T();
        element-&gt;activate();
        mElements.insert(element);
        return element;
    }

    bool release(T* element)
    {
        bool ret = false;
        typename std::set&lt;T*&gt;::iterator it;
        it = mElements.find(element);
        if(it != mElements.end())
        {
            element-&gt;deactivate();
            delete element;
            mElements.erase(it);
            ret = true;
        }
        return ret;
    }

private:

    std::set&lt;T*&gt; mElements;
    int rmCounter;
};
</code></pre>

<p>Let's imagine now that, for a subgroup of objects,
apart from the basic operation, we need also to do
some caching.  For that subgroup of types, we could
define another 'manager' like this:</p>

<pre><code>template &lt;class T&gt;
class CachedElementMngr
{
public:
    CachedElementMngr():
        rmCounter(0)
    {}

    ~CachedElementMngr()
    {
        T* element = 0;
        if(mElements.size() &gt; 0)
        {
            typename std::set&lt;T*&gt;::iterator it;
            for(it = mElements.begin(); it != mElements.end(); ++it)
            {
                element = *it;
                element-&gt;removeFromCache();  // &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Different line
                element-&gt;deactivate();
                delete element;
            }
        }
    }

    T* create()
            {
        T* element = new T();
        element-&gt;storeInCache(); // &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Different line
        element-&gt;activate();
        mElements.insert(element);
        return element;
            }

    bool release(T* element)
    {
        bool ret = false;
        typename std::set&lt;T*&gt;::iterator it;
        it = mElements.find(element);
        if(it != mElements.end())
        {
            element-&gt;removeFromCache();  // &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Different line
            element-&gt;deactivate();
            delete element;
            mElements.erase(it);
            ret = true;
        }
        return ret;
    }

private:

    std::set&lt;T*&gt; mElements;
    int rmCounter;
};
</code></pre>

<p>As obvious, both managers are exactly the same, except for the
three lines marked as so.
How could I refactor this two templates?
We know at compile time if a specific type will be cacheable or not.
Notice there is also a different line in the destructor.
Any feasible proposal (virtual inheritance, template specialization, SFINAE...) would be very welcome.</p>
","<c++><templates><refactoring><template-specialization>","1","110","2011-04-21 07:52:39"
"5747795","Interesting thought problem on refactoring code that returns a null","<p>I am interested in hearing your feedback.  I've recently seen some Java code that is implemented in the following way:</p>

<pre><code>Object1 SomeMethod(String key) {
    Object1 object1 = null;
    List&lt;Object1&gt; objectList = getAllRecordsWithKeyFromDatabase(key);
    if (!objectList.isEmpty()) {
        object1 = objectList.get(0);
    }
    return object1;
}

void AnotherMethod() {
    ...
    Object1 object1 = SomeMethod(key);
    if (object1 == null) {
        // throw exception
    }
    // continue working
}
</code></pre>

<p>I am always concerned whenever a null is returned without context.  I would rather the response from SomeMethod be more explicit and was considering refactoring it.  Throwing an exception from SomeMethod could offer a way to do this.  It would be in context and occur at the point of failure.</p>

<p>I am wondering if there is another way where SomeMethod could inform AnotherMethod that 'nothing was found in the database' instead of assuming that null always equaled 'not found'.  I thought that a NullObject could be used, but it is unclear to me how AnotherMethod should avoid 'continue working' if the data was not found.</p>

<p>How would you refactor the code? </p>
","<java><design-patterns><refactoring><null><null-object-pattern>","0","155","2011-04-21 17:45:38"
"5750366","Red, green, refactor - why refactor?","<p>I am trying to learn TDD and unit testing concepts and I have seen the mantra: ""red, green, refactor."" I am curious about why should you refactor your code after the tests pass?</p>

<p>This makes no sense to me, because if the tests pass, then why are you messing with the code? I also see TDD mantras like ""only write enough code to make the test pass."" </p>

<p>The only reason I could come up with, is if to make the test pass with green, you just sloppily write any old code. You just hack together a solution to get a passing test. Then obviously the code is a mess, so you can clean it up.</p>

<p>EDIT:</p>

<p>I found this link on another stackoverflow post which I think confirms the only reason I came up with, that the original code to 'pass' the test can be very simple, even hardcoded: <a href=""http://blog.extracheese.org/2009/11/how_i_started_tdd.html"" rel=""nofollow"">http://blog.extracheese.org/2009/11/how_i_started_tdd.html</a></p>
","<unit-testing><testing><refactoring><tdd>","5","376","2011-04-21 22:17:39"
"5755458","Refactoring without eclipse","<p>I am currently working on a source tree with hundreds of java modules that reference eachother. I can't want to import them all into Eclipse because it becomes very confusing and slow. Are there any stand alone linux tools that can help me refactor code? If not, how can I go about doing this effectively without Eclipse?</p>

<p>** Edit I would like a tool that someone has used. I realize there are a lot of tools out there that may or may not work. I was hoping SO could help me by narrowing the list.</p>

<p>**Edit I appreciate the help but I don't really want to justify not using Eclipse for this operation. I already use it to edit 20 or so of these modules at a time. I can't keep the amount of source I want to in the workspace effectively. </p>
","<java><refactoring>","0","89","2011-04-22 12:36:48"
"5764321","Refactoring this jQuery code","<pre><code>$('.go2page1').click(function () {
        $(""body"").scrollTo({ top: '0px', left: '0px' }, 800);
        return false;
    });
    $('.go2page2').click(function () {
        $(""body"").scrollTo({ top: '0px', left: '1100px' }, 800);
        return false;
    });
    $('.go2page3').click(function () {
        $(""body"").scrollTo({ top: '0px', left: '2200px' }, 800);
        return false;
    });
    $('.go2page4').click(function () {
        $(""body"").scrollTo({ top: '0px', left: '3300px' }, 800);
        return false;
    });
</code></pre>

<p>... this works but there are several pages and I have one for each, possible to compress this into a few lines and also add 'active' to the selected page?</p>

<p>Many thanks</p>
","<jquery><refactoring><scroll><active>","2","94","2011-04-23 13:04:53"
"5768948","Extract variables from string math expression","<p>I want to extract variables from math expression using c#. I wrote this code and it works right:</p>

<pre><code>List&lt;string&gt; Variables = new List&lt;string&gt;();
string temp = string.Empty;
Console.WriteLine(""Please enter ur expression"");
string Expression = Console.ReadLine().Trim();
int Index;
for (Index = 0; Index &lt;= Expression.Length - 1; Index++)
{
    if (char.IsLetter(Expression[Index]))
    {
        temp = temp + Expression[Index];
    }
    else
    {
        if (temp.Length &gt; 0)
        {
            Variables.Add(temp);
            temp = string.Empty;
        }
    }
}
if (temp.Length &gt; 0)
{
    Variables.Add(temp);
}
foreach (string item in Variables)
{
    Console.WriteLine(item);
}
Console.ReadKey();
</code></pre>

<p>I have to detect SIN and COS from expression so I will remove SIN and COS from Variables.<br></p>

<ol>
<li>Is it good way ?</li>
<li>IS it possible to do this with Regular expressions or better ways ?</li>
<li>Does this code need refactoring ?</li>
</ol>

<p>After extract I want replace variables with values from input and I will calculate the expression result.</p>
","<c#><string><math><refactoring>","1","516","2011-04-24 06:01:39"
"5773183","Eclipse plugin ""Operation not enabled"" ","<p>I'm struggling with Java Refactoring - I need to write an Eclipse plug-in which will refactor some code. It's really difficult for me and it would be way easier if I could follow working code step - by - step. The only alike example I could find is a sample <a href=""http://www.eclipse.org/articles/article.php?file=Article-Unleashing-the-Power-of-Refactoring/index.html"" rel=""nofollow"">Introduce Indirection</a>.</p>

<p>Unfortunately I cannot make it actually work. I get ""chosen operation is not currently available"" information anytime I try it. </p>

<p>I've imported code, ""Run As -> Eclipse App"" and than tried to use Introduce Ind. from Eclipse Articles. What am I doing wrong?</p>

<p>I'll be happy with any help :).   </p>
","<java><refactoring><eclipse-plugin>","0","384","2011-04-24 20:53:20"
"5783017","a more simple way to code in php ""if ( $x == $a[1] || $x == $a[2] || $x == $a[3] ....)","<p>As the title states, whats a more simple way to do </p>

<pre><code>if ( $somevariable == $somearray[1] || $somevariable  == $somearray[3] || $somevariable  == $somearray[10] ) 
</code></pre>

<p>Seems like even with 3 variables.. there would be a shortcut.</p>

<p>I know this doesnt work, but something like would be nice:</p>

<pre><code>if ($somevariable == $somearray[1],$somearray[3],$somearray[10]) {
</code></pre>
","<php><web-development><refactoring>","4","154","2011-04-25 20:40:57"
"5778767","Automatically change pass-by-value to pass-by-reference","<p>I have many hundreds of functions from a manual java to c++ port. In the result c++ code, I wish to change parameters passed by value to passed by reference:</p>

<pre><code>from:
void funcName1( Type1 t1, Type2 t2, int i);
to:
void funcName2( Type1&amp; t1, Type2&amp; t2, int i);
</code></pre>

<p>Preferably leave the primitive types such as int, float unchanged.</p>

<p>Any refactoring tools to automate this process? Some regular expression tricks?</p>

<p>Or any tool that converts portable java code to c++?</p>
","<regex><refactoring><reference><pass-by-reference><pass-by-value>","0","78","2011-04-25 13:24:52"
"5792341","Rename using suggested var name with resharper","<p>I'm Using resharper 6 nighty builds and VB.net. I've a big medium project with multiple files that don't follow the code style conventions of my company.</p>

<p>I've configured resharper with my own convenctions and It suggest to me the right name for each variable (perfect!).</p>

<p>But I can't find any automagic way to make the current name to be replaced with the suggested name.</p>

<p>Are there any way to do it? If not ... did you know ane fearure of coderush Xpress to achieve it?</p>

<p>Thanks.</p>
","<vb.net><refactoring><coding-style><resharper>","0","199","2011-04-26 15:04:27"
"5795674","How to refactor within Visual Studio without losing source control history?","<p>Using ReSharper to move/rename source files within Visual Studio 2010 is an enormous help when refactoring an application.  The Perforce source control integration is not able to cope with these kinds of changes without treating it as an unrelated ""delete from here"" ""add to here"", which breaks the history chain.  My questions are: </p>

<ol>
<li>Is there any way to coerce the Perforce plugin into doing the right thing in the first place?</li>
<li>If not, is there any way to reconcile after the fact externally? (will Perforce have any way to recognize files which have been moved and possibly renamed and had limited content changes?)</li>
<li>Is there another source control product that handles this transparently?</li>
</ol>

<p>Thanks!</p>
","<visual-studio><version-control><refactoring><resharper><perforce>","6","452","2011-04-26 19:51:57"
"5803634","Can I specify another class's instance-method as a variable for my method?","<p>I'm still relatively new to python, 1-2 years of solo-learning, and am trying to improve my code structure so I'm refactoring some old programs I wrote.  In one program, I defined a couple of methods for writing files.  The first uses, ""write"" to dump a huge http-response.  The second uses ""writelines"" to dump various derived lists, e.g. lists of links, or forms, or other extracted data.  </p>

<p>I'd originally factored out the naming of the file:</p>

<pre><code>    @property
    def baseFilename(self):
        unacceptable = re.compile(r'\W+')
        fname = re.sub(unacceptable,'-',self.myUrl)
        t = datetime.datetime.now()
        dstring = ""%s%s%s%s%s%s"" % (t.year, t.month, t.day, t.hour, t.minute, t.second)
        fullname = fname + '_' + dstring + '.html'
        return fullname
</code></pre>

<p>But I have a large redundant block of code in each write method:</p>

<pre><code>    def writeFile(self, someHtml, writeMethod=write, prefix=""RESPONSE_""):
        '''The calling functions will supply only the data to be written and 
           static prefixes, e.g. ""full_"" for the entire http-response.
        '''

       fullpath = self.myDump + prefix + self.baseFilename
       with open(fullpath, 'w') as h:
           h.write(someHtml)
           h.close()
       print ""saved %s"" % fullpath
       return fullpath

    def writeList(self, someList, prefix=""mechList_""):
        '''Like write file but for one of the many lists outputted.  
           How do I refactor this, since redundant?
        '''

        fullpath = self.myDump + prefix + self.baseFilename
        with open(fullpath, 'w') as h:
            h.writelines(someList)
            h.close()
        print ""saved %s"" % fullpath
        return fullpath
</code></pre>

<p>I'd like to be able to add a variable to each function that specifies the write method to use, e.g. (writeMethod=writelines).  I considered just passing in a string and using one of the black-magic functions-- exec() I guess-- but that can't possibly be right since no one ever seems to use those functions.  This whole example may be relatively silly, since I could just work around it, but I decided I'd benefit from knowing how to pass these sorts of instance-methods (is that the right term?).  Is this related to binding and unbinding?  All I need for a good answer is the syntax required to pass 'write,' 'writelines' etc.  Could be simple as: writeMethod = insert_your_syntax_here.  Would love additional explanation or guidance though.  Thanks.</p>
","<python><refactoring><instance-methods>","2","52","2011-04-27 11:53:10"
"5805764","Javascript - need help refactoring substring, indexOf, lastindexOf","<p>Have a list of vars to parse through ids for checkbox elements:<br/>
id=""service_505_<strong>1</strong>-features_1""<br/>
id=""service_505_<strong>2</strong>-features_1""<br/>
id=""service_505_<strong>3</strong>-features_1""<br/></p>

<p>Where the first number after '505_' is incremented each time a clone instance occurs.  here is the list of vars and I am looking for a way to refactor them for cleaner more presentable look:</p>

<pre><code>
var c = $('[name=""service_505-cloneable""]:first').clone(true);
// hidden input type id service_505-cloneable-count

var cloneableId = c.attr( 'id');
var cloneablePrefixIndex = cloneableId.indexOf( ""-cloneable"");
var cloneablePrefix = cloneableId.substring( 0, cloneablePrefixIndex);
   var cloneableRootId = cloneablePrefix.substring( 0, cloneablePrefix.lastIndexOf( ""_""));
</code></pre>

<p>Then I want to clean up the counter that counts in the value of the hidden input element:</p>

<pre><code>

var currentCount = $('#' + cloneableRootId + '-cloneable-count').attr( 'value');

++currentCount;
$('#' + cloneableRootId + '-cloneable-count').attr( 'value', currentCount);

var newCloneableRootId = cloneableRootId + ""_"" + currentCount;

c.attr( 'id', newCloneableRootId + '-cloneable');
</code></pre>

<p>Any help appreciated.  Thanks.</p>
","<javascript><refactoring><substring><indexof>","0","317","2011-04-27 14:31:16"
"5807543","Rails 3 - How to refactor this piece of code?","<p>I would like to refactor this piece of code which is not DRY at all :)</p>

<pre><code>def my_method
 if session[:my_params].try(:include?, :answer)
   session[:my_params][:answer]
 elsif session[:my_params].try(:include?, :question)
   session[:my_params][:question]
 end
end
</code></pre>

<p>Is there a way to implicitly return either <code>:answer</code> or <code>:question</code> depending on which one is present (if present) in <code>session[:my params]</code>?</p>
","<ruby><ruby-on-rails-3><refactoring><refactor-my-code>","1","61","2011-04-27 16:40:25"
"5816588","Is there something like a ""column symlink"" in Oracle?","<p>I would like to have a column in my DB accessible via two column names temporarily.</p>

<p>Why? The column name was badly chosen, I would like to refactor it. As I want my webapp to remain stable while changing the column name, it would be good to </p>

<ol>
<li>have a (let's call it) symlink named <strong>better_column_name</strong> pointing to the column <strong>bad_column_name</strong> </li>
<li>change the webapplication to use <strong>better_column_name</strong></li>
<li>drop the symlink and rename column to <strong>better_column_name</strong></li>
</ol>

<p>""Refactoring Databases"" suggests to actually add a second column which is synchronized on commit in order to achieve this. I am just hoping that there might be an easier way with Oracle, with less work and less overhead.</p>
","<database><oracle><columns><refactoring-databases>","3","94","2011-04-28 09:39:46"
"5817423","Best practice to tell inherited methods from class's own method","<p>Im on a project where i have a database class that extends ADODB_base class - <strong>My goal is to replace ADODB_class with an ad-hoc database wrapper layer class</strong>.</p>

<p>The class has ~200 methods; what can be a good practice to identify the methods it inherit from ADODB_class (that i have to recreate with same name/args in the custom wrapper in order to avoid big headcaches in the refactoring) and it's <em>own</em> methods?</p>

<p><strong>EDIT:</strong> a sample code:</p>

<pre><code>class Postgres extends ADODB_base{
    //[...]
    // This method exist in Postgres class but not in ADODB_base,
    // let's say this is a Postgres own method.
    public function do_something()
    {
        //[...]
        // query() method belongs to ADODB_base class, so i need to create it
        // in my wrapper too, keeping the name and the args.
        $this-&gt;query([...]);
    }
    //[...]
}
</code></pre>

<p>My goal is to find the best practices to tell that <code>do_something()</code> belongs to <code>Postgres</code>, while <code>query()</code> belongs to <code>ADODB_base</code>, <strong>without change all the code that use <code>Postgres</code> class.</strong></p>

<p>Will be lovely to identify even attributes..</p>
","<php><oop><php5><inheritance><refactoring>","0","195","2011-04-28 10:51:27"
"5823802","Programming OOP in Javascript - Properly","<p>I'm interesting in improving my javascript code to be properly OOP.... currently I tend to do something like this:</p>

<pre><code>jQuery(document).ready(function () {
    Page.form = (function () {
        return {
            //generate a new PDF
            generatePDF: function () {

            },
            //Update the list of PDFs available for download
            updatePDFDownloads: function () {

            },
            /*
             * Field specific functionality
             */
            field: (function () {
                return {
                    //show the edit prompt
                    edit: function (id, name) {

                    },
                    //refresh the value of a field with the latest from the database
                    refresh: function (id) {

                    }
                };
            }())
        };
    }());
});
</code></pre>

<p>In the end it's just mainly organized functions I suppose... what's a good resource where I can learn to program javascript in an OOP manner, or what suggestions would you have for improving my current style of programming?</p>

<p>It seems like I should do a sort of model prototype and have my <code>form</code> object inherit from that prototype.</p>

<p>(I'm using jQuery instead of $ because of conflicts with prototypeJS)</p>
","<javascript><jquery><oop><refactoring>","5","617","2011-04-28 19:18:10"
"5825994","Refactor reading elements in an XML file - C#","<p>Can I refactor the following piece of code reading elements in an XML file:</p>

<pre><code>if (!(xmlDoc.Element(""Element1"").Element(""Element2"").Element(""Element3"").Element(""Element4"").Element(""Element5"").Element(""Element6"") == null))
{

}
</code></pre>
","<c#><xml><refactoring>","1","40","2011-04-28 22:58:54"
"5826508","Refactoring: How to efficiently render json in Rails update action","<p>How can I refactor this code so I don't repeat the json objects over and over again when they use the same basic format?  I'm still a bit uncomfortable with Ruby on Rails so I'm unsure of the best way to approach this.</p>

<pre><code>  # PUT /users/:user_id/profile/:id
  def update
    if request.xhr?
      profile = current_user.profile

      if params[:profile].blank?
        render :json =&gt; { :error =&gt; ""There was no profile data passed in so your profile could not be saved."" }, 
               :status =&gt; :unprocessable_entity
      else
        if profile.update_attributes(params[:profile])
          render :json =&gt; { :interests =&gt; 
                              simple_format(h(profile.interests), :class =&gt; ""pbs tl""),
                            :favorite_music =&gt;
                              simple_format(h(profile.favorite_music), :class =&gt; ""pbs tl""),
                            :favorite_movies =&gt;
                              simple_format(h(profile.favorite_movies), :class =&gt; ""pbs tl""),
                            :favorite_books =&gt;
                              simple_format(h(profile.favorite_books), :class =&gt; ""pbs tl""),
                            :favorite_foods =&gt;
                              simple_format(h(profile.favorite_foods), :class =&gt; ""pbs tl"") },
                 :status =&gt; :ok
        else
          render :json =&gt; { :error =&gt; get_errors_for_class(profile).to_sentence }, 
                 :status =&gt; :unprocessable_entity
        end
      end
    end
  end
</code></pre>

<hr>

<p><strong>Update</strong>: I modified the original answer a little and it works for me.  Here's my modification:</p>

<pre><code>  # within profile.rb
  # create a hash of profile attributes
  def html_to_hash
    %w{interests favorite_music favorite_books favorite_foods}.inject({}) do |hash, property|
      hash[property] = simple_format(h(self.send(property)), :class =&gt; 'pbs tl')
      hash
    end    
  end
</code></pre>
","<ruby-on-rails><json><ruby-on-rails-3><refactoring><dry>","0","784","2011-04-29 00:14:16"
"5829789","How to refactor the javascript code when sleep like functionality needed?","<p>I see there are lot's of threads here in SO about asking for a javascript sleep function and I know it can be done only using <code>setTimeout</code> and <code>setInterval</code>.</p>

<p>I do some userscripting with greasemonkey and written a script that loads a lot of pages and calculates something from them. It works, but I don't want to request the pages too fast.</p>

<pre><code>var html0=syncGet(url0); // custom function for sync ajax call.
// fill the something array
for(var i=0;i&lt;something.length;i++)
{
   // calculate url1,url2 using the array and the i variable
   // do something with lots of local variables
   var html1=syncGet(url1);
   // I would put a sleep here.
   // do something with the results
   var html2=syncGet(url2);
   // I would put a sleep here.
   // do something with the results
   // get url3 from the page loaded from url2
   var html3=syncGet(url3);
   // I would put a sleep here.
   // do something with the results
}
// use the result of the for loop and lots of code will follow...
</code></pre>

<p>The actual code is a bit more complex and longer than this.</p>

<p>I'm crying for the nonexistent sleep function (and understand why is it not possible) How to refactor this to use setTimeout, setInterval functions and keep it readable (and working) too?</p>
","<javascript><ajax><refactoring><sleep>","2","137","2011-04-29 08:29:33"
"5833361","Team city duplicate finder inverse assign","<p>I have a question about duplocate finder tab of TeamCity:</p>

<p>I have 2 parts of code:</p>

<pre><code>participantInfo.FIRSTNAME = this.FirstName.Text;
... 7 lines of the same assignments
participantInfo.PASSWORD = this.Password.Text;
</code></pre>

<p>and </p>

<pre><code>this.FirstName.Text = participantInfo.FIRSTNAME;
... 7 lines of inversed assignments
this.Password.Text = participantInfo.PASSWORD;
</code></pre>

<p>They looks very similar, but assignments is inversed.</p>

<p>Both methods located in the same file, and used to transfer data between asp.net controls and domain model.</p>

<p>How can I fix this?</p>
","<refactoring><code-review><teamcity><teamcity-6.0>","1","87","2011-04-29 14:27:07"
"5834313","tiding subversion Perl repo with PerlTidy?","<p>I would like to clean up an existing subversion repository containing badly formatted Perl code. 
Since I am not sure if some comparisons with fairly old code will be necessary, ideally I would like to have the same formatting for all revisions. </p>

<p>On the other hand creating a new repo by checking out all old revisions, reformatting with perltidy and checking in will have to keep the original log messages. </p>

<p>Are there any tools/recipes to do it? </p>
","<svn><refactoring><perl-tidy>","1","100","2011-04-29 15:53:26"
"5847765","Keyboard shortcut for code refactor (var rename) in Visual Studio","<p>When renaming a variable in Visual Studio (I use 2010), it shows a little mark that when clicked, leads to a drop-down that offers to rename all the dependant references.</p>

<p><img src=""http://i.stack.imgur.com/ktXOM.png"" alt=""""></p>

<p>What I want to do, is spare getting the mouse and click it in order to show the drop-down.<br>
I was wondering if there is a way to access it via the keyboard.</p>
","<visual-studio><ide><refactoring><keyboard-shortcuts><shortcuts>","1","338","2011-05-01 10:08:30"
"5851044","How to create new generic items for a List<T>?","<p>Given a list of a possible 5 items, the method below will return a new list of exactly 5 items (adding more items if the original list has less than 5).  This works fine, but now I need to refactor it so that it can handle a generic T list (one that will have the same properties of year and Cnt).  How can I convert this method to take in a List and have it return a new List with 5 elements?</p>

<pre><code>    private static List&lt;FiveYearComplex&gt; CreateFiveYearTemplate(int startYear, 
        int endYear, ObjectResult&lt;FiveYearComplex&gt; result)
    {
        var list = new List&lt;FiveYearComplex&gt;(5);

        for (int year = startYear; year &lt; endYear; ++year)
        {
            list.Add(new FiveYearComplex() { Year = year, Cnt = 0 });
        }
        FiveYearComplex tmpItem;
        foreach (var item in result)
        {
            tmpItem = list.Find(w =&gt; w.Year == item.Year);
            if (tmpItem == null)
            {
                tmpItem = new FiveYearComplex() { Cnt = 0, Year = item.Year };
            }
            else
            {
                tmpItem.Cnt = item.Cnt;
            }
        }
        return list;
    }
</code></pre>

<p>When I try to use List I eventually run into this section:</p>

<pre><code>for (int year = startYear; year &lt; endYear; ++year)
{
    list.Add(new T() { Year = year, Cnt = 0 });
}
</code></pre>

<p>and I get an error...</p>

<p>Thanks!</p>

<p>For completeness:</p>

<pre><code>    public interface IYearTemplate
    {
        int? Year { get; set; }
        decimal? Cnt { get; set; }
    }

    private static List&lt;T&gt; CreateFiveYearTemplate &lt;T&gt; (
        int startYear, int endYear, 
        ObjectResult&lt;FiveYearAttendanceComplex&gt; result) 
        where T : IYearTemplate, new()
    {
        var list = new List&lt;T&gt;(5);

        for (int year = startYear; year &lt; endYear; ++year)
        {
            list.Add(new T() { Year = year, Cnt = 0 });
        }
        T tmpItem;
        foreach (var item in result)
        {
            tmpItem = list.Find(w =&gt; w.Year == item.Year);
            if (tmpItem == null)
            {
                tmpItem = new T() { Cnt = 0, Year = item.Year };
            }
            else
            {
                tmpItem.Cnt = item.Cnt;
            }
        }
        return list;
    }
</code></pre>

<p>Thanks you.</p>
","<c#><generics><.net-4.0><refactoring>","2","345","2011-05-01 20:10:48"
"5842302","Need advice for refactoring a large class","<p>Our C# application produces reports of various types. Each type of report has an xml schema defining the options and features that are available, so a user can create an xml document describing the report they want. There are elements that are common to multiple report types, and there are interdependencies among some elements.</p>

<p>We currently have a single class full of static methods to handle the parsing of the xml. It will take a schema-validated document, and return an object representing the type of report and its configured options. The class looks something like this:</p>

<pre><code>public class ReportFactory
{
    //let's say 4 types of reports
    public static ReportType1 CreateReportType1(XDocument document)
    {
        //logic to create this type of report, calling private methods in this class
    }
    ....

    public static ReportTypeN CreateReportTypeN(XDocument document)
    {
        //logic to create this type of report
    }


    //several dozen private methods, which get called from the public methods or from each other
    private static Feature1 CreateFeature1(XElement element)
    {
        //create some feature of a report 
    }

    private static FeatureN CreateFeatureN(XElement element, FeatureM m)
    {
        //create some feature which relies on another previously built feature
    }

    private static FeatureX CreateFeatureX(ReportType2 report, XElement elementForX, XElement elementRelatedToX)
    {
        //create some feature, which relies on 
        //more than one element and/or a partially built report of a given type
    }

    private static void UpdateFeatureNWithStuffFromFeatureM(FeatureN n, FeatureM m)
    {
        //modify parts of the built report, based on some other parts of the report 
    }
    ...
}
</code></pre>

<p>I believe the intention was to encapsulate the details of the xml structure, which I suppose it does.  It also doesn't suffer much from duplicated code.  But it is very large and hard to read, and it gets worse as we add more features.  It's also difficult to test, since it relies heavily on things being done in the correct order.</p>

<p>I'd like to refactor it, but so far the only thing I can think of is to just split it up into multiple classes; say, a class for each report type and an additional helper class for common stuff.  But it will still be messy and possibly even harder to read.  Is there a good way to organize something like this? Any patterns that might help?  I've looked at a bunch of creation patterns and haven't really found anything that seems to fit.   </p>

<p>UPDATE: Sorry I have not had time or budget to actually work on this piece of refactoring, but thanks for the suggestions.  The more I think about it, the more I like (something like) the Chain of Responsibility idea.  The starting point (public function) will create the return object and fill in some basic stuff, then hand off the object and the xml to the next piece.  Each piece will know which parts of the object and the xml it needs, and each piece can be tested independently by looking at the changes to the object.</p>
","<c#><refactoring>","2","234","2011-04-30 14:14:07"
"5853343","How can I reduce the Cyclomatic Complexity of this?","<p>I have a method that receives an Object and does something based on what type of object it detects:</p>

<pre><code>receive(Object object) {
    if (object intanceof ObjectTypeA) {
        doSomethingA();
    }
    else {
        if (object instanceof ObjectTypeB) {
            doSomethingB();
        }
        else {
            if (object instanceof ObjectTypeC) {
                doSomethingC();
            }
            else {
                if (object instanceof ObjectTypeD) {
                    doSomethingD();
                }
                else {
                    // etc...
                }
            }
        }
    }
}
</code></pre>

<p>How can I reduce the Cyclomatic Complexity? I searched around but couldn't find anything too useful. I'm still a novice at Java. Thank you.</p>
","<java><refactoring><instanceof><cyclomatic-complexity>","3","1406","2011-05-02 03:59:59"
"5853556","ROR + Refactor default line of scaffolding in Single Line of Code","<p>In Rails Controller, Using Scaffolding we generate default methods. Here One of the method is present. I wanna customized the last 4 lines into a single line. In my last project, I have done that today I am not able to memorize that single line of code.</p>

<pre><code>  # Index
  def index
    @audits = Audit.all
    respond_to do |format|
      format.html # index.html.erb
      format.xml  { render :xml =&gt; @audits }
    end
  end
</code></pre>

<p>Here I have to refactor the below code in single line.</p>

<pre><code>respond_to do |format|
  format.html # index.html.erb
  format.xml  { render :xml =&gt; @audits }
end
</code></pre>

<p>Thanks</p>
","<ruby-on-rails-3><mvc><redirect><refactoring><rendering>","0","88","2011-05-02 04:52:54"
"5876576","Variable renaming for plagiarism detection for C/C++","<p>I have a couple of simple C++ homeworks and I know the students shared code. These are smart students and they know how to cheat moss. I'm looking for a tool that can rename variables based on their types (first variable of type int will be int1, first int array will be intptr1...), or does something similar that I cannot think of now. Do you know a quick way to do this? </p>

<p><strong>edit:</strong> I'm required to use moss and report 90% match</p>

<p>Thanks</p>
","<c++><refactoring><plagiarism-detection>","2","387","2011-05-03 22:42:44"
"5877783","Any tools or tips on fast PHP refactoring?","<p>Our current ""in-house"" newsletter system is just PHPlist with the company logo slapped on it. I am given the task of adding various features into it, but the code of PHPlist is just monolithic and hard to break down. I would like to break it down to more manageable pieces first, but what I aim to do ultimately is to rewrite the whole UI and logic from scratch with CodeIgniter and ExtJS, keeping only database compatibility with PHPlist.</p>

<p>I can just say ""screw it"" and write a new system completely from scratch, but I would like to keep as much of the original PHPlist behaviour as possible, therefore, the first step I have to do is to understand where all the features of PHPlist are buried first, and diving dozens of files with hundreds to thousands lines of uncommented PHP with no apparant structure is not fun. :(</p>
","<php><refactoring><phplist>","1","89","2011-05-04 02:25:03"
"5885326","Help with refactoring jQuery menu","<pre><code>    $('#menu &gt; li').hover(function() {
        $(this).prev().addClass('nobg');
    }, function() {
        $(this).prev().removeClass('nobg');
    });
    $('#menu &gt; li:has(.submenu)').hover(function() {
        $(this).addClass('active').children('ul').show();
        $(this).prev().addClass('nobg');
    }, function() {
        $(this).removeClass('active').children('ul').hide();    
        $(this).prev().removeClass('nobg');
    });
</code></pre>

<p>.. works great but looks really ugly, is it possible to compress this in fewer lines?</p>

<p>Many thanks for your help.</p>
","<jquery><refactoring>","0","46","2011-05-04 14:48:46"
"5887502","JQuery: Want to refactor some Jquery code to make it simple and easy","<p>I have the following code in JQuery, On DOM Ready it runs, its job is to post data to my PHP file, and return the returned data into the specified div. I am using 5 bits of code, most of it is repeating it self over again. I wanted to refactor this somehow, can someone make this code into a couple of lines is possible?</p>

<p>Basically, on change of a select box element, it runs and does the code.  </p>

<pre><code>// First Level Categories
    $(""#slct_firstCat"").live(""change"", function(){
    $(""#div_secondCat"").fadeOut();
    $(""#div_thirdCat"").fadeOut();
    $(""#div_fourthCat"").fadeOut();
    $(""#successCats"").remove();

    var actionRequested = ""AJAX_getCats"";
    var url = ""index.php"";
    var catId = $(""#slct_firstCat"").val();

    $.post(url, {AJAX_Action: actionRequested, categoryId: catId, categoryLevel: 1},
        function(data){
            $(""#div_secondCat"").fadeIn().html(data);
           });
    // End of Function getCats
    });

// Second Level Categories
    $(""#slct_secondCat"").live(""change"", function(){
    $(""#div_thirdCat"").fadeOut();
    $(""#div_fourthCat"").fadeOut();
    $(""#successCats"").remove();

    var actionRequested = ""AJAX_getCats"";
    var url = ""index.php"";
    var catId = $(""#slct_secondCat"").val();

    $.post(url, {AJAX_Action: actionRequested, categoryId: catId, categoryLevel: 2},
        function(data){
            $(""#div_thirdCat"").fadeIn().html(data);
           });
    // End of Function getCats
    });


// Third Level Categories
    $(""#slct_thirdCat"").live(""change"", function(){
    $(""#div_fourthCat"").fadeOut();
    $(""#successCats"").remove();

    var actionRequested = ""AJAX_getCats"";
    var url = ""index.php"";
    var catId = $(""#slct_thirdCat"").val();

    $.post(url, {AJAX_Action: actionRequested, categoryId: catId, categoryLevel: 3},
        function(data){
            $(""#div_fourthCat"").fadeIn().html(data);
           });
    // End of Function getCats
    });

// Fourth Level Categories
    $(""#slct_fourthCat"").live(""change"", function(){
    $(""#successCats"").remove();

    var actionRequested = ""AJAX_getCats"";
    var url = ""index.php"";
    var catId = $(""#slct_fourthCat"").val();

    $.post(url, {AJAX_Action: actionRequested, categoryId: catId, categoryLevel: 4},
        function(data){
            $(""#div_fourthCat"").fadeIn().html(data);
           });
    // End of Function getCats
    });

// Fifth Level Categories
    $(""#slct_fifthCat"").live(""change"", function(){
    $(""#successCats"").remove();
    var actionRequested = ""AJAX_getCats"";
    var url = ""index.php"";
    var catId = $(""#slct_fifthCat"").val();

    $.post(url, {AJAX_Action: actionRequested, categoryId: catId, categoryLevel: 5},
        function(data){
            $(""#div_fourthCat"").fadeIn().html(data);
           });
    // End of Function getCats
    });
</code></pre>

<p>You can see most the code is repeated many times, the only things that change are the element names and the category level in the post action.</p>

<p>I hate having this huge chunk of code in my JS script, used over and over again, surely someone out-there can help reduce this to a few lines or a function if possible?</p>

<p><strong>--------------------------- EDIT ---------------------------</strong></p>

<p>This is the php code that sends the data back from the $.post, if this helps.<br>
Each select box is inside its own div when posted to html, The DIVs are on the html and not ajax'd in.<br>
Basically, I want to navigate down to a category using these select box's to easily visualize where I am in the category nav. The $data variable, is an object which has an array of the category data requested.<br>
(Sorry Im pressed for time g2g work, else I would have cleaned up the code more)</p>

<pre><code>&lt;?php if (isset($data-&gt;CategoryArray-&gt;Category-&gt;LeafCategory) == 1){ ?&gt;

    &lt;div id='successCats' align='center'&gt;
    &lt;b&gt;Your Selected Category is:&lt;/b&gt;&lt;br/&gt;
    &lt;select id='selectedCategory' name='selectedCategory' size='1'&gt;
    &lt;option value='&lt;?=$data-&gt;CategoryArray-&gt;Category-&gt;CategoryID.""'&gt;"".$data-&gt;CategoryArray-&gt;Category-&gt;CategoryName;?&gt;&lt;/option&gt;
    &lt;/select&gt;
    &lt;/div&gt;

&lt;?php } else {  ?&gt;
&lt;?php
$catLevel = $_POST['categoryLevel'];
if ($catLevel == 1){
    echo ""&lt;select id=\""slct_secondCat\"" name=\""slct_secondCat\"" size=\""15\""&gt;"";
} elseif ($catLevel == 2) {
    echo ""&lt;select id=\""slct_thirdCat\"" name=\""slct_thirdCat\"" size=\""15\""&gt;"";
}
  else if($catLevel == 3){
  echo ""&lt;select id=\""slct_fourthCat\"" name=\""slct_fourthCat\"" size=\""15\""&gt;"";
} else if($catLevel == 4){
  echo ""&lt;select id=\""slct_fifthCat\"" name=\""slct_fifthCat\"" size=\""15\""&gt;"";
}

    $cats = array_slice($data-&gt;CategoryArray-&gt;Category,1);
    foreach ($cats as $cats){
    if ($cats-&gt;CategoryID == $cats-&gt;CategoryParentID){
    // Do Nothing - Get rid of the first header Cat
    } else {
    $option =  ""&lt;option value=\"""" . $cats-&gt;CategoryID . ""\""&gt;"" . $cats-&gt;CategoryName;
    if(!isset($cats-&gt;LeafCategory)){
        $option .= "" &gt;"";
    }

    $option .= ""&lt;/option&gt;"";

    echo $option;
    }
    } // End of For each

} // End of First If Else
?&gt;
&lt;?php echo ""&lt;/select&gt;""; ?&gt;
</code></pre>
","<jquery><jquery-ajax><refactoring><jquery-post>","0","72","2011-05-04 17:35:46"
"5889361","Difference between string and const string","<p>The refactor tool I'm using often suggests that I change something like this:</p>

<pre><code>string title = ""Some title."";
</code></pre>

<p>to</p>

<pre><code>const string title = ""Some title."";
</code></pre>

<p>Why, what is/are the difference(s)?</p>

<p>Thanks!</p>
","<c#><refactoring>","3","199","2011-05-04 20:20:57"
"5884539","Buggy Rails app: test or refactor?","<p>This app had virtually no tests in place when we came to it and now there are cucumber tests covering the most essential parts. We are not sure if the app is working correctly and have had many disasters happen over the course of development, most of them caused by bugs that were never discovered. The code is quite ugly in places with models generating HTML and PHP-itis in the views. There are many extraneous models and controllers that could be greatly simplified or eliminated. My question is, when is it better to simply refactor code without testing previous functionality? Due to deadline constraints, it's very hard to justify spending time on covering all the existing code with tests when we know it's bad and could be easily eliminated.</p>
","<ruby-on-rails><testing><refactoring><project-management>","2","57","2011-05-04 13:56:14"
"5884635","Wading through another ""programmer's"" PHP/MySQL code","<p>Ok so I've got this piece of offending code:</p>

<pre><code>&lt;!-- Begin the Product Group Submenu --&gt;
                       &lt;ul&gt;
&lt;?php do  { ?&gt; 
    &lt;li&gt;&lt;a href=""prodgrouppg.php?groupid=&lt;?php echo $row_menugroup['GroupID']; ?&gt;&amp;amp;groupname=&lt;?php echo $row_menugroup['GroupName']; ?&gt;""&gt;&lt;?php echo $row_menugroup['GroupName']; ?&gt;&lt;/a&gt;

&lt;!-- Retrieve the individual products related to the Group --&gt;                               
&lt;?php                               
$groupprod_menuprod = ""-1"";
if (isset($row_menugroup['GroupID'])) {
  $groupprod_menuprod = (get_magic_quotes_gpc()) ? $row_menugroup['GroupID'] :     addslashes($row_menugroup['GroupID']);
}
mysql_select_db($database_conn_atex, $conn_atex);
$query_menuprod = sprintf(""SELECT products.ProductID, products.ProductName,     products.ProductGroup FROM products WHERE products.ProductGroup=%s ORDER BY products.ProductName"", GetSQLValueString($groupprod_menuprod, ""int""));
$menuprod = mysql_query($query_menuprod, $conn_atex) or die(mysql_error());
$row_menuprod = mysql_fetch_assoc($menuprod);
$totalRows_menuprod = mysql_num_rows($menuprod);
?&gt;

&lt;!-- Begin the product submenu (final menu) --&gt;

&lt;ul&gt;
&lt;? $row_menuprod = mysql_fetch_assoc($menuprod)) 
{
    echo 
    &lt;li&gt;
        &lt;a href=""productpg.php?prodid=&lt;?php echo $row_menuprod['ProductID']; ?&gt;""&gt;
            &lt;? echo $row_menuprod['ProductName']; ?&gt;
        &lt;/a&gt;
    &lt;/li&gt;
    &lt;/ul&gt; &lt;!-- end of Product Submenu --&gt;
    &lt;/li&gt;
         &lt;?php } while ($row_menugroup = mysql_fetch_assoc($menugroup)); ?&gt;
            &lt;/ul&gt; &lt;!-- end of Group Submenu --&gt;
        &lt;/li&gt;
        &lt;?php } while ($row_menusubcat = mysql_fetch_assoc($menusubcat)); ?&gt;
    &lt;/ul&gt; &lt;!--end of Subcategory Submenu--&gt;


&lt;/li&gt; &lt;!--end of Category Submenu--&gt;
&lt;?php } while ($row_menupaging = mysql_fetch_assoc($menupaging)); ?&gt;

 &lt;/ul&gt; &lt;!--end of Menu --&gt;
</code></pre>

<p>Which basically just stopped working out of nowhere. If I delete this code, require for this file goes through OK so I'm assuming something in here is the problem. I've tried reformatting this about 5 times already so I think there must be something my eye is missing.</p>

<p>Any suggestions? Apologies for the state of this code.. trying to fix it up nicer one piece at a time..</p>
","<php><refactoring><mysql><functional-programming>","1","98","2011-05-02 19:42:23"
"5907528","Change ListView CellTemplate based on state of item","<p>I have a ListView that is has an ObservableCollection as its ItemsSource, and it has several columns. One of these is a State column which, depending on the current state of the item, shows a different message. Currently this is implemented as a basic string, and while it works it is far from pretty or userfriendly. I want to be able to vary the sort of output to more properly suit the state of the item.</p>

<p>I did do some research and know that I need to use a CellTemplate to affect the display, but all the different sorts of templates simply overwhelm me to the point where I can't figure out where to go next.</p>

<p>My code (excluding lots of other listview fluff) is as follows:</p>

<pre><code>&lt;ListView Name=""itemsListView"" ItemsSource=""{Binding Source={StaticResource listingDataView}}"" IsSynchronizedWithCurrentItem=""True""&gt;
    ...
    &lt;ListView.View&gt;
         &lt;GridView AllowsColumnReorder=""true"" ColumnHeaderToolTip=""Item Information""&gt;
             ...
             &lt;GridViewColumn DisplayMemberBinding=""{Binding Path=StatusMessage}"" Width=""283"" Header=""Status"" HeaderContainerStyle=""{StaticResource GVHeaderLeftAlignedStyle}"" /&gt;
         &lt;/GridView&gt;
    &lt;/ListView.View&gt;
&lt;/ListView&gt;
</code></pre>

<p>Yes, the items have hardcoded 'Status Message' that get updated alongside other properties that are actually relevant for the code, causing ugly duplication elsewhere in my code. (And yes, I know this is far from pretty, but I want to improve this too.) That property would be called <code>ItemState</code> as I am not all that creative.</p>

<p>So, my question is: how can I vary this column to have the most suitable display for the given state? Textual descriptions will do for many states, but some are rather lengthy and might profit from a text with a progress bar besides it, and maybe some sort of time remaining. Another state would profit from having a clickable hyperlink. In other words, I think I need at least 3 different CellTemplates.</p>

<p>I realize it is a rather open-ended question that largely suffers from the design mistakes of someone (=me) who has rather little experience with WPF, but that is exactly why I'm hoping someone experienced can set me straight with some basic code before I make an even worse mess of things than I have already. :)</p>
","<c#><wpf><xaml><refactoring><celltemplate>","0","511","2011-05-06 06:20:09"
"5910391","How would you refactor a loop to have a unit test per each interation?","<p>Let's say I have a class which has a private void method. And I want to test this method by a some seed parameters for each specific iteration.</p>

<p>For instance, I want to make StartTrhoughGridCells method below testable for its iterations so that I can check statte changes in parameterObject.</p>

<p>In such cases, how can I make a each iteration testable in a private method that has a loop inside?</p>

<pre><code>public class Traveller
{

// ... Some memebers, properties

private void StartTrhoughGridCells(object parameterObject)
{
   // Do some state changes on parameterObject
}

}
</code></pre>
","<c#><.net><unit-testing><refactoring>","1","72","2011-05-06 10:59:26"
"5910913","C#: On method call event? (Refactor my code)","<p>I have a controller, where every Action share a certain parameter. Also the first line in every method is common amongst the actions.</p>

<p>E.g.</p>

<pre><code>public ActionResult Add(string routeName) //Common parameter
{
    var object = _repository.Get(routeName); //Common line
    ...
}
</code></pre>

<p>How can I refactor this, enabling me to remove</p>

<pre><code>var object = _repository.Get(routeName);
</code></pre>

<p>and/or the parameter, but still be able to access them like before?</p>

<p>Edit:
I'm using IoC to inject all my repositories into the class, so the controller is kind of not avaliable.</p>

<p>Also, I'm using routes:</p>

<p>E.g.</p>

<pre><code>routes.MapRoute(""Object-Add"", ""{foo}/{object}/add"", new { controller = ""Object"", action = ""Add"" });
</code></pre>

<p>Is that perhaps also a problem?</p>
","<c#><refactoring><refactor-my-code>","0","100","2011-05-06 11:43:07"
"5914482","Rails 3 - How to refactor this controller code?","<p>Is there a way to DRY and load objects in a cleaner way (without using before_filter).</p>

<p>Indeed I need @answer and @question in 2 other methods than ""show"".</p>

<p>Controller :</p>

<pre><code>def show
 @answer = Answer.new pre_form
 @question = Question.find(params[:id])
 @answers = @question.answers.page(params[:page])
 respond_with @question
end

private

def pre_form     
   session[:pre_form][:answer] || session[:pre_form][:question] if session[:pre_form]
end
</code></pre>

<p>Thanks in advance</p>
","<ruby-on-rails><ruby-on-rails-3><refactoring>","0","115","2011-05-06 16:45:07"
"5916062","QTCreator Code File Refactoring","<p>I was wondering if anyone know of a quick and easy way to refactor the code files in my QT Project using QTCreator? Specifically I am trying to organize my source files and Its a bit of a pain to have to go back into the project file and change the filepath for each file. Not to mention moving a dialog class is even worse (there are .ui files not included in the project but you have to change those too.</p>
","<c++><refactoring><qt-creator>","0","257","2011-05-06 19:21:29"
"5905557","Why and how implementing initial unit tests in legacy application code","<p>I’m in the process of integrating unit tests in an existing legacy application. In the book “Working with legacy application” and many other books that I read, it was written that you always should write unit tests before starting the process of refactoring existing code or integrating new features, correct bugs, etc...</p>

<p>In the tons of samples that I read, the signature of refactoring methods is never or rarely breaks and the old unit tests still work after a lot of changes. The reason is that author code is not so legacy that the code that I view each day when I work with what I considered “legacy code”.</p>

<p>In the reality, when you have a legacy application, the code is so bad that you must break the signature of methods. If you try to write unit tests with the original method, after just 5 minutes of changes, you will break the entire signature and the firsts tests will be good to be send to the trash. </p>

<p>Just as an example, look at the code below:</p>

<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace MyCompany.Accouting
{
    public class DataCreator
    {
        public static System.Data.DataSet CreateInvoice(
            System.Data.DataSet customer, 
            System.Data.DataSet order, 
            string mails, 
            ref bool isValid)
        {
            System.Data.DataSet invoice = new System.Data.DataSet();

            int taxGroupId =
                ApplicationException.ShareConnection.ExecuteScalar(
                    ""SELECT Id FROM TaxGroup WHERE TaxGroup.IsDefault"");

            Application.ShareConnection.ExecuteNonQuery(
                ""INSERT INTO Invoice (CustomerId, EffectiveDate) VALUES(?,?)"",
                 customer.Tables[0].Rows[0][""Id""], System.DateTime.Now);

            int invoiceId;

            invoiceId = Application.SharedConnection.ExecuteScalar(""SELECT @@IDENTITY"");

            Application.SharedConnection.ExecuteNonQuery(
                ""INSERT INTO InvoiceLine (ProductId, Quantity, InvoiceId) VALUES(?,?,?)"", ,
                order.Tables[0].Rows[0][""ProductId""], order.Tables[0].Rows[0][""Quantity""], invoiceId);

            foreach(string mail in mails.Split(';'))
            {
                Application.MailSender.Send(mail);
            }

            isValid = true;

            System.Data.DataRow row = invoice.Tables[0].NewRow();
            row[""Id""] = invoiceId;

            invoice.Tables[0].Rows.Add(row);

            return invoice;
        }
    }
}
</code></pre>

<p>As you can see, there is a lot of lot of bad code here.</p>

<p>After the refactoring, the method will not be static, ref parameter will be removed, DataSet will be converted to POCOs object, access to global object like “Application” will be replaced by properties injected dynamically and a lot of other changes will be made like implementing interface, review the name of class, namespace and many many other things. In fact, this code is totally a crap that should be throw away and rewritten from scratch.</p>

<p>If I create a unit tests for the original static method, the test will be break immediately when the static keyword will be removed to use the class in a more object oriented manner. Same for the change of DataSet to Poco, etc…</p>

<p>Why create a unit test if in 5 minutes, I will throw away this test? What in this test is helpful?</p>

<p>Which strategy will you use in this case?</p>

<p>Thank you very much.</p>
","<c#><.net><unit-testing><design><refactoring>","2","143","2011-05-06 00:22:12"
"5918612","How to refactor a Rails model that contains significant amount of back-end code?","<p>I have a Rails 2.X model with 421 lines of code/comments that does a significant amount of work on the backend (opening HTTP Get requests, parsing RSS, parsing HTML, etc.).  At the same time, I'm moving to Resque in order to more quickly get through this backend code.  I'm wondering what the best way to refactor this would be.  Should I move this back-end code to a library that I include in the model?  A module?  A gem?  </p>

<p>Your thoughts would be much appreciated.  </p>

<p>I basically have a separate core tasks for each data item i'm processing.  i.e. parsing an RSS feed, parsing a HTTP URL, running regex on that html body, as well as a few other tasks and right now i have 500 or lines of code within the model; even though most of the stuff the model does is called through a back-end script run by cron</p>

<p>So to make it more wieldy and to make it easier to move to resque; i was thinking of doing separate classes for each resque queue, and using static methods there</p>

<p>Then I can require those classes by the back-end 'controller' script if you will... Does this approach make sense?</p>
","<ruby-on-rails><ruby><class><model><refactoring>","1","191","2011-05-07 01:48:50"
"5921965","Can method be readable and shorter ? ","<p>I wrote this method:</p>

<pre><code>private int maxSequence (char player , Cell c)
{
    int row = c.getRow();
    int col = c.getCol();
    int maxVert = 0;
    int maxHor = 0;
    int maxDiag = 0;

    if (player == 'O')
    { 

        for (int j = 0; j &lt; _board[0].length; j++)
        {
            if ( (_board[col][row+j] == 'O') || (_board[col][row-j] == 'O') )
            {
                maxVert++;
            }

            if ( (_board[col+j][row] == 'O') || (_board[col-j][row] == 'O') )
            {
                maxHor++;
            }

            if ( (_board[col+j][row+j] == 'O') || (_board[col-j][row-j] == 'O') )
            {
                maxDiag++;
            }
        }
    }

    if (player == 'X')
    {
        for (int j = 0; j &lt; _board[0].length; j++)
        {
            if ( (_board[col][row+j] == 'O') || (_board[col][row-j] == 'X') )
            {
                maxVert++;
            }

            if ( (_board[col+j][row] == 'O') || (_board[col-j][row] == 'X') )
            {
                maxHor++;
            }

            if ( (_board[col+j][row+j] == 'O') || (_board[col-j][row-j] == 'X') )
            {
                maxDiag++;
            }
        }
    }

    if ( (maxDiag &gt;= maxVert) &amp;&amp; (maxDiag &gt;= maxHor) )
    {
        return maxDiag;
    }

    else if ( (maxVert &gt;= maxDiag) &amp;&amp; (maxVert &gt;= maxHor) )
    {
        return maxVert;
    }

    else
    {
        return maxHor;
    }
}
</code></pre>

<p>I wonder if there is a way to improve the method to be readable and \ or shorter ?</p>
","<java><methods><refactoring>","0","107","2011-05-07 15:20:09"
"5936018","Can you refactor Maven pom.xml files into reusable XML fragments?","<p>In Maven, is it possible to refactor commonly repeated fragments into a reusable ""library"" (plugin)? I realize that I can write my own plugins, but often the functionality I want to re-use is already expressed as fragments in a pom.xml, and my natural inclination is that the mechanism of re-use should preserve those fragments <em>as</em> XML.</p>

<p><strong>Case in point</strong> I've been using a procedure (<a href=""http://wikis.sun.com/display/Jersey/HowToConfigureExtendedWADL"" rel=""nofollow"">partly described here</a>) for generating a WADL file from Jersey/JAX-RS source code, and then generating developer documentation from that WADL and the source-code's own Javadoc. The procedure on that page describes the execution of two plugins, and I am using a third plugin (org.codehaus.mojo:exec-xsltproc) and my own XSL file to turn the WADL into HTML.</p>

<p>I've used this procedure in several Maven projects. The boilerplate comes in at <a href=""http://pastie.org/1880764"" rel=""nofollow"">100 lines of XML</a>. What changes between projects is simply the package name of the source code in question (<code>com.example.myapp.rest</code> in the linked boilerplate). Therefore it is not possible to move this into a parent pom, or any other mechanism that does not allow parametrization.</p>

<p><strong>What I want</strong> is to aggregate, template-out, or otherwise refactor those 100 lines (and one XST file) into a common location. I realize that re-usable maven executions are delivered via Maven plugins. Ideally I wouldn't have to write any Java (or Groovy) just to re-express what I have already expressed in XML.</p>

<p><strong>Is it possible to refactor Maven pom.xml files <em>as</em> XML?</strong></p>
","<xml><maven-2><refactoring><maven-plugin>","2","261","2011-05-09 11:07:48"
"5942331","extending class but base call needs to call extended class","<p>I have a large class that I'm breaking up into smaller chunks.</p>

<p>So I have a base class and a new class which extends the base class.</p>

<p>My problem is, Can I call the extended class from the base class? This just doesn't seem right.</p>

<pre><code>// a.php
class A {
    // set all the properties and runs some validation and functionality in the process
}

// b.php
class B extends A {
    // needs all the same validation as class A and adds more functionality
}
</code></pre>

<p>To start the process I can only call class A, Example:</p>

<pre><code>$process = new A();
</code></pre>

<p>in the class A I need to decide if class B functionality is needed</p>

<pre><code>class A {
    if($condition) {
        include_once('b.php');
        $new_process = new B();
        $new_process-&gt;doMoreStuff();
    }
}
</code></pre>

<p>I could add the doMoreStuff() (well a ton more functionality) but this defeats the purpose of having the smaller class file sizes.</p>

<p>I know the right way would be to create a wrapper script and put the logic in there, if to use class A or B. But is there any other reason why I couldn't do as I've requested?</p>

<p>UPDATE:</p>

<p>So let me clarify what class A is:</p>

<p>Class A sets up all the database connections, validation of the INI properties, and sets the initial logging values. Class A also has a workflow/process for handling a specific request.</p>

<p>Class B needs class A's database, INI properties and logging but also offers a new workflow/process. I just wanted to extend the functionality of A into another class (as to make it more manageable).</p>

<p>So I'm thinking there should be a decision class C that decides to use Class A only or Class B which extends Class A.</p>

<p>Just wanted to confirm that this would be the best bet, thanks for the input</p>
","<php><class><refactoring><logical>","2","85","2011-05-09 20:49:07"
"5944499","What is the best way to refactor validation logic and regular expressions in rails?","<p>Let's say you have several models that contain fields for address, postal code, province/country, phone number, etc.</p>

<p>These are rather common fields that have specific regular expression validations. If you put the same validations and regular expressions in each model, it is duplicated. Also, the tests are duplicated. This is a smell ;)</p>

<p>What is the best approach using ruby and rails to refactor these types of things? A module?</p>

<p>In Java with Hibernate, we'd use a Component class to store the address, and then we'd put the validation logic there. Each model that wanted to use an address would simply contain one, and it will get all the address validation logic.</p>

<p>What is the approach to achieve the same thing in rails? Thanks!</p>
","<ruby-on-rails><ruby><regex><validation><refactoring>","2","126","2011-05-10 02:20:04"
"5948254","Criteria for deciding code should be broken up","<p>What criteria do you use to decide if code should be broken up/refactored? Also in what form? It'd be interesting to have some practical examples where this was not so obvious.</p>
","<refactoring><source-code>","0","53","2011-05-10 09:51:51"
"5949769","Why does renaming of files sometimes refactor the classnames and sometimes not?","<p>I found it curious that the file rename sometimes ask to refactor the class inside and (most) sometimes just renames the files. </p>
","<.net><visual-studio><visual-studio-2010><refactoring><file-rename>","12","177","2011-05-10 12:07:20"
"5951659","Tool to diagnose the code to check for errors at runtime","<p>Is it possible to check the code and find all places where conversion errors might happen.</p>

<p>for Ex: Wherever = operator is used , i have to check the type of the LHS and RHS variable.</p>

<p>Is it possible with following softwares?</p>

<pre><code>submain CodeIt.Right
SSW Code Auditor
</code></pre>
","<vb.net><refactoring><code-analysis>","0","77","2011-05-10 14:31:22"
"5946146","Refactoring Browser","<p>Ok, a while ago I read about a Re-factoring Browser for I think, Lisp (or maybe it was smalltalk).
This was a tool to help with re-factoring.
I was wondering if anyone knows of a free one for F#?
(seems reasonable a functional languages should be 'nice' for that kind of thing)</p>
","<f#><refactoring><ml>","1","159","2011-05-10 06:38:40"
"5958331","Implementing an interface whereby generics are based on the interface","<p>I am currently refactoring my code so that all important classes implement an interface (for unit testability). I came across a class that implements IComparable (non-templated); something like:</p>

<pre><code>public MyClass : IComparable
{
    public int CompareTo(object obj)
    {
        MyClass cObj = obj as MyClass;
        if (cObj == null) { throw new ArgumentException(); }
        // etc.
    }
}
</code></pre>

<p>I'm wanting to interface it out, and use generics while I'm at it; something like this:</p>

<pre><code>public IMyClass : IComparable&lt;IMyClass&gt;
{
    // Other methods here
}

public MyClass : IMyClass
{
    public CompareTo&lt;IMyClass&gt;(IMyClass other)
    {
        ...
    }
    // Other methods here
}
</code></pre>

<p>But then, ideally, <code>MyClass</code> should implement <code>IComparable&lt;MyClass&gt;</code> (and then subclasses of <code>MyClass</code> should implement <code>IComparable&lt;MySubClass&gt;</code>).</p>

<p>All of this to ask several questions:</p>

<p>What do you think of the approach I described? Is there a better way of doing this refactoring? Is there a point in making <code>MyClass</code> also implement <code>IComparable&lt;MyClass&gt;</code>, or is that pointless since we already implement <code>IComparable&lt;IMyClass&gt;</code>? Any pro-tips or ""best""-practices I could be made aware of?</p>
","<c#><generics><interface><refactoring>","5","146","2011-05-11 01:41:54"
"5964488","Xcode 4: cannot refactor projects located in /Developer","<p>I've recently upgrade to Xcode 4 and was genuinely hoping that this new version might put Xcode on a more equal footing with other IDEs like Eclipse and IntelliJ, but it's looking increasingly like Apple is still way behind.</p>

<p>I was especially looking forwarding to new refactoring options. But now I can't use any at all! Whenever I try to refactor I get a lovely dialog saying </p>

<pre><code>Refactoring is not supported for projects located in /Developer.
</code></pre>

<p>I keep all my dev projects in /Developer. The dialog suggests that I copy the project to another location to enable refactoring, which I am extremely loathe to do because of all the pain of broken file references that will follow (yet another one of Xcode's major detractions).</p>

<p>Is there any way around this? I need to be able to refactor. I don't want to copy the project out of /Developer. What can I do?</p>

<p>Thanks.</p>
","<ide><refactoring><xcode4>","0","276","2011-05-11 12:47:50"
"5970175","Refactor ""package structure"" in Eclipse to relocate a package's child package to its parent package","<p>In Eclipse's ""Package Explorer"", let's say I have a list of packages like this:</p>

<ul>
<li>com.animal.dog </li>
<li>com.animal.cat</li>
<li>com.animal.frog</li>
</ul>

<p>If I want to refactor this package structure so that the final package structure looks like</p>

<ul>
<li>com.dog </li>
<li>com.cat</li>
<li>com.frog</li>
</ul>

<p>So essentially removing the parent package &amp; attaching the child packages to its grandparent. I have many child packages in ""com.animal"" package &amp; I would like to avoid if possible doing this manually &amp; then also changing the package imports everywhere.</p>
","<java><eclipse><refactoring><packages><package-structuring>","4","564","2011-05-11 20:25:55"
"5976427","Automating repeated editing operations in Intellij","<p>What are the ways in Intellij IDEA to automate repeated editing operations?</p>

<p>For example I have a file with few dozens of entries like the following:</p>

<pre><code>public static final Test1 = new Test(A a1, B b);
public static final Test2 = new Test(A a2, B b);
public static final Test3 = new Test(A a3, B b);
public static final Test4 = new Test(A a4, B b);
</code></pre>

<p>I would like to replace all <code>B b</code> in a file, and pass a <code>null</code> parameter instead. It is easy to do in editors like <code>gvim</code> where normally you would record a <code>macro</code> and repeat it. What are the usual ways to do such automation where refactoring capabilities of Intellij are limited?</p>
","<java><refactoring><intellij-idea>","1","123","2011-05-12 10:08:40"
"5980702","Design approach for interface with many input widgets","<p>I have an interface that has ~16 input field boxes.  They are all declared as public pointers within a class, initialized, etc.  However, as my code has grown more and more with private functions doing database committals, error checking, temporary storage routines, etc it has become very painful if a field has to get removed or a new one added I must delve into all these private functions and explicitly remove/add the field; and always with regard to the field ordering.</p>

<p>There <em>has</em> to be a simpler way!</p>

<p><strong>This is my idea and am hoping anyone can shoot it down or build upon it:</strong></p>

<p>My thought is to store pointers to all the input fields in a array of pointers and then all these private helper functions walk the array; however some of these private functions are static some are non-static; thus some more pointer magic is required, or should I have two of these array-of-pointer functions: one for static functions to use and one for non-static functions to use?</p>

<p>To further complicate things, the method invoked upon the widgets varies depending on what the private function is doing... Some may call ""->value(foo)"" some may call ""->location(1),->location(2),"" incrementing in order of the widgets.  Is there a way to pass the method invoked and the parameters to be passed to this new helper function containing the array of input field pointers?</p>

<p><strong>Food for thought:</strong>
Maybe I'm trying to get too fancy by saving myself the burden of scrolling all around my code whenever I need to make a change? Maybe this will add too much overhead with all the extra pointer indirection? Is it better to suffer?</p>

<p>Thanks, any help is appreciated.  If some code examples are really required I can churn out some.</p>

<p><strong>Code Example (this won't compile and is typed freehand as an example)</strong></p>

<pre><code>class Foo
{
public:
   InputBox * in1;
   InputBox * in2;
   InputBox * in3;
   ExternalDataSource * exds; // Pretend this object you can retrieve values out of
private:
   static void clearFieldsFunc1(void * v); // callback bound to a button
   static void loadFieldFunc2(void * v);  // callback bound to a button
   void printFieldsFunc3(); // not a callback, just called from various functions
}

Foo::Foo()
{
   in1= new InputBox (0,0,10,10);  // Box x,y,w,h
   in2= new InputBox (15,0,10,10);
   in3= new InputBox (30,0,10,10);
   exds = new ExernalDataSource(""US Intelligence Agency"");
}

// Clears the fields
void Foo::clearFieldsFunc1(void * v)
{
   Foo * fptr = ((Foo*)v);
   fptr-&gt;in1-&gt;clear();
   fptr-&gt;in2-&gt;clear();
   fptr-&gt;in3-&gt;clear();
}

// Loads the fields
void Foo::loadFieldFunc2(void * v)
{
   Foo * fptr = ((Foo*)v);
   fptr-&gt;in1-&gt;value(fptr-&gt;exds-&gt;getValue(1));
   fptr-&gt;in2-&gt;value(fptr-&gt;exds-&gt;getValue(2));
   fptr-&gt;in3-&gt;value(fptr-&gt;exds-&gt;getValue(3));
}

// Prints the fields
void Foo::printFieldsFunc3()
{
   printf(""%s\n"",this-&gt;in1-&gt;value());
   printf(""%s\n"",this-&gt;in2-&gt;value());
   printf(""%s\n"",this-&gt;in3-&gt;value());
}
</code></pre>
","<c++><design><design-patterns><refactoring>","2","83","2011-05-12 15:45:55"
"5987833","refactoring a complex dynamic active relation query","<p>I was wondering if I could get some refactoring help to make this query more concise.</p>

<p>Basically what this query does is it searches all the help_documents by some search terms. It checks the document question, content and the category it belongs to.</p>

<pre><code>  def self.search(text)
    if text.blank?
      latest
    else
      relation = sorted.joins(:category)

      text.split(/\s/).each do |word|
        relation = relation.where(
            ""lower(help_documents.question) like ? or lower(help_documents.content) like ? or lower(help_categories.name) like ?"",
            ""%#{word.downcase}%"", ""%#{word.downcase}%"", ""%#{word.downcase}%""
        )
      end

      relation
    end
  end
</code></pre>

<p>Compared to how you would do this in java/hibernate, this actually looks pretty good. But I figured the rails people might have even sexier tricks up their sleeve to accomplish the same thing. For example, there might be some methods/objects I don't know about that already do these types of things.</p>
","<ruby-on-rails><ruby><activerecord><refactoring>","0","164","2011-05-13 06:02:23"
"6006406","What can I do to optimize my ajax application for IE7/IE8 in order to avoid ""Stop running this script""?","<p>I have a booking engine which is pretty sluggish in IE7. It's ajaxified and hash/window onchange based. There are 5 total steps. The main issue I'm having is step 2 is uber slow in IE.</p>

<p>When a user lands on step 2, an ajax request is made to pull in data with web services in order to display hotel rooms. The hotel rooms are divided by the main room type and more specific types inside. The JS functionality that gets applied to the hotel rooms consist of:</p>

<ul>
<li>accordion on the rooms</li>
<li>accordion on the room types (nested accordion)</li>
<li>quickflip on the image</li>
<li>jscrollpane, custom scrollbar on the room description on the left after the image flips</li>
<li>jscrollpane, custom scrollbar on the room types on the right</li>
</ul>

<p>All of this causes the famous:</p>

<p><img src=""http://i.stack.imgur.com/4nBQv.png"" alt=""enter image description here""></p>

<p>I've googled and landed on <a href=""http://stackoverflow.com/questions/5667456/stop-running-this-script-ie7"">this</a>, <a href=""http://stackoverflow.com/questions/1930691/stop-running-this-script-ie-for-large-ajax-requests"">this</a>, and <a href=""http://stackoverflow.com/questions/212550/a-script-on-this-page-is-causing-ie-to-run-slowly"">this</a>.</p>

<p>So obviously the cause is that there are too many script statements executing sequentially within a specific amount of time in IE.</p>

<p>I basically need to refactor my code and optimize it such that there are delays in between function invocations.</p>

<p>The way I'm injecting the HTML after doing the ajax request is:</p>

<pre><code> 734                     $( o.html ).appendTo( el )
</code></pre>

<p><code>o.html</code> is a reference to the JSON objects <code>html</code> property which is derived from <a href=""http://bit.ly/mNZYLt"" rel=""nofollow"">here</a>.</p>

<p>Then, the code below runs:</p>

<pre><code>setTimeout(function () {


    $('#roomz .room-accordion').each(function () {

        $(this).accordion({
            header: 'h2.new-heading',
            autoheight: false,
            clearStyle: true,
            collapsible: true,
            change: function (event, ui) {
                window.ui = ui;

                // if it hasnt been quickflipped/subnest accordioned, do it
                if (!$(ui.newContent).data('enabled')) {
                    $('.room-rates', ui.newContent).each(function () {

                        $(this).accordion({
                            header: 'h4.rate-name',
                            autoheight: false,
                            active: 0,
                            clearStyle: true
                        });

                        //if (!$.browser.msie) 
                           $(this).jScrollPane();

                    })

                    $('.room-image', ui.newContent).quickFlip({
                        vvertical: true
                        //easing:'easeInBounce'
                        //easing:'easeInSine'
                    });

                    $('.back-copy-inner', ui.newContent).jScrollPane({
                        verticalDragMaxHeight: 131
                    });

                    $(ui.newContent).data('enabled', true);
                }
            }
        })

        var el = this;
        setTimeout(function () {
            $('.back-copy-inner:eq(0)', el).jScrollPane({
                verticalDragMaxHeight: 131
            });
        }, 500);

        $('.room-rates:eq(0)', this).each(function () {

            $(this).accordion({
                header: 'h4.rate-name',
                autoheight: false,
                active: 0,
                clearStyle: true
            });

            var el = this;
            setTimeout(function () {
                //if (!$.browser.msie) 
                $(el).jScrollPane();
            }, 50);

        });

        $('.room-image:eq(0)', this).quickFlip({
            vvertical: true
            //easing:'easeInBounce'
            //easing:'easeInSine'
        });

        $('.room:eq(0)', this).data('enabled', true);

    });



}, 20);
</code></pre>

<p>My first version of the code basically applied the quickflip and scrollpanes to <em>every</em> room whether it was hidden in the accordion or not. The refactored version ( live/current one ) applies it to the very first room that's active in the accordion, and when another is clicked on through the accordion, I apply the quickflip and scrollpane to it.</p>

<p>I added a setTimeout around the entire thing, because this happens after the HTML gets injected. I have <code>setTimeout</code>s inside as well.</p>

<p>It seems like it's still too slow. <strong>Can anyone offer any refactoring/optimization tips?</strong></p>

<p>My ideas for refactoring it again consist of:</p>

<ol>
<li>instead of doing an <code>.each</code> on <code>.room accordion</code>, apply a repeating operation to force a delay in <a href=""http://www.picnet.com.au/blogs/Guido/post/2010/03/04/How-to-prevent-Stop-running-this-script-message-in-browsers.aspx"" rel=""nofollow"">between each iteration like this</a>?</li>
<li>optimize and minify the HTML returned by the ajax even more - I have already done lots of optimization, killed whitespace, dont show HTML comments, etc..</li>
<li>Enabling Gzip</li>
<li>Doing lazy loading on the images so that only the visible accordion content images show and others are <code>blank.gif</code> until you activate them through the accordion</li>
<li>Instead of returning the HTML and dumping it, return only relevant data with NO HTML and instead build the HTML with a templating engine?!</li>
</ol>

<p>If anyone can offer opinions on my ideas for refactoring in terms of which ones would produce the best results, that'd be great too.</p>

<p><strong>LINKS:</strong></p>

<ul>
<li>the page in question is <a href=""http://bit.ly/k1jH6n"" rel=""nofollow"">this</a>. </li>
<li>the relevant JS is <a href=""http://bit.ly/kC7Ukf"" rel=""nofollow"">here</a>. </li>
<li>the relevant code/line numbers start at line 829 of <code>new.js</code> ( thats the snippet I pasted )</li>
<li>the relevant ajax request that is made is made to <a href=""http://bit.ly/mNZYLt"" rel=""nofollow"">this page</a>.</li>
</ul>

<p>PS - not supporting IE6</p>

<p><strong>EDIT</strong>: I put a delay between iteration of <code>.each</code> and it's still uber slow. I think the custom scrollbar is the leading cause. Ugh.</p>

<p><strong>EDIT #2</strong>: The <a href=""http://bit.ly/kC7Ukf"" rel=""nofollow"">live code</a> is a spaghetti of setTimeouts. I tried to lazy load the scroll pane but its still too sluggish for IE. </p>
","<javascript><internet-explorer><optimization><dom><refactoring>","12","520","2011-05-15 04:04:48"
"6013941","Is it possible to add custom options to VS2010's ctrl-. refactorings","<p>I am wondering if it is possible to add to the built in ""refactorings"" that VS2010 provides.</p>

<p>For example - when cursor is on an interface, CTRL-. offers to ""implement interface members"".</p>

<ol>
<li>Do i have access to the actual macro/code that runs this ?</li>
<li>Do i have access to actually add my own custom things to be offered in CTRL-. ?</li>
</ol>
","<visual-studio><visual-studio-2010><refactoring>","1","38","2011-05-16 06:39:32"
"6013852","refactoring 2 closely coupled methods","<p>Ok so I'm making a mockup of a distributed system.
each instance of  mClass (object) is used by 1 thread. Mutable data can't be passed between mClass objects
This is a example of code analogous to what I have:</p>

<pre><code>type mClass (mID:id)=
    member this.ID=mID

    let resolve : id-&gt;mClass  =... //This function turns IDs into the objects they represnt
    ...
    let managementInfo = ref Some mutableData

    //this should only ever be called by the GiveControl method.
    private member this.TakeControl (frozenData) =
        let defrostedData = ... //a variable that works out the unfrozen version of the frozenData
        managementInfo := Some defrostedData


    ///This is a helper that ensure that when ever someone else is told to take control 
    ///that all my internal data and any functions i need to call to tell others are done
    ///And convert the data a nonmutable form 
    ///(Mutable data can not be tranfered between different instances of of mClass (objects), 
    ///as this is a mockup of a distributed system, where the instances of mClass can't
    ///@param: nID this ID of the object we are giving control to
    ///@param: callbacks: a list of functions to call to tell other objects i've given control 
    private member this.GiveControl nID (callbacks: list&lt;id-&gt;unit&gt;) =
        let updateInternalData = ... //A function to upate my internal state
        updateInternalData;
        ignore (List.map (fun f-&gt; f nID) callbacks);
        let freezeData data= ... //a function make our mutableData into nonmutable data
        let frozenData = (!managemenInfo).Value|&gt;freezeData 
        managemenInfo:=None;
        (nID|&gt;resolve).TakeControl (frozenData)

    ...
</code></pre>

<p>private member this.GiveControl was originally declared:
let giveControl
but it made the compiler complain about mis-declaring a new type, until i changed it to a private method.</p>

<p>The question is, how can I re factor this code,
to merge the two methods into one. (or atleast make GiveControl only callable from within this object (real private as it were) and TakeControl only callable from GiveControl)</p>
","<f#><refactoring>","0","88","2011-05-16 06:26:13"
"6015979","I have identical getter/setter code used for multiple virtual attributes - can I refactor with eval?","<p>I have written customised getter and setter methods for virtual attributes to convert decimals into integers for storage in a database.  This is one of three virtual attributes (annual_fee_dollars) that get/sets from a real attributes (annual_fee) in the database:</p>

<pre><code>def annual_fee_dollars
  @annual_fee_dollars || int_to_dec(annual_fee)
end

def annual_fee_dollars=(string)
  @annual_fee_dollars = string
  self.annual_fee = dec_to_int(string)
end
</code></pre>

<p>Instead of repeating all this code three times, does it make sense to / is it safe to / is it the 'Rails Way' to refactor the code like this:</p>

<pre><code>def self.decimal_get_and_set(variable, suffix)
  eval (
    ""def #{variable + suffix}
      @#{variable + suffix} || int_to_dec(self.#{variable})
    end
    def #{variable+suffix}=(string)
      @#{variable+suffix} = string
      self.#{variable} = dec_to_int(string)
    end"")
end
self.decimal_get_and_set ""annual_fee"", ""_dollars""
self.decimal_get_and_set ""interest_purchase"", ""_percent""
self.decimal_get_and_set ""interest_cash"", ""_percent""
</code></pre>

<p>Or is there a much cleaner way to build this type of functionality?</p>

<p>Apologies if this is a 'subjective question'.  In part, all refactoring questions have some  subjectivity to them, but I think this question still has a place on SO.  Happy to be corrected on this.</p>

<p>Cheers!</p>
","<ruby-on-rails><attributes><model><refactoring><virtual-attribute>","1","207","2011-05-16 10:23:17"
"6016154","Is there any way to group similar handlers for stripMenuItems?","<p>I have a simple bitmap editor for small monochrome bitmaps. And I have a menus which allows to choose thickness of the pen and robber. The problem is that I don't like the following code. Is there any way to make it more compact?     </p>

<pre><code>    private void toolStripMenuItem4_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 3;
    }

    private void toolStripMenuItem3_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 2;
    }

    private void toolStripMenuItem2_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 1;
    }

    private void toolStripMenuItem5_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 4;
    }

    private void toolStripMenuItem6_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 5;
    }

    private void toolStripMenuItem7_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 6;
    }

    private void toolStripMenuItem8_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 7;
    }

    private void toolStripMenuItem9_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 8;
    }

    private void toolStripButton3_Click_1(object sender, EventArgs e)
    {
        CurrentPanel.EditMode = EditMode.Clear;
    }

    private void toolStripDropDownButton2_Click(object sender, EventArgs e)
    {
        CurrentPanel.EditMode = EditMode.FreeHand;
    }

    private void toolStripSplitButton1_ButtonClick(object sender, EventArgs e)
    {
        CurrentPanel.EditMode = EditMode.Clear;
    }

    private void toolStripMenuItem10_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 1;
    }

    private void toolStripMenuItem11_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 2;
    }

    private void toolStripMenuItem12_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 3;
    }

    private void toolStripMenuItem13_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 4;
    }

    private void toolStripMenuItem14_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 5;
    }

    private void toolStripMenuItem15_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 6;
    }

    private void toolStripMenuItem16_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 7;
    }

    private void toolStripMenuItem17_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 8;
    }

    private void toolStripMenuItem18_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 16;
    }

    private void toolStripMenuItem19_Click(object sender, EventArgs e)
    {
        CurrentPanel.RobberThickness = 32;
    }

    private void toolStripMenuItem21_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 32;
    }

    private void toolStripMenuItem20_Click(object sender, EventArgs e)
    {
        CurrentPanel.PenThickness = 16;
    }
</code></pre>
","<c#><.net><winforms><refactoring><source-code>","0","51","2011-05-16 10:39:06"
"6016547","How to request from JAVA to support something?","<p><a href=""http://www.atlassian.com/software/jira/"" rel=""nofollow""><strong>Atlassian JIRA</strong></a> is a powerfull issue tracker which I am using it for a long time, as it is a good issue trakcer I bound to Localize it to my locale.</p>

<p>I found Their page in <a href=""http://www.linkedin.com/groups?mostPopular=&amp;gid=117832"" rel=""nofollow"">Linkedin</a> and <a href=""http://www.linkedin.com/groupItem?view=&amp;gid=117832&amp;type=member&amp;item=37468151&amp;qid=b6a58738-89af-45fa-9993-5750f68ad781"" rel=""nofollow"">asked them if I can translate it</a>, as it was welcomed in the community I started translating, I'd post first part of my translation for them and after a while they <a href=""https://jira.atlassian.com/browse/TRANS-111"" rel=""nofollow"">told me here</a> that</p>

<blockquote>
  <p>Java does not support fa_IR locale.</p>
</blockquote>

<p>and</p>

<blockquote>
  <ul>
  <li>try to force java to support fa_IR</li>
  <li>refactor TAC so having locale is</li>
  </ul>
</blockquote>

<p>What can I do to get JAVA attention to support fa_IR locale or something else to help JIRA supporting it? Actually I didn't get the minning of <code>refactor TAC so having locale is</code> how can I deal with it?</p>
","<java><localization><refactoring><jira><jira-plugin>","3","114","2011-05-16 11:14:20"
"6022630","regular expressions to convert asp page response.writes to html","<p>I have this...</p>

<pre><code>Response.write ""&lt;table width=""""700"""" border=""""0""""&gt;""

    Response.write ""&lt;tr&gt;&lt;td width=""""10%""""&gt;&amp;nbsp;&lt;td align=center pagetitle2strong""""&gt;&lt;br&gt;&lt;strong&gt;Advanced Sales Search&lt;/strong&gt;&lt;br&gt;&lt;br&gt;&lt;/td&gt;&lt;/tr&gt;""

    Response.write ""&lt;tr&gt;&lt;td width=""""10%""""&gt;&amp;nbsp;&lt;td&gt;""

    ShowSearchDisclaimer    

    Response.write ""&lt;table border=0&gt;&lt;tr&gt;&lt;td width=""""10%""""&gt;&amp;nbsp;&lt;td&gt;""

    ShowForm

    Response.write ""&lt;/td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;""

    Response.write ""&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;""
</code></pre>

<p>Which in view source looks like this...just one big blob.</p>

<pre><code>&lt;table width=""700"" border=""0""&gt;&lt;tr&gt;&lt;td width=""10%""&gt;&amp;nbsp;&lt;/td&gt;&lt;td align=""right"" &gt;&lt;h1&gt;Search Sales or Transfers&lt;/h1&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td width=""10%""&gt;&amp;nbsp;&lt;/td&gt;&lt;td&gt;&lt;table width=600 border=0&gt;&lt;tr&gt;&lt;td&gt;&lt;font size=+1&gt;&lt;b&gt;By using this page you are agreeing to the following disclaimer.&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;The information appearing on this website was extracted from the records of the office of the Sarasota County Property Appraiser. Our goal is to provide you with the most accurate information possible. The information maintained on this website should not be relied upon for any purposes except for those of the Property Appraiser and his staff. The Sarasota County Property Appraiser accepts no responsibility for the inappropriate use or the misinterpretation of data. No warranties, expressed or implied, are provided for the data herein. The property values relate to the last valuation date, or to preliminary values when noted. The data is subject to change.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;By proceeding with a property search you are stating that the notice has been read and that you understand and agree with its contents. The data contained on this site is intended for information purposes only. It is based on the best information available at the time of posting and is not warranted. The data may not reflect the most current records.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;a href=""/Content/Disclaimer.asp""&gt;View Full Disclaimer Here.&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;table&gt;&lt;form METHOD=POST NAME=frmPrice ACTION=/search/sales_search_results.asp&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Recorded Consideration&lt;p class=""teaser""&gt;Sale Price&lt;/p&gt;&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input TYPE=text SIZE=8 NAME=AmtFrom title=""Minimum Price""&gt;&amp;nbsp;&lt;input TYPE=text SIZE=8 NAME=AmtTo title=""Maximum Price""&gt;&amp;nbsp;&lt;input type=submit value=Submit title=""Click to view search results""&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;form METHOD=POST NAME=frmDate ACTION=/search/sales_search_results.asp&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Transaction Date&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input TYPE=text SIZE=8 NAME=DateFrom title=""Minimum Date""&gt;&amp;nbsp;&lt;input TYPE=text SIZE=8 NAME=DateTo title=""Maximum Date""&gt;&amp;nbsp;&lt;input type=submit value=Submit title=""Click to view search results""&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;form METHOD=POST NAME=frmInstrument ACTION=/search/sales_instrument_search_results.asp&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Instrument Number&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input TYPE=text SIZE=22 NAME=kw1 title=""Enter Complete or Partial Instrument Number""&gt;&amp;nbsp;&lt;input type=submit value=Submit title=""Click to view search results""&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;form METHOD=POST NAME=frmDeedType ACTION=/search/sales_deed_type_search_results.asp&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Instrument Type&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input TYPE=text SIZE=22 NAME=kw1 title=""Enter Exact Deed Type""&gt;&amp;nbsp;&lt;input type=submit value=Submit title=""Click to view search results""&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;form METHOD=POST NAME=frmGrantor ACTION=/search/sales_grantor_search_results.asp&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Seller/Grantor&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input TYPE=text SIZE=8 name=kw1 title=""Enter part of Grantor's Name""&gt;&amp;nbsp;&lt;input TYPE=text SIZE=8 name=kw2 title=""Enter part of Grantor's Name""&gt;&amp;nbsp;&lt;input type=submit value=Submit title=""Click to view search results""&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;form METHOD=POST NAME=frmSubCode ACTION=/search/sales_search_results.asp?type=code&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Subdivision Code&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input TYPE=text SIZE=22 name=SubCode title=""Enter exact Subdivision Code""&gt;&amp;nbsp;&lt;input type=submit value=Submit title=""Click to view search results""&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;form METHOD=POST NAME=frmSubName ACTION=/search/sales_search_results.asp?type=name&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Subdivision Name&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input TYPE=text SIZE=22 name=SubName title=""Enter all or part of the Subdivision Name""&gt;&amp;nbsp;&lt;input type=submit value=Submit title=""Click to view search results""&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;form METHOD=POST NAME=frmUseCode ACTION=/search/sales_search_results.asp&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Land Use Code&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input TYPE=text SIZE=8 NAME=UseFrom title=""Minimum LUC""&gt;&amp;nbsp;&lt;input TYPE=text SIZE=8 NAME=UseTo title=""Maximum LUC""&gt;&amp;nbsp;&lt;input type=submit value=Submit title=""Click to view search results""&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Lookup Subdivision Code&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input type=button value=Lookup title=""Click to lookup code values"" onclick=location.href='/search/subdivision_codes.asp?type=sales'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Lookup Use Code&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input type=button value=Lookup title=""Click to lookup code values"" onclick=location.href='/search/use_codes.asp?type=sales'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Lookup Instrument Type&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input type=button value=Lookup title=""Click to lookup code values"" onclick=location.href='/search/deed_types.asp'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;tr&gt;&lt;td FormDisplayText""&gt;&lt;b&gt;Lookup Transaction Qual. Codes&lt;/b&gt;&lt;/td&gt;&lt;td align=right&gt;&lt;input type=button value=Lookup title=""Click to lookup code values"" onclick=location.href='/search/sales_qualification_codes.asp'&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
</code></pre>

<p>I want a regular expression that will allow me to quickly 
change all the <code>response.write ""&lt;some html here&gt;"" &amp; sometimes with variables &amp; &lt;/more html&gt;""</code></p>

<p><strong>TO</strong></p>

<pre><code>%&gt;
&lt;my html&gt;&lt;%=somevariable%&gt;
&lt;%
</code></pre>

<p>Also, the original code follows no form whatsoever, so rarely are attribute values correctly enclosed in quotations.</p>

<p>I want to do this because it is really hard to debug the ""blob"" plus, when I'm in the IDE, it'd be real nice to be able to see the rendered html. <strong>PLUS</strong> corret me if I'm wrong but isn't this using a lot of my server side resources? Since all of the response.write commands have to be processed server side?  Anyways.  I'd really appreciate anyone who can think of a way to quickly recode this type of a situation.</p>

<p>Here is a page I already did by hand...</p>

<pre><code>Sub ShowCriteriaRow()

    If strPrint &lt;&gt; ""yes"" then 

        %&gt;
        &lt;br /&gt;
        &lt;input type=""text"" id=""kw1"" name=""kw1"" size=""20"" value=""&lt;%=Keyword1 %&gt;""/&gt;&lt;%

        If (PageType &lt;&gt; ""parcel"" and PageType &lt;&gt; ""lastname""and PageType &lt;&gt; ""situs"") Then 
            %&gt;
        &lt;input type=""text"" id=""kw2"" name=""kw2"" size=""20"" value=""&lt;%=Keyword2 %&gt;""/&gt;&lt;%
        End If

        If PageType = ""STR"" Then 
            %&gt;
        &lt;input type=""text"" id=""kw3"" name=""kw3"" size=""20"" value=""&lt;%=Keyword3 %&gt;""/&gt;&lt;%
        End If

        %&gt;
        &lt;input type=""submit"" name=""submit"" id=""submit"" value=""Resubmit"" /&gt;&lt;%

        ShowExportButton

    Else
        Response.Write ""&lt;b&gt;Keywords:&lt;/b&gt; "" &amp; Keyword1 
            If Keyword2 &lt;&gt; """" Then Response.Write "", "" &amp; Keyword2
            If Keyword3 &lt;&gt; """" Then Response.Write "", "" &amp; Keyword3
        Response.Write ""&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;""
    End If  

    %&gt;
        &lt;/td&gt;
    &lt;/tr&gt;&lt;%
</code></pre>

<p>It's a start.  I can't change too much of the underlying structure as it's pretty spaghetti like.</p>
","<regex><refactoring><asp-classic>","0","124","2011-05-16 19:58:55"
"6023916","Refactoring PL/SQL: many cursors with same rowtype (in theory)","<p>I am writing some PL/SQL and found myself falling into a repeptitive pattern:</p>

<pre><code>cursor c_curs1 is
   select a, b, c
   from (...) big_subquery_1
   where big_subquery_1.a_ind = 'Y'

cursor c_curs2 is
   select a, b, c
   from (...) big_subquery_2
   where big_subquery_2.b_ind = 'R'

cursor c_curs3 is
   select a, b, c
   from (...) big_subquery_3
   where big_subquery_3.c_ind = 'M'

...
type t_curs1_tab is table of c_curs1;
type t_curs2_tab is table of c_curs2;
type t_curs3_tab is table of c_curs3;
...
v_curs1_results t_curs1_tab := t_curs1_tab();
v_curs2_results t_curs2_tab := t_curs2_tab();
v_curs3_results t_curs3_tab := t_curs3_tab();
</code></pre>

<p>Then when processing the results, I have code like this:</p>

<pre><code>    open c_curs1;
    fetch c_curs1 bulk collect into v_curs1_results;
    close c_curs1;

    if v_curs1_results.first is not null and v_curs1_results.last is not null then
       for i in v_curs1_results.first .. v_curs1_results.last loop
           /*Do something with field a in the results
             Do something with field b in the results
             Do something with field c in the results*/
           ....
       end loop;
    end if;
</code></pre>

<p>The code in the processing loop is the same for all cursors, as all 3 cursors return <code>a,b,c</code> - the only difference being which cursor is referenced. I wanted to refactor this into some sort of generic result-set processor, but I'm stuck here:</p>

<pre><code>procedure sp_process_collection(in_collection t_curs1_tab) is ...
</code></pre>

<p>I can only call this with <code>v_curs1_results</code>, I can't call it with <code>v_curs2_results</code> or I get a <code>PLS-00306 wrong number of types or arguments...</code> compiler error. Is there any way to do this generically so I only have to write one collection processing procedure? I have this pattern of cursor (returning the same three columns, always the same types) appears in several other parts of the same package, and the processing loop, while semantically the same is sometimes written with slightly different code. I'd very much like to centralize the processing in one procedure, I just can'd figure out how to do it in PL/SQL. I know PL/SQL doesn't have generics (Which I <em>think</em> would have made a Java/C# solution fairly trivial), but I'm wondering if there's another way to approach this problem that I just haven't thought of.</p>

<p>(using Oracle 10g)</p>
","<oracle><generics><plsql><refactoring>","3","264","2011-05-16 21:57:50"
"6025482","Strategy to refactor when too many dependencies injected into service or controller","<p>I have an ASP.NET MVC 1 application that uses NHibernate and Castle Windsor for IoC. The controllers have service classes injected, and these service classes handle all the logic and actions required by the app. The service classes have repositories injected. Each repository handles a single object. Objects are mapped to DB table via NH. I have tried to keep a one to one relationship between services and controllers, but some services are used in more than one controller.</p>

<p>The problem is that some services now have dependencies on 10-15 repositories. The system has an invoicing component for example, where certain actions depend on users, customers, work orders, work order line items, invoices, invoice line items, taxes, etc.</p>

<p>What strategies do people used to refactor effectively when it comes to dependency overload? I'm thinking of splitting one service into many services and to remove the 1-to-1 attempt between services and controllers. But then dependencies at the controller level will increase. Splitting one controller into many controllers is possible with the prior suggestion, but I don't believe that's done unless you break views into partial views? I realize this is a broad question, but I'm more looking for guidance than exact answers. Feel free to provide links to articles or examples of similar refactoring.</p>
","<asp.net-mvc><dependency-injection><refactoring>","5","501","2011-05-17 02:02:56"
"6026568","How to fix bugs in a legacy application without profound refactoring first?","<p>There is a mid-size legacy application (20K LoC, 150 java classes). The quality of design and code is very low, no unit tests, no documentation. However it works. </p>

<p>You're hired to maintain the application. There is a list of very specific properly-reported bugs. It's very difficult to understand how to fix them. Time is limited, you should start solving these bugs within a few weeks (you simply don't have time for a profound refactoring first). How to do this?</p>
","<refactoring>","1","93","2011-05-17 05:25:06"
"6033146","refactoring large cursor queries by splitting into multiple cursors","<p>Another PL/SQL refactoring question!</p>

<p>I have several cursors that are of the general simplified form:</p>

<pre><code>cursor_1 is
  with X as (select col1, col2 from TAB where col1 = '1'),
       Y as (select col1, col2 from TAB where col2 = '3'),
  /*main select*/
  select count(X.col1), ...
  from X inner join Y on...
  group by rollup (X.col1, ...

cursor_2 is
  with X as (select col1, col2 from TAB where col1 = '7' and col2 = '9' and col3 = 'TEST'),
       Y as (select col1, col2 from TAB where col3 = '6'),
  /*main select*/
  select count(X.col1), ...
  from X inner join Y on...
  group by rollup (X.col1, ...


cursor_2 is
  with X as (select col1, col2 from TAB where col1 IS NULL ),
       Y as (select col1, col2 from TAB where col2 IS NOT NULL ),
  /*main select*/
  select count(X.col1), ...
  from X inner join Y on...
  group by rollup (X.col1, ...


...
begin
    for r in cursor_1 loop
       print_report_results(r);
    end loop;

    for r in cursor_2 loop
       print_report_results(r);
    end loop;
    ...
end;
</code></pre>

<p>Basically, all of these cursors (there's more than 3) are the same summary/reporting queries. The difference is in the factored subqueries. There are always 2 factored subqueries, ""X"" and ""Y"", and they always select the same columns to feed into the main reporting query.</p>

<p>The problem is that the main reporting query is VERY large, about 70 lines. This itself isn't so bad, but it was copy-pasted for ALL of the reporting queries (I think there's over a dozen).</p>

<p>Since the only difference is in the factored subqueries (and they all return the same columns, it's really just a difference in the tables they select from and their conditions) I was hoping to find a way to refactor all this so that there is ONE query for the giant report and smaller ones for the various factored subqueries so that when changes are made to the way the report is done, I only have to do it in one place, not a dozen. Not to mention a much easier-to-navigate (and read) file!</p>

<p>I just don't know how to properly refactor something like this. I was thinking pipelined functions? I'm not sure they're appropriate for this though, or if there's a simpler way...</p>

<p>On the other hand, I also wonder if performance would be significantly worse by splitting out the reporting query. Performance (speed) <em>is</em> an issue for this system. I'd rather not introduce changes for developer convenience if it adds significant execution time.</p>

<hr>

<p>I guess what I'd ultimately like is something that looks sort of like this (I'm just not sure how to do this so that it will actually compile):</p>

<pre><code>cursor main_report_cursor (in_X, in_Y) is
    with X as (select * from in_X),
         Y as (select * from in_Y)
  /*main select*/
  select count(X.col1), ...
  from X inner join Y on...
  group by rollup (X.col1, ...

cursor x_1 is
     select col1, col2 from TAB where col1 = '1';
cursor y_1 is
     select col1, col2 from TAB where col2 = '3'

...
begin
for r in main_report_cursor(x_1,y_1) loop
   print_report_results(r);
end loop;

for r in main_report_cursor(x_2,y_2) loop
   print_report_results(r);
end loop;
...
</code></pre>

<p>(Using Oracle 10g)</p>
","<oracle><plsql><refactoring>","6","525","2011-05-17 15:22:08"
"6036267","Designing a multi-module project","<p>I'm new to this concept so I might be wrong in calling it a ""multi-module project"". In the software I'm making, there's one distinct unit with distinct inputs and outputs. I decided to pull it out and run it as a separate (web) service since it has other values in this stand-alone mode.</p>

<p>But the thing is, now the application which was previously blended with this unit has to run standalone, too. And that means there should be a new way for it to communicate with that unit by calling it's service endpoints which adds new layers of complexity (serializing and de-serializing not-so-simple data into XML and JSON). Is there a common practice for this in software engineering? Can I transmit the data in any other way?</p>

<p>The software is being written in Scala which runs on JVM and may or may not affect this story.</p>
","<java><scala><refactoring><software-engineering><multi-module>","0","178","2011-05-17 19:47:25"
"6039846","Is embeding CSS/jQuery code in C# code bad?","<p>I see this type of code when looking through our working code base:</p>

<pre><code>    private Button AddClearButton()
    {
        return new Button
                   {
                       OnClientClick =
                           string.Format(@""$('.{0}').css('background-color', '#FBFBFB');
                                   $('#' + {1}).val('');
                                   $('#' + {2}).val('');
                                   return false;"", _className, _hiddenImageNameClientId, _hiddenPathClientId),
                       Text = LanguageManager.Instance.Translate(""/button/clear"")
                   };
    } 
</code></pre>

<p>or</p>

<pre><code>            _nameAndImageDiv = new HtmlGenericControl(""div"");
            var imageDiv = new HtmlGenericControl(""div"");
            imageDiv.Attributes.Add(""style"", ""width: 70px; height: 50px; text-align: center; padding-top: 5px; "");

            var nameDiv = new HtmlGenericControl(""div"");
            nameDiv.Attributes.Add(""style"", ""width: 70px; word-wrap: break-word; text-align: center;"");
            var image = new HostingThumbnailImage();
</code></pre>

<p>Disclaimer: I have not worked with CSS before. but I heard that we should separate css, js, html, C#, other than put them together.</p>

<p>so, is the above code bad? If yes, how is the better approach?
Thank you.</p>
","<c#><javascript><asp.net><css><refactoring>","10","498","2011-05-18 04:23:25"
"6044778","Can a namespace difference between implementations be generalized/abstracted/refactored?","<p>Below are three implementation of the interface. The only difference between implementation <code>1</code> and implementation <code>2</code> is the namespace containing the <code>ItemWrapper</code>. Can this be refactored using generalization or something else perhaps?</p>

<pre><code>interface IItemProvider {
    object GetItem(Item item);
}

//1
class SomeNamespaceProvider : IItemProvider {
    object GetItem(Item item) {
        return SomeNamespace.ItemWrapper.GetItem(item);
    }
}

//2
class OtherNamespaceProvider : IItemProvider {
    object GetItem(Item item) {
        return OtherNamespace.ItemWrapper.GetItem(item);
    }
}

//3
class TotallyDifferentProvider : IItemProvider {
    object GetItem(Item item) {
        return DifferentItemRetriever(item);
    }
}
</code></pre>
","<.net><generics><refactoring><performance><theory>","0","36","2011-05-18 12:40:08"
"6057780","How to add jQuery to a framework without break it","<p>We have a framework based in C# + XSLT + javascript, that is used as a base for the projects of the company.</p>

<p>The company has announced that in a few days I will be the responsable of this framework. The objectives are:</p>

<ul>
<li>Repair bugs</li>
<li>Add new features</li>
</ul>

<p>The problem is this framework has a lot of bugs, there's not documentation (none, zero), contains bad practices of code, and some antipatterns. (Also doesn't use any naming conventions).</p>

<p>One of the first things I thought was starting for the javascript part, and add jQuery library for use the functions of jQuery for DOM access, XML manipulation and AJAX calls and other stuff, because some of the actuals are buggy.</p>

<p>I'm afraid to be the ""so-clever-guy-that-refactors-and-breaks-the-project"" and i have to be so careful, because this framework is used in a lot of projects, and breaking the framework would be ""so much visible"". </p>

<p>How can start to adapt the code to works with jQuery?</p>
","<javascript><jquery><refactoring>","1","54","2011-05-19 11:16:44"
"6051318","Best practice for accessing Page / controls on Page from other classes?","<p>I'm refactoring some code and I've gotten into the practice of doing this:</p>

<pre><code>protected void Page_Init(object sender, EventArgs e)
{
    Logger.Info(""Page Initialization."");
    //Provides highlighting/docking functionality at the start, but overshadows controls in more complex scenarios.
    RadDockZone1.Visible = (RadControlStates.SplitterStates.Count == 0);

    ControlRegeneration.RegenerateReportMenu(lstBxHistorical, lstBxCustom);
    ControlRegeneration.RegeneratePaneChildren(RadPane2);
    ControlRegeneration.RegenerateDockZones(Page);
    ControlRegeneration.RegenerateDocks(RadDockLayout1, RadDock_Command, UpdatePanel1);
}
</code></pre>

<p>I'm wondering if it is good practice to pass Page and Page controls to other functions like this.</p>

<p>I was considering creating a singleton that will hold references to the relevant page controls, and then accessing the controls through that instance instead.</p>

<p>Something like...</p>

<pre><code>public class DashboardPageControlsRepository
{
    private static readonly DashboardPageControlsRepository instance = new      DashboardPageControlsRepository();

    private DashboardPageControlsRepository() { }

    private Control myPanel;

    public static DashboardPageControlsRepository Instance
    {
        get { return instance; }
    }

    public void SetPageState(Page page)
    {
        myPanel = Utilities.FindControlRecursive(page, ""UpdatePanel1"")
    }

    public Control Panel
    {
        get { return myPanel; }
    }
}
</code></pre>

<p>Then, during page init before anything happens I would go and grab all my controls -- allowing me to access them through here rather than passing them down.</p>

<p>Any thoughts on how to handle this?</p>
","<c#><refactoring>","0","69","2011-05-18 21:37:05"
"6063043","RSpec: How do I refactor a group of tests that are repeated and the only thing that changes is the subject and expectations","<p>I have a test suite that resembles the situation I describe with the following code. There are two contexts that define the subject. The subject is similar, the same kind of object, but with different values.</p>

<p>Over that subject I run two tests. One test is exactly the same for both and the other is different. </p>

<p>Suggest a refactor that would eliminate duplication, besides the obvious 'move the code to a method', which I don't like because it looses clarity.</p>

<pre><code>require 'rspec'

describe ""tests over numbers"" do
  context 'big numbers' do
    subject { 5000 }

    describe ""#to_string"" do
      its(:to_s) {should be_a(String)}
    end

    describe ""#+1"" do
      it ""+1"" do
        sum = subject+1
        sum.should == 5001
      end
    end        
  end
  context 'small numbers' do
    subject { 100 }

    describe ""#to_string"" do
      its(:to_s) {should be_a(String)}
    end

    describe ""#+1"" do
      it ""+1"" do
        sum = subject+1
        sum.should == 101
      end
    end        
  end                                           
end
</code></pre>
","<refactoring><rspec>","0","118","2011-05-19 18:14:13"
"6064507","Change Core Data entity name with Lightweight migration?","<p>Is there a way to change the name of a Core Data entity name while still using ""Automatic Lightweight Migration"" on iOS?</p>
","<iphone><ios><core-data><refactoring><migration>","1","317","2011-05-19 20:29:36"
"6066275","Refactoring 2 similar if statements","<p>Would you write this code any differently? I don't mind tertiary operator by the way so any ideas that include it are also welcome</p>

<pre><code>if ($stopYear &lt; $startYear) {
   for ($i = $startYear; $i &gt;= $stopYear; $i--) {
     $yearMultiOptions[$i] = $i;
   }
} else {
   for ($i = $startYear; $i &lt;= $stopYear; $i++) {
     $yearMultiOptions[$i] = $i;
   }
}
</code></pre>
","<php><refactoring>","1","49","2011-05-20 00:24:02"
"6069421","When refactoring a J2EE WebApp is useful?","<p>I am dealing with a J2EE webapplication that needs some refactoring, I am currently in charge of doing this job and am currently at a loss on what would be necessary to be done or changed in order to improve the application.</p>

<p>My question is: <strong>how can the frontend part be refactored?</strong> </p>

<p>I already refactored the CSS files in order for them to have generic rules and classes and removing unused or wrong rules, I refactored all Javascript files using some patterns (not using prototype inheritance since it's not really useful here) and adding PrototypeJS and still need to finish aggregating JS functions (when possible) in Objects and included files.</p>

<p>Now I am finishing up adding <em>Localization</em> to pages that missed it or where it wasn't complete and I want to migrate the whole application to <em>XHTML Transitional</em> following W3C guidelines strictly.</p>

<p>I also have in mind to start using <em>Struts Tiles</em> to add templates and in the mean time remove the old ""Tables Layout"" the frontend is currently using, so actually redesigning the whole application.</p>

<p>But I am at a loss here: is what I am doing useful? Does all this work need to be done or am I just going too far? What would you add up? What would you do instead?</p>
","<java><web-applications><refactoring>","1","53","2011-05-20 08:39:57"
"6076403","Database redesign then reload approach using linq to excel and entity framework","<p>So I've got a few tables with a lot of data.  Let's say they are table A, B and C.  I want to add auto increment ID fields for each of those tables, normalize them by swapping some fields between the tables and add an additional table D.  Gulp.  There are three goals: 1) redesign the database, and reload the existing data.  2) Enable a data load from a spreadsheet to add/edit/delete the four tables.  3) Enable a web front end to add/edit/delete the four tables.  </p>

<p>My current approach:</p>

<ul>
<li>I thought I would export a flat file for all the data in the 3 existing tables into a csv (spreadsheet).</li>
<li>Then refactor the database design structure</li>
<li>Then use linq to excel to read back the csv spreadsheet records into dto objects</li>
<li>Then use the Entity Framework to transform those dto objects into Entities to update the database with the appropriate relationships between tables</li>
<li>The spreadsheet would be re-used for future bulk data add/edit/deletes </li>
</ul>

<p>What about the following tools?
SSIS
Bulk insert 
Stored procedures</p>

<p>Am I over complicating this?  Is there a better way?  </p>
","<sql><entity-framework><ssis><refactoring-databases><linq-to-excel>","0","238","2011-05-20 18:51:39"
"6095066","Refactoring big if else code","<p>I have this really long if else code </p>

<pre><code> if (errorNumbers.Length == 6)
      {
        if (errorNumbers.Substring(0,4).Equals(""1101"") || errorNumbers.Substring(0,4).Equals(""2121""))
        {
          retStr = ""AutoRepickAfterPickError"";
        }
        else if (errorNumbers.Substring(0, 4).Equals(""1301"") || errorNumbers.Substring(0, 4).Equals(""2321""))
        {
          retStr = ""AutoRepickAfterLAlignError"";
        }
        else if (errorNumbers.Substring(0, 4).Equals(""1401"") || errorNumbers.Substring(0, 4).Equals(""2221""))
        {
          retStr = ""AutoRepickAfterCAlignError"";
        }
        else if (errorNumbers.Substring(0, 4).Equals(""1501"") || errorNumbers.Substring(0, 4).Equals(""2041""))
        {
          retStr = ""AutoRepicksAfterManualRecovery"";
        }
</code></pre>

<p>etc.....</p>

<p>How I can rewrite it to something more nice .
Trying to learn here something new , and I am in .net 2.0.
Thanks for help.</p>
","<c#><.net><refactoring>","3","338","2011-05-23 09:05:31"
"6098990","Large Configuration for class, implementation suggestions","<p>So I have a large class that I'm refactoring to be more flexible.</p>

<p>well over 100 configurable properties (variables) in a INI file. Some are dev settings and others are production settings. </p>

<p>Currently I use a environment flag to pull the INI settings I need (either dev or prod).</p>

<p>All the INI fields are mandatory and must be set. (currently using setters for this).</p>

<p>So what makes more sense?</p>

<ul>
<li>A: to keep the current setup</li>
<li>B: Move to another type of configuration setup (like xml or something)</li>
<li>C: Move all settings into the script itself and remove the INI parsing and validation code (setters)</li>
<li>D: suggestions?</li>
</ul>

<p>Bonus question:</p>

<p>I was reading this over the weekend: <a href=""http://berryllium.nl/2011/02/getters-and-setters-evil-or-necessary-evil/"" rel=""nofollow"">http://berryllium.nl/2011/02/getters-and-setters-evil-or-necessary-evil/</a> and wanted to know how I could follow more of this type of development style but confused as how to not use getter/setter functionality with setting mandatory fields? I understand the need to getters/setters and wanted to know if I'm implementing them correctly? </p>

<p>I use the INI for stuff like DB settings, validation limits (think spending limit of $100 but could change), large array (static values like the 50 US States but with the ability to add US territories as well)</p>
","<php><optimization><configuration><refactoring><ini>","2","58","2011-05-23 14:58:51"
"6092357","Why doesn't Eclipse add @Override annotations in ""Generate Delegate Methods"" refactoring?","<p>In Eclipse, if I try to apply a ""Generate Delegate Methods"" refactoring to a Java class like the following:</p>

<pre><code>class Foo implements Bar {
   Bar bar;
}
</code></pre>

<p>Eclipse doesn't generate <code>@Override</code> annotations for the generated methods.  Is this a bug or is there a good reason for this?</p>
","<java><eclipse><refactoring><code-generation><jdt>","4","496","2011-05-23 02:45:27"
"6120422","Catching specific exception","<p>How can I catch specific exception using c# ? <br>
In my database there is unique index on some columns.<br>
when user inserts duplicate record this exception has been throw :</p>

<blockquote>
  <p>Cannot insert duplicate key row in
  object 'dbo.<em>BillIdentity' with unique
  index 'IX</em>_BillIdentity'. The
  statement has been terminated.</p>
</blockquote>

<p>How can I catch this exception? <br>
Currently I am checking using this code :</p>

<pre><code> catch (Exception ex) {
    if (ex.Message.Contains(""Cannot insert duplicate key row in object 'dbo._BillIdentity' with unique index 'IX__BillIdentity"")) {
        string ScriptKey = ""$(function() {ShowMessage('Error');});"";
        ScriptManager.RegisterStartupScript(Page, GetType(), ""script"", ScriptKey, true);
    }
}
</code></pre>

<p>I think its bad smell code.<br>
Is there any better way?</p>
","<c#><exception-handling><refactoring>","2","863","2011-05-25 06:31:14"
"6112569","Using flow chart or diagram for routines across programs","<p>I have a busy set of routines to validate or download the current client application.  It starts with a Windows desktop shortcut that invokes a .WSF file.  This calls on several .VBS files, an .INI for settings, and potentially a .BAT file.  Some of these script documents have internal functions.  The final phase opens a Microsoft Access database, which entails an AutoExec macro, which kicks off some VBA, including a form which has a load routine of its own in VBA.  </p>

<p>None of this detail is specifically important (so please don't add a VBA tag, OR criticize my precious complexity).  The point is I have a variety of tools and containers and they may be functionally nested.  </p>

<p>I need better techniques for parsing that in a flow chart.  Currently I rely on any or all of the following:</p>

<ul>
<li>a distinct color</li>
<li>a big box that encloses a routine</li>
<li>the classic 'transfer of control' symbol</li>
<li>perhaps an explanatory call-out</li>
</ul>

<p>Shouldn't I increase my flow charting vocabulary?  Tutorials explain the square, the diamond, the circle, and just about nothing more.  Surely FC can help me deal with <strong>these sorts of things:</strong></p>

<ol>
<li>The plethora of script types lets me answer different needs, and I want to indicate tool/language.</li>
<li>A sub-routine could result in an abort of the overall task, or an error, and I want to show the handling of that by (or consequences for) higher-level ""enclosing"" routines.</li>
<li>I want to distinguish ""internal"" sub-routines from ones in a different script file.</li>
<li>Concurrent script processing could become critical, so I want to note that.   </li>
<li>The .INI file lets me provide all routines with persistent values.  How is that charted?</li>
<li>A function may have an argument(s) and a return value/reference ... I don't know how to effectively cite even that.  </li>
</ol>

<p>Please provide guidance or point me to a extra-helpful resource.  If you recommend an analysis tool set (like UML, which I haven't gotten the hang of yet), please also tell me where I can find a good introduction.  </p>

<p>I am not interested in software.  Please consider this a white board exercise.  </p>
","<scripting><refactoring><flowchart>","3","355","2011-05-24 15:03:53"
"6130901","How do you factor out common ""before(:each)"" calls in RSpec so that multiple specs can use them?","<p>I'd like to factor this bunch of code so that all of my controller tests (well, almost all of them) use this <code>before(:each)</code> block:</p>

<pre><code>before(:each) do
  @user = User.new
  controller.stub(:authenticate_user!)
  controller.stub(:current_user).and_return(@user)
  controller.stub(:add_secure_model_data)
end
</code></pre>

<p>Is there any way to do that? I don't want to include it in all controllers... because there are a few that don't need this. By basically, every controller that extends from <code>SecureController</code> will need this <code>before(:each)</code> block.</p>

<p>Is there any nice way to do that?</p>

<p>Thanks</p>
","<ruby-on-rails><ruby><unit-testing><refactoring><rspec>","5","163","2011-05-25 21:01:42"
"6143017","Visual Studio-like refactor tool for SQL","<p>Are there any free tools providing snippets and syntax checking similar to Refactor in Visual Studio 2003/05/08/10? </p>

<p>@edit: To MSSQL, any version..</p>
","<sql><sql-server><syntax><tools><automated-refactoring>","2","122","2011-05-26 17:59:55"
"6144160","Not sure I should be using an Interface here, but what?","<p>I have multiple *.ascx controls. Each one represents a Microsoft Chart Control, but different types of charts. These charts all expose several methods with identical functionality because they all implement an IChartControl interface. I hate the fact that there are cases where each chart's implementation is identical -- the code is copy/pasted. </p>

<p>I chose to have them implement an IChartControl interface because I could not find a solution of reasonable complexity that would allow these chart controls to utilize the same functions. Inheriting a base 'Chart' class proved exceedingly complicated in that you can't really inherit the HTML markup behind the controls.</p>

<p>What I would like to do is the following:</p>

<p>The signature for one of the classes is this:</p>

<pre><code>public partial class HistoricalLineGraph : System.Web.UI.UserControl, IChartControl
</code></pre>

<p>I would like to create a new class which inherits from System.Web.UI.UserControl. This class would implement the IChartControl interface. In this way I could provide a base implementation for the methods I want to define, but I run into a snag. Look at the following method that I would like to abstract out to a higher level so that the code is inherited by all of my charting classes:</p>

<pre><code>public void LoadData(string data)
{
    if (!string.IsNullOrEmpty(data))
    {
        byte[] dataAsArray = System.Text.Encoding.UTF8.GetBytes(data);
        MemoryStream stream = new MemoryStream(dataAsArray);
        Chart1.Serializer.Load(stream);
    }
}
</code></pre>

<p>A middle-man class between HistoricalLineGraph and System.Web.UI.UserControl will have no concept of the object 'Chart1' as it is defined in HistoricalLineGraph.</p>

<p>Is there an obvious solution to this problem that I am missing?</p>

<p>EDIT: I would like to be able to do something with properties defined in the IChartControl interface. If I am passing a 'Chart' control as a parameter to the above function, what would a solution be to the below?</p>

<pre><code>public string Title 
{
    get { return Chart1.Titles[1].Visible ? Chart1.Titles[1].Text : Chart1.Titles[0].Text; }
    set { Chart1.Titles[0].Text = value; }
}
</code></pre>
","<c#><interface><refactoring>","1","98","2011-05-26 19:44:18"
"6133254","What is Rails ActiveRecord find(x) method that is equivalent to a lazy-evaluated-scope? How to refactor ActiveRecord finder?","<p>Is Rails' find(x) method on a model lazy? If not, what is the equivalent?</p>

<p>I am new to Rails, so I found myself writing scopes like this:</p>

<pre><code>class Course &lt; ActiveRecord::Base
  scope :by_instructor_id, lambda { |instructor_id| where(:instructor_id =&gt; instructor_id) }
  scope :by_course_template_id, lambda { |course_template_id| where(:course_template_id =&gt; course_template_id ) }
  scope :by_company_id, lambda { |company_id| joins(:instructor).merge(CompanyUser.by_company_id(company_id)) }
end
</code></pre>

<p>It's not a lot of work, but now I'm asking myself... if Rails provided these with a scope, I wouldn't have to write them.</p>

<p>So, does Rails offer them? Can I do something like the below code and only make it do 1 database call?</p>

<pre><code>Company.find(params[:id]).instructors.courses
</code></pre>

<p>instead of</p>

<pre><code>Course.by_company_id(params[:id])
</code></pre>

<p>Which is correct? I know <code>Course.by_company_id(params[:id])</code> is only 1 database call. It is very familiar to writing SQL or queries in Hibernate. But if you can write it the other way, maybe one should?</p>

<p>However, I don't want to write <code>Company.find(params[:id]).instructors.courses</code> if it results in more than 1 database call. I can see the advantage though because it means never having to write the 3 scopes I showed you above, but I am worried that <code>Company.find(x)</code> is not lazy. Is it?</p>
","<ruby-on-rails><ruby><activerecord><refactoring>","3","199","2011-05-26 03:02:43"
"6146566","How to rename method name or attribute in codeigniter project with cascading?","<p>I would like to rename method name ""saveDate()"" in controller inside codeigniter framework 
this method is used in many different location across the project . 
Is there is an IDE or tool helps me to rename this method name without going to all files in the project who call this method??? </p>
","<php><codeigniter><refactoring><call>","1","80","2011-05-27 00:29:15"
"6149731","Java: Two classes with nearly identical methods using two different enums; possible to avoid redundancy? (static methods everywhere)","<p>I have two enums describing two UML profiles (meaning they define stereotypes that the profiles contain).</p>

<p>I also have two utility classes featuring nearly identical methods working on each of the profiles.</p>

<p>Example:</p>

<pre><code>public static List&lt;Element&gt; getStereotypedElements(final InsertProfileHere stereo, final Package pkg) {
    List&lt;Element&gt; extendedElements = new ArrayList&lt;Element&gt;();      
    if (isProfileApplied(pkg)) {
        if (hasStereotype(stereo, pkg)) {
            extendedElements.add(pkg);
        }
        extendedElements.addAll(getStereotypedElements(stereo, pkg.allOwnedElements()));
    }
    return extendedElements;
}
</code></pre>

<p>,where <strong>InsertProfileHere</strong> can be replaced with each of the two profile enums.</p>

<p>If anyone is interested, this method uses the Eclipse Modeling Framework or rather the UML2 metamodel implementation in EMF.</p>

<p>Anyway, I want to merge the two utility classes to avoid redundant code.</p>

<p>I've tried:</p>

<ul>
<li>a super interface for the two profiles
<ul>
<li>didn't work because of static methods</li>
</ul></li>
<li>an abstract class for the Utility classes
<ul>
<li>didn't work because of static methods</li>
</ul></li>
<li>encapsulating the profile enums in a class</li>
</ul>

<p>Each didn't work for one or another reason.</p>

<p>Anyone got any ideas?</p>

<p>EDIT:</p>

<p>An example for another utility method:</p>

<pre><code>public static boolean hasStereotype(
    final InsertProfileHere stereo, final Element elem) {
    for (Stereotype appliedStereo : elem.getAppliedStereotypes()) {
        if (stereo == null) {
            if (InsertProfileHere.contains(appliedStereo)) {
                return true;
            }
        } else if (stereo.isEqual(appliedStereo)) {
            return true;
        }
    }
    return false;
}
</code></pre>

<p>EDIT2: And for good measure part of the implementation of the profile enum</p>

<pre><code>public enum Profile1 { 

STEREOTYPE1 (""readable stereotype1 name""),
STEREOTYPE2 (""readable stereotype2 name""),
STEREOTYPE3 (""readable stereotype3 name""),

public static final String PROFILE_NAME = ""NameOfProfile"";

private final String readableName;

private Profile1(final String newName) {
    readableName = newName;
}

public static Profile1 getValue(final String name) {
    for (Profile1 type : Profile1.values()) {
        if (type.toString().equals(name)) {
            return type;
        }
    }
    return null;
}

public static boolean contains(Stereotype stereotype) {
    return (stereotype.getProfile().
            getDefinition().getNsURI().contains(PROFILE_NAME));
}
</code></pre>
","<java><enums><refactoring><uml><eclipse-emf>","2","215","2011-05-27 08:34:23"
"6152658","Review extended List<> functionality","<p>I was curious if I could enhance the standard generic <code>List&lt;&gt;</code> functionality because I was fed up with writing code such as:</p>

<pre><code>var list = new List&lt;Person&gt;{
     new Person{Name = ""David"", Age = 24},
     new Person{Name = ""John"", Age = 30}
 };
list.Add(new Person{Name = ""Terry"", Age = 28});
</code></pre>

<p>I'd prefer that <code>T</code> could be implicitly constructed. The best I came up with allowed me to do this with up to four object construction parameters:</p>

<pre><code>  var list = new ListWithConstructor&lt;string, int, Person&gt;(
                (name,age) =&gt; new Person { Name = name, Age = age })
  {
       {""David"", 24},
       {""John"", 30}
  };          
  list.Add(""Terry"", 28);
</code></pre>

<p>This is implemented like this:</p>

<pre><code>public class ListWithConstructor&lt;T1, T&gt; : List&lt;T&gt;
{
    private readonly Func&lt;T1, T&gt; itemConstructor;
    public ListWithConstructor(Func&lt;T1, T&gt; itemConstructor)
    {
        this.itemConstructor = itemConstructor;
    }

    public void Add(T1 arg1)
    {
        base.Add(itemConstructor(arg1));
    }
}

public class ListWithConstructor&lt;T1, T2, T&gt; : List&lt;T&gt;
{
    private readonly Func&lt;T1, T2, T&gt; itemConstructor;
    public ListWithConstructor(Func&lt;T1, T2, T&gt; itemConstructor)
    {
        this.itemConstructor = itemConstructor;
    }

    public void Add(T1 arg1, T2 arg2)
    {
        base.Add(itemConstructor(arg1, arg2));
    }
}
</code></pre>

<p>...and so on for up to four arguments.</p>

<p>Obviously the other <code>List&lt;&gt;</code> constructors (taking a capacity and an <code>IEnumerable</code> of existing elements) can be implemented as well.</p>

<p>How can this be improved?</p>
","<c#><refactoring>","0","71","2011-05-27 13:08:32"
"6153625","Refactoring a list of objects to implement a business rule","<p>I need to refactor the following class:</p>

<pre><code>public interface IEmployee
{
    int VacationWeeks { get; }
    int YearsWithCompany { set; get; }
    double Salary { set; get; }
}

public class Employee : IEmployee
{
    private readonly int vacationWeeks;

    public Employee(int vacationWeeks)
    {
        this.vacationWeeks = vacationWeeks;
    }

    public int VacationWeeks
    {
        get { return vacationWeeks; }
    }

    public int YearsWithCompany { set; get; }
    public double Salary { set; get; }
}
</code></pre>

<p>I need to make sure that VacationWeeks depends only on YearsWithCompany, and I am loading the mapping from the database. So far I have come up with this:</p>

<pre><code>public class EmployeeNew : IEmployee
{
    private Dictionary&lt;int,int&gt; vacationWeeksTable;

    public EmployeeNew(Dictionary&lt;int, int&gt; vacationWeeksTable)
    {
        this.vacationWeeksTable = vacationWeeksTable;
    }

    public int VacationWeeks
    {
        get { return vacationWeeksTable[YearsWithCompany]; }
    }

    public int YearsWithCompany { set; get; }
    public double Salary { set; get; }
}
</code></pre>

<p>This class implements what I want, but it still has one vulnerability: different instances of EmployeeNew in the same collection may have been created with different instances of vacationWeeksTable. </p>

<p>All instances of EmployeeNew in the same collection must refer to the same vacationWeeksTable.</p>

<p>The application I am refactoring uses lots of List all over the system, and we need to be able to modify YearsWithCompany and Salary, yet to guarantee that only one vacationWeeksTable is used per List. These lists are iterated several times; its elements are modified in each iteration.</p>

<p>Here is my imperfect solution. Suggestions are welcome:</p>

<pre><code>// this class does two things, which I do not like
    public class EmployeeList : IEnumerable&lt;IEmployee&gt;, IEmployee
    {
        private Dictionary&lt;int, int&gt; vacationWeeksTable;
        private List&lt;EmployeeSpecificData&gt; employees;
        private int currentIndex;
        private EmployeeSpecificData CurrentEmployee
        {
            get { return employees[currentIndex]; }
        }

        public IEnumerator&lt;IEmployee&gt; GetEnumerator()
        {
            for (currentIndex = 0; currentIndex &lt; employees.Count; currentIndex++)
            {
                yield return this;
            }
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }

        public int VacationWeeks
        {
            get { return vacationWeeksTable[YearsWithCompany]; }
        }

        // this is ugly repetitive code I don't like
        public int YearsWithCompany
        {
            get { return CurrentEmployee.YearsWithCompany; }
            set { CurrentEmployee.YearsWithCompany = value; }
        }

        // this is ugly repetitive code I don't like
        public double Salary
        {
            get { return CurrentEmployee.Salary; }
            set { CurrentEmployee.Salary = value; }
        }


    }
</code></pre>
","<c#><linq><refactoring><refactor-my-code>","4","177","2011-05-27 14:23:57"
"6163634","Avoiding overuse of method overloading","<p>I've come across a Java utility class that has four methods for processing data.  All methods process and then write the parameters to the same file, and each method accepts four different sets of inputs:</p>

<pre><code>util::process(String data1)
util::process(String data1, Object1 data2)
util::process(String data1, String data3)
util::process(String data1, Object2 data4)
</code></pre>

<p>I'm seeing what feels like a code smell because every time a new combination of data is introduced, a new method is also added.  The method overloading feels like it is masking a design or object construction issue.</p>

<p>Is it possible to refactor this and avoid method overloading?  How?</p>
","<java><design-patterns><refactoring><code-smell><method-overloading>","2","234","2011-05-28 18:32:10"
"6168601","Where should I put a function that is called many times?","<p>This is a follow-up to this question <a href=""http://stackoverflow.com/questions/6062725/how-to-avoid-repeated-code"">How to avoid repeated code?</a></p>

<p>I am using ASP.NET 4.0 with C# and I have a function called <code>FillDropDownList(DropDownList ddl, DataTable dt, string dataValueField, string dataTextField, string defValue)</code> which is called multiple times on one of my ASP.NET pages to populate some dropdown lists. I am now finding that I have several pages where I need to populate several dropdownlists in exactly the same way.</p>

<p>Rather than copying and pasting the same code in different pages, should I create a new class and put the method in that new class? How would I call it? What should I call the class? Should it have other functions in it? I was thinking maybe I should call it <code>Util</code>? What would you do?</p>
","<c#><asp.net><c#-4.0><refactoring>","3","192","2011-05-29 15:35:28"
"6178658","DDD modeling question - help come up with some good names","<p>I believe names are pretty important to get right. It helps make things clear, and I find the logic goes in the right spots when you have a clear idea as to what the abstractions are and what they are called.</p>

<p>I am also developing in Ruby, and while I have a really strong test suite, changing a model name takes awhile, so I'd rather at least try and get it right.</p>

<p><strong>The problem:</strong>
Here are 3 model concepts, but I don't know what the best names would be for them.</p>

<ol>
<li><p>Users can create courses or learning programs. This is a template of what a course consists of, but it's not a course itself. Does that make sense? It contains all the information that would be in a course... in the same way a Class contains all the data/methods for an object. It's like the ""meta"" of a course. The best names I can come up with are <code>LearningProgram</code> or <code>CourseTemplate</code></p></li>
<li><p>Companies/education facilities can create courses. These courses are based on the template in point 1. These are REAL courses - i.e. they have a real date and real people actually sign up/participate in them. I guess the best name I can come up for this is <code>Course</code>. It points to 1 of the models in point 1.</p></li>
<li><p>People can take take courses, but they have their own copy of the course that only applies to them, so we need a model to house all of the specific information pertaining to that course. It's basically a Many-to-many relationships with <code>Course</code> in point 2. The best names I can come up with is <code>ActiveCourse</code>, <code>CourseInstance</code>, <code>CourseProgress</code>, <code>CourseParticipant</code></p></li>
</ol>

<p>I am not liking my names at all. Can someone help me come up with 3 better names?</p>
","<design><refactoring><domain-driven-design><domain><modeling>","2","136","2011-05-30 16:28:30"
"6188792","Automatic regenerate designer files","<p>Recently I've been making some improvements to a lot of the controls we use, for example give properties default values and making buttons private instead of protected.
By making this kind of adjustments you need to regenerate the designer files of the forms which have this control on it or controls which inherit from the control.</p>

<p>In the past this wasn't really a problem because we only had 20-30 forms. At the moment we've got more than 300 forms which would mean opening the same amount of designers in VS2010.</p>

<p>So my question: do you know a way of automating this process so all of the forms get regenerated?</p>

<p>I've been thinking about a macro which looks for designer files and opens the file (with a max of 25-50 files open to make sure VS won't crash), but I've not been able to get this working.</p>

<p>I hope someone has a suggestion!</p>
","<c#><visual-studio><gui><windows-forms-designer><automated-refactoring>","8","648","2011-05-31 14:04:40"
"6193216","How do I abstract similar validations/relations to parent class in Ruby/Rails?","<p>I have these VERY similar classes:</p>

<pre><code>class DeliveryDocument &lt; CommercialDocument
  # Relations
  belongs_to :biller, :class_name =&gt; 'Company'
  belongs_to :customer, :class_name =&gt; 'Company'
  belongs_to :customer_center, :class_name =&gt; 'Center'
  has_many :delivery_document_lines, :dependent =&gt; :destroy
  alias_attribute :lines, :delivery_document_lines
  # Some configuration
  accepts_nested_attributes_for :delivery_document_lines
  acts_as_freezable :only_dependencies =&gt; true,
    :has_many =&gt; [:delivery_document_lines],
    :belongs_to =&gt; [:biller, :customer, :customer_center]
  acts_as_clonable :has_many =&gt; [:delivery_document_lines]
  validates_each :lines do |record, attr, value|
    # ...
  end
end
</code></pre>

<p>And:</p>

<pre><code>class InvoiceDocument &lt; CommercialDocument
  self.
  # Relations
  belongs_to :biller, :class_name =&gt; 'Company'
  belongs_to :customer, :class_name =&gt; 'Company'
  belongs_to :customer_center, :class_name =&gt; 'Center'
  has_many :invoice_document_lines, :dependent =&gt; :destroy
  alias_attribute :lines, :invoice_document_lines
  # Some configuration
  accepts_nested_attributes_for :invoice_document_lines
  acts_as_freezable :only_dependencies =&gt; true,
    :has_many =&gt; [:invoice_document_lines],
    :belongs_to =&gt; [:biller, :customer, :customer_center]
  acts_as_clonable :has_many =&gt; [:invoice_document_lines]
  # Validations
  validates_each :lines do |record, attr, value|
    # ...
  end
end
</code></pre>

<p>I also have some methods I didn't paste that could be extracted to the parent. I only need to know the class name in the parent. When I do this:</p>

<pre><code>class CommercialDocument &lt; Document  # document inherits from AR::Base
  # ...
  has_many :""#{self.to_s.underscore}_lines"", :dependent =&gt; :destroy
  # ...
  accepts_nested_attributes_for :""#{self.to_s.underscore}_lines""
  # ...
end
</code></pre>

<p>it doesn't work, because <code>self.to_s</code> is <code>CommercialDocument</code>.</p>

<p>How would you refactor this behavior in parent class? 
I could put things in a module and import it, but then the whole hierarchy of documents becomes almost useless.
I already have the documents' hierarchy, so if I can, I want to use it if there is a way.</p>
","<ruby><validation><refactoring><parent><relations>","0","65","2011-05-31 20:31:53"
"6219801","Refactoring a Dictionary, changing key type","<p>I am refactoring a C# library that uses a <code>Dictionary&lt;int, SomeInterface&gt;</code> all over the system.
I need to change the key type from int to string, and use a <code>Dictionary&lt;string, SomeInterface&gt;</code> instead, and I am making dozens of changes.
How to do it better, how to define a type in one place and uses it everywhere, so that if I need to change it later, I can change it in one place?</p>

<p>I already added a GetKey() method to my interface.</p>

<p>Edit: the library is used in other DLLs, and I want to limit possible changes to only one library. This is an agile shop, so we need to be ready for changes.</p>
","<c#><refactoring><refactor-my-code>","3","158","2011-06-02 20:09:32"
"6226784","How to refactor multiple complex if-else branches","<p>This problem is for a piece of software that is use by companies that organise activities. When an activity is changed (status, starting time, number of persons), some people need to be notified of this (by e-mail). The code that is responsible for this started out very simple: the body of the e-mail contained all the old values and new values of the information that was changed.</p>

<p>Over the years, many small rules were introduced. For example: if the new status is 'cancelled', the subject of the mail should be: ""Activity cancelled"" instead of ""Activity changed"". If there is no previous status (so the activity is new), and the current status is ""final"", then the subject should be ""New Activity on [date]"" and the body should contain a full overview (so no changes).</p>

<p>These rules above just serve to illustrate the problem. There are quite a few more of them (concerning combinations of status/date/time/etc.), totalling up to about 500 lines of code.</p>

<p>The problem that occurs is that this code is currently quite hard to understand and maintain. New rules are introduced every now and then, and adding them without breaking other rules can be a pain. What would be the best way to rewrite code like this into more understandable and maintainable code? Currently, the order of the if-else branches is also really important. The first if statement is the most important, the next else-if statement is bit less important, until the final else clause for the most general case.</p>
","<refactoring><structure><if-statement>","3","169","2011-06-03 11:54:31"
"6227259","Real examples of ASP.NET MVC code refactored for Dependency Injection using Ninject","<p>Good morning!</p>

<p>Yesterday I watched Tekpub's amazing video <a href=""http://tekpub.com/view/concepts/1"" rel=""nofollow"" title=""Dependency Injection and Inversion of Control"">""Dependency Injection and Inversion of Control""</a> and it blew my mind.  I feel like this is how I should be writing code.  I have watched it before and even experimented with Ninject a little bit, but feel like I need some more examples of code being refactored into this paradigm.</p>

<p>The brief MUD example he goes into is great, but does anyone know of a site or project where they start with some ugly, but working, code and then refactor it into clean Dependency Injected code? </p>

<p>While I can find examples of code that use Dependency Injection pretty easily, I am having a hard time finding before/after code and I feel like this would greatly help me start programming ""at the next level"".  I need a few more examples to really wrap my head around it.</p>
","<asp.net-mvc><dependency-injection><refactoring><inversion-of-control><ninject>","9","614","2011-06-03 12:46:11"
"6228275","Reduce memory foot print by replace anonymous class with singleton. But need to refactor the design more","<p>So I have this method that get executed repeatedly</p>

<pre><code>public static boolean isReady(String dirPath, int numPdfInPrintJob){
    File dir = new File(dirPath);
    String[] fileList = dir.list(new FilenameFilter(){
        public boolean accept(File file, String filename) {
            return (filename.toLowerCase().endsWith("".pdf""));
        }
    });
    if(fileList.length &gt;= numPdfInPrintJob) return true;
    else return false;  
}
</code></pre>

<p>This method using <code>anonymous class</code> that will create a new instance of <code>FilenameFilter</code> every time invoked and I invoke this method a lot. So I want to make this <code>anonymous class</code> into a <code>singleton</code>. So my initial thought is to create a new <code>singleton</code> class that look like this</p>

<pre><code>public class PdfFileNameFilter implements FilenameFilter{
    private PdfFileNameFilter(){} //non-instantible

    //guarantee to only have one instance at all time
    public static final PdfFileNameFilter INSTANCE = new PdfFileNameFilter();

    public boolean accept(File dir, String name) {
        return (name.toLowerCase().endsWith("".pdf""));
    }
}
</code></pre>

<p>Can I refactor this a bit more. I need to do <code>ZipFileNameFilter</code> as well, and maybe many different file extension filter. Dont want to create a class for each filter. I need to refactor this design a bit more. Maybe <code>interface</code> come into place somewhere here. </p>
","<java><refactoring><singleton>","5","209","2011-06-03 14:21:40"
"6240385","Can I use reflection to get an existing variable by providing its name?","<p>I'm taking over somebody's work and there is a lot of duplicated code. For now, I just want to change the following code: (the code I wanted to change is after this block of code)</p>

<pre><code>        if (Session[""opt3PSRAddHrs4""] != null)
        {
            lblDay4AddHrs.Text = ""Additional Hours: "" + (String)Session[""opt3PSRAddHrs4""];
        }
        else
        {
            lblDay4AddHrs.Visible = false;
        }



        if (Session[""opt3PSRAddHrs5""] != null)
        {
            lblDay5AddHrs.Text = ""Additional Hours: "" + (String)Session[""opt3PSRAddHrs5""];
        }
        else
        {
            lblDay5AddHrs.Visible = false;
        }

        if (Session[""opt3PSRAddHrs6""] != null)
        {
            lblDay6AddHrs.Text = ""Additional Hours: "" + (String)Session[""opt3PSRAddHrs6""];
        }
        else
        {
            lblDay6AddHrs.Visible = false;
        }

        if (Session[""opt3PSRAddHrs7""] != null)
        {
            lblDay7AddHrs.Text = ""Additional Hours: "" + (String)Session[""opt3PSRAddHrs7""];
        }
        else
        {
            lblDay7AddHrs.Visible = false;
        }
</code></pre>

<p>to </p>

<pre><code>for (int i = 0; i &lt; 7; i++) {

   Label label = Reflection.getVariable(type = ""Label"", name = ""lblDay"" + i + ""AddHrs"");
   string sessionData = (string) Session[""opt3PSRAddHrs"" + i];
   if ( sessionData != null) {
      label.Text = ""Additional Hours: "" + sessionData;
   }
   else {
      label.Visible = false;
   }
}
</code></pre>

<p>using reflection. Since the name of those labels follow a pattern, can reflection help?</p>

<p>(BTW, perhaps putting all opt3PSRAddHrs stuff in an array is a good idea, but you know, for now I don't want to change that part of code... Every change will probably leave inconsistency...)</p>
","<c#><asp.net><reflection><refactoring>","1","105","2011-06-05 01:08:05"
"6240520","Can I set up ReSharper to rename unimported classes usages to their full names instead of importing their namespaces?","<p>When I try to use a class whose home namespace is not imported with a using directive, a pop-up appears allowing me to choose the class (by its full name) and adds a using directive to import it.</p>

<p>In a project of mine I make heavy use of same-named classes from different namespaces and would prefer to specify a full name on every use.</p>

<p>Can I set up ReSharper to replace a class ""first name"" with its full name in-place instead of importing its home namespace?</p>
","<c#><.net><namespaces><refactoring><resharper>","3","64","2011-06-05 01:46:53"
"6247938","Replace Unecessary Fully Qualified Types and add usings Across all Classes","<p>I'm trying to get rid of a ton of unecessary fully qualified types and instead throw in a using at the top of these classes.</p>

<p>I am not sure if there is some kind of batch that would go out and do this for me.  Right now I have to use ReSharper and erase the redundant portion of a type and then of course ReSharper asks to throw in the missing using and that's how I am going through each class manually cleaning these up.</p>

<p>There's got to be a more automated way where I can run some process to go through all the project in this solution and do this for me ..just like I'm having to do manually with each line of code with ReSharper?</p>
","<refactoring><resharper>","0","43","2011-06-06 05:02:27"
"6237943","Automate Finding Pertinent Methods in Large Project","<p>I've tried to be disciplined about decomposing into small reusable methods when possible. But the project has grown, my aging memory is fading, and I recently caught myself reimplementing the exact same method! Oh no!</p>

<p>I'd like to know how others deal with this in an automated way; but I'm not looking for an IDE specific solution. Dependency on method names might not be sufficient (although it may be unavoidable not sure?) Unix and scripting would be great. Also, answers like ""take care"" etc. are not what I'm after. Sorry for the long list of requirements and thanks in advanced.</p>
","<refactoring><workflow><code-reuse>","1","30","2011-06-04 16:28:56"
"6259716","Refactoring a Rails view","<p>I'm new to Rails development, so please bear with me. I'm creating a view that has several fields on it that look very similar. It's just begging to be refactored somehow but I haven't been able to figure it out. See code sample below:</p>

<pre><code>&lt;%= form_for(@tapelog) do |f| %&gt;
  &lt;div class=""container""&gt;
    &lt;div class=""field span-16""&gt;
      &lt;div class=""span-8 labelRight""&gt;
        &lt;%= f.label :client %&gt;
      &lt;/div&gt;
      &lt;div class=""span-8 last""&gt;
        &lt;%= f.collection_select :client_id, Client.find(:all), :id, :name,
                                { :prompt =&gt; ""Select a Client..."" },
                                { :class =&gt; ""automatixSelect"" } %&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=""field span-16""&gt;
      &lt;div class=""span-8 labelRight""&gt;
        &lt;%= f.label :employer %&gt;
      &lt;/div&gt;
      &lt;div class=""span-8 last""&gt;
        &lt;%= f.collection_select :employer_id, Employer.find(:all), :id, :name,
                                { :prompt =&gt; ""Select an Employer..."" },
                                { :class  =&gt; ""automatixSelect"" } %&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  ....
&lt;% end %&gt;
</code></pre>

<p>There are about 7 fields like that. I tried to put them all into partials just so I could reduce the clutter on this page but that errors out because 'f' is not defined. Any ideas on how I could reduce some of the clutter here? Any other tips in general on Ruby refactoring would also be welcome.</p>

<p>Thanks,
-- A.</p>
","<ruby-on-rails><refactoring>","0","87","2011-06-07 01:11:32"
"6269103","Refactoring functions to make more generic","<p>I have the following code copy/pasted multiple times. The values that change are the string literals (""TabStates"" changes to ""ContentStates"" etc..) and the value of the dictionary (RadTabSetting -> ContentSetting). </p>

<pre><code>public static SerializableDictionary&lt;string, RadTabSetting&gt; GetTabStates()
{
    SerializableDictionary&lt;string, RadTabSetting&gt; _tabStates = new SerializableDictionary&lt;string, RadTabSetting&gt;();

    if (!object.Equals(DashboardSessionRepository.Instance.GetSession(""TabStates""), null))
    {
        _tabStates = DashboardSessionRepository.Instance.GetSession(""TabStates"") as SerializableDictionary&lt;string, RadTabSetting&gt;;
    }
    else
    {
        XmlSerializer serializer = new XmlSerializer(_tabStates.GetType());

        string data = DashoardDatabaseRepository.Instance.GetWebLayoutData(""TabStates"");

        if ( !string.IsNullOrEmpty(data) )
        {
            byte[] dataAsArray = Convert.FromBase64String(data);
            MemoryStream stream = new MemoryStream(dataAsArray);
            _tabStates = serializer.Deserialize(stream) as SerializableDictionary&lt;string, RadTabSetting&gt;;
            }
            DashboardSessionRepository.Instance.SetSession(""TabStates"", _tabStates);
        }

        return _tabStates;
    }

    public static void SetTabStates(SerializableDictionary&lt;string, RadTabSetting&gt; tabStates)
    {
        DashboardSessionRepository.Instance.SetSession(""TabStates"", tabStates);
        DashboardDatabaseRepository.Instance.SaveToDatabase(""TabStates"", tabStates);
    }
</code></pre>

<p>I'm not looking for an answer, just curious what I should read about to learn how to rewrite this. I'm sure it's simple enough, just not sure what it's called. Is it just function templating?</p>

<pre><code>    public static T GetStates&lt;T&gt;() where T: new()
    {
        T _states = new T();//(T)Activator.CreateInstance(typeof(T));

        string stateName = StateDictionary.GetStateName(typeof(T));

        if (!object.Equals(DashboardSessionRepository.Instance.GetSession(stateName), null))
        {
            _states = (T)DashboardSessionRepository.Instance.GetSession(stateName);

            //Work-Around
            System.IO.MemoryStream memoryStream = new System.IO.MemoryStream();
            System.Xml.Serialization.XmlSerializer xmlSerializer = new System.Xml.Serialization.XmlSerializer(_states.GetType());
            xmlSerializer.Serialize(memoryStream, _states);
            string data = System.Convert.ToBase64String(memoryStream.ToArray());
            string otherData = DashboardDatabaseRepository.Instance.GetWebLayoutData(stateName);

            if (!string.IsNullOrEmpty(data))
            {
                XmlSerializer serializer = new XmlSerializer(_states.GetType());
                byte[] dataAsArray = Convert.FromBase64String(data);
                MemoryStream stream = new MemoryStream(dataAsArray);

                _states = (T)serializer.Deserialize(stream);
            }
            //Work-Around
        }
        else
        {
            XmlSerializer serializer = new XmlSerializer(_states.GetType());

            string data = DashboardDatabaseRepository.Instance.GetWebLayoutData(stateName);

            if (!string.IsNullOrEmpty(data))
            {
                byte[] dataAsArray = Convert.FromBase64String(data);
                MemoryStream stream = new MemoryStream(dataAsArray);
                _states = (T)serializer.Deserialize(stream);
            }
            DashboardSessionRepository.Instance.SetSession(stateName, _states);
        }

        return _states;
    }

    public static void SetStates&lt;T&gt;(T states) where T: new()
    {
        string stateName = StateDictionary.GetStateName(typeof(T));

        DashboardSessionRepository.Instance.SetSession(stateName, states);
        DashboardDatabaseRepository.Instance.SaveToDatabase(stateName);
    }

static class StateDictionary
{   
    //TODO: Might (should?) be able to redo this polymorphically.
    static IDictionary&lt;Type, string&gt; _stateDictionary = new Dictionary&lt;Type, string&gt;
    {
        {typeof(SerializableDictionary&lt;string, RadTabSetting&gt;), ""TabStates""},
        {typeof(SerializableDictionary&lt;string, RadDockContentSetting&gt;), ""ContentStates""},
        {typeof(SerializableDictionary&lt;string, RadPaneSetting&gt;), ""PaneStates""},
        {typeof(SerializableDictionary&lt;string, RadDockSetting&gt;), ""DockStates""},
        {typeof(SerializableDictionary&lt;string, RadDockZoneSetting&gt;), ""DockZoneStates""},
        {typeof(SerializableDictionary&lt;string, RadSplitterSetting&gt;), ""SplitterStates""},
        {typeof(SerializableDictionary&lt;string, RadSplitBarSetting&gt;), ""SplitBarStates""},
        {typeof(KnownGlobalSettings), ""GlobalSettings""},
    };

    public static string GetStateName(Type type)
    {
        string stateName = string.Empty;

        if (_stateDictionary.ContainsKey(type))
        {
            stateName = _stateDictionary[type];
        }

        return stateName;
    }
}
</code></pre>
","<c#><refactoring>","3","123","2011-06-07 17:19:52"
"6269493","Pydev for Eclipse does not change all reference when renaming package","<p>I would expect the pydev package to rename all references in a project when rafactoring a module name. However, this is not the case. Anyone knows how to fix this?</p>
","<python><eclipse><refactoring><pydev>","1","99","2011-06-07 17:49:27"
"6258959","How to refactor a class that contains many listener inner classes?","<p>I am writing an android application that receives location updates and sends requests to a web service. The application has several activities and uses a local Service as a controller. The problem is that this 'controller' service is rapidly turning into a Blob/God anti-pattern. I'm trying to figure out the best way to refractor the code. </p>

<p>Nearly all of the functionality is asynchronous as the http client needs to run in a separate thread. Most of the method calls pass listeners to receive the response from the server. The location updates are also received via a listener. All of these listeners are currently implemented as inner classes in my Local Service.  I now have about 10 inner classes inside my Local Service. I don't see how i can move these listeners into separate classes as they need access to the state stored in the Service. I have tried implementing a singleton/observer hybrid class that handles all the state, receiving updates from each of the listeners then passing it on to any registered observers but this is not a good solution either as it has all the problems associated with global state and it is difficult to follow the flow of the program from one place to another. After re-writing, refactoring and re-writing again i am now totally confused and don't know what to do. Any advice?</p>
","<android><refactoring><patterns>","3","111","2011-06-06 22:59:54"
"6271238","Looping Through Multiple Arrays in Ruby","<p>I have multiple arrays of instances of <code>ActiveRecord</code> subclass <code>Item</code> that I need to loop through an print in accordance to earliest event. In this case, I need to print print out payment and maintenance dates as follows:</p>

<blockquote>
  <p>Item A maintenance required in 5 days<br>
  Item B payment required in 6 days<br>
  Item A payment required in 7 days<br>
  Item B maintenance required in 8 days  </p>
</blockquote>

<p>I currently have two queries for finding <code>maintenance</code> and <code>payment</code> items (non-exclusive query) and something like the following to output them:</p>

<pre><code>&lt;%- item_p = nil -%&gt;
&lt;%- item_m = nil -%&gt;

&lt;%- loop do -%&gt;
  &lt;% item_p ||= @items_p.shift %&gt;
  &lt;% item_m ||= @items_m.shift %&gt;

  &lt;%- if item_p.nil? and item_m.nil? then break -%&gt;
  &lt;%- elsif item_p and (item_m.nil? or item_p.paymt &lt; item_m.maint) then -%&gt;
    &lt;%= item_p.name %&gt; payment required in ...
  &lt;%- elsif item_m and (item_p.nil? or item_m.maint &lt; item_p.paymt) then -%&gt;
    &lt;%= item_m.name %&gt; maintenance required in ...
  &lt;%- end -%&gt;
&lt;%- end -%&gt;
</code></pre>

<p>Any way to cleanup the readability of the above (ugly) code?</p>
","<ruby-on-rails><ruby><refactoring>","5","179","2011-06-07 20:29:42"
"6272290","Reading exactly one row from Linq-to-SQL","<p>I want to refactor some C# modules that read data from SQL Server 2008 via Linq-to-SQL. These stored procedures fetch at most one row, because I am submitting the full PK as parameters. Apparently Linq-to-SQL is not aware that at most one row can be returned. As a result, the following code runs to get one value or throw an exception:</p>

<pre><code>    var results = context.MyProcName(myParameter);
    foreach (var result in results)
    {
        return result.THeColumnINeed;
    }
    throw new Exception(string.Format(""Value not found for parameter {0}"", myParameter));
</code></pre>

<p>This code get the job done, but it kinda looks ugly. How can I do it better?</p>
","<c#><sql-server><linq-to-sql><refactoring>","4","417","2011-06-07 22:21:03"
"6277180","JavaScript revealing module pattern re-factoring advice","<p>I am using the revealing module pattern with JavaScript quite alot to organise my code in my current project but am wondering if i could use it in a better way as i seem to be creating lots of private methods and then calling them in a linear fashion i.e. when one method has performed its operation then call another and then another and so on.</p>

<p>The code works but would like to see if it could work better, more efficiently or with less code to achieve the same result.  </p>

<p>An example module would be below where we need to:</p>

<ol>
<li>Bind a click event to a tab</li>
<li>set some meta data values</li>
<li>Call 3rd party tracking functions</li>
<li><p>Reset the meta data to its original value</p>

<pre><code>icisSite.tabPageView = function($){

    var $tabs = $('.tbc .tbc-tabs &gt; div'),
        pageName = $('meta[name=gwa_pageName]'),
        sec3 = $('meta[name=gwa_siteSection3]'),
        sec4 = $('meta[name=gwa_siteSection4]'),
        pageNameLen = pageName.length,
        sec3Len = sec3.length,
        sec4Len = sec4.length,
        txt,
        pNameContent,
        pNameConstruct,
        section,
        metaContent,
        metaConstruct;

    function init() {   
        bindClickHandlerToTabs();
    };  

    function bindClickHandlerToTabs() {
        if (pageNameLen !== 0 &amp;&amp; (sec3Len !== 0 || sec4Len !== 0)){
            $tabs.bind('click', updateMetaData(){
                txt = $(this).find('span').text(),
                txt = ' | ' + txt;
                updateMetaData();
            }); 
        } else {
            return false;
        }           
    };  

    function updateMetaData(){
        pNameContent = pageName.attr('content'),
        pNameConstruct = pNameContent + txt;
        if (sec3Len !== 0 &amp;&amp; sec4Len !== 0){
            section = 'gwa_siteSection4',
            metaContent = sec4.attr('content'),
            metaConstruct = metaContent + txt;
        } else {
            section = 'gwa_siteSection3'
            metaContent = sec3.attr('content'),
            metaConstruct = metaContent + txt;
        }   
        return callGWATrackingFucntions();  
    };

    function callGWATrackingFucntions() {
        gwa_SetMetaValue(section, metaConstruct); 
        gwa_trackPageView(pNameConstruct);
        return resetMetaData();
    };

    function resetMetaData() { 
        pageName.attr('content', pNameContent);
        $('meta').each(function(index){
            var name = $(this).attr('name');
            if (section === name){
                $(this).attr('content', metaContent);   
            }
        });     
    };

    return {
        init: init  
    };

}(jQuery);

icisSite.tabPageView.init();
</code></pre></li>
</ol>
","<javascript><jquery><design-patterns><refactoring>","2","314","2011-06-08 10:10:07"
"6280239","Understanding the scope of refactoring","<p>I've always thought of code refactoring as only improving implementation details. I want to make sure I have the appropriate understanding of the scope to which refactoring applies (Wikipedia didn't help me much to understand this).</p>

<p>For example, I hear people talking about ""refactoring their designs"", which seems paradox. When you modify the design of something (rename a public method in a class, remove a method, or other similar changes) this (to me) is called ""redesign"", not refactoring.</p>

<p>What is the common accepted scope of refactoring? Is it really possible to refactor designs? Knowing this will really help communication with co-workers when I'm trying to describe work I'm doing as refactoring or not.</p>
","<design><refactoring>","0","58","2011-06-08 14:19:56"
"6281245","What is an elegant way to try catch properties in C#","<p>What's an elegant way to refactor this code?</p>

<p>Say, I have the following object</p>

<pre><code>public class SomeObject
{
    public SomeInnerObject1 Cat { get; set; }
    public SomeInnerObject2 Dog { get; set; }

    public class SomeInnerObject1
    {
        public int Age { get; set; }

        public string AgeAsString
        {
            get
            {
                if(Age &lt; 0 )
                    throw new Exception();

                return Age.ToString();
            }
        }
    }

    public class SomeInnerObject2
    {
        public string BirthDayString { get; set; }
        public DateTime BirthDay { get { return DateTime.Parse(BirthDayString); } }
    }
}
</code></pre>

<p>And say, I have to set a few textboxes's values that I need to set</p>

<pre><code>var obj = new SomeObject
          {
              Cat = new SomeObject.SomeInnerObject1 {Age = -1},
              Dog = null
          };

//These will pass but it looks ugly
try
{
    textbox1.Text = obj.Dog.BirthDay.Month.ToString();
}
catch{ }

try
{
    textbox2.Text = obj.Cat.AgeAsString;
}
catch { }

//These will fail
textbox1.Text = obj.Dog.BirthDay.Month.ToString();
textbox2.Text = obj.Cat.AgeAsString;
</code></pre>

<p>Is there a better way to do this?</p>

<p>Thanks,</p>

<p>Chi</p>
","<c#><refactoring><try-catch>","3","337","2011-06-08 15:22:05"
"6283259","Simple refactoring sql query","<p>I have the table with rows:</p>

<pre><code>ID          CountryCode Status
----------- ----------- -----------
2           PL          1
3           PL          2
4           EN          1
5           EN          1
</code></pre>

<p>and by the query</p>

<pre><code>SELECT *
  FROM [TestTable]
  WHERE Status = 1 AND CountryCode NOT IN (SELECT CountryCode
  FROM [TestTable]
  WHERE Status != 1)
</code></pre>

<p>I get all countrycodes which hasn't status value = 2</p>

<pre><code>ID          CountryCode Status
----------- ----------- -----------
4           EN          1
5           EN          1
</code></pre>

<p>I feel that this query could be more simpler and clearer.</p>

<p>How can I change it?</p>

<p>Best regards</p>

<p><strong>EDIT</strong></p>

<p>PL can't be in result  because has a record with status 2</p>

<p><strong>EDIT</strong></p>

<p>Script to create and fill table:</p>

<pre><code>USE [DatabaseName]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TestTable](
    [ID] [int] IDENTITY(1,1) NOT NULL,
    [CountryCode] [nvarchar](2) NOT NULL,
    [Status] [int] NOT NULL
) ON [PRIMARY]

INSERT INTO dbo.TestTable
          ( CountryCode, Status )
  VALUES  ( 'PL', -- CountryCode - nvarchar(2)
            1  -- Status - int
            )

INSERT INTO dbo.TestTable
          ( CountryCode, Status )
  VALUES  ( 'PL', -- CountryCode - nvarchar(2)
            2  -- Status - int
            )

INSERT INTO dbo.TestTable
          ( CountryCode, Status )
  VALUES  ( 'EN', -- CountryCode - nvarchar(2)
            1  -- Status - int
            )
INSERT INTO dbo.TestTable
          ( CountryCode, Status )
  VALUES  ( 'EN', -- CountryCode - nvarchar(2)
            1  -- Status - int
            )
</code></pre>
","<sql><sql-server-2005><refactoring>","3","104","2011-06-08 18:10:25"
"6293271","How would I refactor a Rail's ApplicationController with Constants set to ActiveRecord results?","<p>I'm working on a Rails 2.1 project that has an ApplicationController similar to the following:</p>

<pre><code>class ApplicationController &lt; ActionController:Base
  THIS_SITE = Site.find_by_url('www.example.net')
  ADMIN_ROLES = StaffRole.find(:all, :conditions =&gt; [""site_id = ? AND name IN (?)"", ApplicationController::THIS_SITE.id, 'Administrator'])
end
</code></pre>

<p>I was unable to run tests, because in my test environment I would get an error saying THIS_SITE is nil when trying to define ADMIN_ROLES.  I fixed the issue by doing the following:</p>

<pre><code>class ApplicationController &lt; ActionController:Base
  def self.this_site
    @@this_site ||= Site.find_by_url('www.example.net')
  end
  def self.admin_roles
    @admin_roles ||= StaffRole.find(:all, :conditions =&gt; [""site_id = ? AND name IN (?)"", ApplicationController::this_site.id, 'Administrator'])
end
</code></pre>

<p><code>ApplicationController::THIS_SITE</code> and <code>ApplicationController::ADMIN_ROLES</code> are used throughout the application in views, controllers, and models.  I feel that this is all wrong and dirty. Am I wrong thinking that this is wrong/dirty? If not, how can this be refactored?</p>

<p>Thank you.</p>
","<ruby-on-rails><refactoring><constants>","0","68","2011-06-09 13:09:12"
"6296839","How to calculate changes of nullable numbers with Linq","<p>I need to calculate changes off of time series of nullable numbers. The following code gets the job done:</p>

<pre><code>public static double?[] GetChanges(double?[] x)
{
    if(x.Length == 1)
        throw new Exception(""Time Series Too Short"");
    var ret = new double?[x.Length - 1];
    for (int i = 1; i &lt; x.Length; i++)
    {
        ret[i-1] = (x[i - 1].HasValue &amp;&amp; x[i].HasValue) ? x[i] - x[i - 1] : null;
    }
    return ret;
}
</code></pre>

<p>Is there a better way to accomplish that with Linq?
The library is using .Net 3.5.
Right now I cannot use Zip, because that comes with .Net 4.</p>

<p>Edit: following the advice by mquander and Eric Lippert, I have come up with the following code which runs on 3.5:</p>

<pre><code>public class Tuple&lt;T&gt;
{
    public Tuple(T first)
    {
        First = first;
    }

    public T First { get; set; }
}

public class Tuple&lt;T, T2&gt; : Tuple&lt;T&gt;
{
    public Tuple(T first, T2 second)
        : base(first)
    {
        Second = second;
    }

    public T2 Second { get; set; }

    public static Tuple&lt;T1, T2&gt; New&lt;T1, T2&gt;(T1 t1, T2 t2)
    {
        return new Tuple&lt;T1, T2&gt;(t1, t2);
    }
}

public static class EnumerableExtensions
{
    public static IEnumerable&lt;Tuple&lt;T, T&gt;&gt; Pairs&lt;T&gt;(this IEnumerable&lt;T&gt; seq)
    {
        using (var enumerator = seq.GetEnumerator())
        {
            enumerator.MoveNext();
            var prior = enumerator.Current;

            while (enumerator.MoveNext())
            {
                yield return Tuple&lt;T, T&gt;.New(prior, enumerator.Current);
                prior = enumerator.Current;
            }
        }
    }
}
</code></pre>

<p>I am using this code as follows:</p>

<pre><code>    public static IEnumerable&lt;double?&gt; GetChanges2(double?[] x)
    {
        if (x.Length == 1)
            throw new Exception(""Time Series Too Short"");
        return x.Pairs().Select(p =&gt; p.Second - p.First);
    }
</code></pre>

<p>Any suggestions on further improvement are welcome. 
I will be back when I have VS2010 and .Net 4, so that I can try out the approaches suggested in both answers.</p>

<p>Thanks!</p>
","<c#><linq><refactoring>","4","119","2011-06-09 17:26:21"
"6310106","Implementing a templated interface","<p>I'm trying to write this more generically:</p>

<pre><code>public static CormantRadDock RecreateDock(RadDockSetting settings)
{
    CormantRadDock dock = new CormantRadDock();
    settings.SetSettings(dock);
    Logger.DebugFormat(""Recreated dock {0}"", dock.ID);
    return dock;
}
</code></pre>

<p>I have this:</p>

<pre><code>public static T Recreate&lt;T&gt;() where T : new()
{
    T _control = new T();
    //settings.SetSettings(dock);
    Logger.DebugFormat(""Recreated control {0}"", (_control as Control).ID);
    return _control;
}
</code></pre>

<p>Generic Solution:</p>

<pre><code>public interface ISetting&lt;T&gt;
{
    void SetSettings(T obj);
}

public void SetSettings(CormantRadDock dock)
{
    // do stuff with dock
}
</code></pre>

<p>Thanks!</p>
","<c#><interface><refactoring>","0","70","2011-06-10 17:40:29"
"6298936","How can I improve the readability of these linq statements?","<p>I have a hierarchical data tree containing objects of a class called <code>DataNode</code>.  </p>

<p>Each <code>DataNode</code> contains a collection of <code>Attribute</code> objects.  Each <code>Attribute</code> is essentially a key/value pair, with some helper methods attached.  For example, there is a helper method called <code>EqualsCodeIndex(x)</code> that matches a small collection <code>x</code> of <code>int</code> values to <code>this</code> <code>attribute</code> and returns <code>true</code> or <code>false</code>.  All keys and values are strings, because the whole thing is based on a key/value store contained in a text file.</p>

<p>To simplify access to a particular <code>DataNode</code>, there is a dictionary in the <code>DataTree</code> class that maps all of the nodes in the tree to a unique code:</p>

<pre><code>Dictionary&lt;string, DataNode&gt; Codes;
</code></pre>

<p>The resulting Linq statement to get to a specific <code>Attribute</code> value looks like this:</p>

<pre><code>string AttributeValue = dataTree
    .Codes[@""R-1\CHE""]
    .Attributes
    .Single(x =&gt; x.EqualsCodeIndex(parentAttribute.CodeIndex))
    .Value.Trim();
</code></pre>

<p>This is not too bad if I only have to retrieve one or two attributes by code and code index, but it's <em>not so good if I have to retrieve ten or more.</em></p>

<p>To attempt to simplify the statement, and allow for the possibility of <code>EqualsCodeIndex</code> returning <code>false</code> for all attributes in the collection, I added an extension method:</p>

<pre><code>public static string AttributeValueMatching
    (this KeyValuePair&lt;string, DataNode&gt; pair, List&lt;int&gt; codeIndex)
{
    var attribute = pair.Value.Attributes
        .Single(x =&gt; x.EqualsCodeIndex(codeIndex))

    return attribute == null ? string.Empty : value;
}
</code></pre>

<p>This simplifies the original linq statement down to:</p>

<pre><code>string attributeValue
    = dataTree.Codes[@""R-1\CHE""].AttributeValueMatching(codeIndex);
</code></pre>

<p>...which is better, but I have a feeling I'm missing something.</p>

<hr>

<p>Are there problems with this approach?  Is there a better, cleaner approach I haven't thought of, maybe making better use of indexers, or perhaps a fluent interface?</p>
","<c#><linq><design><refactoring>","2","129","2011-06-09 20:37:48"
"6300124","And the refactor begot a library. Retest?","<p>I understand this is a subjective question and, as such, may be closed but I think it is worth asking.</p>

<p>Let's say, when building an application using TDD and going through a refactor, a library appears.  If you yank the code out of your main application and place it into an separate assembly, do you take the time to write tests that cover the code, even though your main application is already testing it? (It's just a refactor.)</p>

<p>For example, in the <a href=""http://nerddinner.codeplex.com/"" rel=""nofollow"">NerdDinner</a> application, we see wrappers for FormsAuthentication and MembershipProvider.  These objects would be very handy across multiple applications and so they could be extracted out of the NerdDinner application and placed into their own assembly and reused.</p>

<p>If you were writing NerdDinner today, from scratch, and you noticed that you had a grab-bag of really useful wrappers and services and you bring them into a new assembly, do you create new tests that fully cover your new assembly--possibly having repeat tests?  Is it enough to say that, if your main application runs green on all its tests, your new assembly is effectively covered?</p>

<p>While my example with NerdDinner may be too simplistic to really worry about, I am more thinking about larger APIs or libraries.  So, do you write tests to re-cover what you tested before (may be a problem because you will probably start with all your tests passing) or do you just write tests as the new assembly evolves?</p>
","<refactoring><tdd><assemblies>","2","49","2011-06-09 22:37:21"
"6310866","Removing an item from a generic Dictionary?","<p>I have this:</p>

<pre><code>public static void Remove&lt;T&gt;(string controlID) where T: new()
{
    Logger.InfoFormat(""Removing control {0}"", controlID);
    T states = RadControlStates.GetStates&lt;T&gt;();

    //Not correct.
    (states as SerializableDictionary&lt;string, object&gt;).Remove(controlID);
    RadControlStates.SetStates&lt;T&gt;(states);
}
</code></pre>

<p>states will always be a SerializableDictionary with string keys. The values' type vary. Is there a way to express this? Casting to <code>SerializableDictioanry&lt;string, object&gt;</code> always yields null. </p>
","<c#><refactoring><templating>","1","105","2011-06-10 18:56:58"
"6311985","Extension Methods and generics - How should I be doing this?","<p>I'm in the middle of overhauling some code and I hit a bit of a snag.</p>

<p>This is the method which I currently have, it needs reworking to support some structure changes: </p>

<pre><code>/// &lt;summary&gt;
/// Recreates a dashboard control based off of its settings.
/// &lt;/summary&gt;
/// &lt;typeparam name=""T""&gt; The type of control to be recreated. &lt;/typeparam&gt;
/// &lt;param name=""settings""&gt; The known settings needed to recreate the control.&lt;/param&gt;
/// &lt;returns&gt; The recreated control. &lt;/returns&gt;
public static T Recreate&lt;T&gt;(ISetting&lt;T&gt; settings) where T : new()
{
    T _control = new T();
    settings.SetSettings(_control);
    Logger.DebugFormat(""Recreated control {0}"", (_control as Control).ID);
    return _control;
}
</code></pre>

<p>ISetting is being removed completely in favor of an extension method known to _control.</p>

<p>So, I have now:</p>

<pre><code>public static class RadControlExtensions
{
    public static RadDockZoneSetting GetSettings(this RadDockZone dockZone)
    {
        RadDockZoneSetting radDockZoneSetting = new RadDockZoneSetting(dockZone.UniqueName, dockZone.ID, dockZone.Skin, dockZone.MinHeight, 
            dockZone.HighlightedCssClass, dockZone.BorderWidth, dockZone.Parent.ID);

        return radDockZoneSetting;
    }

    public static RadTabSetting GetSettings(this RadTab tab, int index)
    {
        RadTabSetting radTabSetting = new RadTabSetting(tab.Text, tab.Value, index);
        return radTabSetting;
    }

    //Continued
}
</code></pre>

<p>The control that is being recreated is guaranteed to have this extension method (would be nice to enforce this, though.)</p>

<p>I'm now at:</p>

<pre><code>public static T Recreate&lt;T&gt;() where T : new()
{
    T _control = new T();
    //Not right -- you can't cast a control to an extension method, obviously, but
    //this captures the essence of what I would like to accomplish.
    (_control as RadControlExtension).SetSettings();
    Logger.DebugFormat(""Recreated control {0}"", (_control as Control).ID);
    return _control;
}
</code></pre>

<p>What should I be looking into to support this, if possible?</p>
","<c#><generics><refactoring>","1","97","2011-06-10 20:54:56"
"6329599","Is there any way to simplify nested, namespaced resources?","<p>Is there any less redundant way to do this?</p>

<pre><code>resources :tournaments do
    resources :commitments,     controller: ""tournaments/commitments""
    resources :constraints,     controller: ""tournaments/constraints""
    resources :entries,         controller: ""tournaments/entries""
    resources :buildings,       controller: ""tournaments/buildings"" do
        resources :rooms,       controller: ""tournaments/buildings/rooms""
    end
end
</code></pre>
","<ruby-on-rails><namespaces><refactoring><routes>","0","38","2011-06-13 11:08:16"
"6334809","Refactoring code with extensions to generic method","<p>I am trying attempting to refactor the following code:</p>

<pre><code>public static void SaveSplitbar(RadSplitBar splitBar)
{
    Logger.InfoFormat(""Saving splitBar {0}"", splitBar.ID);
    RadSplitBarSetting splitbarSettings = splitBar.GetSettings();
    SerializableDictionary&lt;string, RadSplitBarSetting&gt; splitBarStates = GetStates&lt;SerializableDictionary&lt;string, RadSplitBarSetting&gt;&gt;();

    bool splitbarIsKnown = splitBarStates.ContainsKey(splitbarSettings.ID);

    if (splitbarIsKnown)
    {
        Logger.Debug(""SplitBar is known. Overwriting data."");
        splitBarStates[splitbarSettings.ID] = splitbarSettings;
    }
    else
    {
        Logger.Debug(""SplitBar is unknown. Saving data."");
        splitBarStates.Add(splitbarSettings.ID, splitbarSettings);
    }

    RadControlManager.SetStates&lt;SerializableDictionary&lt;string, RadSplitBarSetting&gt;&gt;(splitBarStates);
}
</code></pre>

<p>The logic of the code is reused in saving various other objects. I am trying to make this code more generic so that I will be able to have one Save() method rather than SaveX(), SaveY(), and SaveZ() all performing the same work on different objects.</p>

<p>I have a bit of a snag, however. While all of the objects being passed into Save have the ""GetSettings()"" method, many of them have this method defined in an extension method:</p>

<pre><code>//RadControlExtensions.cs Extension Methods
public static RadSplitBarSetting GetSettings(this RadSplitBar splitbar)
{
    RadSplitBarSetting radSplitbarSetting = new RadSplitBarSetting(splitbar.ID, splitbar.Parent.ID, splitbar.CollapseMode, splitbar.AdjacentPanesNames);
    return radSplitbarSetting;
}
</code></pre>

<p>As such, when I tried to refactor SaveSplitbar, I realize that I would have to be switching on the type of my parameter. When I started going down this route I thought, ""Well, this is stupid, if I have to determine the type of the object I should just write Save multiple times as extension methods for each object.""</p>

<p>While this is an ""OK"" solution, I am unhappy with it. The logic behind saving each type of control is identical and I would prefer not having copy/pasted logic in my extension class.</p>

<p>My next thought was, ""Well, if any parameter passed into Save is guaranteed to have a GetSettings method -- maybe there is a way to have an IRadControlExtensions interface which exposes this method. I was unable to determine any such way as each GetSettings method has a different signature - does not seem possible to announce it just once in the interface.</p>

<p>So that's where I am at. How should I be approaching this problem?</p>

<p>EDIT: Another Save method</p>

<pre><code>public static void SavePane(CormantRadPane pane)
{
    Logger.InfoFormat(""Saving pane {0}"", pane.ID);
    RadPaneSetting paneSettings = pane.GetSettings();
    SerializableDictionary&lt;string, RadPaneSetting&gt; paneStates = GetStates&lt;SerializableDictionary&lt;string, RadPaneSetting&gt;&gt;();

    bool paneIsKnown = paneStates.ContainsKey(paneSettings.ID);

    if (paneIsKnown)
    {
        Logger.Debug(""Pane is known. Overwriting data."");
        paneStates[paneSettings.ID] = paneSettings;
    }
    else
    {
        Logger.Debug(""Pane is unknown. Saving data."");
        paneStates.Add(paneSettings.ID, paneSettings);
    }

    RadControlManager.SetStates&lt;SerializableDictionary&lt;string, RadPaneSetting&gt;&gt;(paneStates);
}
</code></pre>

<p>EDIT2: Perhaps a better question is, ""When is it time to stop extending a class and time to start creating a new class which inherits from the class currently being extended?""</p>
","<c#><generics><methods><refactoring><extension>","0","121","2011-06-13 18:50:25"
"6352394","other than combining the new_title statements,how do i refactor this code using Python3? please help:(","<pre><code>small_words = ('into', 'the', 'a', 'of', 'at', 'in', 'for', 'on')
def book_title(title):
    """""" Takes a string and returns a title-case string.
    All words EXCEPT for small words are made title case
    unless the string starts with a preposition, in which
    case the word is correctly capitalized.

    &gt;&gt;&gt; book_title('DIVE Into python')
    'Dive into Python'

    &gt;&gt;&gt; book_title('the great gatsby')
    'The Great Gatsby'

    &gt;&gt;&gt; book_title('the WORKS OF AleXANDer dumas')
    'The Works of Alexander Dumas'
    """"""
    lst_of_words = title.lower().split()
    num_of_words = len(lst_of_words)
    if num_of_words &lt; 1:
        return ''
    new_title = lst_of_words.pop(0)
    new_title = new_title[0].upper() + new_title[1:]
    tpl_of_words = tuple(lst_of_words)
    for word in tpl_of_words:
        prep_word = False
        for prep in small_words:
            if prep == word:
                new_title = new_title + ' ' + word
                new_title = new_title + word
                prep_word = True
                break
        if prep_word == True:
            continue
        new_title = new_title + ' '+ word[0].upper()+ word[1:]
        new_title = new_title + word[0].upper()
        new_title = new_title + word[1:]
    return new_title

def _test():
    import doctest, refactory
    return doctest.testmod(refactory)

if __name__ == ""__main__"":
    _test()
</code></pre>
","<python><refactoring>","0","41","2011-06-15 02:32:00"
"6352935","Accessing variables outside PHP foreach loop","<p>In some code I'm working on I have noticed that several variables are being accessed from outside of <code>foreach</code> loops.</p>

<p>This is seen in codeigniter view files of this particular app.</p>

<p>For example, a view file:</p>

<pre><code>&lt;?php
foreach ($items as $row):
endforeach;

// HTML / PHP code...

 &lt;td&gt;
     &lt;?php echo form_checkbox('option_1','1', FALSE); ?&gt;
     &lt;?php echo form_hidden('weight_unit', $row-&gt;weight_unit); ?&gt;
 &lt;/td&gt;
// etc...
</code></pre>

<p>This works (ie, no errors) but I wonder if this would be considered a bad practice and if so, why? (scope, etc)</p>

<p>Does anyone have an opinion on this and should variables only be called inside their corresponding loops?</p>

<p>Another issue I've noticed is if a variable is required in several parts of a view file: should I refactor to have multiple loops or should there be a single <code>foreach / endforeach</code> and the begin / end of the file.</p>

<p>Any suggestions are much appreciated. Thanks.</p>
","<php><refactoring><foreach>","3","330","2011-06-15 04:15:57"
"6362995","C++ Refactoring - Move method to implementation file","<p>I have lots of header files with long method implementation inside.</p>

<p>Is there An automatic way of doing that?</p>

<p>One-by-one can take a lot of time...</p>

<p>Thanks.</p>
","<c++><refactoring><automated-refactoring>","4","278","2011-06-15 19:13:53"
"6365250","Writing a service just for the purpose of refactoring out persistence logic?","<p>I have a piece of business logic, that I feel should belong in a domain class. But the logic should end with persisting to the database, and this should obviously not be part of the domain class. So what does this mean;  Will such situation enforce me to put the logic in a Service? Or at least a service referencing the logic methods of the domain class, and then persisting to database.. (?) </p>

<p>Say for example I want to post a transaction into a securities account. Much verification logic is internal to the account fields only, and such it seems this logic should be inside the domain class. But I then need an AccountTransactionService which simply calls this logic of the domain class, receives a true/false, on whether transaction was performed, and then saves the object if changed. It seems it will be many Service classes which only does this type of ""forwarding"" of methods, and then saving based on the result. But maybe this a very typical nature of services? </p>

<p>Just looking for some advice, as I'm not used to writing service classes, which this well reflects. What other purpose should I consider for the Service class, except just to refactor out the dependency on persistence logic from the domain class? </p>

<p><em>Btw, I'm just writing applications for my personal use. So I don't really have to respect all guidelines just for the sake of it.</em></p>
","<c#><.net><refactoring>","1","57","2011-06-15 22:36:03"
"6361047","Is this the right way to refactor? Anything better I can do?","<p>I've made an <code>Impressions</code> model, which keeps track of how many ""views"" a certain photo or event has. It tracks this by remote_url, remote_ip and user_agent. It works the way I want it.</p>

<p>Photos controller:</p>

<pre><code>def show

  @photo.impressions.create(:request_url =&gt; request.url, :controller_name =&gt; controller_name, :action_name =&gt; action_name,
                            :ip_address =&gt; request.remote_ip, :user_agent =&gt; request.user_agent)
....
</code></pre>

<p>And my Events controller:</p>

<pre><code>def show

  @event.impressions.create(:request_url =&gt; request.url, :controller_name =&gt; controller_name, :action_name =&gt; action_name,
                            :ip_address =&gt; request.remote_ip, :user_agent =&gt; request.user_agent)
....
</code></pre>

<p>However, I am thinking of refactoring this (to make the code cleaner). Perhaps creating a method in the <code>Photo</code> and <code>Event</code> models called <code>add_impression</code>. Which does exactly the same thing as above, but encapsulates the functionality of how impressions are created. It would look something like: </p>

<p>Photos controller:</p>

<pre><code>def show

  @photo.add_impression(request.url, controller_name, action_name, request.remote_ip, request.user_agent)
....
</code></pre>

<p>And my Events controller:</p>

<pre><code>def show

  @event.add_impression(request.url, controller_name, action_name, request.remote_ip, request.user_agent)
....
</code></pre>

<p>With this approach, I would end up with an add_impression method in the <code>Photo</code> and <code>Event</code> model. Not exactly DRY (Don't Repeat Yourself). I'm considering creating an <code>Impression</code> module to tackle this.</p>

<p>Is this the right approach? Or is there something else that I should be doing?</p>

<p><strong>PS</strong> Am not very well tuned with modules yet. So if anyone would like to leave a code snippet or links to articles worth reading. Please do so.</p>
","<ruby-on-rails-3><refactoring><refactor-my-code>","1","43","2011-06-15 16:28:53"
"6376209","Cleanest way to write 2-boolean conditional (4 branches)","<p>I've got this code. <code>true_var</code> and <code>other_true_var</code> are <code>boolean</code> values. The four conditional branches are distinct.</p>

<pre><code>if true_var &amp;&amp; other_true_var:
    # do something 0
else if true_var &amp;&amp; not other_true_var:
    # do something 1
else if not true_var &amp;&amp; other_true_var:
    # do something else
else:
    # both are false, do a crazy thing
</code></pre>

<p>Is there an ""accepted"" way to write this? I could pull all the conditionals into methods which return a boolean, but that seems over the top.</p>
","<design><refactoring>","3","48","2011-06-16 17:40:50"
"6384673","Substitute Enum switch with design pattern (IOC)","<p>I've got an event handler which receives an eventargs object inside which is an enumerated value that further refines the information inside. It looks something like</p>

<pre><code>public enum StatusCallbackType { Status1, Status2, Status3, Status4 }

public class StatusEventArgs
{
  public StatusCallbackType Type {get;set;}
  public StatusData Data {get; set;}
}
</code></pre>

<p>Statusdata is a base abstract class that changes depending on the given CalllbackType.</p>

<p>Now the code that handles the event looks similar to</p>

<pre><code>switch e.Type
{
  case Status1:
    DoAction1(e.Data as Opt1Data);
    break;
  case Status2:
    DoAction1(e.Data as Opt2Data);
    break;
  case Status3:
    DoAction1(e.Data as Opt3Data);
    break;
}
</code></pre>

<p>The problem is if we change the StatusNotifications or want to change the way they're handled we have to adjust the switch which could get really big, and I was thinking about using something that allowed me to <strong>inject a handler</strong> for any given status.</p>

<p>On the other hand I don't really need it right now. The switch solutions works, but it's starting to get big so I'm fighting between my feeling that it is not maintanble and YAGNI.</p>

<p>Is there any pattern that allows to convert that kind of switches to and IOC pattern? Do you think I should actually bother refactoring that switch?</p>
","<c#><design-patterns><refactoring><switch><yagni>","1","338","2011-06-17 10:51:43"
"6398161","Converting an Utility application (2 view controllers) to a Tab bar Application","<p>As the title suggests, I have built an utility based app.<br>
The app consists (at the moment) of 2 view controllers + a model class hierarchy.<br>
The thing is , as I'd like to add some features to the app , I would like to convert it to a TabBar based application. </p>

<p>As a first step , I would like the first view to be the first view of the tab bar , and the flipSideView to be one of the other tab bar items.  </p>

<p>Is there any ""standard procedure"" / ""grocery list""  for such tasks ?<br>
I'm sure some of you have encountered the same problem , and would love some advice on ""slicing up"" the app , and ""wiring it up"" after creating a new nib file for the main window (is that the first step ? )</p>

<p>Thanks in advance.  </p>
","<iphone><ios><xcode><refactoring><uitabbarcontroller>","0","316","2011-06-18 18:50:43"
"6408432","Need help on refactoring a deeply nested code","<pre><code>#include &lt;iostream&gt;
using namespace std;

int main()
{
    int range = 20;
    int totalCombinations = 0;

    for(int i=1; i&lt;=range-2; i++)
    {
        if(range&gt;i)
        {
            for(int j=1; j&lt;=range-1; j++)
                if(j&gt;i)
                {
                    for(int k=1; k&lt;=range-1; k++)
                        if(k&gt;j)
                        {
                            for(int l=1; l&lt;=range-1; l++)
                                if(l&gt;k)
                                {
                                    for(int m=1; m&lt;=range-1; m++)
                                        if(m&gt;l)
                                        {
                                            for(int f=1; f&lt;=range; f++)
                                                if(f&gt;m)
                                                {
                                                    cout &lt;&lt; "" "" &lt;&lt;i&lt;&lt; "" "" &lt;&lt;j&lt;&lt; "" "" &lt;&lt;k&lt;&lt; "" "" &lt;&lt;l&lt;&lt; "" "" &lt;&lt;m&lt;&lt; "" "" &lt;&lt;f;
                                                    cin.get(); //pause
                                                    totalCombinations++;
                                                }
                                        }
                                }
                        }
                }
        }
    }
    cout &lt;&lt; ""TotalCombinations:"" &lt;&lt; totalCombinations;
}
</code></pre>
","<c++><refactoring>","4","168","2011-06-20 08:13:11"
"6409818","Refactoring code out of the view","<p>I have the following view code which displays events, along with headers informing the user if the following events occured today, yesterday, or in the past week.</p>

<p>It all works fine, but I would prefer to refactor it out of the view, I can't put it in a helper because it needs to maintain the variables state between loop iterations. Any idea how to tidy this up? thanks</p>

<pre><code>&lt;% displayed_week_already = false %&gt;
&lt;% displayed_yesterday_already = false %&gt;
&lt;% displayed_today_already = false %&gt;

&lt;% @events.each do |event| %&gt;

  &lt;%= event.title &amp;&gt;

  &lt;% if (Time.now - 1.week) &gt; event.created_at &amp;&amp; !displayed_week_already %&gt;
    &lt;% displayed_week_already = true %&gt;
    Events in past week
  &lt;% elsif (Time.now - 1.day) &gt; event.created_at &amp;&amp; (Time.now - 2.day) &lt; event.created_at &amp;&amp; !displayed_yesterday_already %&gt;
    &lt;% displayed_yesterday_already = true %&gt;
    Events yesterday
  &lt;% elsif (Time.now - 1.day) &lt; event.created_at &amp;&amp; !displayed_today_already %&gt;
    &lt;% displayed_today_already = true %&gt;
    Events in past day
  &lt;% end %&gt;

&lt;% end %&gt;
</code></pre>

<hr>

<p>Expected output would be:</p>

<p><strong>Events in past day</strong><br />
John created a new artice<br />
Dan commented on article 1<br />
Sue deleted article 2<br /></p>

<p><strong>Events yesterday</strong><br />
Sue created a new article<br /></p>

<p><strong>Events in past week</strong><br />
Carol was promoted<br />
Dan cerated a new article<br /></p>
","<ruby-on-rails><view><refactoring><helpers>","0","75","2011-06-20 10:26:34"
"6416712","How to rename widget ID's in Eclipse?","<p>I am working on an app built upon an example from a tutorial. Now the different widget IDs no longer reflect their purpose so I would like to rename them. However, this seems quite a task as the IDs are used in multiple files.</p>

<p>Is it possible somehow to rename the IDs so the changes are migrated into the other files in the project? That is pretty much similar to refactor source code names, but for widget IDs.</p>
","<android><refactoring><rename>","1","127","2011-06-20 19:57:32"
"6427619","What is respective branch? (suggested by ReSharper)","<p>I am using ReSharper to refactor my code, and one of the suggestions of ReSharper is to use a respective branch instead a if statement that is always true.</p>

<p>If I have </p>

<pre><code>if (myVar != null){
   //code
}
</code></pre>

<p>And I apply the respective branch the code is like the following</p>

<pre><code>{
   //code
}
</code></pre>

<p>Is this a short cut of an if statement?
What is this used for? 
What is the difference between the cutely brackets and nothing?</p>

<p>Thanks in advance.</p>
","<refactoring><resharper>","1","170","2011-06-21 15:11:41"
"6433654","How to reformat naming styles with ReSharper?","<p>I have several pages of code that need to have naming styles reinforced, e.g. use <code>fooBar</code> instead of <code>FooBar</code> for local variables. I don't want to correct it one by one for an obvious reason.</p>

<p>I tried to fiddle with the code cleanup profiles accessiable via <code>ReSharper &gt; Tools &gt; Cleanup Code &gt; Edit Profiles</code>. I am not able to find a way to correct all naming style in one hit, or even with a keyboard shortcut. Could seasonsed ReSharper users advise how I can tackle this problem?</p>
","<visual-studio><refactoring><resharper>","2","237","2011-06-22 00:42:19"
"6436753","Is there a way to refactor this javascript/jquery?","<pre><code>switch (options.effect) {

case 'h-blinds-fadein':
    $('.child').each(function(i) {
        $(this).stop().css({
            opacity: 0
        }).delay(100 * i).animate({
            'opacity': 1
        }, {
            duration: options.speed,
            complete: (i !== r * c - 1) ||
            function() {
                $(this).parent().replaceWith(prev);
                options.cp.bind('click', {
                    effect: options.effect
                }, options.ch);
            }
        });
    });

    break;

case 'h-blinds-fadein-reverse':
    $('.child').each(function(i) {
        $(this).stop().css({
            opacity: 0
        }).delay(100 * (r * c - i)).animate({
            'opacity': 1
        }, {
            duration: options.speed,
            complete: (i !== 0) ||
            function() {
                $(this).parent().replaceWith(prev);
                options.cp.bind('click', {
                    effect: options.effect
                }, options.ch);
            }
        });
    });

    break;

    ....more cases
}
</code></pre>

<p>I have alot of similiar other cases. One way i could think of is to write functions ? i'm not sure i'm still fairly new to the language</p>

<p>im sorry, i is the index of the each() function which is the size of $('.child'), and r and c are just the 'rows' and 'columns' of the grid which contains '.child'.
r and c can be any number, e.g. r=5 c=5</p>
","<javascript><jquery><refactoring><case><switch>","0","133","2011-06-22 08:05:00"
"6440913","how can I remove generic type from class using refactoring","<p>I have this class:  </p>

<pre><code>public class TimeIntCo&lt;T&gt; extends TimeValueCo&lt;Integer&gt;
{

}
</code></pre>

<p>I decided that the T type is not needed anymore, and it is not used in the class (I know it is always Integer).<br>
However, I have a lot of references for the class that looks like <code>TimeIntCo&lt;Integer&gt;</code>.<br>
Is there a way using Eclipse refactoring to remove the <code>T</code> type without causing any error in references?<br>
I mean to do it in one step and not find&amp;replace.</p>

<p><strong>EDIT:</strong> to be more clear - if I just remove <code>T</code> from class I have about 10,000 errors, I don't want to do it manually, and I prefer not to use find&amp;replace because I consider refactor safer.</p>
","<java><eclipse><refactoring>","4","176","2011-06-22 13:46:30"
"6462516","Generating a LINQ expression in a factory for an NHibernate QueryOver Where clause","<p>I have a data source that supports querying based on several identifiers.  These identifiers are abstracted by an IIdentifier class that wraps the type and value for the query.  In my NHibernate DAO, I have the following method. </p>

<pre><code>public IEnumerable&lt;ICustomerProfileAttribute&gt; GetCustomerProfileAttributes(
    IIdentifier&lt;CustomerIdentifierTypeEnum&gt; identifier, IEnumerable&lt;string&gt; attributeNames)
{
    IList&lt;ICustomerProfileAttribute&gt; customerProfileAttributes = new List&lt;ICustomerProfileAttribute&gt;();

    ICustomerProfile customerProfileAlias = null;
    ICustomerProfileAttribute customerProfileAttributeAlias = null;
    IEntityTypeAttribute entityTypeAttribute = null;
    IAttribute attributeAlias = null;

    Expression&lt;Func&lt;bool&gt;&gt; findCustomerProfileQuery;
    // I would like to replace the switch with something like this:
    // = FindCustomerProfileExpressionFactory.Get(customerProfileAlias, identifier); 

    switch (identifier.IdentifierType)
    {
        case CustomerIdentifierTypeEnum.CustomerNumber:
            findCustomerProfileQuery = () =&gt; customerProfileAlias.CustomerNumber == identifier.Value.ToString();
            break;
        case CustomerIdentifierTypeEnum.WebAccount:
            findCustomerProfileQuery = () =&gt; customerProfileAlias.WebAccountId == (long)identifier.Value;
            break;
        case CustomerIdentifierTypeEnum.WebLogin:
            findCustomerProfileQuery = () =&gt; customerProfileAlias.LoginEmailAddress == identifier.Value.ToString();
            break;
        default:
            throw new NotImplementedException(String.Format(""lookup of customer profiles using {0} is not supported"", identifier.IdentifierType));
    }

    return Session.QueryOver(() =&gt; customerProfileAttributeAlias)
        .JoinAlias(() =&gt; customerProfileAttributeAlias.CustomerProfile, () =&gt; customerProfileAlias,
                    JoinType.LeftOuterJoin)
        .Where(findCustomerProfileQuery)
        .JoinAlias(() =&gt; customerProfileAttributeAlias.EntityTypeAttribute, () =&gt; entityTypeAttribute,
                    JoinType.LeftOuterJoin)
        .JoinAlias(() =&gt; entityTypeAttribute.Attribute, () =&gt; attributeAlias, JoinType.LeftOuterJoin)
        .Where(Restrictions.On(() =&gt; attributeAlias.Name).IsIn(attributeNames.ToArray()))
        .List&lt;ICustomerProfileAttribute&gt;();
}
</code></pre>

<p>I would like to extract the switch statement into a factory class, as it would be useful in several other parts of my application.  I tried the following: </p>

<pre><code>class FindCustomerProfileExpressionFactory
    {
        static public Expression&lt;Func&lt;bool&gt;&gt; Get(ICustomerProfile profile, IIdentifier&lt;CustomerIdentifierTypeEnum&gt; identifier)
        {
            switch (identifier.IdentifierType)
            {
                case CustomerIdentifierTypeEnum.CustomerNumber:
                    return () =&gt; customerProfileAlias.CustomerNumber == identifier.Value.ToString(); 
             ...
</code></pre>

<p>However, by referencing the factory class, I am aliasing the local variable into the lambda expression, leading to the following error:  </p>

<pre><code>NHibernate.QueryException: could not resolve property: profile of: CustomerProfile.Domain.CustomerProfileAttribute
</code></pre>

<p>Is there a way to generate an expression that refers to a a local variable?  Could I use a parameterized expression with that Where clause?  Any other solutions?</p>
","<c#><linq><nhibernate><refactoring><nhibernate-queryover>","0","185","2011-06-24 01:51:02"
"6462853","Overriding Decent Exposure Properly","<p>Rails 3.0.7 + Decent Exposure Gem</p>

<p>I'm creating a form for a model with one associated attribute:</p>

<pre><code>class Foo
  has_many :bars

  def self.build_next(attributes={})
    if item = last.try(:clone)
      # ... overrides
    else
      item = self.new
    end

    item.attributes = attributes
    return entry
  end
end
</code></pre>

<p>The user is allowed to select from a select box one of the associated items. So my basic controller looks like this:</p>

<pre><code>class FooController &lt; ApplicationController
  expose(:foos)
  expose(:foo)
  expose(:bar)

  def new
   #...
  end

  def create
    if foo.save
      redirect_to foo
    else
      render :action =&gt; 'new'
    end
  end
end
</code></pre>

<p>This works great, but the functionality needs to be adjusted to clone the previous item instead of creating a new one. So I've added:</p>

<pre><code>  default_exposure do |name|
    collection = name.to_s.pluralize
    if respond_to?(collection) &amp;&amp; collection != name.to_s &amp;&amp; send(collection).respond_to?(:scoped)
      proxy = send(collection)
    else
      proxy = name.to_s.classify.constantize
    end

    if id = params[""#{name}_id""] || params[:id]
      proxy.find(id).tap do |r|
        r.attributes = params[name] unless request.get?
      end
    else

      # NEW CODE
      if name == :foo &amp;&amp; params[:action] == :new.to_s
        # override
        Foo.build_next
      else
        proxy.new(params[name])
      end

    end
  end
</code></pre>

<p>This totally works, however it pretty much ruins my fun. It's super huge and is incredibly sloppy. There must be a better way right?</p>
","<ruby-on-rails><refactoring>","0","145","2011-06-24 02:59:51"
"6492496","Code refactoring c# question around several if statements performing the same check","<p>I have a method that has a load of if statements that seems a bit silly although I'm not sure how to improve the code.</p>

<p>Here's an example.  This logic was inside the view which is now in the controller which is far better but is there something I'm missing, maybe a design pattern that stops me having to check against panelCount &lt; NumberOfPanelsToShow and handling the panelCount every condition?  Maybe not, just feels ugly!  </p>

<p>Many thanks</p>

<pre><code>if (model.Train &amp;&amp; panelCount &lt; NumberOfPanelsToShow)
{
    panelTypeList.Add(TheType.Train);
    panelCount++;
}
if (model.Car &amp;&amp; panelCount &lt; NumberOfPanelsToShow)
{
    panelTypeList.Add(TheType.Car);
    panelCount++;
}
if (model.Hotel &amp;&amp; panelCount &lt; NumberOfPanelsToShow)
{
    panelTypeList.Add(TheType.Hotel);
    panelCount++;
}
...
</code></pre>
","<c#><.net><mvc><refactoring>","2","212","2011-06-27 11:58:34"
"6493776","How to do refactoring and redesign implementations of class structure without switch counstruct?","<p>I work with a code that has been written before and I want to made refactoring . The problem is the follow: 
    In a ASP.NET MVC Application with multiple user roles for each user role should be displayed the personal details page with the menu with some actions that can be apply for specific user role, for different user role the actions from menu is different for example: 
User logged in as Admin and wants to look at the personal details page for Learner (use role) the Learner menu items will show</p>

<ol>
<li>Change password</li>
<li>CV</li>
<li>Assign qualifications</li>
</ol>

<p>If user logged in with other role for example Assessor (user role)
the menu will display other items</p>

<ol>
<li>Change password</li>
<li>Progress</li>
<li>Assign qualifications</li>
<li>Assign units</li>
</ol>

<p>and if user want to look own personal details page the menu will show with other items.</p>

<p>The main idea that the menu items is different for specific user roles the number user roles about 7. and there are different combinations which user  over look personal details page of other user.</p>

<p>At the moment the code look like</p>

<pre><code>    public class LearnerMenuBuilder 
{

    public LearnerMenuBuilder(UserRole userRole, UserRole loggedUserRole)
        : base(userRole, loggedUserRole)
    {

    }

    public UserItemMenu Build()
    {
        var ret = new UserItemMenu();

        switch (UserTypeHelper.GetTypeNameOf(currentUserRole.GetType()))
        {
            case Const.LearnerRole:
                ret.Items = GetLearnerMenu();
                return ret;

            case Const.AssessorRole:
                ret.Items = GetMenuForAssessor();
                return ret;
            case Const.InternalVerifierRole:
            case Const.QualityAdviserRole:
            case Const.ManagerRole:
            case Const.NonEdiQualityAdviserRole:
                ret.Items = GetMenuForInternalVerifier();
                return ret;

            case Const.CentreAdministratorRole:
                ret.Items = GetMenuForCentreAdmin();
                return ret;
            case Const.SystemAdministratorRole:
                ret.Items = GetMenuItemsForCentreSupport();
                return ret;
            default:
                return ret;
        }
    }

  //private methods for add items to menu

}
</code></pre>

<p>}</p>

<p>From this class you can that for each user role there is switch case statement, and I want to refactor this and remove the switch construction.</p>

<p>How can do refactoring and redesign of the code in efficient way ?</p>

<p>Help me with some suggestions or solution, please.</p>

<p>Thanks in advance!</p>
","<c#><design-patterns><refactoring>","-1","82","2011-06-27 13:41:34"
"6494443","is point free code more efficient, or just terser?","<p>I wrote the following code, which takes a bunch of points and draws them on the screen using the gloss library. </p>

<pre><code>let s = blocks pes
    pts = map (map mkPt) s  {- stitches to points-}
    lines = map Line pts    {-points to lines -}
    pict = Pictures lines   {- lines to a picture -}
  in do  displayInWindow ""My Window"" (200, 200) (10, 10) white pict
</code></pre>

<p>It works fine, but it occurs to me that there's a repeated pattern: a chain of function calls, the result of each one feeding into the last argument of the next.
So I refactored by removing the intermediate variables, reversing the order and chaining the functions with function composition (""."") like so:</p>

<pre><code>let pict = Pictures . (map Line) . (map $ map $ mkPt) . blocks $ pes
                in do  displayInWindow ""My Window"" (200, 200) (10, 10) white pict
</code></pre>

<p>Happily, this works just fine too. But I'm wondering if I'm straining readability, or if I'm just not used to reading &amp; writing point free style code. Also, how do I reason about this code? Is the second version more efficient, or just terser?  Is there anything I can do stylistically to make it clearer?</p>
","<haskell><coding-style><refactoring>","23","756","2011-06-27 14:28:53"
"6496475","Using HTML templates for building Dynamic pages: Refactoring existing web site","<p>I have been tasked with refactoring a current website (foo.com) using .NET and C# that caters to multiple companies (abc.com, def.com, ghi.com, etc). The current website uses html templates for each of the companies so that foo.com emulates the company's website.</p>

<p>Here is a sample of one of the templates:</p>

<pre><code>&lt;head&gt;
&lt;meta content=""text/html; charset=windows-1252"" http-equiv=""Content-Type"" /&gt;
&lt;title&gt;Current Dynamic Title&lt;/title&gt;
&lt;style type=""text/css""&gt;
.theader {
    border-style: solid solid none solid;
    border-width: 1px;
    border-color: #000000;
    width: 980px;
}
.tbody {
    border-style: none solid solid solid;
    border-width: 1px;
    border-color: #000000;
    text-align: left;
    background-color: #FFFFFF;
    width: 980px;
    min-height: 250px;
}
.tfooter {
    width: 980px;
}
.style1 {
    border-width: 0;
}
&lt;/style&gt;
&lt;/head&gt;

&lt;body style=""margin-left: 0; margin-right: 0; margin-bottom: 0; background-color: #0099FF""&gt;
    &lt;center&gt;
        &lt;div class=""theader""&gt;
            &lt;map id=""FPMap0"" name=""FPMap0""&gt;
            &lt;area coords=""225, 163, 283, 183"" href=""http://www.abc.com/index.php"" shape=""rect"" /&gt;
            &lt;area coords=""294, 164, 377, 181"" href=""http://www.abc.com/aboutus.php"" shape=""rect"" /&gt;
            &lt;area coords=""388, 162, 472, 183"" href=""http://www.foo.com/current.ap"" shape=""rect"" /&gt;
            &lt;area coords=""484, 164, 589, 183"" href=""http://www.abc.com/contactus.php"" shape=""rect"" /&gt;
            &lt;area coords=""603, 161, 731, 183"" href=""http://www.foo.com/emaillist.ap"" shape=""rect"" /&gt;
            &lt;/map&gt;
            &lt;img src=""../images/Header_opt_1.jpg"" height=""191"" width=""980"" class=""style1"" usemap=""#FPMap0"" /&gt;
        &lt;/div&gt;

        &lt;div class=""tbody""&gt;
        inserthtmlhere
        &lt;/div&gt;

        &lt;div class=""tfooter""&gt;
            &lt;map id=""FPMap1"" name=""FPMap1""&gt;
            &lt;area coords=""89, 8, 132, 24"" href=""http://www.abc.com/index.php"" shape=""rect"" /&gt;
            &lt;area coords=""144, 8, 215, 25"" href=""http://www.abc.com/aboutus.php"" shape=""rect"" /&gt;
            &lt;area coords=""224, 10, 299, 23"" href=""http://www.foo.com/current.ap"" shape=""rect"" /&gt;
            &lt;area coords=""311, 7, 402, 24"" href=""http://www.abc.com/contactus.php"" shape=""rect"" /&gt;
            &lt;area coords=""414, 8, 557, 24"" href=""http://www.foo.com/emaillist.ap"" shape=""rect"" /&gt;
            &lt;/map&gt;
            &lt;img src=""../images/Footer.JPG"" class=""style1"" usemap=""#FPMap1"" /&gt;
        &lt;/div&gt;
    &lt;/center&gt;

&lt;/body&gt;
</code></pre>

<p>As you can see, the templates include a custom head section, some custom css, and three divs for the content (theader, tbody, and tfooter). The current website picks up this template and replaces the ""inserthtmlhere"" with dynamic content based on querystring parameters and the page being called.</p>

<p>There are hundreds of these templates already in use with the current website.</p>

<p>My question is.... How would you go about refactoring this design? </p>
","<c#><asp.net><html><refactoring>","0","118","2011-06-27 17:18:22"
"6500042","Refactoring package name breaks entire app","<p>I am trying to refactor my package using Eclipse</p>

<pre><code>org.sheehan.activity
</code></pre>

<p>to</p>

<pre><code>org.sheehan.stocks.activity
</code></pre>

<p>For some reason my project just blows up when I do this and R doesn't get regenerated. How can I refactor properly?</p>

<p><strong>UPDATE</strong>:
I updated my Android Manifest to reflect the change. R still doesn't get regenerated. Even after a clean. The compiler is complaining about org.sheehan.activity.R</p>
","<java><android><eclipse><refactoring><android-manifest>","5","459","2011-06-27 23:18:20"
"6514237","how to refactor or fix circular reference in this case? java","<p>I have read a parent Class called MyClass
code like this,</p>

<pre><code> public class MyClass extends CompositeObject{
    protected Map&lt;String,MyAttibute&gt; attributes = new       

    HashMap&lt;String,MyAttribute&gt;
    .....

 }
</code></pre>

<p>In MyAttribute Class,
 Code like this</p>

<pre><code>public class MyAttibute extends MyObject 
{
   private MyClass definedOnClass;//point to its parentClass

}
</code></pre>

<p>This actually is a circular reference.Which makes trouble when you do deep serlization and equals. And it may not be a good design.How to avoid it? And after fixing it, we can still easily find the parentClass from its attribute.</p>

<p>P.S. I see another two classes design</p>

<pre><code>public class Transaction{
   private ChangeManager parentManager;
   ....
   public Transaction(ChangeManager parentManager)
} 

public class ChangeManager {
  //record transaction when commit
  private List&lt;Transaction&gt; transactions = new ArrayList&lt;Transaction&gt;();
  Transaction currentTransaction;
  ....  
}
</code></pre>

<p>Do you think this kind of design is good? Why?
As you can see the domains these classes are defining on are quite common.
So can anyone share some insight about it? Is it harmful to let Transaction know its ChangeManager and let MyAttributes know its MyClass in their properties? Any comments are welcome. Cons and pros.</p>
","<java><design-patterns><refactoring>","1","252","2011-06-28 23:28:29"
"6514959","Refactor this controller?","<pre><code>class ArticlesController &lt; ApplicationController

  def index
    @articles = Article.by_popularity

    if params[:category] == 'popular'
      @articles = @articles.by_popularity
    end

    if params[:category] == 'recent'
      @articles = @articles.by_recent
    end

    if params[:category] == 'local'
      index_by_local and return
    end

    if params[:genre]
      index_by_genre and return
    end

    respond_to do |format|
      format.html # index.html.erb
      format.xml  { render :xml =&gt; @articles }
    end
  end

  def index_by_local
    # 10 lines of code here

    render :template =&gt; 'articles/index_by_local'
  end

  def index_by_genre
    # ANOTHER 10 lines of code here

    render :template =&gt; 'articles/index_by_genre'
  end
end
</code></pre>

<p>As you can see from above. My controller is not exactly <strong>thin</strong>. What its doing is, depending on the params that were passed, it interacts with the model to filter out records.</p>

<p>And if <code>params[:local]</code> or <code>params[:genre]</code> was passed. Then it calls its own methods respectively (<code>def index_by_local</code> and <code>def index_by_genre</code>) to do further processing. These methods also load their own template, instead of <code>index.html.erb</code>.</p>

<p>Is this quite typical for a controller to look? Or should I be refactoring this somehow?</p>
","<ruby-on-rails-3><refactoring><refactor-my-code>","0","77","2011-06-29 01:49:51"
"6536799","Refactor->Rename broken in Visual Studio","<p>I'm using Visual Studio SP1 (Ver 10.0.40219.1) and I created an ASP.NET MVC 3 app.  I'm trying to rename an abstract class that inherits from Controller.</p>

<p>I right-clicked the class name and selected Refactor->Rename.  I changed the name and clicked OK (with Preview reference changes checked).  On the Preview Changes dialog I clicked Apply, and got the following error:</p>

<blockquote>
  <p>Microsoft Visual Studio</p>
  
  <p>StartIndex cannot be less than zero.<br />
  Parameter name: startIndex</p>
</blockquote>

<p>An ideas what the problem might be?</p>
","<visual-studio-2010><refactoring>","2","116","2011-06-30 14:59:51"
"6536801","Why is jQuery UI widget.js setting a height on my window?","<p>I'm updating a mess of JavaScript over here and I'm trying to find out why my div is having it's height overridden. </p>

<p>I'm trying to set the options of a custom widget so the width of the div is 200. Before the call ever gets to my custom widget, it goes through jquery.ui.widget.min.js where somewhere along the line both ""clientHeight"" and ""offsetHeight"" are being set to an undesirable absolute pixel number.</p>

<p>This is the call:</p>

<pre><code>$popup.module(""option"", ""dialog"", { width: settings.width });
</code></pre>

<p>Any ideas? Is there an option that you can set to make widget.js not modify the height at all?</p>

<p>EDIT: I've stepped further into the issue and I've discovered that the height is getting set within the first few lines of $.widget.bridge. Does anyone know why a height would be getting set there? </p>
","<jquery><refactoring><widget>","2","99","2011-06-30 14:59:59"
"6542384","How can I detect which modules depend on which modules in Ruby?","<p>What tools can determine which modules have methods that are calling methods from other modules in Ruby?</p>

<p><strong>Background:</strong> I'm partway through breaking a 808 line module into smaller modules, having created 12-submodules. However, some of the methods in one of the modules are calling methods in another sub-module. This may or may not be ok, depending on whether the module of the called method is meant to be common functionality.</p>

<pre><code>module DisplayStatistics1
  def display_statistics_1_foo
    calculate_statistics_foo # call a method that's in CalculateStatistics - this is ok
    display_statistics_2_bar # call a method that's in DisplayStatistics2 - this is bad
  end

  # other methods omitted
end

# modules DisplayStatistics2 and CalculateStatistics omitted

class ExampleClass
  include DisplayStatistics1
  include DisplayStatistics2
  include CalculateStatistics
end
</code></pre>

<p>Ideally the analysis tool would show that <code>DisplayStatistics1</code> has dependencies on <code>DisplayStatistics2</code> as well as on <code>CalculateStatistics</code>.</p>

<p><strong>Update:</strong> Maybe I shouldn't have done it this way - maybe I should have split them up into classes instead. That way, I'd have known for sure what depended on what!</p>
","<ruby><refactoring><code-analysis>","2","35","2011-07-01 00:08:38"
"6547617","Refactoring validation methods and callbacks","<p>I am using Ruby on Rails 3.0.7 and I have tree classes what behavior is almost the same (and also the code in them model files). All those have a <code>name</code> and a <code>description</code> attribute, run same validation methods and for both there is a <code>before_save</code> callback that maintains data consistent providing the same functions.</p>

<p><em>I would like to refactor validation methods and callbacks in a separated class\model</em> (I think I have to locate them related files in the <code>\lib</code> folder of my application).</p>

<p><strong>What I have to do to make that? What code I have to add in my classes and what in the refactoring class\model?</strong></p>
","<ruby-on-rails><ruby><ruby-on-rails-3><class><refactoring>","1","129","2011-07-01 11:55:01"
"6548228","Abstract class with Python 2.5","<p>I currently refactor a class defining a client or a server. The class had a lot of</p>

<pre><code>if client:
    XXXXXXXXXXXX
elif server:
    YYYYYYYYYYYY
</code></pre>

<p>So I decided to create a class A with the similar code and one class C for the client and an other one S for the server which inherit A. (they don't have theses names of course ^^)</p>

<p>So class A is some kind of abstract class. But the problem is there is no abstract classes in Python 2.5, it comes with 2.6 version. So I was wondering if there is a way to forbid instantiations of class A.</p>

<p>One solution would have been to raise a NotImplemented error in the constructor of the class A, but C and S have the same code for it so I put it in the ""abstract"" class A (bad idea ?).</p>

<p>This may seem stupid but I develop in Python only from time to time and I'm a young programmer.
What are your advices?</p>
","<python><refactoring>","1","214","2011-07-01 12:55:08"
"6564125","How to access Eclipse refactoring scripts from command line for automation","<p>Eclipse allows to create refactoring scripts through the GUI. I'm looking for a way to generate the script files with inputs from an external module and then automate the refactoring based on them. Would it be possible to do this by a mere jar/class call in a command line (bash script)? </p>

<p>Are there other options to do automated find and replace on large code base which won't break the code? Typically the projects contain all sorts of files java,jsp,css,html,Make,....</p>
","<eclipse><refactoring>","1","211","2011-07-03 16:37:33"
"6569377","disable back button on in ltk wizardinputpage","<p>I'm doing a plugin in Eclipse IDE in order to do a refactoring. I'm using LTK, the point is: I don't know how I can disabled the back button after the preview. I've tried to create the RefactoringWizard using some flags like 'NO_BACK_BUTTON_ON_STATUS_DIALOG', but I think it is not the rigth way to do it.</p>

<p>The poblem I have in the background is that when I push preview and then push back, and preview again, the preview box shows the change related with the refactoring twice!.</p>

<p>I think the best solution is disabling the back button after the preview because this is the solution I have seen in others plugins.</p>

<p>Sorry because of my English and thanks beforehand.</p>
","<eclipse><refactoring><wizard><back><ltk>","0","169","2011-07-04 09:10:08"
"6577284","Can I use Bicycle Repair Man in Eclipse to rename a method or class across all files in a project?","<p>I've just started to get familiar with <a href=""http://bicyclerepair.sourceforge.net/"" rel=""nofollow"">Bicycle Repair Man</a> through PyDev and while limited, it's nice.  The 'rename' item doesn't appear to provide anything more than a search &amp; replace, and unlike search &amp; replace I can't find a way to use it across multiple source files.</p>

<p>Any tips, or is this just the state of the BRM plugin right now?</p>
","<python><eclipse><ide><automated-refactoring>","0","65","2011-07-05 01:29:27"
"6587729","How to use IntelliJ IDEA to find all unused code?","<p>I have been a happy IntelliJ IDEA user for a long time but I have this question. When I am in a .java file, the unused code is usually grayed out or has a green underline saying this code will probably (probably because of some weird JNI/Reflection corner cases) will be unused. But I have this project with thousands of Java files and I want to find ALL INSTANCES of such probable-unused codes. How can I do that in IntelliJ IDEA?</p>
","<java><refactoring><intellij-idea><code-metrics><code-inspection>","11","568","2011-07-05 19:18:23"
"6593625","Eclipse: ""Refactor - Rename"" completely messed up, replacing arbitrary characters in file","<p>When refactoring a class name, Eclipse lately shows a very strange behavior. For example, let's look at one of our classes:</p>

<pre><code>public class CampaignCSVPanel extends ContentPanel {

   private FileUploadField uploadFieldCsv = new FileUploadField();
   ...
}
</code></pre>

<p>and I rename it to ""CampaignCsvPanel"", then the following happens:</p>

<pre><code>public class CampaignCSVPanel extends ContentPanel{

   private FileUploadField uploadFielCampaignCsvPanelploadField();
   ...
}
</code></pre>

<p>Strange - and it happens <em>basically every time</em> I perform a class rename. What's more:</p>

<ul>
<li>I already created a completely new workspace (and checked out the same projects again),</li>
<li>and I installed a fresh version of Eclipse (i.e. it happens both in Eclipse 3.6 and 3.7).</li>
</ul>

<p>I assume, it <strong>must have something to do with the projects</strong> in the workspace, because it only happens with the projects of one company I work for - not with other sets of projects I'm working on. Do you have any idea, what the reason could be? </p>

<p>(System specs:</p>

<ul>
<li>Ubuntu Linux 11.04, 64bit</li>
<li>Eclipse 3.6/3.7</li>
<li>Plugins: Subversive, m2eclipse, Google (GWT) plugin.</li>
<li>I tried both OpenJDK and SunJDK (1.6.0_24).
)</li>
</ul>
","<java><eclipse><refactoring>","2","514","2011-07-06 08:37:55"
"6585329","Is there a tool to automatically extract common subroutines from files?","<p>I have two 1000+ line programs in Perl, each with about 20 subroutines in the main file. One was forked from the other some time ago and I want to factor out the common parts (before porting features backward.) Is there a diff tool that will treat the subroutines (and preceding comments) as units, and extract the common units into a new file? (if one line of a subroutine is different, the unit doesn’t match.)</p>

<p>My SCM is currently Subversion if that helps.  A Perl script that processes the code would be cool.</p>
","<perl><svn><ide><refactoring>","3","98","2011-07-05 15:39:24"
"6609296","Code smells ""Message Chains"" vs ""Middle Man""","<p>I'm reading through Fowler's refactoring book and am a bit confused about those two code smells.</p>

<p>""Message Chains"" are calls like <code>a.getB().getC().getValue()</code>.</p>

<p>""Middle Man"" is a method like</p>

<pre><code>class A
{
    object getCValue()
    {
        return b.getCValue();
    }
}
</code></pre>

<p>The way I understand the two section is that if you've got ""Message Chains"" you shorten them by introducing ""Middle Men"". And If you've got ""Middle Men"" you turn them into ""Message Chains""...</p>

<p>Now obviously there has to be some limitation to this or you'd have a programmer's merry-go-round. <strong>At what point should I favor one over the other?</strong></p>

<p>One is coupling the class to unrelated classes, the other is coupling the class to the structure. So in theory my approach would be to check if any given change reduces one kind of coupling more than it increases the other kind of coupling. But is one kind of coupling worse and should be weighed more? I.e. only add one class coupling if you can remove X structural couplings?</p>
","<design><refactoring><code-smell>","6","231","2011-07-07 10:38:10"
"6618495","Eclipse rename/refactoring override","<p>I am new to eclipse plug-in development. I want to customize the renaming of a project. I need to validate the new name. So how can I override eclipse's rename/refactoring method?</p>

<p>I saw something related to RenameParticipant, but didn't understand clearly. It would be great if someone could explain me steps to override the renaming functionality.</p>

<p>Many Thanks,
Ann</p>
","<eclipse><refactoring><override><rename>","3","494","2011-07-07 23:55:05"
"6639649","Rails 3 views refactoring: conditionals and finds","<p>What would you recommend as the best way to refactor these two bits of view code?</p>

<pre><code>&lt;%if Supplydetail.find_all_by_isbn_id(@isbn).first.nil? %&gt;
&lt;%else%&gt;
&lt;%if Productavailability.find_by_code(Supplydetail.find_all_by_isbn_id(@isbn).first.productsupply_supplydetail_productavailability).nil? %&gt;
&lt;%else%&gt;
&lt;li&gt;&lt;%= Productavailability.find_by_code(Supplydetail.find_all_by_isbn_id(@isbn).first.productsupply_supplydetail_productavailability).value %&gt;&lt;/li&gt;
&lt;%end%&gt;
&lt;%end%&gt;
</code></pre>

<p>and (using formtastic)</p>

<pre><code>%li.tip 
  = tooltip(:test, :hover)
= f.input :relatedmaterial_relatedproduct_idvalue, :label =&gt; ""Related ISBN"", :as =&gt; :select, :collection =&gt; Isbn.all, :label_method =&gt; :descriptivedetail_titledetail_titleelement_titlewithoutprefix, :value_method =&gt; :productidentifier_idvalue  
%li.list
  = link_to ""Edit list"", isbns_path 
</code></pre>

<p>I have examples of each of these about a bazillion times in my app, and would like to know I'm refactoring in the best way before I dive in to this rather huge job. </p>
","<ruby-on-rails><ruby-on-rails-3><refactoring><find><conditional>","0","151","2011-07-10 06:36:42"
"6641244","How can I properly select a radio button using SWTBot?","<p>I'd like to use <a href=""http://www.eclipse.org/swtbot/"" rel=""nofollow"">SWTBot</a> to configure and invoke the encapsulate field refactoring. The problem is that the refactoring ignores a radio button selection. I've created <a href=""https://github.com/reprogrammer/SWTBotExamples"" rel=""nofollow"">a minimal project</a> that demonstrates this problem and opened <a href=""https://github.com/reprogrammer/SWTBotExamples/issues/1"" rel=""nofollow"">an issue</a> to describe the problem in detail.</p>
","<eclipse><refactoring><swt><gui-testing><swtbot>","0","128","2011-07-10 13:01:27"
"6641361","How to refactor to avoid cyclic dependencies when methods are recursive?","<p>I have written code to cast the object to the required type. And if the required type is a custom class object and it has another object we need to cast it recursively. BTW: I will know that I need to construct an object if the input is a hashMap. If in side a HashMap if another hashMap is there then I need to understand that its object inside an object. And inside object I need to build from the inner hashMap. To build it I will call the method recursively. Code I have depicted here. But these 2 classes Castor and MyBuilder both have become in cycles. I am not getting how to break it. If the method is not cyclic we can break dependecy. But with cycles can any one help?
Any pattern can I introduce or how can I refactor this?</p>

<p>Thanks in advance.</p>

<p>Code is something like this : 
For faster access to cycle pl refer to : returnValue castPrimitive( ....  and void setParameterToEntity.....</p>

<pre><code>MyBuilder myBuilder = new MyBuilder();

class Castor {
public Object castToRequiredType( Type type, Object object) {
    String typeString = type.toString();
    Object returnValue = null;
    if (myUtils.isTypePrimitive(typeString)) {
        returnValue = castPrimitive(object.toString(), typeString);
    }else if {
 // some conditions and some casting logic.
}
else {
        returnValue = myBuilder.buildCustomObject(this,typeString, object);
    }
    return returnValue;
   }
  // other methods which call castToRequiredType() recursively.
}


 class MyBuilder{
 buildCustomObject(Castor castor,
          String classOfType, Object object){
     Class&lt;?&gt; loadedClass = myUtils.loadClass(classOfType);

        instance = loadedClass.newInstance();
        HashMap&lt;?, ?&gt; myMap;
        List&lt;Method&gt; declaredMethods = myUtils.getMethodsForClass(loadedClass);
        for (Method method : declaredMethods) {
            if (object instanceof HashMap&lt;?, ?&gt;) {
                myMap = (HashMap&lt;?, ?&gt;) object;
        // ITERATE THROUGH MAP AND CALL THE SET PARAMETER TO ENTITY METHOD.
                    }
                }
            }
     return instance;
}

 void setParameterToEntity(Castor caster,
Object instance,  Method method,  Object value) {
    ype[] parameterTypes = method.getGenericParameterTypes();
    Object castedValue = caster.castToRequiredType(
    parameterTypes[0], value);          
   }
</code></pre>

<p>}
}</p>
","<java><design-patterns><refactoring><cyclic-reference>","1","176","2011-07-10 13:30:17"
"6641952","Better name than DELEGATE_TRY_PERFORM_SELECTOR_WITH_SELF","<p>I have a lot of viewcontrollers in my project that just redirects to its delegate.
So I have made a define for it, but I'm not so happy about it's name.</p>

<p>How would you name it or would you do it in another way?</p>

<p>I also have situations where the delegate may return an object or take
multiple arguments.</p>

<hr>

<pre><code>// the problem is highly repetitive code    
-(void)switchToNextTab:(id)sender {

    SEL sel = @selector(switchToNextTab:);
    if([m_delegate respondsToSelector:sel]) {
        [m_delegate performSelector:sel withObject:self];
    }
}

-(void)switchToPrevTab:(id)sender {
    SEL sel = @selector(switchToPrevTab:);
    if([m_delegate respondsToSelector:sel]) {
        [m_delegate performSelector:sel withObject:self];
    }
}

-(void)closeTab:(id)sender {
    SEL sel = @selector(closeTab:);
    if([m_delegate respondsToSelector:sel]) {
        [m_delegate performSelector:sel withObject:self];
    }
}
</code></pre>

<hr>

<pre><code>// my solution.. which I need a better name for
#define DELEGATE_TRY_PERFORM_SELECTOR_WITH_SELF(selector_name) \
    do { \
        SEL sel = @selector(selector_name); \
        if([m_delegate respondsToSelector:sel]) { \
            [m_delegate performSelector:sel withObject:self]; \
        } \
    } while(0);


-(void)switchToNextTab:(id)sender {
    DELEGATE_TRY_PERFORM_SELECTOR_WITH_SELF(switchToNextTab:);
}
</code></pre>
","<cocoa><refactoring><naming-conventions><kiss>","0","51","2011-07-10 15:30:24"
"6643485","How can I exercise the quick assist feature of Eclipse using SWTBot?","<p>I'd like to use <a href=""http://www.eclipse.org/swtbot/"" rel=""nofollow"">SWTBot</a> to inline a local variable via the quick assist menu. My SWTBot test pops up the quick assist menu, but it fails to select the proposal item. I've created <a href=""https://github.com/reprogrammer/SWTBotExamples"" rel=""nofollow"">a minimal project</a> on <a href=""https://github.com/"" rel=""nofollow"">GitHub</a> that demonstrates this problem and opened <a href=""https://github.com/reprogrammer/SWTBotExamples/issues/2"" rel=""nofollow"">an issue</a> that describes the problem in detail.</p>
","<eclipse><refactoring><swt><gui-testing><swtbot>","0","83","2011-07-10 20:34:08"
"6644809","Struggling to refactor a Player class with more than 4000 LOC","<p>Here is the situation:
I'm implementing a 4-players card game. It has a lot of different rules and requires some real intelligence to be played. So I started designing the abstract types such as Card and Player and the relationships between them, and then I started defining the interfaces and so on ..</p>

<p>The only class I'm struggling to refactor is the Player class. I've defined a simple interface for this class that has 9 methods (e.g play(), takeCard(Card), etc..) So I got started by implementing these methods, and then the problem began ...</p>

<p>I used a lot of logic and private methods (such as canCardEat(), doesTeamMateHaveCard(Card) etc.) in order to make the player as smart as possible. When I finished writing the first working version of the class, the player was pretty intelligent in his plays, BUT, I've found that there was more than 5000 lines of code, and exactly 187 private methods, only in this class! :(</p>

<p>I am now horrified by these numbers, so I tried to eliminate and merge some of the private methods until I reached a total of 4500 LOC and about 160 (private) methods. Still, a huge class.</p>

<p>I did search for a solution and all I got was ""split the class into multiple classes"". The problem is that I couldn't. I thought of creating a LogicalBrain class and use an instance of it as an instance variable in the Player class, so the player instance would then ask the logical brain to do the work. But then the problem will remain because I will have to move about 90% of the code in Player into the new class.</p>

<p>So my questions are:</p>

<ol>
<li>If you were me, what would you do to refactor the Player class?</li>
<li>Is there another technique to implement the intelligence that suits my situation other than logic-based code and ANN?</li>
</ol>
","<game-development><refactoring>","1","53","2011-07-11 00:59:35"
"6651536","IDEA 10.0.3 replaces declarations with fully qualified names on refactoring","<p>Whenever I move a (unambiguously named) type to another package, IDEA decides to replace all occurrences of given type with its fully qualified name instead of just adding the appropriate imports; going through all affected files and manually fixing the imports is madness.</p>

<p>I tried out all possible combinations of the ""Auto Import"" settings to no effect. Has anybody run into the same problem?</p>
","<java><import><refactoring><intellij-idea><move>","2","98","2011-07-11 14:19:53"
"6651750","Fast easy refactoring in visual studio","<p>I have a large project that is quite a mess.  There's God classes, poor variable naming, poor indentation and spacing...among other issues.  </p>

<p>I'm looking for a quick and easy way to make marketable improvements to such a project.  In Visual Studio 2010 CTRL + K and CTRL + D gives me fast code cleanup.  Organize usings takes out unused namespaces.  But, both only seem to work on 1 page.  Can I apply these changes to a project?  Are there any similar cleanup techniques or free and reliable 3rd party addons?</p>
","<c#><visual-studio-2010><refactoring>","5","171","2011-07-11 14:21:08"
"6655397","Matlab GUI's managebuttons","<p>I have to maintain a large MATLAB GUI, containing quite a few callback functions, each of which gets called at many points.  At some point, I decided to rename one of the callbacks; in order not to have to go through GUIDE to manually modify each of the UI that calls it, I used the <em>excellent</em> <code>gencode</code> program to ""unwrap"" the .fig file, <code>s/old_name/new_name/g</code>, and recreate the .fig.</p>

<p>This seems to work well, except for one thing: when clicking on a button in a button group, I got a message telling me that the function <code>manageButtons</code> is unknown.  After a bit of googling, I find that <code>manageButtons</code> is a nested function in <code>childAddedCbk</code>, which, I assume, is called by GUIDE as the GUI is created.  Now, trying to move just <code>manageButtons</code> outside to its own, in-the-path file doesn't work either: the <code>hgroup</code> passed to it is an <code>invalid handle object</code>.</p>

<p>So... does anyone has a workaround for that?  Any of the following will be appreciated:</p>

<ul>
<li>changing all the callbacks in a GUI in a semi-automatic way, or</li>
<li>making the <code>manageButtons</code> get a valid handle, or</li>
<li>having <code>gencode</code> not break all that.</li>
</ul>

<p>Thanks,</p>

<p>Antony</p>
","<gui><matlab><refactoring><matlab-guide>","1","73","2011-07-11 19:30:26"
"6668312","How to pinpoint what is slowing down my Rails App","<p>My Rails app runs fine in development mode (without caching) but in production has a hard time loading the :show view for the primary model. The log only shows SQL queries which add up to about 45ms, but the actual render time is about 15 seconds. I'm using acts_as_ferret and paperclip, but paperclip is only calling the after_save loop to no action. There are only 1 or 2 users online at the time, so I'm not thinking I've got a backed up queue, but I really can't narrow down what's hogging up the site. What can I do to more precisely measure server-side functions and see what is backing up the load time?</p>

<p>Things called in the :show view</p>

<ul>
<li>about 12 HABTM lists (types of tags, categories, etc.)</li>
<li>Related videos found with acts_as_ferret</li>
<li>HABTM comments for the videos</li>
</ul>

<p>And that's really pretty much it. And how should I call HABTM as a Rails best practice? Right now I""m doing something like:</p>

<pre><code>&lt;%= @video.tags.map {|t| link_to t.name, path} %&gt;
&lt;%= @video.categories.map {|c| link_to c.name, path} %&gt;
#etc....
</code></pre>

<p>I'm pretty sure there's a better way to do this, and I'm open to suggestion</p>
","<ruby-on-rails><ruby><performance><refactoring>","2","112","2011-07-12 17:20:35"
"6668631","jQuery Defining Custom Functions","<p>I'm trying to a define my own function in jQuery to condense my js file, but I seem to be unable to shorten these two lines. Below is:</p>

<p>*My function</p>

<p>*What it looks like with the function</p>

<p>*What the original code looks like without the function</p>

<pre><code>var AddContent = function(content) {
    $(#log li:last).remove();
    $(#log).append(content);
};


    $('.object').click(function(){
        AddContent('&lt;li&gt;content1&lt;/li&gt;');
    });



    $('.object').click(function(){
        $('#log li:last').remove();
        $('#log').append('&lt;li&gt;content1&lt;/li&gt;');
    });
</code></pre>

<p>What am I doing wrong? Help! </p>
","<jquery><refactoring><refactor-my-code>","1","116","2011-07-12 17:45:05"
"6671266","How to refactor highly repetitive reading sections from config files","<p>I need to convert multiple sections of config file to dictionaries. Values of those dictionaries have different types. The following two classes work, but they are almost identical:</p>

<pre><code>public class IntConfigSection
{
    private static readonly ILog Log = LogManager.GetLogger(typeof(IntConfigSection));
    public static Dictionary&lt;String, int&gt; LoadSection(string sectionName)
    {
        var ret = new Dictionary&lt;String, int&gt;();
        try
        {
            var offsetsHash = (Hashtable)ConfigurationManager.GetSection(sectionName);
            foreach (DictionaryEntry entry in offsetsHash)
            {
                ret.Add((String)entry.Key, int.Parse((String)entry.Value));
            }
        }
        catch(Exception e)
        {
            Log.ErrorFormat(""LoadSection:"" + e);
        }
        return ret;
    }
}

public class StringConfigSection
{
    private static readonly ILog Log = LogManager.GetLogger(typeof(StringConfigSection));
    public static Dictionary&lt;String, String&gt; LoadSection(string sectionName)
    {
        var ret = new Dictionary&lt;String, String&gt;();
        try
        {
            var offsetsHash = (Hashtable)ConfigurationManager.GetSection(sectionName);
            foreach (DictionaryEntry entry in offsetsHash)
            {
                ret.Add((String)entry.Key, (String)entry.Value);
            }
        }
        catch (Exception e)
        {
            Log.ErrorFormat(""LoadSection:"" + e);
        }
        return ret;
    }
}
</code></pre>

<p>The following code does not work as required, but it demonstrates what I am trying to accomplish:</p>

<pre><code>public class ConfigSection&lt;T&gt;
{
    private static readonly ILog Log = LogManager.GetLogger(typeof(StringConfigSection));
    public static Dictionary&lt;String, T&gt; LoadSection(string sectionName)
    {
        var ret = new Dictionary&lt;String, T&gt;();
        try
        {
            var offsetsHash = (Hashtable)ConfigurationManager.GetSection(sectionName);
            foreach (DictionaryEntry entry in offsetsHash)
            {
                //builds but does not always do what I want
                ret.Add((String)entry.Key, (T)entry.Value);
                // does not compile
                //ret.Add((String)entry.Key, T.Parse((String)entry.Value));
            }
        }
        catch (Exception e)
        {
            Log.ErrorFormat(""LoadSection:"" + e);
        }
        return ret;
    }
}
</code></pre>

<p>Edit: my final version looks as follows:</p>

<pre><code>public class ConfigSectionLoader
{
    public static Dictionary&lt;String, int&gt; LoadIntSection(string sectionName)
    {
        return ConfigSection&lt;int&gt;.LoadSection(sectionName, int.Parse);
    }

    public static Dictionary&lt;String, String&gt; LoadStringSection(string sectionName)
    {
        return ConfigSection&lt;String&gt;.LoadSection(sectionName, val =&gt; val);
    }
}

internal class ConfigSection&lt;T&gt;
{
    private static readonly ILog Log = LogManager.GetLogger(typeof(StringConfigSection));
    internal static Dictionary&lt;String, T&gt; LoadSection(string sectionName, Func&lt;String, T&gt; parseFunc)
    {
        var ret = new Dictionary&lt;String, T&gt;();
        try
        {
            var hash = (Hashtable)ConfigurationManager.GetSection(sectionName);
            foreach (DictionaryEntry entry in hash)
            {
                ret.Add((String)entry.Key, parseFunc((String)entry.Value));
            }
        }
        catch (Exception e)
        {
            Log.ErrorFormat(""LoadSection:"" + e);
        }
        return ret;
    }
}
</code></pre>

<p>My only concern is this: is val => val the simplest lambda that does nothing?</p>
","<c#><templates><configuration><refactoring>","1","142","2011-07-12 21:18:29"
"6688288","Please recommend a plan for migrating asp.net website to a three-layer architecture","<p>I have an ASP.NET website that I built that has grown considerably in size and complexity.  I did not create a DAL or BLL in the beginning because I was a newbie and decided that was simpler for me.  Instead I used a lot of SqlDataSources and put all of the business logic in the code-behinds for the relevant pages.  It was one heck of a learning project.  But over time I've steadily added features all the while usage of the site has grown significantly.  I now find myself with something that has become unwieldy to maintain.  Some refactoring is definitely in order.</p>

<p>What I would like to do is to begin separating my UI, business logic and data access code.  I picked up a book by Fowler and have also read enough online to know that this is a good thing to do.  My trouble is that most examples and tutorials assume the reader is starting from scratch.  I need to put together a plan to accomplish this methodically.  And I need to do this in a manner that allows me to continue to learn and build skills as I go.</p>

<p>So with all of that as context, my question is how do I break this task down into bite-size chunks? For example, should I start by replacing all of those SQLDataSource controls with a new layer? Or, should I start by creating some stored procs? Or maybe I should migrate first to Linq.  You probably get the idea by now.  What I'm looking for is an answer that prescribes a sequence of small incremental steps that I can use as my roadmap.  Thanks!</p>
","<c#><asp.net><design-patterns><architecture><refactoring>","3","80","2011-07-14 03:51:36"
"6690429","Update class field in LINQ - is it possible?","<p>I have 2 tables, and want to get records from 1 table and to ""update"" one of its fields from another table, and to pass final list of ""Payment"" objects somewhere. I cannot use anonymouse type, i need to get the list of proper typed objects.</p>

<p>There was a long way.</p>

<p>Got data:</p>

<pre><code>var paymentsToShow = from p in paymentsRepository.Payments
                     join r in recordTypeRepository.RecordType
                         on p.RecordType equals r.Reference into p_r
                     where p.Customer == CustomerRef
                     from r in p_r.DefaultIfEmpty()
                     select new
                     {
                         Payment = p,
                         RecordType = r
                     };
var objList = paymentsToShow.ToList();
</code></pre>

<p>Change required field (basically, <strong>Payment.RecordTypeName</strong> is empty):</p>

<pre><code>foreach (var obj in objList)
{
    obj.Payment.RecordTypeName = obj.RecordType.Name;
}
</code></pre>

<p>Got list with correct type:</p>

<pre><code>var paymentsList = from o in objList
                   select o.Payment;
</code></pre>

<p>Is there any way to get code shorter, to make required field update in the query or something else? I dont know where to look for.
I cannot change database.</p>
","<linq><asp.net-mvc-2><refactoring><anonymous-types>","0","66","2011-07-14 08:27:30"
"6694344","How to break a user story that changes something huge internally e.g. underlying data access layer","<p>We have a few products with one of the product use flat files for persistence.. Other products in the suite can use that data (via API) but only one at a time..</p>

<p>We cannot put the whole files in DB as its huge data.. 20GB+.. but still we have found a solution where some data can be put in DB.. e.g. user interpretations, meta info, markups etc..</p>

<p>So the story is like:</p>

<p>""As a user i can concurrently access product A data from product B, C and D"". That is huge i.e. approx 6-8 months</p>

<p>Even if I keep it as ""As a user i can concurrently access product A data from product B"". It’s still huge.. i.e. approx 5-6 months</p>

<p>Even doing like following, It’s still huge..
""As a user i can concurrently access feature X of product A data from product B"". i.e. approx 4-5 months.</p>

<p>The problem is if we can do one thing (one feature, one product) we can quickly do all.. </p>

<p>how can i break this story into sub-stories.. or should i accept that some stories cannot be further broken into sub-stories that can fit in one iteration.</p>

<p>PS: we use scrum</p>
","<refactoring><agile><scrum><user-stories>","1","220","2011-07-14 13:58:33"
"6696469","refactor this basic code that determines if number is in tens, hundreds, thousands etc","<pre><code> if (n&lt;100) {
     x = 10;
 } else if (n&lt;1000) {
     x = 100;
 } else if (n&lt;10000) {
     x = 1000;
 } else if (n....
</code></pre>

<p>etc. etc. </p>

<p>Is there a nice concise, scalable method for this type of problem? My brain has decided to stop working. </p>
","<javascript><refactoring>","3","112","2011-07-14 16:13:09"
"6701664","How can you inline PHP includes/requires, or generate one PHP from several?","<p>I'm trying to analyze/refactor/rewrite a complex PHP site. While I can work with separate files, I'd like to combine everything into one file so I can figure out the context without jumping between files.</p>

<p>Is there any way with PHP (the executable) or other tools to 
""inline"" the includes, returning the result as one PHP file?</p>

<p>I realize that PHP does not preprocess includes, instead executing contents of includes files as it encounters them.</p>

<p>Essentially I'm looking for the result <em>as if</em> PHP preprocessed includes and requires before executing.</p>

<hr>

<p><strong>Edit</strong>: Working solution based on Dan Grossman's suggestion below.  The codebase I'm working from unfortunately does some clever tricks with include(), but this is a wonderful start.</p>

<pre><code>&lt;?php

function combinePhpFile($input) {

    $myFile = file_get_contents($input[2]);
    $myFile = preg_replace_callback('~\\b(include|require) ""([^""]*)"";~', 'combinePhpFile', $myFile);    
    return $myFile;

}
// preg_replace_callback wants an array? It GETS an array!
$result = combinePhpFile(array(""dummy"", ""dummy"", ""index.php""));
file_put_contents(""result.txt"", $result);
?&gt;
</code></pre>
","<php><refactoring><include><preprocessor>","0","70","2011-07-15 00:58:07"
"6713682","Contextual Logging with Log4r","<p>Here's how some of my existing logging code with Log4r is working.  As you can see in the WorkerX::a_method, any time that I log a message I want the class name and the calling method to be included (I don't want all the caller history or any other noise, which was my purpose behind LgrHelper).  </p>

<pre><code>class WorkerX

  include LgrHelper

  def initialize(args = {})
    @logger = Lgr.new({:debug =&gt; args[:debug], :logger_type =&gt; 'WorkerX'})
  end

  def a_method
    error_msg(""some error went down here"")
    # This prints out: ""WorkerX::a_method - some error went down here""
  end

end


class Lgr
  require 'log4r'
  include Log4r

  def initialize(args = {}) # args: debug boolean, logger type
    @debug = args[:debug] 
    @logger_type = args[:logger_type]

    @logger = Log4r::Logger.new(@logger_type)
    format = Log4r::PatternFormatter.new(:pattern =&gt; ""%l:\t%d - %m"")
    outputter = Log4r::StdoutOutputter.new('console', :formatter =&gt; format)
    @logger.outputters = outputter

    if @debug then
      @logger.level = DEBUG
    else
      @logger.level = INFO
    end
  end

  def debug(msg)
    @logger.debug(msg)
  end

  def info(msg)
    @logger.info(msg)
  end

  def warn(msg)
    @logger.warn(msg)
  end

  def error(msg)
    @logger.error(msg)
  end

  def level
    @logger.level
  end

end


module LgrHelper

  # This module should only be included in a class that has a @logger instance variable, obviously.

  protected

  def info_msg(msg)
    @logger.info(log_intro_msg(self.method_caller_name) + msg)
  end

  def debug_msg(msg)
    @logger.debug(log_intro_msg(self.method_caller_name) + msg)
  end

  def warn_msg(msg)
    @logger.warn(log_intro_msg(self.method_caller_name) + msg)
  end

  def error_msg(msg)
    @logger.error(log_intro_msg(self.method_caller_name) + msg)
  end

  def log_intro_msg(method)
    msg = class_name
    msg += '::'
    msg += method
    msg += ' - '

    msg
  end

  def class_name
    self.class.name
  end

  def method_caller_name
    if  /`(.*)'/.match(caller[1]) then # caller.first
      $1
    else
      nil
    end
  end

end
</code></pre>

<p>I really don't like this approach.  I'd rather just use the existing @logger instance variable to print the message and be smart enough to know the context.  How can this, or similar simpler approach, be done?</p>

<p>My environment is Rails 2.3.11 (for now!).</p>
","<ruby-on-rails><ruby><logging><refactoring><log4r>","0","427","2011-07-15 22:08:00"
"6717863","Refactoring an activerecord method in Rails 3","<p>Can this events method be re-factored and simplified?</p>

<pre><code>class Manager &lt; User
  has_and_belongs_to_many :customers

  def events
    Event.joins(:customers =&gt; :managers).where(:users =&gt; { :id =&gt; self }).select(""DISTINCT(events.id), events.description, events.created_at"")
  end

end
</code></pre>

<p>I was hoping I could build the query on top of the Manager instance I currently have, but seem unable to do this. I tried the following, but got an error</p>

<pre><code>def events
  customers.joins(:events).select(""DISTINCT(events.id), events.description, events.created_at"")
end
</code></pre>

<p>and</p>

<pre><code>current_user.events
</code></pre>

<p>But this results in MySQL error:</p>

<pre><code>Mysql2::Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'DISTINCT(events.id), events.description, events.created_at FROM `customers` INNER' at line 1: SELECT `customers`.*, DISTINCT(events.id), events.description, events.created_at FROM `customers` INNER JOIN `customers_events` ON `customers_events`.`customer_id` = `customers`.`id` INNER JOIN `events` ON `events`.`id` = `customers_events`.`event_id` INNER JOIN `customers_managers` ON `customers`.`id` = `customers_managers`.`customer_id` WHERE `customers_managers`.`manager_id` = 27 ORDER BY created_at DESC
</code></pre>
","<ruby-on-rails><ruby-on-rails-3><activerecord><refactoring><find>","0","84","2011-07-16 14:02:16"
"6717989","How to refactor <link href="" "" /> references in ASP.NET pages/views using ReSharper?","<p>I moved a set of ASPX pages to a different folder using <a href=""http://www.jetbrains.com/resharper/"" rel=""nofollow"">ReSharper's</a> Refactor->Move command.</p>

<p><a href=""http://www.jetbrains.com/resharper/features/code_refactoring.html#Move_to_Folder"" rel=""nofollow"">From ReSharper</a> we have:</p>

<blockquote>
  <p><strong>Move to Folder</strong></p>
  
  <p>This refactoring helps move a class, a file, or a selection of classes
  or files to another project or folder in solution. When executing the
  move, ReSharper <em>updates using directives</em> if necessary. Optionally, it
  can <em>rename namespaces</em> according to the new location and distribute
  classes being moved to separate files.</p>
</blockquote>

<p>After moving those pages, all the links that reference CSS files got broken.</p>

<p>When I open an ASPX page in source view I get something like this:</p>

<p><img src=""http://i.stack.imgur.com/BS2tc.png"" alt=""enter image description here""></p>

<p>I think that if it's offering a substitution it already knows where to look for the correct file.</p>

<p>The hint with an interrogation mark helps but I have to open each page and correct link by link.</p>

<p>Isn't there an automated way of correcting all the links with ReSharper 6.0? If the answer is negative, I think there should be such a feature implemented in the Move to Folder command.</p>
","<asp.net><hyperlink><resharper><href><automated-refactoring>","0","105","2011-07-16 14:25:53"
"6734025","Validate T-SQL programmability objects","<p>Is there a way to validate programmability objects in SQL Server 2008?</p>

<p>I have a database with ~500 programmability objects which depend on other programmability objects (not only tables).</p>

<p>If I do some refactoring, it is very hard find other objects which are broken by the changes. For example if I change the parameter count...</p>

<p>Original state of database:</p>

<pre><code>CREATE FUNCTION [dbo].[GetSomeText]() RETURNS nvarchar(max) AS BEGIN RETURN 'asdf' END

/* uses ""GetSomeText()"" function */
CREATE FUNCTION [dbo].[GetOtherText]() RETURNS nvarchar(max) AS BEGIN RETURN [dbo].[GetSomeText]() + '-qwer' END
</code></pre>

<p>Now I do some refactoring (add parameter <code>@Num</code> to <code>GetSomeText()</code> function):</p>

<pre><code>ALTER FUNCTION [dbo].[GetSomeText](@Num int) RETURNS nvarchar(max) AS BEGIN RETURN 'asdf' + CAST(@Num as nvarchar(max)) END
</code></pre>

<p>Now the function <code>GetOtherText()</code> is broken, because it is calling <code>GetSomeText()</code> function without a required parameter.</p>

<p>Is there a way to get information about this error?</p>

<p>Currently I script every programmability object as <code>ALTER</code>, run the alter script, and check for errors. This way looks to be too complex (and is hard to use in T-SQL only enviroment).</p>

<p><strong>EDIT:</strong></p>

<p>Thanks for answers! I know how to get dependenices or list of all objects.
The problem is in checking the body of object. If I get the dependency, is there other way to check validity than run <code>ALTER</code> script?</p>
","<sql><sql-server><refactoring>","2","119","2011-07-18 13:56:36"
"6734914","Any tools to refactor c structures under a superstructure?","<p>Are there any tools which help manage plain old c structures?</p>

<p>I have a number of structures that I would like to refactor under one big happy structure.</p>

<p>That is, I currently have:</p>

<pre><code>typedef struct foo_s
{
  //variables
}foo_t;
typedef struct bar_s
{
  //variables
}bar_t;

static foo_t foo;
static bar_t bar;
</code></pre>

<p>I would like to use the following:</p>

<pre><code>typedef struct super_s
{
  foo_t foo;
  bar_t bar;
}super_t;
static super_t super;
</code></pre>

<p>Now, global replace of ""foo"" with ""super.foo"" and ""bar"" with ""super.bar"" works, but I have to pay close attention for any naming gotchas. </p>

<p>Is there anything more specialized?</p>

<p>Enviroment: Usually, I work with Eclipse IDE for C/C++ Developers under Linux, but any tool/plugin/script/whatnot under Linux or Windows would be great.</p>
","<c><eclipse><refactoring><automated-refactoring>","0","86","2011-07-18 14:58:39"
"6739772","Database schema question","<p>I have a table in a mysql database which contains exchange rates. Currently it is defined like this:</p>

<pre><code>date | currency | rate
</code></pre>

<p>These rates use some base currency. Now I need to also store rates for another base currency. Is it better to create a separate table or use one table? What are the pros and cons of each method?</p>
","<mysql><refactoring><schema>","2","183","2011-07-18 21:37:35"
"6741480","Java IXOR ~ [one side] equality refactoring question","<pre><code>public byte[] method(int var1)
{
        if(var1 == ~L.length) //&lt;- this
            return a(i1, 0, false);
}
</code></pre>

<p>how would I go upon fixing </p>

<pre><code>if(var1 == ~L.length)
</code></pre>

<p>to remove the <code>~</code></p>

<p>must I change <code>==</code> to <code>!=</code> ?</p>

<pre><code>if(var1 != L.length)
</code></pre>

<p>Thanks this is probably the last question of this type.</p>

<p>ps.>
Thanks for helping me out with the previous ones like</p>

<p><code>~(-1 + var1) &lt; -1</code> to <code>var1 &gt; 1</code></p>

<p><code>~(var1 &amp; 0x22) != -1</code> to <code>(var1 &amp; 0x22) != 0</code></p>

<p><code>~var1 &lt; ~var2</code> to <code>var1 &gt; var2</code></p>
","<java><refactoring><deobfuscation>","0","40","2011-07-19 01:52:57"
"6742822","Does re-factoring of code affect the performance of an application?","<p>I have some decent knowledge of programming in java. Although I am not aware of the industrial standards of coding. I see that, people insist on adhering to design patterns. They constantly emphasize on refactoring code. Although I can understand the positives of refactoring, I feel that refactoring may sometimes effect the performance. </p>

<p>For ex: Consider this case where I dont refactor code. </p>

<pre><code>Class Aclass{

    function one(){
    ........
    two();
    }

    function two(){
    ........
    }

}

Class MainClass{
    main(){
    Aclass obj = new Aclass();
    obj.one();
    }
}
</code></pre>

<p>Considering that this is the initial code snippet that I implement. In this case I have one object of Aclass in the memory and the function one calls the function two. All this happens within the scope of one instance of Aclass.</p>

<p>Suppose If I refactor the code and shift function two to an another class Bclass. The code might look like:</p>

<pre><code>Class Aclass{

        function one(){
        ........
        Blass bclass = new Bclass();
        bclass.two();
        }
}

Class Bclass{
        function two(){
        .....
        }
}


Class MainClass{
    main(){
    Aclass obj = new Aclass();
    obj.one();
    }
}
</code></pre>

<p>When I refactor the code as above, I might be under the need to create a new Object for Bclass. IF this kind of refactoring is done on a large scale for a huge application, more number of instances would get accumulated in the memory and that would certainly effect the performance of an application, Right? </p>

<p>So as per the example shown above, Does it mean that re factoring (might) effect the performance of an application? Or if I am wrong in my assumption, Please let me know how to deal with this issue in programming?</p>

<p>Thanks</p>
","<refactoring>","0","62","2011-07-19 05:52:30"
"6749999","Refactoring Switch statement in my Controller","<p>I'm currently working on a MVC.NET 3 application; I recently attended a course by ""Uncle Bob"" Martin which has inspired me (shamed me?) into taking a hard look at my current development practice, particularly my refactoring habits.</p>

<p>So: a number of my routes conform to:</p>

<p>{controller}/{action}/{type}</p>

<p>Where type typically determines the type of ActionResult to be returned, e.g:</p>

<pre><code>public class ExportController
{
    public ActionResult Generate(String type, String parameters)
    {
        switch (type)
        {
            case ""csv"":
            //do something
            case ""html"":
            //do something else
            case ""json"":
            //do yet another thing
        }    
    }
}
</code></pre>

<p>Has anyone successfully applied the ""replace switch with polymorhism"" refactoring to code like this? Is this even a good idea? Would be great to hear your experiences with this kind of refactoring.</p>

<p>Thanks in advance!</p>
","<asp.net-mvc-3><refactoring><controller>","3","355","2011-07-19 15:41:42"
"6750578","I've got a helper class. Should I be considering removing it?","<p>I am using Telerik's Rad Controls for AJAX. I have created my own controls; their classes inherit from the RadControl classes. The closest common parent class for all of the Telerik controls I am inheriting from is 'WebControl.' The controls I am discussing all implement ICormantControl which doesn't have much to it:</p>

<pre><code>public interface ICormantControl&lt;T&gt;
{
    T GetSettings();
}
</code></pre>

<p>Now, in my helper class I have a handful of methods. I'd like to start with one that I believe I have the best chance of doing something with.</p>

<pre><code>    /// &lt;summary&gt;
    /// Saves a control -- writing it to Session and the DB. 
    /// &lt;/summary&gt;
    /// &lt;typeparam name=""T""&gt;&lt;/typeparam&gt;
    /// &lt;param name=""control""&gt;&lt;/param&gt;
    public static void Save&lt;T&gt;(ICormantControl&lt;T&gt; control)
    {
        T settings = control.GetSettings();
        string controlID = ((ISetting)settings).ID;

        SerializableDictionary&lt;string, T&gt; states = GetStates&lt;SerializableDictionary&lt;string, T&gt;&gt;();

        bool isKnown = states.ContainsKey(controlID);

        if (isKnown)
        {
            Logger.DebugFormat(""{0} is known. Overwriting data."", controlID);
            states[controlID] = settings;
        }
        else
        {
            Logger.DebugFormat(""{0} is unknown. Saving data."", controlID);
            states.Add(controlID, settings);
        }

        SetStates&lt;SerializableDictionary&lt;string, T&gt;&gt;(states);
    }
</code></pre>

<p>Currently, to save the state of a control, I call <code>StateManager.Save&lt;RadDockSetting&gt;(dock)</code>, for example. </p>

<p>I believe a better implementation would result in me being able to say <code>dock.Save()</code>.</p>

<p>As I see it I am pinned between a rock and a hardplace. I am under the impression that if I move the declaration of Save to my ICormantControl interface then I will have to move the implementation of Save to each of the controls which implement ICormantControl. This would result in a large amount of duplicated code.</p>

<p>Should I be leaving my implementation in my helper class, moving the declaration to ICormantControl, and then, in each class which implements ICormantControl, I redirect the implementation to my helper method?</p>

<p>As far as I can tell I am not able to have all of my controls inherit from an intermediary class. The common parent is too far up the hierarchy of inherited parent controls. It may be possible to extend WebControl and have it implement Save, but that seems orders of magnitude worse than my above suggestion.</p>

<p>Do I have other options?</p>
","<c#><generics><interface><refactoring>","1","66","2011-07-19 16:24:28"
"6756477","haskell -- any scripts to automatically manage imports or refactor modules?","<p>Does anyone know of tools to manage Haskell imports? Sometimes, I want to refactor things by moving them to another file, and a script to generate the minimal set of imports [for the new file] would be nice.</p>
","<haskell><refactoring>","5","111","2011-07-20 02:52:47"
"6773127","How to pass long list of parameters to method Or any other best way to achieve this","<p>I am passing 20+ arguments of different types to method. There should be some clean way to pass this. Can you please help me.</p>

<p>I can pass array of object having all these 20+ arguments but in target method I have to put checks on type. Is this good way to pass long list of arguments.</p>

<p><strong>Code: Sample from code not full</strong></p>

<pre><code>private DataTable CreateDataTable(string[] args)
{
    DataTable dt = new DataTable();
    dt.Clear();

    foreach (var arg in args)
    {
    dt.Columns.Add(arg);
    }

    return dt;
}
</code></pre>

<p>I can pass array in this method because all arguments are of same type.</p>

<pre><code>DataTable dt = CreateDataTable(new string[] { ""ProjectId"", 
                        ""ParentProjectId"", 
                        ""ProjectName"", 
                        ""CreationDate"");
</code></pre>

<p>Now here I have more than 20+ values of diff types like following</p>

<pre><code>int projectId = 100;
int? parentProjectId = SomeCondition ? 10 : null;
string projectName = ""Good Project""
DateTime createdDate = DateTime.Now;
.
.
.
</code></pre>

<p>In this method I would assign values to columns.</p>

<pre><code>AssignValuesToDataTable(dt, Arguments list ......)
// Implementation would be like this. Here I am passing 20+ arguments.
private DataTable AssignValuesToDataTable(DataTable dt, arguments list ........)
{
    DataRow row = dt.NewRow();
    row[""ProjectId""] = projectId;
    .
    .
    .

    dt.Rows.Add(row);
}
</code></pre>

<p>Can you please help. I am using <code>C#4</code></p>

<p><strong>EDIT:</strong>
Above code is an example from my real code but I am more interesting to know that what is best method to achieve this.</p>

<p>From Coding Horror (Jeff Atwood)</p>

<blockquote>
  <p>The more parameters a method has, the more complex it is. Limit the
  number of parameters you need in a given method, or use an object to
  combine the parameters.</p>
</blockquote>

<p>Above quote is from this blog post.
<a href=""http://www.codinghorror.com/blog/2006/05/code-smells.html"" rel=""nofollow"">Code Smells</a></p>

<p>Thanks.</p>
","<c#><.net><visual-studio-2010><refactoring>","2","295","2011-07-21 08:18:01"
"6792124","Need tools which will refactor the C# code for null checks","<p>Can anyone suggest me for automating the null check refactoring in C# code? The actual problem is, I have a C# console application with 500 files where in each file contains so main IF-ELSE conditional statement for user-defined objects. Now, I need to put null checks for all the objects(also nested objects) used in these IF-ELSE conditional statements.</p>

<p>To achieve this, I need a tool which will place the null checks automatically. Please suggest me with any tool which will solve my problem.</p>

<p>Thanks in Advance</p>
","<c#><visual-studio-2010><null><check><automated-refactoring>","2","159","2011-07-22 15:14:42"
"6794036","How to consolidate $.load() functions in jQuery","<p>I have code pulling in pieces of content from another page on my domain using the hashtag to target the correct div like so: <code>$('#content').load('http://www.mysite.com/Default.aspx #homeText');</code></p>

<p>I have to grab 5 different div's from a single page, and rather than call the $.load() function 5 times, is there a more efficient way that wont require 5 different calls to the same page. I assume there is a way to parse the incoming page, but I'm not sure what the best way would be. Any suggestions?</p>
","<jquery><refactoring><load>","1","29","2011-07-22 17:50:09"
"6796523","Use of return in long if-elseif-else statements (Python)","<p>I am using Python for my example, but my question is referring to programmming languages in general.</p>

<pre><code>def some_function(eggs):
    if eggs == 1:
        do_something_1()
    elif eggs == 2:
        do_something_2()
    elif eggs == 3:
        do_something_3()
    else:
        do_error()
        return
    do_something_4()
    do_something_5()
    do_something_6()
</code></pre>

<p>(This is just an example. My functions will not be called <code>do_something_x</code>.)</p>

<p>Would putting a return in the else like this be a bad programming practice? Would it be a better idea to put</p>

<pre><code>do_something_4()
do_something_5()
do_something_6()
</code></pre>

<p>in each of the if/elifs?</p>
","<python><coding-style><refactoring><if-statement>","4","236","2011-07-22 21:54:41"
"6816781","How to automatically replace arguments in a method and all its invocations","<p>Suppose I have a Java method:</p>

<pre><code>void method(int a, int b) {}
</code></pre>

<p>and lots of places where it is called:</p>

<pre><code>method(10, 12);
method(33, 44); 
...
</code></pre>

<p>How would you automatically refactor arguments replacing to achieve the following result?:</p>

<pre><code>void method(int b, int a) {}
method(12, 10);
method(44, 33); 
...
</code></pre>

<p>Note: I am looking for a generic solution handling all cases of methods and arguments and prefer using Eclipse tooling.</p>

<p><strong>Edit:</strong> Is there a way to do it programmatically for a set methods matching given criteria from various classes?</p>
","<java><eclipse><refactoring>","1","51","2011-07-25 13:22:40"
"6817140","How to inverse type parameters in Java","<p>I have a class <code>A&lt;X, Y&gt;</code> and I want to refactor it to <code>A&lt;Y, X&gt;</code> in a way that all the references to it would be modified as well.</p>
","<java><eclipse><refactoring>","9","117","2011-07-25 13:49:45"
"6817960","C99: cast double to struct?","<p>In the huge (millons of LOC) C project I want to expand a ""double"" type into a struct containing two doubles:</p>

<p>Now I have</p>

<pre><code>typedef double popular_type;
//... a lot (&gt;1k) usage of the type in expressions like:
popular_type a;
a = (popular_type) some_double_variable;
</code></pre>

<p>I want to change popular_type definition into</p>

<pre><code>#ifdef SYNTHETIC_POPULAR_TYPE
typedef struct {
  double orig_field;
  double additional_field;
} popular_type;
#else
typedef double popular_type;
#endif
</code></pre>

<p>If I do not change the expressions like </p>

<pre><code>popular_type a;
a = (popular_type) some_double_variable;
</code></pre>

<p>to </p>

<pre><code>popular_type a;
a.orig_field = some_double_variable;
</code></pre>

<p>will the program work?</p>

<p>How can I redeclare <code>popular_type</code> in order that I do not have to change all assignments?</p>
","<c><casting><refactoring>","2","137","2011-07-25 14:50:06"
"6832825","Additional Refactoring for Eclipse CDT","<p>Is there any way to configure or are there any 3rd party plug-ins available for Eclipse CDT (any version) that provide a rich set of refactorings?  My refactoring menu only provides the following in Eclipse Indigo CDT:</p>

<ul>
<li>Rename</li>
<li>Extract Constant</li>
<li>Extract Local Variable</li>
<li>Extract Function</li>
<li>Toggle Function Definition</li>
<li>Hide Method...</li>
</ul>

<p>I am looking for something with the richness of either the Java refactorings:</p>

<p><a href=""http://help.eclipse.org/galileo/index.jsp?topic=/org.eclipse.jdt.doc.user/concepts/concept-refactoring.htm"">http://help.eclipse.org/galileo/index.jsp?topic=/org.eclipse.jdt.doc.user/concepts/concept-refactoring.htm</a></p>

<p>Or something like what DevExpress Refactor Pro offers:</p>

<p><a href=""http://www.devexpress.com/Products/Visual_Studio_Add-in/Refactoring/"">http://www.devexpress.com/Products/Visual_Studio_Add-in/Refactoring/</a></p>

<p>Note that the DevExpress plug-in is not compatible with Eclipse.  I am more than willing to pay for a good 3rd party plug-in (it just needs to support C++ in Eclipse).</p>
","<c++><eclipse><eclipse-plugin><refactoring><eclipse-cdt>","28","872","2011-07-26 15:48:27"
"6825365","Delphi 2010 - weird behaviour using refactoring->extract methode","<p>Im facing this issue when i try to extract a methode in the if statement. i couldnt find any reported bug on it.</p>

<pre><code>procedure TForm1.BitBtn3Click(Sender: TObject);
var
  x: integer;
  b: boolean;
begin
  if true then
    x := 8    //********************** i try to extract this line
  else
    x := 6;

  showmessage(inttostr(x));
end;
</code></pre>

<p>the result i get is:</p>

<pre><code>procedure TForm1.BitBtn3Click(Sender: TObject);
var
  x: integer;
  b: boolean;
begin
  if true then
    newMethode
  else
    x := 6;

  showmessage(inttostr(x));
end;
</code></pre>

<p>and the new Methode is:</p>

<pre><code>procedure TForm1.newMethode;
var
  x: Integer;
begin
  x := 8;
end;
</code></pre>

<p>Can anybody check how is the behaviour on Delphi XE? anybody knows if it was reported?</p>
","<delphi><refactoring><delphi-2010><bugs>","6","161","2011-07-26 04:46:48"
"6826225","Help improving (refactoring) my code. Automapper - EF - asp.net mvc-3","<p>I have this 4 models -  2 Domain Models and 2 DTOs</p>

<pre><code>public class Project
    {
        public int ID { get; set; }
        public string Name { get; set; }
        public virtual ICollection&lt;Task&gt; Tasks { get; set; }
    }

    public class Task
    {
        public int ID { get; set; }
        public virtual int ProjectID { get; set; }
        public string Name { get; set; }
        public virtual Project Project { get; set; }
    }

    public class ProjectDTO
    {
        [Required]
        public string Name { get; set; }
        public List&lt;TaskDTO&gt; Tasks { get; set; }
    }

    public class TaskDTO
    {
        [Required]
        public string Name { get; set; }
        public int ID { get; set; }
        public bool MarkRemove { get; set; }
    }
</code></pre>

<p>Heres my automapper configuration</p>

<pre><code>Mapper.CreateMap&lt;Project, ProjectDTO&gt;();
Mapper.CreateMap&lt;ProjectDTO, Project&gt;().ForMember(p =&gt;p.ID, opt=&gt;opt.Ignore()).ForMember(p=&gt;p.Tasks, opt=&gt;opt.Ignore());
Mapper.CreateMap&lt;Task, TaskDTO&gt;();
Mapper.CreateMap&lt;TaskDTO, Task&gt;().ForMember(task=&gt;task.ProjectID, opt=&gt;opt.Ignore()).ForMember(task=&gt;task.Project, opt=&gt;opt.Ignore());
</code></pre>

<p>Heres my HttpPost Edit action</p>

<pre><code>[HttpPost]
        public ActionResult Edit(int id, ProjectDTO p)
        {
            if (ModelState.IsValid)
            {
                var dbProject = db.Projects.Where(pr =&gt; pr.ID == id).Single();
                Mapper.Map(p, dbProject);
                foreach (var task in p.Tasks)
                {
                    Task dbTask;
                    try
                    {
                        dbTask = dbProject.Tasks.Where(t =&gt; t.ID == task.ID).Single();
                    }
                    catch
                    {
                        dbTask = new Task();
                        Mapper.Map(task, dbTask);
                        dbProject.Tasks.Add(dbTask);
                    }
                    if (task.MarkRemove)
                    {
                        db.Tasks.Remove(dbTask);
                    }
                    else {
                        Mapper.Map(task, dbTask);                    
                    }                  
                }
                db.Entry(dbProject).State = EntityState.Modified;
                db.SaveChanges();                
                TempData[""Success""] = ""Modelo Valido"";
                return RedirectToAction(""Index"");
            }
            return View(p);
        }
</code></pre>

<p>Im not completely happy with this but I dont think there is a much cleaner approach to handling this somewhat complex scenario....</p>

<p>now that it is working I would like to at least refactor this to use repository pattern or something in a way that the controller action is not that convoluted.. this will eventually be production code :s </p>

<p>can anyone give me some advice on how to refactor this?
please help.</p>
","<asp.net-mvc><entity-framework><refactoring><automapper>","0","294","2011-07-26 06:39:21"
"6838930","Problem with refactoring some legacy code","<p>So I was trying to refactor this <code>SomeClass</code> that has lots of different responsibilities. The shown above method seemed like a good place to start trimming down this class, so I thought about putting it in a IO specific class (and to easily allowing mocking, when needed).</p>

<pre><code>class SomeClass{

    ...

    public void m() {
        ...
        emptyDirectory(something);
        ...
    }

    private void emptyDirectory(File dir) {
        File[] dirContent = dir.listFiles();

        if (dirContent != null)
            for (File f : dirContent) {
                if (f.isDirectory())
                    emptyDirectory(f);

                try {
                    if (!f.delete()) {
                        IOError problem = new IOError(symbolTable.getRefinement().getFileName(),
                                f.toString(), f.isDirectory());

                        problemManager.add(problem);
                    }
                } catch (SecurityException e) {
                        IOError problem = new IOError(symbolTable.getRefinement().getFileName(),
                            f.toString(), f.isDirectory());

                    problemManager.add(problem);
                }
            }
        }
    }
}
</code></pre>

<p>The problem is that our system has a error logging mechanism that works just like a compiler's one (it will report the error but everything should continue its work. when you try to compile a program, it won't stop the compilation process on the first time it encounters an error).</p>

<p>I'd like to have my IO class agnostic about this error reporting thing, so my idea was to throw exception from the IO method and then have <code>m()</code> catching it and doing the rest of the error handling. The problem is that both the <code>IOException</code> and <code>SecurityException</code> won't tell me what the name of the file is.</p>

<p>I know I could create an exception of my own, but if I start creating exceptions of my own for such simple things, I'll have to create hundreds of exceptions for the rest of my code, also! </p>

<p>I'd like to keep the refactor as simple as possible.</p>

<p>How would you deal with refactoring?</p>
","<c#><java><oop><refactoring><refactor-my-code>","0","102","2011-07-27 02:46:31"
"6839730","Case study on refactoring an existing .NET app to use interfaces?","<p>I am looking for a case study or tutorial on how to take an existing .NET app which doesn't use interfaces and refactor it to using interfacing. The before case where programming was against implementation to programming against interfaces.</p>

<p>I am looking for a full app with source code which has gone through this process. I am not looking for little examples or little code samples but an app that was redesigned for loose coupling. Again.. I want the before and after source code.</p>
","<.net><refactoring><case-study>","-1","46","2011-07-27 05:17:42"
"6848393","DRYing rails view: partial vs helper","<p>I need an advice on good practice in DRYing view's code.
I have three classes (NewsItem, RssItem and BlogItem) in my app, that use separate views, but have similar parts in them. One of this parts is such:</p>

<pre><code>&lt;% if current_user %&gt;
&lt;footer&gt;
  &lt;%= marks_bar(@item) %&gt;
  &lt;%= favorite_button(@item, ""blog_item"") || delete_from_favorite_button(@item, ""blog_item"") %&gt;
  &lt;%= share_button(@item) %&gt;
  &lt;% if current_user.is_mine?(@item) %&gt;
    &lt;div&gt;&lt;%= link_to ""Edit"", edit_user_blog_item_path(current_user, @item) %&gt;&lt;/div&gt;
  &lt;% end %&gt;
&lt;/footer&gt;
&lt;% end %&gt;
</code></pre>

<p>It's almost equal for all three classes, so I decided to take it out to some separate place. And here I am confused: should I use partial or helper method for it?
I know, that helpers are used mostly for separating ruby code from HTML, but in this case helper will look like:</p>

<pre><code>def toolbar_for(item, type_str, edit_path)
  if current_user
    content_tag(:footer) do |b|
      marks_bar(item).to_s &lt;&lt;
      (delete_from_favorite_button(item, type_str) || favorite_button(@item, type_str)).to_s &lt;&lt;
      share_button(@item).to_s &lt;&lt;
      (content_tag(:div) { link_to(""Edit"", edit_path)} if current_user.is_mine?(@item)).to_s
    end
  end
end
</code></pre>

<p>So, there is almost no HTML code here.</p>

<p>Could you please give me advise, what method is better in your opinion and why? Also, are there some performance issues in this methods (for example multiple String concatenation or frequent partial loading can be long or memory costly)? (This app is rather high-loaded)</p>
","<ruby-on-rails><view><refactoring><dry>","3","334","2011-07-27 17:09:12"
"6871588","what is the best way to avoid duplication on this code","<p>i have the following methods:</p>

<pre><code>    public  int CountProperty1
    {
        get
        {
            int count = 0;
            foreach (var row in Data)
            {
                count = count + row.Property1;
            }
            return count ;
        }
    }

    public  int CountProperty2
    {
        get
        {
            int count = 0;
            foreach (var row in Data)
            {
                count = count + row.Property2;
            }
            return count ;
        }
    }
</code></pre>

<p>what is the best way to avoid duplication here and share as much code as possible </p>
","<c#><refactoring>","4","117","2011-07-29 10:12:13"
"6864766","Can we replace if statement with an object in C#","<p>Below is a method:</p>

<pre><code>  private RiskFactor calculateMotoristRiskFactor()
    {               

        if (motorist.PointsOnLicense &gt; 3
        || motorist.Age &lt; 25)

            return RiskFactor.HighRisk;
        if (motorist.PointsOnLicense &gt; 0)
            return RiskFactor.ModerateRisk;

        return RiskFactor.LowRisk;
    }
</code></pre>

<p>I don't want those if statements. </p>

<p>Can I use strategy pattern to solve this?
If yes then too I don't want each method in the different polymorphic class should have an <strong>If statement</strong> in it. </p>

<p>RiskFactor is an Enum</p>

<p>Any better way to make this more object oriented instead of procedural?</p>
","<c#><oop><refactoring>","3","250","2011-07-28 19:49:42"
"6879958","Using Xcode for generic C/C++ development","<p>I'd like to use all the power of Xcode for generic C/C++ projects but I can't figure out what are the basic steps to configure a new Xcode project and <em>attach</em> it to an existing source tree of a legacy, plain, C/C++ project.</p>

<p>Creating a new empty project, attaching it to a source tree and configuring a build target (using GNU Make) was a really silly task.</p>

<p>I can't figure out how to enable source code indexing in order to enable source refactoring tools, searching and fast-jumping and all the amenities that makes the Xcode programmer's life great.
Moreover I'd like to use the internal debugging facilities…</p>

<p>Does anyone point me to a tutorial, a hint or whatever could be useful?</p>

<p>Thanx</p>
","<xcode><configuration><refactoring>","1","135","2011-07-29 23:13:40"
"6880704","Mass rename of classes solving references in Smalltalk with the Refactoring Browser","<p>I want to rename all classes starting with the prefix SMP to RS, including references in source code (direct ones like SMPClass1 and indirect ones like Smalltalk at: #SMPClass2) and in class and method comments. Can the current RBParseTreeRewriter do this?
An equivalent without the parse tree rewriter would be:</p>

<pre><code>Smalltalk allClassesDo: [ :class |
(class name beginsWith: 'SW2')
    ifTrue: [ class rename: 'PR' , (class name allButFirst: 3) ] ].
</code></pre>
","<refactoring><smalltalk><pharo><automated-refactoring>","1","52","2011-07-30 02:24:22"
"6887180","Is there an equivalent to Google Closure's optimisations for javascript, for Java?","<p>We see in the following blog entry: <a href=""http://blog.fogus.me/2011/07/21/compiling-clojure-to-javascript-pt1/"" rel=""nofollow"">http://blog.fogus.me/2011/07/21/compiling-clojure-to-javascript-pt1/</a> some pretty incredible syntax transformations, simplifications done to the javascript programming language, done by the Google Closure compiler. </p>

<p>My question is - is there something that provides these kinds of syntactic transformations for Java?</p>
","<java><optimization><refactoring><compiler-optimization><google-closure-compiler>","3","162","2011-07-31 02:31:18"
"6893561","using REPLACE INTO for both new items and edited items?","<p>This refactor seems workable in my head, but I'd like someone to check my logic:</p>

<p>Current process:</p>

<pre><code>if (item == new) {
    INSERT INTO basic_table
    $itemUID = get last insert ID // item's UID
    INSERT INTO another_table // more stuff
    INSERT INTO another_table2 // more stuff
    INSERT INTO another_table3 // more stuff
} else {
    $itemUID = $_POST['uid']
    UPDATE basic_table
    REPLACE INTO another_table // more stuff
    REPLACE INTO another_table2 // more stuff
    REPLACE INTO another_table3 // more stuff
}
</code></pre>

<p><em>(note -  <strong>REPLACE INTO</strong> is used for existing items because they may or may not have entries in all the tables, depending on their initial configuration)</em></p>

<p>It occurred to me that since all the follow-on queries are identical except for <code>INSERT INTO // REPLACE INTO</code>, I should be able to refactor as:</p>

<pre><code>if (item == new) {
    INSERT INTO basic_table
    $itemUID = get last insert ID // item's UID
} else {
    $itemUID = $_POST['uid']
    UPDATE basic_table
}
    REPLACE INTO another_table // more stuff
    REPLACE INTO another_table2 // more stuff
    REPLACE INTO another_table3 // more stuff
</code></pre>

<p>Considering that I'm using PDO and each of those queries has lots of parameters, this would save a <em>crapload</em> of space.</p>

<p>But I wanted to post it here first, to make sure I'm not overlooking something.</p>

<p>Would this refactoring produce the same result?</p>
","<php><mysql><refactoring><pdo>","2","84","2011-08-01 01:48:30"
"6895883","Moving old system to ORM, what do you suggest?","<p>What do I have:</p>

<ul>
<li>MySQL</li>
<li>PHP 5.2</li>
<li>stupid handmade ORM</li>
<li>Code is in classes</li>
<li>old-type mysql connection (without PDO, without mysqli)</li>
<li>Master DB and multiple slave DBs</li>
<li>slave DBs have a subset of tables from main DB</li>
<li>User authorises through master DB and, depends on settings, can keep using main DB or can be switched to slave DB (but even on slave DB some queries are to the main DB)</li>
<li>Load average is high enough</li>
<li>tables are big</li>
<li>we frequently change our table structure</li>
</ul>

<p>When project was small, it was simple to support system, but now project grows very fast and it's not easy task to update the code.</p>

<p>So, what would you suggest?</p>

<p>Which ORM would best fit my needs knowing that project is big and it's nearly impossible to move all parts to the new base at once? (I was thinking about Doctrine, Propel, or something from that side)</p>
","<php><mysql><orm><refactoring>","0","58","2011-08-01 08:30:04"
"6884815","Refactoring require_once file in a project","<p>I'm a beginner in PHP. And i'm working on project with this directories hierarchy : <code>model</code>, <code>control</code>, <code>view</code> and <code>helper</code> folders are in my project folder</p>

<p>Now i'm trying to write a file <code>init.php</code> and <code>require_once</code> it in each of <code>control</code> and <code>model</code> files, here's my <code>init.php</code></p>

<pre><code>&lt;?php

    $current_dir = basename(getcwd());
    $model_dir = ""model"";
    $helper_dir = ""helper"";

    function require_helper(){
        $handle = opendir(""../{$helper_dir}"");
        while($file = readdir($handle)){
        if($file != ""."" &amp;&amp; $file != ""..""){
                require_once ""../{$helper_dir}/{$file}"";
            }
        }
    }

    if($current_dir == ""control""){
        $handle = opendir(""../{$model_dir}"");
        while($file = readdir($handle)){
            if($file != ""."" &amp;&amp; $file != ""..""){
                require_once ""../{$model_dir}/{$file}"";
            }
        }

        require_helper();

    } elseif( $current_dir == ""model"") {
        $handle = opendir($current_dir);
        while($file = readdir($handle)){
            if($file != ""."" &amp;&amp; $file != ""..""){
                require_once ""{$file}"";
            }
        }

        require_helper();
    } 
?&gt;
</code></pre>

<p>But when i test my project i get this error :</p>

<blockquote>
  <p>Notice: Undefined variable: session in C:\wamp\www\harmony\control\login.php on line 11</p>
</blockquote>

<p>Here's my <code>login.php</code> file :</p>

<pre><code>&lt;?php
    require_once ""../helper/init.php"";
?&gt;

&lt;?php

    if(isset($_GET[""logout""]) &amp;&amp; $_GET[""logout""] == ""true"" ){
        $session-&gt;logout();
    }

    if($session-&gt;is_logged_in()){
        redirect_to(""../view/index.php""); 
    }

    if(isset($_POST[""submit""])){
        $username = $db-&gt;escape_value($_POST[""username""]);
        $password = $db-&gt;escape_value($_POST[""password""]);
        $password = hash('sha1' , $password);
        $arr = User::auth($username , $password);
        if($arr){
            $usr = $db-&gt;instantiate($arr);            
            $session-&gt;login($usr);
        } else {
            Session::notify(""Invalid login information."");
        }
    }    

?&gt;
</code></pre>

<p>So could you help me please ? what's wrong is going on ?</p>
","<php><refactoring><error-message><undefined><require-once>","0","123","2011-07-30 17:33:15"
"6897691","Refactoring Java Servlets - Looking for a good naming scheme","<p>I'm refactoring an existing (Ajax) Java Web application, which currently holds lots of its logic directly in the servlets. (The servlets even call each other, using a few nasty tricks ...)</p>

<p>The refactoring itself is painful, but pretty much straightforward (refactoring everything to use Dependency Injection now). </p>

<p>My problem is, that I really can't come up with the perfect naming scheme:</p>

<p>The refactored Servlets are now holding just a minimum amount of logic (just so much that they process the ServletRequest and ServletResponse, send an HTTP error code, etc.), then they call what I currently refer to as <strong>Processors</strong> (good/bad name?!?), which can be reused by several Servlets, Test classes, ... The processors perform the logic required for the action, similar to what a Session Bean would do if we were using EJBs.</p>

<p>I never thought, that ""Session Bean"" would be a good name anyway. And I'm also not very keen on defining a monolithic ""Facade"". I'm looking primarily for a better name than ""Processor"", or maybe some ideas how <em>you</em> structure your Servlet processing code.</p>

<h2>Example</h2>

<p>This is a simplified example (the real application uses GWT with Gilead, ... but that's not so important):</p>

<pre><code>public class UserRegistrationServlet extends HttpServlet {

@Inject
UserRegistrationProcessor userRegistrationProcessor;

@Override
protected void doPost(final HttpServletRequest req, 
        final HttpServletResponse resp)
        throws ServletException, IOException {

    RegistrationRequest registrationRequest = parseRegistrationRequest(req);

    RegistrationResult registrationResult = 
                userRegistrationProcessor.process(registrationRequest);

    pw.print(toJson(registrationResult));

    ...
}
}
</code></pre>

<p>As the example suggests, I prefer to have specialized processors, which are responsible for one task only (or maybe a few very strongly related tasks) - opposed to a big class that handles lots of different actions.</p>
","<java><design-patterns><servlets><refactoring>","2","253","2011-08-01 11:23:50"
"6908404","find and remove duplicate code","<p>I am managing a group of three interns working on a php project. They seem to be not good at refactoring and are using duplicate code in multiple places. I am looking for a tool which I can use to find this duplicate code so I can show them.</p>

<p>This would make my job easier, and the project more elegant and less prone to errors. Any leads?</p>
","<web-development><refactoring><code-duplication>","1","131","2011-08-02 07:07:23"
"6904519","Refactoring automatically source java code NOT jar","<p>i have a question for you all! I have a complex java program and i need to rename possibly automatically all names of classes and methods. This is done in a very good way by PRoguard but can be applied only to jar then i will have to decompile. Can do that directly on the source code?</p>
","<java><refactoring><obfuscation>","0","87","2011-08-01 21:11:22"
"6917594","Is there any benefit to this refactoring?","<p>There is a class that defines primary keys in various tables by having 1 <code>string[]</code> variable per table. For example:</p>

<pre><code>static string[] my_table_foo_TablePrimaryKeys = new string[] { ""primary_key1"", ""primary_key2"" }
static string[] my_table_bar_TablePrimaryKeys = new string[] { ""user_id"", ""customer_number"" }
</code></pre>

<p>I find this to be a bit messy and less extensible for cases where we add a 3rd table later and we want to come back to this class to define the primary keys for that new 3rd table. So, I refactored it to look like this:</p>

<pre><code>    static Dictionary&lt;string, string[]&gt; tablePrimaryKeys = new Dictionary&lt;string, string[]&gt;()
    {
        {""my_table_foo"", new string[] { ""primary_key1"", ""primary_key2"" }},
        {""my_table_bar"", new string[] { ""user_id"", ""customer_number"" }}
    };
</code></pre>

<p>Would you guys consider this a decent refactoring change? Why?</p>

<p>In addition, it also is a little cleaner in my humble opinion where the primary keys are referenced. Example:</p>

<p>In the former case:</p>

<pre><code>DoStuffWithPrimaryKeys( my_table_foo_TablePrimaryKeys, ""other stuff"", 1000 );
</code></pre>

<p>And in the latter case:</p>

<pre><code>string[] keys = tablePrimaryKeys[""my_table_foo""];
DoStuffWithPrimaryKeys( keys, ""other stuff"", 1000 );
</code></pre>

<p>If anyone also wants to mention what the principles are for ""acceptable refactoring"" and how to know what is acceptable to refactor and what is not, that would be great and very educational.</p>

<p>I'm using C# and .NET 3.5.</p>
","<c#><refactoring>","0","71","2011-08-02 19:38:03"
"6921681","Problem with removing ""if"" statement","<p>Hi,</p>

<p>I'm trying to find way how to improve this code.
I would like to remove ""if"" statement from CreateAttributes method.
The main idea of this method to add attribute to list if this attribute satisfies some conditions</p>

<pre><code>  internal class FildMap
  {
    public string ExactTargetFild { get; set; }
    public string DbFild { get; set; }     
    public Type Type { get; set; }
  }

  internal static class FildMapProcessor
  {
    private static readonly List&lt;FildMap&gt; Map = new List&lt;FildMap&gt;();

    static FildMapProcessor()
    {
      if(Map.Count == 0)
      {
      Map.Add(new FildMap {ExactTargetFild = ""Address 1"", DbFild = ""Address1"", Type = typeof (string)});
      Map.Add(new FildMap { ExactTargetFild = ""Date of birth"", DbFild = ""DateOfBirth"", Type = typeof(DateTime) });
      Map.Add(new FildMap { ExactTargetFild = ""Wine Beer"", DbFild = ""pref_WineBeerSpirits"", Type = typeof(bool) });
      .........
      }
    }

    public static Attribute[] CreateAttributes(this DataRow row)
    {
      var attributes = new List&lt;Attribute&gt;();
      foreach (var item in Map)
      {
        if (item.Type == typeof(string))
        {
          var value = row.Get&lt;string&gt;(item.DbFild);
          if (value != null)
            attributes.Add(new Attribute{Name = item.ExactTargetFild, Value = value});
        }

        if (item.Type == typeof(DateTime))
        {
          var value = row.Get&lt;DateTime&gt;(item.DbFild);
          if (value != DateTime.MinValue)
            attributes.Add(new Attribute { Name = item.ExactTargetFild, Value = value.ToString(""dd/MM/yyyy"") });
        }

        if (item.Type == typeof(bool))
        {
          if (row.Contains(item.DbFild))
          {
            var value = row.Get&lt;bool&gt;(item.DbFild);
            attributes.Add(new Attribute { Name = item.ExactTargetFild, Value = value.ToString() });
          }
        }
      }

      return attributes.ToArray();
    }
  }
</code></pre>

<p>Thanks,</p>
","<c#><refactoring>","2","225","2011-08-03 04:36:06"
"6926998","Loading files that meet certain criteria into hidden buffers in vim","<p>I'd like to do some code refactoring in vim. I have found the following gem to apply transformations to all buffers.</p>

<p><code>:dobuf %s/match/replace/gc</code></p>

<p>My code is layed out with the root directory having a directory for the dependencies and a build directory. I want to load all .cc , .h and .proto files from ./src ./include and ./tests. But not from the dependencies and build directories, into background/hidden buffers. I want to do this to do the refactor using the command above.</p>

<p>If someone knows of a cleaner way to perform the use case, please show it. </p>

<p>Note: <a href=""http://stackoverflow.com/questions/4804405/search-and-replace-in-vim-across-all-the-project-files"">I know you can string together <code>find</code> and <code>sed</code> to do this from the shell</a>, however I prefer doing it in vim , if at all possible. The /gc prefix in the pattern I presented above serves the role of confirming replacements on each match, I need this functionality as often I don't want to replace certain matches, the <code>find</code> and <code>sed</code>solution is too restrictive and finicky when attempting my use-case, it is also easy to destroy files when doing in-place replacements.</p>

<p>For reference using sed and find:</p>

<p>List candidate replacements:</p>

<pre><code>find src include tests -name *.h -or -name *.cc -or -name *.proto| 
xargs sed -n 's/ListServices/list_services/p'
</code></pre>

<p>Perform replacements:</p>

<pre><code>`find src include tests -name *.h -or -name *.cc -or -name *.proto| 
xargs sed -i 's/ListServices/list_services`'
</code></pre>
","<c++><vim><refactoring><programming-techniques>","2","128","2011-08-03 13:13:34"
"6949483","Looking for specific Visual Studio 2010 add-in for refactoring","<p>I'm looking for an add-in, preferably free, that would reorganize my messy order of fields, properties, methods and place them into contextual region tags such as: Private Fields, Properties, Static Methods, Internal Methods, Events, etc.
I've seen this somewhere once, but I can't find it anywhere now.
Please help.</p>
","<visual-studio><refactoring><add-in>","1","103","2011-08-04 22:40:57"
"6951388","Having Eclipse automatically try to add imports on bunch of .java files","<p>I know I can open a given file, and hitting <code>CTRL + SHIFT + M</code>, it will add the import associated with the class I have currently my cursor over.</p>

<p>I'm making some big refactoring over my project and I decided to replace all the references to the <code>File</code> class to a <code>Filename</code> class of my own. As the system contains maybe hundreds of classes, this is being a nightmare to handle. I've replaced with <code>Search and Replace</code> all the references of <code>File</code> to <code>Filename</code>, but now I have problems with imports all over the place.</p>

<p>What would be the easier way to accomplish my task other than having to open all the files and manually add the import to the <code>Filename</code> class while removing the old import of <code>File</code> ?</p>

<p>Also, is there an easier way to replace a used class in your project (this case, the <code>File</code> class) by another one other than using <code>Search and Replace</code>?</p>
","<java><eclipse><refactoring>","0","133","2011-08-05 04:20:35"
"6945169","Refactoring advice: How to avoid type checking in this OO design","<p>I'm looking for advice on refactoring to improve my class design and avoid type checking.</p>

<p>I am using the Command design pattern to construct a menu tree. An item in the menu could be of various types (e.g., an immediate action [like ""Save""], a toggle on/off property which displays with check/icon depending on its state [like ""italics""], etc.). Crucially, there are also submenus, which <em>replace</em> (rather than displaying off to the side of) the current menu on the screen. These submenus of course contain their own list of menu items, which could have more nested submenus.</p>

<p>The code is something like (all public for simplicity in presentation):</p>

<pre><code>// Abstract base class
struct MenuItem
{
  virtual ~MenuItem() {}
  virtual void Execute()      = 0;
  virtual bool IsMenu() const = 0;
};

// Concrete classes
struct Action : MenuItem
{
  void Execute() { /*...*/ }
  bool IsMenu() const { return false; }
  // ...
};

// ... other menu items

struct Menu : MenuItem
{
  void Execute() { /* Display menu */ }
  bool IsMenu() const { return true; }
  // ...
  std::vector&lt;MenuItem*&gt; m_items;
  typedef std::vector&lt;MenuItem*&gt;::iterator ItemIter;
};
</code></pre>

<p>The main menu is just an instance of Menu, and a separate class keeps track of the menu position, including how to go into and out of submenus:</p>

<pre><code>struct Position
{
  Position( Menu* menu ) 
    : m_menu( menu ) 
  {
    // Save initial position
    m_pos.push_back( MenuPlusIter( m_menu, m_menu-&gt;m_items.begin() ) );
  }

  // Ignore error conditions for simplicity
  void OnUpPressed()   { m_pos.back().iter--; }
  void OnDownPressed() { m_pos.back().iter++; }
  void OnBackPressed() { m_pos.pop_back();    }

  void OnEnterPressed()
  {
    MenuItem* item = *m_pos.back().iter;
    // Need to behave differently here if the currently 
    // selected item is a submenu
    if( item-&gt;IsMenu() )
    {
      // dynamic_cast not needed since we know the type
      Menu* submenu = static_cast&lt;Menu*&gt;( item );

      // Push new menu and position onto the stack
      m_pos.push_back( MenuPlusIter( submenu, submenu-&gt;m_items.begin() ) );

      // Redraw
      submenu-&gt;Execute();
    }
    else
    {
      item-&gt;Execute();
    }
  }

private:
  struct MenuPlusIter
  {
      Menu*          menu;
      Menu::ItemIter iter;

      MenuPlusIter( Menu* menu_, Menu::ItemIter iter_ )
          : menu( menu_ )
          , iter( iter_ )
      {}
  };

  Menu* m_menu;
  std::vector&lt;MenuPlusIter&gt; m_pos;
};
</code></pre>

<p>The key function is Position::OnEnterPressed(), where you see an explicit type check in the call to MenuItem::IsMenu() and then a cast to the derived type. What are some options to refactor this to avoid the type check and cast?</p>
","<c++><object><refactoring><type-conversion><dynamic-cast>","2","194","2011-08-04 16:35:03"
"6945002","How to refactor almost duplicate methods with generic types","<p>I have a few methods that are practically the same except they have a different number of generic type parameters. Inner code is very very similar:</p>

<pre><code>public Set[] CreateSet&lt;TFirst, TSecond&gt;(List&lt;TFirst&gt; first, List&lt;TSecond&gt; second)
{
    Set[] result = new Set[2];
    result[0] = CreateSet(first);
    result[1] = CreateSet(second);
    return result;
}

public Set[] CreateSet&lt;TFirst, TSecond, TThird&gt;(List&lt;TFirst&gt; first, List&lt;TSecond&gt; second, List&lt;TThird&gt; third)
{
    Set[] result = new Set[3];
    result[0] = CreateSet(first);
    result[1] = CreateSet(second);
    result[2] = CreateSet(third);
    return result;
}

...
</code></pre>

<p>And so on. I have these methods up to 7 generic type parameters. As you can see they're practically all the same except that they create a different size array of sets.</p>

<p><strong>I don't like this code duplication so would it be possible to refactor this code into a single private method that these would internally call.</strong> Or should I consider any other way of doing this?</p>
","<generics><.net-3.5><c#-3.0><refactoring>","0","78","2011-08-04 16:23:23"
"6993137","Is there an alternative to switching in a factory method?","<p>I see this quite a lot and I was wondering if there was a way to refactor this nicely to avoid the massive switch?  This is a method in a factory: RoomControllerFactory,  instantiating a game location based on its type. Here's an example from a switch in the factory method:</p>

<pre><code>            switch (location.getType())
            {
               case Location.ROOMONE:
                    return new RoomOneController(location, data, view);         

                case Location.ROOMTWO:
                    return new RoomTwoController(location, data, view);

                case Location.ROOMTHREE:
                    return new RoomThreeController(location, data, view);
</code></pre>
","<actionscript-3><design-patterns><refactoring>","4","119","2011-08-09 08:05:46"
"7026249","UML time visualisation","<p>I'm sure many of you have used or at least heard of Gource and Code Swarm.  They are very nice tools for visualising the commit history of a project as it evolves.</p>

<p>What I am interested in is an similarly repo-driven animation of the code itself in UML form as it evolves over time.</p>

<p>I have put a great deal of work into refactoring and cleaning up the codebase of a project over the last 3 years and it would be really neat to be able to demo this in tangible form to management. Of course 'before' and 'after' diagrams would work, but where's the fun in that? :P</p>

<p>Does any such tool exist?  Specifically I am looking for ObjC++ but am interested in anything available in any language.  </p>

<p>Shout out any other tools that could make for a cool demo. Refactoring is sometimes hard to sell without having anything to show!</p>
","<refactoring><visualization>","1","29","2011-08-11 12:56:52"
"7041636","""Generic"" solution for primitive array?","<p>I have classes that for processing primitive array input: CharArrayExtractor for char[], ByteArrayExtractor for byte[], IntegerArrayExtractor for int[], ... </p>

<pre><code>public void CharArrayExtractor {

    public List&lt;Record&gt; extract(char[] source) {
        List&lt;Record&gt; records = new ArrayList&lt;Record&gt;();
        int recordStartFlagPos = -1;
        int recordEndFlagPos = -1;
        for (int i = 0; i &lt; source.length; i++) {
            if (source[i] == RECORD_START_FLAG) {
                recordStartFlagPos = i;
            } else if (source[i] == RECORD_END_FLAG) {
                recordEndFlagPos = i;
            }
            if (recordStartFlagPos != -1 &amp;&amp; recordEndFlagPos != -1) {
                Record newRecord = makeRecord(source, recordStartFlagPos,
                        recordEndFlagPos);
                records.add(newRecord);
                recordStartFlagPos = -1;
                recordEngFlagPos = -1;
            }
        }
    }
}

public void ByteArrayExtractor {

    public List&lt;Record&gt; extract(byte[] source) {
        // filter and extract data from the array.
    }
}

public void IntegerArrayExtractor {

    public List&lt;Record&gt; extract(int[] source) {
        // filter and extract data from the array.
    }
}
</code></pre>

<p>The problem here is that the algorithm for extracting the data is the same, only the types of input are different.  Everytime the algorithm changes, I have to change all of the extractor classes.</p>

<p>Is there a way to make extractor classes more ""generics""?</p>

<p>Best regards.</p>

<p><strong>EDIT</strong>: It seems that every suggestion so far is to use autoboxing to archive generic. But the number of elements of the array is often large, so I avoid using autoboxing.</p>

<p>I added more specific implementation of how the data is being extracted. Hope it will clarify something.</p>
","<java><arrays><refactoring><primitive-types>","6","311","2011-08-12 14:33:35"
"7043202","Rails: Helper Refactoring","<p>I have a helper which I feel is ridiculous, but I haven't been able to think of a way to improve it. Here's the helper in question:</p>

<pre><code># Shows Admin Menu Button
def admin_toggle_button
  if user_signed_in? &amp;&amp; ( current_user.has_role?(:admin) || ( @collection &amp;&amp; can?(:curate,@collection) ) )
    if session[:admin_menu] == :on
      link_to( 'Admin Tools', edit_shared_path(:admin_menu =&gt; :off), :remote=&gt;true, :class =&gt; 'selected', :id =&gt; 'admin_toggle_button', :title =&gt; 'Hide Admin Menu' )
    else
      link_to( 'Admin Tools', edit_shared_path(:admin_menu =&gt; :on), :remote=&gt;true, :id =&gt; 'admin_toggle_button', :title =&gt; 'Show Admin Menu' )
    end
  end
end
</code></pre>

<p>In my application's menubar I call <code>admin_toggle_button</code> and this helper determines whether or not that button should be present and what its state is.</p>

<p>For the admin menu button to be present there needs to be a logged-in user, and that user needs to be an administrator OR that user needs to be viewing a collection which he is allowed to curate (edit).</p>

<p><strong>My question is: Are helper methods like this normal -- ie do you find you need methods this complex from time to time -- or am I missing something? Can you suggest a way to improve this method?</strong> </p>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring><helper>","1","86","2011-08-12 16:21:12"
"7051814","Android: Refactoring XML files in Eclipse?","<p>Is there a way to easily rename XML files in Eclipse while developing for Android so that these changes are reflected in source code? </p>

<p>Right-clicking on the file in package view and selecting refactor->rename changes the file's name, but does not alter references to the file within the .java source files. </p>
","<android><xml><eclipse><refactoring>","2","336","2011-08-13 16:36:16"
"7061567","Refactoring a long servlet conditional","<p>I have a servlet which can accept upwards of two dozen different kinds of requests (called commands in the servlet).   A very large conditional was created to service to these requests structured like this:</p>

<pre><code>if (command.equals(""Command1""))
    doSomething();
else if (command.equals(""Command2))
    doSomethingElse();
else if (command.equals(""Command3))
    doThisOtherThing();
 ......
</code></pre>

<p>Is there a better way to write this code?    I'm reading a book on JUnit testing that suggests using polymorphism over conditionals but I just don't see how to do this in this example.    Does anyone have a better idea?</p>

<p>Thank you,</p>

<p>Elliott</p>
","<java><mvc><servlets><refactoring>","3","82","2011-08-15 03:51:12"
"7067128","How can I refactor these wrapper methods to get rid of duplicated code?","<p>The following two methods are used to wrap deserialization using Google Gson:</p>

<pre><code>public static &lt;T&gt; T Deserialize(String jsonData, Type t) {
    T obj = null;

    try {
        obj = new Gson().fromJson(jsonData, t);
    } catch (Exception e) {
        Log.e(DEBUG_TAG, e.getMessage());
    }

    return obj;
}

public static &lt;T&gt; T Deserialize(String jsonData, Class&lt;T&gt; toClass) {
    T obj = null;

    try {
        obj = new Gson().fromJson(jsonData, toClass);
    } catch (Exception e) {
        Log.e(DEBUG_TAG, e.getMessage());
    }

    return obj;
}
</code></pre>

<p>They are almost identical, but I can't figure out a smart way to get rid of the duplicated code.</p>

<p>Any suggestions?</p>
","<java><refactoring><gson><code-duplication>","1","94","2011-08-15 15:43:06"
"7067402","Automatic git commit between Red, Green and Refactor steps?","<p>I'm always interested in trying new things with my workflow, and I thought it might be an interesting experiment to automatically commit between red, green and refactor steps, but then manually squash the commits down once I finish a specific feature (and before pushing).</p>

<p>I was just wondering if anyone else has tried this before? I thought I read about this once, but I'm unable to find any references.</p>

<p>I'm hoping one benefit might be to focus more on committing often, as well as being able to see my workflow visually so that I can improve it. For example, before squashing I can see if my time between red and green is too long, or if the number of code changes I make is larger than necessary between each step.</p>

<p>I was going to implement this as a <a href=""https://github.com/guard/guard"" rel=""nofollow"">guard</a> plugin so that when I save a spec or library file, it runs the specs and commits the change with a commit message like:</p>

<pre><code>Green: 1621 examples, 0 failures, 2 pending (1659 tests/s, 0.0006 p/test)
</code></pre>

<p>The idea being that I could visually scan this when squashing and determine where to group the related Red/Green/Refactor commits by logical changes.</p>

<p>At worst I thought this might be a fun experiment, at best it might give me a different way of seeing how I work.</p>
","<git><refactoring><tdd><self-improvement><guard>","3","146","2011-08-15 16:02:23"
"7071605","Looking for a better way to express this javascript method","<pre><code>var previousZone = null;
//Evaluates whether the currently moused-over item is a RadDockZone.
//TODO: Make more understandable.
function TryGetZoneFromTarget(target) {

    //Done for performance. Comparing object types is slower than a string comparison on ID.
    if (target != null &amp;&amp; target.id &amp;&amp; target.id.indexOf(""RadDockZone"") != -1) {
        return $find(target.id);
    }

    if (!target.id) {
        return ""IGNORE"";
    }

    return null;
}

//Adds highlighting to the dockZones when the user is dragging objects to the screen.
//Clear the old dockZone as the user moves out of it, and color new ones as they move into it.
function OnClientDragging(sender, eventArgs) {
    var target = eventArgs.get_htmlElement();
    var currentZone = TryGetZoneFromTarget(target);

    if (currentZone == ""IGNORE"") return; //When the user moves the mouse too fast inside of a zone, the zone returns no ID but this is a red-herring.
                                         //Ignoring this prevents flickering where we temporarily remove the highlighting on a zone when not moving out of it.

    if (currentZone) {
        dockZoneDroppedOnID = currentZone.get_id();

        if (previousZone == null) {
            previousZone = currentZone;
            AddHighlighting(currentZone);
        }
        else if (previousZone != currentZone) {
            RemoveHighlighting(previousZone);
            previousZone = currentZone;
            AddHighlighting(currentZone);
        }
    }
    else {
        dockZoneDroppedOnID = """";
        if (previousZone != null) {
            RemoveHighlighting(previousZone);
            previousZone = null;
        }
    }
}
</code></pre>

<p>So,  I have a weird quirk which is making this method a lot uglier. When the client is dragging their mouse, if they drag too quickly, the target won't return an ID when it actually has one. This was resulting in flickering, I would remove and re-add highlighting when not moving through a zone. As such, I patched in this quick fix... but it's really bad.</p>

<p>What's a proper way of handling such a scenario in Javascript? Should I have an enumeration of three types... ""Zone"", ""NotZone"", ""Ignore"" and work from there? Or...? </p>

<pre><code>public class CormantRadListBox : RadListBox
{
    public CormantRadListBox()
    {
        EnableDragAndDrop = true;
        OnClientDragging = ""OnClientDragging"";
        OnClientDropping = ""OnClientDropping"";
        Sort = RadListBoxSort.Ascending;
        Skin = ""Web20"";
        Width = Unit.Percentage(100);
    }
}
</code></pre>
","<javascript><refactoring>","1","52","2011-08-15 22:35:14"
"7075972","refactoring PL/SQL","<p>I encountered the following PL/SQL code(variables modified) at work:</p>

<pre><code>PROCEDURE test(i_w IN a.w%type,o_result IN OUT resu_cur_type) IS
BEGIN
    IF i_w IS NULL THEN
      open o_result for SELECT a.x, b.y FROM a,b WHERE a.z=b.z;
    ELSE
      open o_result for SELECT a.x, b.y FROM a,b WHERE a.z=b.z AND a.w=i_w;
    END IF;
END test;
</code></pre>

<p>I think the above is equivalent to the following:</p>

<pre><code>PROCEDURE test(i_w IN a.w%type,o_result IN OUT resu_cur_type) IS
BEGIN
      open o_result for SELECT a.x, b.y FROM a,b WHERE a.z=b.z AND NVL(a.w,1)=NVL(NVL(i_w,a.w),1);
END test;
</code></pre>

<p>Won't it be the same?. Could somebody please explain is there any reason to use the
original version?. 
Please note that the original cursor is a 50 line query, so refactoring might improve its readability and keep it simple.</p>

<p>Edit:</p>

<p>To address the problem in Kevin Burton's answer, I've updated the WHERE condition.</p>
","<oracle><plsql><refactoring>","2","78","2011-08-16 09:14:43"
"7078675","Refactoring complex project to JPA or Hibernate","<p>I have big enough and already working project, written not by a programmer, but a scientist. The program holds lot of data in a huge object tree. Almost all of the classes involved are mutable and even more -- they tend to change state of other objects in almost all methods, even getters and setters. This object tree is than stored via java serialization to disk.</p>

<p>My task is to migrate from serialization to database, to reduce memory consumption. Manual refactoring of this tons of mutables, changing each other at some unknown points in time is completely hell, especially for me -- not knowing the subject domain.</p>

<p>Are there any approaches, practices, or refactoring patterns for such cases?</p>
","<database><orm><refactoring>","1","65","2011-08-16 13:08:20"
"7089426","Refractor code with SQL bulk insert {ADO.NET, ODP.NET}","<p>Hi I use SQL bulk insert to Oracle 10g Db. I use ODP.NET because I need insert 20.000 - 40.000 rows in table. Long time a use LINQ to SQL (for oracle devart <a href=""http://www.devart.com/linqconnect/"" rel=""nofollow"">http://www.devart.com/linqconnect/</a>).
 Now I must use ""ADO.NET"" object but my code look horrible. Can you help me and give my ideas how to refractor it? I would like to find compromise between readability of code and  performacne.</p>

<p>Sorry for my english</p>

<pre><code>    private void InitArrays(int size)
    {
        _id = new string[size];
        _lm = new DateTime[size];
        _priceWithoutDiscount = new decimal[size];
        _priceWithDiscount = new decimal[size];
        _talkTime = new int[size];
        _type = new string[size];
        _voiceNetwork = new string[size];
        _callNo = new string[size];
        _callDate = new DateTime[size];
        _callType = new string[size];
        _surname = new string[size];
        _name = new string[size];
        _no = new string[size];
    }

    private void PrepareArrays(IList&lt;Call&gt; calls)
    {
        InitArrays(calls.Count);

        Parallel.For(0, calls.Count, i =&gt;
        {
            _id[i] = IdGenerator.GenerateGuidForCall(calls[i]);
            _no[i] = calls[i].Number;
            _name[i] = calls[i].Name;
            _surname[i] = calls[i].Surname;
            _callType[i] = calls[i].CallType;
            _callDate[i] = calls[i].Dt;
            _callNo[i] = calls[i].CallingNumber;
            _voiceNetwork[i] = calls[i].VoiceNetwork;
            _type[i] = calls[i].Type;
            _talkTime[i] = calls[i].TalkTimeInSec;
            _priceWithDiscount[i] = (decimal)calls[i].PriceWithDiscount;
            _priceWithoutDiscount[i] = (decimal)calls[i].PriceWithoutDiscount;
            _lm[i] = DateTime.Now;

        });
    }


    public void InsertCalls(IList&lt;Call&gt; calls)
    {
        PrepareArrays(calls);

        string sql = ""insert into r_calls (ID, NO, NAME, SURNAME, CALL_TYPE, CALL_DATE, CALL_NO, VOICE_NETWORK,""
                     +""TYPE, TALK_TIME,PRICE_WITH_DISCOUNT, PRICE_WITHOUT_DISCOUNT, LM_MODIFIED) ""
                     + ""values (:id, :no, :name, :surname, :callType, :callDate, :callNo, :voiceNetwork, :type,""
                     +"" :talkTime, :priceWithDiscount, :priceWithoutDiscount, :lm)"";


        var cnn = new OracleConnection(GenerateConnectionString());
        cnn.Open();
        OracleCommand cmd = cnn.CreateCommand();
        cmd.CommandText = sql;
        cmd.CommandType = CommandType.Text;
        cmd.BindByName = true;

        // To use ArrayBinding, we need to set ArrayBindCount
        cmd.ArrayBindCount = _id.Count();

        // Instead of single values pass arrays of values as parameters
        cmd.Parameters.Add("":id"", OracleDbType.Varchar2, 
                            _id, ParameterDirection.Input);

        cmd.Parameters.Add("":no"", OracleDbType.Varchar2,
                            _no, ParameterDirection.Input);

        cmd.Parameters.Add("":name"", OracleDbType.Varchar2,
                            _name, ParameterDirection.Input);

        cmd.Parameters.Add("":surname"", OracleDbType.Varchar2,
                            _surname, ParameterDirection.Input);

        cmd.Parameters.Add("":callType"", OracleDbType.Varchar2,
                            _callType, ParameterDirection.Input);

        cmd.Parameters.Add("":callDate"", OracleDbType.Date,
                            _callDate, ParameterDirection.Input);

        cmd.Parameters.Add("":callNo"", OracleDbType.Varchar2,
                            _callNo, ParameterDirection.Input);

        cmd.Parameters.Add("":voiceNetwork"", OracleDbType.Varchar2,
                            _voiceNetwork, ParameterDirection.Input);

        cmd.Parameters.Add("":type"", OracleDbType.Varchar2,
                            _type, ParameterDirection.Input);

        cmd.Parameters.Add("":talkTime"", OracleDbType.Decimal,
                            _talkTime, ParameterDirection.Input);

        cmd.Parameters.Add("":priceWithDiscount"", OracleDbType.Decimal,
                            _priceWithDiscount, ParameterDirection.Input);

        cmd.Parameters.Add("":priceWithoutDiscount"", OracleDbType.Decimal,
                            _priceWithoutDiscount, ParameterDirection.Input);

        cmd.Parameters.Add("":lm"", OracleDbType.Date,
                        _lm, ParameterDirection.Input);


        cmd.ExecuteNonQuery();
        cnn.Close();

    }
</code></pre>
","<c#><sql><ado.net><refactoring>","0","331","2011-08-17 07:50:20"
"7090078","how can I refactor this?","<p>As for now, when I prepare my data to be sent by Ajax request to my web app, I just concat my JS arrays (with placing <code>-1</code> between them as separator - values can be positive only, so <code>-1</code> means start of new array). This seems a bit ugly for me, so I'm wondering what would be best practice to refator this.</p>

<pre><code>    var online1 = [];
    var online2 = [];
    var online3 = [];
    var online4 = [];

    for(i = 0 ; i &lt; listOfPlayers.length ; i++) {

        var player = listOfPlayers[i].href;             
        var uid = player.substring(player.lastIndexOf('=') + 1);

        if(onlineStatus[i].className == ""online1""){
            online1.push(uid);
        }   
        if(onlineStatus[i].className == ""online2""){
            online2.push(uid);
        }   
        if(onlineStatus[i].className == ""online3""){
            online3.push(uid);
        }   
        if(onlineStatus[i].className == ""online4""){
            online4.push(uid);
        }
    }

    online1.push(-1);
    online2.push(-1);
    online3.push(-1);
    online4.push(-1);
    var result = online1.concat(online2, online3, online4);

    //...
    ajaxRequest.send(""result=""+result);
</code></pre>
","<javascript><refactoring>","0","47","2011-08-17 08:50:29"
"7083011","Python recursive function exceeds recursion limit. How can I convert it to iteration","<p>I have created a function that reads lists of ID pairs (i.e. [(""A"",""B""),(""B"",""C""),(""C"",""D""),...] and sequences the ID's from start to finish including any branches.</p>

<p>Each list of ordered ID's is held in a class called an Alignment and this function uses recursion to handle branches by creating a new alignment starting at the ID at which the branch splits from the main list.</p>

<p>I have found that with certain inputs it is possible to reach the maximum recursion limit set by Python.  I know I could just increase this limit using sys.setrecursionlimit(), but as I do not know how many combinations of branches are possible, I'd like to avoid this tactic.</p>

<p>I have been reading several articles about converting recursive functions to iterative functions, but I have not been able to determine the best way to handle this particular function because the recursion takes place in the middle of the function and can be exponential.</p>

<p>Could any of you offer any suggestions?</p>

<p>Thanks, Brian</p>

<p>Code is posted below:</p>

<pre><code>def buildAlignments(alignment, alignmentList, endIDs):
    while alignment.start in endIDs:

        #If endID only has one preceding ID: add preceding ID to alignment
        if len(endIDs[alignment.start]) == 1:
            alignment.add(endIDs[alignment.start][0])

        else:

            #List to hold all branches that end at spanEnd
            branches = []

            for each in endIDs[alignment.start]:

                #New alignment for each branch
                al = Alignment(each)

                #Recursively process each new alignment
                buildAlignments(al, branches, endIDs)

                branches.append(al)
            count = len(branches)
            i = 0
            index = 0

            #Loop through branches by length
            for branch in branches:
                if i &lt; count - 1:

                    #Create copy of original alignment and add branch to alignment
                    al = Alignment(alignment)
                    al += branch #branches[index]
                    alignmentList.append(al)
                    i += 1

                #Add single branch to existing original alignment
                else: alignment += branch #branches[index]
                index += 1

def main():
    IDs = [(""L"", ""G""), (""A"", ""B""), (""B"", ""I""), (""B"", ""H""), (""B"", ""C""), (""F"", ""G""), (""D"", ""E""), (""D"", ""J""), (""E"", ""L""), (""C"", ""D""), (""E"", ""F""), (""J"", ""K"")]

    #Gather all startIDs with corresponding endIDs and vice versa
    startIDs = {}
    endIDs = {}
    for pair in IDs:
        if not pair[0] in startIDs: startIDs[pair[0]] = []
        startIDs[pair[0]].append(pair[1])
        if not pair[1] in endIDs: endIDs[pair[1]] = []
        endIDs[pair[1]].append(pair[0])

    #Create Alignment objects from any endID that does not start another pair (i.e. final ID in sequence)
    alignments = [Alignment(end) for end in endIDs if not end in startIDs]

    #Build build sequences in each original Alignment
    i = len(alignments)
    while i:
        buildAlignments(alignments[i-1], alignments, endIDs)
        i -= 1
</code></pre>

<p>EDIT: I should point out that the provided IDs are just a small sample I used for testing this algorithm.  In actuality, the sequences of IDs may be several thousand long with many branches and branches off of branches.</p>

<p>RESOLUTION: Thanks to Andrew Cooke. The new method seems to be much simpler and much easier on the call stack.  I did make some minor adjustments to his code to better suit my purposes.  I have included the completed solution below:</p>

<pre><code>from collections import defaultdict

def expand(line, have_successors, known):
    #print line
    known.append(line)
    for child in have_successors[line[-1]]:
        newline = line + [child]
        if line in known: known.remove(line)
        yield expand(newline, have_successors, known)

def trampoline(generator):
    stack = [generator]
    while stack:
        try:
            generator = stack.pop()
            child = next(generator)
            stack.append(generator)
            stack.append(child)
        except StopIteration:
            pass

def main(pairs):
    have_successors = defaultdict(lambda: set())
    links = set()
    for (start, end) in pairs:
        links.add(end)
        have_successors[start].add(end)
    known = []
    for node in set(have_successors.keys()):
        if node not in links:
            trampoline(expand([node], have_successors, known))
    for line in known:
        print line

if __name__ == '__main__':
    main([(""L"", ""G""), (""A"", ""B""), (""B"", ""I""), (""B"", ""H""), (""B"", ""C""), (""F"", ""G""), (""D"", ""E""), (""D"", ""J""), (""E"", ""L""), (""C"", ""D""), (""E"", ""F""), (""J"", ""K"")])
</code></pre>

<p>SUMMARY OF CHANGES:
swapped links and have_successors to create list from start to end
added <code>if line in known: known.remove(line)</code> to expand in order to retain only the complete series
changed line variable from string to list in order to handle multiple characters in a single ID.</p>

<p>UPDATE: So I just discovered the reason I was having an issue with all this in the first place is do to circular references in the list of IDs I was provided.  Now that the circular reference is fixed, either method works as expected. - Thanks again for all your help.</p>
","<python><recursion><refactoring><iteration><sequencing>","4","480","2011-08-16 18:17:31"
"7093730","In Eclipse, how to refactor anonymous interface implementation to Enum Singleton","<p>Let's say I have an interface:</p>

<pre><code>public interface Foo{
    String bar(int baz);
}
</code></pre>

<p>Now in some Java code I have an anonymous implementation of that interface:</p>

<pre><code>Foo foo = new Foo(){
    public String bar(int baz){
        return String.valueOf(baz);
    }
};
</code></pre>

<p>Is there a way (in Eclipse) to refactor this to the enum singleton pattern (Effective Java, Item 3), like this:</p>

<pre><code>// further up in the same Compilation Unit:
enum StandardFoo implements Foo{
    INSTANCE{
        public String bar(int baz){
            return String.valueOf(baz);
        }
    }
}

// ...
Foo foo = StandardFoo.INSTANCE;
</code></pre>

<p>This refactoring is tedious to do by hand and I do it all the time. Is there any plugin that does that? Or a secret JDT trick I don't know about (I'm using Indigo)?</p>

<p>BTW: do Idea or NetBeans support this refactoring?</p>
","<java><eclipse><interface><enums><refactoring>","3","168","2011-08-17 13:32:46"
"7103979","Nested ternary operators","<p>I have this code:</p>

<pre><code>_viewModel.PhoneDefault = user == null ? """" :
    (string.IsNullOrEmpty(user.PhoneDay) ?
        (string.IsNullOrEmpty(user.PhoneEvening) ?
            (string.IsNullOrEmpty(user.Mobile) ? """" : 
                user.Mobile) :
            user.PhoneEvening) :
         user.PhoneDay);
</code></pre>

<p>Is there a better way to write this to make it more readable?</p>
","<c#><refactoring><ternary-operator>","1","490","2011-08-18 07:42:53"
"7104449","Eclipse text-search over all files?","<p>I'm optimizing my code at the moment (android game), and wanted to replace all foreach(for(<em>:</em>)) with normal fors. Is there a way to find them all? Ctrl-F only looks through the current file and Ctrl-H doesn't seem to find any java constructs (not sure if right word: ifs, whiles, accessors etc.). Preferably without a plugin, but any answer accepted. It would also be nice if there would be a possibility to search for any string (* in Search).</p>

<p>TL;DR: Looking for way to find all foreaches in eclipse.</p>
","<eclipse><loops><refactoring>","1","108","2011-08-18 08:25:31"
"7106474","refactoring problem with one of my classes","<p>i wrote a program and i named my <code>class StatusListActivity</code> which <code>extend Activity</code>  and is the launcher and main class. I tried refactoring it by  changing the name to something else and whenever i tried to run the application, it closes please do you have an idea of what the problem was.</p>
","<android><refactoring><android-manifest><refactor-my-code>","0","73","2011-08-18 11:12:31"
"7108056","How do I identify the lowest required visibility of methods?","<p>As part of a large refactoring project, I need to identify methods that are no longer used, or where the visibility can be reduced.</p>

<p>Consider the following code:</p>

<pre><code>program Project1;

type
  TMyClass = class(TObject)
  private
    function Method1 : integer;
  public
    function Method2 : integer;
    function Method3 : integer;
    function Method4 : integer;
  end;

var
  vMyObject : TMyClass;

function TMyClass.Method1: integer;
begin
  Result := Method2;
end;

function TMyClass.Method2: integer;
begin
  Result := 2;
end;

function TMyClass.Method3: integer;
begin
  Result := 3;
end;

function TMyClass.Method4: integer;
begin
  Result := 4;
end;

begin
  vMyObject := TMyClass.Create;
  try
    writeln(vMyObject.Method3);
  finally
    vMyObject.Free;
  end;
end.
</code></pre>

<p>The Delphi compiler gives the warning ""[DCC Hint] Project1.dpr(6): H2219 Private symbol 'Method1' declared but never used"", which is very helpful. But there are other issues with this code that I would like to be warned about:</p>

<ol>
<li>Method4 is never used, but I don't get a warning since it's public.</li>
<li>Method2 is declared public, but only used privately.</li>
</ol>

<p>Are there any tools I can use to identify issues like these?</p>
","<delphi><refactoring>","6","168","2011-08-18 13:19:38"
"7109996","Inheritance problem in C#","<p>I'm refactoring some code and want to classes a bit higher in the inheritance chain be a bit more strict with their parameters. As I'm not sure I'm explaining this correctly, here's what I've got:</p>

<pre><code>public interface ISvdPredictor
{
    List&lt;string&gt; Users { get; set; }
    List&lt;string&gt; Artists { get; set; }
    float PredictRating(ISvdModel model, string user, string artist);
    float PredictRating(ISvdModel model, int userIndex, int artistIndex);
}
</code></pre>

<p><code>ISvdPredictor</code> uses <code>ISvdModel</code>:</p>

<pre><code>public interface ISvdModel
{
    float[,] UserFeatures { get; set; }
    float[,] ArtistFeatures { get; set; }
}
</code></pre>

<p>Now I want to implement another variation:</p>

<pre><code>public interface IBiasSvdPredictor : ISvdPredictor
{
    float PredictRating(IBiasSvdModel model, string user, string artist);
    float PredictRating(IBiasSvdModel model, int userIndex, int artistIndex);
}
</code></pre>

<p>Which uses <code>IBiasSvdModel</code> which derives from <code>ISvdModel</code>:</p>

<pre><code>public interface IBiasSvdModel : ISvdModel
{
    float GlobalAverage { get; set; }
    float[] UserBias { get; set; }
    float[] ArtistBias { get; set; }
}
</code></pre>

<p><code>IBiasSvdPredictor</code> will not work with <code>ISvdModel</code>.</p>

<p>The problem is that when I implement <code>IBiasSvdPredictor</code> I'd have to implement 2 pairs of PredictRating methods. One from <code>ISvdPredictor</code> and the other from <code>IBiasSvdPredictor</code>. What do I need to do to be able to just implement those from <code>IBiasSvdPredictor</code>?</p>

<p>I've tried generics as well, but couldn't restrict the <code>PredictRating</code> for <code>BiasSvdPredictor</code> to <code>IBiasSvdModel</code> using the <code>where</code> directive. I may be doing this all wrong so any suggestion might help. I think you get what I'm trying to do.</p>

<p>EDIT: If anyone needs more context see <a href=""https://github.com/gligoran/RecommendationSystem"" rel=""nofollow"">https://github.com/gligoran/RecommendationSystem</a>. I'm writing this code for my thesis for BSc.</p>
","<c#><inheritance><refactoring>","5","135","2011-08-18 15:27:17"
"7110220","Removing Duplicated Java Code","<p>I have a class written in ~1000 lines of Java code that migrates one database over to another.
It has 19 methods for each table being copied over, and 1 which load's the special JDBC driver for Filemaker.</p>

<p>I'm looking at this and can't help thinking I've been really stupid here, and just let my urge to call a few methods from a onActionPerformed govern the 'design'. I trimmed out what I could, but it still looks a lot for what it's essentially doing.</p>

<p>So here's the gist:</p>

<pre><code>public static void companyInsert() throws SQLException{
// This loads the JDBC drivers, gets the connections, turns off auto commit and returns a createStatement()
query = classname.Connect();

try {
  results = query.executeQuery(""SELECT * from table"");

  // Iterate through the results and print them to standard output
System.out.println(""Starting Customers"");

stmt = con.prepareStatement(""INSERT ignore INTO table (idone, idtwo) values (?, ?)"");

while (results.next()) {
    String fname = results.getString(""field 1"");
    String lname = results.getString(""field 2"");
 // System.out.println(""Found user \"""" + fname + "" "" + lname + ""\"""");
     stmt.setString(1, fname);
  stmt.setString(2, lname);
  stmt.addBatch();
  }
  // submit the batch for execution
   int[] updateCounts = stmt.executeBatch();
   System.out.println(""Update count: "" + updateCounts);
  con.commit();
  stmt.close();
  System.out.println(""Completed Customers"");
}
catch (BatchUpdateException be) {
//handle batch update exception
int[] counts = be.getUpdateCounts();
for (int i = 0; i &lt; counts.length; i++) {
    System.out.println(""Statement[""+i+""] :""+counts[i]);
}
con.rollback();
}catch (SQLException e) {

//handle SQL exception
con.rollback();
}
 }
</code></pre>

<p>There's 19 of these methods, with only the sql parts changing (there are also more fields being set for other records, with some also being retrieved as dates). Hope someone has some great idea - if I could just tear out that catch section (this is always the same) then that would be enough!</p>

<p>Thanks, Paul S</p>
","<java><sql><design><refactoring><code-structure>","0","115","2011-08-18 15:44:12"
"7112673","How would I organize the flow of this Rails code?","<p>I'm using <a href=""https://github.com/binarylogic/shippinglogic"" rel=""nofollow"">Shippinglogic</a> to gather tracking information for submitted tracking numbers.</p>

<p>I'm handling a number of things behind the scenes of the UI, but I'm not sure how to properly organize this.</p>

<p>So here's the flow:</p>

<ol>
<li>User submits tracking number either via form input or URL (example.com/track/1234567890). If the number doesn't already exist in the database, then the next step happens...</li>
<li>After a number is submitted, I run the number through some logic to determine who the carrier is (UPS, FedEx, USPS, DHL, etc). The user never specifies...it's all done automatically.</li>
<li>After the carrier is determined, then I need to make the actual call to the carrier API (via Shippinglogic) to get tracking information.</li>
<li>After I get the tracking details, I need to save it to the database.</li>
<li>Then, the tracking details are finally returned to the user.</li>
</ol>

<p>Since users can submit either via form or via a URL (without any sort of POST action), I'm trying to run it all through my <code>show</code> method in the controller where I check if the number exists and if not, submit it via <code>Number.create(:tracking_number =&gt; '1234567890')</code> but once I get into the model, I just kinda get lost on what to do next.</p>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring><organization>","0","61","2011-08-18 19:00:18"
"7102512","Convert PHP procedural code into OOP method chaining...are maintainability and readability worth the trouble?","<p>I had a medium-size task done in procedural style so I thought of converting the code to OOP for ease of maintenance. The original code was a big block in a single file and what I did was: <br/>
 - Break down the task into functions which handle a part of the task <br/>
 - Put the functions into a class for method chaining <br/></p>

<p>After conversion, the code become like this:</p>

<pre><code>$obj = new Class();
$result = $obj-&gt;task1()-&gt;task2()-&gt;task3()-&gt;task4()-&gt;getResult();
</code></pre>

<p>I can either leave it like this or further convert each task into a class for more abstraction. What are your takes on refactoring code just for maintainability and readability (and possibly portability once I break down the functions further and convert them into classes) ?</p>
","<php><oop><refactoring>","0","181","2011-08-18 04:47:01"
"7118521","How can I refactor this C# code","<p>Basically I have a method that takes an object and sets another objects properties based on the object passed in.</p>

<p>e.g:</p>

<pre><code>    private void SetObject(MyClass object)
{
  MyClass2 object2 = new MyClass2();
  object2.Property1 = HelperClass.Convert(object.Property1);
  //....
  // Lots more code ....
  //....
}
</code></pre>

<p>Now the method is 53 lines long because there are alot of properties to set. The method seems too long to me but I'm struggling to work out how I can possibly break it down.  </p>

<p>One option is to try and group up similar properties and pass the object around as a reference to different methods that set these similar properties, but that doesn't seem to sit right with me.</p>

<p>Or I could create a constructor for MyClass2 that accepts a MyClass1 but that doesn't seem right either.</p>

<p>Anyway would welcome some suggestions.</p>

<p>EDIT: Ok thanks for the replies I'll have to give more info, the property names arent the same and I have to call some conversion methods as well.  Reflection wouldn't be good because of this and also the performance hit.  Automapper I think for the same reasons.</p>

<p>A real example of the code:</p>

<pre><code>    private ReportType GetReportFromItem(SPWeb web, SPListItem item)
            {
                ReportType reportType = new ReportType();
                reportType.ReportID = int.Parse(item[""Report ID""].ToString());
                reportType.Name = item[""Title""].ToString();
                reportType.SourceLocation = FieldHelpers.GetUri(item[""Source Location""]);
                reportType.TargetLocation = FieldHelpers.GetUri(item[""Document Library""]);
                SPFieldUserValue group1 = 
                    new SPFieldUserValue(web, FieldHelpers.GetStringFieldValue(item, ""Security Group 1""));
                reportType.SecurityGroup1 = group1.LookupValue;
                SPFieldUserValue group2 =
                    new SPFieldUserValue(web, FieldHelpers.GetStringFieldValue(item, ""Security Group 2""));
                reportType.SecurityGroup2 = group2.LookupValue;
                SPFieldUserValue group3 =
                    new SPFieldUserValue(web, FieldHelpers.GetStringFieldValue(item, ""Security Group 3""));
                reportType.SecurityGroup3 = group3.LookupValue;
                SPFieldUserValue group4 =
                    new SPFieldUserValue(web, FieldHelpers.GetStringFieldValue(item, ""Security Group 4""));
// More code
//...
//...
}
</code></pre>
","<c#><refactoring>","0","177","2011-08-19 07:54:01"
"7125590","Can this be refactored into a single database call?","<p>I have a listing of events in an <code>Events</code> model. What I need to do is visually group events by city/state.</p>

<p>Visually, that will look like this:</p>

<p><img src=""http://i.stack.imgur.com/hJOhD.png"" alt=""Tracking details""></p>

<p>Here's, a stripped down look of what I'm doing in my view to make this happen:</p>

<pre><code>&lt;% @number.events.locations.each do |location| %&gt;
  &lt;li&gt;
    &lt;h4&gt;&lt;%= ""#{location.city}, #{location.state}"" %&gt;&lt;/h4&gt;
    &lt;ol&gt;
    &lt;% @number.events.city_state(location).each do |event| %&gt;
      &lt;li&gt;&lt;%= event.status %&gt;&lt;/li&gt;
    &lt;% end %&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;% end %&gt;
</code></pre>

<p>And the corresponding scopes:</p>

<pre><code>scope :locations, :group =&gt; 'city, state'
scope :city_state, lambda {|location| {:conditions =&gt; [""city = ? AND state = ?"", location.city, location.state] }}
</code></pre>

<p>The problem, though, is that I'm doing an additional database call for every location.</p>

<p>So can I get that down to a single query?</p>
","<ruby-on-rails><database><ruby-on-rails-3><query><refactoring>","0","92","2011-08-19 18:06:36"
"7127576","Should I ""Pull Up"" Refactor","<p>I have some very small classes that I feel should be ""pulled up"" but the methods are so small I'm not sure. For example, the only thing that's meaningfully different is the body of the buildFromJSON: selector.</p>

<p>I acknowledge that this is similar to:
<a href=""http://stackoverflow.com/questions/1866813/pull-up-refactoring-objective-c"">Pull-up refactoring, Objective-C</a>
but I feel my question is specific to refactoring very small classes/methods.</p>

<p>Also, not sure it relates to my particular code example, but I'm wondering if a child class says it conforms to a protocol, whether it's enough that it's parent actually supply the implementation of required selector(s)?</p>

<pre><code>@implementation AsyncFoo

-(void)dealloc {
    [clientDelegate release];
    [super dealloc];
}

- (id)initWithDelegate: (id &lt;ServiceClientProtocol&gt;) delegate {
    if((self = [super init])) {
        clientDelegate = [delegate retain];
    }
    return self;
}

- (void)buildFromJSON:(NSString*)jsonResponseString {
    [clientDelegate serviceComplete:[RestAdapter buildFooArray: jsonResponseString]];
}

@end



@implementation AsyncBar

-(void)dealloc {
    [clientDelegate release];
    [super dealloc];
}

- (id)initWithDelegate: (id &lt;ServiceClientProtocol&gt;) delegate {
    if((self = [super init])) {
        clientDelegate = [delegate retain];
    }
    return self;
}

- (void)buildFromJSON:(NSString*)jsonResponseString {
    [clientDelegate serviceComplete:[RestAdapter buildBarArray:jsonResponseString]];
}

@end
</code></pre>

<p>Answers including code example would be great.</p>

<p>EDIT: Post accepted answer I'd like to add that since I was able to subclass, the derived classes did not need to declare that they conformed to protocol: </p>

<pre><code>@interface Async : NSObject &lt;ModelBuilderProtocol&gt; {
    id &lt;ServiceClientProtocol&gt; clientDelegate;
}
- (void)buildFromJSON:(NSString*)jsonResponseString;
@end

@interface AsyncArtistById : Async
@end 
</code></pre>
","<objective-c><refactoring>","1","65","2011-08-19 21:22:28"
"7134784","Refactoring small F# function","<p>I've made the following F# function that will get me an url from the html contents of a web page:</p>

<pre><code>let getPicUrl (urlContents : string) =
  let START_TOKEN = ""jpg_url=""
  let startIndex = urlContents.IndexOf(START_TOKEN)
  let endIndex = urlContents.IndexOf(""&amp;amp"", startIndex)
  let s = startIndex + START_TOKEN.Length
  let l = endIndex-startIndex-START_TOKEN.Length

  urlContents.Substring(s, l)
</code></pre>

<p>what the last line, <code>urlContents.Substring(s, l)</code>, actually needs is only <code>s</code> and <code>l</code>, so I was wondering whether I could refactor parts of this function into some internal functions so I'd let my intentions be clearer. Ideally <code>getPicUrl</code> would only have 2 <code>let</code> instructions, <code>s</code> and <code>l</code>, and all the others would be internal definitions to those <code>let</code> instructions. If this can in any way be achieved or not is another story..</p>

<p>The only obvious way I can think at the moment to improve the above code would be to switch <code>endIndex</code> of place so we'd have</p>

<pre><code>let getPicUrl (urlContents : string) =
  let START_TOKEN = ""jpg_url=""
  let startIndex = urlContents.IndexOf(START_TOKEN)
  let s = startIndex + START_TOKEN.Length
  let l =
    let endIndex = urlContents.IndexOf(""&amp;amp"", startIndex)
    endIndex-startIndex-START_TOKEN.Length

  urlContents.Substring(s, l)
</code></pre>

<p>but I keep wondering if there'd be a clearer way of organizing this function's <code>let</code> definitions.</p>
","<.net><f#><refactoring>","3","160","2011-08-20 21:23:51"
"7135824","Creating a Bash command prompt with a red $ after failure of previous command","<p>I'm new to Bash programming, and I'm working on creating a <strong>custom Bash command prompt</strong>. My goal is to create a prompt which only shows the login name and host name when they differ from what I normally use. I'm also looking to append the current Git branch to the command prompt when in a directory which is under Git version control.</p>

<p>I would like to color the login and host name section green, the directory path blue, the Git branch section pink, and separators (: and $ characters) white. However, <strong>when the previously executed command returns anything other than zero, I would like to color the $ separator red</strong>. The general format without colors looks like this:</p>

<pre><code>loginname@hostname:~/current/path:branchname$
</code></pre>

<p>The only sections that are mandatory are the directory path and the $ character. Here's the code I've written for my <strong>.bashrc</strong> file:</p>

<pre><code>MYNAME=""gwen""
MYHOST=""gwen-laptop""

RED=""\[\033[31m\]""
WHITE=""\[\033[0m\]""
GREEN=""\[\033[01;32m\]""
BLUE=""\[\033[01;34m\]""
PINK=""\[\033[01;35m\]""

DOLLAR=""if [ \$? = 0 ]; then echo ${WHITE}\$; else echo ${RED}\$${NORMAL}; fi""
GITBRN='$(__git_ps1 ""\033[0m:\033[01;35m%s"")'

USERNM=""if [ \u != ${MYNAME} ]; then whoami; fi;""
HOSTNM=""if [ \h != ${MYHOST} ]; then echo -n @; hostname; fi;""
COLONM=""if [ \u != ${MYNAME} ] || [ \h != ${MYHOST} ]; then echo -n :; fi;""

PS1=""${GREEN}\`${USERNM}\`\`${HOSTNM}\`${WHITE}\`${COLONM}\`${BLUE}\w${GITBRN}\`${DOLLAR}\` ""
</code></pre>

<p>This code meets all of my requirements, <strong>except that it leaves the $ character white at all times, and does not color it red at the appropriate times</strong>. (I suspect the problem is that the ""\$?"" in DOLLAR references the previously executed command, but DOLLAR is executed last when constructing PS1, so the previously execute statement is no longer the command which was run before PS1 construction began; it's something which was executed in order to create the command prompt.) I'm <strong>not sure how to solve this problem</strong>.</p>

<p>This code is ugly and <strong>needs to be refactored</strong>. I was trying to move all the color codes into their own variables, but when I used these color variables in the code for GITBRN, thing went haywire, so I ended up using literal colors there instead. </p>

<p>I've spent an entire day trying to get this code working, and I think I'm going nowhere at this point. Any <strong>suggestions for how to get that dollar sign colored red at the appropriate time would be most appreciated</strong>. I'm also open to suggestion on refactoring the code to make it cleaner and more readable.</p>

<p>P.S. I'm a Ubuntu Linux (Lucid Lynx) user.</p>
","<bash><shell><refactoring><return-value><command-prompt>","4","141","2011-08-21 01:39:50"
"7144447","How can I get Visual Studio's ""Create method stub"" or ""Declare method"" refactoring in Delphi?","<p>When I code in Delphi XE and need a new procedure/function in another unit (for example on a datamodule) then I miss the Visual Studio feature where I can just type the new method name and use the ""Create method stub"" feature:</p>

<p><img src=""http://i.stack.imgur.com/9LmCV.jpg"" alt=""Example in Visual Studio""></p>

<p>or using CodeRush the ""Declare method"" refactoring:</p>

<p><img src=""http://i.stack.imgur.com/abfvh.jpg"" alt=""CodeRush example""></p>

<p>I prefer this TDD style development as it is faster than first switching to the data module for example, navigating to the interface section and creating the procedure/function myself there.</p>

<p>Do anybody know how I can achieve that in Delphi XE using plugins/add-ins etc.? </p>
","<delphi><plugins><ide><refactoring><features>","3","156","2011-08-22 07:44:41"
"7141188","Is there way for extracting string resources in Android project in IntelliJ IDE?","<p>When I'm working on Android project I would like to use some magic shortcut that would extract my string to strings.xml and also allow me to change the key. Is there any?</p>

<p>If there isn't, is there a way to develop new refactorization methods and extend IntelliJ possibilities?</p>
","<android><intellij-idea><automated-refactoring>","0","161","2011-08-21 21:07:53"
"7155701","Get rid of hardware macros in embedded software","<p>I was working on an embedded program using C.</p>

<p>There are tons of hardware macros like</p>

<pre><code>#ifdef HardwareA 
do A 
#endif
</code></pre>

<p>It's not readable, and hard to cover all the different paths with unit tests.</p>

<p>So, I decided to move the hardware related code to arch folders, and using macros in the makefile to decide which arch folder is linked. Like in the Linux kernel code.</p>

<p>But when I saw the Linux kernel, I noticed there are so many duplicates in the arch folders.</p>

<p>How do they make the changes to all related hardware when a bug was found in one hardware, but might affect all others?</p>

<p>I think doing this way will inevitably bring duplicates into the code base.</p>

<p>Does anyone have experience with this type of problem? </p>

<p>How to unit test on code which has lots of hardware macros? </p>

<p>Refactoring the code to move hardware macros off source code?</p>
","<c><unit-testing><refactoring>","1","145","2011-08-23 02:31:17"
"7154196","How To Improve PHP and JQuery Code in this Project - only fade out elements that need refreshed instead of whole section?","<p>I came across this website and was impressed by it and wanted to try and learn how it works: <a href=""http://demo.pellegrom.me/uptime/"" rel=""nofollow"">http://demo.pellegrom.me/uptime/</a></p>

<p>My attempt is here: <a href=""http://www.4playtheband.co.uk/up/up.php"" rel=""nofollow"">http://www.4playtheband.co.uk/up/up.php</a> but I have had to fade out the entire section rather than just the status'. My tooltips are also broken because they are dynamically generated - I'm sure I need to apply the <code>live</code> function but just not sure on how to do this without breaking it.</p>

<p>Here is the code:</p>

<p>up.php:</p>

<pre><code>&lt;?php
require('../db.php');
?&gt;  
&lt;script type=""text/javascript""&gt;
$(document).ready(function(){

    $(""#container"").load(""response.php"").fadeIn(""slow"");

    setInterval(function() {
        $('#container').fadeOut('slow').load('response.php').fadeIn(""slow"");
    }, 3600000);

    $('.icon').each(function(){
        $(this).simpletip({
            showEffect: 'fade',
            hideEffect: 'fade',
            fixed: 'true',
            position: 'right',
            offset:[10, 0],
            content: $('img',this).attr('alt')
        });
    });

    $('#check').click(function(){
        $('.http-status').empty();
        $('.http-status').html('&lt;img src=""images/spinner.gif""/&gt;');

        $('#container').fadeOut('slow').load('response.php').fadeIn(""slow"");
    });

});
&lt;/script&gt;

&lt;h2&gt;Website Checker&lt;/h2&gt;    

&lt;div id=""container""&gt;&lt;/div&gt;

&lt;br /&gt; 
&lt;a href=""#"" id=""check"" class=""button""&gt;Check Now&lt;/a&gt;
</code></pre>

<p>process.php:</p>

<pre><code>&lt;?php
require('../db.php');

function Visit($url)
{
    $agent = ""Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"";$ch=curl_init();
    curl_setopt ($ch, CURLOPT_URL,$url );
    curl_setopt($ch, CURLOPT_USERAGENT, $agent);
    curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt ($ch,CURLOPT_VERBOSE,false);
    curl_setopt($ch, CURLOPT_TIMEOUT, 5);
    $page=curl_exec($ch);

    //echo curl_error($ch);
    $httpcode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);

    if($httpcode&gt;=200 &amp;&amp; $httpcode&lt;300) 
    {
        echo '&lt;span class=""up""&gt;'.$httpcode.'&lt;span class=""icon""&gt;&lt;img src=""images/info.png"" alt=""website is up""/&gt;&lt;/span&gt;&lt;/span&gt;';
    }
    else
    {
        $httpcode=404;
        echo '&lt;span class=""down""&gt;'.$httpcode.'&lt;span class=""icon""&gt;&lt;img src=""images/info.png"" alt=""website is down""/&gt;&lt;/span&gt;&lt;/span&gt;';

        $date = date(""l, j \of F Y \@ H:i"");

        $to      = ""someone@domain.com"";
        $subject = ""Urgent: $url is down"";
        $message = ""Hello,\n\nIt appears that on our latest check of $url on $date that the site was down.\n\nRegards,\nWeb Checker"";
        $headers = 'From: noreply@webchecker.co.uk' . ""\r\n"" .
               'Reply-To: noreply@webchecker.co.uk' . ""\r\n"";

        mail($to, $subject, $message, $headers);
    }
}
?&gt;

&lt;ul id=""site-list"" class=""list""&gt; 
    &lt;li class=""title""&gt;
        &lt;span class=""id""&gt;&lt;/span&gt;
        &lt;span class=""name""&gt;Title&lt;/span&gt;
        &lt;span class=""url""&gt;URL&lt;/span&gt;
        &lt;span class=""status""&gt;HTTP Status&lt;/span&gt;
    &lt;/li&gt; 

&lt;?php
// some PHP to fetch all the gig entries from the shows table
$sql = ""SELECT * FROM `check`"";
$query = mysql_query($sql) or die(mysql_error());
// a loop to place all the values in the appropriate table cells
while ($row = mysql_fetch_array($query)){
    //begin the loop...
    $id=$row['id'];
    $name=$row['name'];
    $url=$row['url'];
?&gt;
    &lt;li&gt;
        &lt;span class=""id""&gt;&lt;?php echo $id; ?&gt;&lt;/span&gt;
        &lt;span class=""name""&gt;&lt;?php echo $name; ?&gt;&lt;/span&gt; 
        &lt;span class=""url""&gt;&lt;?php echo $url; ?&gt;&lt;/span&gt;
        &lt;span class=""status http-status""&gt;&lt;?php echo Visit(""$url""); ?&gt;&lt;/span&gt;
    &lt;/li&gt;

&lt;?php
}
?&gt;
&lt;/ul&gt;
</code></pre>

<p>That's quite a lot of code, apologies if it's difficult to follow.</p>

<p>Aside from the two points already mentioned, the only other thing puzzling me is how to avoid the e-mail sending when <code>container</code> is first loaded upon the page being visited?</p>

<p>Thanks in advance for all help and suggestions.</p>
","<php><jquery><refactoring><refactor-my-code><good-design>","0","122","2011-08-22 22:11:03"
"7163889","git mv and refactoring in Eclipse","<p>How do I solve this ""chicken &amp; the egg"" situation?</p>

<p>I decided to rename a Java class in Eclipse (say, from <code>one.java</code> to <code>two.java</code>). Eclipse refactoring let me do that without a hitch.</p>

<p>Then, I went to git and typed:</p>

<pre><code>git mv myproj/src/com/ate/lib/one.java myproj/src/com/ate/lib/two.java
</code></pre>

<p>and received the error:</p>

<pre><code>fatal: bad source, source=myproj/src/com/ate/lib/one.java, destination=myproj/src/com/ate/lib/two.java
</code></pre>

<p>I understand why this is happening, but if I do <code>git mv</code> <strong>before</strong> refactoring, Eclipse will <strong>not</strong> like this...</p>

<p>What is a good approach to tackle this?</p>
","<eclipse><git><refactoring>","0","281","2011-08-23 15:54:09"
"7164520","Getting rid of Application Response Measurement (ARM) specific code","<p>I found a lot of <a href=""http://en.wikipedia.org/wiki/Application_Response_Measurement"" rel=""nofollow"">Application Response Measurement (ARM)</a> specific code in an old Java application, with an in-house developed implementation of the <a href=""http://www.opengroup.org/management/arm/"" rel=""nofollow"">Opengroup ARM</a> api</p>

<p>We don't really use it, but is this still usefull? There is a trade-off between getting rid of possibly obsolete code and the chance it can still provide data that we can't get in another, easier way.</p>

<p>I see that the latest SDK packages on that page date back to 2007 (eventhough <a href=""http://arm4sdk.org/"" rel=""nofollow"">ARM4SDK.org</a> seems to have taken over development). The open source implementation <a href=""http://open-arm.sourceforge.net/"" rel=""nofollow"">OpenArm</a> has ceased development and a noble initiative to continue, stopped <a href=""http://code.google.com/p/xray4j/"" rel=""nofollow"">before it got off the ground</a>.</p>

<p>Can anybody shed some light on this?</p>
","<java><refactoring>","0","41","2011-08-23 16:44:47"
"7168084","How to reuse HTML body?","<p>I have the following HTML in a web directory:</p>

<pre><code>&lt;!doctype html&gt;
&lt;html xmlns:ng='http://angularjs.org'&gt;
&lt;script src='lib/angular-0.9.18.min.js' ng:autobind&gt;&lt;/script&gt;
&lt;script src='angular-controller.js'&gt;&lt;/script&gt;
&lt;head&gt;
    &lt;title&gt;My Page&lt;/title&gt;
    &lt;link rel='stylesheet' type='text/css' href='my.css'/&gt;
&lt;/head&gt;
&lt;body&gt;
    Template stuff used by angular.
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>I would like something like:</p>

<pre><code>&lt;!doctype html&gt;
&lt;html xmlns:ng='http://angularjs.org'&gt;
&lt;script src='../web/lib/angular-0.9.18.min.js' ng:autobind&gt;&lt;/script&gt;
&lt;script src='angular-controller-stub.js'&gt;&lt;/script&gt;
&lt;head&gt;
    &lt;title&gt;My Page&lt;/title&gt;
    &lt;link rel='stylesheet' type='text/css' href='../web/my.css'/&gt;
&lt;/head&gt;
&lt;body&gt;
    Template stuff used by angular.
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Note that the only differences are the .js and .css paths.  If I were dealing with a language like Java, I would extract out a method and pass in the filepaths as arguments (or extract out a class and set the fields to the filepaths).  How do I achieve a similar effect in HTML?</p>

<p>The second page is for testing the 'look' of the page. As such, allowing the page to be loaded via file:// allows for really quick turnaround. angular-controller.js does xhr stuff and fills in variables. angular-controller-stub.js just stubs those variables.</p>
","<html><refactoring>","0","68","2011-08-23 21:59:47"
"7169581","Refactor LINQ ... multiplying property and child property from a list","<p>I am still coming to terms with LINQ and I am trying to refactor the following foreach loop into it's LINQ equivalent. Here's the foreach loop that I am trying to convert;</p>

<pre><code>var NetTotal = 0M;

foreach (var cheque in ListOfCheques)
{
    var exchangeRate = (from exc in cheque.ExchangeRates
                        where exc.Type == EnumExchangeRate.ForCheque
                        select exc).FirstOrDefault();

    NetTotal = exchangeRate != null ? NetTotal + cheque.NetAmount * exchangeRate.Rate : NetTotal + cheque.NetAmount;
}

return NetTotal ;
</code></pre>

<p>and the LINQ code that I've come up with;</p>

<pre><code>var NetTotal = (from cheque in ListOfCheques
                join exc in ListOfCheques.SelectMany(b =&gt; b.ExchangeRates) on cheque.ID equals exrate.Cheque.ID into chequeWithRate
                where income.ExchangeRates.Select(x =&gt; x.Type).Equals(EnumExchangeRate.ForCheque)
                from ur in chequeWithRate.DefaultIfEmpty()
                select ur).Sum(x =&gt; x.Cheque.NetAmount * x.Rate);

return NetTotal;
</code></pre>

<p>The important points that I am struggling with;</p>

<ol>
<li>It's possible that the ""ExchangeRates"" list within the Cheque class does not exist, i.e. it does not need an exchange rate.</li>
<li>If there is no exchange rate found it should default to 1. How can I set that... I was hoping to set it within DefaultIfEmpty(1).</li>
</ol>

<p>Any help is greatly appreciated.</p>
","<c#><linq><refactoring><foreach>","2","94","2011-08-24 01:48:06"
"7174555","Java favorite refactoring techniques","<p>There are some common code patterns I find in other people's java code that can benefit from some simple refactoring.</p>

<p>What are your pet code pattern hates and their fixes (and the reason if it isn't obvious)?</p>

<p>I have taken to liberty of answering with a couple of my own pet hates.</p>
","<java><refactoring>","3","328","2011-08-24 11:16:15"
"7196255","TFS version control - File deleted, added - how do we tell TFS it was a move?","<p>We are doing some major refactoring and in the course of that we are moving a lot of files. We use ReSharper which makes this (relatively) painless as it updates all uses everywhere when we move files - even to a different project. So everything is great.</p>

<p>Except we just discovered today that ReSharper would tell TFS to delete the file in the old location and then insert as a new file in the new location. How can we tell TFS that this delete/insert was actually a move?</p>
","<visual-studio><version-control><tfs><refactoring><resharper>","2","236","2011-08-25 19:43:05"
"7203108","Eclipse doesnt Automatically Check out all Affected Java files when Refactoring","<p>I am coding Java using Eclipse 3.5 with ClearCase. </p>

<p>I need to refactor a method in an interface to rename it causing knock-on changes to about 4-5 different classes. The problem is when I use the Refactor->Rename... menu action, eclipse only prompts me to check out the interface file that I am editing and not the other affected files.</p>

<p>In Preferences->Team->ClearCase Remote Client->Workspace my settings are as following:</p>

<pre><code>When edited by an internal, interactive editor: Prompt to checkout
When edited by an internal, non-interactive editor: Automatically checkout
When saved by an internal editor: Automatically checkout
</code></pre>

<p>Does anyone know any setting to get eclipse to find &amp; automatically prompt for checkout all the affected files for the change?</p>
","<java><eclipse><refactoring><clearcase>","1","114","2011-08-26 10:03:28"
"7203963","Efficient way to refactor a class/method/string within a directory using vim","<p>So far, I have been manually refactoring code by using the find-and-replace operation</p>

<pre><code>%s:/stringiwanttoreplace/newstring/g 
</code></pre>

<p>in vim.</p>

<p>But this is a slow and laborious process if I have <em>stringiwanttoreplace</em> in many files inside a specific directory.  </p>

<p>My current/typical slow and laborious process involves a grep:-</p>

<pre><code>grep -rn ""stringiwanttoreplace"" .
</code></pre>

<p>in my terminal to reveal all the locations/filenames where <em>stringiwanttoreplace</em> are; and now that I know which files contain <em>stringiwanttoreplace</em>, I will open each file one-by-one to perform the find-and-replace operation in each file.</p>

<p>Is there a more efficient workflow (in vim) to get this done?</p>

<p><strong>CLARIFICATION:</strong> I would prefer a vim-based solution instead of a bash script/one-liner.</p>
","<vim><refactoring>","9","749","2011-08-26 11:28:23"
"7209665","Visual Studio 2010 macro package or extension to reformat code?","<p>Today I have been finding myself doing a lot of rearranging of code. Like converting this:</p>

<pre><code>var assetPlacement = new AssetPlacement
    {
        Transform = worldSpaceTransform,
    };
</code></pre>

<p>to this:</p>

<pre><code>var assetPlacement = new AssetPlacement { Transform = worldSpaceTransform, };
</code></pre>

<p>Or the reverse, when more params are added. And many more rearranging of deck chairs on the Titanic kind of thing to make OCD types like me happy.</p>

<p>Are there any good extensions or macros out there that provide specific types of code reformatting/refactoring like the above?</p>

<p><strong>Update:</strong></p>

<p>I am not looking for a ""format my document/selection according to pretty-printing rules"" and Ctrl-K whatever. Let's imagine I know my way around Visual Studio pretty well. ReSharper also does not do what I'm after.</p>

<p>I am looking for specific stylistic refactorings. Like changing this:</p>

<pre><code>public string Foo { get { return _foo; } set { _foo = value; } }
</code></pre>

<p>to this:</p>

<pre><code>public string Foo
{
    get { return _foo; }
    set { _foo = value; }
}
</code></pre>

<p><em>...on a command.</em> Or doing the reverse - going from the second form to the first form, on a different command. Without editing profiles and checking boxes. Easily available to go either way on a hotkey or context menu.</p>

<p>Visual Studio does come with a sample macro, for example, that reformats a block of text to align all the equals signs.</p>

<p>That's the kind of thing I'm after. Targeted stylistic reformatting.</p>
","<c#><visual-studio-2010><refactoring>","1","195","2011-08-26 19:32:01"
"7210369","simplifying code via refactoring","<p>Is there a refactoring tool, either for C or Java that can simplify this type of redundant code. I believe this is called data propagation.</p>

<p>This is essentially what an optimizing compiler would do.</p>

<pre><code>public int foo() {
    int a = 3;
    int b = 4;
    int c = a + b;
    int d = c;
    System.out.println(c);
    return c;
}
</code></pre>

<p>into </p>

<pre><code>public int foo() {
    int c = 7;
    System.out.println(c);
    return c;
}
</code></pre>
","<java><c><refactoring>","5","641","2011-08-26 20:42:08"
"7199443","Unit test on program which has lots of macros","<p>Recently, I need to add unit test to one legacy program.</p>

<p>But in it, there are lots of macros, like</p>

<pre><code>#ifdef CONFIG_XXX
do xxx
#endif

#ifdef CONFIG_YYY
do yyy
#endif
</code></pre>

<p>Currently, the generic program path are covered by unit tests. So, I want to add tests to cover the inside macro parts (different program path).</p>

<p>It seems that I need to compile and run my program with certain macros each time, and how to design the composition of macros to cover the program path and reduce compilation times is really not easy.</p>

<p>So, I plan to move all the hardware related code to arch folder, now, macros were moved from  c files to makefile, but still need to compile with certain macros each time to get UT work.</p>

<p>Does anyone have experiences on this problem before?</p>

<p>Thanks for your comments.</p>
","<c><unit-testing><refactoring>","7","124","2011-08-26 02:33:24"
"7200347","customize initial data issue and solution","<p>I want to design an object for loading and showing customized data, for example, the object firstly loads all employees in database, then look up whether login user in the list, if so then show the login user, otherwise show dummy data ""all employees""(means null). But another scenario is the component should ""remember"" last time user selected data and show in another page, any good design suggestion?</p>
","<actionscript-3><design-patterns><refactoring>","0","19","2011-08-26 05:27:00"
"7211472","Does UCDetector work for android projects?","<p>I've got an android project that I started from an old standard Java project, so because of the vast difference in target platform, I have a lot of dead code to cleanup.</p>

<p>I've seen <a href=""http://www.ucdetector.org/"" rel=""nofollow"">UCDetector</a> <a href=""http://stackoverflow.com/questions/665563/find-unused-classes-in-a-java-eclipse-project"">recommended</a> for <a href=""http://stackoverflow.com/questions/162551/how-to-find-unused-dead-code-in-java-projects"">finding unused public methods</a> in java projects in Eclipse.  I installed it as directed, and it just doesn't show up on the menu, and I have no idea how to get it to work.</p>

<p><strong>Has anyone got this combo to work, or have another recommendation?  Or know how to get it to show up?</strong></p>

<p><img src=""http://i.stack.imgur.com/X7jo2.png"" alt=""My menu, where is it?""></p>

<p>(I've tried <a href=""http://findbugs.sourceforge.net/"" rel=""nofollow"">Find Bugs</a> which found some good stuff, but it doesn't find unused public code.)</p>
","<android><eclipse><refactoring><eclipse-plugin>","0","102","2011-08-26 23:28:50"
"7214754","JQuery - Show/Hide a group of fields","<p>I want to show or hide some fields using a select's value as criteria. I don't want to repeat myself wrinting the loop again just to show and hide fields. I want to use the same loop code to show or hide. What's the best approach?</p>

<pre><code>hideFields = function () {
    var fields = $(['#foo', '#bar', '#lorem', '#ipsum'])
        showHide = function (action) {
            if (action === 'show' || action === 'hide') {
                action = action + '();';
                fields.each(function (index, value) {
                    $(value).parent()
                        .parent()
                        .action(); // call show||hide here... not working...
                });
            }
        };

    if ($('#select').val() === 'something') {
        showHide('hide');
    }
    else {
        showHide('show');
    }
};

hideFields();
</code></pre>

<p>Thanks.</p>
","<javascript><jquery><refactoring><hide><show>","2","180","2011-08-27 13:07:50"
"7216200","Refactoring a loop?","<p>I want to loop more than 200,000 user datasets to filter 30,000 products，how can i optimize this nested big loop to get best performance? </p>

<pre><code>  //settings , 5 max per user, can up to 200,000
   $settings = array(...);

   //all prods, up to 30,000
   $prods = array(...);

   //all prods category relation map, up to 2 * 30,000
   $prods_cate_ref_all = array(...);

   //msgs filtered by settings saved yesterday , more then 100 * 200,000
   $msg_all = array(...);

   //filter counter
   $j = 0;

   //filter result
   $res = array();

   foreach($settings as $set){

       foreach($prods as $k=&gt;$p){

           //filter prods by site_id 
           if ($set['site_id'] != $p['site_id']) continue;

               //filter prods by city_id , city_id == 0 is all over the country
           if ($set['city_id'] != $p['city_id'] &amp;&amp; $p['city_id'] &gt; 0) continue;

           //muti settings of a user may get same prods
               if (prod_in($p['id'], $set['uuid'], $res)) continue;

            //prods filtered by settings saved  to msg table yesterday
           if (msg_in($p['id'], $set['uuid'], $msg_all)) continue;

               //filter prods by category id 
           if (!prod_cate_in($p['id'], $set['cate_id'], $prods_cate_ref_all)) continue;

            //filter prods by tags of set not in prod title, website ...
                $arr = array($p['title'], $p['website'], $p['detail'], $p['shop'], $p['tags']);
           if (!tags_in($set['tags'], $arr)) continue; 

               $res[$j]['name'] = $v['name'];
           $res[$j]['prod_id'] = $p['id'];
               $res[$j]['uuid'] = $v['uuid'];
               $res[$j]['msg'] = '...';
               $j++;
       }

   }

   save_to_msg($res);

function prod_in($prod_id, $uuid, $prod_all){
    foreach($prod_all as $v){
    if ($v['prod_id'] == $prod_id &amp;&amp; $v['uuid'] == $uuid)
        return true;
    }
    return false;
}

function prod_cate_in($prod_id, $cate_id, $prod_cate_all){
    foreach($prod_cate_all as $v){
    if ($v['prod_id'] == $prod_id &amp;&amp; $v['cate_id'] == $cate_id)
        return true;
    }
    return false;
}

function tags_in($tags, $arr){
    $tag_arr = explode(',', str_replace('，', ',', $tags));
    foreach($tag_arr as $v){
    foreach($arr as $a){
        if(strpos($a, strtolower($v)) !== false){
        return true;
        }
    }
    }
    return false;
}

function msg_in($prod_id, $uuid, $msg_all){
    foreach($msg_all as $v){
    if ($v['prod_id'] == $prod_id &amp;&amp; $v['uuid'] == $uuid)
        return true;
    }
    return false;
}
</code></pre>

<p>UPDATE:
Thanks a lot.
Yes, data is in mysql, Below is the main struct:</p>

<pre><code>-- user settings to filter prods, 5 max per user
CREATE TABLE setting(
   id INT NOT NULL AUTO_INCREMENT, 
   uuid VARCHAR(100) NOT NULL DEFAULT '',
   tags VARCHAR(100) NOT NULL DEFAULT '',
   site_id SMALLINT UNSIGNED NOT NULL DEFAULT 0,
   city_id MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,
   cate_id MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,
   addtime INT UNSIGNED NOT NULL DEFAULT 0,
   PRIMARY KEY (`id`), 
   KEY `idx_setting_uuid` (`uuid`),
   KEY `idx_setting_tags` (`tags`),
   KEY `idx_setting_city_id` (`city_id`),
   KEY `idx_setting_cate_id` (`cate_id`)
) DEFAULT CHARSET=utf8;


CREATE TABLE users(
   id INT NOT NULL AUTO_INCREMENT, 
   uuid VARCHAR(100) NOT NULL DEFAULT '',
   PRIMARY KEY (`id`),   
   UNIQUE KEY `idx_unique_uuid` (`uuid`)
) DEFAULT CHARSET=utf8;


-- filtered prods
CREATE TABLE msg_list(
   id INT NOT NULL AUTO_INCREMENT, 
   uuid VARCHAR(100) NOT NULL DEFAULT '',
   prod_id INT UNSIGNED NOT NULL DEFAULT 0,
   msg TEXT NOT NULL DEFAULT '',
   PRIMARY KEY (`id`),
   KEY `idx_ml_uuid` (`uuid`)
) DEFAULT CHARSET=utf8;



-- prods and prod_cate_ref table in another database, so can not join it


CREATE TABLE prod(
   id INT NOT NULL AUTO_INCREMENT, 
   website VARCHAR(100) NOT NULL DEFAULT '' COMMENT ' site name ',
   site_id MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,
   city_id MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,
   title VARCHAR(50) NOT NULL DEFAULT '',
   tags VARCHAR(50) NOT NULL DEFAULT '',
   detail VARCHAR(500) NOT NULL DEFAULT '',
   shop VARCHAR(300) NOT NULL DEFAULT '',
   PRIMARY KEY (`id`),
   KEY `idx_prod_tags` (`tags`),
   KEY `idx_prod_site_id` (`site_id`),
   KEY `idx_prod_city_id` (`city_id`),
   KEY `idx_prod_mix` (`site_id`,`city_id`,`tags`)
) DEFAULT CHARSET=utf8;

CREATE TABLE prod_cate_ref(
   id MEDIUMINT NOT NULL AUTO_INCREMENT, 
   prod_id INT NOT NULL NULL DEFAULT 0,
   cate_id MEDIUMINT NOT NULL NULL DEFAULT 0,
   PRIMARY KEY (`id`),
   KEY `idx_pcr_mix` (`prod_id`,`cate_id`)
) DEFAULT CHARSET=utf8;


-- ENGINE all is myisam
</code></pre>

<p>I don't know how to use just one sql to fetch all. </p>
","<php><algorithm><refactoring><large-data>","2","133","2011-08-27 17:37:47"
"7223240","Refactoring over several branching with a lot of directory structure changes","<p>There is a very large Visual Studio solution (almost 200 projects) which I need to refactor and restructure, merging and possibly dividing many of those projects, altering code...</p>

<p>The issue is - I am to be working on a branch of the code, while several more branches will be moving forward with development. After my refactoring is complete, the changes need to be 
applied to some of those branches, which might been have drastically changed. Also, my directory structure will changed dramatically, many parts of it renamed or merged.</p>

<p>The question is - is it reasonable to rely on SVN to merge the projects in the future or do I need an external tool? Or perhaps writing my own tool.</p>

<p>Sorry for the basic question, I am relatively new to SVN and not sure if it is the best way to go.</p>
","<svn><refactoring>","1","89","2011-08-28 19:10:26"
"7223848","How to Refactor this simple Ruby algorithm","<p>Ok, I have this ruby script which opens a file and passes each line to the <strong>line_parser</strong> method. This method simply changes tabs for a couple of spaces. Here it is:</p>

<pre><code>$lines = []

def line_parser(line)   
    line.gsub! /\t/, '  '
    $lines[$lines.length] = line
end

f = File.open(ARGV[0], 'r').each { |line| line_parser(line) }
f.close

f = File.open(ARGV[0], 'w')
$lines.each { |line| f.puts line}
f.close
</code></pre>

<p>As you can see it has two loops; <strong>one loop</strong> to iterate over the lines of text inside the file an place them inside of an array. And the other loop writes the file all over again with the <em>new</em> lines from the recently created array.</p>

<p>My question is simple I think:
<strong>How can I refactor this snippet so that I do all the steps described above inside one loop only?</strong></p>

<p>I know it can be done, I just have not been able to do it with my current ruby knowledge.</p>

<p>Thanks in advance!</p>
","<ruby><algorithm><refactoring>","1","99","2011-08-28 20:48:31"
"7225527","How can I DRY this code and clean up my model?","<p>I have the following two methods for a <code>Number</code> model.</p>

<pre><code>def track
  number = sanitize(tracking)

  case determine_type(number)
  when 'UPS'
    tracker = ups.track(:tracking_number =&gt; number)
    self.carrier              = Carrier.where(:name =&gt; 'UPS').first
    self.service              = tracker.service_type
    self.destination_country  = tracker.destination_country
    self.destination_state    = tracker.destination_state
    self.destination_city     = tracker.destination_city
    self.origin_country       = tracker.origin_country
    self.origin_state         = tracker.origin_state
    self.origin_city          = tracker.origin_city
    self.signature            = tracker.signature_name
    self.scheduled_delivery   = tracker.scheduled_delivery_date
    self.weight               = tracker.weight

    tracker.events.each do |event|
      new_event             = Event.new
      new_event.number      = self
      new_event.city        = event.city
      new_event.state       = event.state
      new_event.postalcode  = event.postal_code if event.postal_code
      new_event.country     = event.country
      new_event.status      = event.name
      new_event.status_code = event.type
      new_event.occured_at  = event.occurred_at

      new_event.save
    end
  end

  save
end

def update_number

  case determine_type(number)
  when 'UPS'
    tracker = ups.track(:tracking_number =&gt; tracking)
    self.carrier              = Carrier.where(:name =&gt; 'UPS').first
    self.service              = tracker.service_type
    self.destination_country  = tracker.destination_country
    self.destination_state    = tracker.destination_state
    self.destination_city     = tracker.destination_city
    self.origin_country       = tracker.origin_country
    self.origin_state         = tracker.origin_state
    self.origin_city          = tracker.origin_city
    self.signature            = tracker.signature_name
    self.scheduled_delivery   = tracker.scheduled_delivery_date
    self.weight               = tracker.weight

    last_event = self.events.ordered.first.occured_at

    tracker.events.each do |event|
      if last_event and (event.occurred_at &gt; last_event)
        new_event             = Event.new
        new_event.number      = self
        new_event.city        = event.city
        new_event.state       = event.state
        new_event.postalcode  = event.postal_code if event.postal_code
        new_event.country     = event.country
        new_event.status      = event.name
        new_event.status_code = event.type
        new_event.occured_at  = event.occurred_at

        new_event.save
      end
    end
  end
  save
end
</code></pre>

<p>As you can see, a lot of code is duplicated. And the problem becomes when I start adding the dozen or so other carriers (FedEx, USPS, DHL, etc)...my <code>Number</code> model gets big and hairy fast.</p>

<p>The only real difference between <code>track</code> and <code>update_number</code> is that <code>update_number</code> as an if comparison around the events to check if the events from the carrier are more recent than the latest events I have stored in the database, using that <code>if last_event and (event.occurred_at &gt; last_event)</code> line.</p>

<p>So how can I clean up this code so my model doesn't get so fat?</p>
","<ruby-on-rails><ruby-on-rails-3><refactoring><dry>","0","113","2011-08-29 02:27:00"
"7228108","Tool for extracting base class?","<p>If I have a C# code like this:</p>

<pre><code>public class A {
    public string PropA { get; set; }
    public string PropB { get; set; }

    public string PropZ { get; set; }

}

public class B {
    public string PropA { get; set; }
    public string PropB { get; set; }

    public string PropX { get; set; }
    public string PropY { get; set; }

}
</code></pre>

<p>As <code>PropA</code> and <code>PropB</code> exist in both class, and have the same meaning, I'd like to refactor like this :</p>

<pre><code>public abstract class Base {
    public string PropA { get; set; }
    public string PropB { get; set; }
}

public class A : Base {
    public string PropZ { get; set; }

}
public class B : Base {

    public string PropX { get; set; }
    public string PropY { get; set; }

}
</code></pre>

<p>Using VS 2010, is there any tool/extension that allows me to quickly do that ?
In fact, my actual code contains dozens of property in several classes, not in the same order. This is can be a bit of pain to properly factorize the code... that's why I'm looking for a lazy way to do this</p>
","<c#><visual-studio-2010><refactoring>","4","110","2011-08-29 09:01:30"
"7227882","Eclipse refactoring: move method inside collaborator","<p>I have the following scenario:</p>

<pre><code>public class Controller {

  private ModelRepository repository;

  public int getModelCount() {
    int count = 0;
    List&lt;Model&gt; models = repository.getModels();

    for (Model model : models) {
      if (model.somePredicate()) {
        count++;
      }
    }

    return count;
  }
}
</code></pre>

<p>Now, I'd like to move the <code>getModelCount</code> method inside <code>ModelRepository</code> by using some automated Eclipse refactoring so that I end up with this in the controller:</p>

<pre><code>public class Controller {

  private ModelRepository repository;

  public int getModelCount() {
    repository.getModelCount();
  }
}
</code></pre>

<p>Is this possible in Eclipse Indigo? If yes, how? Thanks!</p>
","<java><eclipse><refactoring><automated-refactoring>","2","143","2011-08-29 08:37:07"
"7229396","how to avoid the repeated code to increase the efficiency","<p>I have a <code>DataGrid</code> view1 and a <code>ListView</code> and when ever I select the list view item(I am passing the <code>ListView</code> item into the query and populating the <code>DataGrid</code> view according that item) </p>

<p>I have wrote some code like this....</p>

<pre><code> private void listview_selectedindexchanged(object sender event args)
 {
     if (listview.SelectedItems.Count &gt; 0 &amp;&amp; listview.SelectedItems[0].Group.Name == ""abc"")
     {
            if(lstview.SelectedItems[0].Text.ToString() == ""sfs"")
            {
              method1();
            }
            else
            {
                // datagrid view1 binding
               blah.....
             }
     }
     if (lstview.SelectedItems.Count &gt; 0 &amp;&amp; lstview.SelectedItems[0].Group.Name == ""def"")
     {

           if(lstview.SelectedItems[0].Text.ToString() == ""xyz"")
           {
               method 1();
           }
           if(lstview.SelectedItems[0].Text.ToString() == ""ghi"")
           {
               method 2(a,b);
           }
           if(lstview.SelectedItems[0].Text.ToString() == ""jkl"")
           {
               method 2(c,d);
           }
           if(lstview.SelectedItems[0].Text.ToString() == ""mno"")
           {
               method 3();
           }

       }
   }  
private void method 1()
{ 
  // datagrid view1 binding
    blahh     
}
private void method 2(e,g)
{
  // datagrid view1 binding
  blah....blah..
}
private void method 3()
{

    // datagrid view1 binding
}
</code></pre>

<p>I have done it like above ... I think this is not an efficient way to do the coding.  and this code consisits of a lot of repeated lines, is there any way to refractor this code to a small bunch of code ......
in order improve the efficiency? </p>

<p>Any ideas and sample snippets for increasing code efficiency would be helpful to me ...</p>

<p>Many thanks in advance....</p>

<p>I am using c# and writting WinForms applications.....</p>
","<c#><winforms><listview><datagridview><refactoring>","6","151","2011-08-29 11:21:06"
"7232299","Can this check digit method be refactored?","<p>I have the following method for doing a check digit on a tracking number, but it just feels lengthy/sloppy. Can it be refactored and just generally cleaned up?</p>

<p>I'm running Ruby 1.8.7.</p>

<pre><code>def is_fedex(number)
  n = number.reverse[0..14]

  check_digit = n.first.to_i

  even_numbers = n[1..1].to_i + n[3..3].to_i + n[5..5].to_i + n[7..7].to_i + n[9..9].to_i + n[11..11].to_i + n[13..13].to_i

  even_numbers = even_numbers * 3

  odd_numbers = n[2..2].to_i + n[4..4].to_i + n[6..6].to_i + n[8..8].to_i + n[10..10].to_i + n[12..12].to_i + n[14..14].to_i

  total = even_numbers + odd_numbers

  multiple_of_ten = total + 10 - (total % 10)

  remainder = multiple_of_ten - total

  if remainder == check_digit
    true
  else
    false
  end
end
</code></pre>

<p><strong>EDIT:</strong> Here are valid and invalid numbers.</p>

<p>Valid: 9612019950078574025848</p>

<p>Invalid: 9612019950078574025847</p>
","<ruby><refactoring>","0","104","2011-08-29 15:33:16"
"7233389","Unrecognized selector sent to an instance after refactoring - Xcode4","<p>I'm trying to clean up some old code that I wrote to comply with Apple's guidelines on method naming etc. and encountered this. Basically, I have a button in Interface builder and a tapDown action connected to an event handler in my implementation file. I've changed the name of this event handler via the refactor tool built into Xcode. The name of the method is updated in the .h / .m files and in the IB GUI. I've also looked at the raw xml .xib file and there's no trace of my old method name.</p>

<p>When I click on the button however, I get an error saying unrecognized selector <code>oldMethodName:</code>.
The error shows that <em>something</em> is still trying to call my older method, but I'm not sure what it is. What else can it be?</p>

<p>Thanks, <br>
Teja.</p>
","<objective-c><xcode4><refactoring><interface-builder>","0","69","2011-08-29 17:12:06"
"7233523","C#: Simplifying many similar implicit operator methods","<p>I have a class with a bunch of <code>implicit operator</code>s. In the code below, only a few examples of the <code>implicit operator</code>s are used. I'm looking for any ideas how to refactor this, without making the <code>SafeValue</code> class generic. Any ideas?</p>

<pre><code>public class SafeValue {
    private readonly object value;
    public SafeValue(object value) {
        if (value == somethingSpecial) {
            value = null;
        }
        this.value = value;
    }
    public static implicit operator string(SafeValue instance) {
        return (string)instance.value;
    }
    public static implicit operator int(SafeValue instance) {
        if (instance.value == null) {
            throw new InvalidCastException(""Cannot convert type"");
        }
        return (int)instance.value;
    }
    public static implicit operator int?(SafeValue instance) {
        if (instance.value == null) {
            return null;
        }
        return new int?((int)instance.value);
    }
    public static implicit operator DateTime(SafeValue instance)
        if (instance.value == null) {
            throw new InvalidCastException(""Cannot convert type"");
        }
        return (DateTime)instance.value;
    }
    public static implicit operator DateTime?(SafeValue instance) {
        if (instance.value == null) {
            return null;
        }
        return new DateTime?((DateTime)instance.value);
    }
}
</code></pre>
","<c#><generics><refactoring><operators>","2","193","2011-08-29 17:24:16"
"7244471","How to handle step-by-step refactory of some heavily used libraries?","<p>I have a couple of libraries that were targetting multiple platforms, of which some realtime ones that did/do not have decent STL support, let alone tr1 or C++11. This means everything uses the library's own string/array/list/younameit classes. Now these platforms are getting abandoned in favour of 'pure' C++11 and STL (which I am very very glad for: the latest lib I did is the first one with the new standard and development time has shortened a lot, while code quality went up).</p>

<p>Now I want new projects to not depend on the custom string/array/... classes, and I'm planning to go for a step-by-step refactory: whenever I need some class, create a duplicate (well not a complete duplicate; still that hurts, but is there another option?) that uses STL instead. In the beginning that might mean a whole tree of classes might need changing at once. At the same time the original code should keep working for the next 4 years or so.</p>

<p>Practically the main question I'm facing now is: where do I put these new classes? For example</p>

<pre><code>A\A.h depends on B\B.h and string.h
</code></pre>

<p>should become </p>

<pre><code>a new A.h depending on a new B.h and &lt;string&gt;
</code></pre>

<p>Do I make a new class NewA and put in in A.h? Or make a class A in a new namespace and store it in <code>A\newA.h</code>? Or do I make a whole new subdirectory structure like <code>new\A\A.h</code> and <code>new\B\b.h</code>?</p>

<p>I know there are already a couple of similar questions, with great answers, but I'd like some more <em>practical</em> advice, not ""read Working Effectively with Legacy Code"". Though that is, with reason, a good answer, I'm more interested in what <em>you</em> practically did in a similar situation? </p>

<p><strong>edit</strong> some clarification:</p>

<ul>
<li>The majority of the current applications will also be ported to use STL in time as they will all run on the new platform (still in doubt about RTX or InTime, but one of those).</li>
<li>I do use a VCS, git, and pretty much everything that matters is covered by unit tests. Else this would be madness.</li>
<li>There's no real team and I'm on my own (unfortunately I cannot count my collegue as a team member when it comes to things like this, though being almost twice my age his programming level is less then half of mine, and I'm not even that skilled. </li>
</ul>
","<c++><refactoring><project-management><c++11>","3","87","2011-08-30 14:02:20"
"7244743","Javascript refactoring in Vim","<p>I don't need anything super fancy, but some scope aware refactoring would be nice.</p>

<p>Refactoring something in function scope is one of the most common scenarios for me: </p>

<pre><code>var funyfun = function(arg1, arg2) {

    arg1 = ...arg2;
    arg2....();
}
</code></pre>

<p>Is there a vim plugin that would allow me to refactor arg1, for ex, in the scope of that function or do I have to invent my own ""select block, find, replace"" shortcut.</p>

<p>For extra kudos, something that would ""refactor on the fly"" as I type, so I can see where changes are being made. Netbeans does an excellent job of this.</p>
","<javascript><vim><refactoring>","2","373","2011-08-30 14:23:09"
"7250097","Trying to refactor to Null object pattern but the end result seems worse","<p>I'm refactoring a big class that has a lot of checks for null all over the place into using the null object pattern. So far it's been an almost smooth change but I am having a couple of issues with the end result and I would like to know if there is a better or different approach or even to go back the way it was.</p>

<p>The biggest problem is that I have the following code:</p>

<pre><code>IMyObject myObject = GetMyObject();
if(myObject != null &amp;&amp; !myObject.BooleanProperty)
   DoSomething();
</code></pre>

<p>So as you can see I could probably remove the null check from this condition but I have a boolean property which if set to the default value will execute a piece of code. If I always return true I might introduce subtle bugs that would be painful to find and eliminate.</p>

<p>Another problem is that I've had to modify a check from null like this:</p>

<pre><code>if(myObject.GetType() != typeof(MyNullObject))
   return false;

DoSomething();
</code></pre>

<p>This is just plain ugly since instead of just checking for null, now I have to check the type. This kind of situation happens three times in the class since I am not returning one of the object's properties or executing one of its methods I must do this check.</p>

<p>And lastly the object has a couple of DateTime properties which are not nullable and the architect does not want them to be nullable. Again by having the MinDate value as default some nasty bugs could crawl into the code.</p>

<p>So there you have it. Is this a case in which the null object pattern is just worse than the spaghetti null checks scattered all over? Is there a better way to accomplish this?</p>

<p>Thanks for your answers. </p>
","<c#><refactoring><null-object-pattern><null-object>","4","167","2011-08-30 21:33:55"
"7256009","Refactoring large constructors","<p>We have a few objects in our domain model with what you would comically term <strong><em>offensively</em></strong> large constructors, so large that IntelliSense gives up trying to show it all to you...</p>

<p>Cue a type with 50 or so arguments, mostly value types, a few reference types:</p>

<pre><code>public class MyLegacyType
{
    public MyLegacyType(int a1, int a2, int a3, ... int a50) // etc
    {
    }
}
</code></pre>

<p>I'll say it now, no this type cannot change.  The type itself logically represents one entity, which happens to be property-heavy.  Callers constructing this type provide the majority of the arguments from multiple sources, though some are defaulted.  Perhaps there is a pattern for the sources to be provided to construction instead of the results.</p>

<p>However, what can change is how the type is created.  Currently we have sections of code that suffer from:</p>

<ul>
<li>Lack of IntelliSense on the type.</li>
<li>Ugly and unreadable code. </li>
<li>Merging pains of due to <a href=""http://onestepback.org/articles/connascence/conposition.html"" rel=""nofollow"">Connascence of Position</a>.</li>
</ul>

<p>One immediate answer is to utilise optional parameters for default values and named arguments to help with the merging.  We do this to some degree on other types, works ok.</p>

<p>However, it feels as though this is halfway to the full refactoring.</p>

<p>The other obvious solution is to reduce constructor parameters with container types that have properties for what used to be constructor arguments.  This tidies the constructors nicely, and allows you to embed default values in the containers, but essentially moves the problem onto another type and possibly amounts to the same as optional / named parameter usage.</p>

<p>There is also the concept of Fluent constructors... both on a per property (<code>WithIntA</code>, <code>WithIntB</code>) or container type (<code>WithTheseInts(IntContainer c)</code>) basis.  Personally, I like this approach from the calling side, but again on a large type it gets wordy and feels as though I've just moved a problem instead of solving one.</p>

<p>My question, if there is one buried in this mess, is: <strong>are these viable refactoring tactics for the problem?</strong>  Please flesh any answer out a bit with some relevant experience, pitfalls, or criticisms.  I'm leaning towards the Fluent stuff, because I think it looks cool and is quite readable and merge-friendly.</p>

<p>I feel as though I'm missing the Holy Grail of constructor refactorings - so I'm open to suggestions.  Of course, this could also just be an unfortunate and unavoidable side effect of having a type with this many properties in the first place...</p>
","<c#><c#-4.0><refactoring>","5","193","2011-08-31 11:02:06"
"7262701","How to refactor function parameters for this logic: ""param 2 is only needed if param 1 is true""?","<p>I have to following functions:</p>

<pre><code>public enum class SetMinMaxMode
{
    Auto, // min and max is set based on the channel data
    Manual
};

generic&lt;typename T&gt; where T : System::ValueType
void SetData(array&lt;T&gt;^ data)
{
    SetData(data, SetMinMaxMode::Auto, Double::MinValue, Double::MaxValue);
}

generic&lt;typename T&gt; where T : System::ValueType
void SetData(array&lt;T&gt;^ data, SetMinMaxMode minMaxMode, Double minValue, Double maxValue)
{
    //
}   
</code></pre>

<p>The parameter minValue and maxValue is only used when parameter minMaxMode is SetMinMaxMode::Manual.</p>

<p>If someone writes function like this:</p>

<pre><code>SetData(data, SetMinMaxMode::Auto, desiredMinValue, desiredMaxValue);  
</code></pre>

<p>Then he might not know that the last two parameters are not going to be used.  </p>

<p>My questions is, is there any way to refactor so that someone will never need to supply unnecessary parameters?</p>
","<refactoring>","0","53","2011-08-31 20:01:01"
"7277348","How to get basic Visual Studio features for javascript (VS 2010)","<p>I'm looking for a good way to add a couple capabilities to VS 2010's javascript intellisense that are working properly for C#. Specifically, I want to:</p>

<ul>
<li>reliably refactor javascript code</li>
<li>go to the function definition (<code>F12</code> for me) and </li>
<li>check for all uses of a function or item (<code>Shift</code> + <code>F12</code> for me).</li>
</ul>

<p>I'm aware of <a href=""http://www.devexpress.com/Products/Visual_Studio_Add-in/Refactoring/"" rel=""nofollow"">Refactor!</a> and <a href=""http://www.wholetomato.com/default.asp"" rel=""nofollow"">Visual Assist X</a>, but I haven't found any comment on how well the features they advertise are supported in javascript. Most of the features they advertise seem to be based on languages that are much less dynamic.</p>

<p>So, I ask:</p>

<ol>
<li>Any comment on the plugins mentioned above?</li>
<li>Are there any other good plugins that add these features (or most of them) to VS 2010?</li>
<li>Are there any IDE's that approach this feature set?</li>
</ol>
","<javascript><visual-studio-2010><refactoring><intellisense>","0","58","2011-09-01 22:31:38"
"7281816","How to Remove Duplicated Codes in This Design?","<p>I have about 30 data access classes and all of them contain a GetAll method with some parameters.</p>

<p>My code in all of them looks like below:</p>

<pre><code>public IEnumerable&lt;IHierarchyDivisionDailyResult&gt; GetAll(short masterId, DateTime startDate, short gbuId)
    {
        var cacheKey = this.Cache.CreateCacheKey(this, masterId, startDate, gbuId);

        var result = this.Cache.GetList&lt;IHierarchyDivisionDailyResult&gt;(cacheKey);

        if (result != null) return result;

        lock (LockObject)
        {
            result = this.Cache.GetList&lt;IHierarchyDivisionDailyResult&gt;(cacheKey);

            if (result != null) return result;

            using (var dataContext = OscaDataContext.CreateWithCustomTimeOut())
            {
                result = dataContext.HierarchyDivisionDaily(masterId, startDate, gbuId).ToList();
                this.Cache.Add(cacheKey, result);
            }
        }

        return result;
    }
</code></pre>

<p>I'd like to refactor the code so that the duplicated codes get removed. How would that be possible?</p>

<p>What are common/different in each implementation are:</p>

<ul>
<li>CreateCacheKey always gets all the input parameters</li>
<li>Cache.GetList - though the type could be different</li>
<li>The return type of GetAll method is different in each implementation</li>
<li>Locking exists in all of them as above</li>
<li>The dataContext object is always created as above</li>
<li>dataContext.Entity(...) is also different</li>
</ul>

<p>One possible option I thought was to use Reflection to find out the input parameters and output type, then I'll be able to merge most of the code but the performance of the Reflection approach wouldn't be great I've read.</p>

<p>What would be so ideal would be to be able to add a ""Cache"" attribute to the method so that the result gets cached automatically!</p>

<pre><code>

[Cache]
public IEnumerable GetAll(short masterId, DateTime startDate, short gbuId)
 {
    using (var dataContext = OscaDataContext.CreateWithCustomTimeOut())
    {
        return dataContext.HierarchyDivisionDaily(masterId, startDate, gbuId).ToList();
    }
 }

</code></pre>

<p>What do you think?</p>

<p>Thanks,</p>
","<design><caching><reflection><refactoring>","1","33","2011-09-02 09:56:02"
"7293636","what is best java libraries to write custom refactoring scripts?","<p>I plan to do complex refactoring of large project, default ide capabilities is not enough. Please also provide tutorial link if possible.</p>

<p>Language: java, xml</p>

<p>I talk about programmatic api for java refactoring</p>

<p>Example I have created new api in project and I want automatically refractor some code to use it, ie source to source transformation of ast tree</p>
","<java><eclipse><ide><refactoring><automated-refactoring>","3","154","2011-09-03 14:14:20"
"7303330","How to refactor a method to make it easier to test","<p>Below is a method that I'm having a hard time figuring out how to test using JUnit.<br>
This method is difficult to test because it depends on the results of other methods (e.g. getClosestDcoumentCode).    </p>

<p>Based on my reading of JUnit, this suggests I should refactor the method.   But how?    And if refactoring is not necessary, how do you test a method that depends on other methods?</p>

<p>Thank you,</p>

<p>Elliott</p>

<pre><code>private static String findPrincipal(List&lt;DocumentKey&gt; documentkeys_) {
    Hashtable&lt;String, Integer&gt; codecounts = new Hashtable&lt;String, Integer&gt;();
    for (DocumentKey document : documentkeys_) {
        int x = 0;
        String closestCode = getClosestDocumentCode(document.candidates);
        if (closestCode == null) continue;
        int thecount = 0;
        if (codecounts.containsKey(closestCode))
            thecount = codecounts.get(closestCode);
        if (document.hasKey)
            thecount += 2;
        else
            thecount++;
        codecounts.put(closestCode, new Integer(thecount));
        x++;

    }
    String closestCode = getClosestCode(codecounts);
    return closestCode;
}
</code></pre>
","<java><testing><refactoring><junit>","1","85","2011-09-05 02:09:08"
"7305110","What are proper steps to rename an application in Android?","<p>I usually code games that the boss hasn't decided its name yet, and he usually gives the name once it is finished. However, when I rename all old name to new name, many issue happens.</p>

<p>For example: when starting a project, I set <code>application name</code> to <code>abc</code>, <code>package name</code> to <code>com.company.abc</code>, then the given game name is <code>def</code>, how can I change all the related to new name, without forget anywhere?</p>
","<android><refactoring><name><rename>","1","722","2011-09-05 07:39:01"
"7305651","How to refactor sequential ifs?","<p>I wrote this code. It's really ugly. I would like to refactor it. I MUST return a <code>object[]</code>. I was thinking maybe using a <code>bool</code> value to check if I have to move forward calling other methods and just having the final <code>object[]</code> creation.</p>

<pre><code>private object[] TrasferisciSingoloFile(some parameters...)
{
    Result result = new Result;

    result = FTPRename(some parameters...);
    if (result.error)
    {
        result.SetError(""Some Problem 1"");
        object tip = new object[] { par as ThreadCounterManager, result };
        return (object[])tip;
    }

    result = FTPDownloadAndCopy(some parameters...);
    if (result.error)
    {
        result.SetError(""Some Problem 2"");
        object tip = new object[] { par as ThreadCounterManager, result };
        return (object[])tip;
    }

    result = FTPMove(some parameters...);
    if (result.error)
    {
        result.SetError(""Some Problem 3"");
        object tip = new object[] { par as ThreadCounterManager, result };
        return (object[])tip;
    }

    result = FTPDelete(some parameters...);
    if (result.error)
    {
        result.SetError(""Some Problem 4"");
        object tip = new object[] { par as ThreadCounterManager, result };
        return (object[])tip;
    }

    object tip1 = new object[] { par as ThreadCounterManager, result };

    return (object[])tip1;
}
</code></pre>
","<c#><refactoring>","1","99","2011-09-05 08:39:46"
"7310285","is Martin Fowler's book Refactoring still a worth buy?","<p>The book is old and haven't heard that any new edition is coming our way. I want to improve my software engineeering / architecture skills, but I'm not so sure where to start.</p>
","<architecture><books><refactoring><software-engineering>","1","210","2011-09-05 15:52:54"
"7324803","Refactor switch statement that assigns different variables depending on case?","<p>How can I refactor a switch statement that is in multiple places in code that assigns a value to a variable depending on which case is thrown, for example:</p>

<pre><code>int a = 0;
int b = 0;

switch(c)
{
   case ""1""
      a = 1;
      break;
   case ""2""
      b = 2;
      break;

}
</code></pre>

<p>In the above example, resharper will use one of the variables as the return and the other as an out parameter.  Is there another way to do it, maybe not extracting out the whole switch block.</p>
","<c#><refactoring><refactor-my-code>","2","213","2011-09-06 19:03:18"
"7330019","Is this a good way to reuse / share a method?","<p>I encountered this code wherein a method call, for example ClassA.search(a, b, flag) is being used by 3 Controllers. This is a simplified version of the method:</p>

<pre><code>public List&lt;Result&gt; search(Object a, Object b, boolean flag) {
   //do some code logic here, common to the 3 controllers
   //at the middle there is:
   if (flag) {
      //code that affects 2 Controllers
   } else {
      //code affects only 1
   }
   //some more common code
   //some more code with the flag if else
}
</code></pre>

<p>Is this a good idea because code is reused? Or is there a better way to still be able to make code reuse but not introduce this flag for method caller (client) code customization (like maybe split it to 3 different methods but still be able to declare a common code refactored method)?</p>
","<java><refactoring><refactor-my-code>","5","106","2011-09-07 07:01:15"
"7336706","Refactoring c# : How to remove duplicated code when properties to update differ in each case","<p>After hacking about for a little while on a prototype I've ended up with number of methods that update boolean flags on an object and then update interface and do some processing based on the new value. These are pretty much all the same - but the value they update is different</p>

<p>for example - imagine we have a bunch of colored boxes to update - I might have some methods that look like this:</p>

<pre><code>        protected void SetBlueBoxVisibility(bool blueBoxVisibility)
    {
        Project project = LoadProject();
        project.ShowBlueBox = blueBoxVisibility
        ReDrawSomeThings();
        CalcualteSomeStuff();
        Project.UpdateBoxStatus();
        SaveProject(project);
        ShowBlueBoxPanel(blueBoxVisibility);
        RaiseStatusUpdated();
    }

    protected void SetRedBoxVisibility(bool redBoxVisibility)
    {
        Project project = LoadProject();
        project.ShowRedBox = redBoxVisibility
        ReDrawSomeThings();
        CalcualteSomeStuff();
        Project.UpdateBoxStatus();
        SaveProject(project);
        ShowRedBoxPanel(redBoxVisibility);
        RaiseStatusUpdated();

    }       
</code></pre>

<p>Now, obviously - most of that stuff is repeated - which is a pain when I come to change anything. Particularly if I end up with twenty different box colors rather than just two!</p>

<p>I was thinking that there must be a way to strip out the code that changes and gather the stuff that's the same in a more generic method - but I'm having trouble getting to quite how to do that.</p>

<p>I've heard of closures - but I haven't gotten my head around them enough to know if they would help here.</p>

<p>I was thinking possible the following might be on the right line - but I'm I don't know how to tell the generic method which property to operate on - <strong>[Project Variable To Update]</strong></p>

<pre><code>        protected void SetRedBoxVisibility(bool redBoxVisibility)
    {
        SetGenericBoxVisibility([Project Variable To Update],redBoxVisibility)
        ShowRedBoxPanel(redBoxVisibility);
        RaiseStatusUpdated();   
    }

    protected void SetBlueBoxVisibility(bool blueBoxVisibility)
    {
        SetGenericBoxVisibility([Project Variable To Update],blueBoxVisibility)
        ShowBlueBoxPanel(blueBoxVisibility);
        RaiseStatusUpdated();   
    }

    protected void SetGenericBoxVisibility([Project Variable To Update], boxVisibility)
    {
        Project project = LoadProject();
        project.**[Project Variable To Update]** = boxVisibility
        ReDrawSomeThings();
        CalcualteSomeStuff();
        Project.UpdateBoxStatus();
        SaveProject(project);
    }
</code></pre>

<p>Any pointers as to how to handle this kind of thing would be useful :)</p>
","<c#><refactoring><code-duplication>","2","151","2011-09-07 15:44:04"
"7350220","How can I refactor this if/else statement?","<p>Here's the if/else statement:</p>

<pre><code>if number.events.blank?
  Resque.enqueue(ProcessNumbers, number.id)
elsif number.events &amp;&amp; !number.events.ordered.first.status.downcase.include? 'delivered'
  Resque.enqueue(ProcessNumbers, number.id)
end
</code></pre>

<p>Ultimately trying to say: ""If <code>number.events</code> is blank, run <code>enqueue</code>. Or if <code>number.events.ordered.first.status.downcase.include</code> includes 'delivered' (but make sure <code>number.events</code> actually has something).""</p>
","<ruby-on-rails><ruby><refactoring>","0","120","2011-09-08 15:03:31"
"7350316","Refactor two jQuery UI auto-completes to be more Functional & DRY","<p>I have two jQuery UI auto-completes on the same page and I'd like to make the code more ""functional"" and terse.  My background is almost strictly OO and I'd like to get more serious about writing more functional JavaScript.  </p>

<p>Both of these functions are properties of an object literal that I'm using to namespace the functions on the page. Right now there is a lot of code that's repeated between the functions and I'd like to use something similar to the ""<a href=""http://msdn.microsoft.com/en-us/scriptjunkie/gg575560"" rel=""nofollow"">partial application</a>"" pattern to reduce the code.  </p>

<p>autocomplete 1:</p>

<pre><code>initProject : function(){
    var selected = 0;
    var suggestions = []; 
    var projs;
    var len;

    $(""#projectNum"").autocomplete({
        source : function(req, add){
            $.getJSON(""projectList.do?method=viewProjectListJSON&amp;contractID="" + req.term, function(data){
                //clear the suggestions array
                suggestions = [];

                projs = data[0];

                len = projs.length;

                for(var i = 0; i &lt; len; i++){
                    suggestions.push(projs[i][1]);
                };
                add(suggestions);   

            });//end getjson callback
        }, 

        minLength : 2,

        select : function(){
            thisval = $(this).val();

            for(var i = 0;i &lt; len; i++){

                if(thisval === projs[i][1]){
                    $(""#projectID"").val(projs[i][0]);
                    return;
                }   
            }
        }
    })
},
</code></pre>

<p>autocomplete 2:</p>

<pre><code>initCAU : function(){
    var selected = 0;
    var suggestions = [];
    var caus;
    var len;
    $(""#cauNum"").autocomplete({
        source : function(req, add){
            $.getJSON(""cauList.do?method=viewCAUListJSON&amp;cauNumber="" + req.term, function(data){
                suggestions = [];

                caus = data[0];
                len = caus.length;

                for(var i = 0; i &lt; len; i++){
                    suggestions.push(caus[i][1].toString());
                };
                add(suggestions);   
            }); //end getjson callback
        }, 

        minLength : 2,

        select : function(){
            thisval = $(this).val();

            for(var i = 0;i &lt; len; i++){

                if(parseInt(thisval,10) === caus[i][1]){
                    $(""#cauID"").val(caus[i][0]);
                    return;
                }   
            } 
        }
    })
},
</code></pre>
","<javascript><jquery-ui><functional-programming><refactoring>","0","52","2011-09-08 15:10:24"
"7350672","How can i refactor these two methods","<p>hi i have two methods like and three more methods (not mention in this question) ..</p>

<p>how can i refactor these ones ..</p>

<p><strong>Method 1</strong> :</p>

<pre><code>   public  DataTable GetVisits(System.DateTime startdate , System.DateTime enddate)
     { 


         const string sql  = @""SELECT CONCAT(UPPER(SUBSTRING(visit_Status, 1, 1)), SUBSTRING(visit_Status FROM 2))  as Status, COUNT('x') AS Visits
                              FROM visits
                              WHERE visit_Date BETWEEN @startdate AND @enddate
                              GROUP BY visit_Status"";

         var tblvisits = new DataTable();

         using (var conn = new MySql.Data.MySqlClient.MySqlConnection(connectionstring))
         {
             conn.Open();

             var cmd = new MySql.Data.MySqlClient.MySqlCommand(sql, conn);


             var ds = new DataSet();

             var parameter = new MySql.Data.MySqlClient.MySqlParameter(""@startdate"", MySql.Data.MySqlClient.MySqlDbType.DateTime);
             parameter.Direction = ParameterDirection.Input;
             parameter.Value = startdate.ToString(dateformat);
             cmd.Parameters.Add(parameter);

             var parameter2 = new MySql.Data.MySqlClient.MySqlParameter(""@enddate"", MySql.Data.MySqlClient.MySqlDbType.DateTime);
             parameter2.Direction = ParameterDirection.Input;
             parameter2.Value = enddate.ToString(dateformat);
             cmd.Parameters.Add(parameter2);

             var da = new MySql.Data.MySqlClient.MySqlDataAdapter(cmd);

             da.Fill(ds);
             try
             {
                 tblvisits = ds.Tables[0];

             }
             catch
             {
                tblvisits = null;

             }

         }
         return tblvisits;
     }
</code></pre>

<p><strong>method 2 :</strong>  :</p>

<pre><code>       public DataTable sales(System.DateTime startdate, System.DateTime enddate)
       {
         const string sql = @""SELECT memberAccTran_Source as Category, sum(memberAccTran_Value) as Value
                              FROM memberacctrans
                              WHERE memberAccTran_DateTime BETWEEN @startdate AND @enddate
                              GROUP BY memberAccTran_Source"";

         var memacctvalues = new DataTable();
         using (var conn = new MySql.Data.MySqlClient.MySqlConnection(connectionstring))
         {
             conn.Open();

             var cmd = new MySql.Data.MySqlClient.MySqlCommand(sql, conn);

             var ds = new DataSet();

             var parameter = new MySql.Data.MySqlClient.MySqlParameter(""@startdate"", MySql.Data.MySqlClient.MySqlDbType.DateTime);
             parameter.Direction = ParameterDirection.Input;
             parameter.Value = startdate.ToString(dateformat);
             cmd.Parameters.Add(parameter);

             var parameter2 = new MySql.Data.MySqlClient.MySqlParameter(""@enddate"", MySql.Data.MySqlClient.MySqlDbType.DateTime);
             parameter2.Direction = ParameterDirection.Input;
             parameter2.Value = enddate.ToString(dateformat);
             cmd.Parameters.Add(parameter2);

             var da = new MySql.Data.MySqlClient.MySqlDataAdapter(cmd);

             da.Fill(ds);
             try
             {
                 memacctvalues = ds.Tables[0];

             }
             catch
             {
                 memacctvalues = null;
             }
         }
         return memacctvalues;         
     }
</code></pre>

<p>would any one have any idea how can i refactor these two methods</p>

<blockquote>
  <p>(</p>
  
  <blockquote>
    <p>i have three methods more like this but only difference is sql query
    )</p>
  </blockquote>
</blockquote>
","<c#><.net><winforms><refactoring><refactor-my-code>","0","164","2011-09-08 15:34:17"
"7356542","Applying DRY principles to JavaScript, help me optimize this code?","<p>While on the search for ways to optimize the quality of my code, I eventually came across the concept of DRY (Don't repeat yourself). I try to follow this as best I can but sometimes I get into positions where I have to write two functions that are practically identical, save for 2 or 3 lines of code and I run out of time while trying to figure out the best way to organize it.</p>

<p>So here's my ""question."" I've included two functions below that I wrote a couple weeks ago that are basically identical except for 3 lines at the end, as well as one does an animation by addition and the other with subtraction. I would love to get some input from other developers as to how they would optimize the code below <strong>OR</strong> have examples of unrelated code where you solved a similar problem.</p>

<pre><code>/**
 * Go to the previous notification
 *
 * @private
 * @param {object} cl Click event details (ex. {id: 'linkId', ss: '_', index: '1', e: event})
 * @memberOf APP.devices
 */
function slideNext (cl) {
    var button = $('#' + cl.id + cl.ss + cl.index),
        index = cl.index - 1,
        slider = devices[index].container.find('.slideContainer'),
        // In order to get the value of the 'right' position we must take the (container width - slider width - left position - right-margin)
        slidePos = (slider.parent().width() - slider.width()) + (slider.position().left * -1) + (parseFloat(slider.css('margin-right')) * -1);
    if (button.hasClass('disabled')) {
        return false;
    }
    slider.find('.active').removeClass('active').prev().addClass('active');
    disableButtons(index);
    slider.animate({'right': slidePos + notificationOffset}, 200, function () {
        determineButtonState(index);
    });
    updatePositionContext(index);
}


/**
 * Advance to the next notification
 *
 * @private
 * @param {object} cl Click event details
 * @memberOf APP.devices
 */
function slidePrev (cl) {
    var button = $('#' + cl.id + cl.ss + cl.index),
        index = cl.index - 1,
        slider = devices[index].container.find('.slideContainer');
        // In order to get the value of the 'right' position we must take the (container width - slider width - left position - right-margin)
        slidePos = (slider.parent().width() - slider.width()) + (slider.position().left * -1) + (parseFloat(slider.css('margin-right')) * -1);
    if (button.hasClass('disabled')) {
        return false;
    }
    slider.find('.active').removeClass('active').next().addClass('active');
    disableButtons(index);
    slider.animate({'right': slidePos - notificationOffset}, 200, function () {
        determineButtonState(index);
    });
    updatePositionContext(index);
    // Load more notifications once user get's close to the end of the current set of notifications
    if (slider.find('.active').nextAll().length == 3) {
        getMoreNotifications(index);
    }
}
</code></pre>
","<javascript><refactoring><dry><code-duplication>","0","63","2011-09-09 02:27:38"
"7367916","Java tool to find - copy/ paste code across projects","<p>We inherited some leagcy code that has a whole lot of code copy/pasted across projects. Is there a way to find these? PMD can do a single project</p>
","<java><tools><refactoring><copy-paste>","7","572","2011-09-09 22:01:36"
"7374145","How should I refactor/redesign my code","<p>I'm writing a game in Python and I'm looking for some advice on how to redesign my code. Below is the definition of the movement component for a game entity.</p>

<p>The load function takes a PropertyTree object and sets the attributes of <code>self</code> accordingly. The save function does the opposite: based on the attributes of <code>self</code>, a PropertyTree is generated and returned.</p>

<pre><code>class Movement(EntityComponent):
    def __init__(self):
        # Default values
        self.speed = 0
        self.acceleration = 0

    def load(self, properties):
        self.speed = int(properties['Speed'])
        self.acceleration = int(properties['Acceleration'])

    def save(self):
        pt = PropertyTree()
        pt['Speed'] = str(self.speed)
        pt['Acceleration'] = str(self.acceleration)
        return pt
</code></pre>

<p>The problem with code is that there is a lot of information duplication going on. First, I duplicate the information that associates keys in the PropertyTree with attributes of <code>self</code>, and I also duplicate the keys themselves (<code>'Speed'</code> and <code>'Acceleration'</code> strings appear twice). Obviously, there's a lot of room for mistakes.</p>

<p>How can I refactor this?</p>
","<python><refactoring><duplicate-removal>","1","88","2011-09-10 19:38:39"
"7378004","Refactor code for removal of if else in reports","<p>We have inherited a system which generates a lot of reports. There are comboboxes for selecting different options. Once the different options are selected in comboboxes (atleast 5 comboboxes per form), the reports are generated by calling various stored procedures. </p>

<pre><code>    if cmbCategory.text = ""Category A"" and cmbProdType = ""Kids"" 
    then 
        &lt;code for calling stored proc **SPA** and populating controls on winform&gt; 
    else if cmbCategory.text = ""Category A"" and cmbProdType = ""Mens"" 
    then 
        &lt;code for calling stored proc **SPB** and populating controls on winform&gt; 
    else if cmbCategory.text = ""Category B"" and cmbProdType = ""Shoes"" 
    then 
        &lt;code for calling stored proc **SPC** and populating controls on winform&gt; 
    else if cmbCategory.text = ""Category C"" and cmbProdType = ""Hosiery"" 
    then 
        &lt;code for calling stored proc **SPD** and populating controls on winform&gt; `
</code></pre>

<p>.... and so on. 
Howw to refactor the code to make it more readable?</p>
","<winforms><refactoring>","0","36","2011-09-11 11:53:41"
"7376113","User Control Refactoring - can I do better than this?","<p>I would like to use the User Control below for three different presentation. Because the objects that are in the passed data context have common interfaces, the only two things that will vary from each presentation will be:</p>

<ol>
<li>the image resource (""imgDepartment"")</li>
<li>the FilterPanel control (EmployeeFilterPanel)</li>
</ol>

<p>As it is though, just because of these two items, I need three separate versions of this User with mostly duplicated code.</p>

<p>Can I do that? How?</p>

<p>Cheers,<br>
Berryl</p>

<pre><code>    &lt;DockPanel LastChildFill=""True"" &gt;
    &lt;uc:ListSubjectHeader DockPanel.Dock=""Top"" 
        Subject=""{Binding PresentationSubject}"" 
        AddNewItemCommand=""{Binding AddCommand}"" 
        ImageSource=""{StaticResource imgDepartment}"" 
                          /&gt;
    &lt;local:EmployeeFilterPanel  DockPanel.Dock=""Top"" DataContext=""{Binding MasterVm}""/&gt;

    &lt;Grid Margin=""0, 5, 0, 0""&gt;
        &lt;common:MasterListingWorkspacesControl /&gt;
    &lt;/Grid&gt;

&lt;/DockPanel&gt;
</code></pre>

<p><img src=""http://i.stack.imgur.com/sumOx.png"" alt=""enter image description here""></p>

<h1>Update</h1>

<p>Solved the image part by setting up a style and adding a PresentationImageUri property to my ViewModel as below:</p>

<pre><code>&lt;Style x:Key=""ListSubjectHeaderStyle"" TargetType=""{x:Type uc:ListSubjectHeader}""&gt;
    &lt;Setter Property=""DockPanel.Dock"" Value=""Top"" /&gt;
    &lt;Setter Property=""Subject"" Value=""{Binding PresentationSubject}"" /&gt;
    &lt;Setter Property=""AddNewItemCommand"" Value=""{Binding AddCommand}"" /&gt;
    &lt;Setter Property=""ImageSource"" Value=""{Binding PresentationImageUri}"" /&gt;
&lt;/Style&gt;
</code></pre>

<p>Still not sure how to deal with that FilterPanel type yet.</p>
","<wpf><xaml><usercontrols><refactoring>","1","52","2011-09-11 03:19:54"
"7376682","Where to put complex display logic for a Rails Model?","<p>I have a <code>Location#description</code> method that returns a (<strong>really</strong>) long string. This string is a human readable description and it's generated according to the values of the <code>Location</code> attributes. However, this code is long and complex, and puts a lot of ""not-business"" logic in my model.</p>

<p>What is best to do? Bunch all this logic in helpers or create a <code>LocationPresenter</code> class? If I create the presenter, what are some guidelines about doing so? Should I initialize it with a <code>Location</code> or is it okay to use the attribues hash?</p>
","<ruby-on-rails><refactoring><helpers><presentation>","0","50","2011-09-11 06:26:23"
"7391139","Making JavaDoc robust against refactoring","<p>I'm working on an application which is constantly refactored to improve it. Now, if we rename a certain class to better capture its intention, all the documentation mentioning the class does not get updated automatically, unless you use links ({@link ClassName}) to refer to the class. </p>

<p>JavaDoc principles however state that one should ""Use in-line links economically"", since links stand out and draw the readers attention, which I find sensible. Also you can't like to parameters of a method.</p>

<p>Is there another way in JavaDoc to make comments more robust to refactoring I'm not aware of?</p>
","<java><refactoring><javadoc>","9","149","2011-09-12 16:39:52"
"7393620","Removing dependencies from statechart framework","<p>I've got lots of problems with project i am currently working on. The project is more than 10 years old and it was based on one of those commercial C++ frameworks which were very populary in the 90's. The problem is with statecharts. The framework provides quite common implementation of state pattern. Each state is a separate class, with action on entry, action in state etc. There is a switch which sets current state according to received events.</p>

<p>Devil is hidden in details. That project is enormous. It's something about 2000 KLOC. There is definitely too much statecharts (i've seen ""for"" loops implemented using statecharts). What's more ... framework allows to embed statechart in another statechart so there are many statecherts with seven or even more levels of nesting. Because statecharts run in different threads, and it's possible to send events between statecharts we have lots of synchronization problems (and big mess in interfaces).</p>

<p>I must admit that scale of this problem is overwhelming and I don't know how to touch it. My first idea was to remove as much code as I can from statecharts and put it into separate classes. Then delegate these classes from statechart to do a job. But in result we will have many separate functions, which logically don't have any specific functionality and any change in statechart architecture will need also a change of that classes and functions. </p>

<p>So I asking for help:
Do you know any books/articles/magic artefacts which can help me to fix this ? I would like to at least separate as much code as I can from statechart without introducing any hidden dependencies and keep separated code maintainable, testable and reusable.</p>

<p>If you have any suggestion how to handle this, please let me know.     </p>
","<c++><architecture><refactoring><design-patterns><state>","2","141","2011-09-12 20:30:28"
"7399300","Tool/utility to refactor Delphi 6 event handler properties?","<p>I have a component that is used widely throughout my application code base (i.e. - multiple applications).  I want to change one of the commonly used event handler properties.  I need a tool/utility that would go through a Delphi 6 form source file (DFM + PAS) and do a search and replace for the currently defined event handlers for instances of the component on the form.</p>

<p>For example.  Suppose I have an event handler property on the component currently defined as:</p>

<pre><code>property eventHandler1: TOldEventHandlerProc read FOnEvent write FOnEvent;
</code></pre>

<p>Where TOldEventHandlerProc is defined as:</p>

<pre><code>TOldEventHandlerProc = procedure(oneParm: string) of object;
</code></pre>

<p>I want to change TOldEventHandlerProc  to:</p>

<pre><code>TOldEventHandlerProc  = procedure(oneParm: string; twoParm: integer) of object;
</code></pre>

<p>I would want the utility to examine the contents of a Form's DFM/PAS file pair and find all instances of FOnEvent that are defined and swap out the old parameter list for the new parameter list, based on the new definition of TOldEventHandlerProc.  For example, given a form named MyForm1 with an instance of the component named MyComp1 you would have the following IDE generated declaration for the event handler:</p>

<pre><code>TMyForm1 = class(TForm)
    // IDE created event handler stubs.
    procedure MyComp1OnEvent(oneParm: string);
</code></pre>

<p>with the body of the event handler declared as:</p>

<pre><code>procedure TMyForm1.MYCom1OnEvent(oneParm: string);
</code></pre>

<p>The utility would need to find each instance of OnEvent() handler and substitute the header declaration for the event handler and the body declaration for the event handler and swap the parameter lists with the result being:</p>

<pre><code>TMyForm1 = class(TForm)
    // IDE created event handler stubs.
    procedure MyComp1OnEvent(oneParm: string; twoParm: integer);
</code></pre>

<p>with the body of the event handler declared as:</p>

<pre><code>procedure TMyForm1.MYCom1OnEvent(oneParm: string; twoParm: integer);
</code></pre>

<p>If I can't find such a tool I'll write a quick and dirty one myself but I figured I'd ask to see if I could save myself some time.  Does anyone know of such a refactoring tool?</p>
","<delphi><properties><refactoring><event-handling><tform>","2","119","2011-09-13 09:03:18"
"7399555","Rails 2.3 - implement dynamic named_scope using mixin","<p>I use the following method_missing implementation to give a certain model an adaptable named_scope filtering:</p>

<pre><code>class Product &lt; ActiveRecord::Base
  def self.method_missing(method_id, *args)

    # only respond to methods that begin with 'by_'
    if method_id.to_s =~ /^(by\_){1}\w*/i

      # extract column name from called method
      column = method_id.to_s.split('by_').last

      # if a valid column, create a dynamic named_scope
      # for it. So basically, I can now run
      # &gt;&gt;&gt; Product.by_name('jellybeans')
      # &gt;&gt;&gt; Product.by_vendor('Cyberdine')
      if self.respond_to?( column.to_sym )
        self.send(:named_scope, method_id, lambda {|val|
          if val.present?
            # (this is simplified, I know about ActiveRecord::Base#find_by_..)
            { :conditions =&gt; [""#{base.table_name}.#{column} = ?"", val]}
          else
            {}
          end
        })
      else
        super(method_id, args)
      end
    end
  end
end
</code></pre>

<p>I know this is already provided by ActiveRecord::Base using <code>find_by_&lt;X&gt;</code>, but I'm trying to go a little bit beyond the example I've given and provide some custom filtering taylored to my application. I'd like to make it available to selected models w/o having to paste this snippet in every model class. I thought of using a module and then mixing it in the models of choice - I'm just a bit vague on the syntax. </p>

<p>I've gotten as far as this when the errors started piling up (am I doing this right?):</p>

<pre><code>module GenericFilter
  def self.extended(base)

    base.send(:method_missing, method_id, *args, lambda { |method_id, args|
    # ?..
    })

  end
end
</code></pre>

<p>Then I hope to be able to use it like so:</p>

<pre><code>def Product &lt; ActiveRecord::Base
  include GenericFilter
end

def Vendor &lt; ActiveRecord::Base
  include GenericFilter
end

# etc..
</code></pre>

<p>Any help will be great - thanks.</p>
","<ruby-on-rails><activerecord><refactoring><named-scope><mixins>","0","158","2011-09-13 09:24:39"
"7396295","Help cleaning up clojure function","<p>Coming from imperative programming languages, I am trying to wrap my head around Clojure in hopes of using it for its multi-threading capability.  I have been spending some time on 4Clojure.com, as well as reading Practical Clojure by V&amp;S.(not too helpful, will be investing in another book soon).  One of the problems from 4Clojure is to write a function that generates a list of fibonacci numbers of length N, for N > 1. I wrote a function, but given my limited background, I would like some input on whether or not this is the best Clojure way of doing things.  The code is as follows:</p>

<pre><code>(fn fib [x] (cond 
               (= x 2) '(1 1)
            :else   (reverse (conj (reverse (fib (dec x))) (+ (last (fib (dec x))) (-&gt; (fib (dec x)) reverse rest first))))
          ))
</code></pre>

<p>Thanks for your input!</p>
","<refactoring><clojure><fibonacci><4clojure>","4","232","2011-09-13 02:48:48"
"7395971","rails static model validations","<p>I have a Subject model which represents a treeview with parent children nodes.</p>

<p>To move a subject to another branch/node, I need to have a 2 subject id's that represent from and to values.</p>

<p>I have started by putting all of the logic into the controller but am now wanting to reuse the copy method and would like to set it up in the model.</p>

<p>Here is some of my controller code.</p>

<pre><code>def copy
    from = Subject.find(params[:from])
    to = Subject.find(params[:to])

    if to.is_descendant_of? from
        render :json =&gt; {:error =&gt; [""Can't move branch because the target is a descendant.""]}.to_json,  :status =&gt; :bad_request
        return
    end

    if to.read_only?
        render :json =&gt; {:error =&gt; [""Can't copy to this branch as it is read only.""    ]}.to_json,  :status =&gt; :bad_request
        return
    end

    if params[:subjects] == 'copy'
      subject = Subject.create(:name =&gt; from.name, :description =&gt; from.description, :parent_id =&gt; to.id)

      #recursively walk the tree
      copy_tree(from, subject)
    else
      #move the tree
      if !(from.read_only or to.read_only)
        to.children &lt;&lt; from
      end
    end

end
</code></pre>

<p>Here is what I started doing in my model</p>

<pre><code>class Subject &lt; ActiveRecord::Base



    def self.copy(from, to, operations)

        from = Subject.find(from)
        to = Subject.find(to)

        if to.is_descendant_of? from
           #how do I add validation errors on this static method?

        end

    end
end
</code></pre>

<p>My first concern is how to add errors to a static method in a model?</p>

<p>I'm not sure if I'm going about it the right way by using a static method or an instance method.</p>

<p>Anyone able to give me a bit of help in refactoring this code?</p>
","<ruby-on-rails><validation><model><refactoring>","0","98","2011-09-13 01:50:44"
"7407930","Does Resharper 5.1 Refactor (Refactor->Move) Correctly Notify AnkhSVN/maintain SVN history?","<p>My dev environment is Visual Studio 2010, with Resharper 5.1.3000.12 and AnkhSVN 2.1.10129.17 installed.</p>

<p>It's my understanding that Resharper should notify AnkhSVN (or VisualSVN, etc) when a Refactor->Move command is done on a file, to maintain the SVN history on the file.  However, when I do such a refactor through the Solution Explorer in Visual Studio, AnkhSVN treats the file move as a delete/add, thus losing the SVN history for that file.  In fact, Ankh doesn't even add the new version of the file, it just deletes the old one, and I have to manually ""add"" the new one before I can commit.</p>

<p>HOWEVER, if I do a Ctl-X,Ctl-V through the Solution Explorer to move the file, Ankh detects it as a copy/move and maintains the history, auto-adds the new file, and generally behaves as one would expect.</p>

<p>Does this work for anyone else, and if so, did you have to do anything tricky to get it to work?  Have I missed a setting somewhere to wire up AnkhSVN with Resharper, do I perhaps need new versions of either plugin, or perhaps this is some kind of installation order problem? (I installed Resharper first, then Ankh).</p>
","<visual-studio><refactoring><resharper><move><ankhsvn>","4","144","2011-09-13 20:18:51"
"7412535","refactoring long methods with fluent interfaces","<p>I'd like to know your opinion about using the fluent interface pattern to refactor a long method.</p>

<p><a href=""http://en.wikipedia.org/wiki/Fluent_interface"" rel=""nofollow"">http://en.wikipedia.org/wiki/Fluent_interface</a></p>

<p>The fluent pattern is not included in the refactoring books.</p>

<p>for example, say you have this long method (with a long name as it 
does many things)</p>

<pre><code>class TravelClub {

   Receipt buyAndAddPointsAndGetReceipt(long amount, long cardNumber) {
    buy(amount);
    accumulatePoints(cardNumber);
    return generateReceipt();

   }

   void buy(int amount) {...}

   void accumlatePoints(int cardNumber) {...}

   void generateRecepit() {...}

}
</code></pre>

<p>called as:</p>

<pre><code>Receipt myReceipt = myTravelClub.buyAndAddPointsAndGetReceipt(543L,12345678L);
</code></pre>

<p>That could be refactored to:</p>

<pre><code>class TravelClub {

   TravelClub buy(long amount) {
    //buy stuff
    return this;
   }

   TravelClub accumulatePoints(long cardNumber) {
    //accumulate stuff
    return this;
   }

   Receipt generateReceipt() {
    return new Receipt(...);
   }


}
</code></pre>

<p>and called as:</p>

<pre><code>Receipt myReceipt = myTravelClub.buy(543L).accumulatePoints(12345678L).generateReceipt();
</code></pre>

<p>from my point of view this is a quite good manner to decompose a long method and
also to decompose its name.</p>

<p>what do you think?</p>
","<java><refactoring><fluent><fluent-interface>","3","160","2011-09-14 07:11:07"
"7413439","Number of parameters in method","<p>I have Selenium test which fills a form. I have a method for it but this method has overgrown in terms of number of parameters - </p>

<pre><code> newMerchantPage.addEditMerchant(merchantDomain, merchantName,
            merchantCategory, true, merchantDescription, merchantNotes,
            merchantTags, true, true, false, false, merchantTitle,
            additionalDescription, merchantHeading, dummyCouponLink, true);
</code></pre>

<p>There are only Strings and boolean.
I was thinking to use collection and then iterate through collection in called method to do some more processing. Though yet not sure if this is the way to go about. Any recommendations?</p>

<p>MODIFIED METHOD:</p>

<p>After implementing couple of sugggestions my method (of a different method) call looks like -</p>

<pre><code>ContactPage contactPage = new ContactPage(driver); 
setContactFormData(); 
contactPage.setName(name).setEmailAddress(emailAddress).setSubject(subject).setM‌ ​essage(message); 
contactPage.submitContactForm(contactPage); 
</code></pre>

<p>submitContactForm in turn calls different utility methods. How bad does it look? Especially the last line (method call on object and same object being passed as argument) ? </p>
","<java><selenium><refactoring>","4","115","2011-09-14 08:34:14"
"7413933","How to refactor my code using C#","<p>I have two text boxes and one combobox and I am retrieving the data based upon the text entered into the text boxes and combobox selecion ...by using the following method:</p>

<pre><code>        private void textboxfillnames()
        {
              if (txtlastname.Text != """")
              {

            var totalmembers = from tsgentity in eclipse.members
                                 join memtomships in eclipse.membertomships on tsgentity.member_Id equals memtomships.member_Id
                                 join mshipoptiions in eclipse.mshipoptions on memtomships.mshipOption_Id equals mshipoptiions.mshipOption_Id
                                 join mshiptypes in eclipse.mshiptypes on mshipoptiions.mshipType_Id equals mshiptypes.mshipType_Id
                                 join mshipstatus in eclipse.mshipstatustypes on memtomships.mshipStatusType_Id equals mshipstatus.mshipStatusType_Id
                                 where tsgentity.member_Lastname.StartsWith(txtlastname.Text)
                                 select new {
                                     tsgentity.member_Id,
                                     tsgentity.member_Lastname,
                                     tsgentity.member_Firstname,
                                     tsgentity.member_Postcode,
                                     tsgentity.member_Reference,
                                     tsgentity.member_CardNum,
                                     tsgentity.member_IsBiometric,
                                     tsgentity.member_Dob,
                                     mshiptypes.mshipType_Name,
                                     mshipstatus.mshipStatusType_Name,
                                     memtomships.memberToMship_EndDate                                    
                                 };
            dgvReportMembers.DataSource = totalmembers;
        }
        if (txtpostcode.Text != """")
        {

            var totalmembers = from tsgentity in eclipse.members
                              join memtomships in eclipse.membertomships on tsgentity.member_Id equals memtomships.member_Id
                              join mshipoptiions in eclipse.mshipoptions on memtomships.mshipOption_Id equals mshipoptiions.mshipOption_Id
                              join mshiptypes in eclipse.mshiptypes on mshipoptiions.mshipType_Id equals mshiptypes.mshipType_Id
                              join mshipstatus in eclipse.mshipstatustypes on memtomships.mshipStatusType_Id equals mshipstatus.mshipStatusType_Id
                              where tsgentity.member_Postcode.StartsWith(txtpostcode.Text)
                              select new {
                                  tsgentity.member_Id,
                                  tsgentity.member_Lastname,
                                  tsgentity.member_Firstname,
                                  tsgentity.member_Postcode,
                                  tsgentity.member_Reference,
                                  tsgentity.member_CardNum,
                                  tsgentity.member_IsBiometric,
                                  tsgentity.member_Dob,
                                  mshiptypes.mshipType_Name,
                                  mshipstatus.mshipStatusType_Name,
                                  memtomships.memberToMship_EndDate 

                             };
            dgvReportMembers.DataSource =  totalmembers;  
        }
         if (cbGEStatustype.Text != null)
        { 

             var totalmembers = from tsgentity in eclipse.members
                               join memtomships in eclipse.membertomships on tsgentity.member_Id equals memtomships.member_Id
                               join mshipoptiions in eclipse.mshipoptions on memtomships.mshipOption_Id equals mshipoptiions.mshipOption_Id
                               join mshiptypes in eclipse.mshiptypes on mshipoptiions.mshipType_Id equals mshiptypes.mshipType_Id
                               join mshipstatus in eclipse.mshipstatustypes on memtomships.mshipStatusType_Id equals mshipstatus.mshipStatusType_Id
                               where mshipstatus.mshipStatusType_Name.StartsWith(cbGEStatustype.Text)
                                 select new {
                                   tsgentity.member_Id,
                                   tsgentity.member_Lastname,
                                   tsgentity.member_Firstname,
                                   tsgentity.member_Postcode,
                                   tsgentity.member_Reference,
                                   tsgentity.member_CardNum,
                                   tsgentity.member_IsBiometric,
                                   tsgentity.member_Dob,
                                   mshiptypes.mshipType_Name,
                                   mshipstatus.mshipStatusType_Name,
                                   memtomships.memberToMship_EndDate 

                               };
            dgvReportMembers.DataSource = totalmembers;

        }
 }
</code></pre>

<p>Would anyone please help me on this?
Many thanks in advance!</p>

<p>modified code:</p>

<pre><code>    public  IQueryable&lt;member&gt; getmembers()
    {

                             return from tsgentity in eclipse.members
                               join memtomships in eclipse.membertomships on tsgentity.member_Id equals memtomships.member_Id
                               join mshipoptiions in eclipse.mshipoptions on memtomships.mshipOption_Id equals mshipoptiions.mshipOption_Id
                               join mshiptypes in eclipse.mshiptypes on mshipoptiions.mshipType_Id equals mshiptypes.mshipType_Id
                               join mshipstatus in eclipse.mshipstatustypes on memtomships.mshipStatusType_Id equals mshipstatus.mshipStatusType_Id                                   
                               select new 
                               {
                                  tsgentity.member_Id,
                                  tsgentity.member_Lastname,
                                  tsgentity.member_Firstname,
                                  tsgentity.member_Postcode,
                                  tsgentity.member_Reference,
                                  tsgentity.member_CardNum,
                                  tsgentity.member_IsBiometric,
                                  tsgentity.member_Dob,
                                  mshiptypes.mshipType_Name,
                                  mshipstatus.mshipStatusType_Name,
                                 memtomships.memberToMship_EndDate

                           };                         
    }
</code></pre>
","<c#><.net><linq><refactoring><refactor-my-code>","0","127","2011-09-14 09:14:39"
"7421292","How can I convert two methods into a single method to increase efficiency?","<p>How can I convert two methods into a single method to increase efficiency and make clear and concise code?</p>

<p>I have three more conditions like this to check but I did not mention (that's too long):</p>

<pre><code> public void getmembershipstatusmembers()
 {
        if (cbGEStatustype.Text != """")
        {
            var totalmembers = from tsgentity in eclipse.members
                               join memtomships in eclipse.membertomships on tsgentity.member_Id equals memtomships.member_Id
                               join mshipoptiions in eclipse.mshipoptions on memtomships.mshipOption_Id equals mshipoptiions.mshipOption_Id
                               join mshiptypes in eclipse.mshiptypes on mshipoptiions.mshipType_Id equals mshiptypes.mshipType_Id
                               join mshipstatus in eclipse.mshipstatustypes on memtomships.mshipStatusType_Id equals mshipstatus.mshipStatusType_Id
                               where mshipstatus.mshipStatusType_Name.StartsWith(cbGEStatustype.Text)
                               select new
                               {
                                   tsgentity.member_Id,
                                   tsgentity.member_Lastname,
                                   tsgentity.member_Firstname,
                                   tsgentity.member_Postcode,
                                   tsgentity.member_Reference,
                                   tsgentity.member_CardNum,
                                   tsgentity.member_IsBiometric,
                                   tsgentity.member_Dob,
                                   mshiptypes.mshipType_Name,
                                   mshipstatus.mshipStatusType_Name,
                                   memtomships.memberToMship_EndDate
                               };
            dgvReportMembers.DataSource = totalmembers;       
        }
    }
    public void getcardnumbers()
    {
        if (txtcardnum.Text != """")
        {
            var totalmembers = from tsgentity in eclipse.members
                               join memtomships in eclipse.membertomships on tsgentity.member_Id equals memtomships.member_Id
                               join mshipoptiions in eclipse.mshipoptions on memtomships.mshipOption_Id equals mshipoptiions.mshipOption_Id
                               join mshiptypes in eclipse.mshiptypes on mshipoptiions.mshipType_Id equals mshiptypes.mshipType_Id
                               join mshipstatus in eclipse.mshipstatustypes on memtomships.mshipStatusType_Id equals mshipstatus.mshipStatusType_Id
                               where tsgentity.member_CardNum.StartsWith(txtcardnum.Text)
                               select new
                               {
                                   tsgentity.member_Id,
                                   tsgentity.member_Lastname,
                                   tsgentity.member_Firstname,
                                   tsgentity.member_Postcode,
                                   tsgentity.member_Reference,
                                   tsgentity.member_CardNum,
                                   tsgentity.member_IsBiometric,
                                   tsgentity.member_Dob,
                                   mshiptypes.mshipType_Name,
                                   mshipstatus.mshipStatusType_Name,
                                   memtomships.memberToMship_EndDate
                               };
            dgvReportMembers.DataSource = totalmembers;
        }

    }
</code></pre>

<p>I am looking for something like this:</p>

<pre><code> private void allmembers()
 {
       var members = from ......
                          .......
                          .......
        if (cbGEStatustype.Text != """")
        {
           dgvreports.datasource = members.where(.......)
         }
         if (txtcardnum.Text != """")
         {    
             dgvreports.datasource = members.where(.......)
         }
    }
</code></pre>
","<c#><.net><winforms><linq><refactoring>","1","125","2011-09-14 18:37:58"
"7424817","Confusion with multiple interface implementation","<p>I have the following set of Interfaces and Classes.</p>

<pre><code>public interface IValidatableObject
{
   List&lt;string&gt; ValidationErrors { get; }
   bool Validate();
}

public class ValidatableObject : IValidatableObject
{
   public List&lt;string&gt;ValidationErrors { get; }
   public bool Validate()
   {
      //dostuff
   }
}

public interface IDeviceDataObject
{
   int Id { get; set; }
   string Name { get; set; }
}

public class DeviceDataObject : ValidatableObject, IDeviceDataObject
{
   public int Id { get; set; }
   public string Name { get; set; }
}

public class DeviceService
{
   public bool ValidateDevice(IDeviceDataObject device)
   {
       return device.Validate(); // This throws a compiler error
   }
}
</code></pre>

<p>The problem in the service operation ValidateDevice above is that the compiler can't resolve device.Validate() because IDeviceDataObject does not implement the IValidatableObject interface.</p>

<p>My question is, is it then correct to change <code>IValidatableObject</code> to implement <code>IValidatableObject</code>. I'm a little uncertain as to whether this is good practice because the way I kind of see it, <code>DeviceDataObject</code> is implementing <code>IValidatableObject</code> twice - once through <code>ValidatableObject</code> and once through <code>IDeviceDataObject</code>. Can anyone help clear this up for me?</p>

<pre><code>public interface IDeviceDataObject : IValidatableObject
{
   int Id { get; set; }
   string Name { get; set; }
}
</code></pre>
","<c#><oop><inheritance><interface><refactoring>","3","134","2011-09-15 01:11:34"
"7432119","Cleaning up an iOS App?","<p>While I know there is no magical tool that will clean up the code for me, is there any tool that will highlight some of the unused classes/plists/localized strings/xibs and so on? I just took over an app that was built by a third party and it's a mess, I know a majority I'll have to fix manually, but I wasn't sure if there was anything that could get rid of the easy stuff? </p>
","<ios><refactoring>","0","140","2011-09-15 14:01:41"
"7437302","method name for a long method","<p>The good style (Clean Code book) says that a method's name should describe what the method does. So for example if I have a method that verifies an address, stores it in a database, and sends an email, should the name be something such as  <code>verifyAddressAndStoreToDatabaseAndSendEmail(address);</code></p>

<p>or</p>

<p><code>verifyAddress_StoreToDatabase_SendEmail(address);</code></p>

<p>although I can divide that functionality in 3 methods,  I'll still need a method to call these 3 methods. So a large method name is inevitable.</p>

<p>Having And named methods certainly describes what the method does, but IMO it's not very readable as names can be very very large. How would you solve it? </p>

<p>EDIT: Maybe I could use fluent style to decompose the method name such as:</p>

<p><code>verifyAddress(address).storeToDatabase().sendEmail();</code></p>

<p>but I need a way to ensure the order of invocation. Maybe by using the state pattern, but this causes the code to grow. </p>
","<methods><refactoring><name><fluent-interface>","3","61","2011-09-15 20:52:04"
"7439137","Moles and Refactoring code","<p>We are embarking on a new greenfield project in my company and it has been decided that we will use Microsoft's Moles framework for ALL our mocking in unit tests. My manager ideally does not want to introduce any other Mocking frameworks such as NSubstitute or Moq to complicated the project. However I have found that due to the nature in which Moles generates Mocks and Stubs that it does not work nicely with refactoring tools.</p>

<p>For example, we use resharper and if I had the following interface, moles will generate a stub like so:</p>

<p>IMyInterface -> SIMyInterface </p>

<p>Now if I were to refactor IMyInterface to another name such as: IMyNewInterface</p>

<p>then in my unit tests the Stub class is obviously NOT be refactored due to it fundamentally having a different name.</p>

<p>I can see this is a big problem once we get many permutations of unit tests, that refactoring will become a nightmare, and the mantra will be ""Just don't change anything!""</p>

<p>Does anyone have similar experiences or know of a refactoring tool that can handle Moles? </p>

<hr>

<p>Thanks both Merlyn and Mike. My team has decided to compromise and use Moles only for types that we can't mock with standard tools, and then use another framework such as NSubstitute for everything else.</p>
","<c#><refactoring><moles><pex>","2","447","2011-09-16 01:06:17"
"7440563","What is a concrete visual example of refactoring?","<p>I've never used refactoring before (though I've seen the button through an Eclipse dropdown menu), and while I've read the Wikipedia page of what it does, it still doesn't provide me with a concrete visual example of how it's done (of course I know that it's some way to automatically make code more organized). </p>
","<refactoring>","1","102","2011-09-16 05:37:35"
"7442879","Repeatable logic for variety of objects","<p>So here is the code:</p>

<pre><code>return new DistrictInfo { 
    rid = Convert.ToUInt32(((OracleNumber)o.GetOracleValue(""rid"")).Value), 
    doc = Convert.ToUInt16(((OracleNumber)o.GetOracleValue(""doctor"")).Value), 
    secdoc = Convert.ToUInt16(((OracleNumber)o.GetOracleValue(""secdoctor"")).Value), 
    num = Convert.ToUInt16(((OracleNumber)o.GetOracleValue(""num"")).Value), 
    docname = o.GetOracleValue(""doctorname"") as string, 
    slpuname = o.GetOracleValue(""lpuname"") as string, 
    reason = o.GetOracleValue(""reason"") as string, 
    secdocname = o.GetOracleValue(""secdocname"") as string 
};
</code></pre>

<p>Now I need to rewrite this code to do a checking whether object property is existing or not. This should be like this piece of code:</p>

<pre><code>DistrictInfo di;
if (!(o[""rid""].Equals(DBNull.Value)) &amp;&amp; !(o.GetOracleValue(""rid"").Equals(DBNull.Value)) &amp;&amp; (((OracleNumber)o.GetOracleValue(""rid"")).Value != null))
{
    di.rid = Convert.ToUInt32(((OracleNumber)o.GetOracleValue(""rid"")).Value);
}
</code></pre>

<p>But I found this code some kind of awkward and not elegant. I did a many of checking 'cause I want to escape exceptions. 
So the question is how can we refactor this code? Tell me your thoughts. I think there's no need in such many checkings. Another thing we need to specify a variety of object property names to do one block of code for all variety members. I think there's ability to use LINQ for that. Also in first piece of code we see different casting so we need to mention it in our new code. 
Thanks in advance guys!</p>

<p>P.S. Library for working with database is dotConnect for Oracle from devArt.</p>
","<c#><.net><linq><oracle><refactoring>","3","89","2011-09-16 09:47:36"
"7443222","How do I deal with ""signed/unsigned mismatch"" warnings (C4018)?","<p>I work with a lot of calculation code written in C++ with high performance and low memory overhead in mind. It uses STL containers (mostly <code>vector</code>) a lot, and iterates over that containers almost in every single function.</p>

<p>The iterating code looks like this:</p>

<pre><code>for (int i = 0; i &lt; things.size(); ++i)
{
    // ...
}
</code></pre>

<p>but it produces the <em>signed/unsigned mismatch</em> warning (C4018 in Visual Studio).</p>

<p>Replacing <code>int</code> with some <code>unsigned</code> type is a problem because we frequently use OpenMP pragmas, and it requires the counter to be <code>int</code>.</p>

<p>I'm about to suppress the (hundreds of) warnings, but I'm afraid I've missed some elegant solution to the problem.</p>

<p><strong>On iterators</strong>. I think iterators are great when applied in appropriate places. The code I'm working with will <em>never</em> change random-access containers into <code>list</code> or something (so iterating with <code>int i</code> is already container agnostic), and will <em>always</em> need the current index. And all the additional code you need to type (iterator itself and the index) just complicates matters and obfuscates the simplicity of the underlying code.</p>
","<c++><refactoring>","6","831","2011-04-19 09:05:02"
"7478256","need help refactoring this method","<p>is there a more concise way to write this method? maybe with regular expressions?</p>

<pre><code>   /**
 * Find a parameter in the request.pathInfo. In a certain cases we 
     * will send the variables via the path.
 * 
 * For example:
 *    normal request parameters - /ps/cmap?t=i&amp;n=25&amp;xid=1
 *    mapping via path would be - /ps/cmap/ti/n25?xid=1
 */
private static String findParamInPath(String paramName, HttpServletRequest request){
      String pathInfo = request.getPathInfo();
      int startIndex = pathInfo.indexOf(""/"" + paramName);
      if(startIndex &gt;= 0){
        startIndex += (paramName.length()+1);

        int endIndex = pathInfo.indexOf(""/"", startIndex);
        if(endIndex &lt; 0){
          endIndex = pathInfo.indexOf(""?"", startIndex);
        }
        if(endIndex &lt; 0){
          endIndex = pathInfo.length();
        }
        String value = pathInfo.substring(startIndex, endIndex);
        if (value != null) {
          return value;
        }
      }

      return null;
    }
</code></pre>
","<java><refactoring>","0","90","2011-09-19 22:57:37"
"7487676","Eclipse refactoring methods (specifically extract method) have stopped working","<p>I have been using eclipse indigo happily for android development for a while.  In the last few days it has stopped refactoring.  I have tried a project clean and of course restarting eclipse.</p>

<p>I have also tried renaming the org.eclipse.core.resources directory as suggested here: -</p>

<p><a href=""http://letsgetdugg.com/2009/04/19/recovering-a-corrupt-eclipse-workspace/"" rel=""nofollow"">http://letsgetdugg.com/2009/04/19/recovering-a-corrupt-eclipse-workspace/</a></p>

<p>Any ideas what I could do? Thanks!</p>
","<java><eclipse><refactoring>","0","161","2011-09-20 15:25:07"
"7498449","Shorten code: merge arrays from hashes","<p>I have a list of hashes and some of the hashes contain a key which provides an array itself.</p>

<pre><code>my @cars = (
   { # empty car
      name =&gt; ""BMW"",
   },
   { # car with passengers
      name =&gt; ""Mercedes"",
      passengers =&gt; [qw(Paul Willy)],
   },
   ...
)
</code></pre>

<p>It's pretty much like above but of course not with the stupid cars example:-)</p>

<p>Now I need to get a list of all ""passengers"" from all hashes including ones that do not even offer a passengers array.</p>

<p>In a 2nd step I need to retrieve unique entries from the list (actually the passengers are Perl object refs and I need every object once in the list)</p>

<p>At the moment I do:</p>

<pre><code>my (@all, @passengers, %seen);
for(@cars) {
    push @all, @{$_-&gt;{passengers}} if $_-&gt;{passengers};
}

@passengers = grep { ! $seen{$_} ++ } @all;
</code></pre>

<p>I would like to get rid of @all and throw the list of all passengers directly into <code>grep</code>.</p>

<p>Any suggestions?</p>
","<perl><refactoring><perl-data-structures><perl-hash>","0","129","2011-09-21 10:47:07"
"7505541","What is the best practice for layer architecture?","<p>Right now I’m working on a very big banking solution developed in VB6. The application is massively form-based and lacks a layered architecture (all the code for data access, business logic and form manipulation is in the single form class). My job is now to refactor this code. I'm writing a proper business logic layer and data access layer in C# and the form will remain in VB. </p>

<p>Here are code snippets: </p>

<pre><code>public class DistrictDAO
{
    public string Id{get;set;}
    public string DistrictName { get; set; }
    public string CountryId { get; set; }
    public DateTime SetDate { get; set; }
    public string UserName { get; set; }
    public char StatusFlag { get; set; }
}
</code></pre>

<p>District Entity class, why its extension is DAO, Im not clear. </p>

<pre><code> public class DistrictGateway
{
    #region private variable
    private DatabaseManager _databaseManager;
    #endregion

    #region Constructor
    public DistrictGateway(DatabaseManager databaseManager) {
        _databaseManager = databaseManager;
    }
    #endregion

    #region private methods
    private void SetDistrictToList(List&lt;DistrictDAO&gt; dataTable, int index, DistrictDAO district){
        // here is some code for inserting 
    }    
    #endregion

    #region public methods
        try
        {
        /*
         query and rest of the codes
         */    

        }
        catch (SqlException sqlException)
        {
            Console.WriteLine(sqlException.Message);
            throw;
        }
        catch (FormatException formateException)
        {
            Console.WriteLine(formateException.Message);
            throw;
        }
        finally {
            _databaseManager.ConnectToDatabase();
        }


    public void InsertDistrict() { 
        // all query to insert object
    }

    public void UpdateDistrict() { 

    }
    #endregion
}
</code></pre>

<p>DistrictGateway class responsible for database query handling 
Now the business layer. </p>

<pre><code>  public class District
{
    public string Id { get; set; }
    public string DistrictName { get; set; }
    public string CountryId { get; set; }
}


public class DistrictManager
{
    #region private variable
    private DatabaseManager _databaseManager;
    private DistrictGateway _districtGateway;
    #endregion

    #region Constructor
    public DistrictManager() { 
        // Instantiate the private variable using utitlity classes
    }
    #endregion

    #region private method
    private District TransformDistrictBLLToDL(DistrictDAO districtDAO) { 

        // return converted district with lots of coding here
    }

    private DistrictDAO TransformDistrictDLToBLL(District district)
    {

        // return converted DistrictDAO with lots of coding here
    }

    private List&lt;District&gt; TransformDistrictBLLToDL(List&lt;DistrictDAO&gt; districtDAOList)
    {

        // return converted district with lots of coding here
    }

    private List&lt;DistrictDAO&gt; TransformDistrictDLToBLL(List&lt;District&gt; district)
    {

        // return converted DistrictDAO with lots of coding here
    }


    #endregion

    #region public methods
    public List&lt;District&gt; GetDistrict() {
        try
        {
            _databaseManager.ConnectToDatabase();
          return TransformDistrictBLLToDL(  _districtGateway.GetDistrict());

        }
        catch (SqlException sqlException)
        {
            Console.WriteLine(sqlException.Message);
            throw;
        }
        catch (FormatException formateException)
        {
            Console.WriteLine(formateException.Message);
            throw;
        }
        finally {
            _databaseManager.ConnectToDatabase();
        }
    }

    #endregion
</code></pre>

<p>This is the code for the business layer.</p>

<p>My questions are: </p>

<ol>
<li>Is it a perfect design? </li>
<li>If not, what are flaws here?</li>
<li>I think, this code with duplicated try catch block </li>
<li>What can be  good design for this implementation</li>
</ol>
","<c#><refactoring><data-access-layer><business-logic-layer>","0","227","2011-09-21 19:31:11"
"7494227","rails can this model code be refactored?","<p>I would like to combine the finders better.</p>

<pre><code>if params[:sort]
  if params[:sort] == 'industry_id'
    if params[:industry_id]
      @companies = Company.find_all_by_industry_id(params[:industry_id], :joins =&gt; ""left join industries ind on industry_id = ind.id"", :order =&gt; ""ind.name"" + "" "" + sort_direction)
    else
      @companies = Company.all(:joins =&gt; ""left join industries ind on industry_id = ind.id"", :order =&gt; ""ind.name"" +  "" "" + sort_direction)
    end
  else
    if params[:industry_id]
      @companies = Company.find_all_by_industry_id(params[:industry_id], :order =&gt; sort_column + "" "" + sort_direction)
    else
      @companies = Company.all(:order =&gt; sort_column + "" "" + sort_direction)
    end
  end
else
  if params[:industry_id]
    @companies = Company.find_all_by_industry_id(:joins =&gt; ""left join industries ind on industry_id = ind.id"", :order =&gt; ""ind.name"" + "" "" + sort_direction)
  else
    @companies = Company.all
  end
end
</code></pre>
","<ruby-on-rails><ruby><model><refactoring>","0","61","2011-09-21 03:23:35"
"7510398","Can I disable the refactor preview in Eclipse?","<p>When renaming a variable using Eclipse, I always get a popup dialog showing me a preview of the refactoring.  Is there some way I can disable this popup dialog?  In other words, I want to place the cursor over a variable name, press alt+shift+r, edit the variable name, press enter, and have the renaming take place without ever seeing the preview.  Is there some preference or setting for this?</p>

<p>I""m using Eclipse 3.6 (Helios)</p>

<p><strong>UPDATE</strong>:</p>

<p>To test this, I did the following.  I created a new Java Project and added the following class to the package. </p>

<pre><code>public class TestRename{
    private int var;
}
</code></pre>

<p>This is the only code in the project and still when I try to rename <code>var</code> I get a preview dialog in which I have to click ""OK"" to make the change.  I'm pretty sure this wasn't the default behavior in Eclipse, but I must have edited the defaults somehow.  I just don't know what I did or how to reset the preview behavior of the refactor.</p>
","<eclipse><refactoring>","1","92","2011-09-22 06:21:52"
"7510422","When should we change a String to a Stringbuilder?","<p>In an application a String is a often used data type. What we know, is that the mutation of a String uses lots of memory. So what we can do is to use a StringBuilder/StringBuffer.  </p>

<p>But at what point should we change to StringBuilder?<br>
And what should we do, when we have to split it or to remplace characters in there?  </p>

<p>eg:  </p>

<pre><code> //original:
 String[] split = string.split(""?"");  
 //better? :  
 String[] split = stringBuilder.toString().split(""?);
</code></pre>

<p>or</p>

<pre><code> //original:
 String replacedString = string.replace(""l"",""st"");  
 //better? :  
 String replacedString = stringBuilder.toString().replace(""l"",""st"");  
 //or  
 StringBuilder replacedStringBuilder = new StringBuilder(stringBuilder.toString().replace(""l"",""st);
</code></pre>
","<java><string><memory-management><refactoring><stringbuilder>","3","163","2011-09-22 06:24:47"
"7512077","Ruby syntax accept arguments on dynamically generated methods via send","<p>How I can pass arguments on dynamically generated methods via send ?</p>

<p>Below I generate on the fly several methods, I want they accept the ""row"" argument.</p>

<p>The code below generates the methods, but I don't know how let the methods accept the ""row"" argument.</p>

<pre><code>@sql_columns.each do |attr|
  (class &lt;&lt; self; self end).send :define_method, attr do
    key = @column_mapping[attr].to_s
    row[key]
  end
end
</code></pre>
","<ruby><syntax><refactoring>","1","48","2011-09-22 08:50:07"
"7516650","Method and Constructor<?> both inherit from Member, both having a getExceptionTypes() method. How to avoid code duplication in this scenario?","<p>I have both these methods in my code base, which I'd like to merge in some way to avoid code duplication:</p>

<pre><code>protected IJavaType[] getExceptionTypes(Method method) {
    Class&lt;?&gt;[] declaredExceptions = method.getExceptionTypes();

    IJavaType[] exceptions = new IJavaType[declaredExceptions.length];

    for (int i = 0; i &lt; declaredExceptions.length; i++) {
        exceptions[i] = getType(declaredExceptions[i]);
    }

    return exceptions;
}

protected IJavaType[] getExceptionTypes(Constructor&lt;?&gt; c) {
    Class&lt;?&gt;[] declaredExceptions = c.getExceptionTypes();

    IJavaType[] exceptions = new IJavaType[declaredExceptions.length];

    for (int i = 0; i &lt; declaredExceptions.length; i++) {
        exceptions[i] = getType(declaredExceptions[i]);
    }

    return exceptions;
}
</code></pre>

<p>Is there any way to factor out the code repetition (other than using subclassing with template pattern)?</p>
","<java><oop><refactoring><code-duplication>","1","42","2011-09-22 14:39:43"
"7528067","extract interface in different package with Eclipse","<p>when I use ""Extract Interface"" on a Java class in Eclipse (to be honest, in Spring Tool Suite), I don't see an option to enter a different package name. I can just enter a name for the interface, but it'll go into the same package like the implementation. IMHO, interfaces are almost always in different packages then their implementations. So, I need to refactor again afterwards and move the interface.</p>

<p>Is there any simpler way?</p>

<p>I already tried to enter the full qualified name as name for the new interface, but then Eclipse tells me that . is not allowed in interface identifiers #:-/</p>

<p>This behaviour was seen with Springsource Tool Suite 2.7.0.RELEASE in Spring perspective. afaik this is based on Eclipse 3.7.0.</p>

<p>Thanks for any hints
Michel</p>
","<eclipse><refactoring>","0","90","2011-09-23 11:10:10"
"7528318","Remove duplication code from methods that depend on return result of other method","<p>In ASP.NET MVC application in controller class I have a method</p>

<pre><code>        protected ActionResult VerifySanctions(string sanction)
        {

        bool hasSanctions = this.qualificationSanctionsService.HasSanctions(sanction);


        if (hasSanctions)
        {                               
              return this.RedirectToAction(""Index"", ""Home"");

        }
        return null;
        }
</code></pre>

<p>This method contains common logic from different other actions from different controller
I decided to create a base class for controller that will keep this method and derive other controller from it. But problem is in when I call this method from derived class actions I need to verify if not null and then return the result for example</p>

<pre><code>    public ActionResult RegistrationTracking(EncryptedId sourceId)
    {
        // some code
        var registration = learnerRegistrationService.Get(sourceId);

        var result = this.VerifySanctions(registration.Qualification);
        if (result != null)
        {
            return result;
        }
         // some code
        return this.View();

    }
</code></pre>

<p>in other actions I need to verify if result not null again</p>

<pre><code>    public ActionResult Index(EncryptedId achievableVersionId)
    {
        var achievableVersion = achievableVersionService.Get(achievableVersionId);

        var verificationResult = this.VerifySanctions(achievableVersion);
        if (verificationResult != null)
        {
            return verificationResult;
        }          

         //some code
        return View();
    }
</code></pre>

<p>And I want to avoid duplication code, can anyone help me with example or advise?
What I need that if don't pass verification by method VerifySanction() then do nothing, else return Action result.</p>

<p>UPDATE the actions could like this</p>

<pre><code>        public ActionResult ModifyUnits(EncryptedId sourceId)
    {
        var registration = learnerRegistrationService.Get(sourceId);

        Check.Require(registration != null);
        Check.Require(registration.Enrolment != null, ""QualificationEnrolment is null - RegistrationAmendments / ModifyUnits"");
        var result = this.VerifySanctions(registration.Qualification, LookupOrganisationAchievableStatus.Sanction3);
        if (result != null)
        {
            return result;
        }

        if (!this.organisationAchievableService.IsAccessibleAchievableVersion(registration.Qualification.Id, this.GetOrganisationId()))
        {
            return new PopupFormResult().Notify(MUI.PleaseSelectACentre);
        }

        SetEnrolmentViewData(registration.Enrolment);

        ViewData[""registrationId""] = sourceId;
        var isComposite = registration.Enrolment.IsComposite();
        ViewData[""isComposite""] = isComposite;

        this.SetSelectedUnitsViewData(registration, isComposite);

        this.SetSelectedQualificationUnitsViewData(isComposite, registration);

        return this.PartialView(""ModifyUnits"", new List&lt;UnitDisplay&gt;());
    }
</code></pre>

<p>Thanks in advance</p>
","<c#><asp.net-mvc><refactoring><code-duplication>","0","79","2011-09-23 11:32:13"
"7535554","Is there any IDE capable of Rename refactoring namespaces in PHP?","<p>Do you know any PHP IDE capable of rename <strong>classes and namespaces</strong>, and refactor the code (all files) properly?    </p>
","<php><ide><namespaces><refactoring><rename>","1","83","2011-09-23 22:43:43"
"7542546","When to split an MVC view into two?","<p>I discussed best practices in MVC the other day with a colleague and he asked me how to best separate views. He was maintaining an MVC solution which had a common input form with a controller with two actions, a get action, and a post action. Both actions were returning the same view, which was filled with inline logic, and conditionals checking whether it was a post or a get.</p>

<p>What is the best solution for this situation?
Should the view be split into two separate views? I guess it depends on how much logic is in there, but when is too much? Is there a way to quantify when you can motivate the refactoring into two views?</p>
","<asp.net-mvc><oop><mvc><refactoring><software-design>","6","129","2011-09-24 23:11:31"
"7543252","Rails - Problems refactoring controller's nested attribute creation","<p>I have models:</p>

<pre><code>Transaction has_many :credits, :debits
Credit belongs_to :transaction
Debit belongs_to :transaction
</code></pre>

<p>Each credit must have a balancing debit and vice versa.</p>

<p>I currently (successfully) achieve this with the following inside Transaction's create method:</p>

<pre><code>@transaction = Transaction.new(params[:transaction])

Transaction.transaction  do

  # Balance debits with credits (Sales)
  if params[:balance_transaction] == 'credit'
    @transaction.credits.each do |credit|
      @transaction.debits.push(Debit.new({
        :quantity =&gt; 0,
        :cost_per_unit =&gt; 0,
        :description =&gt; 'Balancing Debit',
        :amount =&gt; credit.amount,
        :account_id =&gt; 23 #Get from settings in future to allow users to choose Debtor account
      }))
    end
  elsif params[:balance_transaction] == 'debit'
    @transaction.debits.each do |debit|
      @transaction.credits.push(Credit.new({
        :quantity =&gt; 0,
        :cost_per_unit =&gt; 0,
        :description =&gt; 'Balancing Credit',
        :amount =&gt; credit.amount,
        :account_id =&gt; 43 #Get from settings in future to allow users to choose Creditor account
      }))
    end
  else
    raise ActiveRecord::Rollback # There's no balancing transaction. Don't save it!
  end

end
</code></pre>

<p>I tried moving the balancing debit/credit creation into the debit/credit models by replacing <code>@transactions.credits.push(...) with debit.balancing_credit</code> and putting the following in the debit model:</p>

<pre><code>def balancing_credit
  transaction.credits.new({
    :quantity =&gt; 0,
    :cost_per_unit =&gt; 0,
    :description =&gt; 'Balancing Debit',
    :amount =&gt; amount,
    :account_id =&gt; 43 #Get from settings in future to allow users to choose Creditor account
  })
end
</code></pre>

<p>I thought this was pretty straightforward refactoring, but it throws up an <code>undefined method 'debits' for nil:NilClass</code> error. Seems it looks in the database for the not yet saved transaction in order to create the balancing credit? Am I doing something wrong?</p>
","<ruby-on-rails><ruby-on-rails-3><activerecord><refactoring>","0","99","2011-09-25 02:24:22"
"7548215","Refactoring of many if statements for params[...], inside controller action","<p>I have such code, for making chain selects in my form
View for index action:</p>

<pre><code>&lt;%= form_tag do %&gt;
    &lt;%= collection_select(*@brands_select_params) %&gt;
    &lt;%= collection_select(*@car_models_select_params) %&gt;
    &lt;%= collection_select(*@production_years_select_params) %&gt;
    &lt;% # Пока еще никто ничего не выбрал %&gt;
&lt;%= submit_tag ""Send"", :id =&gt; ""submit"", :name =&gt; ""submit"" %&gt;
</code></pre>

<p>And my controller:</p>

<pre><code>class SearchController &lt; ApplicationController
  def index
    @brands = Brand.all
    @car_models = CarModel.all

    if (params[:brand].blank?)
      @brands_select_params = [:brand, :id, @brands, :id, :name, :prompt =&gt; ""Выбирай брэнд""]

      if params[:car_model].blank?
        @car_models_select_params = [:car_model, :id, @car_models, :id, :name, { :prompt =&gt; ""Model"" }, \
                                   { :disabled =&gt; ""disabled"" }]
        @production_years_select_params = [:production_year, :id, @car_models, :id, :name, { :prompt =&gt; ""Year"" }, \
                                         { :disabled =&gt; ""disabled"" }]
      end
    else
      @brands_select_params = [:brand, :id, @brands, :id, :name, { :selected =&gt; params[:brand][:id] } ]
      if params[:car_model].blank?
        @car_models_select_params = [:car_model, :id, Brand.find(params[:brand][:id]).car_models, :id, :name, \
                                   { :prompt =&gt; ""And model now"" } ]
        @production_years_select_params = [:production_year, :id, @car_models, :id, :name, { :prompt =&gt; ""Year"" }, \
                                         { :disabled =&gt; ""disabled"" } ]
      else
        @car_models_select_params = [:car_model, :id, Brand.find(params[:brand][:id]).car_models, :id, :name, \
                                   { :selected =&gt; params[:car_model][:id] } ] unless params[:car_model][:id].empty?
        @production_years_select_params = [:production_year, :id, CarModel.find(params[:car_model][:id]).production_years, :id, :year, \
                                         { :prompt =&gt; ""And year now"" } ] unless params[:car_model][:id].empty?
      end
    end
  end
end
</code></pre>

<p>As you can see, too many ifs in my controller code. And i gonna add more conditions there. After that anyone who read that code will get brain corruption. So i just wanna make it in real Ruby way, but don't know how. Please, help, guys. How should i refactor this bunch of crap?</p>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring><refactor-my-code>","0","170","2011-09-25 20:01:09"
"7549739","Refactor rename field in many database tables","<p>I am faced with renaming a field where the same fieldname is replicated across many tables. </p>

<p>Looking for a script or free/low cost tool which will go through all the tables and if fieldA exists, rename it to fieldB.</p>

<p>thanks</p>
","<sql-server><sql-server-2008><refactoring><refactoring-databases>","0","106","2011-09-26 01:02:11"
"7559369","Cleaner way to implement moving a div back and forth using jQuery?","<p>I am trying to setup a simple example where a user can click a button on a page and divs are moved from one side of a parent div to another.  If the button is clicked again the divs should move back to their original position.  </p>

<p>I have successfully set this up, but the code feels a little clumsy to me.  Can anyone recommend a cleaner way to do this than what I have done below:</p>

<pre><code>var operator = '+=';
$('#clickme').click(function() {

    $('#main div:even').animate({
        left:operator + '200'
    }, 2000);

    if(operator == '+='){operator = '-=';}
    else{operator = '+=';}
});
</code></pre>

<p>The if/else at the end of my click event is the part that seems odd to me.  Any suggestions for prettying this up?</p>

<p>You can play with the fiddle here:</p>

<p><a href=""http://jsfiddle.net/S6UtE/3/"" rel=""nofollow"">http://jsfiddle.net/S6UtE/3/</a></p>
","<javascript><jquery><refactoring>","1","185","2011-09-26 18:15:22"
"7564539","Match url folders with a tag href to make a active state","<p>I made a active state for my menu on a certain urls. I have urls like this: </p>

<ul>
<li><code>/products/other-clothing/sporting/adults-anzac-australia-polo</code></li>
<li><code>/products/other-clothing/sporting/adults-nz-tee</code></li>
<li><code>/products/bags/backpacks</code></li>
</ul>

<p>Etc. My code gets the folder from after the <code>/</code> so other-clothing, sporting, etc.
It is working fine, I just assume there is a more efficient way to write the code, here is my code:</p>

<pre><code>jQuery("".product-nav li a"").each(function() {
  // URL url
  var cat = location.pathname.split(""/"")[2];
  var subcat = location.pathname.split(""/"")[3];
  var c = ""/products/"" + cat + ""/"" + subcat;

  // A tag url
  var acat = this.href.split(""/"")[4];
  var asubcat = this.href.split(""/"")[5];
  var e = ""/products/"" + acat + ""/"" + asubcat;

  if(e == c) {
    jQuery(this).parent().addClass(""active"");
    jQuery(this).parent().parent().parent().addClass(""active"");
  }
});
</code></pre>

<p>If anyone can provide a cleaner way of writing the code that'd be great. I probably dont need <code>""/products/"" +</code>.</p>
","<javascript><jquery><refactoring>","1","76","2011-09-27 05:22:01"
"7564776","Should I turn this into a module?","<p>In my Rails 3.1 app. Ive got a few controller's calling this block of code:</p>

<pre><code>twitter_entertainment_users = Rails.cache.fetch('twitter_entertainment_users', :expires_in =&gt; 24.hours) do
  begin
    Timeout.timeout(10.seconds) do
      Twitter.suggestions('entertainment')
      puts ""#{Twitter.rate_limit_status.remaining_hits.to_s} Twitter API request(s) remaining this hour""
    end
  rescue Twitter::NotFound
  end
end
</code></pre>

<p>Instead of re-typing this block of code everywhere. Should I have this in a module instead? i.e. to keep things DRY?</p>

<p>If so, where should this go? I read somewhere about putting module code in <code>app/concerns/foobar.rb</code>. </p>

<p>Any other approach? Looking for suggestions / articles.</p>
","<ruby-on-rails-3><refactoring>","0","63","2011-09-27 05:55:23"
"7566565","Is there a way to apply a refactoring script just for its side-effects?","<p>I've got a library that was changed to introduce a factory method to replace a constructor (the reasons aren't important right now, in the current case it was for improved type inference mostly).</p>

<p>Assuming that there <em>is</em> an Eclipse refactoring script for it (so I pretty much have a nice computer-readable description of the change), is there some way to <em>apply</em> that script to a project that only <em>uses</em> that library (i.e. it only has a reference to a compiled version of the library)?</p>

<p>For example, I start with this simple class:</p>

<pre><code>public class MyContainer&lt;T&gt; {
    private final T content;

    public MyContainer(final T content) {
        this.content = content;
    }

    public T getContent() {
        return content;
    }
}
</code></pre>

<p>Now I introduce a factory (without making the constructor private, but that isn't really relevant right now), the factory method looks like this:</p>

<pre><code>public static &lt;T&gt; MyContainer&lt;T&gt; holding(T content) {
    return new MyContainer&lt;T&gt;(content);
}
</code></pre>

<p>When I now export a migration script it looks like this: </p>

<pre><code>&lt;?xml version=""1.0"" encoding=""UTF-8""?&gt;
&lt;session version=""1.0""&gt;
&lt;refactoring comment=""Introduce factory &amp;apos;holding&amp;apos; in &amp;apos;scratch.MyContainer&amp;apos; for constructor &amp;apos;scratch.MyContainer.MyContainer()&amp;apos;&amp;#x0A;- Original project: &amp;apos;scratch&amp;apos;&amp;#x0A;- Original element: &amp;apos;scratch.MyContainer.MyContainer()&amp;apos;&amp;#x0A;- Factory name: &amp;apos;holding&amp;apos;&amp;#x0A;- Owner class: &amp;apos;scratch.MyContainer&amp;apos;""
             description=""Introduce factory for &amp;apos;MyContainer&amp;apos;""
             element1=""/src&amp;lt;scratch{MyContainer.java[MyContainer""
             flags=""589830"" id=""org.eclipse.jdt.ui.introduce.factory""
             input=""/src&amp;lt;scratch{MyContainer.java""
             name=""holding"" project=""scratch"" protect=""false""
             selection=""89 0"" version=""1.0""/&gt;
&lt;/session&gt;
</code></pre>

<p>This <em>should</em> hold enough information to apply the refactoring to another project that references (a <em>current</em> version) of the class via a jar file.</p>

<p>But trying to apply the refactoring gives me this error:</p>

<blockquote>
  <p>The refatoring 'Introduce Factory' (org.eclipse.jdt.ui.introduce.factory) cannot be performed, since its input 'scratch.MyContainer.java' does not exist.</p>
</blockquote>

<p>Note that it <em>explicitly</em> mentions <code>.java</code>, so it's looking for a source file and isn't content with applying the refactoring to the binary type.</p>

<p><em>Note:</em> I <em>don't</em> want to patch the binary library. I <em>just</em> want the <em>callers</em> of the original constructor to be converted to calling the factory method instead.</p>

<p><em>Note 2:</em> Search-and-replace won't help in my specific case. The reason is that I have <em>two</em> constructors, one taking an <code>Object</code> and the other takes a <code>String</code>. They should be mapped on two <em>different</em> factory methods, so I'd need the search-and-replace function to look at the type information of the argument as well.</p>

<p><em>Note 3:</em> even a way to manually specify ""replace instantiations of object <code>X</code> with this constructor with calls to this method instead"" would be appreciated.</p>

<p><em>Update:</em> There is a bugzilla entry on the Eclipse bugzilla that is about <a href=""https://bugs.eclipse.org/bugs/show_bug.cgi?id=44201"" rel=""nofollow"">adding a replace invocation refactoring</a>. An implementation of that feature <em>might</em> be able to solve my problem, if ""invocation"" includes object instantiation via a given constructor. Unfortunately it saw no activity in the last few years (although it was planned for 3.2).</p>
","<java><eclipse><refactoring><automation>","11","362","2011-09-27 09:01:58"
"7567550","Benefit from generated getters and setters in Play! framework","<p>The <a href=""http://www.playframework.org/documentation/1.2.3/model"" rel=""nofollow"">Play! framework generates getters and setters</a> for each public field of a model class <strong>at runtime</strong>.</p>

<pre><code>public class Product {

    public String name;
    public Integer price;
}
</code></pre>

<p>will be transformed to</p>

<pre><code>public class Product {

    public String name;
    public Integer price;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getPrice() {
        return price;
    }

    public void setPrice(Integer price) {
        this.price = price;
    }
}
</code></pre>

<p>The manual explains further:</p>

<p>Then when you want to access a property you can just write:</p>

<pre><code>product.name = ""My product"";
product.price = 58;
</code></pre>

<p>Which is translated at load time to:</p>

<pre><code>product.setName(""My product"");
product.setPrice(58);
</code></pre>

<p>... and warns:</p>

<blockquote>
  <p>You can’t directly use getter and setter methods to access properties
  if you rely on automatic generation. These methods are generated at
  runtime. So if you reference them in code you write, the compiler
  won’t find the methods and will generate an error.</p>
</blockquote>

<p>Since I cannot use these getters and setters from outside of the Play! project, I see no benefit in generating them. What is the benefit compared to public fields, refactorings (encapsulate a field and change the callers) of all modern IDEs taken into account? </p>
","<java><properties><refactoring><playframework><getter-setter>","5","339","2011-09-27 10:19:20"
"7576343","How could this be optimized?/Class Splitting","<p>Not sure if it will actually be more optimized, however What I am trying to do is take all of this code and possibly split it up within different classes? So far it is all just one class but We have been leaning more and more to multiple class projects so I am trying to figure out how I can split this and actually have it help rather then just splitting stuff up to split it up. Any help would be great!</p>

<pre><code>import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.awt.image.BufferedImage;
import java.util.*;


public class PaintProgram extends JPanel implements MouseListener,ActionListener 
{
  private int xX1, yY1 , xX2, yY2, choice ;

  public static void main(String [] args)
  {
      new PaintProgram();
  }

  PaintProgram()
  {


    JFrame frame = new JFrame(""Paint Program"");
    frame.setSize(1200, 800);
    frame.getContentPane().add(this);

    JButton button1 = new JButton(""Clear"");
    button1.addActionListener(this);
    JButton button2 = new JButton(""Filled rectangle"");
    button2.addActionListener(this);
    JButton button3 = new JButton(""Filled oval"");
    button3.addActionListener(this);
    JButton button4 = new JButton(""Empty rectangle"");
    button4.addActionListener(this);
    JButton button5 = new JButton(""Empty oval"");
    button5.addActionListener(this);
    JButton button6 = new JButton(""Line"");
    button6.addActionListener(this);


    this.add(button1); 
    this.add(button2);
    this.add(button3);
    this.add(button4);
    this.add(button5);
    this.add(button6);
    addMouseListener(this);

    frame.setVisible(true);     
}

public void paintComponent(Graphics g)
{ 
     super.paintComponent(g);  
     Graphics2D g2 = (Graphics2D)g;
     if(grid == null){
        int w = this.getWidth();
        int h = this.getHeight();
        grid = (BufferedImage)(this.createImage(w,h));
        gc = grid.createGraphics();
     }
     g2.drawImage(grid, null, 0, 0);
     check();
}
BufferedImage grid;
Graphics2D gc;


public void draw()
{
    Graphics2D g = (Graphics2D)getGraphics();
     int w = xX2 - xX1;
        if (w&lt;0)
        w = w *(-1);

   int h = yY2-yY1;
        if (h&lt;0)
        h=  h*(-1);

     switch(choice)
    {
        case 1:
            check();
            gc.setColor(Color.YELLOW);
            gc.drawRect(xX1, yY1, w, h);
            repaint();
            break;

        case 2:
            check();
            gc.setColor(Color.CYAN);
            gc.drawOval(xX1, yY1, w, h);
            repaint();
            break;

        case 3:
            check();
            gc.setColor(Color.ORANGE);
            gc.drawRect(xX1, yY1, w, h);
            gc.fillRect(xX1, yY1, w, h);
            repaint();
            break;

        case 4:
            check();
            gc.drawOval(xX1, yY1, w, h);
            gc.setColor(Color.PINK);
            gc.fillOval(xX1, yY1, w, h);
            repaint();
            break;  

        case 5:
            check();
            gc.setColor(Color.MAGENTA);
            gc.drawLine(xX1, yY1, xX2, yY2);
            repaint();
            break;

        case 6:
            //Acquire clear screen or gay
            break;   
    }
}

public void check()
{
    if (xX1 &gt; xX2)
    {
        int z = 0;
        z = xX1;
        xX1 = xX2;
        xX2 =z;
    }
    if (yY1 &gt; yY2)
    {
        int z = 0;
        z = yY1;
        yY1 = yY2;
        yY2 = z;
    }
}



public void actionPerformed(ActionEvent e)
{

if (e.getActionCommand().equals(""Empty rectangle"")) 
{         
  System.out.println(""Empty Rectangle Has Been Selected~"");
   choice = 1;

  }

if (e.getActionCommand().equals(""Empty oval"")) 
{         
 System.out.println(""Empty Oval Has Been Selected!"");
   choice = 2;
  }


if (e.getActionCommand().equals(""Filled rectangle""))
{         
  System.out.println(""Filled Rectangle Has Been Selected"");
   choice = 3;
  }


if (e.getActionCommand().equals(""Filled oval"")) 
{         
 System.out.println(""Filled Oval Has Been Selected"");
   choice = 4;
  }


if (e.getActionCommand().equals(""Line""))
{
    System.out.println(""Draw Line Has Been Selected"");
    choice = 5;
}

if (e.getActionCommand().equals(""Clear""))
{         
 System.out.println(""Clear All The Things!!!"");
   choice = 6;
   repaint();
  }

 }

 public void mouseExited(MouseEvent evt){}
 public void mouseEntered(MouseEvent evt){}
 public void mouseClicked(MouseEvent evt){}
 public void mousePressed(MouseEvent evt)
 {

     xX1 = evt.getX();
     yY1= evt.getY();

   }
 public void mouseReleased(MouseEvent evt)
 {
     xX2 =evt.getX();
     yY2=evt.getY();
     draw();
   }
}
</code></pre>
","<java><swing><class><refactoring>","0","88","2011-09-27 22:18:45"
"7588968","overriding a method in a generic class","<p>Im refactoring some unit tests. Basically, i ve found that unit tests of different clients implement a bundle of methods such as: createClientWithNullResponse, createClientWithSuccessResponse, etc.</p>

<p>I was wondering if its possible in Java to implement a generic solution to this, since this methods are repeated over and over in hundreds of unit classes, changing only the method signature. </p>

<p>But, there is a tricky. See a method example:</p>

<pre><code>/**
 * configures the client to return a succesful response
 * @return a client configured to return a succesful response
 */
private Client1 configureClientWithSuccesfulResponse()
{
    client = new Client1()
    {
        public CommonClientResponse processRequest( CommonsClientRequest commonsClientRequest )
        {
            CommonClientResponse commonClientResponse = new CommonClientResponse();
            commonClientResponse.setResponse( new Client1Response() );
            return commonClientResponse;
        }
    };
    return client;
}
</code></pre>

<p>So, client2 will have the very same method except that signature have Client2, and the overrided method creates a new Client2Response, and the same with dozens of clients.</p>

<p>Additional information: processRequest is overrided to act as a mock, setting the response i wish for each method.
Client1 extends CommonsWS that extends of AbstractCommons, which is an abstract class but contains the implementation of processRequest method.</p>

<p>All in all, my idea is to create a Base class for all unit tests, with a bundle of generic methods where i can pass the class type, and then rewrite the processRequest for each one. Ive tried :</p>

<pre><code>public class base &lt;T extends AbstractCommonClient&gt;{

    private T configureClientWithNullResponse(Class &lt;? extends AbstractCommonClient&gt; clazz, Class&lt; ? extends ClientResponse&gt; clazz1)
    {

        try
        {
            return clazz.newInstance()
            {
                CommonClientResponse processRequest( CommonsClientRequest commonsClientRequest )
                {
                    CommonClientResponse commonClientResponse = new CommonClientResponse();
                    commonClientResponse.setResponse( clazz1.newInstance() );
                    return commonClientResponse;
                };
            };
        }
    }

}
</code></pre>

<p>but it not even compile. Do you have any ideas of how i can begin implementing this?</p>
","<java><generics><refactoring>","0","100","2011-09-28 20:07:04"
"7599347","Python trying to Refactor (DRY out) a long Control Flow","<p>I am grabbing a lot of data from and SQL query that takes a long time to run. Since the SQL query takes so long to run, I am grabbing the data from the database in its most granular form. I then cycle through this data once and aggregate it in the forms that are useful to me.</p>

<p>My problem is that I am repeating myself over and over again. However, I am not sure of the best way to refactor this control flow. Thanks in advance!</p>

<pre><code>def processClickOutData(cls, raw_data):
    singles = {}
    total={}
    absolute_total = 0
    channels = {}

    singles_true = {}
    total_true={}
    channels_true = {}
    absolute_total_true = 0

    list_channels = set([])
    list_tids = set([])


    total_position = {}
    total_position_true = {}
    tid_position = {}
    channel_position = {}
    channel_position_true = {}
    tid_position_true = {}

    for row in raw_data:
        gap=row[0]
        count=row[1]
        tid=row[2]
        prefered=row[3]
        channel=row[4]
        position=row[5]

        list_channels.add(channel)
        list_tids.add(tid)


        absolute_total += int(count)

        if total.has_key(gap):
            total[gap] += count
        else:
            total[gap] = count

        if singles.has_key(gap) and singles[gap].has_key(tid):
            singles[gap][tid] += count
        elif singles.has_key(gap):
            singles[gap][tid] = count
        else:
            singles[gap] = {}
            singles[gap][tid] = count

        if channels.has_key(gap) and channels[gap].has_key(channel):
            channels[gap][channel] += count
        elif channels.has_key(gap):
            channels[gap][channel] = count
        else:
            channels[gap] = {}
            channels[gap][channel] = count
        if total_position.has_key(position):
            total_position[position] += count
        else:
            total_position[position] = count
        if tid_position.has_key(position) and tid_position[position].has_key(tid):
            tid_position[position][tid] += count     
        elif tid_position.has_key(position):
            tid_position[position][tid] = count
        else:
            tid_position[position] = {}
            tid_position[position][tid] = count

        if channel_position.has_key(position) and channel_position[position].has_key(channel):
            channel_position[position][channel] += count     
        elif channel_position.has_key(position):
            channel_position[position][channel] = count
        else:
            channel_position[position] = {}
            channel_position[position][channel] = count

        if prefered == 0:
            absolute_total_true += count
            if total_true.has_key(gap):
                total_true[gap] += count
            else:
                total_true[gap] = count

            if singles_true.has_key(gap) and singles_true[gap].has_key(tid):
                singles_true[gap][tid] += count
            elif singles_true.has_key(gap):
                singles_true[gap][tid] = count
            else:
                singles_true[gap] = {}
                singles_true[gap][tid] = count

            if channels_true.has_key(gap) and channels_true[gap].has_key(channel):
               channels_true[gap][channel] += count
            elif channels_true.has_key(gap):
               channels_true[gap][channel] = count
            else:
               channels_true[gap] = {}
               channels_true[gap][channel] = count

            if total_position_true.has_key(position):
               total_position_true[position] += count
            else:
               total_position_true[position] = count 

            if tid_position_true.has_key(position) and tid_position_true[position].has_key(tid):
               tid_position_true[position][tid] += count     
            elif tid_position_true.has_key(position):
               tid_position_true[position][tid] = count
            else:
               tid_position_true[position] = {}
               tid_position_true[position][tid] = count

            if channel_position_true.has_key(position) and channel_position_true[position].has_key(channel):
               channel_position_true[position][channel] += count     
            elif channel_position_true.has_key(position):
               channel_position_true[position][channel] = count
            else:
               channel_position_true[position] = {}
               channel_position_true[position][channel] = count




    final_values = {""singles"" : singles, ""singles_true"" : singles_true, ""total"" : total, ""total_true"": total_true, ""absolute_total"": absolute_total, ""absolute_total_true"": absolute_total_true, ""channel_totals"" : channels, ""list_channels"" : list_channels, ""list_tids"" : list_tids, ""channel_totals_true"" : channels_true,
                     ""total_position"" :  total_position, ""total_position_true"" : total_position_true, ""tid_position"" : tid_position, ""channel_position"" : channel_position, ""tid_position_true"" : tid_position_true, ""channel_position_true"" : channel_position_true }
    return final_values
</code></pre>
","<python><refactoring><dry><python-2.5><control-flow>","0","72","2011-09-29 15:03:59"
"7615268","How to refactor helper methods in RSpec files?","<p>I am using Ruby on Rails 3.1.0 and the <code>rspec-rails 2</code>gem. I would like to refactor the following code (I have intentionally omitted some code and I have given meaningful names in order to highlight the structure):</p>

<pre><code>describe ""D1"" do
  # Helper method
  def D1_Method_1
    ...
  end

  context ""C1"" do
    # Helper methods
    def D1_C1_Method_1
      session.should be_nil # Note: I am using the RoR 'session' hash
      D1_Method_1           # Note: I am calling the 'D1_Method_1' helper method
      ...
    end

    def D1_C1_Method_2
      ...
    end


    it ""I1"" do
      D1_Method_1
      ...
    end

    it ""I2"" do
      ...
      D1_C1_Method_1
      D1_C1_Method_2
    end
  end

  context ""C2"" do
    # Helper methods
    def D1_C2_Method_1
      ...
    end

    def D1_C2_Method_2
      ...
    end


    it ""I1"" do
      D1_Method_1
      ...
    end

    it ""I2"" do
      ...
      D1_C2_Method_1
      D1_C2_Method_2
    end
  end
end
</code></pre>

<p><strong>What can\should I make in order to refactor the above code?</strong></p>

<p><em>P.S.:</em> I have tried to extract <em>helper methods</em> in an external module (named <code>Sample</code>) but, for example relating to the <code>D1_C1_Method_1</code> method (that contains the RoR <code>session</code>), I get the following error when I run the spec file:</p>

<pre><code>Failure/Error: session.should be_nil
 NameError:
   undefined local variable or method `session' for Sample:Module
</code></pre>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring><rspec>","1","215","2011-09-30 19:40:21"
"7622532","refactoring statements C#","<p>How would you refactor this?</p>

<pre><code> if (result.Count &gt; 0 )
            {
                if (result[k-1] != smallestVal)
                {
                    result.Add(smallestVal);
                    k++;
                }
            }
            else
            {
                result.Add(smallestVal);
                k++;
            }
</code></pre>
","<c#><homework><refactoring>","-6","83","2011-10-01 19:48:14"
"7630979","Refactoring techniques for Clojure","<p>I'm familiar with refactoring fairly large code bases in C# and Java but Clojure is something of a different beast, especially since it:</p>

<ul>
<li>Has a mix of macros and functions in typical code (i.e. you might want to refactor from a macro to a function or vice-versa?)</li>
<li>Uses dynamic typing in most circumstances (so you don't get compile time checks on the correctness of your refactored code)</li>
<li>Is functional rather than object-oriented in style</li>
<li>Has less support for refactoring in current IDEs</li>
<li>Is less tolerant of cyclic dependencies in code bases (making it harder to move blocks of code / definitions around!)</li>
</ul>

<p>Given the above, what is the best way to approach code refactoring in Clojure?</p>
","<refactoring><clojure>","14","237","2011-10-03 04:17:04"
"7639777","Why am I getting the ReSharper error ""The extracted code has multiple entry points""?","<p>I am using the ReSharper to re-factor my code. When I try to move a block of code to the method, I get the following warning:</p>

<p><code>The extracted code has multiple entry points</code></p>

<p><img src=""http://img836.imageshack.us/img836/9003/resharper.jpg""/></p>

<p>Here is the method signature I am planning to use:    </p>

<pre><code>private void GetRatePlanComponents(ProductPlan productPlan, 
    ProductRatePlan productRatePlan)    
</code></pre>

<p>I Googled it for a while to understand what does it mean. But didn't have much luck.</p>

<p>Would it be possible for you to explain it to me please?</p>

<p>For your reference, here is the code snippet I am trying to move to a seprate method:</p>

<pre><code>QueryResult productRatePlanChargeQueryResult = 
    _zuoraService.query(string.Format(@""select Id, Name, IncludedUnits from
        ProductRatePlanCharge where ProductRatePlanId = '{0}' and 
        ChargeModel = 'Overage Pricing'"", productRatePlan.Id));

if (productRatePlanChargeQueryResult.size &gt; 0)
{
    foreach (ProductRatePlanCharge productRatePlanCharge 
        in productRatePlanChargeQueryResult.records)
    {
        string numberOfUnits = productRatePlanCharge.IncludedUnits.ToString();

        if (productRatePlanCharge.Name.Equals(""Users""))
        {
            productPlan.NumberofUsers = numberOfUnits;
        }
        else if (productRatePlanCharge.Name.Equals(""Projects""))
        {
            productPlan.NumberofProjects = numberOfUnits;
        }
        else if (productRatePlanCharge.Name.Equals(""Storage""))
        {
            decimal volumeOfStorage;
            if (decimal.TryParse(productRatePlanCharge.IncludedUnits.ToString(), 
                out volumeOfStorage))
            {
                if (volumeOfStorage &lt; 1) volumeOfStorage *= 1000;
                    productPlan.VolumeofStorage = volumeOfStorage.ToString();
                }
                else
                {
                    productPlan.VolumeofStorage = numberOfUnits;
                }
            }
        }
    }
}
</code></pre>
","<c#><.net><c#-3.0><refactoring><resharper>","5","667","2011-10-03 19:36:00"
"7650918","looking for a CLI program to do text transformation on Objective-C code","<p>I'm trying to find a command line program to do code / text transformations on Objective-C code.</p>

<p>E.g.: all method calls of type <code>[obj call:aMethod with:params];</code> should be transformed to <code>[obj re:params order:aMethod];</code></p>

<p>I'm 99% certain I have seen the man page of a program that does exactly these types of text transformations, specifically for Objective-C code ( in (Snow) Leopard ).
I just can't find it anymore. Maybe it was a part of previous versions of the Developer Tools?
I have tried looking through a list of all section (1|8) man pages, and did not find anything, but that could have been due to all the noise.</p>
","<objective-c><cli><software-tools><automated-refactoring>","1","61","2011-10-04 16:15:46"
"7655406","Abstracting multiple C# classes","<p>I have to deal with a project where someone else has copied and pasted the same class some 12 times, added some customization, but mainly, the structure of the classes are really similar because they were copied from each other.</p>

<p>I am itching to refactor the code because I can't stand looking at the code base.</p>

<p>Is there a tool that can automate some of this headache, that is, extract identical properties and methods into a parent class and make the other classes inherit from it?</p>
","<c#><refactoring><abstraction>","1","117","2011-10-05 00:10:53"
"7659897","Make if/else if statement less clumsy. Novice here","<p>Although this is a form created in Breezingforms for Joomla, my question is more of a generic javascript question. I am very new to javascript so hopefully someone can answer this easily. This is being called upon initialization of a form.</p>

<p>I am using a javascript loop in a selection list object to hide/unhide various sections of a form, depending on the selection list choice. I'm trying to make the if/else if statements less clumsy. I'm sure there is a way to make this shorter and more concise, but being such a novice, I haven't been able to figure it out. </p>

<p>On a side note (not as important at the moment, but it will be), I'd like to use this script for other selection list calls, with minor variations. I still am not too clear on reusing code. If someone has any comments on that, it would be appreciated.</p>

<p>BTW, I am even more of a novice at jQuery, so if you go there, be VERY kind! :)</p>

<pre><code>var selListVal = """";
var selListInput =  JQuery(""[name=\""mySelectionList[]\""]"");
for (var i = 0; i &lt; selListInput.length; i++)
 if (selListInput[i].value) {
  if (selListVal != """") selListVal += "","";
   selListVal += selListInput[i].value;
 }
    if( selListVal == ""myselection01"" ){
      ToggleFields('on', 'section', 'mysection01A', DeactivateField);
      ToggleFields('on', 'section', 'mysection01B', DeactivateField);
      } 
    else if( selListVal == ""myselection02"" ){
      ToggleFields('on', 'section', 'mysection01A', DeactivateField);
      ToggleFields('on', 'section', 'mysection01B', DeactivateField); 
      ToggleFields('on', 'section', 'mysection02A', DeactivateField);
      ToggleFields('on', 'section', 'mysection02B', DeactivateField);
      }
    else if( selListVal == ""myselection03"" ){
      ToggleFields('on', 'section', 'mysection01A', DeactivateField);
      ToggleFields('on', 'section', 'mysection01B', DeactivateField);
      ToggleFields('on', 'section', 'mysection02A', DeactivateField);
      ToggleFields('on', 'section', 'mysection02B', DeactivateField);
      ToggleFields('on', 'section', 'mysection03A', DeactivateField);
      ToggleFields('on', 'section', 'mysection03B', DeactivateField);
      }
     else {
      ToggleFields('off', 'section', 'mysection01A', DeactivateField);
      ToggleFields('off', 'section', 'mysection01B', DeactivateField);
      ToggleFields('off', 'section', 'mysection02A', DeactivateField);
      ToggleFields('off', 'section', 'mysection02B', DeactivateField);
      ToggleFields('off', 'section', 'mysection03A', DeactivateField);
      ToggleFields('off', 'section', 'mysection03B', DeactivateField);
      }
</code></pre>
","<javascript><jquery><refactoring>","1","119","2011-10-05 10:26:27"
"7670708","How to make this jquery UI code compatible with jQuery UI 1.7.2 and jQuery 1.3.2?","<p>How to make this jquery UI code compatible with jQuery UI 1.7.2 and jQuery 1.3.2? </p>

<p><a href=""http://jsfiddle.net/jitendravyas/NTeXV/2/"" rel=""nofollow"">http://jsfiddle.net/jitendravyas/NTeXV/2/</a></p>

<p>In a old project where jquery 1.3.2 is being used heavily so i can't change that and I want to style some checkboxes like this I made this by reading documentation on jquery ui website the later I found that it only works with jQuery 1.4.4 or greater and jQuery UI 1.8.7+ see here <a href=""http://jsfiddle.net/jitendravyas/GUwjK/"" rel=""nofollow"">http://jsfiddle.net/jitendravyas/GUwjK/</a></p>

<p>but I want to make it work with jQuery 1.3.2 and jQuery UI 1.7.2</p>

<pre><code>$(function() {
        $( ""#check1, #check2"" ).button();

    });
</code></pre>
","<javascript><jquery><forms><jquery-ui><refactoring>","0","48","2011-10-06 05:56:06"
"7673558","Self-made SQL model vs. ORM?","<p>I've read Stack Overflow discussion about ORM advantages and drawbacks, and there are different opinions. I would like to describe this particular case.</p>

<ul>
<li>LAMP based medium scaled web application with some spaghetti code inside.</li>
<li>The code is quite far from being OOP, though there are controllers with embedded templates, and weak model classes branch.</li>
<li>There are several dozen MySQL tables, and about thousand files.</li>
<li>Caching, tuned for performance MySQL queries with indicies.</li>
<li>About a million views per month.</li>
<li>Users have mostly read access.</li>
</ul>

<p>My question is this: </p>

<p><strong>Is it worthwhile to implement an ORM (Doctrine2 or Propel), or should I limit myself to writing model classes from the scratch</strong> (similar to ActiveRecord pattern, group methods/queries by table and record, so each entity has two related classes)?</p>

<p>The primary aims are:</p>

<ol>
<li><p>application performance, </p></li>
<li><p>ease of code/queries readability and modification, and</p></li>
<li><p>ease of possible DB (details) modification.</p></li>
</ol>

<p>Personally I prefer the second choice; there are quite complex SQL queries, I doubt an ORM would be able to maintain DB abstraction for all queries. The initial development is over and there is no need for rapid speed of development of code/query code. It is much more important for us to be able to read, understand and modify code/queries easy.</p>

<p>On the another hand, there could be some strong points in ORM use for given conditions that I miss.</p>
","<web-applications><orm><refactoring><lamp>","1","49","2011-10-06 11:23:44"
"7681508","Avoid duplicate code in statements like: isset($_GET['foo']['bar']) ? $_GET['foo']['bar'] : NULL;","<p>To read unknown variables in PHP often I use code like the following:</p>

<pre><code>$bar = isset($_GET['foo']['bar']) ? $_GET['foo']['bar'] : NULL;
</code></pre>

<p>I don't like to write the variable name twice. It just looks ugly and is too long for such an everyday task.</p>

<p>Do you know a better solution? Just using the <code>@</code> operator or suppress notices at all is no option (bad practice, slow).<br>
With a custom function and variable by reference it is somehow possible:</p>

<pre><code>function ifset(&amp;$value)
{
    if(isset($value)) return $value;
}
$bar = ifset($_GET['foo']['bar']); // $_GET is empty
</code></pre>

<p>However this creates silently new unwanted variables with that name/path. A <code>var_dump($_GET)</code> would print:</p>

<pre><code>array(1) {
  [""foo""]=&gt;
  array(1) {
    [""bar""]=&gt;
    NULL
  }
}
</code></pre>
","<php><coding-style><refactoring>","3","104","2011-10-06 23:12:05"
"7685655","Refactoring details in TDD","<p>I have read this article</p>

<p><a href=""http://codebetter.com/iancooper/2011/10/06/avoid-testing-implementation-details-test-behaviours/"" rel=""nofollow"">http://codebetter.com/iancooper/2011/10/06/avoid-testing-implementation-details-test-behaviours/</a></p>

<p>And I am confusing about </p>

<blockquote>
  <p>""Code developed in the context of refactoring does not require new
  tests!""</p>
</blockquote>

<p>For example during refactoring I deside to move some calculation to a new class, which calculate for me factorial and I use this class to calculate some user specific details. In my requirements I will never have feature to write this class, it just created during refactoring. But when I should cover this class with tests to guarantee expected behaviour? As I understood I will never cover this class with tests or I an wrong ?</p>
","<unit-testing><refactoring><tdd>","3","65","2011-10-07 09:55:24"
"7687603","Groovy: how to factorize code in HibernateCriteriaBuilder?","<p>I'm trying to factorize some groovy code inside a closure.</p>

<p>Here is a sample code illustrating what I want to do (see <a href=""http://grails.org/doc/latest/api/grails/orm/HibernateCriteriaBuilder.html"" rel=""nofollow"">HibernateCriteriaBuilder</a>)
base code:</p>

<pre><code>def criteria  = Account.createCriteria()
def results = criteria  {
  if(A) {
    // full code section when A
  } 
  if(B) {
    // full code section when B
  }
  ...
  if(N) {
    // full code section when N
  }
}
</code></pre>

<p>Now I want to extract condition block in method to be able to use them in other criteria.
Here is the code I have now: </p>

<pre><code>def criteria = Account.createCriteria()
def results = criteria  {
 a(criteria)
 b(criteria)
 ...
 n(criteria)
}
def a(criteria) { if(A) /* full code section when A */ }
def b(criteria) { if(B) /* full code section when B */ }
...
def n(criteria) { if(N) /* full code section when N */ }
</code></pre>

<p>Is there a groovy way to avoid to pass the criteria in the argument of each method ? (in other word, is there a way to get the calling context ?)</p>

<p>And, to extend this to other closure, how should I extract method from groovy closure ? </p>
","<groovy><refactoring><closures>","0","53","2011-10-07 12:59:54"
"7686440","Visual Studio: Automated reference cleaning?","<p>Is there any way of finding out what assemblies that's not used in a solution and have them removed automatically? (Just like when removing unneeded using-statements.)</p>

<p>Side note:</p>

<p>Wouldnt it be nice if it was possible to have an algorithm/program to automatically go through all code in a large solution to try to find the optimal way of refactoring it to get a more logical/managable set of projects thats has as few references to each other and other assemblies as possible?</p>

<p>Yes I know this should have been done from the beginning and maintained throughout the project. But all information to do this is available to the computer so it should be possible for it to do this for us. At least give us hints about some good alternatives. I havent researched this much but there may allready be solutions for this? Do anyone know? ReSharper cant to this I guess?</p>
","<c#><visual-studio><automated-refactoring>","0","77","2011-10-07 11:11:05"
"7693805","Database Refactoring in Rails","<p>I need to refactor the data model for a Rails application. This will involve consolidating two models (DB tables) into one. What would be the right way to do it? Will it be ok to delete a model? I assume, this will break previous migrations. Should I use native SQL to do the DB migrations, or rather the ActionController methods?</p>
","<ruby-on-rails><database><database-design><refactoring>","0","76","2011-10-07 23:37:26"
"7696278","Ruby module optimization","<p>I'm new to ruby, but have great experience with other languages such as php, python, javascript etc.</p>

<p>I have been writing this module with implementation of blend modes in ruby, to get used to the language. However I think there could be made a lot of optimization and automation. I've been looking around in the docs, but it's really hard to find what I'm looking for, as I don't know the excat technical terms for the techniques I want to use.</p>

<p>Here's a small portion of my module:</p>

<pre><code>module Sass::Script::Functions
    def union(b, s)
        return b + s - (b * s)
    end

    def color_composite(cb, ab, cs, as, fnc)
        return ((1 - as) * ab * cb) + ((1- ab) * as * cs) + (ab * as * fnc)
    end

    def multiply_channel(cb, cs)
        return cb * cs / 255
    end
    #MULTIPLY
    def multiply(top, bottom)
        assert_type top, :Color
        assert_type bottom, :Color

        red = color_composite(bottom.red, bottom.alpha, top.red, top.alpha, multiply_channel(bottom.red, top.red));
        green = color_composite(bottom.green, bottom.alpha, top.green, top.alpha, multiply_channel(bottom.green, top.green));
        blue = color_composite(bottom.blue, bottom.alpha, top.blue, top.alpha, multiply_channel(bottom.blue, top.blue));


        return [red, green, blue, union(bottom.alpha, top.alpha)];
    end


    def darken_channel(cb, cs)
        return [cb, cs].min
    end
    #DARKEN 
    def darken(top, bottom)
        assert_type top, :Color
        assert_type bottom, :Color

        red = color_composite(bottom.red, bottom.alpha, top.red, top.alpha,     darken_channel(bottom.red, top.red));
        green = color_composite(bottom.green, bottom.alpha, top.green, top.alpha, darken_channel(bottom.green, top.green));
        blue = color_composite(bottom.blue, bottom.alpha, top.blue, top.alpha, darken_channel(bottom.blue, top.blue));


        return [red, green, blue, union(bottom.alpha, top.alpha)];
    end
end
</code></pre>

<p>Here's what I'd like to do:</p>

<ul>
<li>Have <strong>one function</strong> to process the different channels, and take the blend mode as a parameter. eg. blend(top, bottom, 'multiply')</li>
<li>Be able to <strong>iterate</strong> though the three channels to minimize duplication</li>
</ul>

<p>If you can just point me in the right direction that would be greatly appriciated!</p>

<p><strong>EDIT</strong></p>

<p>I'd like to iterate over the colors like this:</p>

<pre><code>color = []
for (red,green,blue) as channel
    color &lt;&lt; color_composit(bottom.channel, bottom.alpha, top.channel, top.alpha, blendmode(bottom.channel, top.channel))
</code></pre>

<p>Also can the code you replied with be automated even more so I don't need to define a darken function that runs darken_channel on each channel, but just call the blend function and pass ""darken"" as a parameter, and then it appends ""_channel"" by itself? Can I just append a string?</p>
","<ruby><optimization><refactoring>","0","58","2011-10-08 10:45:28"
"7702179","Does Powerbuilder 12 provide any refactoring capabilities?","<p>Porting legacy PB code to the .NET era might require major refactoring, to get the work done properly. Our code, for instance, has some pre-userobject leftovers, as well as deprecated features such as MDI, PBNI etc. I'm wondering how much help will we get from the VS shell when it comes to refactoring capabilities - breaking long functions into separate ones, finding all callers of a certain function or event etc.</p>

<p>The classic IDE is horrible for such tasks. Has using VS now made them easier?</p>
","<refactoring><powerbuilder><powerbuilder.net>","1","139","2011-10-09 08:00:18"
"7707673","refactoring javascript. decouple markup or separate modules","<p>I'm trying to make a large (~10K lines) javascript code base more maintainable.  Pretty much all of the code is contained in one massive class.  I want to do some refactoring, but I don't want to completely rewrite the code.  </p>

<p>I have two ideas for how to re-organize the code, but I'm not sure which one is best. (I'm very open to other ideas too)  What do you think about each of these approaches?  How would you decide which is best?</p>

<p>Idea 1 – Decouple markup from business logic.
We have a somewhat complicated set of rules for what and how things should be displayed to users.  This approach would split that into ""What do we display?"" and ""How do we display it?""</p>

<p>Idea 2 – Break apart separate components into their own class. 
There are several somewhat disjoint components in this code.  If this code base were Facebook's – this approach would involve pulling apart the code for photos and the newsfeed.</p>
","<javascript><refactoring>","3","86","2011-10-10 01:10:01"
"7713654","How to implement/override methods in eclipse fast?","<p>If I wont override some methods I should RMK(on the class name)->Source->Override/impl...</p>

<p>Does in Eclipse exists hot key of this function?</p>
","<java><eclipse><ide><refactoring>","1","134","2011-10-10 13:40:41"
"7711394","Recommend a strategy ? (basically, for large scale re-factoring)","<p>Might anyone be able to recommend a strategy for the following? </p>

<p>There's a large organization which refers to customers by an id, or reference like ‘1234A’ (four numbers and a letter). These id’s are used pretty much everywhere, database queries and primary keys, about 40 Java applications, many external interfaces, there’s Visual Basic, spread sheets, you name it.
They will need to change this from ‘1234A’ to also allow the format ‘1234AB’ (four numbers and two letters). So, a simple change with really big impact.</p>

<p>I’m starting to think about what might be a good approach. Might anyone know any recommended strategies, or patterns etc?</p>

<p>I've noticed the related posting- 
<a href=""http://stackoverflow.com/questions/330220/strategy-for-large-scale-refactoring"">Strategy for large scale refactoring</a></p>

<p>Thanks!</p>
","<design><design-patterns><architecture><refactoring><analysis>","2","89","2011-10-10 10:22:56"
"7724184","Liquibase: Change a INT autoincrement column to BIGINT using modifyDataType refactoring with H2 database","<p>I have a primary key column which is an INT column which I would like to change to a BIGINT. Our test and production environment uses MySQL, but for unit tests we use the embedded H2 database.</p>

<p>I have created the following Liquibase refactoring:</p>

<pre class=""lang-xml prettyprint-override""><code>...
&lt;changeSet id=""1"" author=""trond""&gt;
    &lt;modifyDataType tableName=""event"" columnName=""id"" newDataType=""BIGINT"" /&gt;
    &lt;rollback&gt;
        &lt;modifyDataType tableName=""event"" columnName=""id"" newDataType=""INT"" /&gt;
    &lt;/rollback&gt;
&lt;/changeSet&gt;
...
</code></pre>

<p>The refactoring works, but when I try to persist an object to the database using Hibernate, I get the following error message (I've wrapped the error message):</p>

<pre><code>ERROR org.hibernate.util.JDBCExceptionReporter [main]: NULL not allowed for column ""ID""; 
    SQL statement: insert into event (id, eventtime, guid, meta, objectguid, originatorid, subtype, type) values (null, ?, ?, ?, ?, ?, ?, '0') [90006-140]

JDBC exception on Hibernate data access: 
    SQLException for SQL [insert into event (id, eventtime, guid, meta, objectguid, originatorid, subtype, type) values (null, ?, ?, ?, ?, ?, ?, '0')]; 
    SQL state [90006]; error code [90006]; could not insert: [event.MyEvent]; 
    nested exception is org.hibernate.exception.GenericJDBCException: could not insert: [event.MyEvent]
</code></pre>

<p>The MyEvent class inherits from a AbstractBaseEvent which has defined the following Hibernate mapping in the code:</p>

<pre class=""lang-java prettyprint-override""><code>@Id
@GeneratedValue(strategy = GenerationType.AUTO)
private long id;
</code></pre>

<p>A few points:</p>

<ul>
<li>The hibernate mapping works before the refactoring of the data type</li>
<li>Version of Liquibase is 2.0.1</li>
<li>Whether or not this works with MySQL hasn't been tested yet</li>
</ul>
","<hibernate><types><refactoring><h2><liquibase>","3","616","2011-10-11 09:51:01"
"7747173","Refactoring Jquery coffeescript code into separate files","<p>I have a coffeescript file called shapes.coffee:</p>

<pre><code>jQuery -&gt;

  offset = $('#drawing_canvas').offset()
  mouse_vertical_position = -Number(offset.top)
  mouse_horizontal_position = -Number(offset.left)

  canvas = document.getElementById(""drawing_canvas"")
  context = canvas.getContext(""2d"")
  container = canvas.parentNode

  temporary_canvas = document.createElement(""canvas"")
  temporary_canvas.id = ""temporary_canvas""
  temporary_canvas.height = canvas.height
  temporary_canvas.width = canvas.width
  container.appendChild(temporary_canvas)
  temporary_context = temporary_canvas.getContext(""2d"")

  mouse_down_selected = false

  $('#temporary_canvas').mousedown (e) -&gt;
    mouse_down_selected = true
    mouse_horizontal_position = -Number(offset.left)
    mouse_vertical_position = -Number(offset.top)
    mouse_horizontal_position += e.pageX
    mouse_vertical_position += e.pageY

  $('body').mouseup -&gt;
   mouse_down_selected = false
</code></pre>

<p>I would like to refactor some of these lines into their own methods (ideally in separate files).  I have attempted to do this but I get method not defined errors in the console, and I have been unable to find an example involving jquery.  The first group of  code before the temporary canvas function would need to be called on document load.  Any examples or advice is appreciated.</p>

<p>Thanks.</p>
","<jquery><refactoring><coffeescript>","2","173","2011-10-12 22:05:39"
"7755351","Resharper - refactoring, extract superclass from multiple classes and derive from it","<p>I want to refactor multiple classes that I think should derive from one base class.</p>

<p>How to properly accomplish this refactoring using Resharper 6 ? I can extract superclass from one of the classes, but what next? Do I have to manualy then derive from this base class and search for same members in every class I want to be derived?</p>
","<c#><refactoring><resharper>","2","125","2011-10-13 14:05:07"
"7755850","How can the following C# code be simplified?","<p>Using .Net framework 2.0, how can the following C# code be simplified?</p>

<pre><code>public class MemoryItem {}
public class MemoryFolder : MemoryItem {}
public class MemoryFile : MemoryItem {}

public bool TryFetchFolder(string name, ref MemoryFolder folder)
{           
    MemoryItem fetchedFolder = null;

    if (!TryFetchFolderOrFile(name, ref fetchedFolder))
        return false;

    if (!(fetchedFolder is MemoryFolder))
        return false;

    folder = (MemoryFolder)fetchedFolder;
    return true;
}

public bool TryFetchFile(string name, ref MemoryFile file)
{           
    MemoryItem fetchedFile = null;

    if (!TryFetchFolderOrFile(name, ref fetchedFile))
        return false;

    if (!(fetchedFile is MemoryFile))
        return false;

    file = (MemoryFile)fetchedFile;
    return true;
}

public bool FolderOrFileExists(string name)
{    
    MemoryItem item = null;
    return TryFetchFolderOrFile(name, ref item);
}

private bool TryFetchFolderOrFile(string name, ref MemoryItem folderOrFile)
{                           
    // Gets either MemoryFile or MemoryFolder and return true if found. 
    // Return false otherwise.
}
</code></pre>
","<c#><.net><refactoring><source-code>","-1","130","2011-10-13 14:38:43"
"7756149","Does refactoring XML-serializable public fields as auto properties break deserialization of old instances?","<p>I have a class which has a number of public fields that are marked with XML serializable attributes:</p>

<pre><code>    [XmlAttribute]
    public string ExampleField = string.Empty;
</code></pre>

<p>I intend to refactor these fields (and only these fields) as auto-properties:</p>

<pre><code>    [XmlAttribute]
    public string ExampleField { get; set; }
</code></pre>

<p>Will there be any issue with deserializing instances that were created using the previous version of the class?</p>

<p>Thanks,</p>

<p>Rob</p>
","<c#><refactoring><xml-serialization>","2","79","2011-10-13 14:59:28"
"7758884","What is a good PHP framework for migrating an existing app to?","<p>I've recently come on board with a PHP application.  There has not been much design put into the app - there is a front controller, however, view, model and controller code is usually mixed together.</p>

<p>I would like to slowly start refactoring the code beginning with moving all the SQL queries into appropriate models.  Having looked at a few frameworks, it seems that most frameworks are setup with the assumption that an app will be developed from scratch using that framework.</p>

<p>Is there a good framework that I can just kind of plug-in so that I can use the model libraries and then perhaps later on, integrate more of the app into the framework?  Would Doctrine be a good tool for something like this?  Or should I just setup my own models without relying on third-party libraries?</p>
","<php><frameworks><refactoring><doctrine>","2","116","2011-10-13 18:41:56"
"7761943","Refactoring options in Visual Studio 2010 differ between C# and VB","<p>In VS2010 C#, when I right-click there is ""Refactor"" menu with following options:</p>

<ul>
<li>Rename  </li>
<li>Extract Method  </li>
<li>Encapsulate Field  </li>
<li>Extract Interface  </li>
<li>Remove Parameters  </li>
<li>Reorder Parameters</li>
</ul>

<p>Are these options available in VS2010 VB.Net? All I can see is ""Rename"" when I right click?</p>
","<c#><vb.net><visual-studio-2010><refactoring>","1","695","2011-10-14 00:31:40"
"7765209","Will the condition on a LINQ Where-statement re-evaluate during the loop?","<p>I have this <code>foreach</code>-loop:</p>

<pre><code>foreach (var classId in m_ClassMappings[taAddressDefinition.Key])
{
    if(!m_TAAddressDefinitions.ContainsKey(classId))
    {
        m_TAAddressDefinitions.Add(classId, taAddressDefinition.Value);
    }
}
</code></pre>

<p><code>m_TAAddressDefinitions</code> is an <code>IDictionary</code> where classId is used as the unique Key value.<br>
Resharper suggests to change the <code>if</code>-statement into into a LINQ filter like this:</p>

<pre><code>foreach (var classId in m_ClassMappings[taAddressDefinition.Key].Where(
    classId =&gt; !m_TAAddressDefinitions.ContainsKey(classId)))
{
    m_TAAddressDefinitions.Add(classId, taAddressDefinition.Value);
}
</code></pre>

<p>I am conserned if this might not work as expected, since the content of the <code>m_TAAddressDefinitions</code> collection is changing inside the loop, which causes the source of the LINQ filter-condition (<code>classId =&gt; !m_TAAddressDefinitions.ContainsKey(classId)</code>) to change on the way.</p>

<p>Will this fail if two <code>classId</code> with same value is added inside the loop, or will the LINQ condition be recalculated when values are added to the collection? My original if-statement was intended to not cause exception if the key already exist.</p>
","<c#><.net><linq><refactoring>","3","147","2011-10-14 08:51:47"
"7767567","Is there a tool for Scala to clean all the unused imports from all the code files?","<p>I believe my source code files feature many imports that are not used in the code (as I have a bad habit of copying them from existing to new files). When coding C# in Visual Studio (or, maybe, it's a feature of an add-on of it) one can wipe out all the unused imports in just a click. Is there an analogous tool for Scala? Would be cool if I could just point it to my sources directory and it would clean all the files inside it and all its subdirs and subdirs of them (etc).</p>
","<scala><refactoring><automated-refactoring>","6","161","2011-10-14 12:27:54"
"7773030","C++ / How to refactor this function","<p>I have a map stored as a NxM matrix. In this map I want to add a mazed path storing as well the direction of the path and the type (line from left to right, corner from top to left, etc...) for graphical rendering issues.</p>

<p>The path is constructed by sucesive calls to a function that adds an horizontal or vertical path (code posted below). This function has very similar pieces of code wich I think can be refactored to a more general case but I can´t see it. Do you know how can I do it?</p>

<pre><code>void Map::addTraject(int initial_x, int initial_y, int final_x, int final_y){
    //Check verticality of the path
    bool vertical;
    if (initial_x == final_x)
        vertical = false;
    else if (initial_y == final_y)
        vertical = true;
    else 
        throw WrongCoordinatesException(""Traject cannot be diagonal"");

    //Get the last road added to the path
    Road* last;
    if (route.size() == 0) {
        last = NULL;
    }
    else {
        last = route.at(route.size()-1);
        assert(initial_x == last-&gt;x &amp;&amp; initial_y == last-&gt;y);
    }

    if (last != NULL){
        //Last road never can be a corner
        switch(last-&gt;type) 
        {
        case LEFT_TOP:
        case LEFT_DOWN:
        case RIGHT_TOP:
        case RIGHT_DOWN:
        case TOP_LEFT:
        case TOP_RIGHT:
        case DOWN_LEFT: 
        case DOWN_RIGHT: 
            assert(false);
        }
    }

    if (vertical)
    {
        if (initial_x &lt; final_x) //LEFT-RIGHT path
        { 
            //Change last road to a corner if needed
            if (last != NULL)
            {
                switch(last-&gt;type) 
                {
                case LEFT_RIGHT: break;
                case RIGHT_LEFT: throw WrongCoordinatesException(""Path cannot be overlapped"");
                case TOP_DOWN: last-&gt;type = TOP_RIGHT; break;
                case DOWN_TOP: last-&gt;type = DOWN_RIGHT; break;
                }
                initial_x++; //Start in the position at the right
            } 
            for (int i = initial_x; i &lt;= final_x; i++){
                route.push_back(new Road(i, initial_y, LEFT_RIGHT));
            }
        }else {
            //RIGHT-LEFT path
            //Change last road to a corner if needed
            if (last != NULL)
            {
                switch(last-&gt;type) 
                {
                case LEFT_RIGHT: throw WrongCoordinatesException(""Path cannot be overlapped"");
                case RIGHT_LEFT: break;
                case TOP_DOWN: last-&gt;type = TOP_LEFT; break;
                case DOWN_TOP: last-&gt;type = DOWN_LEFT; break;
                }
                initial_x--; //Start in the position at the left
            } 
            for (int i = initial_x; i &gt;= final_x; i--){
                route.push_back(new Road(i, initial_y, RIGHT_LEFT));
            }
        }
    }
    else {
        if (initial_y &lt; final_y){
            //TOP-DOWN path
            //Change last road to a corner if needed
            if (last != NULL)
            {
                switch(last-&gt;type) 
                {
                case LEFT_RIGHT: last-&gt;type = LEFT_DOWN; break;
                case RIGHT_LEFT: last-&gt;type = RIGHT_DOWN; break;
                case TOP_DOWN: break;
                case DOWN_TOP: throw WrongCoordinatesException(""Path cannot be overlapped"");
                }
                initial_y++; //Start in the position at the bottom
            } 
            for (int i = initial_y; i &lt;= final_y; i++){
                route.push_back(new Road(initial_x, i, TOP_DOWN));
            }
        } else {
            //DOWN-TOP path
            //Change last road to a corner if needed
            if (last != NULL)
            {
                switch(last-&gt;type) 
                {
                case LEFT_RIGHT: last-&gt;type = LEFT_TOP; break;
                case RIGHT_LEFT: last-&gt;type = RIGHT_TOP; break;
                case TOP_DOWN: break;
                case DOWN_TOP: throw WrongCoordinatesException(""Path cannot be overlapped"");
                }
                initial_y--;
            } 
            for (int i = initial_y - 1; i &gt;= final_y; i--){
                route.push_back(new Road(initial_x, i, DOWN_TOP));
            }
        }
    }
}
</code></pre>
","<c++><refactoring>","0","144","2011-10-14 20:10:24"
"7774032","LNK2020 & LNK1120 errors in old class in old working project since other project added that includes same class","<p>I am getting unexpected linker errors after refactoring my solution from 1 to 3 projects. In this first instance I get two unresolved tokens, like</p>

<blockquote>
  <p>error LNK2020: unresolved token (0600000C) Mynamespace.MyClass::unresolvedStaticFunc</p>
  
  <p>error LNK2020: unresolved token (0600000C) Mynamespace.MyClass::unresolvedOtherStaticFunc</p>
  
  <p>fatal error LNK1120: 2 unresolved externals</p>
</blockquote>

<p>I have not touched this class in my refactoring. Both methods are declared static in the header but not the body (cpp file).</p>

<p>I've rechecked my errors and the new project is compiling fine but forcing the old one to break on linking.</p>

<p>I think I need to add files to my new projects but they seem nicely separated into their own folders now. Another project for the shared class perhaps? I am adding what I thought a simple feature and my project count has already tripled.</p>
","<static><linker><refactoring><c++-cli><linker-error>","0","78","2011-10-14 22:00:16"
"7780743","Refactoring a One-to-many relation to a Many-to-Many in MySQL: How to formulate the query?","<p>In the initial 'version' of the application that I'm working on, a design consideration wasn't taken into account - no one thought of it.</p>

<p>However, it seems that the original one-to-many relation needs to be refactored into a many-to-many. My question is how best to do this? I'm using MySQL for persistence. </p>

<p>Populating the relationship table will only be a one time effort, I'd rather go with a simple query or a stored procedure approach (I'm not well versed with the latter); rather than write  java/jdbc based logic to do it (I know I can and it's not too difficult, but that's <em>not</em> what I want)</p>

<p>So here's an example of the relation:</p>

<pre><code>|VirtualWhiteBoard| -1------*- |Post|
</code></pre>

<p>A virtual white board can have many posts. The new functionality is: 1 post should belong to multiple white boards if the user chooses to 'duplicate' current white board (not thought of before)</p>

<p>The schema looks like this:</p>

<pre><code>VirtualWhiteBoard (wallName, projectName,dateOfCreation,..., Primary_Key(wallName, projectName));
Post(post_id, wallName,postData,..., Primary_Key(post_id), Foreign_Key(wallName, projectName));
</code></pre>

<p>The virtual white board has a composite primary key (wallName, projectName) and each post has a post_id as primary key</p>

<p>Question: Take the primary keys from VirtualWhiteBoard and Post and add it to the new relation 'has_posts':</p>

<pre><code>|VirtualWhiteBoard| -1------*- |has_Post| -*------1- |Post|
</code></pre>

<p>To keep the previous relationships intact and then drop the foreign key column of wallName in Post.</p>

<p>How best to achieve this? Would a query suffice or stored procedures would be required?</p>

<p>(Although I can do this in the 'application' I'd prefer to do it this way, since such refactorings are bound to arise and I don't want unnecessary java-code lying around that'll need to be maintained and would personally prefer to have such a skill too :)</p>
","<mysql><database><database-design><refactoring>","0","60","2011-10-15 21:26:52"
"7786676","Want to make this permissioning system generic to reduce duplicate code etc","<p>I have a bunch of enumerations that represent permissions for various parts of the application.</p>

<pre><code>public enum PermissionGroup1 
{
    CanDo11,
    CanDo12,
    CanDo13,
}

public enum PermissionGroup2 
{
    CanDo21,
    CanDo22,
    CanDo23,
}

public enum PermissionGroup3 
{
    CanDo31,
    CanDo32,
    CanDo33,
}
</code></pre>

<p>For a given user, I have a collection of all of the user's permissions, and then to check permissions I have a method like:</p>

<pre><code>public Boolean CheckXXXAccess(int ModuleID, PermissionGroupX permission)
    {
        bool hasAccess = false;

        if (!m_Permissions.ContainsKey(ModuleID))
        {
            hasAccess = false;
        }
        else
        {
            hasAccess = (permission == (ModulePermissions[ModuleID].PermissionGroupX &amp; permission));
        }

        return hasAccess;            
    }
</code></pre>

<p>So to explain it further, the database contains a ModuleID (there is a PermissionGroup enumeration for a given module type), and then I have a method like CheckXXXAccess for each module type.</p>

<p><strong>How can I use generics to make a single method instead of repeating it?</strong></p>
","<c#><design><generics><permissions><refactoring>","3","102","2011-10-16 19:21:33"
"7794178","What tools are available for Ruby refactoring?","<p>Are there any tools which support refactoring Ruby code (Rename method, Rename class, Extract method, Move method, ...)?</p>

<p>The best I know is RadRails 2, but Aptana 3 removed this tool.</p>

<p><a href=""http://wiki.netbeans.org/RubySupport"" rel=""nofollow"">Netbeans doesn't support Ruby on Rails anymore</a> (it has community support)</p>

<p><a href=""http://community.activestate.com/forum/any-plans-refactoring-la-eclipse"" rel=""nofollow"">Komodo just promises it</a></p>

<p>Is there any such tool available? Do you know any? Rubymine ?</p>

<p>No matter if it is a command line tool, a Standalone GUI tool or integrated with Development Environment.</p>

<p>Please avoid answers like ""ruby is so good to refactor"" or ""tests are your best friend""</p>
","<ruby><ide><tools><refactoring>","4","229","2011-10-17 13:05:48"
"7794566","Refactor: Replace with Constant String.Empty","<p>I have the following line of code </p>

<pre><code>Dim a As String = """"
</code></pre>

<p>and the Refactor suggests replacing the <code>""""</code> with <code>String.Empty</code></p>

<p>It is a kind of Reafactoring but why? Since i am a newbie in the future declarations of mine should i better use the <code>String.Empty</code> ?</p>
","<vb.net><refactoring><devexpress>","2","83","2011-10-17 13:36:12"
"7795455","How to write a method that can be shared by two non-inherited class","<p>I am having 2 classes, both having a same method(name + type +behavior) and a same property (name + type)</p>

<pre><code>public class Country
{
    public string Name { get; set; }

    public void DisplayName()
    {
        Console.WriteLine(this.Name);
    }
}

public class Person
{
    public string Name { get; set; }

    public void DisplayName()
    {
        Console.WriteLine(this.Name);
    }
}
</code></pre>

<p>-- <code>Person</code> and <code>Country</code> classes are not allowed to inherit</p>

<p>In the above code you can see <code>Person</code> class has similar method(<code>DisplayName</code>) like <code>Country</code> class. I am looking for a way so that both classes can share the same method codes, i want to do this because in my real codes-  Method which i want to share is very big and whenever i change code in one class i have to copy paste it in other class too. That i feel is not the correct way.</p>

<p>Please suggest how to resolve this problem.</p>
","<c#><.net><refactoring><polymorphism>","3","104","2011-10-17 14:45:06"
"7798788","How do I make a method that returns a Response in my utilities library?","<p>In a code-behind I have a method that consists of the following:</p>

<pre><code>        Response.Clear();
        Response.ClearHeaders();
        Response.ContentType = ""xxx"";
        Response.AppendHeader(""Content-Disposition"", ""xxx"");
        Response.AppendHeader(""Content-Length"", xxx);
        Response.BinaryWrite(xxx);
        Response.Flush();
        Response.End();
</code></pre>

<p>Now, this code will be used in a few different places. The code will be identical in the various places it is used. Only the file name and byte array will change and those are parameters passed to the existing method.</p>

<p>My question is, how do I pull this code out from the current code-behind and place it in a ""Utilities"" class. I tried copying and pasting the code into the class where I'd like it to reside by the Response object is giving me some problems (Cannot resolve symbol 'Response'). I tried instantiating an HttpResponse to return but the constructor only takes a textwriter and upon further research, MSDN says I shouldn't be doing that anyway.</p>

<p>Any suggestions?</p>
","<asp.net><.net-4.0><refactoring>","1","27","2011-10-17 19:52:24"
"7806125","Handling multiple setInterval calls","<p>I am having trouble working out how to create a simple pop-and-drop effect for a class of divs. Since the onmouseover events of each of the items in this class are currently calling the same function, rapidly mousing between divs leaves the previous div stuck halfway through (if you mouse on and off from the bottom of the div, you'll see the effect I'm trying to produce).</p>

<p>My current approach also calls for me to replicate quite a bit of code to call the function from each individual div's event handlers, so if there's a way to wrap those up into one function I'd really like to know how. I'm sure there's a simple and efficient way to do all this, just can't seem to work it out. </p>

<p><em><strong>jsFiddle example:</em></strong> <a href=""http://jsfiddle.net/DvXDb/"" rel=""nofollow"">http://jsfiddle.net/DvXDb/</a></p>

<p>Here's my code (script at the bottom):</p>

<hr>

<pre><code>div.bouncer{
       position:relative;
        top:50px;
    }




    function next(elem) {
        do {
            elem = elem.nextSibling;
        } while (elem &amp;&amp; elem.nodeType != 1);
        return elem;
    }
    var thisDiv; var nextDiv; var selDiv;
    var containerDivList = document.getElementsByClassName(""container"");
    var containerArray = Array.prototype.slice.call(containerDivList);
    var container1 = containerArray[0];
    var container2 = containerArray[1];
    var container3 = containerArray[2];
    var container4 = containerArray[3];
    container1.onmouseover = function () {
        callPop(this.getElementsByTagName('div')[0]);
    }
    container1.onmouseout = function () {
        callDrop(this.getElementsByTagName('div')[0]);
    }
    container2.onmouseover = function () {
        callPop(this.getElementsByTagName('div')[0]);
    }
    container2.onmouseout = function () {
        callDrop(this.getElementsByTagName('div')[0]);
    }
    container3.onmouseover = function () {
        callPop(this.getElementsByTagName('div')[0]);
    }
    container3.onmouseout = function () {
        callDrop(this.getElementsByTagName('div')[0]);
    }


    var relativeHeights = ['0px', '5px', '10px', '15px', '20px', '25px', '30px', '35px', '40px', '45px', '50px'];
    var index = 10;
    var intervalHandle1;
    function callPop(thisDiv) {
        clearInterval(intervalHandle1);
        selDiv = thisDiv;
        intervalHandle1 = setInterval(popImage, 5);
    }
    function callDrop(thisDiv) {
        clearInterval(intervalHandle1);
        selDiv = thisDiv;
        intervalHandle1 = setInterval(dropImage, 5);
    }
    function popImage() {
        selDiv.style.top = relativeHeights[index];
        index--;
        if (selDiv.style.top === '0px') {
            index = 0;
        }
    }
    function dropImage() {
        index++;
        selDiv.style.top = relativeHeights[index];
        if (selDiv.style.top === '50px') {
            index = 10;
        }
    }
</code></pre>
","<javascript><event-handling><refactoring><setinterval>","0","103","2011-10-18 10:55:36"
"7810620","How to refactor the following method?","<p>How to refactor the following method?</p>

<p>It's both long, repetitive, and hard to follow.</p>

<pre><code>    private void Map(object x, JToken json)
    {
        var objType = x.GetType();
        var props = objType.GetProperties().Where(p =&gt; p.CanWrite).ToList();

        foreach (var prop in props)
        {
            var type = prop.PropertyType;

            var name = prop.Name;
            var value = json[name];
            var actualName = name;

            if (value == null)
            {
                // try camel cased name
                actualName = name.ToCamelCase(Culture);
                value = json[actualName];
            }

            if (value == null)
            {
                // try lower cased name
                actualName = name.ToLower(Culture);
                value = json[actualName];
            }

            if (value == null)
            {
                // try name with underscores
                actualName = name.AddUnderscores();
                value = json[actualName];
            }

            if (value == null)
            {
                // try name with underscores with lower case
                actualName = name.AddUnderscores().ToLower(Culture);
                value = json[actualName];
            }

            if (value == null)
            {
                // try name with dashes
                actualName = name.AddDashes();
                value = json[actualName];
            }

            if (value == null)
            {
                // try name with dashes with lower case
                actualName = name.AddDashes().ToLower(Culture);
                value = json[actualName];
            }

            if (value == null || value.Type == JTokenType.Null)
            {
                continue;
            }

            // check for nullable and extract underlying type
            if (type.IsGenericType &amp;&amp; type.GetGenericTypeDefinition() == typeof(Nullable&lt;&gt;))
            {
                type = type.GetGenericArguments()[0];
            }

            if (type.IsPrimitive)
            {
                // no primitives can contain quotes so we can safely remove them
                // allows converting a json value like {""index"": ""1""} to an int
                var tmpVal = value.AsString().Replace(""\"""", string.Empty);
                prop.SetValue(x, tmpVal.ChangeType(type), null);
            }
            else if (type.IsEnum)
            {
                string raw = value.AsString();
                var converted = Enum.Parse(type, raw, false);
                prop.SetValue(x, converted, null);
            }
            else if (type == typeof(Uri))
            {
                string raw = value.AsString();
                var uri = new Uri(raw, UriKind.RelativeOrAbsolute);
                prop.SetValue(x, uri, null);
            }
            else if (type == typeof(string))
            {
                string raw = value.AsString();
                prop.SetValue(x, raw, null);
            }
            else if (type == typeof(DateTime) || type == typeof(DateTimeOffset))
            {
                DateTime dt;
                if (DateFormat.HasValue())
                {
                    var clean = value.AsString();
                    dt = DateTime.ParseExact(clean, DateFormat, Culture);
                }
                else if (value.Type == JTokenType.Date)
                {
                    dt = value.Value&lt;DateTime&gt;().ToUniversalTime();
                }
                else
                {
                    // try parsing instead
                    dt = value.AsString().ParseJsonDate(Culture);
                }

                if (type == typeof(DateTime))
                    prop.SetValue(x, dt, null);
                else if (type == typeof(DateTimeOffset))
                    prop.SetValue(x, (DateTimeOffset)dt, null);
            }
            else if (type == typeof(Decimal))
            {
                var dec = Decimal.Parse(value.AsString(), Culture);
                prop.SetValue(x, dec, null);
            }
            else if (type == typeof(Guid))
            {
                string raw = value.AsString();
                var guid = string.IsNullOrEmpty(raw) ? Guid.Empty : new Guid(raw);
                prop.SetValue(x, guid, null);
            }
            else if (type.IsGenericType)
            {
                var genericTypeDef = type.GetGenericTypeDefinition();
                if (genericTypeDef == typeof(List&lt;&gt;))
                {
                    var list = BuildList(type, value.Children());
                    prop.SetValue(x, list, null);
                }
                else if (genericTypeDef == typeof(Dictionary&lt;,&gt;))
                {
                    var keyType = type.GetGenericArguments()[0];

                    // only supports Dict&lt;string, T&gt;()
                    if (keyType == typeof(string))
                    {
                        var dict = BuildDictionary(type, value.Children());
                        prop.SetValue(x, dict, null);
                    }
                }
                else
                {
                    // nested property classes
                    var item = CreateAndMap(type, json[actualName]);
                    prop.SetValue(x, item, null);
                }
            }
            else
            {
                // nested property classes
                var item = CreateAndMap(type, json[actualName]);
                prop.SetValue(x, item, null);
            }
        }
    }
</code></pre>
","<c#><refactoring>","0","85","2011-10-18 16:30:35"
"7811674","Should Builder Pattern be used as a wrapper?","<p>Trying to evaluate whether or not to replace a cluttered chart helper class with the builder pattern.  In the helper class there are methods like these:</p>

<p>[ChartHelper]</p>

<pre><code>public static ChartTitle CreateStandardChartTitle(string titleText){}
public static void SetBarWidths( BarSeriesView bars ){}
public static void SetHorizontalChartHeight( WebChartControl chart, 
    int seriesCount, int margin ){}
public static void SetVerticalChartWidth( WebChartControl chart, 
    int seriesCount, int margin ){}
public static Legend SetStandardLegendProperties(WebChartControl chart){}
</code></pre>

<p>Obviously, these methods modify existing objects and are just modifying various properties on the WebChartControl.  This works pretty good for most scenarios, but the methods don't always apply to all the possible chart types (bar, line, pie, etc) and there are sometimes different ""configurations"" of how a chart should look that deviate from these helper methods.  <strong>Rather than try to satisfy these different ""configurations"" using a helper class, I was wondering about the builder pattern.</strong> </p>

<p>From what I understand the builder pattern is used to construct complex objects.  In my case, I already have the complex object created (the WebChartControl).  So, if I were to use the builder pattern, it would be just wrapping up instead of creating the WebChartControl.</p>

<p>I tossed some code together from what I am envisioning:</p>

<p>Director:</p>

<pre><code>public class ChartDirector
{
    private WebChartControl chart;
    public ChartDirector(WebChartControl chart)
    {
        this.chart = chart;
    }
    private StandardChartBuilder standardBuilder;
    public void Construct(StandardChartBuilder standardBuilder)
    {
        this.standardBuilder = standardBuilder;
        this.standardBuilder.Chart = this.chart;
        this.standardBuilder.BuildBorderOptions();
        this.standardBuilder.BuildPalette();
        this.standardBuilder.BuildLegend();
        this.standardBuilder.BuildSeriesLabel();
    }
}
</code></pre>

<p>Concrete Builder:</p>

<pre><code>public class BarChartBuilder : StandardChartBuilder
{
    public WebChartControl Chart { get; set; }

    public BarChartBuilder()
        : base(ChartType.Bar)
    {

    }
    public override void BuildBorderOptions()
    {
        Chart.BorderOptions.Visible = false;
    }
   ...
}
</code></pre>

<p>Abstract builder, allows for different configurations...:</p>

<pre><code>public abstract class StandardChartBuilder
{
    public WebChartControl Chart { get; set; }

    public StandardChartBuilder(ChartType chartType){}

    public abstract void BuildSeriesLabel();       
    public abstract void BuildBorderOptions();
    public abstract void BuildPalette();
    public abstract Legend BuildLegend();
}
</code></pre>

<p>As you can see from the code above, ChartDirector is not creating a <em>new</em> object, it is just modifying properties of an existing object that is being wrapped up.</p>

<p><strong>So, my question still stands, should I replace the ChartHelper class with the builder pattern, even though this is not a pure implementation of the builder pattern?</strong></p>
","<c#><design-patterns><refactoring>","0","97","2011-10-18 18:03:57"
"7815702","How can I refactor my LinqToSql to be more maintainable?","<p>I am using Linq2Sql as my data access, but I have quickly noticed that I am doing something wrong. </p>

<p>I have a list of Posts, and I need to be able to filter it in several different ways. For example:</p>

<ul>
<li>GetNewest()</li>
<li>GetOldest()</li>
<li>GetForUser(int)</li>
<li>GetByCategory(int)</li>
</ul>

<p>Each method returns a Model I have called <code>PostViewModel</code>. It is the expanded version of a post, and some of its foreign keys. (Author name, etc...)</p>

<p>A post looks like:</p>

<pre><code>class Post
{
    int Id;
    DateTime DateCreated;
    int AuthorId;
}
</code></pre>

<p>and the PostViewModel would be:</p>

<pre><code>class PostViewModel
{
    int Id;
    DateTime DateCreated;
    string AuthorName;
}
</code></pre>

<p>Each Method above is something like</p>

<pre><code>from p in db.Posts
where p.StatusID == (int)PostStatus.Visible //this can be different for each
order by &lt;something&gt;  //this can be different for each
select new PostViewModel() //this is the same for each
{
    //snip
}
</code></pre>

<p>I feel like I am doing something wrong. If I make changes to the PostViewModel, I will have to change each of those methods. It may be relevant to note that I expand the object into the PostViewModel so I don't have to go back to the database to get the AuthorName (and a few others) whenever I iterate over the result and display it.</p>

<p>Sp what can I do here? I'm not afraid of making drastic changes if needed.</p>
","<c#><linq-to-sql><refactoring>","3","67","2011-10-19 01:51:20"
"7817630","How much can this be simplified to a select statement in LINQ","<p>I am trying to gransp wether I can get big refactoring advantages out of learning LINQ.<br>
How can LINQ improve this code, which is a real-world example that is representative for a lot of code in a project I work on:</p>

<pre><code>foreach (SchemeElement elem in mainDiagram.Elements)
{
    if (elem.SubType == EElemSubType.BusBar)
    {
        if (connPts.Busbars.ContainsKey(elem.ConnectionPointId))
        {
            if (!taAddrList.TAAddressList.ContainsKey(elem.Key))
            {
                taAddrList.TAAddressList.Add(elem.Key, new TAAddress());
            }

            taAddrList.TAAddressList[elem.Key] = connPts.Busbars[elem.ConnectionPointId];                        
        }
    } // if busbar
} // foreach element
</code></pre>

<p><strong>For Clarity:</strong>  </p>

<p><code>taAddrList.TAAddressList</code> is of type <code>Dictionary&lt;ElemKey, TAAddress&gt;</code><br>
where <code>ElemKey</code> is a two-component type that consists of two <code>int</code> ID's. </p>

<p><code>connPts.Busbars</code> is of type <code>Dictionary&lt;int, TAAddress&gt;</code></p>
","<c#><linq><refactoring>","-1","87","2011-10-19 06:59:48"
"7807297","How can I change all my legacy Vectors to ArrayLists, and are there any caveats?","<p>I have a medium-sized Java project in Eclipse, which uses <a href=""http://download.oracle.com/javase/6/docs/api/java/util/Vector.html"" rel=""nofollow""><code>Vector&lt;E&gt;</code></a> instead of the <a href=""http://stackoverflow.com/q/1386275/435093"">preferred</a> <a href=""http://download.oracle.com/javase/6/docs/api/java/util/ArrayList.html"" rel=""nofollow""><code>ArrayList&lt;E&gt;</code></a>. I would like to replace those.</p>

<ul>
<li><p>Is there any way, using Eclipse, to change all these? Any refactoring method?</p></li>
<li><p>Or would it be sufficient to do a general search-and-replace for every <code>Vector&lt;String&gt;</code> occurrence? Are there any caveats to this? What are situations in which this approach would fail?</p></li>
</ul>

<p><sub>Actually, I just did the latter, and it worked for my application, but this should be a more general question.</sub></p>
","<java><vector><refactoring><arraylist>","2","139","2011-10-18 12:36:04"
"7808616","What to work on when network goes down?","<p>If you are working on a project highly reliant on the internet or internal network, what's the first thing you go for when the network/internet connection goes down? (and it is out of your control)</p>

<p>e.g.<br />
- Code refactoring?<br />
- Getting on with new code even if existing code can't be checked as working?<br />
- Sit and wait?</p>

<p>I'm trying to make an informed decision of what programming task to do...</p>
","<networking><refactoring>","-1","86","2011-10-18 14:11:08"
"7821291","Code reuse in iOS applications","<p>i am very new to ios development, rather i have just started work on my first app. Now my app has a home button on almost every page and behind that button the same code snippet is called to move to the home screen. This is a lot of duplicate code in every controller that has a home button. And it is just an example. There are many other scenarios like this and programmer still learning to code, i think its bad practice as any change will have to be made separately on every controller.</p>

<p>So my question, what are the best practices in scenarios like this  when coding for ios??</p>
","<iphone><ios><coding-style><refactoring><code-reuse>","2","193","2011-10-19 12:27:14"
"7819170","refactor a dal with hibernate,dao,services and unit of work : how to put all togheter","<p>i'm refactoring a jsf web application dal which uses hibernate and the dao pattern, at the moment each data acces class handles its own session and transaction into each method (a session per operation antipattern is it? )
for example :</p>

<pre><code>public void saveEntity(ModelEntity entity) throws Exception {
    String entityName = getCleanClassName(entity.getClass());
    Session session = null;
    Transaction tx = null;
    try {
        session = SessionFactoryUtil.getInstance().openSession();
        tx = session.beginTransaction();
        session.saveOrUpdate(entity);
        session.flush();
        tx.commit();
    } catch (Exception ex) {
        tx.rollback();
                    ...
        throw new Exception(msg, ex);
    } finally {
        session.close();
    }
}
</code></pre>

<p>Above classes can be used directly into backing bean actions or through some business logic classes methods (for example create new detached object, set some values and store them trhough DAO objects). Now i've found that some businness logic classes methods need to be executed atomically, for example :</p>

<pre><code>                       //inside some backing bean actionlistener
        DocumentoManager dm = new DocumentoManager();
        PraticaManager pm = new PraticaManager();
        Documento newDoc = new Documento();
        newDoc.setDataArrivo(new java.util.Date                           newDoc.setNote(""..."");
        Allegato newAll = new Allegato();
        newAll.setTitolo(newDoc.getNote());
                       //businness logic methods that should be executed atomically
        dm.creaDocumentoDaAllegato(newDoc,newAll,
            event.getFile().getContents(),
            event.getFile().getFileName(),
            """");
        pm.collegaDocumento(pratica, newDoc);
</code></pre>

<p>Finally i've a sessionFactoryUtil class which manages hibernate session (getcurrentSession, openSession, etc ... ).</p>

<p>How can i refactor the above architecture? i was thinking to do the following:</p>

<ol>
<li>remove the transaction from the DAO objects : i can't put
transactions management into bl classes (xxxManager) , so should i
use a class that just create,commit or rollback the transaction ,
encapsulating the sessionFactoryUtil, and to be used inside backing
beans (say jta userTransaction) ? </li>
<li>If someone try to use directly the DAO object how do i set the session ? Accessing sessionFactoryUtil into DAOs methods ?</li>
<li>Is it safe to call getCurrentSession inside DAOs?</li>
<li>if i create a class to handle businness logic transactions, how can i be sure it's thread safe ?</li>
</ol>

<p>I think sessionFactoryUtil is thread safe since it's been written following the pattern suggested on hibernate guide :</p>

<pre><code>private SessionFactoryUtil() {
}

static {
    // Annotation and XML
    // sessionFactory = new
    // AnnotationConfiguration().configure().buildSessionFactory();
    // XML only
    try {
        sessionFactory = new Configuration().configure().buildSessionFactory();
    } catch (Exception e) {
                  ...
    }

}

public static SessionFactory getInstance() {
    try{
        return sessionFactory;
    } catch (Exception ex)
    {
        return null;
    }
}
</code></pre>
","<java><hibernate><design-patterns><refactoring>","0","111","2011-10-19 09:27:25"
"7820904","Refactor a foreach with if - else if structure to LINQ","<p>I have this foreach loop:</p>

<pre><code>var includedElements = new HashSet&lt;int&gt;();
foreach(var e in elements)
{
    var include = false;
    if(isTable(e.Key))
    {
        if(tables.ContainsKey(e.Key)
        {
            if(tables[e.Key].Elements
               .Any(subElem =&gt; shouldBeIncluded(subElem.Key) ) )
            {
                include = true;
            }
        }
    }
    else if(shouldBeIncluded(e.Key))
    {
        include = true;
    }
    if(include){
        includedElements.Add(e.Key);
        DoSomeMoreStuff(e);
    }
}
</code></pre>

<p>I have tried to refactor this to LINQ:</p>

<pre><code>var query = 
    from e in elements
    where 
    ( 
        isTable(e.Key)
        &amp;&amp; tables.ContainsKey(e.Key)
        &amp;&amp; tables[e.Key].Elements
                .Any(subElem =&gt; shouldBeIncluded(subElem.Key) )
    ) || (
        !isTable(e.Key)
        &amp;&amp; shouldBeIncluded(e.Key)
    )
    select e;
foreach(e in query){
    includedElements.Add(e.Key);
    DoSomeMoreStuff(e);
}
</code></pre>

<p>What I'm not sure of is the <strong>or</strong> clause here. In my head I need to include <code>!isTable(e.Key)</code> to handle the outer <code>if</code>/<code>else if</code> structure.<br>
Am I thinking right with my refactoring? Are these two code examples resulting in the same logical functionality?</p>

<p>Is it a way I can get away with only one call to <code>isTable</code>? As I have it now I need to call it inverted on the other side of the <code>||</code>.</p>
","<c#><linq><refactoring>","0","157","2011-10-19 11:56:07"
"7821605","Is there a ReSharper-like code reformat and cleanup tool for Scala?","<p>I'd like to automatically clean-up and reformat a Scala code file the way I can do with ReSharper in Visual Studio for C#. Can I do this with IntelliJ Idea or another tool?</p>
","<scala><refactoring><intellij-idea><resharper><automated-refactoring>","4","159","2011-10-19 12:52:53"
"7822707","code in the middle is different, everything else the same","<p>I often have a situation where I need to do:</p>

<pre><code>function a1() {
 a = getA;
 b = getB;
 b.doStuff();
 ....  // do some things
 b.send()
 return a - b;
}

function a2() {
 a = getA;
 b = getB;
 b.doStuff();
 ....  // do some things, but different to above
 b.send()
 return a - b;
}
</code></pre>

<p>I feel like I am repeating myself, yet where I have <code>....</code>, the methods are different, have different signatures, etc.. </p>

<p>What do people normally do? Add an if (this type) do this stuff, else do the other stuff that is different? It doesn't seem like a very good solution either.</p>
","<oop><design-patterns><inheritance><refactoring><polymorphism>","0","65","2011-10-19 14:18:47"
"7833607","Get Connection String Without Password Value in C#","<p>I try create method for get the connection string value but without value for password, or show password like * character. I need used it in logging.</p>

<p>I use ConnectionStringBuilder for Oracle, SqlServer.</p>

<p>Anyway, another way -better- to implement it ? Maybe more generic . And what it happens it ProviderName is empty...</p>

<pre><code>public static string GetConnectionStringWithouPassword(this ConnectionStringSettings cs)
{
    if (cs == null || string.IsNullOrEmpty(cs.ConnectionString)) return null;

    if (cs.ProviderName.ToLower().Equals(""Oracle.DataAccess.Client"".ToLower()))
    {
        var builderOra = new Oracle.DataAccess.Client.OracleConnectionStringBuilder(cs.ConnectionString);
        return """";
    }

    if (cs.ProviderName.ToLower().Equals(""System.Data.SqlClient"".ToLower()))
    {
        var builderSql = new SqlConnectionStringBuilder(cs.ConnectionString);
        return """";
    }

    return null;
}

//
public static string ObtenerCadenasConexion()
{
    var sb = new StringBuilder();
    ConnectionStringSettingsCollection settings = ConfigurationManager.ConnectionStrings;

    if (settings != null)
    {
        foreach (ConnectionStringSettings cs in settings)
        {
            sb.AppendLine(""Name: "" + cs.Name);
            sb.AppendLine(""ProviderName: "" + cs.ProviderName);
            sb.AppendLine(""ConnectionString: "" + cs.GetConnectionStringWithouPassword() + Environment.NewLine);
        }
    }

    return sb.ToString();
}
</code></pre>
","<c#><ado.net><refactoring><database-connection><connection-string>","0","328","2011-10-20 09:12:05"
"7841051","Factoring the Ruby Way","<p>I have Rails site where I've rolled my own authentication with a <code>User</code> class, but to address the need for different roles I have separate <code>Customer</code>, <code>CustomerServiceRep</code>, and <code>Repairman</code> classes.  The <code>User</code> table has a user_type column that indicates what type of user it is.</p>

<p>My question is how to take advantage of Ruby to most efficiently code different views that correspond to the user.  For instance, after logging in, I will direct each user to a different place based on their user_type.</p>

<p>I could do it this way in my SessionsController create action, but I'm pretty sure it's the ""wrong"" way:</p>

<pre><code>if user.user_type == 'customer'         
  redirect_back_or root_path
elsif user.user_type == 'repairman'
  redirect_to repairman_panel_path, :flash =&gt; { :success =&gt; ""Welcome Back Mr. #{user.repairman.last_name}"" }
elsif user.user_type == 'customer_service_rep'
  redirect_to customer_service_panel_path, :flash =&gt; { :success =&gt; ""Welcome Back #{user.customer_service_rep.first_name}"" }
end
</code></pre>

<p>Is my intuition right that there's a much better way to use symbols or some such thing to avoid listing out if-else structures every time I want to funnel every user through the same system then back out to their appropriate areas?</p>
","<ruby-on-rails><ruby><refactoring>","1","100","2011-10-20 19:17:21"
"7849877","What is the best way to refactor code with many if and duplicated logic for extracting a value from different Controls classes","<p>I have the following code in the WPF application</p>

<pre><code>if (panel != null)
{
     IList listOfValues = new ComparableListOfObjects();
        var childControls = panel.GetChildren&lt;Control&gt;(x =&gt; x.Visibility == Visibility.Visible);
 foreach (Control childControl in childControls)
 {
    var textBox = childControl as TextBox;
    if (textBox != null)
    {
        listOfValues.Add(textBox.Text);
        continue;
    }

    var comboBox = childControl as ComboBox;
    if (comboBox != null)
    {
        listOfValues.Add(comboBox.SelectedItem);
        continue;
    }

    var datePicker = childControl as DatePicker;
    if (datePicker != null)
    {
        listOfValues.Add(datePicker.SelectedDate.GetValueOrDefault());
        continue;
    }
    var numericBox = childControl as NumericUpDown;
    if (numericBox != null)
    {
        listOfValues.Add(numericBox.Value);
        continue;
    }

}
</code></pre>

<p>What is the best approach to refactor this code with repetition the same logic for extract value from different controls like?</p>

<pre><code>        var numericBox = childControl as NumericUpDown;
    if (numericBox != null)
    {
        listOfValues.Add(numericBox.Value);
        continue;
    }
</code></pre>

<p>In the same class in other method there is the same code</p>

<pre><code>        private static object GetControlValue(Control control)
    {
        if (control == null)
            throw new ArgumentNullException(""control"");

        var textBox = control as TextBox;
        if (textBox != null)
            return textBox.Text;

        var comboBox = control as ComboBox;
        if (comboBox != null)
            return comboBox.SelectedValue;

        var datePicker = control as DatePicker;
        if (datePicker != null)
            return datePicker.SelectedDate.GetValueOrDefault();

        var numericUpDown = control as NumericUpDown;
        if (numericUpDown != null)
            return numericUpDown.Value;

        throw new NotSupportedException();
    }
</code></pre>

<p>May by I should use the strategy design pattern but in this case I need to create additional classes for each type of control? </p>

<p>Could you suggest me better solotion for this prolem?
Thanks in advance.</p>
","<c#><design-patterns><refactoring>","3","165","2011-10-21 13:12:25"
"7856322","Visual Studio refactor-rename causes inexplicable global replace of attributes in XAML file","<p>I feel like I must be going crazy, but I just changed the name of a property in a view model (a C# file) from <code>Width</code> to <code>Size</code> using Visual Studio's refactor-rename feature. When I was done, this error appeared in the Error window:</p>

<blockquote>
  <p>Error 2: The property 'Size' does not exist in XML namespace 'http://schemas.microsoft.com/winfx/2006/xaml/presentation'.</p>
</blockquote>

<p>The error was referring to a XAML <code>UserControl</code> file. When I checked the file to see what was up, I realized that every attribute named <code>Width</code> had been changed to <code>Size</code>.</p>

<p>Example:</p>

<pre><code>&lt;UserControl x:Class=""ApbSymbolGenerator.Views.Symbol""
             xmlns=""http://schemas.microsoft.com/winfx/2006/xaml/presentation""
             xmlns:x=""http://schemas.microsoft.com/winfx/2006/xaml""
             xmlns:mc=""http://schemas.openxmlformats.org/markup-compatibility/2006""
             xmlns:d=""http://schemas.microsoft.com/expression/blend/2008""
             mc:Ignorable=""d""
             Size=""{Binding Size}""
             Height=""{Binding Size}""&gt;
</code></pre>

<p>This is the first time I've ever had refactor-rename cause a change to a XAML file (besides the <code>x:class</code> value). (Note: I did <em>not</em> do a global find/replace, I did refactor-rename. I undid everything and performed the rename again, and it did the same thing.)</p>

<p>Strangely, it only affected one of several XAML files in my app that has a <code>Width</code> property.</p>

<p>Any explanation what could be going on here?</p>
","<c#><wpf><visual-studio><xaml><refactoring>","6","134","2011-10-21 23:23:05"
"7863310","Need help refactoring a Global Variable in PHP","<p>I have a recipe script with some PHP code that was written with Global Variables.  Would anyone be able to tell me a general process (or order of operations so-to-speak) that I could follow to begin swapping out the global variables?  Here's an example:</p>

<pre><code>function computeCost() {
  global $DB_LINK;
    $this-&gt;loadIngred();

  if ($this-&gt;liquid == $DB_LINK-&gt;true) $liquid = true;
    $amount = Units::convertTo($this-&gt;amount, $this-&gt;unitMapping, $this-&gt;unit, 
    $this-&gt;liquid);
      return ($this-&gt;amount * $this-&gt;cost);
}
</code></pre>
","<php><variables><refactoring><global>","2","68","2011-10-22 23:30:41"
"7873252","What is a possible Eclipse supported refactoring for removing superclass dependency?","<p>I want to remove the intermediate dependency of class B by moving the code from B to C and inherit directly from A.</p>

<pre><code>generic class A
  |
  ---modified generic class B
       |
       ---current class C
</code></pre>

<p>Is there any refactoring from Eclipse to support this?</p>
","<eclipse><inheritance><refactoring>","4","67","2011-10-24 08:59:27"
"7887179","How can I shorten a BasedOn style","<p>I'm currently making a ""base style"" for our application. I started by making a ""base style"" for our buttons, which will be a nice double-gradient (I created a template with 2 rows, and both rows have a two-point gradient).</p>

<p>So, the base button works fine, now I want to create other buttons based on that style.</p>

<p>This is the code for the base button:</p>

<pre><code>&lt;Style x:Key=""BaseButtonStyle"" TargetType=""{x:Type Button}""&gt;
    &lt;Setter Property=""Height"" Value=""24""/&gt;
    &lt;Setter Property=""Width"" Value=""150"" /&gt;
    &lt;Setter Property=""Foreground"" Value=""{DynamicResource OffWhiteBrush}""/&gt;
    &lt;Setter Property=""HorizontalContentAlignment"" Value=""Center""/&gt;
    &lt;Setter Property=""VerticalContentAlignment"" Value=""Center""/&gt;
    &lt;Setter Property=""Template""&gt;
        &lt;Setter.Value&gt;
            &lt;ControlTemplate TargetType=""{x:Type Button}""&gt;
                &lt;Border x:Name=""OuterBorder"" BorderBrush=""{DynamicResource GrayBorderBrush}"" BorderThickness=""2"" CornerRadius=""5""&gt;
                    &lt;Grid x:Name=""LayoutGrid""&gt;
                        &lt;Grid.RowDefinitions&gt;
                            &lt;RowDefinition Height=""*""/&gt;
                            &lt;RowDefinition Height=""*""/&gt;
                        &lt;/Grid.RowDefinitions&gt;
                        &lt;Border x:Name=""TopBorder"" BorderBrush=""{x:Null}"" BorderThickness=""0"" CornerRadius=""4,4,0,0"" Background=""{DynamicResource TopGrayGradientBrush}""/&gt;
                        &lt;Border x:Name=""BottomBorder"" BorderBrush=""{x:Null}"" BorderThickness=""0"" Grid.Row=""1"" CornerRadius=""0,0,4,4"" Background=""{DynamicResource BottomGrayGradientBrush}""/&gt;
                        &lt;ContentPresenter x:Name=""contentPresenter"" Grid.RowSpan=""2"" HorizontalAlignment=""Center"" /&gt;
                    &lt;/Grid&gt;
                &lt;/Border&gt;
                &lt;ControlTemplate.Triggers&gt;
                    &lt;Trigger Property=""IsEnabled"" Value=""False""&gt;
                        &lt;Setter Property=""Control.Foreground"" TargetName=""contentPresenter"" Value=""{DynamicResource DisabledBrush}""/&gt;
                    &lt;/Trigger&gt;
                    &lt;Trigger Property=""IsPressed"" Value=""True""&gt;
                        &lt;Setter Property=""Margin"" TargetName=""OuterBorder"" Value=""1""/&gt;
                        &lt;Setter Property=""Background"" TargetName=""TopBorder"" Value=""{DynamicResource TopGrayGradientBrush}""/&gt;
                        &lt;Setter Property=""Background"" TargetName=""BottomBorder"" Value=""{DynamicResource BottomGrayGradientBrush}""/&gt;
                    &lt;/Trigger&gt;
                    &lt;Trigger Property=""IsMouseOver"" Value=""True""&gt;
                        &lt;Setter Property=""Background"" TargetName=""TopBorder"" Value=""{DynamicResource TopBlueGradientBrush}""/&gt;
                        &lt;Setter Property=""Background"" TargetName=""BottomBorder"" Value=""{DynamicResource BottomBlueGradientBrush}""/&gt;
                    &lt;/Trigger&gt;
                &lt;/ControlTemplate.Triggers&gt;
            &lt;/ControlTemplate&gt;
        &lt;/Setter.Value&gt;
    &lt;/Setter&gt;
&lt;/Style&gt;
</code></pre>

<p>When I create a second button I can do it ""BasedOn"" the other style:</p>

<pre><code>&lt;Style x:Key=""RedButtonStyle"" TargetType=""{x:Type Button}"" BasedOn=""{StaticResource BaseButtonStyle}""&gt;
 ...
</code></pre>

<p>Inside the grid I've named my gradients: topborder and bottomborder. The problem is that I need to duplicate the code in order to be able to set any code, because the redbuttonStyle doesn't ""know"" topborder or bottomborder:</p>

<pre><code>&lt;Style x:Key=""RedButtonStyle"" TargetType=""{x:Type Button}"" BasedOn=""{StaticResource BaseButtonStyle}""&gt;
    &lt;Setter Property=""Template""&gt;
        &lt;Setter.Value&gt;
            &lt;ControlTemplate TargetType=""{x:Type Button}""&gt;
                &lt;Border x:Name=""OuterBorder"" BorderBrush=""{DynamicResource GrayBorderBrush}"" BorderThickness=""2"" CornerRadius=""5""&gt;
                    &lt;Grid x:Name=""LayoutGrid""&gt;
                        &lt;Grid.RowDefinitions&gt;
                            &lt;RowDefinition Height=""*""/&gt;
                            &lt;RowDefinition Height=""*""/&gt;
                        &lt;/Grid.RowDefinitions&gt;
                        &lt;Border x:Name=""TopBorder"" BorderBrush=""{x:Null}"" BorderThickness=""0"" CornerRadius=""4,4,0,0"" Background=""{DynamicResource TopGrayGradientBrush}""/&gt;
                        &lt;Border x:Name=""BottomBorder"" BorderBrush=""{x:Null}"" BorderThickness=""0"" Grid.Row=""1"" CornerRadius=""0,0,4,4"" Background=""{DynamicResource BottomGrayGradientBrush}""/&gt;
                        &lt;ContentPresenter x:Name=""contentPresenter"" Grid.RowSpan=""2"" HorizontalAlignment=""Center"" /&gt;
                    &lt;/Grid&gt;
                &lt;/Border&gt;
                &lt;ControlTemplate.Triggers&gt;
                    &lt;Trigger Property=""IsEnabled"" Value=""False""&gt;
                        &lt;Setter Property=""Control.Foreground"" TargetName=""contentPresenter"" Value=""{DynamicResource DisabledBrush}""/&gt;
                    &lt;/Trigger&gt;
                    &lt;Trigger Property=""IsPressed"" Value=""True""&gt;
                        &lt;Setter Property=""Margin"" TargetName=""OuterBorder"" Value=""1""/&gt;
                        &lt;Setter Property=""Background"" TargetName=""TopBorder"" Value=""{DynamicResource TopGrayGradientBrush}""/&gt;
                        &lt;Setter Property=""Background"" TargetName=""BottomBorder"" Value=""{DynamicResource BottomGrayGradientBrush}""/&gt;
                    &lt;/Trigger&gt;
                    &lt;Trigger Property=""IsMouseOver"" Value=""True""&gt;
                        &lt;Setter Property=""Background"" TargetName=""TopBorder"" Value=""{DynamicResource TopRedGradientBrush}""/&gt;
                        &lt;Setter Property=""Background"" TargetName=""BottomBorder"" Value=""{DynamicResource BottomRedGradientBrush}""/&gt;
                    &lt;/Trigger&gt;
                &lt;/ControlTemplate.Triggers&gt;
            &lt;/ControlTemplate&gt;
        &lt;/Setter.Value&gt;
    &lt;/Setter&gt;
&lt;/Style&gt;
</code></pre>

<p>The problem here is that I've pretty much repeated the entire style, whilst I only want to change the two gradients on the IsMouseOver event</p>

<p>How should I handle this?</p>

<p>PS. I've looked at this <a href=""http://stackoverflow.com/questions/1282492/wpf-override-style-colors-best-practice"">WPF -- override style colors, best practice</a>, but I can't figure out the TemplateBinding :/</p>

<p>Thanks for any help.</p>
","<c#><wpf><refactoring><styles>","2","70","2011-10-25 09:22:17"
"7902970","migrating computation to the cloud","<p>Is there any automatic tool that I can transform legacy uniprocessor programs to the cloud, meaning that the target program is ready to execute in the cloud (e.g. programs written for Hadoop)? If not, what are the best practices when doing such transformations (maybe total rewrite) manually? Also, how can I know/evaluate whether a legacy program (or programming task) is suitable for computing?</p>

<p>Example: suppose I have a WordCount program written solely with standard Java library (e.g. HashMap), how can I transform it to one written with Hadoop like the one provided in the sample code of the Hadoop distribution?</p>
","<java><refactoring><hadoop><cloud><mapreduce>","1","97","2011-10-26 13:03:06"
"7909925","Clojure: How do I factor proxy method code out of a long proxy statement?","<p>I have a Clojure <code>proxy</code> statement that was getting large and messy, so I decided to try factoring the code of the <code>beginDrag</code> method redefinition out of the <code>proxy</code> statement, like this:</p>

<pre><code>(defn enhanced-start-drag
  """"
  [pie]
  (let [pobj   (. pie getPickedNode)
    pobj-coll (seq (.. pie getInputManager
               getKeyboardFocus getSelection))]
    (println pobj)
    (println pobj-coll)
    (println ""----------"")
    (proxy-super startDrag pie)))  ; THIS IS LINE 94 (SEE ERROR MSG)



(defn custom-selection-event-handler [marqueeParent selectableParent]
  (proxy [PSelectionEventHandler]  [marqueeParent selectableParent]
    (decorateSelectedNode [node]
              (let [stroke-color (Color/red)]
                (.setStrokePaint node stroke-color)))
    (undecorateSelectedNode [node]
                (let [stroke-color (Color/black)]
                  (.setStrokePaint node stroke-color)))
    (startDrag [pie]    ; pie is a PInputEvent
           (enhanced-start-drag pie))
    (endStandardSelection [pie]     ; pie is a PInputEvent
              (let [pobj   (.getPickedNode pie)
                slip   (. pobj getAttribute ""slip"")
                ]
                (swap! *last-slip-clicked*
                   (fn [x] slip))))))
</code></pre>

<p>I get the following compile error:</p>

<pre><code>cd /Users/gw/tech/clojurestuff/cljprojects/infwb/src/infwb/
1 compiler notes:

Unknown location:
  error: java.lang.Exception: Unable to resolve symbol: this in this context

core.clj:94:5:
  error: java.lang.Exception: Unable to resolve symbol: this in this context 
    (core.clj:94)

Compilation failed.
</code></pre>

<p>As soon as I restore the body of <code>enhanced-start-drag</code> into the body of the <code>proxy</code> statement, everything works.</p>

<p><strong>My question:</strong> Is there a way to move the messy details out to a separate function to improve the readability of my code?</p>

<p>Thanks for all your ideas and solutions.</p>

<hr>

<p><strong>UPDATE, 10/27/11:</strong> See the comments below. Arthur Ulfeldt was sharp in pointing out that the issue is captured references, and Dave Ray is also correct in saying that all you have to do is add <code>this</code> as a parameter to <code>enhanced-start-drag</code> and then <code>proxy-super</code> will work correctly.  When I made the following two changes (without any changes to the <em>body</em> of <code>enhanced-start-drag</code>), my code was working again:</p>

<pre><code>  (defn enhanced-start-drag
    """"
    [pie this]
</code></pre>

<p>and</p>

<pre><code>  (startDrag [pie]  ; IN THE PROXY STMT IN custom-selection-event-handler
   (enhanced-start-drag pie this))
</code></pre>

<p>BTW, my project uses Dave Ray's <code>seesaw</code> project to get a Java Swing UI. <code>seesaw</code> is awesome, as are its docstrings and sample code (which are much better than most commercial software). I highly recommend it! And thank you, Dave!</p>
","<proxy><clojure><refactoring><source-code>","3","74","2011-10-26 23:01:53"
"7910788","Refactoring and Testing","<p>An example of scenario I'm trying to unit test somehow:</p>

<p>A method gets three parameters: <code>Company name</code>, <code>Plane Number 1</code>, <code>Plane Number 2</code></p>

<pre><code>public Double getDistanceBetweenPlanes(Sting company, String plane1, String plane2)
{
  -Apply some validation logic to see that plane numbers and company realy exists
  -Use complex geLocation and setelate data to get plane location

  return plane1.geoLocation() - plane2.geoLocation() ;
}
</code></pre>

<p>Now, I want to unit test this.</p>

<p>I do not have real plane numbers, I do not have live connection to the satellite.</p>

<p>Still I would like to be able to mock the whole thing somehow so that I can test this API.
Any suggestion on how to refactor it? Any new public method to be created just for testing?</p>
","<java><unit-testing><junit><refactoring><mockito>","0","86","2011-10-27 01:30:06"
"7926086","IF Statements: What's more efficient? Many small ones, or a couple large ones?","<p>I have form for my recipe app that inserts ingredients into a db.  If nothing has been submitted yet, nutritional values display '0'.  Otherwise they update to the post values.</p>

<p>My structure for the nutritional display is:</p>

<pre><code>Calories:
  &lt;?php if ($ingredientArray[calorieKey] &gt;= 1)
  echo $ingredientArray[calorieKey];
    else echo 0; ?&gt;&lt;br /&gt;
Protein:
  &lt;?php if ($ingredientsArray[proteinKey] &gt;= 1)
  echo $ingredientArray[proteinKey];
    else echo 0; ?&gt;&lt;br /&gt;
</code></pre>

<p>...and continues for about 20 items.  The question is:</p>

<p>would it be more efficient to refactor the code using just 1 if/else statement to display 2 different forms (dynamic and static), or is it better as is?</p>
","<php><mysql><refactoring><premature-optimization><php-form-processing>","1","90","2011-10-28 06:58:58"
"7926974","Refactor multiple StringBuilder.Append statements","<p>Today i saw this bad code structure and since then i started to think its really awkward and horrible to look at this method having this code. The code goes like this:</p>

<pre><code>StringBuilder body = new StringBuilder();       

            #region General
            body.Append(""General information:"");
            body.Append('*');
            body.Append('*');
            body.Append(""Exception:         "");
            body.Append(m_ExceptionInfo.Exception.GetType().ToString());
            body.Append('*');
            body.Append(""Message:           "");
            body.Append(m_ExceptionInfo.Exception.Message);
            body.Append('*');
            body.Append(""Method:            "");
            body.Append(m_ExceptionInfo.GetMethodName(m_ExceptionInfo.Exception));
            body.Append('*');
            body.Append(""Class:             "");
            body.Append(m_ExceptionInfo.GetClassName(m_ExceptionInfo.Exception));
            body.Append('*');
            body.Append(""Assembly:          "");
            body.Append(m_ExceptionInfo.AssemblyName);
            body.Append('*');
            body.Append(""App-Domain:        "");
            body.Append(m_ExceptionInfo.AppDomainName);
            body.Append('*');
            body.Append(""Source-File:       "");
            body.Append(m_ExceptionInfo.GetFileName(m_ExceptionInfo.Exception));
            body.Append('*');
            body.Append(""Line/Row:          "");
            body.Append(
                m_ExceptionInfo.GetFileLineNumber(m_ExceptionInfo.Exception).ToString(currentNumberFormatInfoProvider));
</code></pre>

<p>This we are doing to customize the displayed error message box information in the UI. So for that we are preparing a string having such many information. But to me its feels bad to look at this code and not have any idea how to refactor it. </p>

<p>Any help is appreciated! Thanks</p>
","<c#><.net><refactoring>","2","106","2011-10-28 08:42:28"
"7927411","Classic ASP Pages Returned Within MVC3","<p>Is it possible to directly return a Classic ASP web page as an Action Result etc? I have just inherited a stack of Classic ASP applications that are still being maintained and even extended. </p>

<p>I am looking to stop writing new Classic ASP code move to an MVC based setup (as that is the direction the department is going). Therefore I am looking for any options that don't require me to rewrite all the applications but allow me to slowly add features written in ASP.Net. </p>

<p>Ideally I would like to organise features around controllers etc and then return existing ASP pages as the result of Actions. I'd like the URL structure to look the same as a normal MVC site.</p>

<p>Any thoughts or advice? I know there are other posts on this. Haven't seen any that are trying to return ASP pages via Action Result etc. </p>

<p>Thanks</p>

<p>Graeme</p>
","<asp.net-mvc><asp.net-mvc-3><asp-classic><refactoring>","0","145","2011-10-28 09:25:36"
"7927413","Is there a way to replace class by another one in Intellij Idea?","<p>Guys, here is my problem: I have some class which is used in many places in my project. And I must replace this class with another from jar provided. Is there any ways to refactor this? I suppose this is a simple problem, but I dont know how to solve it.</p>

<p>Its not about replacing source code - what I want is to replace all class usages by class from my library and be able to completely remove my own class. Imagine I have created my own StringUtils and  have found out that there is a apache.common StringUtils library, and now I want to use it everywhere in my code. And the signatures of class methods are not a problem: they coincide.</p>

<p>?</p>
","<java><refactoring><intellij-idea>","0","43","2011-10-28 09:25:41"
"7927994","Is it always safe to replace a built-in array with a std/tr1/boost::array?","<p><code>boost::array</code> (or the <code>tr1</code>or <code>std</code> version) offer some nice additional features over a built-in array.</p>

<p>Up to now, our codebase only contains built-in arrays, <em>for example</em> (made up, but the style matches):</p>

<pre><code>WORD m_lastReadFlags[FLAGS_MAX];
...
WORD flagBuffer[FLAGS_MAX];
if (getFlags(flagBuffer)) {
  memcpy(m_lastReadFlags, flagBuffer, sizeof(m_lastReadFlags));
  ...
</code></pre>

<p>I think one'll get the idea.</p>

<p>Now, my question is, for those places in the code, where dropping in <code>boost::array</code> would make sense (because of other changes made), is <code>array</code> a 100% semantics preserving drop-in for the built in array? (Possible compiler errors are OK -- only silent behavioral changes are what's bothering me.) </p>

<p>That is, <em>could</em> above code be re-written (for example) to use:</p>

<pre><code>boost::array&lt;WORD, FLAGS_MAX&gt; m_lastReadFlags;
</code></pre>

<p>and the memcpy (possibly adapted to use <code>c_array()</code>or <code>data()</code>) and other array-like access would remain the same? <sub>Yes, of course I could also replace the local buffer by an array and remove the <code>memcpy</code> or use <code>std::copy</code> or something like that, but the point of this question is about the compatibility of built-in arrays and the array class.</sub></p>

<hr>

<p>Update: One thing that's bothering me specifically is the places (like in the <code>memcpy</code> case) where the built-in arrays are used as pointers. Will all occurences be caught by the 
compiler / handled correctly?</p>

<p>What about assignment?</p>

<pre><code>T arr1[N]; // or array&lt;T, N&gt;
T arr2[N]; // or array&lt;T, N&gt;
T* p1;
...
// Note, not all combinations will compile:
arr1 = arr2;
p1 = arr1;
arr2 = p1;
...
</code></pre>
","<c++><arrays><visual-c++><boost><refactoring>","5","89","2011-10-28 10:20:19"
"7929200","Remove duplication from this snippet of code","<p>Looking for advice in removing duplication from this snippet:</p>

<pre><code>foreach (Car car in carList) {
    DataRow row = NewRow();

    StringBuilder sbConfigurations = new StringBuilder();    
    foreach (ConfigurationItem configurationItem in car.Configurations)
        sbConfigurations.AppendFormat(""{0}: {1}\n"", configurationItem.Name, configurationItem.Value);

    row[""configurations""] = sbConfigurations;


    StringBuilder sbOptionals = new StringBuilder();
    foreach (OptionalItem optionalItem in car.Optionals) 
        sbOptionals.AppendFormat(""{0}, "", optionalItem.Name);

    row[""optionals""] = sbOptionals;

    Rows.Add(row);
}
</code></pre>

<p>EDIT: This is a simplified context, there could be more list-joins like these</p>
","<c#><coding-style><refactoring><duplicates>","2","128","2011-10-28 12:24:11"
"7931128","Properly instantiating a class assigned to a private static volatile variable using reflection and locking","<p>So here's a contrived example of what I want to have improved or confirmed.</p>

<p>I'm using (my/i)BATIS.NET (a light-weight ORM/data mapper framework), and what I've got is a class with a static reference to each of the table mappers for a database. It works great, but there's so much repetition that I thought there might be an opportunity to greatly simplify the code. The class currently looks like so:</p>

<pre><code>public sealed class MyRepository
{
    private static string _connectionString;

    private volatile static TableAbcMapper _tableAbcMapper;
    private volatile static TableXyzMapper _tableXyzMapper;
    // and about 30 more of these

    private MyRepository()
    {
    }

    public static void Init(string connectionString)
    {
        _connectionString = connectionString;
    }

    public static string ConnectionString
    {
        get { return _connectionString; }
    }

    public static TableAbcMapper TableAbc
    {
        get
        {
            if (_tableAbcMapper == null)
            {
                lock (typeof(TableAbcMapper))
                {
                    if (_tableAbcMapper == null)
                    {
                        _tableAbcMapper = new TableAbcMapper(_connectionString);
                    }
                }
            }
            return _tableAbcMapper;
        }
    }

    public static TableXyzMapper TableXyz
    {
        get
        {
            if (_tableXyzMapper == null)
            {
                lock (typeof(TableXyzMapper))
                {
                    if (_tableXyzMapper == null)
                    {
                        _tableXyzMapper = new TableXyzMapper(_connectionString);
                    }
                }
            }
            return _tableXyzMapper;
        }
    }

    // and about 30 more of these readonly properties
}
</code></pre>

<p>Every time I add or remove a table to the database I get to add a <code>private volatile static</code> field and that big ugly singleton-y property to the <code>MyRepository</code> class. My first idea was to make the properties call a generic instancing function within the class; something that looks like:</p>

<pre><code>private static void InitMapper&lt;TMapper&gt;(TMapper instance) where TMapper : MyMapper
{
    lock (typeof(TMapper))
    {
        if (instance == null)
        {
            instance = Activator.CreateInstance(typeof(TMapper), 
                new object[] { _connectionString }) as TMapper;
        }
    }
}
</code></pre>

<p>Then the public getters could be slightly reduced to:</p>

<pre><code>public static TableXyzMapper TableXyz
{
    get
    {
        if (_tableXyzMapper == null)
        {
            InitMapper&lt;TableXyzMapper&gt;(_tableXyzMapper);
        }
        return _tableXyzMapper;
    }
}
</code></pre>

<p>But, I don't know if passing around volatile fields is such a great idea, and using <code>ref</code> or <code>out</code> with volatile fields is a no-no, and on top of all that it doesn't reduce the amount of code all that much. </p>

<p>What I'd like to do is completely refactor the <code>MyRepository</code> class so that it has no private fields and no public getters, and uses reflection to initialize all of the mappers right away instead of lazy-loading them. I wouldn't have to change any of the code that uses the <code>MyRepository</code> class as it would look exactly the same, but under-the-hood it would be a little different:</p>

<pre><code>public sealed class MyRepository
{
    private MyRepository()
    {
    }

    public volatile static TableAbcMapper TableAbc = null;
    public volatile static TableXyzMapper TableXyz = null;

    public static void Init(string connectionString)
    {
        foreach (var fieldInfo in typeof(MyRepository).GetFields(BindingFlags.Static))
        {
            if (fieldInfo.GetValue(new MyRepository()) == null)
            {
                lock (fieldInfo.FieldType)
                {
                    if (fieldInfo.GetValue(new MyRepository()) == null)
                    {
                        fieldInfo.SetValue(new MyRepository(), 
                            fieldInfo.FieldType.GetConstructor(new Type[] { typeof(string) })
                                .Invoke(new object[] { connectionString }));
                    }
                }
            }
        }
    }
}
</code></pre>

<p>Now the only maintenance I have to do when new tables are added to the database is to add a new <code>public volatile static</code> field for it, and the reflection would take care of the rest.</p>

<p><strong>A few questions I have with this approach:</strong></p>

<ul>
<li>Is this approach functionally equivalent to the original class?</li>
<li>Is there any danger in defining volatile variables using reflection?</li>
<li>Is it as readable as the original class (assuming it's all commented)?</li>
</ul>

<p>Lastly, if this is a question better suited for the <a href=""http://codereview.stackexchange.com"">Code Review</a> site, I'm all for having it migrated (mods!).</p>
","<c#><reflection><refactoring>","4","95","2011-10-28 15:07:54"
"7933755","Eliminate repetition in view","<p>Can I avoid having @thing twice in the following examples of view code? I need to check for <code>nil</code> but the view is getting very cluttered. </p>

<pre><code>if @thing
  @thing
end
</code></pre>

<p>or </p>

<pre><code>@thing unless @thing.nil?
</code></pre>
","<ruby-on-rails><refactoring>","1","46","2011-10-28 19:13:01"
"7922743","Find Max/Min Arbitrary Priority","<p>I'm trying to aggregate rows based on a max or min value, where max/min is determined by a business rule rather than by inherent value.  In other words, I need to create a custom max/min - without using the CLR.  I have a working self-contained example in the snippet below, but I feel there must be a simpler way.</p>

<p>In this particular case, I need the business priority of an IPA column to be defined by the [Seq] value shown in the [IPAMap] CTE below.  I then take an arbitrary set of rows from the [TestData] table/cte (having only four rows in this sample), and aggregate them into two rows that have the proper IPA values selected, based on priority.</p>

<pre><code>--Table [IPAMap] holds all possible values for [IPA], and reflects the relative
--'priority' of each with the [Seq] column.  This table is used as a lookup for
--business rules.
;WITH IPAMap (Seq, IPA) AS ( 
SELECT 1, 'Q' UNION ALL 
SELECT 2, 'S' UNION ALL 
SELECT 3, 'A' UNION ALL 
SELECT 4, 'L'
) 
--Table [TestData] represents the real data. 
, TestData (CustomerID, IPA) AS ( 
SELECT '123', 'A' UNION ALL 
SELECT '123', 'S' UNION ALL 
SELECT '234', 'L' UNION ALL 
SELECT '234', 'Q' 
) 
--Table [PartyIPASeq] finds the lowest Seq rank from [TestData] 
,PartyIPASeq (CustomerID, IPASeq) AS ( 
 SELECT  
   CustomerID,  
   MIN(IP.Seq) 
 FROM TestData [TD] 
  INNER JOIN IPAMap [IP] ON IP.IPA = TD.IPA 
  GROUP BY CustomerID 
) 
--The final selection provides the key and the 'IPA' with the lowest rank 
SELECT TD.CustomerID, TD.IPA 
FROM TestData [TD] 
 INNER JOIN IPAMap [IP] ON IP.IPA = TD.IPA 
 INNER JOIN PartyIPASeq [SEQ] ON SEQ.CustomerID = [TD].CustomerID 
   AND SEQ.IPASeq = IP.Seq 
</code></pre>

<p>The result of the above query is this:</p>

<pre><code>CustomerID  IPA
234         S
123         Q
</code></pre>

<p>This is correct, but I'm hoping someone can show me an easier way to get the same job done.</p>
","<tsql><query><refactoring>","0","59","2011-10-27 21:36:13"
"7923471","Sanity Check - Significant increase in the number of objects when using JUNIT","<p>I am using Junit for the first time in a project and I'm fascinated by the way it is forcing me to restructure my code.     One thing I've noticed is that the number of objects I've created in order to be able to test chunks of code is significantly increasing.    Is this typical?</p>

<p>Thanks,</p>

<p>Elliott</p>
","<java><junit><refactoring>","2","61","2011-10-27 23:07:43"
"7935022","Trying to shy away from a singleton/god/manager class. Not sure how I am supposed to sustain functionality, though","<p>I have a class which has been steadily growing over time. It's called <code>LayoutManager</code>. </p>

<p>It started as a way for me to keep track of which dynamically created controls were on my page. So, for instance, I have this:</p>

<pre><code>public CormantRadDockZone()
{
    ID = String.Format(""RadDockZone_{0}"", Guid.NewGuid().ToString().Replace('-', 'a'));
    MinHeight = Unit.Percentage(100);
    BorderWidth = 0;
    HighlightedCssClass = ""zoneDropOk"";
    CssClass = ""rightRoundedCorners"";
    LayoutManager.Instance.RegisteredDockZones.Add(this);
}
</code></pre>

<p>In this way, during the beginning stages of the Page Lifecycle, controls would be re-created and they would add themselves to their respective control's list. </p>

<p>A while later I found myself passing the 'Page' object between methods. This was for the sole purpose of being able to access controls found on Page. I thought to myself -- well, I already have a Layout Manager, I'll just treat the static controls in the same way.</p>

<p>As such, my Page_Init method now looks like this mess:</p>

<pre><code>protected void Page_Init(object sender, EventArgs e)
{
    SessionRepository.Instance.EnsureAuthorized();

    LayoutManager.Instance.RegisteredPanes.Clear();
    LayoutManager.Instance.RegisteredDocks.Clear();
    LayoutManager.Instance.RegisteredDockZones.Clear();
    LayoutManager.Instance.RegisteredSplitters.Clear();
    LayoutManager.Instance.RegisteredSplitBars.Clear();
    LayoutManager.Instance.RegisteredPageViews.Clear();

    LayoutManager.Instance.CheckBox1 = CheckBox1;
    LayoutManager.Instance.CheckBox4 = CheckBox4;

    LayoutManager.Instance.StartEditButton = StartEditButton;
    LayoutManager.Instance.FinishEditButton = FinishEditButton;

    LayoutManager.Instance.RadNumericTextBox1 = RadNumericTextBox1;
    LayoutManager.Instance.RadNumericTextBox2 = RadNumericTextBox2;

    LayoutManager.Instance.LeftPane = LeftPane;
    LayoutManager.Instance.DashboardUpdatePanel = DashboardUpdatePanel;

    LayoutManager.Instance.CustomReportsContainer = CustomReportsContainer;
    LayoutManager.Instance.HistoricalReportsContainer = HistoricalReportsContainer;
    RegenerationManager.Instance.RegenerateReportMenu();

    LayoutManager.Instance.MultiPage = DashboardMultiPage;
    LayoutManager.Instance.MultiPageUpdatePanel = MultiPageUpdatePanel;
    LayoutManager.Instance.TabStrip = DashboardTabStrip;

    RegenerationManager.Instance.RegenerateTabs(DashboardTabStrip);
    RegenerationManager.Instance.RegeneratePageViews();

    LayoutManager.Instance.Timer = RefreshAndCycleTimer;
    LayoutManager.Instance.Timer.TimerEvent += DashboardTabStrip.DoTimerCycleTick;

    RegenerationManager.Instance.RegeneratePageState();
}
</code></pre>

<p>I'm looking at that and saying no, no, no. That is all wrong. Yet, there are controls on my page which are very dependent on each other, but do not have access to each other. This is what seems to make this so necessary.</p>

<p>I think a good example of this in practice would be using UpdatePanels. So, for instance, <code>DashboardUpdatePanel</code> is being given to the LayoutManager. There are controls on the page which, conditionally, should cause the entire contents of the dashboard to update.</p>

<p>Now, in my eyes, I believe I have two options:</p>

<ol>
<li>Inside the object wanting to call UpdatePanel.Update(), I recurse up through parent objects, checking type and ID until I find the appropriate UpdatePanel.</li>
<li>I ask LayoutManager for the UpdatePanel.</li>
</ol>

<p>Clearly the second one sounds cleaner in this scenario... but I find myself using that same logic in many instances. This has resulted in a manager class which looks like this:</p>

<pre><code>public class LayoutManager
{
    private static readonly ILog _logger = LogManager.GetLogger(MethodBase.GetCurrentMethod().DeclaringType);

    private static readonly LayoutManager _instance = new LayoutManager();
    private LayoutManager() { }

    public static LayoutManager Instance
    {
        get { return _instance; }
    }

    private IList&lt;CormantRadDock&gt; _registeredDocks;
    private IList&lt;CormantRadDockZone&gt; _registeredDockZones;
    private IList&lt;CormantRadPane&gt; _registeredPanes;
    private IList&lt;CormantRadSplitter&gt; _registeredSplitters;
    private IList&lt;CormantRadSplitBar&gt; _registeredSplitBars; 
    private Dictionary&lt;string, StyledUpdatePanel&gt; _registeredUpdatePanels;
    private IList&lt;CormantRadPageView&gt; _registeredPageViews;

    public RadMultiPage MultiPage { get; set; }
    public CormantTimer Timer { get; set; }
    public CormantRadListBox HistoricalReportsContainer { get; set; }
    public CormantRadListBox CustomReportsContainer { get; set; }
    public StyledUpdatePanel MultiPageUpdatePanel { get; set; }
    public CormantRadTabStrip TabStrip { get; set; }
    public RadPane LeftPane { get; set; }
    public StyledUpdatePanel DashboardUpdatePanel { get; set; }
    public RadButton ToggleEditButton { get; set; }

    public CheckBox CheckBox1 { get; set; }
    public CheckBox CheckBox4 { get; set; }
    public RadNumericTextBox RadNumericTextBox1 { get; set; }
    public RadNumericTextBox RadNumericTextBox2 { get; set; }

    public RadButton StartEditButton { get; set; }
    public RadButton FinishEditButton { get; set; }

    public IList&lt;CormantRadDock&gt; RegisteredDocks
    {
        get
        {
            if (Equals(_registeredDocks, null))
            {
                _registeredDocks = new List&lt;CormantRadDock&gt;();
            }

            return _registeredDocks;
        }
    }

    public IList&lt;CormantRadDockZone&gt; RegisteredDockZones
    {
        get
        {
            if (Equals(_registeredDockZones, null))
            {
                _registeredDockZones = new List&lt;CormantRadDockZone&gt;();
            }

            return _registeredDockZones;
        }
    }

    public IList&lt;CormantRadPane&gt; RegisteredPanes
    {
        get
        {
            if (Equals(_registeredPanes, null))
            {
                _registeredPanes = new List&lt;CormantRadPane&gt;();
            }

            return _registeredPanes;
        }
    }

    public IList&lt;CormantRadSplitter&gt; RegisteredSplitters
    {
        get
        {
            if (Equals(_registeredSplitters, null))
            {
                _registeredSplitters = new List&lt;CormantRadSplitter&gt;();
            }

            return _registeredSplitters;
        }
    }

    public IList&lt;CormantRadSplitBar&gt; RegisteredSplitBars
    {
        get
        {
            if (Equals(_registeredSplitBars, null))
            {
                _registeredSplitBars = new List&lt;CormantRadSplitBar&gt;();
            }

            return _registeredSplitBars;
        }
    }

    public Dictionary&lt;string, StyledUpdatePanel&gt; RegisteredUpdatePanels
    {
        get
        {
            if( Equals( _registeredUpdatePanels, null))
            {
                _registeredUpdatePanels = new Dictionary&lt;string, StyledUpdatePanel&gt;();
            }

            return _registeredUpdatePanels;
        }
    }

    public IList&lt;CormantRadPageView&gt; RegisteredPageViews
    {
        get
        {
            if (Equals(_registeredPageViews, null))
            {
                _registeredPageViews = new List&lt;CormantRadPageView&gt;();
            }

            return _registeredPageViews;
        }
    }

    public StyledUpdatePanel GetBaseUpdatePanel()
    {
        string key = MultiPage.PageViews.Cast&lt;CormantRadPageView&gt;().Where(pageView =&gt; pageView.Selected).First().ID;
        return RegisteredUpdatePanels[key];
    }

    public CormantRadDockZone GetDockZoneByID(string dockZoneID)
    {
        CormantRadDockZone dockZone = RegisteredDockZones.Where(registeredZone =&gt; dockZoneID.Contains(registeredZone.ID)).FirstOrDefault();

        if (Equals(dockZone, null))
        {
            _logger.ErrorFormat(""Did not find dockZone: {0}"", dockZoneID);
        }
        else
        {
            _logger.DebugFormat(""Found dockZone: {0}"", dockZoneID);
        }

        return dockZone;
    }

    public CormantRadPane GetPaneByID(string paneID)
    {
        CormantRadPane pane = RegisteredPanes.Where(registeredZone =&gt; paneID.Contains(registeredZone.ID)).FirstOrDefault();

        if (Equals(pane, null))
        {
            _logger.ErrorFormat(""Did not find pane: {0}"", paneID);
        }
        else
        {
            _logger.DebugFormat(""Found pane: {0}"", paneID);
        }

        return pane;
    }

    public CormantRadDock GetDockByID(string dockID)
    {
        CormantRadDock dock = RegisteredDocks.Where(registeredZone =&gt; dockID.Contains(registeredZone.ID)).FirstOrDefault();

        if (Equals(dock, null))
        {
            _logger.ErrorFormat(""Did not find dock: {0}"", dockID);
        }
        else
        {
            _logger.DebugFormat(""Found dock: {0}"", dockID);
        }

        return dock;
    }
}
</code></pre>

<p>Am I on a bad path? What steps are generally taken at this point?</p>

<p>EDIT1: I have decided to start down the path of improvement by finding the controls which are least-integrated into LayoutManager and finding ways of breaking them down into separate objects. So, for instance, instead of assigning the HistoricalReportsContainer and CustomReportsContainer objects to LayoutManager (which is then used in RegenerationManager.RegenerateReportMenu) I have moved the code to RadListBox ""Load"" event. There, I check the ID of the control which is loading and react accordingly. A strong first improvement, and has removed 2 controls and a method from LayoutManager!</p>
","<c#><asp.net><oop><design><refactoring>","6","210","2011-10-28 21:17:43"
"7935968","Reusable Code in CakePHP","<p>i built two controllers which acutally use some same code. So i want to refactor it in an own file. But because i am using models in this code i'm not able to use components is there another good solution for that? Hope you can help.</p>
","<php><cakephp><refactoring><reusable>","0","92","2011-10-28 23:43:49"
"7938347","Accessing a model from another model's view or controller","<p>How can I do a cross-model find in a way which conforms most closely to the MVC pattern? </p>

<p>I have a model, Istc.rb. In the index view that corresponds to this model, I want to do this: </p>

<pre><code>   = ""Last edited by #{User.find_by_id(istc.user_id).first_name}""    
</code></pre>

<p>Clearly you can't have a model.find in a view - and not only is this a model.find, it's a find on a different model. But how would you refactor this? </p>

<p>I'm nervous about having a helper like this because it's still pretty close to the View layer:   </p>

<pre><code>module UsernameHelper
  def user_name(model)
    User.find_by_id(model.user_id) unless User.find_by_id(model.user_id).nil?
  end
end
</code></pre>

<p>Is the way to do it to have a scope on User? </p>

<pre><code># User.rb
scope :lookup, lambda {|model| where(""id = ?"", model.user_id)}

# username_helper.rb
module UsernameHelper
  def user_name(model)
    User.lookup(model).first unless User.lookup(model).first.nil?
  end
end
</code></pre>

<p>Or should the istcs_controller handle it? Or should there be a separate controller, which talks to both the Istc and User model? </p>

<p>Thoughts welcome, and I'd really like to see any sample applications which solve this sort of problem elegantly, too. </p>
","<ruby-on-rails><mvc><refactoring><ruby-on-rails-3.1>","0","73","2011-10-29 10:40:08"
"7938573","Some methods don't work for the most used constructor","<p>I've run into a class that's 2,000+ lines. It has two constructors - a simple one, and a complex one. Most of the methods work well for both constructors, but there are a few methods will either fail or behave oddly if the object is instantiated with the simple constructor.</p>

<p>Inheritance in this case is possible, but it'd be a bit weird. It's not a different object, it's just a different constructor.</p>

<p>Throwing an exception on a call to a method that requires the complex constructor would be an ugly patch.</p>

<p>Is there a standard refactor or pattern that solves this?</p>
","<architecture><refactoring>","0","32","2011-10-29 11:21:18"
"7938988","How to refactor and discover dependencies when doing BDD","<p>Doing BDD means going from top to bottom, so we write test for top level feature first. Now to setup a test you usually need to set up some mocks instead of real deps. How do you know what dependemcies are required, what kind of services you need? I can't make up how to define dependencies on this level. In classical TDD bottom up it was as simple as refactoring your existing impl into dependent objects. </p>

<p>Does BDD and mocking means that we are required to have complete dependencies graph made up and roughly designed upfront?</p>

<p>What about refactoring then? It seems taht there is no place for breaking your impl into dependencies any more as you have those defined already.</p>

<p>Eg I have a timed cache feature to implement.
My tests should be:</p>

<ul>
<li>return value via storage call if not cached </li>
<li>return value with no storage call if cached</li>
<li>return value via storage call if timeout exceeded</li>
</ul>

<p>Does it mean I need to have all my potential dependencies identified and mocks prepared? And should I verify values returned from my xall, or just dependencies calls expected?</p>
","<design><refactoring><tdd><mocking><bdd>","0","102","2011-10-29 12:46:50"
"7941278","Adding menu item in Eclipse","<p>I want to add an item to the <strong>Refactor</strong> menu in Eclipse? How can I do this?</p>

<p>Thanks a lot</p>
","<eclipse><refactoring>","0","140","2011-10-29 19:50:10"
"7951607","How correctly get resources from resource dictionary in WPF application?","<p>everyone, in WPF application I have the resource dictionary where is defined a lot of DataTemplates for controls and styles. For example</p>

<pre><code>    &lt;DataTemplate x:Key=""PriceColumnCellTemplate""&gt;
    &lt;Grid VerticalAlignment=""Center""&gt;
        &lt;Grid.ColumnDefinitions&gt;
            &lt;ColumnDefinition /&gt;
        &lt;/Grid.ColumnDefinitions&gt;
        &lt;TextBlock
            Text=""{Binding Path=PriceQuotation, Mode=OneWay}""
            Grid.Column=""1""
            VerticalAlignment=""Center""
            Margin=""2,0""
        /&gt;
    &lt;/Grid&gt;
&lt;/DataTemplate&gt;
</code></pre>

<p>in code behind class for View I have to get this data template. Now this is implementing in the following way</p>

<pre><code>    private DataTemplate _priceColumnCellTemplate;
    private DataTemplate PriceColumnCellTemplate
    {
        get
        {
            if (_priceColumnCellTemplate == null)
                _priceColumnCellTemplate = (DataTemplate)_applicationResources[""PriceColumnCellTemplate""];

            return _priceColumnCellTemplate;
        }
    }

    private DataTemplate _priceColumnCellEditingTemplate;
    private DataTemplate PriceColumnCellEditingTemplate
    {
        get
        {
            if (_priceColumnCellEditingTemplate == null)
                _priceColumnCellEditingTemplate = (DataTemplate)_applicationResources[""PriceColumnCellEditingTemplate""];

            return _priceColumnCellEditingTemplate;
        }
    }

    private DataTemplate _alternativePriceColumnCellTemplate;
    private DataTemplate AlternativePriceColumnCellTemplate
    {
        get
        {
            if (_alternativePriceColumnCellTemplate == null)
                _alternativePriceColumnCellTemplate = (DataTemplate)_applicationResources[""AlternativePriceColumnCellTemplate""];

            return _alternativePriceColumnCellTemplate;
        }
    }
</code></pre>

<p>for each DataTemplate is created private field and the property for get value of this field.
In the same way is implementing for Styles.</p>

<p>The problem in this code is when I need to add a new DataTemplate I should add code like above for getting this DataTemplate form resources.</p>

<p>How to do refactor this code to avoid this duplication of code, and save the same functionality, may exist more flexible way to get resources from xaml file.</p>

<p>Please, help me with suggestion or give me an example how to solve this problem.
Thanks in advance!</p>
","<c#><wpf><refactoring><resourcedictionary>","1","174","2011-10-31 09:06:56"
"7958302","Split seeds.rb file","<p>My <code>seeds.rb</code> file is getting very large.  What is the best way to refactor the data in the file?</p>

<p>Can I put the data into various files and <code>require</code> them in the <code>seeds.rb</code> file?</p>
","<ruby-on-rails><ruby><refactoring>","2","137","2011-10-31 18:56:55"
"7960449","How do I have an object subscribe to another's event while keeping the two loosely coupled?","<p>I have the following bits of code which, in my mind, seem like the bare basics necessary to implement the Observer pattern. Is this standard, or am I doing something wrong?</p>

<pre><code>public class LayoutManager
{
    public CormantTimer Timer { get; set; }
}

protected void Page_Init(object sender, EventArgs e)
{
    LayoutManager.Instance.Timer = RefreshAndCycleTimer;
}

public class CormantRadDock : RadDock, ICormantControl&lt;RadDockSetting&gt;
{
    public CormantRadDock()
    {
        LayoutManager.Instance.Timer.TimerEvent += DoTimerRefreshTick;
    }
}
</code></pre>

<p>The CormantRadDock objects are dynamically created. RefreshAndCycleTimer is on Page.</p>

<p>I am worried that, as my project grows larger, there will be a large amount of non-related controls in LayoutManager -- just there to be subscribed to. Is this standard? Should I be doing something different?</p>

<p>Thanks</p>
","<c#><asp.net><refactoring><observer-pattern><loose-coupling>","0","62","2011-10-31 22:17:56"
"7963620","How to refactor these methods to avoid duplication?","<p>In our code base</p>

<pre><code>public ActionResult Copy(string id, string targetId)
            {
                //lot of similar code
                Copy(sourcePageRef, destinationPageRef);
                //lot of similar code
            }
</code></pre>

<p>and</p>

<pre><code>public ActionResult Move(string id, string targetId)
        {
            //lot of similar code
            Move(sourcePageRef, destinationPageRef);
            //lot of similar code
        }
</code></pre>

<p>the problem is, Copy and Move have different signatures:</p>

<pre><code>PageRef Copy(PageRef, PageRef)
</code></pre>

<p>and</p>

<pre><code>void Move(PageRef, PageRef)
</code></pre>

<p>How can I refactor these methods to avoid duplication?
Thank you</p>
","<c#><.net><refactoring>","0","95","2011-11-01 07:32:40"
"7969109","any C/C++ refactoring tool based on libclang? (even simplest ""toy example"" )","<p>As I've pointed out - <a href=""http://stackoverflow.com/questions/5587140/any-tutorial-on-how-to-use-clang-for-syntax-highlighting-and-code-completion/7250322#7250322"">here</a> - it seems clang's libclang should be great for implementing the hard task that is C/C++ code analysis and modifications (<a href=""http://stackoverflow.com/questions/5587140/any-tutorial-on-how-to-use-clang-for-syntax-highlighting-and-code-completion/7250322#7250322"">check out video presentation and slides</a>).</p>

<p>Do you know of <strong>any</strong> C/C++ refactoring tool based on libclang ?</p>

<p>""Any"" includes even simple alpha state project, with support of one refactoristation technique. It can be without preprocessor support. As an example of the functionally about which I'm talking: changing method names, whether it supports multiple files or only one file at a time. You might be wondering what the goal is of asking for even small working examples My thought is that <em>creating a list of code examples and small tools that are in one place will provide a better resource to learn how to implement refactorisation with libclang</em>. I believe that from simple projects might grow bigger projects - in a proper opensource manner :).</p>
","<c++><refactoring><llvm><clang>","11","1547","2011-11-01 15:54:56"
"7970198","Sliding Week Comparison","<p>I want to compare data from the current week (1 through 52) to the data from two weeks prior.  I need to make sure that when the new-year boundary is crossed, the comparison keeps working. I have a working predicate, like this:</p>

<pre><code>WHERE ( DATEPART(ww,MA.DateOpen) + 1 ) % 52 = DATEPART(ww,@ImportDate) - 1
</code></pre>

<p>The above logic works, but it does not account for proximate years.  In other words, unwanted data from week 'X' of all prior years will be included in the comparison.  So the predicate must be expanded to account for years, which in turn requires handling the new year boundary: week 1 of 2012 should be compared against week 51 of 2011.</p>

<p>How can this be done without a verbose looking predicate?</p>

<p><strong>update:</strong>
This question is complicated by the need for ""week of year"" to be treated as Tuesday through Tuesday.  My current ""correct"" attempt is embodied in the [VerboseCheck] case below.</p>

<pre><code>SET DATEFIRST 2
DECLARE @ImportDate date = '2011-1-4'
DECLARE @DateOpen date = '2010-12-20'
select @ImportDate, 
YEAR(@DateOpen),
DATEPART(ww, @DateOpen),
YEAR(DATEADD(dd,-14,@ImportDate)), 
DATEPART(ww,DATEADD(dd,-14,@ImportDate)),
CASE WHEN 
  YEAR(@DateOpen) + DATEPART(ww, @DateOpen) = 
  YEAR(DATEADD(dd,-14,@ImportDate)) + DATEPART(ww,DATEADD(dd,-14,@ImportDate))
  THEN 1 ELSE 0 END [VerboseCheck],
CASE WHEN DATEDIFF (ww, @DateOpen, @ImportDate) =2
  THEN 1 ELSE 0 END [SimpleCheck]
</code></pre>

<p>The [SimpleCheck] would be perfect, but it gives a different answer than [VerboseCheck]. If I advance @DateOpen one more day, then the two give the same answer.  This suggests that both are not honoring the DATEFIRST evaluation in the same way.</p>
","<sql><sql-server><tsql><datetime><refactoring>","0","73","2011-11-01 17:16:33"
"7971250","How do I rename properties or public fields after moving them to another class?","<p>I have fields in one class and I want to move them to another class. Creating the new fields is not that much work. Changing all their references from the class they were in until now, however - is.</p>

<p>‘Rename’ doesn’t accept ‘myClass.Field’ as valid. Is changing using Find-and-Replace the only option (though then I’ll have to check every occurrence because of identically-named variables)? Or is there a simple way like ‘Rename’? </p>
","<c#><visual-studio-2010><refactoring>","3","84","2011-11-01 18:41:15"
"7971094","DRY'ing multiple 3 column lists with SASS","<p>I have the following SASS code:</p>

<pre><code>ul {

  &amp;.threeColList1 {
    margin: 30px auto 0 auto;
    padding: 0;
    list-style: none;
    width: 775px;
    li {
      width: 225px;
      height: 330px;
      float: left;
      text-align: left;
      margin-right: 50px;
      .name {
       margin-bottom: 5px;
      }
      .position {
        margin-top: 0;
        font-weight: bold;
      }
      &amp;.last {
        margin-right: 0;
      }
    }
  }

  &amp;.threeColList2 {
    margin: 0 auto;
    padding: 0;
    list-style: none;
        width: 850px;
    li {
      width: 225px;
      height: 175px;
      float: left;
      text-align: left;
      margin-right: 75px;

      h3 { font-size: 1.5em; }
      p { font-size: 1.2em; }
      &amp;.last {
        margin-right: 0;
      }
    }
  }
}
</code></pre>

<p>How would you approach DRY'ing this up?  If it weren't for the inner li elements such as h3, name, position, DRY'ing it would be pretty straight forward.  Your answer will be helpful in understanding more about what you can do with SASS to keep your code DRY.</p>
","<css><refactoring><sass><dry>","1","59","2011-11-01 18:29:56"
"7961216","Looking for something more pythonic","<p>This looks really ugly, it there a way to make it look more pythonic?</p>

<pre><code>if self.cleaned_data['string1_val'] == '' and latestSI.string1_val is None :
    if self.cleaned_data['string2_val'] == '' and latestSI.string2_val is None :
        return False
    elif self.cleaned_data['string2_val'] == latestSI.string2_val :
        return False
    else:
        return True
elif self.cleaned_data['string1_val'] == latestSI.string1_val :
    if self.cleaned_data['string2_val'] == '' and latestSI.string2_val is None :
        return False
    elif self.cleaned_data['string2_val'] == latestSI.string2_val :
        return False
    else:
        return True
else:
    return True
</code></pre>
","<python><django><refactoring><pythonic>","2","115","2011-11-01 00:19:01"
"7972746","How to refactor recurring for loop?","<p>I have a for loop which is used in many classes but the task inside the for loops are different. For example Class Foo uses following </p>

<pre><code>for(Pojoclass a : listofPojo){
    if(a.getX().equals(b)){
        methos(a.getX());
    }
 }
</code></pre>

<p>and class Bar uses following:</p>

<pre><code>for(Pojoclass a : listofpojo){
    if(a.getX().equals(x)){
        methos(a.getX());
    } // or some other logic
 }
</code></pre>

<p>I find many such loops in my project which iterate on same object but do different behavior. How do I re-factor this?</p>

<p><strong>EDIT :</strong> I am not dealing with string, I am dealing with POJO classes</p>
","<java><refactoring><for-loop>","3","108","2011-11-01 20:52:22"
"7980504","REFACTOR: Clean dao code for a query with multiple optional params","<p>Is there a possiblity to clean up such a dao method?
I don't like the 2 if's for each param, but there isn't something like ""query.setSql()"" so i could update the sql after adding the params and building the sql.</p>

<pre><code>public List&lt;OriginLabel&gt; findByCriteria(Link1 l1, Link2 l2, String att) {
    String sql = ""FROM MyEntity e WHERE 1=1"";
    if(l1 != null){
        sql += "" AND e.link1 = :l1 "";
    }
    if(l2 != null){
        sql += "" AND e.link2 = :l2 "";
    }
    if(att != null){
        sql += "" AND e.attribute = :att "";
    }
    Query query = getEntityManager().createQuery(sql);
    if(l1 != null){
        query.setParameter(""l1"", l1);
    }
    if(l2 != null){
        query.setParameter(""l2"", l2);
    }
    if(att != null){
        query.setParameter(""att"", att);
    }
    return (List&lt;MyEntity&gt;)query.getResultList();
}
</code></pre>
","<java><sql><design><refactoring>","1","104","2011-11-02 12:43:57"
"7998937","refactoring and removing 'for' statements when circling over many enum structures","<p>My class have an Enum as attribute.
It uses a String to set this attr.
There are many Enum classes.
How can I refactor it?</p>

<pre><code>public void setType(String s) {  

for (MyEnum1 e : MyEnum1.values()) {  
    if (e.name().equalsIgnoreCase(s))  
    this.type = e;  
}  
for (MyEnum2 e : MyEnum2.values()) {  
    if (e.name().equalsIgnoreCase(s))  
    this.type = e;  
}  
for ...  
</code></pre>

<p>Thanks in advance.</p>
","<java><enums><refactoring>","1","46","2011-11-03 17:04:41"
"8011782","How can I clean up this Ruby code?","<p><strong>The Problem</strong></p>

<p>I want to parse lines of a text box in order to generate items from it.</p>

<p>I've got it working but it looks ugly as sin.</p>

<p>How can I clean up that ""if/else"" mess?</p>

<p><strong>Code</strong></p>

<pre><code>class LineParser
  def self.parse(line)
    line_matches = line.chomp.match(/(?&lt;name&gt;[[:print:]]+) \$(?&lt;price&gt;\d+\.*\d*)( +?(?&lt;description_text&gt;[^\+#]([[:print:]][^\+#])*))?( +?(\+(?&lt;quantity&gt;\d+)))?( +?#(?&lt;cat1&gt;[[:print:]][^#]*))?$/)
    return matches_to_hash(line_matches)
  end
  def self.matches_to_hash(matches)
    hash = {}
    keys = [:name, :price, :description_text, :quantity, :cat1]
    keys.each do |key|
      if key == :price
        hash[key] = matches[key].to_f
      elsif key == :quantity
        if matches[key].nil?
          hash[key] = 1
        else
          hash[key] = matches[key].to_i
        end
      else
        hash[key] = matches[key]
      end
    end
    hash
  end
end
</code></pre>
","<ruby-on-rails><ruby><refactoring>","1","144","2011-11-04 15:33:27"
"8013112","Best way/pattern to build request based on different service","<p>I have a about 20 different services which I have to send requests to which require a slightly different set of headers. </p>

<p>The bad legacy code is something like this, </p>

<pre><code>row = db.query_for_service()

if row.type == 'foo1'
   // add common headers to request
   // add foo1 specific headers 1
   // add foo1 specific header 2
   // add foo1 specific header 3
else if row.type == 'foo2'
   // add common headers to request
   // add foo2 specific header 1
...
...
...
else if row.type == foo20
   // add common headers to request
   // add foo20 specific header 1
   // add foo20 specific header 2 
   // ...

send_request()
</code></pre>

<p>What is the best way to refactor this? I have considered some patterns that may work here (strategy, builder) but I am not too sure.</p>

<p>I am currently learning both Java and Python and I would to get thoughts on how the solutions would differ in the two languages</p>
","<java><python><oop><design-patterns><refactoring>","3","82","2011-11-04 17:04:27"
"8016555","removing nesting of if statements","<p>I have a piece of code, which I am not sure how to refactor.. It is not very readable and I would like to make it readable. Here is a the problem</p>

<p>There are two columns in database which can be either NULL, 0 or have a value each. On the web page there is a checkbox - enable and text box - value for each of those two columns.</p>

<pre><code>x = checkbox1
z = textbox1
y = checkbox2
w = textbox2
</code></pre>

<p>The logic is if both the checkboxes are not selected, then both the values should be 0. If either one is selected and other is not, then others value should be NULL. and for the one that is selected, if the textbox is empty its value should be NULL else should be the value in the textbox</p>

<pre><code>if{x}
{
   if(z)
   {
      a = NULL;
   }
   else
   {
      a = z;
   }
   if(y)
   {
      if(w)
      {
          b=w;
      }
      else
      {
          b = NULL;
      }
   }
   else
   {
      b = null
   }
}
else
{
   if(y)
   {
      a = NULL;
      if(w)
      {
          b=w;
      }
      else
      {
          b = NULL;
      }
   }
   else
   {
      a = 0;
      b = 0;
   }
}
</code></pre>

<p>Trust me this is a valid scenario. Let me know if this makes sense or I should give more information</p>
","<refactoring><nested-if>","1","42","2011-11-04 22:42:49"
"8020750","Javadoc doesn't match code","<p>While refactoring, I messed up some of my <code>Javadoc</code> annotations through removing parameters, etc...</p>

<p>Is there some tool in Eclipse to find mismatches between the code and the Javadoc annotations?</p>
","<java><eclipse><eclipse-plugin><refactoring><javadoc>","2","77","2011-11-05 14:21:50"
"8022444","How to refactor an API","<p>How do you deal with APIs that should be refactored, while not breaking the clients that use the API?</p>

<p>One possible solution I came across: recording refactors to the API, providing the recording to clients of the API which can then apply the refactors to their code:
<a href=""https://netfiles.uiuc.edu/dig/papers/Thesis.pdf"" rel=""nofollow"">https://netfiles.uiuc.edu/dig/papers/Thesis.pdf</a></p>

<p>Does such a thing exist for Python? Are there other solutions?</p>
","<python><api><refactoring>","3","68","2011-11-05 18:51:48"
"8033412","Source Control and Redesign","<p>I'm working on my own open-source project. I've recently released the first workable version but I doubt anyone is using it. I'm the only one working on it. I'm using mercurial and my question is I'm planing a pretty big redesign. Not many stones will remain unturned. How to I tackle this in term of source control? Just continue from current head or create a branch?</p>

<p>How often do I commit? Some classes might disappear (split into 2 or functionality moved elsewhere, interface changes).</p>
","<mercurial><refactoring>","0","50","2011-11-07 06:35:57"
"8041807","NetBeans ""inline variable"" refactoring","<p>Is it possible to inline (and the other way around) variables with a NetBeans refactoring?</p>

<p>Something like this:</p>

<pre><code>Something s = new Something();
render(s);
</code></pre>

<p>should become</p>

<pre><code>render(new Something());
</code></pre>

<p>The ReSharper equivalent is <code>Ctrl+R+I</code>.</p>
","<java><netbeans><refactoring><resharper>","1","119","2011-11-07 19:56:07"
"8043047","compare where in","<p>I'm looking for some library with static functions to eliminate duplication in code that compare ""things"".</p>

<pre><code>(evil.equals(s1) || evil.equals(s2) || evil.equals(s3))
(evil == enum1 || evil == enum2 || evil == enum3)
</code></pre>
","<java><refactoring><code-duplication>","2","79","2011-11-07 21:45:45"
"8039391","Variable resolution with parent null values","<p>I have a method that has many many statements like this:</p>

<pre><code>employee.LastName = file.EMPLOYEE.NAME.SUBNAME.FAMILYNAME.NAMEPART1.Value;
</code></pre>

<p><em>(This is a made up structure.  The actual structure is based off of 2.3 HL7 XML and is far more complex and full of pointless objects.)</em></p>

<p>So my problem is that any one of these values can be null.  If I don't check that then when I try to get the next value in the chain it will throw an exception.</p>

<p>Obviously I could do something like this:</p>

<pre><code>if (contract.EMPLOYEE != null)
 if (contract.EMPLOYEE.NAME.SUBNAME != null)
  if (contract.EMPLOYEE.NAME.FAMILYNAME != null)
   if (contract.EMPLOYEE.NAME.FAMILYNAME.NAMEPART1 != null)
     employee.LastName = file.EMPLOYEE.NAME.SUBNAME.FAMILYNAME.NAMEPART1.Value;  
</code></pre>

<p>But that is a lot of checks for each time I need to set a value.  (And the object tree changes a lot so I cannot do a check it once and be done system.)</p>

<p>Maybe the better way is to do this:</p>

<pre><code>try
{
   employee.LastName = file.EMPLOYEE.NAME.SUBNAME.FAMILYNAME.NAMEPART1.Value;
}
catch
{}
</code></pre>

<p><em>(Note if the value is not there then I am fine to not have nothing done.)</em></p>

<p>However, this is a bit messy still.  I have 14 items to set in this method alone and many many more to come.  </p>

<p>Is there a way I can abstract this so I can just do my setters and little else?</p>

<p>I thought of a method call that would do the checks/try statement, but if I pass in <code>file.EMPLOYEE.NAME.SUBNAME.FAMILYNAME.NAMEPART1.Value</code> it will try to resolve it while I pass it (thus giving me an exception).</p>

<p>Is there some other (clean) way?  (Maybe an extension method would work?)  I would be grateful to any ideas.</p>

<hr>

<p>Note: I ended up just doing this for each line:</p>

<pre><code>try { employee.LastName = file.EMPLOYEE.NAME.SUBNAME.FAMILYNAME.NAMEPART1.Value; } catch (System.NullReferenceException) { }
</code></pre>

<p>It seems more readable than the lambda system.</p>
","<c#><refactoring>","3","79","2011-11-07 16:25:04"
"8050635","Unit testing code which calls static methods","<p>I've read most SO related questions ( <a href=""http://stackoverflow.com/questions/4220852/static-methods-and-unit-tests"">here</a>, <a href=""http://stackoverflow.com/questions/5961023/unit-testing-and-static-methods"">here</a> and <a href=""http://stackoverflow.com/questions/5503702/patterns-or-practices-for-unit-testing-methods-that-call-a-static-method"">there</a>).
The last question proposes four alternatives to make code which calls static methods unit-testable.
   I want to ask about my particular case: We have a ""business logic layer"" or ""rules"" project which contains 45 static classes (no state, just static methods). Moreover, they are not easily testable by themselves: most of them access the database and file system. It's not that bad, anyway: to access the database, they use the unique instance of some Mapper class (all Mappers are Singletons).
   Whenever I try to unit test something, I run into this wall. The biggest problem is that this is very, very important code, and changes to it should be planned very carefully.
   My question: How should I go about making this more unit testable? Should I write 45 interfaces and use dependency injection? Even so, how do I stub/mock Mappers?</p>

<p>PS: I've been reading Michael Feathers' ""Working with Legacy Code"", so direct references are welcome (other books too :)</p>

<p><strong>Edit</strong>: Since some people said solutions might be platform-dependent, I'm working on .NET (C# and some VB.NET)</p>
","<.net><unit-testing><refactoring><static-methods>","4","186","2011-11-08 12:51:14"
"8067846","State pattern, but controlled from 2 different places","<p>I have a class that controls what the user sees on the page.  There are a couple of states.  The first set of views are controlled by the user object and that object controls the items below.
 - Logged In
 - Not Logged In
 - Liked Page
 - Page Not Liked</p>

<p>Then, there is another object(campaign) that identifies if the campaign tied to the page above is valid or not
 - Campaign Active
 - Campaign Over</p>

<p>I am wondering if I should have 2 classes that controls the state - one for user and one for campaign.  Then, based on both states set by each class, deduce the correct view based with if and else.</p>

<ol>
<li>If page liked and campaign active - show user campaign available page</li>
<li>If page not liked and campaign active - show prelike campaign available page</li>
<li>If page liked and campaign over - show user campaign over page</li>
<li><p>If page not liked and campaign over - show user prelike campaign over page</p>

<p>Does this seem like ""code smell""? </p></li>
</ol>

<p>How else could I design this better?  </p>
","<oop><design-patterns><refactoring><state><code-smell>","2","83","2011-11-09 16:05:26"
"8083372","Is it OK to have a class with just properties for refactoring purposes?","<p>I have a method that takes 30 parameters.  I took the parameters and put them into one class, so that I could just pass one parameter (the class) into the method.  Is it perfectly fine in the case of refactoring to pass in an object that encapsulates all the parameters even if that is all it contains.</p>
","<c#><oop><refactoring>","65","2458","2011-11-10 17:01:40"
"8085805","RSpec: How do I stub a Sorcery method call in a controller?","<p>Controller:</p>

<pre><code>class SessionsController &lt; ApplicationController
  layout 'login'

  def create
    user = login(params[:username], params[:password])
    if user
      redirect_back_or_to root_url
    else
      flash.now.alert = ""Username or password was invalid""
      render :new
    end
  end
end
</code></pre>

<p>Test:</p>

<pre><code>require 'spec_helper'

describe SessionsController do

  describe ""POST create"" do

    before(:each) { Fabricate(:school) }

    it ""Should log me in"" do      
      post(:create, {'password' =&gt; 'Secret', 'username' =&gt; 'director'})
      response.should redirect_to('/')
    end
  end

end
</code></pre>

<p><code>Fabricate(:school)</code> has a callback that generates the first user. I want to refactor this code so that is doesn't use any database calls at all. I want to stub the login call so tht it returns true.</p>

<p>How could I stub the <code>login</code> method? It comes from Sorcery.</p>

<p><a href=""https://github.com/NoamB/sorcery/blob/master/lib/sorcery/controller.rb#L31"" rel=""nofollow"">https://github.com/NoamB/sorcery/blob/master/lib/sorcery/controller.rb#L31</a></p>
","<refactoring><rspec>","2","205","2011-11-10 20:25:56"
"8086651","What are some techniques to facilitate safe refactoring in Javascript?","<p>I'm coming from statically typed languages like C++ where there are tools (the compiler for one) that will remind me if I forget something obvious while refactoring. For example, if I change the number of arguments to a function but I forget to change all the calls to it. But it seems really easy to make this type of mistake in javascript. How do you avoid problems like this when refactoring javascript? </p>
","<javascript><refactoring>","0","41","2011-11-10 21:36:58"
"8093071","Using Eclipse CDT from command line","<p>I need to have some of my C++ classes, functions and namespaces renamed as a part of my build script, which is runned by my CI system. Unfortunetly simple sad/awk/gsar/... technique is not enough, I need smart rename refactoring, that carefully analyses my code. Actually I found out, that CDT C/C++ rename refactoring does, what I need. But it does it from Eclipse IDE. So I need to find a way to start it from command line, and to make it a part of my CI build script.
I know that Eclipse has eclipsec executable, that allowes running some Eclipse functions from command line (<a href=""http://stackoverflow.com/questions/344797/build-several-cdt-c-projects-from-commandline"">see e.g. here</a>). But I can't find any suitable documentation for functions, CDT exports to command line. The only thing, I found is the following: <a href=""http://help.eclipse.org/indigo/index.jsp?topic=%2Forg.eclipse.cdt.doc.isv%2Freference%2Fapi%2Foverview-summary.html"" rel=""nofollow"">http://help.eclipse.org/indigo/index.jsp?topic=%2Forg.eclipse.cdt.doc.isv%2Freference%2Fapi%2Foverview-summary.html</a>
But it doesn't solve my problem.
So, I need help to run CDT rename refactoring from command line (or someway like that). If it is not possible, may be someone will advice another tool, that can do rename refactoring for C++ from command line ?</p>
","<c++><command-line><refactoring><rename><cdt>","1","104","2011-11-11 11:06:30"
"8098562","How to improve recursive backtracking algorithm","<p>I implemented backtracking based solution for my problem which I specified in my previous post: <a href=""http://stackoverflow.com/questions/8023113/packing-items-into-fixed-number-of-bins"">Packing items into fixed number of bins</a></p>

<p>(Bin is a simple wrapper for <code>vector&lt;int&gt;</code> datatype with additional methods such as sum() )</p>

<pre class=""lang-c prettyprint-override""><code>bool backtrack(vector&lt;int&gt;&amp; items, vector&lt;Bin&gt;&amp; bins, unsigned index, unsigned bin_capacity)
{
    if (bin_capacity - items.front() &lt; 0) return false;

    if (index &lt; items.size())
    {
        //try to put an item into all opened bins
        for(unsigned i = 0; i &lt; bins.size(); ++i)
        {
            if (bins[i].sum() + items[index] + items.back() &lt;= bin_capacity || bin_capacity - bins[i].sum() == items[index])
            {
                bins[i].add(items[index]);
                return backtrack(items, bins, index + 1, bin_capacity);

            }
        }
        //put an item without exceeding maximum number of bins
        if (bins.size() &lt; BINS)
        {
            Bin new_bin = Bin();
            bins.push_back(new_bin);
            bins.back().add(items[index]);

            return backtrack(items, bins, index + 1, bin_capacity);

        }
    }
    else
    {
        //check if solution has been found
        if  (bins.size() == BINS )
        {
            for (unsigned i = 0; i &lt;bins.size(); ++i)
            {
                packed_items.push_back(bins[i]);
            }

            return true;
        }
    }
    return false;
}
</code></pre>

<p>Although this algorithm works quite fast, it's prone to stack overflow for large data sets.</p>

<p>I'm looking for any ideas and suggestions how to improve it.</p>

<p>Edit:</p>

<p>I decided to try an iterative approach with explicit stack, but my solution doesn't work as expeced - sometimes it gives incorrect results.</p>

<pre class=""lang-c prettyprint-override""><code>bool backtrack(vector&lt;int&gt;&amp; items, vector&lt;Bin&gt;&amp; bins, unsigned index, unsigned bin_capacity)
{
      stack&lt;Node&gt; stack;
      Node node, child_node;
      Bin new_bin;
      //init the stack
      node.bins.add(new_bin);
      node.bins.back().add(items[item_index]);
      stack.push(node);
      item_index++;

      while(!stack.empty())
      {
        node = stack.top();
        stack.pop();

        if (item_index &lt; items.size())
        {
            if (node.bins.size() &lt; BINS)
            {
               child_node = node;
               Bin empty;
               child_node.bins.add(empty);
               child_node.bins.back().add(items[item_index]);
               stack.push(child_node);
            }

            int last_index = node.bins.size() - 1;
            for (unsigned i = 0; i &lt; node.bins.size(); i++)
            {
                if (node.bins[last_index - i]-&gt;get_sum() + items[item_index]+ items.back() &lt;= bin_capacity || 
                bin_capacity - node.bins[last_index - i]-&gt;get_sum() == items[item_index]) 
               {
                   child_node = node;
                   child_node.bins[last_index - i]-&gt;push_back(items[item_index]);
                   stack.push(child_node);
                }
            }
            item_index++;
            }
        else
        {
           if (node.bins() == BINS)
           {
               //copy solution
               bins = node.bins;
               return true;
           }
       }
   }
    return false;
}
</code></pre>

<p>Any suggestions are highly appreciated.</p>
","<algorithm><recursion><refactoring><stack><backtracking>","2","250","2011-11-11 18:51:33"
"8106983","Extract method from jQuery function","<p>I'm trying to extrac a method from this function:</p>

<pre><code>addWidgetControls: function () {
        var iNettuts = this,
            $ = this.jQuery,
            settings = this.settings;

        $(settings.widgetSelector, $(settings.columns)).each(function () {
            var thisWidgetSettings = iNettuts.getWidgetSettings(this.id);
            if (thisWidgetSettings.removable) {
                $('&lt;a href=""#"" class=""remove""&gt;CLOSE&lt;/a&gt;').mousedown(function (e) {
                    e.stopPropagation();
                }).click(function () {
                    $(this).parents(settings.widgetSelector).animate({
                        opacity: 0
                    }, function () {
                        $(this).wrap('&lt;div/&gt;').parent().slideUp(function () {
                            $(this).remove();
                        });
                    });

                    return false;
                }).appendTo($(settings.handleSelector, this));
            }

            if (thisWidgetSettings.collapsible) {
                $('&lt;a href=""#"" class=""collapse""&gt;COLLAPSE&lt;/a&gt;').mousedown(function (e) {
                    e.stopPropagation();
                }).toggle(function () {
                    $(this).css({ backgroundPosition: '-38px 0' })
                        .parents(settings.widgetSelector)
                            .find(settings.contentSelector).hide();
                    return false;
                }, function () {
                    $(this).css({ backgroundPosition: '' })
                        .parents(settings.widgetSelector)
                            .find(settings.contentSelector).show();
                    return false;
                }).prependTo($(settings.handleSelector, this));
            }
        });
    },
</code></pre>

<p>I've extracted the code from this function like this:</p>

<pre><code>addWidgetControls: function () {
        var iNettuts = this,
            $ = this.jQuery,
            settings = this.settings,
            func = this.doWidget;

        $(settings.widgetSelector, $(settings.columns)).each(function () {
            func(this);
        });
    },

    doWidget: function (widg) {
        $ = jQuery;
        settings = iNettuts.settings;
        var thisWidgetSettings = iNettuts.getWidgetSettings(widg.id);
        if (thisWidgetSettings.removable) {
            $('&lt;a href=""#"" class=""remove""&gt;&lt;/a&gt;').mousedown(function (e) {
                e.stopPropagation();
            }).click(function () {
                $(widg).parents(settings.widgetSelector).animate({
                    opacity: 0
                }, function () {
                    widg.wrap('&lt;div/&gt;').parent().slideUp(function () {
                        widg.remove();
                    });
                });

                return false;
            }).appendTo($(settings.handleSelector, widg));
        }

        if (thisWidgetSettings.collapsible) {
            $('&lt;a href=""#"" class=""collapse""&gt;&lt;/a&gt;').mousedown(function (e) {
                e.stopPropagation();
            }).toggle(function () {
                $(widg).css({ backgroundPosition: '-38px 0' })
                        .parents(settings.widgetSelector)
                            .find(settings.contentSelector).hide();
                return false;
            }, function () {
                $(widg).css({ backgroundPosition: '' })
                        .parents(settings.widgetSelector)
                            .find(settings.contentSelector).show();
                return false;
            }).prependTo($(settings.handleSelector, widg));
        }
    },
</code></pre>

<p>I've just copied the function code, replaced <code>this</code> with <code>widg</code> and added <code>widg</code> as an argument. Maybe there is a difference between <code>$(widge)</code> and <code>widg</code>.
But it doesn't work. What am I missing? Is there a tool that can do this easily? Thanks.</p>

<p>PS: By the way, this is grabbed from <a href=""http://net.tutsplus.com/tutorials/javascript-ajax/inettuts/"" rel=""nofollow"">this tutorial</a>.</p>
","<javascript><jquery><refactoring>","0","153","2011-11-12 19:30:09"
"8113497","Refactoring if-chains in Smalltalk without class explosion","<p>As Smalltalk discourages the use of caseOf:, what aternatives exists to implement the following situation without class explosion?</p>

<pre><code>self condition1
        ifTrue: [ self actionForCondition1 ]
        ifFalse: [ 
            self condition2
                ifTrue: [ self actionForCondition2 ]
                ifFalse: [ 
                    self condition3
                        ifTrue: [ self actionForCondition3 ]
                        ifFalse: [ ....  ] ] ]
</code></pre>
","<if-statement><refactoring><smalltalk>","5","137","2011-11-13 17:57:04"
"8123729","Handling errors when refactoring procedural code","<p>I was handed some C code that basically consists of a big main() function. I am now trying to unfold the method into smaller functions, to make clearer the code's intent. I am having some trouble, though:</p>

<pre><code>void main(int argc, char *argv[])
{
    if(argc != 3)
    {
        printf(""Usage: table-server &lt;port&gt; &lt;n_lists&gt;\n"");
        return;
    }
    int port = atoi(argv[1]), n_lists = atoi(argv[2]);
    if(port &lt; 1024 || port &gt; 49151 || n_lists &lt; 1)
    {
        printf(""Invalid args.\n"");
        return;
    }
    signal(SIGPIPE, SIG_IGN);
    int sockfd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
    struct sockaddr_in s_addr;
    s_addr.sin_family = AF_INET;
    s_addr.sin_port = htons(port);
    s_addr.sin_addr.s_addr = htonl(INADDR_ANY);
    if(bind(sockfd, (struct sockaddr *)&amp;s_addr, sizeof(s_addr)) &lt; 0)
    {
        printf(""(bind).\n"");
        return;
    }
    if(listen(sockfd, SOMAXCONN) &lt; 0)
    {
        printf(""(listen).\n"");
        return;
    }
</code></pre>

<p>I can identify 4 main concerns in this code's function:</p>

<ol>
<li>Verifying the number of args is correct.</li>
<li>Getting from the command line arguments the port.</li>
<li>Calling signal(SIGPIPE, SIG_IGN).</li>
<li>Actually try to make a connection with the socket.</li>
</ol>

<p>The problem when trying to refactor this into small functions is mainly related with error handling. For instance,r trying to extract the logic of 1. would look like this:</p>

<pre><code>int verify_number_of_args(int argc) {
    if (argc != 3) {
        printf(""..."");
        return -1;
    }
    return 0;
}
</code></pre>

<p>and calling it would be something like this</p>

<pre><code>if (verify_number_of_args(argc) == -1) return;
</code></pre>

<p>which isn't actually that bad. Now, for the socket, that'd be way more troublesome as both <code>sockfd</code> and <code>s_addr</code> need to be returned, plus the status return value:</p>

<pre><code>int sockfd;
struct sockaddr_in* s_addr;
if (create_socket(port, &amp;sockfd, s_addr) == -1)
    return;
</code></pre>

<p>which kind of defeats the purpose of trying to keep my main method as simple and clear as possible. I could, of course, resort to global variables in the <code>.c</code> file but that doesn't seem that good of an idea.</p>

<p>How do you generally handle this kind of things in C?</p>
","<c><error-handling><refactoring><procedural-programming>","1","63","2011-11-14 15:19:07"
"8125199","Refactoring a module into a class: Changing shared fields to instance fields","<p>I'm currently refactoring an old Visual Basic DLL (VB.Net), which stores all of its data in one module called <em>Globaldefinitions</em> as public fields. There are about 200 fields, referenced thousands of times all around the code:</p>

<pre><code>Public Module Globaldefinitons
     Public a As Short
     ...
     Public zz10 As Double
End Module
</code></pre>

<p>In the DLL itself, after importing <em>Globaldefinitions</em>, these fields are referenced with their name (No module prefix):</p>

<pre><code>a = 5
</code></pre>

<p>I need to change the module into a class with non-shared fields. This means, each and every of these thousands of references needs to reference the instance of that class:</p>

<pre><code>globalDefinitionsInstance.a = 5
</code></pre>

<p>How do I go about this efficiently?</p>

<p>Regular expressions operating on the source fall flat. Refactoring tools like Re-Sharper or CodeRush don't seem to offer this functionality. Visual Studio 2010 cannot do it automatically either.</p>
","<vb.net><visual-studio><visual-studio-2010><refactoring>","1","82","2011-11-14 17:02:05"
"8137799","More simple logic condition to check non-empty requirements","<p>I have some simple logic to check if the field is valid:</p>

<pre><code>private boolean isValidIfRequired(Object value) {
    return
        (required &amp;&amp; !isEmpty(value)) || !required;
}
</code></pre>

<p>it tells that the field is valid if it's either required and not empty or not required.</p>

<p>I don't like this required || !required part. Something with just required would be better.
How do I simplify this method to make it more readable and simple?</p>
","<java><refactoring><logic><boolean>","0","82","2011-11-15 14:22:47"
"8143459","Any refactoring that can help me here?","<p>When I'm making user controls for both Winforms and ASP.NET, I find myself writing the same section of code over and over again for each property on the form, which is this:</p>

<pre><code>private string _url;

public string Url
{
  get { return _url; }
  set
  {
    if (_url == value)
      return;

    _url = value;
    OnUrlChange(EventArgs.Empty);
  }
}

public event EventHandler UrlChanged;

protected virtual void OnUrlChange(EventArgs e)
{
  //Maybe add some extra logic here

  if(UrlChanged != null)
    UrlChanged(this, e);
}
</code></pre>

<p>Sometimes there's the odd change. Maybe I'll writing my own class that derives from <code>EventArgs</code> and use that.</p>

<p>This seems like it must be a common task. Maybe I'm doing it wrong and there's a much easier way to write the lot? But if not, are there any custom refactoring tools that I can set up to fill in this code given the Property name <code>Url</code>?</p>
","<c#><refactoring>","3","91","2011-11-15 21:36:26"
"8152656","Literature Wanted for analyzing web systems and refactoring","<p>As a master-thesis i'm about to analyze a web-system, that consists of two modules written using different techniques.</p>

<p>The result of the analyze is several proposals on how the company can make it into one single module or that the whole/parts should be redone in a different fashion from scratch. </p>

<p>The modules is developed using HTML, Java Applets, XML and Java as backend.</p>

<p>My idea so far is to transform the system using Google Web Toolkit. Probably from ""scratch"" but using some existing parts that makes sense.</p>

<p>My question is if someone have any experience or recommendation on literature/research/articles/models..  on how to attack the problem?   </p>
","<refactoring><web><literature>","0","14","2011-11-16 13:46:19"
"8158124","Does this class count under ""Middle Man"" code smell?","<p>Does this class count under ""Middle Man"" code smell?</p>

<p>I have a ""Person"" class. I have one more class Person List which has a list of Person_list and has methods to add, remove and to do few other things with Person class.</p>

<p>I am accessing the Person_list class from another class.</p>

<p>Does this count under Middle Man or any other code smells?</p>

<pre><code> class P{
 }

public class PL {

    Vector&lt;P&gt; p;
    String name;

    public PL(String name) {
        p = new Vector&lt;P&gt;();
        this.name = name;
    }

    public void addP(String name, int a, double h,
            double w, String a, String g) {
    }

    public Patient findP(String name) {
    }

    public void removeP(String name) {
    }

    public void printSummaryForP(String name) {
    }
}


class Main{

public static void main(String[] args){
PL pl=new PL();
pl.addP(a,b,c,d,e);
pl.addP(a,b,c,d,e);
pl.remove();
}
}
</code></pre>
","<refactoring><code-smell>","0","65","2011-11-16 20:20:33"
"8158241","Eclipse how to refactor Javadoc source comment?","<p>After making some changes to a method, I find it utterly annoying to have to manually re-factor the Javadoc source comment immediately preceding the method call.  Is there a way to get Eclipse to automatically do this for you?</p>
","<java><android><eclipse><refactoring><javadoc>","1","165","2011-11-16 20:30:50"
"8158458","Test Driven Development. How do I handle refactoring untested legacy code?","<p>I am beginning to adopt Test Driven Design (TDD) behaviors and workflow for my iOS development projects. There is at least one impediment though in the context of legacy software. I will often have to add features to a pre-existing code base that I am new to. I will typically want to refactor at the beginning of working with the code base which will often have no tests available to ensure that my refactor-ings are not altering code functionality or worse, adding bugs.</p>

<p>My question is how do TDD folks bootstrap the whole process when the code is not written from scratch but rather legacy code that they are brought in to work on?</p>

<p>Thanks,<br>
Doug</p>

<h2>UPDATE</h2>

<p>For a concrete example, I am using the example from Martin Fowler's Refactoring re-coded in Objective-C as a training device for TDD (and AppCode) <a href=""https://github.com/turner/RefactoringFirstExample"" rel=""nofollow"">>></a></p>

<p>I built the code from tests. I found I needed to add instance variables to the Customer class to ensure I didn't screw up the cost calculations in the <strong>statement</strong> method as I grew the code. This is the fundamental issue I need insight into.</p>
","<refactoring><tdd><legacy-code>","1","117","2011-11-16 20:47:53"
"8167058","Is there an efficient way for intermediate calculations in Linq to Entities","<p>I have this query which uses LinqToEntities behind the scenes.</p>

<pre><code>(...)
.GroupBy(x =&gt; x.FahrerID)
.Select(x =&gt; new FahrerligaEintrag()
{
    FahrerID = x.Key,
    FahrerFullName = string.Empty,
    VollgasKmAufHundertKm = (100m / x.Sum(y =&gt; y.BasisMeter)) * (x.Sum(y =&gt; y.Gas100ProzentInMeter.Value) + x.Sum(y =&gt; y.Gas90ProzentInMeter.Value)),
    LeerlaufInProzent = (100m / x.Sum(y =&gt; y.BasisSekunden)) * x.Sum(y =&gt; y.LeerlaufInSekunden.Value),
    VerbrauchLiterAufHundertKm = (100m / x.Sum(y =&gt; y.BasisMeter)) * x.Sum(y =&gt; y.VerbrauchInLiter.Value) * 1000,
    RollenKmAufHundertKm = (100m / x.Sum(y =&gt; y.BasisMeter)) * x.Sum(y =&gt; y.RollenInMeter.Value),
    TempomatKmAufHundertKm = (100m / x.Sum(y =&gt; y.BasisMeter)) * x.Sum(y =&gt; y.TempomatInMeter.Value),
    GeschwindigkeitsuebertretungenAnzahlAufHundertKm = (100m / x.Sum(y =&gt; y.BasisMeter)) * 1000 * x.Sum(y =&gt; y.UebertretungenAnzahl.Value),
    GangwechselAnzahlAufHundertKm = (100m / x.Sum(y =&gt; y.BasisMeter)) * 1000 * x.Sum(y =&gt; y.GangwechselAnzahl.Value)
});
</code></pre>

<p>As you can see this part is repeated several times <strong>(100m / x.Sum(y => y.BasisMeter))</strong>.</p>

<p>In Linq to Objects it feels naturally to first project into an anonymous class to calculate the factor to avoid repetitive calculations. Like this:</p>

<pre><code>.GroupBy(x =&gt; x.FahrerID)
.Select(x =&gt; new
{
    Grouping = x,
    BasisMeterFaktor = 100m / x.Sum(y =&gt; y.BasisMeter),
    BasisSekundenFaktor = 100m /x.Sum(y =&gt; y.BasisSekunden)
})
.Select(x =&gt; new FahrerligaEintrag()
{
    FahrerID = x.Grouping.Key,
    FahrerFullName = string.Empty,
    VollgasKmAufHundertKm = x.BasisMeterFaktor * (x.Grouping.Sum(y =&gt; y.Gas100ProzentInMeter.Value) + x.Grouping.Sum(y =&gt; y.Gas90ProzentInMeter.Value)),
    LeerlaufInProzent = x.BasisSekundenFaktor * x.Grouping.Sum(y =&gt; y.LeerlaufInSekunden.Value),
    VerbrauchLiterAufHundertKm = x.BasisMeterFaktor * x.Grouping.Sum(y =&gt; y.VerbrauchInLiter.Value) * 1000,
    RollenKmAufHundertKm = x.BasisMeterFaktor * x.Grouping.Sum(y =&gt; y.RollenInMeter.Value),
    TempomatKmAufHundertKm = x.BasisMeterFaktor * x.Grouping.Sum(y =&gt; y.TempomatInMeter.Value),
    GeschwindigkeitsuebertretungenAnzahlAufHundertKm = x.BasisMeterFaktor * 1000 * x.Grouping.Sum(y =&gt; y.UebertretungenAnzahl.Value),
    GangwechselAnzahlAufHundertKm = x.BasisMeterFaktor * 1000 * x.Grouping.Sum(y =&gt; y.GangwechselAnzahl.Value)
});
</code></pre>

<p>However, in LinqToEntities this results in poor performing SQL code. At least with this Oracle backend that I use (and which I can't profile to actually show me the SQL). So, I wonder if there is another way to avoid the repetitive calculations or if this is just the fastest that I can get.</p>

<p>Excuse all those German variable names. I'm sure you still get the meaning.</p>

<p><strong>UPDATE</strong></p>

<p>I was able to use ToTraceString() as suggested. Interestingly with the projection the SQL contains 18 (!!!) SELECT statements. Without it, it contains only 2. </p>
","<c#><linq><entity-framework><linq-to-entities><refactoring>","3","97","2011-11-17 12:27:10"
"8173727","cleaning repeated code that uses return","<p>I have many functions (<code>funcOne, funcTwo, etc.</code>), all of them share the same block of checks at the beginning (I want to move those blocks to a separate function or something so I'm not repeating code, but the problem is that I use return. Please read on)</p>

<ul>
<li>If any of these checks fail, I output a specific message that this specific check failed, and return (so the actual code of the function doesn't execute)</li>
<li>If all checks pass, the function continues to the specific code of the function.</li>
</ul>

<p>What I want to do is move those checks to a separate function. But the problem is that I'm using <code>return;</code> which would return out of the new function, but wouldn't return from <code>funcOne and funcTwo</code>. Can someone help me refactor this code so I don't have to repeat the duplicate checks in every function that uses them.  </p>

<blockquote>
<pre><code>protected function funcOne(event:MouseEvent):void
{
   if( check 1 doesn't pass){
      Alert.show(""error 1, returning);
      return;
   }
   if( check 2 doesn't pass){
      Alert.show(""error 2, returning);
      return;
   }
   .... more checks here, all of them return specific messages 

   //if all checks pass
   //execute the specific code of this funcOne
}
protected function funcTwo(event:MouseEvent):void
{
   if( check 1 doesn't pass){
      Alert.show(""error 1, returning);
      return;
   }
   if( check 2 doesn't pass){
      Alert.show(""error 2, returning);
      return;
   }
   .... more checks here, all of them return specific messages 

   //if all checks pass
   //execute the specific code of this funcTwo
}
</code></pre>
</blockquote>
","<flex><actionscript><refactoring>","1","41","2011-11-17 20:21:04"
"8177562","How to change a Lift project root package?","<p>A standard ""Symply Lift"" RestHelper <a href=""http://simply.liftweb.net/index-5.3.html"" rel=""nofollow"">example</a> project features <code>code</code>, <code>code.lib</code> and <code>code.model</code> and <code>bootstrap.liftweb.Boot</code> namespaces. I've changed those to <code>mycompany.myproject.code</code> e t.c. Now the project compiles ok and Jetty starts just fine but I get <code>The Requested URL /my/url was not found on this server</code> error when I try to access what used to work just fine before the refactoring. What may I have forgotten to change? How should I change the packages names safely?</p>

<p>Changing <code>LiftRules.addToPackages(""code"")</code> to <code>LiftRules.addToPackages(""mycompany.myproject.code"")</code> doesn't help.</p>

<p>UPDATE: I've found out that the problem was caused by the fact I've moved <code>bootstrap.liftweb.Boot</code> to <code>mycompany.myproject.bootstrap.liftweb.Boot</code>. I've moved it back and it is up and working again. But I am still curious how can I customize <code>bootstrap.liftweb</code> location as <code>bootstrap.liftweb.Boot</code> class differs from project to project and I don't want all of them to have the same full name.</p>
","<scala><namespaces><refactoring><lift>","5","101","2011-11-18 03:52:53"
"8185155","Tips on refactoring/optimising a chunk of jQuery code","<p>I'm building a little ""walkthrough"" type guide with tooltips using jquery. </p>

<p>When the page loads, a section of the page will have a tool tip saying ""step 1"" next to it and when they click on the required area, that disapears and ""step 2"" will appear further down the page. </p>

<p>My code works but I'm just looking for advice on how to improve and optimise what I've written or perhaps a way of simplifying the entire process. I've already tried using variables in places like the $('.helpTip') selector but I believe i'll have to then define that var within each click function which is a bit pointless right?</p>

<p>Anyway, the code:</p>

<pre><code>$('.box1').append('&lt;div class=""helpTip""&gt;Step 1. &lt;span&gt;text&lt;/span&gt;&lt;/div&gt;');

$('.box1 li').click(function() {
    $('.helpTip').fadeOut().remove();
    $('.box2').append('&lt;div class=""helpTip""&gt;Step 2. &lt;span&gt;text&lt;/span&gt;&lt;/div&gt;');
});

$('.box2 p').click(function() {
    $('.helpTip').fadeOut().remove();
    $('.box3').append('&lt;div class=""helpTip""&gt;Step 3. &lt;span&gt;text&lt;/span&gt;&lt;/div&gt;');
});

$('.box3 div').click(function() {
    $('.helpTip').fadeOut().remove();
    $('.box4').append('&lt;div class=""helpTip""&gt;Step 4. &lt;span&gt;text&lt;/span&gt;&lt;/div&gt;');
});

$('.box4 div').click(function() {
    $('.helpTip').fadeOut().remove();
    $('.box5').append('&lt;div class=""helpTip""&gt;Step 5. &lt;span&gt;text&lt;/span&gt;&lt;/div&gt;');
});

$('.box5').click(function() {
    $('.helpTip').fadeOut().remove();
    // Do something to the submit button?
});
</code></pre>

<p>HTML if it helps:</p>

<pre><code>&lt;!-- Step 1 --&gt;
&lt;div class=""formWrap""&gt;  
    &lt;div class=""formInner""&gt;
        &lt;div class=""formHeader""&gt;
            &lt;h3&gt;1. &lt;/h3&gt;
        &lt;/div&gt;
        &lt;div class=""box1""&gt;

        &lt;/div&gt;
    &lt;/div&gt;                      
&lt;/div&gt;

&lt;!-- Step 2 --&gt;
&lt;div class=""formWrap""&gt;
    &lt;div class=""formInner""&gt;
        &lt;div class=""box2""&gt;

        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;                  

&lt;!-- Step 3 --&gt;
&lt;div class=""formWrap""&gt;
    &lt;div class=""formInner""&gt;
        &lt;h3 class=""formHeader""&gt;3. &lt;/h3&gt;
        &lt;div class=""box3""&gt;

        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;  

&lt;!-- Step 4 --&gt;
&lt;div class=""formWrap""&gt;
    &lt;div class=""formInner""&gt;
        &lt;h3 class=""formHeader""&gt;4. &lt;/h3&gt;
        &lt;div class=""box4""&gt;


        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Step 5 --&gt;
&lt;div class=""formWrap""&gt;
    &lt;div class=""formInner""&gt;
        &lt;h3 class=""formHeader""&gt;5. &lt;/h3&gt;
        &lt;div class=""box5""&gt;

        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;  
</code></pre>
","<jquery><optimization><refactoring>","0","111","2011-11-18 15:55:27"
"8185758","WindowsBuilder, is it possible to generate tidy code?","<p>im using WindowsBuilder with Eclipse INDIGO .. the code generated by the WYSIWYG is not suitable for me , all the swing componentes are generated on the constructor! i want code to be extracted like this:</p>

<pre><code>    private MiJPanel getPanel(){
    if(panel == null) {
        panel = new MiJPanel();
        panel.setBorder(new EmptyBorder(5, 5, 5, 5));
        panel.setImagen(""/recursos/fondo2.jpg"");
        panel.setLayout(null);
        panel.add(getLblUsuario());
        panel.add(getLblClave());
        panel.add(getCmbJugadores());
        panel.add(getPwdClave());
        panel.add(getBtnEntrar());
    }
    return panel;
}
</code></pre>

<p>Every component with a ""singleton"" function that creates the componente and returns it, that make's the code way better and clear to work with on complex project's.</p>

<p>Is this possible ?</p>
","<java><eclipse><swing><refactoring><code-generation>","1","64","2011-11-18 16:39:33"
"8186077","Can I make Eclipse change my comments when I rename my classes?","<p>I am using the refactor rename tool in Eclipse to change my class names, but can I make it change those names in my comments at the same time? I heard it was possible, but my Eclipse doesn't bring up the prompt to ask if I want references in my comments to be changed when I rename the class. Please let me know, thanks.</p>
","<eclipse><class><refactoring><comments><rename>","1","41","2011-11-18 17:01:44"
"8195498","Why Should I Re-Factor my Code?","<p>If I've written a piece of code which is maybe a bit simplistic but I understand how every little bit works and if something goes wrong I can easily identify and correct the problem, why should I use a tool like ReSharper to turn my code into something I don't understand?</p>

<p>Surely if you can't write the complicated code yourself, using a code refactoring tool is just going to cause issues because you won't be able to understand the new code when something goes wrong, and if you can write the refactored code manually why do you need the tool?</p>

<p>Or is there something I'm missing?</p>

<p>Thanks</p>
","<oop><refactoring>","0","114","2011-11-19 16:36:08"
"8204440","Spaghetti code, dealing with exception handling and errors?","<p>I'm writing a wrapper for online translation services. Currently the <code>OnlineTranslator</code> class looks really ugly to me, like spaghetti code. It's because exception generation for many errors that can occur in the underline service (Bing, actually).</p>

<p>I'm not so good in understanding how dealing with exceptions and errors. Any change to refactor my code (who said patterns?)? How to get rid of so many <code>if</code> in the code?</p>

<pre><code>&lt;?php
namespace DL\AdminBundle\Service;

class OnlineTranslator
{

    private $_service;
    private $_languages;
    private $_from;
    private $_to;

    private $_ERRORS = array(
        'UNSUPPORTED_DETECTION' =&gt; ""'%s' service doesn't support language
            detection. Manually call 'setFrom' to set the source language."",
        'UNSUPPORTED_FROM_LANGUAGE' =&gt; ""Source language code '%s' unrecognized
            or not supported by this service."",
        'UNSUPPORTED_TO_LANGUAGE' =&gt; ""Destination language code '%s'
            unrecognized or not supported by this service."",
        'MISSING_TO_LANGUAGE' =&gt; ""Destination language code is missing."",
        'GENERIC_SERVICE_ERROR' =&gt; ""'%s' service returned an error: %s.""
    );

    function __construct(IOnlineTranslator $service)
    {

        // Imposta il servizio e la lingua sorgente su auto
        $this-&gt;_service = $service;
        $this-&gt;_from = 'auto';

        $response = $this-&gt;_service-&gt;getLanguages();

        if ($response-&gt;error)
            throw new Exception(sprintf(
                $this-&gt;_ERRORS['GENERIC_SERVICE_ERROR'],
                $this-&gt;_service-&gt;getName(), $response-&gt;data));

        $this-&gt;_languages = $response-&gt;data;

    }

    function setFrom($languageCode)
    {

        // Controlla se la lingua è supportata
        if (!in_array($languageCode, $this-&gt;_languages))
            throw new Exception(sprintf(
                $this-&gt;_ERRORS['UNSUPPORTED_FROM_LANGUAGE'],
                $languageCode));

        // Imposta la lingua sorgente
        $this-&gt;_from = $languageCode;

    }

    function setTo($languageCode)
    {

        // Controlla se la lingua è supportata
        if (!in_array($languageCode, $this-&gt;_languages))
            throw new Exception(sprintf(
                $this-&gt;_ERRORS['UNSUPPORTED_TO_LANGUAGE'],
                $languageCode));

        // Imposta la lingua destinazione
        $this-&gt;_to = $languageCode;

    }

    function translate($text)
    {

        // Controlla che sia impostata la lingua di destinazione
        if (!isset($this-&gt;_to))
            throw new Exception($this-&gt;_ERRORS['MISSING_TO_LANGUAGE']);

        // Se detect è auto controlla che il servizio lo supporti
        if ('auto' == $this-&gt;_from &amp;&amp; !$this-&gt;_service-&gt;isDetectAware())
            throw new Exception(sprintf(
                $this-&gt;_ERRORS['UNSUPPORTED_DETECTION'],
                $this-&gt;_service-&gt;getName()));

        // Imposta la lingua sorgente chiamando il metodo detect
        $response = $this-&gt;_service-&gt;detect($text);

        if ($response-&gt;error)
            throw new Exception(sprintf(
                $this-&gt;_ERRORS['GENERIC_SERVICE_ERROR'],
                $this-&gt;_service-&gt;getName(), $response-&gt;data));

        $this-&gt;_from = $response-&gt;data;

        // Traduci il testo chiamando il metodo translate
        $response = $this-&gt;_service-&gt;translate($text, $this-&gt;_from,
            $this-&gt;_to);

        if ($response-&gt;error)
            throw new Exception(sprintf(
                $this-&gt;_ERRORS['GENERIC_SERVICE_ERROR'],
                $this-&gt;_service-&gt;getName(), $response-&gt;data));

        return $response-&gt;data;

    }

}

?&gt;
</code></pre>
","<php><php5><design-patterns><exception-handling><refactoring>","0","113","2011-11-20 20:24:28"
"8206034","drupal 7. how to refactor a form array","<p>I am creating a wizard from the Drupal example file and would like to refactor the segments of code that are repeated when setting up items like options and radios.</p>

<p>I have already tried a simple function passing ""ordinary"" and ""preferential"" but can't find a way to make it work.</p>

<p>Can someone give me an idea of the best way to do this?</p>

<p>unfactored code is as below:</p>

<pre><code>function services_wizard_share_capital_classes($form, &amp;$form_state) {

$form['share_classes']['type_of_class'] = array(
'#type' =&gt; 'select',
'#title' =&gt; t('What type of share will this class be?'),
'#options' =&gt; array(
  1 =&gt; t('Ordinary'),
  2 =&gt; t('Preferential'),
),
);

$form['ordinary']['share_type'] = array(
'#type' =&gt; 'item',
'#description' =&gt; t(""You chose Ordinary Shares""),
'#states' =&gt; array(
  'visible' =&gt; array(
    ':input[name=""type_of_class""]' =&gt; array('value' =&gt; '1'),
  ),
),
);

$form['preferential']['share_type'] = array(
'#type' =&gt; 'item',
'#description' =&gt; t(""You chose Preferential Shares""),
'#states' =&gt; array(
  'visible' =&gt; array(
    ':input[name=""type_of_class""]' =&gt; array('value' =&gt; '2'),
  ),
),
);
return $form;
}
</code></pre>
","<drupal><refactoring>","0","33","2011-11-21 00:31:41"
"8221236","Automatically generate imports, to disentangle one method from a module","<p>I'm working on a huge Python module, like this:</p>

<pre><code>import millions, and, billions, of, modules...

...lots of functions...

def myfunc
   ...with huge body

...more functions
</code></pre>

<p>I'd like to extract myfunc to its own module. However, tracking down all the imports I need is actually pretty tedious. Is there a way to do this automatically using Eclipse? I'm using Eclipse 3.7.0 with Aptana Studio plugin (and hence PyDev). There's an ""extract method"" refactoring tool, but it doesn't do this.</p>
","<python><module><refactoring><aptana><pydev>","0","47","2011-11-22 02:28:37"
"8222900","Eclipse: Extract Method feature fails","<p>For better readability of a lengthy method, I'd like to replace a repeatedly used block of code (only assignments) with a method. I therefore selected the block of code and ran Eclipse's <em>Extract Method</em> feature, but that failed with this error:</p>

<blockquote>
  <p>Ambiguous return value: Selected block containsmore than one assignment to local variables. Affacted variables are:</p>

<pre><code>int foo
double[] bar
</code></pre>
</blockquote>

<p>How can I fix this? It should be a simple <code>void</code> method doing a couple of assignments, I'm not sure what Eclipse (3.6.2) complains about.</p>
","<java><eclipse><refactoring>","0","103","2011-11-22 06:34:37"
"8231697","What is the best procedure to refactor an iOS app into a framework and a test app?","<p>I have an app that I've been using to develop some ideas that now seem to belong into a reusable framework (a lib). The whole thing is in a local git repo. I've lots of classes that belong to a lib and a some other classes that use them and present views for testing. </p>

<p>I want to move out the test code and leave a library and a separate app for testing. Have you done this? Do you have stumbled into something specific? Any advise?</p>

<p>Of course I could just move everything piecewise into different projects but I'd like to evolve the thing so I don't lose my GIT history and everything is seamless..</p>
","<ios><git><frameworks><refactoring>","0","41","2011-11-22 18:18:43"
"8238492","Automatic refactoring","<p>Please suggest a tool that could automate replacing like:</p>

<pre><code>Mutex staticMutex = Mutex(m_StaticMutex.Handle());
staticMutex.Wait();
</code></pre>

<p>to</p>

<pre><code>boost::unique_lock&lt;boost::mutex&gt; lock(m_StaticMutex);
</code></pre>

<p>As you see, the arguments must be taken into account. Is there a way simpler than regular expressions?</p>
","<c++><refactoring>","2","107","2011-11-23 07:18:52"
"8239152","How to write this query string in better way?","<p>I see an line of our code base in JavaScript to construct a query string:</p>

<pre><code>    var queryParameters = ""imagePath="" + encodeURIComponent(_image.source) + ""&amp;saveMode="" + saveMode + ""&amp;pageFolderId="" + pageFolderId + ""&amp;id="" + pageId + ""&amp;parent="" + parent;
    queryParameters += ""&amp;quality="" + sQuality.value + ""&amp;commands="" + commandQueue.Serialize();
</code></pre>

<p>is there a better way to write this?</p>
","<javascript><refactoring><query-string>","0","143","2011-11-23 08:34:42"
"8242377","Tool for managing and refactoring java .properties files","<p>Is there any tool for managing java .properties files that is able to:</p>

<ul>
<li>rename keys in .properties files along with their usage in .java and .jspx files (something like Eclipse's refactoring)</li>
<li>find keys that are used in .java and .jspx files but not present in a .propertis file</li>
<li>find keys from .properties files that are not used in .java and .jspx files</li>
<li>find duplicit key values?</li>
</ul>

<p>I have found the <a href=""http://blogs.oracle.com/tor/entry/useful_tools_bundlizer_removes_duplicate"" rel=""nofollow"">bundlizer tool</a>, but were not able to obtain it.</p>
","<java><tools><properties><refactoring>","4","121","2011-11-23 12:42:14"
"8232700","Refactor sharedpreference keys but preserve their values in Android","<p>I have released my app to the market and I'm preparing an update.</p>

<p>However, I wanted to refactor the key name of some shared preference but retain the current value on the user's device. Another thing is that I also want to delete the old key name (so the SharedPreferences file is not polluted with unnecessary keys.</p>

<p>How can I achieve this without any hassle to my users?</p>
","<android><refactoring><sharedpreferences>","0","63","2011-11-22 19:37:05"
"8246934","Refactoring advice - Ruby 101 - using multiple nested if-then's","<p>What the prescribed best practice for refactoring the following?</p>

<pre><code>def has_thing?
  if things and things[:something] and things[:something][:else] and things[:something][:else][:matters]
    return true
  else
    return false
  end
end
</code></pre>

<p>I basically want to return true if <code>things[:something][:else][:matters]</code> is not nil, but <code>return true if things[:something][:else][:matters]</code> fails when <code>things</code> is nil or... <code>things[:something]</code> is nil with e.g. <code>undefined method '[]' for nil:NilClass</code>.</p>

<p>I could wrap it all it a <code>begin...rescue..end</code> and return false if an exception is thrown, but that doesn't seem right either!</p>
","<ruby-on-rails><ruby><methods><refactoring><refactor-my-code>","0","158","2011-11-23 18:01:19"
"8248012","Rails: Verify correct user across multiple controllers","<p>I have several controllers that require a correct user for their edit/update/delete actions.  What is the Rails-way to accomplish the following:</p>

<p>Currently, in each controller I have the following code:</p>

<pre><code>class FooController &lt; ApplicationController
  before_filter :correct_user, :only =&gt; [:edit, :update, :destroy]

  # normal controller code

  private

  def correct_user
    @foo = Foo.find params[:id]
    redirect_to some_path unless current_user == @foo.user
  end
end
</code></pre>

<p>I have similar code in 3 controllers.  I started to bring it out to a helper like this:</p>

<pre><code>module ApplicationHelper
  def correct_user( object, path )
    if object.respond_to? :user
      redirect_to path unless object.user == current_user
  end
end
</code></pre>

<p>But I'm wondering if this is a good way to do it.  What's the accepted way to solve this?</p>

<p>Thank you</p>

<p><strong>EDIT</strong></p>

<p>The correct user check here is because I want to make sure it's only the author who can make edits/deltes to each of the objects.</p>

<p>To clarify, the objects would be things like Questions and Posts.  I don't want to use something like CanCan as it's overkill for something simple like this.</p>
","<ruby-on-rails><usercontrols><refactoring><controller>","0","65","2011-11-23 19:32:52"
"8248088","Refactoring view logic in Rails","<p>Here's what I need to do. I have a <code>Tournament</code> model, which is connected to <code>User</code> via <code>Signup</code> (N:N). </p>

<p>The only thing that <code>Signup</code> adds is status of the signup. Tournament has a start time, and users can register only until there is 60 minutes before the tournament starts. After that, registered users can check in. So basically I have two options for the state</p>

<p>In short, models looks like this</p>

<pre><code>class Signup &lt; ActiveRecord::Base
  REGISTERED = 0
  CHECKED = 1

  belongs_to :tournament
  belongs_to :user
end

class Tournament &lt; ActiveRecord::Base
  has_many :signups
  has_many :users, :through =&gt; :signups
end

class User &lt; ActiveRecord::Base  
  has_many :signups
  has_many :tournaments, :through =&gt; :signups
end
</code></pre>

<p>I skipped some code to keep this short. The problem is with the view, since I have a lot of conditions to keep in mind. Here's my actual code (<a href=""http://slim-lang.com/"" rel=""nofollow"">using Slim as a templating engine</a>)</p>

<pre><code>- if logged_in?
  - if current_user.registered_for?(@tournament)
    - if @tournament.starts_at &lt; 60.minutes.from_now
      p Signups are closed, only registered users can now check in
      - if current_user.registered_for?(@tournament)
        = button_to ""Checkin!"", { :controller =&gt; :signups, :action =&gt; :update, :id =&gt; @tournament.id }, :method =&gt; :put
    - else
      = button_to ""Cancel your registration for the tournament"", { :controller =&gt; :signups, :action =&gt; :destroy, :id =&gt; @tournament.id }, :method =&gt; :delete
  - elsif current_user.checked_in?(@tournament)
    p You have already checked in.            
  - elsif @tournament.starts_at &gt; 60.minutes.from_now
    = button_to ""Sign up for the tournament"", :controller =&gt; :signups, :action =&gt; :create, :method =&gt; :post, :id =&gt; @tournament.id
  - else
    p
      | The tournament starts in less than 60 minutes, you can't sign in
- else
  p 
    | You need to 
    |  
    = link_to ""log in"", login_path
    |  to play
</code></pre>

<p>The problem is, I have no idea how to make this much cleaner. I mean yes I can add helpers for buttons, but that won't help me with the <code>if if else else</code> ugliness, because there are many different combinations. Here's a short list:</p>

<ul>
<li>user isn't logged in</li>
<li>it's over 60 until the tournament starts and user hasn't yet registered for the tournament</li>
<li>it's over 60 until the tournament starts and user is already registered</li>
<li>it's under 60 minutes, but user isn't registered yet</li>
<li>it's under 60 minutes and user is registered but hasn't checked in</li>
<li>it's under 60 minutes and user already checked in</li>
</ul>

<p>And this is just the tip of the iceberg, because admins should see more information than a regular user, but I don't want to complicate this question.</p>

<p>The main problem is, how should I handle cases like this? It just seems so terrible to do this in a view, but I don't see any other simpler way.</p>
","<ruby-on-rails><ruby><coding-style><view><refactoring>","0","98","2011-11-23 19:39:21"
"8255877","Refactor Ruby on Rails snippets","<p>Association between <code>Account</code> and <code>user</code> is one to many
<code>Account has many Users</code></p>

<p>I need to do something in account model method which needs user object.</p>

<p>Right now, I'm doing like:</p>

<p><code>User.first.account.get_something(User.first)</code></p>

<p>But It doesn't seems to be good practice.</p>

<p>How could I refactor above.</p>
","<ruby><refactoring><ruby-on-rails-3.1>","0","55","2011-11-24 10:54:07"
"8263284","Is there a C# refactoring tool that can convert all declarations to fully qualified types?","<p>Here's what needs to be done.</p>

<p>Let's imagine you have the following piece of C# code:</p>

<pre><code>private Int32 DoSomething(Int32 number, String message) 
{
    StringBuilder stringBuilder = null;
    Regex regex = null;
    // code goes here
}
</code></pre>

<p>This will need to become:</p>

<pre><code>private System.Int32 DoSomething(System.Int32 number, System.String message) 
{
    System.Text.StringBuilder stringBuilder = null;
    System.Text.RegularExpressions.Regex regex = null;

    // code goes here
}
</code></pre>

<p>I've found tools that do the opposite (e.g. ReSharper), but the types absolutely need to be fully-qualified, not just consistent.</p>
","<c#><.net><types><refactoring>","1","141","2011-11-24 23:03:26"
"8263752","Code simplification using Func type instead of Action in Silverlight","<p>is it possible to refactor this code by using Func type instead of Action?
what I'd like is to get rid of the extra Class (CalcParams) used to return the value with the Action callback.</p>

<p>Edit:
*Note:The download method or Func should be public;</p>

<p>all your help will be very appreciated.</p>

<pre><code>public class CalcParams
{
    public int CallID;
    public int Result;
    public Action&lt;int, int&gt; CallbackDone;
    public CalcParams(int callid, Action&lt;int, int&gt; callback)
    {
        CallID = callid;
        CallbackDone = callback;
    }
}
public partial class MainPage : UserControl
{
    int rand;
    public MainPage()
    {
        InitializeComponent();
        rand = 0;
    }
    public void DownloadDataInBackground(CalcParams calcparams)
    {
        WebClient client = new WebClient();
        Uri uri = new Uri(string.Format(""https://www.google.com/search?q={0}"", calcparams.CallID));
        client.DownloadStringCompleted += (s, e) =&gt;
        {
            CalcParams localparams = (CalcParams)e.UserState;
            localparams.CallbackDone(localparams.CallID, e.Result.Length);
        };
        client.DownloadStringAsync(uri, calcparams);
    }

    private void button1_Click(object sender, RoutedEventArgs e)
    {
        int callid = rand++;
        Debug.WriteLine(""Executing CallID #{0}"", callid);
        DownloadDataInBackground(new CalcParams(callid, (c, r) =&gt;
        {
            Debug.WriteLine(""The result for the callid {0} is {1}"", c, r);
        }));
        callid = 0;
    }
}
</code></pre>
","<c#><silverlight><asynchronous><refactoring>","1","144","2011-11-25 00:28:29"
"8274017","Feeling a code smell. Better way to handle parent & child creation via controller?","<p>I'm working on an internal tool. Here are the three main models im working with:</p>

<pre><code>Site
  has_many Document
    has_many Version
</code></pre>

<p>The document model essentially stores a body of content. What I want to do is setup document versioning with the Version model. So the version would store the content. </p>

<p>Right now, I create a new document via the nested URL: POST /sites/:id/documents. Since the form is there, and I have no plans on changing the user experience here, I started building it to use both the Document and Version models. However, I'm starting to feel like this is wrong. Managing validations from a child object and pushing them up to the parent is becoming a pain.</p>

<p><strong>Another note:</strong></p>

<p>The Document has an integer field called active_version_id. It stores the version that is currently the active one of that document. I then use that ID to get the version model, to show the main content connected to that document. I set it to the version created when a document is created.</p>

<p><strong>What i want to do</strong></p>

<p>In short, here's the workflow I would expect:</p>

<ol>
<li>Goes to create new document</li>
<li>Puts in the content</li>
<li>Submits the form</li>
<li>Parent Document is created.</li>
<li>Using the parent document, it creates a new version. Any validation errors on the content at the version level should prevent the save of both models.</li>
<li>Errors from the version object should show up on the page, so the user knows.</li>
</ol>

<p>Here's my Version model, so you can see the validation logic. It basically checks if the headers in the document are valid (which is just some identification text). And that the headers aren't used in versions of any other document in that site:</p>

<pre><code>def document_is_in_valid_format
  p = CopyProcess::Processor.new
  if !p.contains_valid_headers(self.content)
    Rails.logger.debug ""Headers invalid.""
    msg = ""Content headers must be in valid format.""
    self.document.errors[:base] &lt;&lt; msg
    self.errors[:base] &lt;&lt; msg
  else
    # Check that headers are unique to the parent document
    headers = content.split(/\n/)[1..3].join(' - ').gsub(/\/\*|\\\*/,'')
    site_documents = []
    # get all documents where it's not this one's parent
    if self.id
      site_documents = Document.where([""site_id = ? AND id &lt;&gt; ?"", self.site_id, self.document_id])
    else
      site_documents = Document.where([""site_id = ?"", self.site_id])
    end
    site_documents.includes(:versions)
    site_documents.each do |doc|
      if doc.version_names.include?(headers)
        msg = ""Content headers are not unique.""
        self.document.errors[:base] &lt;&lt; msg
        self.errors[:base] &lt;&lt; msg
        break
      end
    end
  end
end
</code></pre>

<p>I'm wondering if the solution here might be to use a nested form for. For step 5, i imagine a transaction would help prevent both saves.</p>
","<ruby-on-rails><refactoring>","1","65","2011-11-25 20:40:26"
"8272423","Verify patch consists of only moves","<p>I have been reorganizing some code and would like to use a program to verify that the diff consists of only matching pairs of additions and deletions.  I am using git as source control so hopefully there is something built into git that can do this for me?  It would also be very useful if it could summarize lines that have either appeared or dissapeared</p>

<hr>

<p>Does anybody know if there is such a tool?</p>
","<git><version-control><refactoring><diff><git-diff>","1","43","2011-11-25 17:26:28"
"8284323","How do I refactor these conditionals in my ruby class?","<p>Here is my method. It checks if the file is usable. How do I dry this out?</p>

<pre><code>@@filepath = nil

def self.file_usable?
  return false unless @@filepath
  return false unless File.exists?(@@filepath)
  return false unless File.readable?(@@filepath)
  return false unless File.writable?(@@filepath)
  return true
end
</code></pre>

<p>Should I be using some kind of loop?</p>
","<ruby><refactoring>","3","110","2011-11-27 07:55:47"
"8285611","Clojure, assoc in Okasaki trie using recur","<p>I naively implemented the trie from Okasaki's book ""Purely Functional Data Structures"" in Clojure. Just for learning purposes, because probably there is no real gain, since Clojure used a more efficient trie under the hood of normal maps, right? There is one thing that still bothers me about it: trie-assoc doesn't use <code>recur</code>. How could I refactor it so it only does a recursive call on the tail using <code>recur</code>? I have the feeling I could use zippers for this, but I haven't looked into zippers that much yet.
One other thing that maybe could be improved is the (if (empty? key) ...) followed by a destructuring on key. Could this be more concise?</p>

<pre><code>(ns okasaki-trie.core)

(def empty-trie {:value nil :nodes nil})

(defn trie-get [key trie]
  (if (empty? key) (get trie :value)
      (let [[k &amp; ks] key]
        (recur ks (get-in trie [:nodes k])))))

(defn trie-assoc [key val trie]
  (if (empty? key) (assoc trie :value val) 
      (let [[k &amp; ks] key
            sub-trie-k (or (get-in trie [:nodes k]) empty-trie)
            sub-trie-k-new (trie-assoc ks val sub-trie-k)]
        (assoc-in trie [:nodes k] sub-trie-k-new))))

;;(def first-trie (trie-assoc ""a"" 3 empty-trie))
;;first-trie =&gt; {:nodes {\a {:nodes nil, :value 3}}, :value nil}

;;(def second-trie (trie-assoc ""ab"" 5 first-trie))
;;second-trie =&gt; {:nodes {\a {:nodes {\b {:nodes nil, :value 5}},
;;:value 3}}, :value nil}

;;(def third-trie (trie-assoc ""b"" 2 second-trie))
;;third-trie  =&gt; {:nodes {\b {:nodes nil, :value 2}, \a {:nodes {\b
;;{:nodes nil, :value 5}}, :value 3}}, :value nil}

;;(trie-get ""b"" third-trie)  ;=&gt; 2
;;(trie-get ""ab"" third-trie) ;=&gt; 5
;;(trie-get ""abc"" third-trie)  ;=&gt; nil
</code></pre>
","<clojure><refactoring>","3","159","2011-11-27 12:40:39"
"8286766","How to simplify the code for settings values passed between a main and child forms","<p>I have a class that stores settings for my app. It is instantiated when the app. runs and saved when the app. closes.</p>

<pre><code>public class Settings
{
    public bool showPrivacyPageOnBlogs;
    public bool showTermsPageOnBlogs;
    public bool showDisclosurePageOnBlogs;
}
</code></pre>

<p>And there is a popup window that displays check boxes to set these values using public properties of the popup window.</p>

<p>The code to handle the popup window is like:</p>

<pre><code>// Horrible code ahead
private void pagesSettingsToolStripMenuItem1_Click(object sender, EventArgs e)
{
    pagesSettingsForm.showPrivacyPageOnBlogs = settings.showPrivacyPageOnBlogs;
    pagesSettingsForm.showTermsPageOnBlogs = settings.showTermsPageOnBlogs;
    pagesSettingsForm.showDisclosurePageOnBlogs = settings.showDisclosurePageOnBlogs;
    if (pagesSettingsForm.ShowDialog() == DialogResult.OK)
    {
        settings.showPrivacyPageOnBlogs = pagesSettingsForm.showPrivacyPageOnBlogs;
        settings.showTermsPageOnBlogs = pagesSettingsForm.showTermsPageOnBlogs;
        settings.showDisclosurePageOnBlogs = pagesSettingsForm.showDisclosurePageOnBlogs;
    }
    pagesSettingsForm.Dispose();
}
</code></pre>

<p>In my app. there are several more parameters being handled in this way so I would like to know if there is some way to simplify this code to maybe enumerate the names of the settings and allow for future addition of additional parameters.</p>
","<c#><.net><winforms><refactoring><childwindow>","3","70","2011-11-27 15:48:37"
"8286834","Refactor - UnitTest - Design Trilemma in Legacy Code","<p>How do you tackle this problem when you are dealing with legacy code </p>

<ul>
<li>Classes you deal with is not well designed, requires some serious design changes</li>
<li>Classes you deal with mostly tightly coupled </li>
<li>You don't have enough unit tests to do refactoring much</li>
<li>You don't add new unit tests because design is bad and you are going to change it anyway</li>
<li>You can't change the design that easily because
<ul>
<li><em>Tight coupling, not enough unit tests</em> - stuff can really wrong as it requires a new design for multiple classes at the same time without any safety nets.</li>
</ul></li>
</ul>

<p>Where do you start? How do you attack to the problem?</p>
","<unit-testing><design><refactoring><legacy>","3","58","2011-11-27 15:59:49"
"8296579","Simplify if condition?","<p>I have this code:</p>

<pre><code>int someValue = 100;
if (x == 5)
{
    if (someCondition)
    {
        return someValue;
    }
    return someValue / 12;
}

if (x == 6)
{
     if (someCondition)
     {
         return someValue * 12;
     }
    return someValue;
}
</code></pre>

<p>As you see, <em>someCondition</em> is always the same, just the returned value differs. Is there a way to simplify this some more?</p>
","<c#><if-statement><refactoring>","4","188","2011-11-28 13:36:26"
"8302477","Looking to refactor Appsettings and HttpContext for unit test and moq","<p>I have looked at a lot of examples, but in this case I wish to get a fresh set of eyes on refactoring this method below so that I can unit test it.  I'm using mstest with moq and I know that the appsettings is a problem, along with the HttpContext being sealed....
Any help or thoughts (constructive) is greatly appreciated.</p>

<pre><code>   public void DoClaimSearch(SearchClaimInfo clmRequest)
    {
        var result = claimManager.ClaimSearch(clmRequest);
        if (result.RespMsg.TotalRowCount &gt; Convert.ToInt32(ConfigurationManager.AppSettings.Get(""TotalRowCount_Max_ClaimSearch"")))
        {
            string ResKey = HttpContext.GetGlobalResourceObject(""Global"", ""info_toomanyrecordsmatch.Text"").ToString();
            ResKey = ResKey.Replace(""{0}"", result.RespMsg.TotalRowCount.ToString());
            View.AddNotification(WidgetNotificationType.Error,ResKey);
        }
        else
        {
            View.SetWidgetResponseData(result.RespMsg.SearchResults);
        }
    }
</code></pre>
","<unit-testing><refactoring><moq><mstest>","0","86","2011-11-28 21:20:31"
"8310616","Identifying unused classes / controls / pages","<p>We have a 10+ years old ASP.NET website project, with lots of unused / legacy user controls and pages.</p>

<p>Is there a tool which can assist in the process of identifying these elements of the solution, so we could refactor them out?</p>

<p>I know the issue is complicated because not all types are referenced as types which a compiler / tool might recognize. e.g. objects instantiated by reflection are instantiated using a string representing the class name. In addition asp.net pages are generally not referenced as types, but as page identifier strings in markup.</p>

<p>It still seems like someone would have created a tool which handles these cases and creates a candidate list of unused classes / pages / user controls</p>
","<c#><asp.net><refactoring>","4","180","2011-11-29 12:23:34"
"8327785","What algorithms can analyse call dependencies for library fission?","<p>Suppose I have a library which contains a bunch of interdependent functions, this library is too big and I want to split it up. What algorithms are there to find suitable partitions?</p>

<p>Simple example, there are four functions in it: alpha, beta, gamma, and delta.</p>

<ul>
<li>beta and gamma both call delta.</li>
<li>module1 calls alpha and beta.</li>
<li>module2 calls gamma.</li>
<li>module3 calls alpha, beta, and gamma.</li>
</ul>

<p>The output of the algorithm could be:</p>

<ul>
<li>LibA contains (alpha,beta)</li>
<li>LibB contains (gamma)</li>
<li>LibC contains (delta)</li>
<li>module1 depends on LibA</li>
<li>module2 depends on LibB</li>
<li>module3 depends on LibA and LibB</li>
<li>LibA depends on LibC</li>
<li>LibB depends on LibC</li>
</ul>

<p>i.e. it finds the most-finely-grained Lib* partition with the following property</p>

<blockquote>
  <p>For all X, if LibX is partitioned by any method into LibY and LibZ then all modules/libraries which depend on LibY also depend on LibZ and vice-versa.</p>
</blockquote>

<p>Is there a standard solution for this?</p>
","<library><refactoring><dependency-analysis>","3","102","2011-11-30 14:51:00"
"8334507","How could I refactor this part of my windows phone app","<p>Im not very familiar with refactoring but I feel like I need to do some changes in this code...
<br/>
<br/>
I have 4 buttons in my app. Each one calls an method that receives data from an online xml and use this data to populate a listbox.
<br>
<br/>
I kept myself repeating code for all those methods, although I see they differ sometimes.
<br/>
<br/>
Here is a little explanation of my logic:
<br> The buttons btnA_Click and btnB_Click get the same data, but from differente years.
<br/> The same goes for the other 2 buttons. They get the same data(not the same as btnA 
and btnB) but from different years too.
<br/></p>

<p>Buttons:</p>

<pre><code>private void btnA_Click(object sender, RoutedEventArgs e)
    {
        string webService = @""xml from the web"";
        table.OpenReadAsync(new Uri(webService));
        btnA.IsEnabled = false;
        btnB.IsEnabled = false;
        progressBar1.Visibility = System.Windows.Visibility.Visible;
    }

private void btnB_Click(object sender, RoutedEventArgs e)
    {
        string webService = @""xml from the net"";
        table.OpenReadAsync(new Uri(webService));
        btnA.IsEnabled = false;
        btnB.IsEnabled = false;
        progressBar1.Visibility = System.Windows.Visibility.Visible;
    }

private void btnSTA_Click(object sender, RoutedEventArgs e)
    {
        string webService = @""xml from the web;
        stats.OpenReadAsync(new Uri(webService));
        btnSTA.IsEnabled = false;
        btnSTB.IsEnabled = false;
        progressBar3.Visibility = System.Windows.Visibility.Visible;
    }

private void btnSTB_Click(object sender, RoutedEventArgs e)
    {
        string webService = @""xml from the web;
        stats.OpenReadAsync(new Uri(webService));
        btnSTA.IsEnabled = false;
        btnSTB.IsEnabled = false;
        progressBar3.Visibility = System.Windows.Visibility.Visible;
    }
</code></pre>

<p><br/>
Methods:</p>

<pre><code>void table_OpenReadCompleted(object sender, OpenReadCompletedEventArgs e)
    {
        if (e.Error == null &amp;&amp; !e.Cancelled)
        {
            XElement xml = XElement.Load(e.Result);
            var table = LINQ Statement...
            listBox1.ItemsSource = table;
            btnClassificacaoSerieA.IsEnabled = true;
            btnClassificacaoSerieB.IsEnabled = true;
            progressBar1.Visibility = System.Windows.Visibility.Collapsed;
        }
    }

void stats_OpenReadCompleted(object sender, OpenReadCompletedEventArgs e)
    {
        if (e.Error == null &amp;&amp; !e.Cancelled)
        {
            XElement xml = XElement.Load(e.Result);
            var stats = LINQ Statement...
            listBox3.ItemsSource = stats;
            btnSTA.IsEnabled = true;
            btnSTB.IsEnabled = true;
            progressBar3.Visibility = System.Windows.Visibility.Collapsed;
        }
    }
</code></pre>

<p>Im a little lost here. What could I do to make this code more Object Oriented?
<br/>
Thx!</p>
","<c#><oop><windows-phone-7><refactoring>","1","70","2011-11-30 23:27:45"
"8334794","Managing config files and code constants in a big project","<p>I'm working on a huge C# codebase (~300 KLOC). The components of the system use config files scattered across the folder hierarchy. Values that are read from config in one place are stored in a constant in another. There are several copies of the same config in different folders, copied and checked in once, and then never updated. Some files have 3 different versions, one for the developer machine, one for staging and another one for the live system. I have to clean up this horrible mess.  How should I start? What is an intelligent strategy to deal with duplicated values in different files, multiple copies of the same file and multiple versions for different build environments? How can I store everything in one place without creating a ""dependency magnet""?</p>
","<c#><configuration><refactoring><configuration-files><code-cleanup>","3","112","2011-11-30 23:56:21"
"8329442","Python refactoring: cleaning up imports","<p>This might be a newbie-type question (I came to python from PHP5 OO), but I have a few things I am uncertain about the <code>import</code> statement in trying to clean up and refactor some of our Python modules.</p>

<p>Let's say, for example, I have a db connection factory module that imports mysqldb and looks something like this:</p>

<pre><code>import MySQLdb as mysql
from MySQLdb import cursors
class ConnectionFactory():
  @staticmethod
  def connect(db_host,db_user,db_pass,db,cursor='DictCursor'):
    connection = mysql.connect(host = db_host,
                   user = db_user,
                   passwd = db_pass,
                   db = db,
                   cursorclass=getattr(mysql.cursors, cursor))
    cur = connection.cursor();
    connection.ping(True)
    return (cur,connection)
</code></pre>

<p>First, <strong>why is that second import, that explicitly grabs <code>cursors</code> necessary?</strong>  I can't seem to just access mysql.cursors without it.</p>

<p>Also, let's say another module imports this one to get the db connection and then executes queries using it.</p>

<pre><code>import ConnectionFactory
def runquery(q):
  try:
    cur,connection = ConnectionFactory.connect(db_host,db_user,db_pass,db)
    cur.execute(q)
    res = cur.fetchall()
    return res
  except Exception as e:
    log(str(e))
</code></pre>

<p>Ideally, that Exception that is being caught should be the MySQLdb.Error exception.  <strong>Does this mean that I need to import MySQLdb here too?</strong>  I assume there's a more elegant way of doing this.  I'm not thinking like a Pythonista, I'm sure.</p>

<p>Lastly, let's say both these modules were imported in another parent for use in a WSGI (I have everything coming in through Werkzeug, which then runs a ton of other methods in other modules)</p>

<p>If the WSGI imports both these modules, I assume the things they import individually aren't in its namespace.  <strong>Is it then bad practice to have the same imports across several modules, if ultimately they are going to be used together in one larger one?</strong></p>

<p><strong>EDIT</strong>: To clarify that third question,
I've got a special json encoder that's used literally all over the place as the <code>cls</code> arg for <code>json.dumps()</code></p>

<pre><code>from datetime import datetime
import gnengine
import json

class SpecialEncoder(json.JSONEncoder):
    def default(self,obj):
    if isinstance(obj,set):
        return list(obj)
    elif isinstance(obj,datetime):
        return obj.isoformat()
    elif isinstance(obj,gnengine.searchresult):
        return obj.jsonify()

    return json.JSONEncoder.default(self,obj)
</code></pre>

<p><code>gnengine</code> is my WSGI, and <code>searchresult</code> is a type found within that module.  I'm importing it here because it has its own json method that my encoder needs to expect.  But this encoder obviously is imported for use in <code>gnengine</code> as well.  They are essentially importing each other.</p>

<p>My PHP background tells me that this is all solved if the <code>searchresult</code> type becomes its own module that represents an object model and then both import that separately.  I'm not sure if this is a big misconception I have though.</p>

<p>Sorry for packaging three questions in one, essentially what I guess is being asked is a clarification about importing in general.  I get the namespacing and why <code>from name import *</code> is a bad idea, I just don't understand the best approach when several packages being used together all have similar dependencies.  Is it expected in python to have identical <code>import</code>s peppered throughout?</p>
","<python><import><refactoring>","1","93","2011-11-30 16:33:45"
"8347099","Refactor related conditionals without combining","<p>I have a pixel/location, we'll call it 4,4 on a graph.
I'm attempting to refactor a function that checks to see if pixels around it, meet a certain criteria, in all 8 directions (diagonally, horizontally, and vertically), and if it meets that criteria, take a common action, that has a return value.</p>

<p>For instance:</p>

<pre><code>int weight=0;
if (CheckWeight(new Point(4,4)) == true)
    weight +=100;
if (CheckWeight(new Point(4,5)) == true)
    weight +=10;
if (CheckWeight(new Point(4,3)) == true)
    weight +=10;
if (CheckWeight(new Point(5,5)) == true)
    weight +=10;
if (CheckWeight(new Point(3,3)) == true)
    weight +=10;
if (CheckWeight(new Point(3,4)) == true)
    weight +=10;
if (CheckWeight(new Point(5,4)) == true)
    weight +=10;
if (CheckWeight(new Point(5,3)) == true)
    weight +=10;
if (CheckWeight(new Point(3,5)) == true)
    weight +=10;
</code></pre>

<p>Is there a good way to refactor these, so if I have to change certain things here, such as function I'm calling to check the weight, or condition I'm checking against, or weight increment, that I'm not duplicating my efforts 8 times?</p>

<p>I've had other programmers I know already suggest to just <strong>combine</strong> them under one check, which I obviously can't do, cause it might meet 3 of these checks, and give me a weight of 30 this time, and 5 of these checks and give me a weight of 50 next time.</p>

<p><strong>Edit:</strong> This routine will be run on 1920x1080 pixel maps, so several million times; performance could be a real issue involved in the refactoring.</p>
","<c#><.net><refactoring><conditional><pixel>","0","51","2011-12-01 19:25:49"
"8352753","Smart refactoring using Roslyn CTP","<p>I'm running some analysis tools on our build like StyleCop/FXCop.</p>

<p>What i'd like to achieve is auto-correct some of the warnings produced by these.</p>

<p>Do you think this can be done using the Roslyn CTP? is there any other tool that allows:</p>

<ol>
<li>Scanning my code text for some rule not being followed.</li>
<li>Replacing this with the correct code.</li>
</ol>

<p>Some of the operations can be done using a simple text replace of the VS editor, but more complicated things require use of some other tool.</p>

<p>So my question is - to this end, is the Roslyn CTP the tool to use? or what other tools exist for .NET for doing this?  </p>
","<c#><.net><tools><refactoring><roslyn>","3","294","2011-12-02 06:54:08"
"8353697","JavaBean set attributes. Multiple if-statements alternative","<p>Again I would like to get your opinion about a design issue. </p>

<p>I have a JavaBean with 15 attributes. For feeding the attributes I have a <strong>for loop</strong> that iterates over a collection of key-value pairs (concretely SAML attributes, I am mapping the attributes response to principals attributes). I am invoking the appropriate <em>setter</em> method basis on the key value, this is:</p>

<pre><code>    .../...
    for (SAML2AttributeInfo attr : attrs) {
        if (attr.getAttributeName().equals(""http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"")) {
            customPrincipal.setUpn(attr.getAttributeValues().iterator().next());
        }
        .../... so on and so forth
    }
</code></pre>

<p>It works, ok, but I have an ugly piece of code, 15 if-statements like above do not look very elegant. </p>

<p>I am thinking on using <a href=""http://java.sun.com/developer/technicalArticles/ALT/Reflection/"" rel=""nofollow"">Reflection</a>, this is, develop a unique <em>set</em> method and pass it the name of the attribute and his value. </p>

<p>Another option could be store the attributes in a <a href=""http://docs.oracle.com/javase/6/docs/api/java/util/Map.html"" rel=""nofollow"">Map</a>, but I am not sure...</p>

<p>Any ideas?</p>

<p>Thanks in advance,</p>

<p>Luis </p>
","<java><refactoring><javabeans>","0","141","2011-12-02 08:38:15"
"8358379","copy-and-paste static analysis tool?","<p>Is there any static analysis tool that can process an entire codebase and detect where copy-and-paste has been used (i.e. blocks of duplicated or extremely similar code) so that it can be considered for refactoring?</p>
","<refactoring><copy-paste>","2","77","2011-12-02 15:11:11"
"8359857","Automated evaluation of SOLID principles enforcement","<p>Are there tools that can automatically evaluate the degree to which SOLID principles of OO design are respected in a project?</p>
","<oop><design><automated-refactoring>","0","37","2011-12-02 17:00:08"
"8349454","Refactoring big ball of mud; not sure static is being used properly here. Advice?","<p>I'll admit sometimes the deeper nuances of the keyword static escape me.</p>

<p>Here's what I'm seeing:</p>

<pre><code>public partial class Default : CSSDEIStatusBase
{
    private static Default _csWitWeb;

    protected void Page_Load(object sender, EventArgs e)
    {
        //DoStuff
        _csWitWeb = this;
        //OtherStuff
    }

    public static void ForceLoadSyncOperation(int? index)
    {
        Default._csWitWeb.LoadSelectedSyncOperation(index);
    }
}
</code></pre>

<p>The only references to ForceLoadSyncOperation are:</p>

<pre><code>Default.ForceLoadSyncOperation(index);
</code></pre>

<p>or</p>

<pre><code>Default.ForceLoadSyncOperation(null);
</code></pre>

<p>Both of these calls originate from:</p>

<pre><code>    public partial class DataOriginUserControl : System.Web.UI.UserControl
</code></pre>

<p>and are not located inside of static methods.</p>

<p>E.G:</p>

<pre><code>protected void btnCancelSyncOperation_Click(object sender, EventArgs e)
{
    this.lblErrorMessage.Text = string.Empty;
    this.lblErrorMessage.Visible = false;

    int index = _syncOperation.Sequence - 1;
    Default.ForceLoadSyncOperation(index);
}
</code></pre>

<p>This all seems really quirky to me. Does this smell to anyone else? Not really sure how to untangle it, though, as I can't exactly create an instance of the Default page inside of a user control.</p>

<p>Thoughts? Thanks for reading.</p>

<pre><code>protected void LoadSelectedSyncOperation(int? index)
{
    SyncOperationConfiguration[] syncOperations = CSServiceClient.GetInterfaceConfiguration().SyncOperationConfigurations.ToArray();

    PopulateSyncOperationsListView(syncOperations);
    SyncOperationConfiguration syncOperation = null;

    try
    {
        syncOperation = syncOperations[index.HasValue ? index.Value : 0];
    }
    catch
    {
        syncOperation = syncOperations[0];
    }

    ucDataOrigin.LoadSyncOperationData(syncOperation);
    Session[""ConfigMenuActiveIndex""] = 1;
    menuConfiguration.Items[(int)Session[""ConfigMenuActiveIndex""]].Selected = true;
    mvwConfiguration.ActiveViewIndex = (int)Session[""ConfigMenuActiveIndex""];
}
</code></pre>
","<c#><static><refactoring>","1","77","2011-12-01 22:50:21"
"8361708","One line bool from a QueryString","<p>Is there a better way to write this</p>

<pre><code>            string q = Request.QueryString[""q""] ?? string.Empty;
            bool isSearch = q != string.Empty ? true : false;
</code></pre>

<p>Like a one-line statement?</p>
","<c#><refactoring>","2","94","2011-12-02 19:44:08"
"8365011","Cannot inherit System.Window.Forms.Form class after manually change class name","<p>I have written a simple Form1 (inherit from Form) class in Visual Studio C#. All was good. </p>

<p>Then I wanted to change the name of the class and the namespace to something meaningful instead of the default 'WindowApplicationForm1' . I also changed the file name of the Form1.cs class to match the new class name (IRISReaderGUI and Com.Harmonysoft). First I manually rename the code, then compiled, the compiler gave me lot of error that I could not figure out. So I tried to rename my class and namespace using 'refactoring' menu. My code still didn't compile. </p>

<p>I did some research and change the 'IRISReaderGUI.Designer.cs' class name and namespace to match the new names. C# still didn't give me no joy. </p>

<ol>
<li><strong>The compiler erros message was</strong> :
'Com.Harmonysoft.IRISReaderGUI.Dispose(bool)': no suitable method
found to override' </li>
<li><strong>On the designer view it said</strong> : The base class'System.object' can not be designed.</li>
</ol>

<p>So I guess my IRISReaderGUI did not correctly inherit the System.Windows.Forms.Form class, this was confirmed by putting the mouse over the  Form word in the code, Visual Net does not popup the text describing the class, and pressing F12 does not get me to the Form definition. </p>

<p>Here is the code : </p>

<p>""IRISReaderGUI.Designer.cs""</p>

<pre><code>namespace Com.Harmonysoft
{

    partial class IRISReaderGUI
    {
.......

}
</code></pre>

<hr>

<p>""IRISReaderGUI.cs""</p>

<pre><code>   using System;
    using System.Collections.Generic;
    using System.ComponentModel;
    using System.Data;
    using System.Linq;
    using System.Text;
    using System.Data.Odbc;
    using System.Data.OleDb;
    using System.Data.OracleClient;
    using Com.StellmanGreene.CSVReader;
    using System.Windows.Forms;
    using System.IO;




      namespace Com.Harmonysoft
        {
            public partial class IRISReaderGUI : Form
            {
        ......
        }
</code></pre>

<hr>

<p>I am new to C# and Visual Studio, I have previously worked with Java compiler and Vim editor mostly. Could anyone please help me to compile my code ? </p>
","<c#><visual-studio-2010><refactoring><compiler-errors>","1","153","2011-12-03 02:28:56"
"8371103","Magic strings in ASP.NET MVC","<p>I have a background in desktop software development and am getting started with learning ASP.NET MVC.</p>

<p>In my default HomeController I have the Index action which has code that looks like this:</p>

<pre><code>if (!Request.IsAuthenticated)
    return RedirectToAction(""Login"", ""Account"");
</code></pre>

<p>In other words, redirect the user to ""/account/login"". The AccountController.Login action will then handle the user and send him back to the HomeController once he logs in successfully.</p>

<p>This code smells to me, perhaps just because I'm accustomed to doing things differently in desktop software. What if I change the name of the Login action to ""LogOn""? What if I remove the AccountController altogether and replace it with something else? I will introduce a new bug but I won't get compiler errors, and my unit tests probably won't catch it either. Since I used strings to specify controller and action names, refactoring and redesigning has more potential to break code all over the place.</p>

<p>What I would like is something like this:</p>

<pre><code>if (!Request.IsAuthenticated)
    return RedirectToAction(() =&gt; AccountController.Login);
</code></pre>

<p>However I'm not sure if that's even possible or if it's the best way to do it.</p>

<p>Am I being stupid, or have other people had the same problem? What do you do to get around it?</p>
","<asp.net-mvc><refactoring><magic-string>","2","345","2011-12-03 21:16:21"
"8372865","How can this PHP logic control structure be refactored?","<p>My gut tells me that there is a better, perhaps one-line refactor for the following code:</p>

<pre><code>if (isset($x))
{
    if (isset($y))
    {
        $z = array_merge($x,$y);
    }
    else
    {
        $z = $x;
    }
}
else
{
    $z = $y;
}
</code></pre>

<p>If I wasn't worried about warning errors, a simple <code>array_merge($x,$y)</code> would work, but I'd like to know a better way to do this. Thoughts?</p>
","<php><if-statement><refactoring><control-structure>","0","69","2011-12-04 02:48:55"
"8373584","Ruby refactoring of a method","<p>Would love to refactor this into just one line:</p>

<pre><code>def sum_something
  sum = 0
  self.each { |a| sum += a }
  return sum
end
</code></pre>

<p>There must be a way to define 'sum' within the block and I could drop the 'return'.</p>
","<ruby><refactoring><enumerable>","1","69","2011-12-04 05:52:10"
"8378511","Use xcode refactoring with a objective-c++ file in the project","<p>I just started using the <a href=""http://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;ved=0CDIQFjAA&amp;url=http://code.google.com/p/zxing/&amp;ei=PN3bTtiUCdPbiAKH5I2-BA&amp;usg=AFQjCNGFH2ouoZW2Ox0eLH7K_cJof-5zVQ&amp;sig2=KRDzbnUjTc8ukPALeo3nOQ"" rel=""nofollow"">ZXing</a> SDK in my iPhone project. This requires that include it be renamed to .mm files (objective-c++). </p>

<p>The problem is that because of one file in my project xcode refactoring has been disabled for the entire thing. </p>

<p>Is there a work around to this issue? A way to refactor for everything except that file or a better way to include things? Possibly by making a static lib of third party code?</p>
","<xcode4><refactoring><objective-c++><zxing>","0","137","2011-12-04 20:53:44"
"8382858","Rails 3 inheritance in routes","<p>So I am working on refactoring a largely similar codebase and am in the middle of creating a ""master"" controller and view layout. </p>

<p>so basically, I have this controller named test_base and there are a couple of things inheriting from it(module_a_test, module_b_test - not actual names). Im using inherited resources(for the controllers) and render inheritable(for the views) (i don't think upgrading to 3.1 is an option yet - just throwing it out there :P)</p>

<p>anyway, the app has a network of routes,some RESTful and some specific matches needed so this is the current structure:</p>

<pre><code>namespace :module_a_test do
  resources :jobs
  resources :etc do
    collection do
      get 'someurl'
    end
  end
  ...
end
</code></pre>

<p>and so on. it is a huge namespace with about 45 LOC. To cut the story short, module_b_test, c and etc are all similar with a few minor changes(i think some even don't have any changes)</p>

<p>Is there an easy way to ""inherit"" these routes without copy pasting the whole thing and changing namespace to :module_b_test?</p>

<p>I am in the middle of refactoring and right now, I learned of the scope function so it looks a little bit like:</p>

<pre><code>scope :module =&gt; ""test_base"" do
  namespace :module_a_test do
    etc etc
  end

  namespace :module_b_test do
    etc etc
  end
end
</code></pre>

<p>another example:</p>

<pre><code>  resources :project_spreadsheets, :only =&gt; [:index, :destroy] do
    collection do
      match 'upload_xls', :to =&gt; 'project_spreadsheets#create_xls'
    end
    member do
      get 'download'
    end
  end

  resources :project_scripts, :only =&gt; [:index, :destroy] do
    collection do
      match 'upload', :to =&gt; 'project_scripts#create_script'
    end
    member do
      get 'download'
    end
  end
</code></pre>
","<ruby-on-rails-3><rest><refactoring><routes>","0","69","2011-12-05 08:53:30"
"8389384","Event Aggregator: need help modifying solution","<p>I'm attempting to design an event aggregator for my application. (I am new to the design pattern, so I may not fully understand it yet).</p>

<p>Firstly, I have created a solution already that is somewhat an aggregator but needs improvement and refactoring to achieve better efficiency and lessen dependencies.</p>

<hr>

<h2>My goals/questions:</h2>

<p><strong>1) In the Event Aggregator design pattern, would my .NET data sources be considered the publishers?</strong> (I'm uncertain about the publishers' role is).</p>

<p><strong>2)</strong> There may be cases where an object (a subscriber) would like to subscribe to the data source events, but only specific events. In other words, object ""A"" would like to be notified of events in data source ""DS"", but ""A"" only cares about DataRemoving events (and does not want to be notified of insertions or changes).</p>

<p><strong>How would I design my solution to handle subscriptions not only to specific data sources, but also specific data events while ignoring others?</strong> <em>I would like to see a solution that moves away from keeping lists and looping through them tirelessly.. but not sure if I can avoid this all together.</em></p>

<hr>

<h2>Current solution:</h2>

<p>My current solution handles .NET data events, such as DataTable or XmlNode events. I have an inheritance model that will handle either of the two, but essentially I have DataTableAggregator and XmlNodeAggregator.</p>

<p>I have a list of subscribers and a list of data sources. Essentially for each change in a particular data source, the event will trigger the EventAggregator::DataChanged function which will then iterate through the list of subscribers and call their respective DataChanged function. (I do not particularly like this looping part of the solution).</p>

<p>In pseudo-code, my solution is as follows:</p>

<pre><code>public class EventHandler
    {
    public:
        EventAggregator aggregator;

        EventHandler (EventAggregator a)
            { aggregator = a;  }

        void DataChanged (Object sender, EventsArgs arg)
            { aggregator-&gt;DataChanged(arg);   }
    }

public class EventAggregator
    {
    public:
        List &lt;Object&gt; dataSources;
        List &lt;EventSubscriber&gt; subscribers;

        void AddDataSource (Object dataSource)
            {
            //Add dataSource to dataSources list

            //Implement delegates (there is a EventHandler class)
            //Example:
            dataSource-&gt;NodeChanged   += gcnew XmlNodeChangedEventHandler(handler, &amp;EventHandler::DataChanged);
             }

         void RemoveDataSource (Object dataSource)
             {  //Remove dataSource from dataSources list   }

         void AddSubsciber (EventSubscriber subscriber)
             {  //Add subscriber to subscribers list  }

         void RemoveSubscriber (EventSubscriber subscriber)
             {  //Remove subscriber from subscribers list  }

         void DataChanged (EventArgs arg)
             {
             for(int i = 0; i &lt; subsribers.size(); i++)
                 {
                 subscriber-&gt;DataChanged(arg);
                 }
              }
    }
</code></pre>

<p>Hope someone can add some insight into this :) (Please let me know if I need to provide any additional details.. it's a large solution to describe in a small amount of space and words!)</p>
","<.net><design-patterns><refactoring><eventaggregator>","0","109","2011-12-05 17:33:40"
"8392544","What is this IDisposable doing for me?","<p>I am working on a ""learning program"" and using the Code Rush refactoring tool with my learning. With the latest update of Code Rush it has been recommending implementing IDisposable to my programs. I know what MSDN says about IDisposable and I have a real basic understanding of what it does but because I don't know all the implications of implementing it I have been ignoring the recommendation. Today I decided to learn more about it and went along with the recommendation. </p>

<p>This is what it added to my program.</p>

<pre><code>class Program : IDisposable
{
    static Service _proxy;

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    protected virtual void Dispose(bool disposing)
    {
        if (disposing)
            if (_proxy != null)
            {
                _proxy.Dispose();
                _proxy = null;
            }
    }

    ~Program()
    {
        Dispose(false);
    }
</code></pre>

<p>So my questions is this. Does that do everything I need to do to get the advantage of IDisposable or do I need to do something in code to make it work? I put a break points on that and never reached it through the debugger so either it was not needed or I am not using it the way it was intended. Can someone please shed some light on what this is doing for me or how I should use it so it does do something for me? </p>
","<c#><refactoring><idisposable><coderush>","6","191","2011-12-05 22:05:23"
"8395345","C# Refactoring Code","<p>Currently I have code that looks like this</p>

<pre><code>Status(""Start Step 1"");
result = Step1();
Status(""End Step 1"", result);

Status(""Start Step 2"");
result = Step2();
Status(""End Step 2"", result);

Status(""Start Step 3"");
result = Step3();
Status(""End Step 3"", result);
</code></pre>

<p>Would it be possible to somehow refactor this code and get rid of the status lines. -- however it is very important to update the status at the start and end of each step.</p>

<p>I thought about moving the status lines into the Step1,2,3 calls but that just clutters up the methods.</p>
","<c#><refactoring>","1","83","2011-12-06 04:26:27"
"8386847","I have no ""refactoring"" option in eclipse menu","<p>I have just installed eclipse (indigo-web) on my computer.</p>

<p>I know that there is supposed to be a menu item called ""refactoring"" but it just isn't there.</p>

<p>Does anybody know how to add it?</p>

<p>Thanks a lot</p>
","<eclipse><refactoring>","-1","96","2011-12-05 14:32:38"
"8400927","Automating complex refactoring tasks","<p>I have the situation that the same repeating refactoring tasks have to be done for a huge number of methods in my code.
For example imagine a interface with 100 methods, each of them has one or more parameters as well as a return value. For each of these methods I need to jump to the implementation change the return type and add a line of code which converts the old return value to its new type for callers of the interface method.</p>

<p>Is there any way to quickly automate such refactorings?
I even thought to write a custom script to do it, but writing a intelligent script would approximately take longer than doing it maually.</p>

<p>A tool supporting such task can save a lot of time.</p>
","<c#><.net><visual-studio><refactoring>","2","74","2011-12-06 13:48:39"
"8400918","Refactoring method containing LINQ queries","<p>I'm having a little trouble deciding the best way to refactor a method which contains LINQ queries which are very similar but not identical.</p>

<p>Consider a method which is something along these lines:</p>

<pre><code>public SomeObject GetTheObject(IMyObject genericObject) {
    Type t = genericObject.GetType();
    SomeObject so = null;

    switch(t.Name) {
        case ""Type1"":
            var object1 = (from o in object1s where o.object1id == genericObject.id).FirstOrDefault();
            so = (SomeObject)object1;
        break;
        case ""Type2"":
            var object2 = (from o in object2s where o.object2id == genericObject.id).FirstOrDefault();
            so = (SomeObject)object2;
        break;
        default:
        break;
    }

    return so;
}
</code></pre>

<p>This is just an illustration, but imagine I'm needing to execute a different query (different in that it uses a different ObjectSet, uses slightly different fields (object1id vs object2id) and returns a different type.
Other than that, the queries are the same.</p>

<p>Is there a sensible way to refactor this kind of method? It feels like I've missed something obvious. Perhaps I have to use the exact method and I can't avoid re-writing the query, it just seems like I SHOULD be able to somehow!</p>

<p>Any pointers greatly appreciated</p>
","<c#><asp.net><linq><refactoring>","6","94","2011-12-06 13:48:18"
"8408004","Refactoring Synchronous Client to Use Asynchronous Twisted Calls","<p>I discovered twisted half-way through developing a network application.  I had a working Client and Server using raw socket communication, but have opted to use Twisted in order to handle multiple connections asynchronously on the Server side.  The twisted server works fine with the following raw-socket client class connecting to it:</p>

<pre><code>class Client:
  def __init__(self, backend, port=22220):
    import socket
    self.role_buf = 4096
    self.buf = 1024
    self.addr = (backend, port)
    self.TCPSock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    self.TCPSock.connect(self.addr)

  def getRoleList(self):
    self.TCPSock.send(""RLP"")
    data = self.TCPSock.recv(self.role_buf)
    return data.split(""|"")

  def getServer(self, roleindex=0):
    self.TCPSock.send(roleindex)
    ip = self.TCPSock.recv(self.buf)
    self.TCPSock.close()
    return ip
</code></pre>

<p>What I'd like to do is refactor the client code using Twisted's clean socket and reactor abstraction.  I'd like to be able to instantiate the client class in my Qt-based client GUI (Using PyQt) to gather event-driven (asynchronous) input from the user by calling <code>getRoleList()</code> and <code>getserver()</code> from the PyQt based client code.  I don't want to use the PyQt socket/reactor implementation, I'd like to use a single library for my network communication.</p>

<p>Is this possible, and if so how should I do it? I think it should be, but having spent quite a while researching and reading twisted documentation, including these <a href=""http://krondo.com/?page_id=1327"" rel=""nofollow"" title=""here"">excellent tutorials</a> I can't seem to glean from them exactly how to go about implementing a solution.  Maybe I'm doing something silly and I need my hand slapped?  </p>

<p><strong>Typical Server/Client Interaction:</strong></p>

<p>The server is always listening on port 22220, and when it receives a ""role list request"" from the client, it pushes it's (dynamic) list of role choices to the client.  The client then displays these role choices to the user in a GUI, the user selects the single role they would like, then the client sends that request back to the server.  The server then responds with data appropriate to the user's specific selection.</p>
","<python><refactoring><network-programming><twisted>","0","110","2011-12-06 22:47:24"
"8405706","Weird behaviour with db4o after refactoring enum","<p>We have refactored an enum used in our model to include new values. Now when the application executes (using a database file created by the old application), some switch/case statements behave very strangely.</p>

<p>The debug variables view shows that, e.g. the enum has value ""OLD"", but the debugger steps into the ""case NEW:"" line.</p>

<p>Any thoughts? Cheers!</p>

<p><strong>Update:</strong></p>

<p>The following code</p>

<pre><code>ObjectSet&lt;Project&gt; set = db.query(Project.class);
System.out.println(""Found "" + set.size());
for (Project prj : set) {
    // this line makes no difference
    ProjectStatus otherStatus = ProjectStatus.valueOf(prj.getStatus().name());

    // debug
    System.out.println(otherStatus.name());

    // decide via switch/case
    switch (otherStatus) {
        case A:
            System.out.println(""Project status is A (switch/case)"");
            break;
        case B:
            System.out.println(""Project status is B (switch/case)"");
            break;
    }

    // decide via if
    if (otherStatus == ProjectStatus.A) {
        System.out.println(""Project status is A (if ==)"");
    }
    else if (otherStatus == ProjectStatus.B) {
        System.out.println(""Project status is B (if ==)"");
    }
}
</code></pre>

<p>produces output</p>

<pre><code>Found 1
B
Project status is B (if ==)
</code></pre>

<p>We tried db4o 6.4 and 7.12</p>

<p>Also, depending on the type of enum refactoring, if we remove enum values, the following exception is thrown:</p>

<pre><code>Exception in thread ""main"" java.lang.ArrayIndexOutOfBoundsException: 1
    at Main.$SWITCH_TABLE$model$ProjectStatus(Main.java:8)
    at Main.main(Main.java:37)
</code></pre>
","<java><enums><refactoring><db4o>","0","78","2011-12-06 19:36:37"
"8412652","What is the best way to create new set of MVC elements based on existing components","<p>In my project (based on Zend Framework) I've got some old code (controller, models and views) used to create categories of polls, polls itself, visual editor for creating questions and so on.</p>

<p>Now I need to create very similar part of system for creating choice tests. Main difference is that those tests have assigned values for each answer. So in DB I need to add another column for those values.</p>

<p>In conslusion: Difference between those two is small, but I want to separate them. Cloning DB tables, models and controllers is IMHO stupid and needs almost as much work as writing this from scratch.</p>

<p>Do You have some suggestions how to do this nicely? This description isn't perfect but I will try answer to each question.</p>
","<mvc><design><refactoring><zend-framework>","0","13","2011-12-07 09:01:39"
"8415432","Ruby: Refactoring a complicated nested-loop method","<p>I'm trying to get rid of duplication in my code. I have a method that populates a checkerboard with checkers:</p>

<pre><code>def populate_checkers
  evens = [0, 2, 4, 6]
  odds  = [1, 3, 5, 7]

  0.upto(2) do |x_coord|
    if x_coord.even?
      evens.each do |y_coord|
        red_checker = Checker.new(x_coord, y_coord, :red)
        @board[x_coord][y_coord] = red_checker 
      end
    elsif x_coord.odd?
      odds.each do |y_coord|
        red_checker = Checker.new(x_coord, y_coord, :red)
        @board[x_coord][y_coord] = red_checker 
      end
    end
  end

  5.upto(7) do |x_coord|
    if x_coord.even?
      evens.each do |y_coord|
        black_checker = Checker.new(x_coord, y_coord, :black)
        @board[x_coord][y_coord] = black_checker 
      end
    elsif x_coord.odd?
      odds.each do |y_coord|
        black_checker = Checker.new(x_coord, y_coord, :black)
        @board[x_coord][y_coord] = black_checker 
      end
    end
  end
end
</code></pre>

<p>How can I remove duplication and still get the precise behavior I need?</p>
","<ruby><refactoring><iteration>","1","96","2011-12-07 12:38:32"
"8407251","Ruby Checker Implementation : Formatting complex multiple method calls","<p>One function needed in checkers is to prevent a player from moving a checker if a jump of an opposing checker is possible. To that end I have an algorithm that goes like this:</p>

<ol>
<li>Inspect a single checker for adjacent coordinate locations (on a 2D array ""board"")</li>
<li>Inspect the content of those adjacent positions</li>
<li>If the adjacent position has content, inspect if that is an opposing checker</li>
<li>If it is an opposing checker, inspect if there is a vacant space to land</li>
<li>Make a list of potential jump landing spots for a SINGLE checker</li>
<li>Survey the entire board and make a list of ALL potential landing spots</li>
</ol>

<p>My problem arises when I try to implement the 6th step. I find myself having to include a helper function like: </p>

<pre><code>def jump_location_finder_stack(board, x, y)
  jump_locations = {}
  opposing_checkers = opposing_checker_adjacent(determine_adjacent_positions_content(board,assign_adjacent_board_coords(x, y)))
  jump_locations = jump_locations(board, x, y, opposing_checkers)
  jump_locations
end
</code></pre>

<p>See the ridiculously long opposing checkers assignment (I could have made it even longer by embedding it into the jump_locations call) that calls the entire ""stack"" of calls since each one feeds off of the next. Here is the 6th step method:</p>

<pre><code>def generate_jump_locations_list(board, current_player)
  coordinates_list = []
  @current_player = current_player 

  board.each do |row|
    row.each do |loc|
      if (loc != nil) and (loc.color == @current_player)
        jump_locations = jump_location_finder_stack(board, loc.x_pos, loc.y_pos)
        coordinates_list &lt;&lt; coordinates_of_jump_landings(loc.x_pos, loc.y_pos, jump_locations)  
      end
    end
  end

  coordinates_list.flatten
end
</code></pre>

<p>Can I improve that extra long ""opposing_checkers"" call in the helper method, or, maybe put another way, is this long chaining of methods a ""smell"" in the code? I have included the full listing below in case you're curious</p>

<h2>FULL LISTING</h2>

<pre><code>class BoardSurvey

  attr_accessor :board, :current_player

  QUADRANTS = [""upper_left"", ""upper_right"", ""lower_left"", ""lower_right""]

  def invert_array(array)
    array.map! { |x| -x }
  end

  def normal_deltas
    deltas = [1, 1, 1, -1, -1, 1, -1, -1] 
    @current_player == :red ? deltas : invert_array(deltas) 
  end

  def edge?(x)
    x &gt; 7
  end

  def edge_adjust(hash)
    @current_player == :red ? hash.merge({""upper_left"" =&gt; nil, ""upper_right"" =&gt; nil}) : hash.merge({""lower_left"" =&gt; nil, ""lower_right"" =&gt; nil}) 
  end

  def deltas_to_board_locations(deltas, x, y)
    board_coords = []
    deltas.each_slice(2) do |slice|
      board_coords &lt;&lt; x + slice[0] 
      board_coords &lt;&lt; y + slice[1]
    end
    board_coords
  end    

  def assign_adjacent_board_coords(x, y) 
    jump_positions = Hash[QUADRANTS.zip(deltas_to_board_locations(normal_deltas, x, y).each_slice(2))]    
  end

  def determine_adjacent_positions_content(board, board_coords)
    adjacent_content = {}
    board_coords.each_pair { |quad, coords| adjacent_content[quad] = board[coords[0]][coords[1]] }
    adjacent_content
  end 

  def opposing_checker_adjacent(adjacent_content)
    opposing_checker_adjacent = {}
    adjacent_content.each_pair do |quad, content|
      if content != nil 
        content.color != @current_player ? opposing_checker_adjacent[quad] = true : opposing_checker_adjacent[quad] = false 
      else
        opposing_checker_adjacent[quad] = false
      end
    end
    opposing_checker_adjacent
  end

  def not_outside_bounds?(x, y, dx, dy)
    move_check = MoveCheck.new
    not move_check.out_of_bounds?(x + dx, y + dy)
  end

  def jump_possible?(board, x, y, deltas)
    (not_outside_bounds?(x, y, deltas[0], deltas[1]) and board[x + deltas[0]][y + deltas[1]] == nil) ? true : false
  end

  def delta_translator(quad, x, y, mag)
    deltas = []
    case quad
    when ""upper_left""
      x += mag; y += mag
    when ""upper_right""
      x += mag; y -= mag
    when ""lower_left""
      x -= mag; y += mag
    when ""lower_right""
      x -= mag; y -= mag  
    end
    deltas &lt;&lt; x &lt;&lt; y
    @current_player == :black ? deltas.reverse : deltas
  end

  def adjust_jump_locations_if_not_king(board, x, y, jump_locations)
    unless board[x][y].is_king?
      jump_locations[""lower_left""]  = false
      jump_locations[""lower_right""] = false
    end
    jump_locations
  end

  def jump_locations(board, x, y, opposing_checkers)
    jump_locations = {}
    opposing_checkers.each_pair do |quad, present|
      if present
        deltas = delta_translator(quad, x, y, 1)
        jump_possible?(board, x, y, deltas) ? jump_locations[quad] = true : jump_locations[quad] = false
      else
        jump_locations[quad] = false
      end
    end
    adjust_jump_locations_if_not_king(board, x, y, jump_locations)
    jump_locations
  end

  def coordinates_of_jump_landings(x, y, jump_locations)
    jump_coords = []

    jump_locations.each_pair do |quad, jump|
      if jump
        jump_coords &lt;&lt; delta_translator(quad, x, y, 2)
      end
    end
    jump_coords
  end

  def jump_location_finder_stack(board, x, y)
    jump_locations = {}
    opposing_checkers = opposing_checker_adjacent(determine_adjacent_positions_content(board, assign_adjacent_board_coords(x, y)))
    jump_locations = jump_locations(board, x, y, opposing_checkers)
    jump_locations
  end

  def generate_jump_locations_list(board, current_player)
    coordinates_list = []
    @current_player = current_player 

    board.each do |row|
      row.each do |loc|
        if (loc != nil) and (loc.color == @current_player)
          jump_locations = jump_location_finder_stack(board, loc.x_pos, loc.y_pos)
          coordinates_list &lt;&lt; coordinates_of_jump_landings(loc.x_pos, loc.y_pos, jump_locations)  
        end
      end
    end
    coordinates_list.flatten
  end
end
</code></pre>
","<ruby><methods><refactoring>","0","70","2011-12-06 21:41:24"
"8417145","Best practice for refactoring methods","<p>I am wondering what would be the the best practice for refactoring code that looks like this:</p>

<p>Where should the exit criteria should be set and what is the best practice</p>

<pre><code>    private static bool Foo()
    {
        bool result = false;

        if (DoMehod1())
        {
            if (DoMehod2())
            {
                if (DoMethod3())
                {
                    result = true;
                }
                else
                {
                    Console.WriteLine(""DoMethod3 Failed"");
                }
            }
            else
            {
                Console.WriteLine(""DoMethod2 Failed"");
            }
        }
        else
        {
            Console.WriteLine(""DoMethod1 Failed"");
        }
        return result;
    }
</code></pre>

<p>Thanks</p>
","<c#><.net><refactoring>","7","204","2011-12-07 14:43:40"
"8418959","Most Economic Means of Improving Javascript Performance (by supplanting jQuery)","<p>Ok, other than purchasing a beast of a machine to improve performance...</p>

<p>I've got a Javascript/AJAX driven web app that was written utilizing jQuery in order to speed up inital development time. I'm finding that from a performance perspective, I'm ready to begin supplanting piece by piece to improve the code efficiency.</p>

<p>One Example...</p>

<p><a href=""http://jsperf.com/innerhtml-vs-jquery"" rel=""nofollow"">http://jsperf.com/innerhtml-vs-jquery</a></p>

<p>I moved away from using <strong><code>$(selector).text()</code></strong> in active areas to naitive DOM access with <strong><code>getElementById(id).innerHTML</code></strong> </p>

<p>I'm a little bit at a loss as to where to go next in terms of getting the most bang for my buck, <strong>what are some glaring areas where utilizing jQuery causes you to take a performance hit (outside load times)?</strong></p>
","<javascript><jquery><performance><refactoring>","0","91","2011-12-07 16:38:00"
"8419241","PHP Refactoring Plugin For Eclipse PDT","<p>I'm trying to switch to an IDE for my PHP projects and I'm having problems with refactoring things like filenames etc. </p>

<p>Does anybody have experience with the <a href=""http://sourceforge.net/projects/refactor4pdt/"" rel=""nofollow"">PHP Refactoring Plugin For Eclipse PDT</a>? Are there better refactoring solutions for PHP? It doesn't have to be for Eclipse, I would try other IDEs.</p>
","<php><refactoring><eclipse>","3","519","2011-12-07 16:26:09"
"8426699","How to create an interface out of a class easily?","<p>I have a class which has 10 methods.
What i want is to create an interface of that class, i.e the interface will contain only the signature of those 10 methods.</p>

<p>Can it be done easily in .NET using Visual studio?</p>

<p>I am asking this question because I am changing the architecture of my project and for every class present in my project i need an interface.</p>
","<c#><class><interface><refactoring><automated-refactoring>","4","92","2011-12-08 05:43:41"
"8437811","Python: How to handle method calls on a class that could not initialize correctly?","<p>If an object relies on a module that is not included with Python (like win32api, gstreamer, gui toolkits, etc.), and a class/function/method from that module may fail, what should the object do?</p>

<p>Here's an example:</p>

<pre><code>import guimodule  # Just an example; could be anything

class RandomWindow(object):

    def __init__(self):
        try:
            self.dialog = guimodule.Dialog()  # I might fail
        except: guimodule.DialogError:
            self.dialog = None  # This can't be right

    def update(self):
        self.dialog.prepare()
        self.dialog.paint()
        self.dialog.update()

    # ~30 more methods
</code></pre>

<p>This class would only be a tiny (and unnecessary, but useful) part of a bigger program.</p>

<p>Let's assume we have an imaginary module called <code>guimodule</code>, with a class called <code>Dialog</code>, that may fail to instantiate. If our <code>RandomWindow</code> class has say, 30 methods that manipulate this window, checking <code>if self.dialog is not None</code> will be a pain, and will slow down the program when implemented in constantly used methods (like the <code>update</code> method in the example above). Calling <code>.paint()</code> on a <code>NoneType</code> (when the <code>Dialog</code> fails to load) will raise an error, and making a dummy <code>Dialog</code> class with all of the original's methods and attributes would be absurd.</p>

<p>How can I modify my class to handle a failed creation of the <code>Dialog</code> class?</p>
","<python><oop><coding-style><module><refactoring>","1","75","2011-12-08 21:18:40"
"8455216","Instance variables from controller in a loop","<p><em><strong>edit: any feedback on the downvote would be handy - is this a stupid question?</em></strong> </p>

<p>How do you set instance variables in the controller within a loop? </p>

<p>Here's show.html.haml: </p>

<pre><code>- @roystatement.contracts.each do |contract|
  = render :partial =&gt; ""contract.html.haml"", :locals =&gt; {:contract =&gt; contract}
</code></pre>

<p>and here's the partial, _contract.html.haml: </p>

<pre><code> - @roystatement.sum_at_contract_level(contract) 
 %h6= ""Contract reserve is #{@roystatement.contract_reserve}""
</code></pre>

<p>which calls this: </p>

<pre><code>  def sum_at_contract_level(contract)
      self.initialize_arrays 
      self.sum_at_book_level(contract) #sets @reserve in another method
      @contract_reserve = @reserve.inject(0){|sum,item| sum + item}
  end 
</code></pre>

<p>If I try to set an instance variable for the reserve amount in the controller, I just get the value of the last loop through the each. How do I involve the controller in this and avoid the view layer interacting with the model?  </p>
","<ruby-on-rails><mvc><refactoring>","0","85","2011-12-10 07:54:36"
"8459640","How can I refactor the mother of all C# Switch Statements","<p>I am trying to refactor the mother of all switches and am not really sure how to do it.  Here is the existing code:</p>

<pre><code>    bool FieldSave(Claim claim, string field, string value)
    {
        //out vars for tryparses
        decimal outDec;
        int outInt;
        bool outBool;
        DateTime outDT;

        //our return value
        bool FieldWasSaved = true;

        //World Greatest Switch - God help us all.
        switch (field)
        {
            case ""Loan.FhaCaseNumber"":
                GetLoan(claim).FhaCaseNumber = value;
                break;
            case ""Loan.FhaInsurance"":
                if (bool.TryParse(value, out outBool))
                {
                    GetLoan(claim).FhaInsurance = outBool;
                    FieldWasSaved = true;
                }
                break;
            case ""Loan.UnpaidPrincipalBalance"":
                if (decimal.TryParse(value, out outDec))
                {
                    GetLoan(claim).UnpaidPrincipalBalance = outDec;
                    FieldWasSaved = true;
                }
                break;
            case ""Loan.Mortgagor_MortgagorID"":
                if(Int32.TryParse(value, out outInt)){
                    GetLoan(claim).Mortgagor_MortgagorID = outInt;
                    FieldWasSaved = true;                        
                }
                break;
            case ""Loan.SystemDefaultDate"":
                if (DateTime.TryParse(value, out outDT))
                {
                    GetLoan(claim).SystemDefaultDate = outDT;
                    FieldWasSaved = true;
                }                    
                break;
            //And so on for 5 billion more cases
        }

        db.SaveChanges();
        return FieldWasSaved;  
    }   
</code></pre>

<p>Is there anyway to do this in a generic way or is this super switch actually necessary?</p>

<p><strong>A BIT MORE CONTEXT</strong>
I don't claim to understand all the magic the other dev is up to, but basically the string ""Loan.FieldName"" is coming from some metadata tagged on to an HTML input tag.  This is used in this switch to link a particular field to an entity framework data table / property combo.  Although this is coming from a strongly typed view, for reasons beyond the ken of man this mapping has become the glue holding the whole thing together.</p>
","<c#><refactoring>","4","159","2011-12-10 20:31:14"
"8466852","How can I use Extract Method on code that has different constants?","<p>Given I have code like the following:</p>

<pre class=""lang-java prettyprint-override""><code>void foo() {
  String str = ""hello"";

  a(str, 1);
  b(str, true);

  a(str, 2);
  b(str, false);
}
</code></pre>

<p>I would like to extract a new method <code>c</code> like:</p>

<pre class=""lang-java prettyprint-override""><code>void foo() {
  String str = ""hello"";

  c(str, 1, true);
  c(str, 2, false);
}
</code></pre>

<p>However, the automated Extract Method refactoring will only extract one of the <code>a</code>/<code>b</code> pairs. My guess is that it dislikes the differing constants. I can work around this by extracting a local variable first, then extracting the method, then inlining the previously extracted variable, but I still have to find all the instances by hand. With that amount of work, I might as well just make the full change myself when I am looking at each part.</p>

<p>Is there a trick I am missing to let Eclipse know to search a little harder to extract this type of code?</p>
","<java><eclipse><refactoring>","1","79","2011-12-11 19:37:46"
"8475530","Open source tool to find unused public/private methods","<p>I'm looking for an open source tool to show me the uncalled public/private methods of my solution.</p>

<p>The idea is to have a list of uncalled methods and let the developer chose to delete or let it as it is.</p>
","<.net><refactoring>","0","71","2011-12-12 14:07:12"
"8475908","Ruby eval refactoring","<p>I have such models:</p>

<pre><code>Class User
  has_many :comments
  # have field 'name' in DB
end

Class Comment
  belongs_to :user
end
</code></pre>

<p>And i have very complex and very hard for understand admin backend, which gets all models and allows to control it from Admin Interface. It gets all associations and processes it with evals.</p>

<p>And such eval works fine:</p>

<pre><code>eval(""comment."" + o[0][:object])
</code></pre>

<p>where o[0][:object] = ""user.name""</p>

<p>But i wanna make it without eval. This approach works, but it's not very universal:</p>

<pre><code>comment.send(""user"").send(""name"")
</code></pre>

<p>And in real code it looks very ugly:</p>

<pre><code>(o[0][:object].split(""."").count &lt; 2) ? h(object.send(o[0][:object])) : h(object.send(o[0][:object].split(""."")[0]).send(o[0][:object].split(""."")[1]))
</code></pre>

<p>So, what's the best way to get eval's univesality for such contructions, if i wanna show more nested calls, like:</p>

<pre><code>comment.user.first_friend.haters.count
</code></pre>

<p>???</p>
","<ruby-on-rails><ruby><refactoring><eval>","0","287","2011-12-12 14:33:21"
"8489375","Why refactor argument of List<Term> to IEnumerable<Term>?","<p>I have a method that looks like this:</p>

<pre><code>    public void UpdateTermInfo(List&lt;Term&gt; termInfoList)
    {
        foreach (Term termInfo in termInfoList)
        {
            UpdateTermInfo(termInfo);
        }
        m_xdoc.Save(FileName.FullName);
    }
</code></pre>

<p>Resharper advises me to change the method signature to <code>IEnumerable&lt;Term&gt;</code> instead of <code>List&lt;Term&gt;</code>. What is the benefit of doing this?</p>
","<c#><interface><refactoring><resharper>","6","237","2011-12-13 12:38:01"
"8489604","disaster recovery plan before refactoring an architecture","<p>I mainly have to design a backup and recovery plan for a client, but another duty is to make the systems reliable in terms of failover and load balancing which will make me to changes the system architecture.</p>

<p>I mainly think that should be better to design an apply the backup and recovery plan after refactoring the system, I mean, at once, designing the backup and recovery plan after the refactorization.</p>

<p>I feel that if do so in advance is going to be a big big headache.</p>

<p>Do you think that is good idea propose to my client to refactore the system before applying the DR plan?</p>

<p>Would you so?</p>

<p>Thanx</p>
","<architecture><refactoring><disaster-recovery>","1","70","2011-12-13 12:54:38"
"8490637","Rewrite code for MVC 3 tabs more efficiently?","<p>I need help rewriting this code efficiently, code in the tab are very similar. I want to create a generic tab to reuse? here's my code:</p>

<p>This is the view (calling partial views in between jquery tabs):</p>

<pre><code> &lt;div id=""tabs""&gt; 
            &lt;ul&gt; 
                &lt;li&gt;&lt;a href=""#tabs-1""&gt;Global&lt;/a&gt;&lt;/li&gt; 
                &lt;li&gt;&lt;a href=""#tabs-2""&gt;Asia / Pacific&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=""#tabs-3""&gt;Europe, Middle East and Africa&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=""#tabs-4""&gt;Latin America&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=""#tabs-5""&gt;North America&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;

            &lt;div id=""tabs-1""&gt; 
                @Html.Partial(""TabGlobal"", Model.GlobalPublication)
            &lt;/div&gt; 
            &lt;div id=""tabs-2""&gt; 
                @Html.Partial(""TabAsianPacific"", Model.AsianPacificPublication)
            &lt;/div&gt; 
            &lt;div id=""tabs-3""&gt; 
                @Html.Partial(""TabEuropeMiddleEastAfrica"", Model.EuropeMiddleEastAfricaPublication)
            &lt;/div&gt; 
            &lt;div id=""tabs-4""&gt; 
                @Html.Partial(""TabLatinAmerica"", Model.LatinAmericaPublication)
            &lt;/div&gt; 
           &lt;div id=""tabs-5""&gt; 
                @Html.Partial(""TabNorthAmerica"", Model.NorthAmericaPublication)
            &lt;/div&gt; 
       &lt;/div&gt;
</code></pre>

<p>tab1 (one of the partial views):</p>

<pre><code>@{

     string chckEmailGlobal = """";
     string chckPrintGlobal = """";
 }
 &lt;div class=""scrollContent""&gt;
    @foreach (var global in Model)
    { 
        &lt;li class=""publication-slot""&gt;
            &lt;div class=""textWrap""&gt;
                &lt;h4 class=""heading""&gt;@global.PublicationName&lt;/h4&gt;
                &lt;p class=""description""&gt;@global.ShortDescription&lt;/p&gt;
            &lt;/div&gt;
            &lt;fieldset class=""select-this-publication""&gt;
    @if (global.ChildPublication != null)
    {
        foreach (var child in global.ChildPublication)
        { 
           &lt;br /&gt; &lt;label&gt;@child.PublicationName -- &lt;/label&gt;

            if (child.EmailVersion == ""True"")
            {
                if (!String.IsNullOrEmpty(child.RegisteredforEmail))
                { chckEmailGlobal = ""checked""; }
                else
                { chckEmailGlobal = """"; };

                &lt;div&gt;&lt;input type=""checkbox"" name=""emailsub"" id=""emailsub"" @chckEmailGlobal value=""@child.PublicationId"" /&gt;Email&lt;/div&gt;
            }

            if (child.PrintVersion == ""True"")
            {
                if (!String.IsNullOrEmpty(child.RegisteredforPrint))
                { chckPrintGlobal = ""checked""; }
                else
                { chckPrintGlobal = """"; };

                &lt;div&gt;@Html.Label(""Print:"")&lt;input type=""checkbox"" name=""printsub"" id=""printsub"" @chckPrintGlobal value=""@child.PublicationId"" /&gt;Print&lt;/div&gt;
            }
        }
    }
    else
    {     
        &lt;label&gt;Select this Publication --&lt;/label&gt;

        if (global.EmailVersion == ""True"")
        {
            if (!String.IsNullOrEmpty(global.RegisteredforEmail))
            { chckEmailGlobal = ""checked""; }
            else
            { chckEmailGlobal = """"; };

            &lt;div&gt;&lt;input type=""checkbox"" name=""emailsub"" id=""emailsub"" @chckEmailGlobal value=""@global.PublicationId"" /&gt;Email&lt;/div&gt;
        }

        if (global.PrintVersion == ""True"")
        {
            if (!String.IsNullOrEmpty(global.RegisteredforPrint))
            { chckPrintGlobal = ""checked""; }
            else
            { chckPrintGlobal = """"; };

             &lt;br /&gt;&lt;div&gt;&lt;input type=""checkbox"" name=""printsub"" id=""printsub"" @chckPrintGlobal value=""@global.PublicationId"" /&gt;Print&lt;/div&gt;
        }

    }  

        &lt;/fieldset&gt;&lt;/li&gt;
    }
&lt;/div&gt;
</code></pre>

<p>tab2 (one of the partial views):</p>

<pre><code> @{

     string chckEmailAsia = """";
     string chckPrintAsia = """";
 }
 &lt;div class=""scrollContent""&gt;
    @foreach (var asia in Model)
    { 
        &lt;li class=""publication-slot""&gt;
            &lt;div class=""textWrap""&gt;
                &lt;h4 class=""heading""&gt;@asia.PublicationName&lt;/h4&gt;
                &lt;p class=""description""&gt;@asia.ShortDescription&lt;/p&gt;
            &lt;/div&gt;
            &lt;fieldset class=""select-this-publication""&gt;
    @if (asia.ChildPublication != null)
    {
        foreach (var child in asia.ChildPublication)
        { 
           &lt;br /&gt; &lt;label&gt;@child.PublicationName -- &lt;/label&gt;

            if (child.EmailVersion == ""True"")
            {
                if (!String.IsNullOrEmpty(child.RegisteredforEmail))
                { chckEmailAsia = ""checked""; }
                else
                { chckEmailAsia = """"; };    
                &lt;div&gt;&lt;input type=""checkbox"" name=""emailsub"" id=""emailsub"" @chckEmailAsia value=""@child.PublicationId"" /&gt;Email&lt;/div&gt;
            }

            if (child.PrintVersion == ""True"")
            {
                if (!String.IsNullOrEmpty(child.RegisteredforPrint))
                { chckPrintAsia = ""checked""; }
                else
                { chckPrintAsia = """"; };                  
                &lt;div&gt;&lt;input type=""checkbox"" name=""printsub"" id=""printsub"" @chckPrintAsia value=""@child.PublicationId"" /&gt;Print&lt;/div&gt;
            }
        }
    }
    else
    {     
        &lt;label&gt;Select this Publication --&lt;/label&gt;

        if (asia.EmailVersion == ""True"")
        {
            if (!String.IsNullOrEmpty(asia.RegisteredforEmail))
            { chckEmailAsia = ""checked""; }
            else
            { chckEmailAsia = """"; };

           &lt;div&gt;&lt;input type=""checkbox"" name=""emailsub"" id=""emailsub"" @chckEmailAsia value=""@asia.PublicationId"" /&gt;Email&lt;/div&gt;
        }

        if (asia.PrintVersion == ""True"")
        {
            if (!String.IsNullOrEmpty(asia.RegisteredforPrint))
            { chckPrintAsia = ""checked""; }
            else
            { chckPrintAsia = """"; };

           &lt;br /&gt;&lt;div&gt;&lt;input type=""checkbox"" name=""printsub"" id=""printsub"" @chckPrintAsia value=""@asia.PublicationId"" /&gt;Print&lt;/div&gt;
        }

    }  

        &lt;/fieldset&gt;&lt;/li&gt;
    }
&lt;/div&gt;
</code></pre>

<p>tab2:</p>
","<asp.net-mvc-3><refactoring><tabs><code-cleanup>","0","176","2011-12-13 14:13:20"
"8494029","Math Table in php?","<p>I want to get table value in php array.</p>

<pre><code> $values=array(2,4,6,8,10,12,14,16,18,19,20);
</code></pre>

<p>I tried something like this</p>

<pre><code>&lt;?php
 for($i=1;$i&lt;=10;$i++)
 {
$values[]=2*$i;
 }

 ?&gt;
</code></pre>

<p>Can i do better may be through some built in functions or some another technique.</p>
","<php><refactoring>","0","54","2011-12-13 18:11:12"
"8497326","Migrate struts action to spring action","<p>I am looking for a good tutorial on migrating from struts to spring. I have multiple struts actions that I would like to refactor into spring components.</p>
","<spring><refactoring><struts><action>","1","53","2011-12-13 22:45:51"
"8500605","Why does resharper refactor(move) feature not update references - can I enable this?","<p>New to .net and loving resharper's refactor capability after many years of being spoilt by Eclipse.  When I move types however it doesn't seem to want to adjust references of the project to suit?? Is there some way to enable it? Surely if it can suggest the problem it can fix it!?</p>
","<refactoring><resharper>","0","98","2011-12-14 07:03:48"
"8501682","What is a good way to approach a Rails 2.3 refactoring and port it to Rails 3?","<p>I have to refactor a huge badly written (big controller methods), untested and undocumented Rails 2.3-Webapp and port it to Rails 3.</p>

<p>I can't simply move everything to rails 3 because parts of the app are selfmade plugins which nest controllers in controllers which is (as i was told) not possible in rails 3 because the used plugin for that isn't compatible. </p>

<p>Any hints how i should start? Or a little roadmap? 
Should I first try to write a documentation?
Then tests? </p>

<p>Best regards</p>

<pre><code>--------------------------------------------------------------------------------
Language                      files          blank        comment           code
--------------------------------------------------------------------------------
Javascript                      231           9679           6538          42954
Ruby                            601           5540           3032          28417
HTML                             68           1172            266          13179
CSS                              80           1796            805           7677
XML                              17             69             63           1299
YAML                             36            114            216           1212
Bourne Shell                     12             77            226            343
MXML                              1              7              0             52
PHP                               2             29             28             26
Bourne Again Shell                1              9             29             17
--------------------------------------------------------------------------------
SUM:                           1049          18492          11203          95176
--------------------------------------------------------------------------------
</code></pre>
","<ruby-on-rails><refactoring><port>","0","23","2011-12-14 08:55:13"
"8509156","How to automate renaming files to match class name in Visual Studio 2010","<p>I have several projects whose file names do not match the class names.  Is there a way automate a renaming of these files to match the class names in Visual Studio 2010?  </p>

<p>Thanks in advance!</p>
","<visual-studio><automated-refactoring>","0","16","2011-12-14 17:43:55"
"8509593","Refactoring rails3 view activerecord call","<p>In the below snippet, I'm doing a lot of database manipulation in the view.  (The .where, and two each loops).  What is the best way to refactor this code out of the view?</p>

<p>In the view: index.html.erb</p>

<pre><code>&lt;%- @lesson.sections.each do |section| -%&gt;
          &lt;%- section_correlations = section.correlations.where(:grade =&gt; 4) %&gt;
          &lt;%- unless section_correlations.blank? -%&gt;
              &lt;h3&gt;&lt;%= section.full_title %&gt;&lt;/h3&gt;
                &lt;%- section_correlations.each do |correlation| -%&gt;
                      &lt;%= correlation.description %&gt;
                &lt;%- end -%&gt;
          &lt;%- end -%&gt;
&lt;%- end -%&gt;
</code></pre>
","<ruby-on-rails><ruby-on-rails-3><activerecord><refactoring><where>","0","44","2011-12-14 18:16:05"
"8537340","eclipse refactoring - pull up method to interface","<p>How can I change the default behaviour of eclipse so that it does not prepend the methods it pulls up to an interface with ""public abstract""</p>

<p>example, I have a 
<code>class A</code> 
that implements 
<code>interface IA</code>. Suppose I added a method <code>void a()</code> to A, and I right click on that method, and select ""Refactor->Pull Up"", and than make sure <code>void a ()</code> is selected and I choose the <code>interface IA</code>, and click ok, a method called <code>public abstract void a();</code> gets created in IA, I want to get rid of the <code>public abstract</code> bit.</p>

<p>Is there a way to do that?</p>

<p>Thank You</p>
","<eclipse><refactoring>","4","125","2011-12-16 16:46:04"
"8540111","How to navigate to a closing bracket with ReSharper?","<p>Say you have a large amount of C# code in an if statement.  If you place your carat next to the opening bracket, is there a hotkey or something in ReSharper that will automatically take you to the closing bracket?</p>
","<refactoring><resharper><hotkey><curly-brackets>","1","105","2011-12-16 21:03:52"
"8549122","How to refact UPDATE via SELECT","<p>I have this structure of my db:</p>

<pre><code>CREATE TABLE IF NOT EXISTS `peoples` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;
</code></pre>

<p>For customers.</p>

<pre><code>CREATE TABLE IF NOT EXISTS `peoplesaddresses` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `people_id` int(10) unsigned NOT NULL,
  `phone` varchar(20) COLLATE utf8_unicode_ci NOT NULL,
  `address` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;
</code></pre>

<p>For their addresses.</p>

<pre><code>CREATE TABLE IF NOT EXISTS `peoplesphones` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `people_id` int(10) unsigned NOT NULL,
  `phone` varchar(20) COLLATE utf8_unicode_ci NOT NULL,
  `address` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;
</code></pre>

<p>For their phones.</p>

<p><strong>UPD4</strong></p>

<pre><code>ALTER TABLE peoplesaddresses DISABLE KEYS; 
ALTER TABLE peoplesphones DISABLE KEYS; 

ALTER TABLE peoplesaddresses ADD INDEX i_phone (phone);
ALTER TABLE peoplesphones ADD INDEX i_phone (phone);
ALTER TABLE peoplesaddresses ADD INDEX i_address (address);
ALTER TABLE peoplesphones ADD INDEX i_address (address);

ALTER TABLE peoplesaddresses ENABLE KEYS;
ALTER TABLE peoplesphones ENABLE KEYS;
</code></pre>

<p><strong>END UPD4</strong></p>

<pre><code>CREATE TABLE IF NOT EXISTS `order` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `people_id` int(10) unsigned NOT NULL,
  `name` varchar(255) CHARACTER SET utf8 NOT NULL,
  `phone` varchar(255) CHARACTER SET utf8 NOT NULL,
  `adress` varchar(255) CHARACTER SET utf8 NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=12 ;

INSERT INTO `order` (`id`, `people_id`, `name`, `phone`, `adress`) VALUES
(1, 0, 'name1', 'phone1', 'address1'),
(2, 0, 'name1_1', 'phone1', 'address1_1'),
(3, 0, 'name1_1', 'phone1', 'address1_2'),
(4, 0, 'name2', 'phone2', 'address2'),
(5, 0, 'name2_1', 'phone2', 'address2_1'),
(6, 0, 'name3', 'phone3', 'address3'),
(7, 0, 'name4', 'phone4', 'address4'),
(8, 0, 'name1_1', 'phone5', 'address1_1'),
(9, 0, 'name1_1', 'phone5', 'address1_2'),
(11, 0, 'name1', 'phone1', 'address1'),
(10, 0, 'name1', 'phone1', 'address1');
</code></pre>

<p>Production base have over 9000 records. Is there way to execute this 3 update query's little more faster, than now (~50 min on dev machine).</p>

<pre><code>INSERT INTO peoplesphones( phone, address ) 
SELECT DISTINCT `order`.phone, `order`.adress
FROM `order` 
GROUP BY `order`.phone;
</code></pre>

<p>Fill peoplesphones table with unique phones</p>

<pre><code>INSERT INTO peoplesaddresses( phone, address ) 
SELECT DISTINCT `order`.phone, `order`.adress
FROM `order` 
GROUP BY `order`.adress;
</code></pre>

<p>Fill peoplesaddresses table with unique adress.
The next three querys are very slow:</p>

<pre><code>UPDATE peoplesaddresses, peoplesphones SET peoplesaddresses.people_id = peoplesphones.id WHERE peoplesaddresses.phone = peoplesphones.phone;

UPDATE peoplesaddresses, peoplesphones SET peoplesphones.people_id = peoplesaddresses.people_id WHERE peoplesaddresses.address = peoplesphones.address;

UPDATE `order`, `peoplesphones` SET `order`.people_id = `peoplesphones`.people_id where `order`.phone = `peoplesphones`.phone;
</code></pre>

<p>Finally fill people table, and clear uneccessary fields.</p>

<pre><code>INSERT INTO peoples( id, name ) 
SELECT DISTINCT `order`.people_id, `order`.name
FROM `order` 
GROUP BY `order`.people_id;

ALTER TABLE `peoplesphones`
  DROP `address`;

ALTER TABLE `peoplesaddresses`
  DROP `phone`;
</code></pre>

<p>So, again: How can I make those UPDATE query's a little more faster? THX.</p>

<p><strong>UPD:</strong> I forgott to say: I need to do it at once, just for migrate phones and adresses into other tables since one people can have more than one phone, and can order pizza not only at home.</p>

<p><strong>UPD2:</strong></p>

<p><img src=""http://i.stack.imgur.com/6nKVU.png"" alt=""MySQL Variables"">
<strong>UPD3:</strong></p>

<p>Replace slow update querys on this (without with) get nothing.</p>

<pre><code>UPDATE  peoplesaddresses
LEFT JOIN
        peoplesphones
ON      peoplesaddresses.phone = peoplesphones.phone
SET     peoplesaddresses.people_id = peoplesphones.id;

UPDATE  peoplesphones
LEFT JOIN
        `peoplesaddresses`
ON      `peoplesaddresses`.address = `peoplesphones`.address
SET     `peoplesphones`.people_id = `peoplesaddresses`.people_id;

UPDATE  `order`
LEFT JOIN
        `peoplesphones`
ON      `order`.phone = `peoplesphones`.phone
SET     `order`.people_id = `peoplesphones`.people_id;
</code></pre>

<p><strong>UPD4</strong> After adding code at the top (upd4), script takes a few seconds for execute. But on ~6.5k query it terminate with text: ""The system cannot find the Drive specified"".</p>

<p>Thanks to All. Especially to xQbert and Brent Baisley.</p>
","<mysql><sql><database><refactoring>","4","102","2011-12-18 01:01:41"
"8562224","How can I automatically replace the ternary operator by if/else?","<p>Sometimes I get some very ugly code which uses the <a href=""http://en.wikipedia.org/wiki/Ternary_operation"" rel=""nofollow"">ternary operator</a> too often. I would like to be able to detect such ternary operators:</p>

<pre><code>statement ? if-block : else-block;
</code></pre>

<p>and replace them by </p>

<pre><code>if (statement) {
    if-block
} else {
    else-block
}
</code></pre>

<p>If solution should work with Java.</p>
","<refactoring><ternary-operator>","0","65","2011-12-19 13:44:11"
"8564772","Refactoring Plan for 17+ years of un-testable Delphi Code","<p>You've all heard it before, classic Delphi application.</p>

<p>With 3rd party libraries we're at 1.5 million lines of code, probably 200,000 of our own (Dev Express, NexusDB, etc etc)</p>

<p>One huge Datamodule that I've been slowly splitting into 5 (and likely need more).  Moving some business logic to these datamodules slowly but surely as methods of the module.</p>

<p>Everything coded 'under the button', no classes of our own.  A few forms have 20k lines of code.</p>

<p>I need a reasonable plan to get this in a better place.  Right now you can't really test ANY of it, minor changes could introduce an army of bugs, etc.</p>

<p>I was thinking, to start, get a unit going for each major form and extract business logic in the form to this class/unit.  Something like TMyForm has a TMyFormClass.pas so that TmyForm ends up with nothing but UI.  Continue to modularize the datamodules, write tests asap.  Only refactor where we're working on.</p>

<p>Sound sane, addition suggestions, somebody please send me liqour....</p>
","<delphi><oop><refactoring>","7","309","2011-12-19 17:02:24"
"8568111","How do I ensure that I don't break the test code when I refactor it?","<p>Code evolves, and as it does, it also decays if not pruned, a bit like a garden in that respect. Pruning mean refactoring to make it fulfill its evolving purpose.</p>

<p>Refactoring is much safer if we have a good unit test coverage. 
Test-driven development forces us to write the test code first, before the production code. Hence, we can't test the implementation, because there isn't any. This makes it much easier to refactor the production code.</p>

<p>The TDD cycle is something like this: write a test, test fails, write production code until the test succeeds, refactor the code.</p>

<p>But from what I've seen, people refactor the production code, but not the test code. As test code decays, the production code will go stale and then everything goes downhill. Therefore, I think it is necessary to refactor test code.</p>

<p>Here's the problem: How do you ensure that you don't break the test code when you refactor it?</p>

<p>(I've done one approach, <a href=""https://thecomsci.wordpress.com/2011/12/19/double-dabble/"" rel=""nofollow"">https://thecomsci.wordpress.com/2011/12/19/double-dabble/</a>, but I think there might be a better way.)</p>

<p>Apparently there's a book, <a href=""http://rads.stackoverflow.com/amzn/click/0131495054"" rel=""nofollow"">http://www.amazon.com/dp/0131495054</a>, which I haven't read yet.</p>

<p>There's also a Wiki page about this, <a href=""http://c2.com/cgi/wiki?RefactoringTestCode"" rel=""nofollow"">http://c2.com/cgi/wiki?RefactoringTestCode</a>, which doesn't have a solution.</p>
","<unit-testing><refactoring><tdd>","6","190","2011-12-19 21:57:48"
"8579866","What is a refactoring participant in words?","<p>Is there any short definition about 'participants' in the context of refactoring extensions?</p>

<p><a href=""http://help.eclipse.org/indigo/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/ltk/core/refactoring/participants/package-summary.html"" rel=""nofollow"">org.eclipse.ltk.core.refactoring.participants.RefactoringParticipant</a> talks about participants, but there is no information about <em>what is a participant</em></p>

<p>Is it a person, an animal, a piece of code?</p>

<p>I've searched a lot, but I can't find any valid definition of what is a ""participant""</p>

<p>Thank you very much</p>
","<java><refactoring>","1","61","2011-12-20 18:03:27"
"8586281","refactoring this code","<p>I'm interested in seeing how people would refactor this code to make it more readable, remove local variables etc. The code checks a string against a number of arrays. The first (0) field of each array is the root word and the rest of the words are it's synonyms. The idea is to replace any word in the user provided string with the root word or provide the user supplied word if none were found. </p>

<p>import java.util.Arrays;</p>

<pre><code>public class Synonymiser {

private final static int ROOT_WORD = 0;

private String[][] mSynonyms;

public Synonymiser(String[]... synonyms) {
    super();
    this.mSynonyms = synonyms;
}


public String normaliseString(String inStr){
    String[] inArr = inStr.split("" "");
    boolean matchFound;

    for (int i = 0; i &lt; inArr.length; i++){
        matchFound=false;
        for (String[] synonymArr : mSynonyms){
             for(int j = 0 ; j &lt; synonymArr.length; j++){
                 if (inArr[i].equalsIgnoreCase(synonymArr[j])){
                     inArr[i] = synonymArr[ROOT_WORD];
                     matchFound = true;
                 }
                 if (matchFound) break; 
             }
             if (matchFound)  break; 
        }
    }
    return Arrays.toString(inArr);
}

public static void main(String [] args){
    String[] ar1 = new String[] {""one"", ""two"", ""three"", ""four"", ""five""};
    String[] ar2 = new String[] {""six"", ""seven"", ""eight""};
    Synonymiser s = new Synonymiser(ar1, ar2);

    System.out.println(s.normaliseString(""one two seven bulb""));
}
</code></pre>

<p>}</p>
","<java><refactoring>","0","57","2011-12-21 07:19:25"
"8587082","How to refactor Android xml in Eclipse?","<p>The GUI designer for Android in Eclipse spits out this type of XML (into a layout):</p>

<p><code>&lt;Button android:layout_height=""wrap_content"" android:id=""@+id/btnSaveMessage"" android:layout_width=""wrap_content"" android:layout_gravity=""right"" android:text=""@string/text_save"" android:width=""125dp""&gt;&lt;/Button&gt;</code></p>

<p>Is there a refactoring in Eclipse to turn this goo into pretty formatted XML like this:</p>

<pre><code>&lt;Button android:layout_height=""wrap_content"" 
        android:id=""@+id/btnSaveMessage"" 
        android:layout_width=""wrap_content"" 
        android:layout_gravity=""right"" 
        android:text=""@string/text_save"" 
        android:width=""125dp""/&gt;
</code></pre>
","<android><eclipse><refactoring>","1","136","2011-12-21 08:45:43"
"8596030","Keep Test classes in sync with Source classes","<p>In Eclipse, I have two source folders, one called <code>src</code> the other called <code>test</code>. They have the exact same package structure and each src Class has a test equivalent with ""Test"" appended to its name. Sometimes, I move my src classes during refactoring. Is there a setting where Eclipse automatically moves the test classes as well? Also, the same with renaming source classes.</p>
","<eclipse><automated-refactoring>","1","32","2011-12-21 20:36:28"
"8599023","@VisibleForTesting is a smell that suggests which refactoring?","<p>I understand that @VisibleForTesting is not desirable because it changes the interface of a class just for testing purposes while ideally we should test the same interface that we actually use. But what would be some suggested refactorings?</p>
","<refactoring><easymock>","4","424","2011-12-22 03:04:59"
"8600094","Refactoring in Emacs","<p>I am working on splitting code into smaller files and refactoring it a bit. Consider the following code below as the section I want to extract:</p>

<pre><code>(require 'package)
(add-to-list 'package-archives
             '(""marmalade"" . ""http://marmalade-repo.org/packages/"") t)
(package-initialize)
(when (not package-archive-contents)
  (package-refresh-contents))

(defvar my-packages '(org magit)
  ""A list of packages to ensure are installed at launch."")

(dolist (p my-packages)
  (when (not (package-installed-p p))
    (package-install p)))
</code></pre>

<ul>
<li>I want to take the section above and replace it with something like <code>(require `file-name)</code></li>
<li>Then take the text replaced and place that in a new file in the current directory named <code>file-name.el</code></li>
<li>And then add a line to the top of the file <code>(provides `file-name)</code></li>
</ul>

<p>It would be great if I could hit a keychord and then type a name and have this happen. If there is an easy way to do this then I would love to hear possible solutions.</p>

<p><strong>Edit:</strong>
I'm starting a bounty because I think this applies to more types of code than Lisp and I would like to have something a little more general that I can expand upon. </p>

<p>I have considered yasnippet but I don't think it's powerful enough to perform the task at hand. Basically the ideal workflow would be marking the lines to be extracted, replacing that with an appropriate require or include directive and sending the text off to it's own file. Ideally one command and something that is aware of the type of file being edited or at least the major mode so the behavior can be customized, again yasnippet is good at performing different tasks when editing in different major modes however I would have no idea how to make that work or evaluate the possibility of making it work.</p>

<p>Let me know if you need any more information.</p>
","<emacs><refactoring>","4","295","2011-12-22 06:18:04"
"8609894","Working on a legacy Rails application","<p>I have a very old and poorly written Rails app. There are about 9000 lines of code and zero tests. Most of the code is in controllers, and even worse, there are tons of external API calls, system calls to random scripts, etc.</p>

<p>There is also no development environment, everything is set up to work against the production databases. Well not just one database, there are about 10 different databases, since the app is kind of admin backend for a larger site.</p>

<p>My first idea was to get at least somewhat decent test coverage around the parts that I'm going to work on, but I'm unable to get the thing working anywhere else than on the production servers.</p>

<p>Also there are tons of old gems and deprecated warnings, but I can't even think about upgrading the gems until there are tests. Rewrite of the whole up is not an option, and I'm going to have to add/change stuff soon.</p>

<p>I'm not really sure how to approach testing such an app, since there's just so much stuff that can go wrong. What I'd really like to do, is to write some integration tests and then start refactoring, but I can't do that on a production environment. </p>

<p>Writing unit tests with bunch of stubs and mocks doesn't seem that helpful, since the code I'm going to work on basically has to be rewritten from scratch.</p>

<p>What are some steps I can take to basically duplicate a hugeass complex production environment on my development machine, so I can do stuff in isolation? </p>

<p><strong>edit:</strong> A little fun fact about the app. When I tried to run it for the first time, it kept on freezing without any error messages ... until about a half hour later I found out, that the timeout to connecting to a database (which wasn't available) was set to <strong>90 minutes</strong>!</p>
","<ruby-on-rails><ruby><testing><refactoring><legacy>","5","127","2011-12-22 21:24:20"
"8611226","How do you refactor static classes to use dependency injection?","<p>I've inherited some code that has a class AuthenticationManager with all static methods.</p>

<p>Im introducing DI and wanted to add a constructor that took a dependency UserController</p>

<pre><code>UserController _userController;

public AuthenticationManager(UserController userCont)
{
    _userController = userCont;
}
</code></pre>

<p>Now Im getting the compile time error as a non-static variable is referenced from a static method. What would your best practice recommendation be to get this to work with the minmimal changes to this class and the calling code?</p>

<p>We're using the SimpleServiceLocator as the IOC container.</p>
","<dependency-injection><refactoring><inversion-of-control><static-methods><legacy-code>","7","133","2011-12-23 00:30:26"
"8606944","Git feature branches and minor code improvements","<p>We just started using git for our production code, and we are running into a slight issue in our workflow.  We need to figure out how to handle general code improvements / technical debt fixes that come up while working on a feature.</p>

<p>The workflow we have adopted is to use 'develop' as the main integration branch and develop all features on feature branches off of 'develop'.  When a feature is complete, the developer creates a pull request and everyone reviews it to provide comments before it is merged back into develop.  This seems to be working very well.</p>

<p>The issue we have is that during routine development on a feature, the developer may end up wanting to modify/refactor some common code to improve the system or clean up some technical debt.  This change is valuable, but not directly tied to the feature under development.</p>

<p>Based on our workflow, it should really be done on a different branch that goes through it's own pull request and code review before getting into develop.  If we have them do this though, how can they get the change back over onto their feature branch in the meantime while they wait for the full code review to happen and the code to get merged into develop.</p>

<p>The ideas we have are:</p>

<p>1) cherry-pick the changes from the 'refactorX' branch into our feature branch.  Continue developing and let git (hopefully) figure out when we merge back to develop that it already has the change from the refactor branch.</p>

<p>2) Merge the 'refactorX' branch into our feature branch and continue development.  (note: the branch off develop for 'refactorX' may have been later in the history of develop, so we think this may have problems)</p>

<p>3) Some other smarter option we don't know yet. :)</p>

<p>What we are looking for is some best practice guidance on how to handle this part of the workflow.  After talking about it more we know that it will come up frequently and we want to find a smooth and efficient way to handle it in our workflow.</p>

<p>Any recommendations?</p>
","<git><refactoring><workflow><branch><git-flow>","3","118","2011-12-22 16:34:41"
"8612931","how to re-factor/extract methods to separate file for re-use","<p>I'm fairly new to the whole JQuery/javascript world, but I've managed to wack together a working jqgrid with a datepicker &amp; custom control (used jquery auto complete) based on code samples i found on the net. I've added the code to a T4 template in my project as it'll probably act as a base/starting point for most pages. (Side note. I'm using asp.net MVC)</p>

<p>JFIDDLE: <a href=""http://jsfiddle.net/Yenros/ZzLdp/5/"" rel=""nofollow"">LINK</a></p>

<p>1.) I'd like to move the <strong>initDateEdit</strong> &amp; <strong>initDateSearch</strong> to the same function (using a parameter, to disable/enable the showOn property) as they are basically similar.</p>

<p>2.) How would be the best way to set nonWorkingDates from outside the new function/file. same applies to the autocomplete_element (I'd like to specify the url)</p>

<p>Changing </p>

<p>""<strong>function nonWorkingDates(date)</strong>"" to => ""<strong>function nonWorkingDates(date, nonWorkingDates)</strong>"" </p>

<p>isn't working, (guess it's got got something to do with how its gets called ""<strong>beforeShowDay: nonWorkingDates</strong>"")</p>

<p>Thanks in advance!</p>
","<javascript><jquery><jqgrid><refactoring><jqgrid-asp.net>","2","65","2011-12-23 06:28:56"
"8613214","Debugging and difference search after refactoring in Visual Stduio","<p>I am involved in a c++ refactoring project and sometimes there are differences resulting, when there should be none. Currently, what I do is basically setting a breakpoint at some place, and then go through the program by F10/F11. The first problem is the size of the projects, traversing it takes a lot of time. Second, sometimes I have differences only in the end of a very big test sentences (say, 600 words), thus just getting to the different word is painfully slow.<br>
1. Is it possible to write some kind of macro for Visual Studio, which will start from the breakpoint, then go step-by-step through the program until end while printing some fields?<br>
2. Are there any neat tricks or tools to simplify the task?<br>
Thanks!</p>
","<c++><visual-studio><debugging><macros><refactoring>","1","31","2011-12-23 07:07:29"
"8607513","pygame class structure","<p>My goal is to make a module that will make a grid on a pygame canvas and allow you to highlight boxes by their x and y coords. </p>

<p>Here is a simple example usage.</p>

<pre><code>from grid import Grid

g = Grid(100, 100, 10) # width and height in cells, cell width in pixels
g.highlightBox(2, 2, (0, 255, 0)) # cell x and y, rgb color tuple
g.clearGrid()
</code></pre>

<p>Here is the code I have so far. The problem is, I need to have an event loop to keep the window open and make the close button functional, but I also need to allow the other functions to draw to the screen.</p>

<pre><code>import pygame
import sys

class Grid:
    colors = {""blue"":(0, 0, 255), ""red"":(255, 0, 0), ""green"":(0, 255, 0), ""black"":(0, 0, 0), ""white"":(255, 255, 255)}

    def __init__(self, width, height, cellSize, borderWidth=1):
        self.cellSize = cellSize
        self.borderWidth = borderWidth
        self.width = width * (cellSize + borderWidth)
        self.height = height * (cellSize + borderWidth)
        self.screen = pygame.display.set_mode((self.width, self.height))

        running = True
        while running:
            event = pygame.event.poll()
            if event.type == pygame.QUIT:
                running = False

    def clearGrid(self):
        pass

    def highlightBox(self, x, y, color):
        xx = x * (self.cellSize + self.borderWidth)
        yy = y * (self.cellSize + self.borderWidth)
        pygame.draw.rect(self.screen, color, (xx, yy, self.cellSize, self.cellSize), 0)
</code></pre>

<p>When I run the first sample, the code will be stuck in the loop, not allowing me to run the <code>highlightBox</code> function until the loop is done(the exit button is pressed).</p>
","<python><refactoring><pygame>","1","173","2011-12-22 17:17:00"
"8617891","Refactoring: Count total lines in all files under a given folder","<p>I wrote a code to count the number of lines in all the files in a given folder. It works fine, but I am trying to include all the possible C#'s features to refactor it to more compact and efficient code. Please help me do that. </p>

<p>Here is the code.</p>

<pre><code>    class LineNumberCounter
{
    public static string Calculate(string folderPath, string pattern = ""*.txt"")
    {
        DirectoryInfo dirInfo = new DirectoryInfo(folderPath.Trim());
        if (!dirInfo.Exists)
            throw new ArgumentException(""No such directory exists"");

        StringBuilder returnValue = new StringBuilder();
        long totalLines = 0;

        pattern.Split(new char[] { ';' }, StringSplitOptions.RemoveEmptyEntries).All(filter =&gt;
        {
            int count = 0;
            dirInfo.GetFiles(filter.Trim(), 
                SearchOption.AllDirectories).All(file =&gt;
                {
                    using (StreamReader reader = file.OpenText())
                    {
                        for (; reader.Peek() &gt; -1; count++)
                            reader.ReadLine();
                    }
                    returnValue.AppendLine(string.Format(""Number of lines with {0} pattern is {1}"",
                        filter, count));
                    totalLines += count;

                    return true;
                }
            );

            return true;
        });

        //foreach (string filter in
        //    pattern.Split(new char[] { ';' },
        //        StringSplitOptions.RemoveEmptyEntries))
        //{
        //    FileInfo[] files = dirInfo.GetFiles(filter.Trim(),
        //        SearchOption.AllDirectories);
        //    int count = 0;
        //    Array.ForEach&lt;FileInfo&gt;(files, file =&gt;
        //    {
        //        using (StreamReader reader = file.OpenText())
        //        {
        //            for (; reader.Peek() &gt; -1; count++)
        //                reader.ReadLine();
        //        }
        //    });

        //    returnValue.AppendLine(string.Format(""Number of lines with {0} pattern is {1}"",
        //        filter, count));
        //    totalLines += count;
        //}

        returnValue.AppendLine();
        returnValue.AppendLine(""Total Lines = "" + totalLines);

        return returnValue.ToString();
    }
}
</code></pre>

<p>Commented lines were the ones I wrote originally. I made some attempt to refactor it. But still want to check if it has any more scope.</p>
","<c#><.net-4.0><refactoring>","4","129","2011-12-23 15:45:47"
"8617803","Should I create an exception object in an initializer or code it in every method?","<p>In my Service classes I create an exception instance like this:</p>

<pre><code>protected ServiceException _ex;

protected void Initialize()
{
    _ex = new ServiceException();
}
</code></pre>

<p>Later in these classes I call this exception if something goes wrong:</p>

<pre><code>    public void Delete&lt;T, V&gt;(T item, V repo)
        where T : Microsoft.WindowsAzure.StorageClient.TableServiceEntity
        where V : IAzureTable&lt;T&gt;
    {
        try
        {
            repo.Delete(item);
        }
        catch (Exception ex)
        {
            _ex.Errors.Add("""", ""Error when deleting "" + typeof(T).Name.ToLower());
            throw _ex;
        }
    }
</code></pre>

<p>Outside of this in the controller I check for the exception:</p>

<pre><code>    catch (Exception e) { log(e); }
</code></pre>

<p>Then I handle this:</p>

<pre><code>    protected void log(Exception ex)
    {
        if (ex is ServiceException)
        {
            ModelState.Merge(((ServiceException)ex).Errors);  
        }
        else
        {
            Trace.Write(ex);
            ModelState.AddModelError("""", ""Database access error: "" + ex.Message);
        }
    }
</code></pre>

<p>Sorry for the long example but what I would like to know is if this is a valid thing for me to be doing. In particular someone commented that I am creating a new value of _ex every time even if there's no exception. Well my reason for doing this was that each controller has about twenty try-catch blocks and I thought it better to just create an _ex object at the start and so not have to have twenty areas where I create a new _ex if something goes wrong. I'd appreciate if someone could tell me if this all makes sense.  Thanks.</p>
","<c#><design><exception><refactoring>","0","55","2011-12-23 15:37:17"
"8630937","Refactor my code : Avoiding casting in derived class","<p>Firstly, I feel sorry about the title, I do not know how to describe my problem exactly. I hope it will be better explained through the code.</p>

<pre><code>public abstract class AB {
  public MyModel Model;
}

public class A : AB {
  public A() {
    Model = new MyModelA();
  }

  public void AMethod() {
    var model = (MyModelA) model; // I have to do this all place
  }

  public void AnotherMethod() {
    var model = (MyModelA) model; // same here
    model.NewInt = 123;
  }
}

public abstract class MyModel {

}

public class MyModelA : MyModel {
  // new properties
  public int NewInt {get;set;}
}
</code></pre>

<p>Take a look at the code, in order to use new properties from derived class, I have to do a cast but it is ugly when I have to use it same time all over places. </p>

<p>The method I think is declare another property: <code>public MyModelA _tmp</code> then I cast it in the constructor <code>_tmp = (MyModelA) Model</code> and use it instead of Model.</p>

<p>Are there any other appropriate ways to do this ?
Thanks !</p>
","<c#><refactoring>","0","75","2011-12-25 18:39:15"
"8626631","how to refactor to a different class in visual studio","<p>I can refactor a big code to a new method which automatically sets the parameters, return type, if static or not etc in the same class. Is there a way that I can move the code to a new function in a different class if I could specify the class somehow? May be I'm missing something silly.</p>
","<visual-studio><methods><refactoring>","0","53","2011-12-24 20:11:09"
"8640701","Python: Optimizing Code Using SQLite3 + Mutagen","<p>I'm in the process of improving an open-source music database, which reads songs in from my collection and stores them to an SQLite database.  In turn, I'm able to leverage the database to find duplicates, run queries on my collection, and (if I so desired) find duplicate songs in the collection.  To read the metadata from the music files, I'm leveraging the <a href=""http://code.google.com/p/mutagen"" rel=""nofollow"">Mutagen</a> library, and to store the metadata, I'm using SQLite3.</p>

<p>I wanted to test the code I had authored on a sizable collection, so I contacted fellow students and family, and came across a total test size of about 90,000.  This also consists of mixed information - songs are of either .mp3, .ogg, or .flac format.</p>

<p>My main issue is with speed - the code that I have works, but it is unsuitably slow.  In its current state, it runs through the test size in about <strong>35:45</strong>.  My main question:  <strong>what can I do to improve the performance of this block of code?</strong> I think that it is related directly to something within either Mutagen directly or SQLite3, although I'm open to suggestions on what would be an ideal approach to improve efficiency from here.</p>

<hr>

<p>I had gone through two iterations of improving this critical part of code.  The first improvement led to a reduced runtime of <strong>21:30</strong>, but that's still horrible.  I decided to refactor the code to reduce the number of function calls made, and an attempt to improve performance.  The result, however, is a regression of performance, but a <em>huge</em> reduction in the number of function calls made - the second batch runs for close to <strong>51:51</strong>, which is simply unacceptable.</p>

<p>What follows in terms of code is for both the ""improved"" runtime and refactored set.  Also attached are separate profiles for each piece of code.</p>

<p>Any and all suggestions are appreciated.  Thanks for taking the time to look at it!</p>

<h1>Block 1:  ""Improved"" Runtime</h1>

<pre><code>def walk(self, d):
    '''Walk down the file structure iteratively, gathering file names to be read in.'''
    d = os.path.abspath(d)
    dirpath = os.walk(d)
    for folder in dirpath:
        for f in folder[2]: # for each file in the folder...
            supported = 'mp3', 'ogg', 'flac'
            if f.split('.')[-1] in supported:
                try:
                    self.parse(os.path.join(folder[0], f))
                    if self.filecount == 2000 or self.leftover:
                        self.filecount = 0
                        try:
                            self.db.execute_batch_insert_statement(u""INSERT INTO song VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"", self.buf)
                        except Exception, e:
                            print e.__unicode__()
                        finally:
                            del self.buf
                            self.buf = [] # wipe the buffers clean so we can repeat a batch parse again.
                except Exception, e:
                    print e.__unicode__()
    try:
        self.db.execute_batch_insert_statement(u""INSERT INTO song VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"", self.buf)
    except Exception, e:
        print e.__unicode__()
    finally:
        del self.buf
        self.buf = [] # wipe the buffers clean so we can repeat a batch parse again.

def parse(self, filename):
    '''Process and parse the music file to extract desired information.

    It may be the case that, in the future, we require more information from a song than is provided at this time.
    Examine all tags that can be retrieved from a mutagen.File object, and adjust the database's schema accordingly.'''

    if "".ogg"" in filename:
        song = OggVorbis(filename)
    elif "".mp3"" in filename:
        song = MP3(filename)
    elif "".flac"" in filename:
        song = FLAC(filename)
    else:
        raise InvalidSongException(u""Song is not supported by K'atun at this time."")

    filename = u'filename'

    #song = mutagen.File(filename, easy=True)
    artist, title, genre, track, album, bitrate, year, month = '', '', '', '', '', '', '', ''
    try:
        artist = song['artist'][0]
        title = song['title'][0]
    except Exception:
        raise InvalidSongException(u""Cannot read "" + filename + "": missing critical song information."")
    if 'genre' in song:
        genre = song['genre'][0]
    else:
        genre = u'Unknown'
    if 'tracknumber' in song:
        track = song['tracknumber'][0]
    else:
        track = 0
    if 'album' in song:
        album = song['album'][0]
    else:
        album = u'Unknown'
    if 'date' in song:
        year = song['date'][0]
    else:
        year = 'Unknown'
    try:
        bitrate = int(song.info.bitrate)
    except AttributeError: # Likely due to us messing with FLAC
        bitrate = 999999 # Set to a special flag value, to indicate that this is a lossless file.
    self.buf.append((filename, artist, filename.split('.')[-1], title, genre, track, album, bitrate, year, time.time()))
    self.filecount += 1

Sat Dec 24 21:24:23 2011    modified.dat

     70626027 function calls (70576436 primitive calls) in 1290.127 CPU seconds

Ordered by: cumulative time
List reduced from 666 to 28 due to restriction &lt;28&gt;

ncalls  tottime  percall  cumtime  percall filename:lineno(function)
    1    0.033    0.033 1290.127 1290.127 parser.py:6(&lt;module&gt;)
    1    0.000    0.000 1290.090 1290.090 parser.py:90(main)
    1    0.000    0.000 1286.493 1286.493 parser.py:24(__init__)
    1    1.826    1.826 1286.335 1286.335 parser.py:35(walk)
90744    2.376    0.000 1264.788    0.014 parser.py:55(parse)
90744   11.840    0.000 1250.401    0.014 lib/mutagen/__init__.py:158(File)
376019  613.881    0.002  613.881    0.002 {method 'seek' of 'file' objects}
90744    1.231    0.000  580.143    0.006 /usr/lib/pymodules/python2.7/mutagen/apev2.py:458(score)
671848  530.346    0.001  530.346    0.001 {method 'read' of 'file' objects}
90742    0.846    0.000  242.337    0.003 /usr/lib/pymodules/python2.7/mutagen/__init__.py:68(__init__)
63944    2.471    0.000  177.050    0.003 /usr/lib/pymodules/python2.7/mutagen/id3.py:1973(load)
63944    0.526    0.000  119.326    0.002 /usr/lib/pymodules/python2.7/mutagen/easyid3.py:161(__init__)
63944    4.649    0.000  118.077    0.002 /usr/lib/pymodules/python2.7/mutagen/id3.py:89(load)
26782    1.073    0.000   64.435    0.002 /usr/lib/pymodules/python2.7/mutagen/ogg.py:434(load)
127531    0.464    0.000   59.314    0.000 /usr/lib/pymodules/python2.7/mutagen/id3.py:76(__fullread)
63944    1.078    0.000   54.060    0.001 /usr/lib/pymodules/python2.7/mutagen/mp3.py:68(__init__)
26782    0.638    0.000   53.613    0.002 /usr/lib/pymodules/python2.7/mutagen/ogg.py:379(find_last)
66487    3.167    0.000   50.136    0.001 /usr/lib/pymodules/python2.7/mutagen/mp3.py:106(__try)
855079    6.415    0.000   33.237    0.000 /usr/lib/pymodules/python2.7/mutagen/id3.py:279(__read_frames)
816987    0.904    0.000   24.491    0.000 /usr/lib/pymodules/python2.7/mutagen/id3.py:321(__load_framedata)
816987    2.805    0.000   23.587    0.000 /usr/lib/pymodules/python2.7/mutagen/id3.py:1023(fromData)
60803/11257    0.370    0.000   19.036    0.002 /usr/lib/python2.7/os.py:209(walk)
11256   14.651    0.001   14.651    0.001 {posix.listdir}
816973    3.265    0.000   13.140    0.000 /usr/lib/pymodules/python2.7/mutagen/id3.py:996(_readData)
879103    4.936    0.000   11.473    0.000 /usr/lib/pymodules/python2.7/mutagen/id3.py:964(__init__)
872462    0.967    0.000   11.336    0.000 /usr/lib/pymodules/python2.7/mutagen/__init__.py:78(__getitem__)
63944    1.969    0.000   10.871    0.000 /usr/lib/pymodules/python2.7/mutagen/id3.py:443(update_to_v24)
619380    1.396    0.000    8.521    0.000 /usr/lib/pymodules/python2.7/mutagen/easyid3.py:175(__getitem__)
</code></pre>

<h1>Block 2:  Refactored Code</h1>

<pre><code>def walk(self, d):
    '''Walk down the file structure iteratively, gathering file names to be read in.'''
    d = os.path.abspath(d)
    dirpath = os.walk(d)
    parsecount = 0
    start = time.time()
    for folder in dirpath:
        for f in folder[2]: # for each file in the folder...
            filetype = f.split('.')[-1].lower()
            if filetype == 'mp3':
                try:
                    self.read_mp3(os.path.join(folder[0], f).decode('utf_8'))
                except Exception, e:
                    print e.__unicode__()
            elif filetype == 'ogg':
                try:
                    self.read_vorbis(os.path.join(folder[0], f).decode('utf_8'))
                except Exception, e:
                    print e.__unicode__()
            elif filetype == 'flac':
                try:
                    self.read_flac(os.path.join(folder[0], f).decode('utf_8'))
                except Exception, e:
                    print e.__unicode__()
            else:
                continue
            if self.filecount == 2000 or self.leftover:
                self.filecount = 0
                print ""Time differential: %1.4f s"" % (time.time() - start)
                self.batch_commit()
    try:
        print ""Wrapping up""
        self.batch_commit()
    except Exception, e:
        print e.__unicode__()
    finally:
        print ""Elapsed time: "" + str(time.time()-start)

def batch_commit(self):
    '''Insert new values into the database in large quantities.'''
    self.db.execute_batch_insert_statement(u""INSERT INTO song VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"", self.buf)
    self.buf = []

def read_mp3(self, filename):
    '''Read and extract an MP3 file's tags.  This makes use of the ID3 standard, not the easy ID3 tag system.'''
    artist, title, genre, track, album, bitrate, year = '', '', '', '', '', 0, ''

    song = MP3(filename)
    keys = song.keys()
    try:
        artist = song['TPE1'].__unicode__()
        title = song['TIT2'].__unicode__()
    except KeyError, e:
        raise InvalidSongException(u""Cannot read "" + filename + "": missing critical song information."")
    genre = song['TCON'].__unicode__() if ""TCON"" in keys else u'Unknown'
    track = song['TRCK'].__unicode__() if ""TRCK"" in keys else u'0'
    album = song['TALB'].__unicode__() if ""TALB"" in keys else u'Unknown'
    bitrate = int(song.info.bitrate)
    year = song['TDRC'].__unicode__() if ""TDRC"" in keys else u'Unknown'
    self.buf.append((filename, artist, filename.split('.')[-1], title, genre, track, album, bitrate, year, time.time()))
    self.filecount += 1

def read_vorbis(self, filename):
    '''Read and extract an Ogg Vorbis file's tags.'''
    song = OggVorbis(filename)
    artist, title, genre, track, album, bitrate, year = '', '', '', '', '', 0, ''
    try:
        artist = song['artist'][0]
        title = song['title'][0]
    except KeyError, e:
        raise InvalidSongException(u""Cannot read "" + filename + "": missing critical song information."")
    genre = song['genre'][0] if genre else u'Unknown'
    track = song['tracknumber'][0] if 'tracknumber' in song else u'0'
    album = song['album'][0] if 'album' in song else u'Unknown'
    bitrate = int(song.info.bitrate)
    year = song['date'][0] if 'date' in song else 'Unknown'
    self.buf.append((filename, artist, filename.split('.')[-1], title, genre, track, album, bitrate, year, time.time()))
    self.filecount += 1


def read_flac(self, filename):
    '''Read and extract a FLAC file's tags.'''
    song = FLAC(filename)
    artist, title, genre, track, album, bitrate, year = '', '', '', '', '', 0, ''
    try:
        artist = song['artist'][0]
        title = song['title'][0]
    except KeyError, e:
        raise InvalidSongException(u""Cannot read "" + filename + "": missing critical song information."")
    genre = song['genre'][0] if genre else u'Unknown'
    track = song['tracknumber'][0] if 'tracknumber' in song else u'0'
    album = song['album'][0] if 'album' in song else u'Unknown'
    bitrate = 999999 # Special flag for K'atun; will know that this is a lossless file
    year = song['date'][0] if 'date' in song else 'Unknown'
    self.buf.append((filename, artist, filename.split('.')[-1], title, genre, track, album, bitrate, year, time.time()))
    self.filecount += 1

Mon Dec 26 03:22:34 2011    refactored.dat

59939763 function calls (59890172 primitive calls) in 3111.490 CPU seconds

Ordered by: cumulative time
List reduced from 559 to 28 due to restriction &lt;28&gt;

ncalls  tottime  percall  cumtime  percall filename:lineno(function)
1    0.001    0.001 3111.490 3111.490 parser.py:6(&lt;module&gt;)
1    0.000    0.000 3111.477 3111.477 parser.py:138(main)
1    0.000    0.000 3108.242 3108.242 parser.py:27(__init__)
1    1.760    1.760 3108.062 3108.062 parser.py:40(walk)
46    0.103    0.002 2220.618   48.274 parser.py:78(batch_commit)
46    0.002    0.000 2220.515   48.272 db_backend.py:127(execute_batch_insert_statement)
46 2184.900   47.498 2184.900   47.498 {method 'executemany' of 'sqlite3.Connection' objects}
90747    0.515    0.000  845.343    0.009 /usr/lib/pymodules/python2.7/mutagen/__init__.py:68(__init__)
426651  640.459    0.002  640.459    0.002 {method 'read' of 'file' objects}
63945    1.847    0.000  582.267    0.009 parser.py:83(read_mp3)
63945    2.372    0.000  577.245    0.009 /usr/lib/pymodules/python2.7/mutagen/id3.py:1973(load)
63945    0.307    0.000  514.927    0.008 /usr/lib/pymodules/python2.7/mutagen/id3.py:72(__init__)
63945    0.256    0.000  514.620    0.008 /usr/lib/pymodules/python2.7/mutagen/_util.py:103(__init__)
63945    0.225    0.000  514.363    0.008 /usr/lib/pymodules/python2.7/mutagen/__init__.py:35(__init__)
63945    4.188    0.000  514.139    0.008 /usr/lib/pymodules/python2.7/mutagen/id3.py:89(load)
127533    0.802    0.000  455.713    0.004 /usr/lib/pymodules/python2.7/mutagen/id3.py:76(__fullread)
63945    1.029    0.000  432.574    0.007 /usr/lib/pymodules/python2.7/mutagen/id3.py:202(__load_header)
26786    0.504    0.000  270.216    0.010 parser.py:102(read_vorbis)
26786    1.095    0.000  267.578    0.010 /usr/lib/pymodules/python2.7/mutagen/ogg.py:434(load)
26782    0.627    0.000  143.492    0.005 /usr/lib/pymodules/python2.7/mutagen/ogg.py:379(find_last)
221337  121.448    0.001  121.448    0.001 {method 'seek' of 'file' objects}
97603    1.797    0.000  118.799    0.001 /usr/lib/pymodules/python2.7/mutagen/ogg.py:66(__init__)
26786    0.342    0.000  114.656    0.004 lib/mutagen/oggvorbis.py:40(__init__)
63945    0.646    0.000   58.809    0.001 lib/mutagen/mp3.py:68(__init__)
66480    3.377    0.000   57.489    0.001 lib/mutagen/mp3.py:106(__try)
47   35.609    0.758   35.609    0.758 {method 'commit' of 'sqlite3.Connection' objects}
855108    6.184    0.000   32.181    0.000 /usr/lib/pymodules/python2.7/mutagen/id3.py:279(__read_frames)
60803/11257    0.385    0.000   31.885    0.003 /usr/lib/python2.7/os.py:209(walk)
</code></pre>
","<python><sqlite><refactoring><mutagen>","2","135","2011-12-27 02:41:00"
"8649079","Refactor two methods that generate a SelectList into a single method","<p>I have the following two methods that get data from my DB and return a populated SelectList object (including an ""All"" option value) that I then pass onto my view.  The problem is that they are almost identical with the exception that they both access different repository objects and they have different ID names (StatusId and TeamId).  I think there is an opportunity to refactor them into a single method that accepts the repository as a parameter and somehow figures out what the ID name should be, perhaps by using reflection or some sort of lambda expression, but I don't know quite how to accomplish this.  </p>

<pre><code>private SelectList GetStatusSelectList(int selectedStatusId)
{
  List&lt;MemberStatus&gt; statusList = _memberStatusRepository.All().ToList();
  statusList.Insert(0, new MemberStatus {StatusId = 0, Name = ""All""});
  var statusSelectList = new SelectList(statusList, ""StatusId"", ""Name"", selectedStatusId);
  return statusSelectList;
}

private SelectList GetTeamSelectList(int selectedTeamId)
{
  List&lt;MemberTeam&gt; teamList = _memberTeamRepository.All().ToList();
  teamList.Insert(0, new MemberTeam { TeamId = 0, Name = ""All"" });
  var teamSelectList = new SelectList(teamList, ""TeamId"", ""Name"", selectedTeamId);
  return teamSelectList;
}
</code></pre>

<p>Can anyone help figure out how to refactor these into a single method?</p>
","<c#><reflection><refactoring><selectlist>","5","107","2011-12-27 20:40:27"
"8654294","Refactoring ifs","<p>How do I refactor the below code which contains many ifs and each block contains different scenarios.</p>

<pre><code>if(condition1)
{
  ConfigCondition1();
  GetSetCondition1Results();
}
if(condition2)
{
  ConfigCondition2();
  GetSetCondition2Results();
}
if(condition3)
{
  ConfigCondition3();
  GetSetCondition3Results();
}
</code></pre>
","<c#><refactoring>","2","74","2011-12-28 09:53:10"
"8645841","How to go about refactoring/rebuilding a WPF application developed in WinForms style","<p>I am working on a Wpfapplication developed in a WinForms style; I am saying this because application consists -</p>

<ul>
<li>UserControls having more then 2000 lines of code (without any regions, members scattered all over the class). No separation of concerns whatsoever.</li>
<li>UserControls having ~1000 lines of code and corresponding ViewModel having another 1000 lines of code.</li>
<li>UserControls having a lot of event handlers (some having > 25).</li>
<li>UserControls having nested classes.</li>
<li>UserControls implementing INotifyPropertyChanged and having DP's.</li>
<li>Lot of unused classes/code (although referenced/used in code but not doing anything);</li>
<li>More then 30 MultiValue converters and 40 value converters.</li>
<li>Converter instances are used frequently in code behind/VM.</li>
<li>Few MultiValue converters
<ul>
<li>having hundreds of lines of code (few having upto 400 lines of code).</li>
<li>having business logic inside them.</li>
<li>creating the ViewModel instances.</li>
<li>having Nested classes.</li>
<li>exposing methods used by user controls in code behind.</li>
<li>exposing properties used by user controls in code behind and view models.</li>
<li>having static methods returning observable collections/Lists, used by other converters &amp; View Models.</li>
<li>exposing events, subscribed by UserControl's and view model's.</li>
<li>Implementing IDisposable.</li>
</ul></li>
<li>Converters are used extensively to create/set the DataContext and ItemSources of controls/ListViews/DataGrids:</li>
</ul>

<p>like this -</p>

<pre><code>&lt;Editor:EditorControl.DataContext&gt;
    &lt;MultiBinding Converter=""{StaticResource EditorControlModelConverter}""&gt;
        &lt;Binding
            ElementName=""UserControl""
            Path=""RefId"" /&gt;
        &lt;Binding
            ElementName=""UserControl""
            Path=""CollectionView.SelectedScenario"" /&gt;
        &lt;Binding
            ElementName=""UserControl""
            Path=""ParentComponentName"" /&gt;
    &lt;/MultiBinding&gt;
&lt;/Editor:EditorControl.DataContext&gt;
</code></pre>

<p>and this -</p>

<pre><code>&lt;ListView.ItemsSource&gt;
&lt;MultiBinding Converter=""{StaticResource ItemsSourceInsertConverter}""&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorControl.ContextListEnabled"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorContainer.ParentComponent.Model.ModelList"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorContainer.ParentComponent.Model.CategoryModelList"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorContainer.ParentComponent.Model.ItemSortOrder"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""IsItemSourceMatrixInsertConverterSuspended"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorControlModel.IsUpdating"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorControlModel.ContextListEnabledInitialized"" /&gt;
    &lt;Binding
        BindsDirectlyToSource=""true""
        ElementName=""listView"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorControlModel"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorContainer.Plugin.FeatureManager.EditorCategoryFeatureEnabled"" /&gt;
    &lt;Binding
        ElementName=""EditorControl""
        Path=""EditorContainer.Plugin.FeatureManager.EditorMatrixFeaturesEnabled"" /&gt;
&lt;/MultiBinding&gt;
</code></pre>

<p></p>

<p>List goes on...Has any one of you faced similar situation and how you dealt with it? what approach should be taken to refactor this kind of application for better performance and maintainability?</p>

<hr>

<p><strong>Update:</strong></p>

<p>Answer of Andrew's Q - ""Why we need to refactor this"": </p>

<ol>
<li><p>Performance - we are not happy with the performance of our application and feel it should be better(considering the functionality and usability). </p></li>
<li><p>Better Extensibility : we are still in early stages of our product and know that a lot of new features needs to be added in future; but looking at the current code base it looks tough and may break old functionality.</p></li>
<li><p>Better Maintainability : It will be tough to maintain a non standards-compliant/ tricky/hacky code in future(it's very imp. as we see this product running for years to come).</p></li>
</ol>
","<.net><wpf><winforms><performance><refactoring>","2","118","2011-12-27 14:40:51"
"8657955","How to refactoring methods call which looks like the same?","<p>I have different fruit class, all implements the same interface <code>IFruit</code> :</p>

<pre><code>public interface IApple : IFruit{ }  
public interface IBanana : IFruit{ }  
public interface ICarrot: IFruit{ }  
</code></pre>

<p>Each of them have their own drawer :</p>

<pre><code>public class AppleDrawer
{
    public void Draw(IApple apple, Graphics graphics){}
}

public class BananaDrawer
{
    public void Draw(IBanana banana, Graphics graphics){}
}
</code></pre>

<p>If I want to draw a list of fruit, I am doing the following</p>

<pre><code>public void DrawFruits(List&lt;IFruit&gt; fruits, Graphics graphics)
{
    foreach(var fruit in fruits)
    {
        if(fruit is IBanana)
        {
            var banana = (IBanana)fruit;
            var drawer = new BananaDrawer();
            drawer.Draw(banana, graphics);
        }
        else if(fruit is IApple)
        {
            var apple = (IApple)fruit;
            var drawer = new AppleDrawer();
            drawer.Draw(banana, graphics);
        }
        etc...

}
</code></pre>

<p>I feel extremely dirty when I read my code.<br>
My problem is the multiple if..else statement, because I have 12 differents fruits, and I have to do this statement a lot in my current project.</p>

<p>Is there a way to refactoring my DrawFruits method ?<br>
I am thinking of a kind of factory pattern but I don't really see how to do it.<br>
Is my fruit class must take a Drawer as a Property ? Or maybe I can call a Drawer Factory method ?</p>

<p>This is a pattern that I find a lot in my current project, and I don't find a solution that satisfies me.</p>
","<c#><design-patterns><refactoring>","3","92","2011-12-28 15:44:30"
"8677908","Refactoring Ideas without Resorting to Inline Views?","<p>I've created an SQL user defined function to determine if a given date is a Japanese holiday. It now consists of a monstrosity of functions that call the same inline view for the *<em>n</em>*th time and it does not look very wise.  While I know the best real-life solution is to build a calendar table, I wouldn't dare to scrap all the code lines I have written.  I look forward to refactoring ideas. Thanks.</p>

<p>Function isholiday(d) just bundles three functions; each defining three types of Japanese holidays.</p>

<pre><code>DELIMITER //
CREATE FUNCTION isholiday(d date) RETURNS int
BEGIN
DECLARE t int;
CASE WHEN isregularholiday(d) = 1
          THEN SET t = 1;
     WHEN iscarryoverholiday(d) = 1
          THEN SET t = 1;
     WHEN isdentholiday(d) = 1
          THEN SET t = 1;
     ELSE SET t = 0; END CASE;
RETURN t;
END
//
</code></pre>

<p>isregularholiday(d) looks like this:</p>

<pre><code>DELIMITER //
CREATE FUNCTION isregularholiday(d date) RETURNS int
BEGIN
DECLARE s int;
DECLARE t int;
SELECT count(*) INTO s
  FROM (SELECT holiday_desc
             , CASE WHEN SUBSTR(holiday_date, 3, 1) = '-'
                         THEN CAST(CONCAT_WS('-', YEAR(d), holiday_date) AS DATE)
                    WHEN holiday_date = 'ATH21'
                         THEN ATHLETIC_DATE(d)
  /*There are six mobile holidays but I shall spare you the other five. */     
               ELSE NULL END cnvt
          FROM holidays
         WHERE YEAR(d) BETWEEN valid_from AND valid_to) **base**
 WHERE cnvt = d;
CASE s WHEN 1 THEN SET t = 1;
       ELSE SET t = 0;
END CASE;
RETURN t;
END
//
</code></pre>

<p>Function argument d (or its month-date value) is not directly matched with holiday_date column (cf. cnvt = d) because the exact dates of some holidays are functionally dependent on the year, hence the CASE expression that branches into several functions.  The function will be referring to the inline view <strong>base</strong> all the time.</p>

<p>Now, besides the basic holidays there are two types of holidays and they are fickle.  I tentatively call them carryover holidays and dent holidays.  A carryover holiday is defined like this:
If a holiday H falls on a Sunday, the first non-holiday weekday is the carryover holiday of H.  Since there are a few holidays clamped together, the first non-holiday weekday for H is not necessarily the next day or Monday.</p>

<p>A dent holiday is a weekday between two holidays.  The carryover takes precedence over the dent holiday.</p>

<p>Because of mobile holidays both types of holidays are mobile and fickle and have to be calculated for the year.  iscarryoverholiday(d) queries <strong>base</strong> and count the number of rows for a range between d and the Sunday just before d.  If the count equals the date difference between d and the last Sunday, d is a carryover holiday.</p>

<p>isdentholiday(d) calls isregularholiday() for d, d-1 and d+1 (expected values for each argument being 0, 1, 1). It also calls iscarryoverholiday() for d (to get 0), so it reads <strong>base</strong> four times. Ah....</p>

<p>I won't bother you with any more details.  I am just wondering if I can do something smart and define a closest thing to a dynamic view on MySQL.</p>

<p>Thanks YOU for reading this far!</p>

<p>Just in case, holiday as used here excludes Sundays.</p>
","<mysql><sql><refactoring>","1","61","2011-12-30 09:14:21"
"8680652","Is there any additional Search & replace components Experts out there?","<p>I have tried the GExperts Replace Components expert in Delphi 2010 and it seems there is a bug in it.</p>

<p><a href=""http://stackoverflow.com/questions/8671119/gexperts-replace-components-expert-doesnt-replace-the-text-in-the-form-file"">GExpert&#39;s Replace Components Expert doesn&#39;t replace the text in the form file (*.dfm)</a></p>

<p>Does anyone know of another expert, tools, or method for replace all components in a delphi project in Delphi 2010, in both the unit and the dfm file?</p>

<p>Example: replace all TEdits with TRzEdits, etc.</p>

<p>thanx</p>
","<delphi><refactoring><components><delphi-2010>","0","115","2011-12-30 14:50:44"
"8689061","SQL - JOIN on two result tables, ideas to refactor?","<p>This may already have been asked, but StackOverflow is massive and trying to google for something specific enough to actually help is a nightmare!</p>

<p>I've ended up with a fairly large SQL query, and was wondering if SO could maybe point out easier methods for doing it that I might have missed.</p>

<p>I have a table called <code>usage</code> with the following structure:</p>

<pre><code>host    | character varying(32)       | 
usage   | integer                     | 
logtime | timestamp without time zone | default now()
</code></pre>

<p>I want to get the usage value for both the MAX and MIN logtimes. After working through some of my old textbooks (been a while since I really used SQL properly), I've ended up with this JOIN:</p>

<pre><code>SELECT *
FROM (SELECT u.host,u.usage AS min_val,r2.min
  FROM usage u
  JOIN (SELECT host,min(logtime) FROM usage GROUP BY host) r2
  ON u.host = r2.host AND u.logtime = r2.min) min_table
NATURAL JOIN (SELECT u.host,u.usage AS max_val,r1.max
  FROM usage u
  JOIN (SELECT host,max(logtime) FROM usage GROUP BY host) r1
  ON u.host = r1.host AND u.logtime = r1.max) max_table
;
</code></pre>

<p>This seems like a messy way to do it, as I'm basically running the same query twice, once with MAX and once with MIN. I can get both logtime columns in one query by doing <code>SELECT usage,MAX(logtime),MIN(logtime) FROM ...</code>, but I couldn't work out how to then show the usage values that correspond to the two different records.</p>

<p>Any ideas?</p>
","<sql><postgresql><join><refactoring>","2","75","2011-12-31 15:59:25"
"8691186","Should I give up on refactoring this and plan a rewrite?","<p>I'm tasked with maintaining a modestly large system (~60k LOC of non-Moose OO Perl). I'm starting to question the wisdom of refactoring it rather than rewriting it. I know this question has been discussed at length, but the situation is unusually complex and has several elements that point strongly in opposite directions, hence my question. Sorry for the verbosity of the question; it's as concise as I could manage while getting the whole picture across.</p>

<p>As the system stands, it's abstractions are quite poor at encapsulating anything cleanly as evidenced by frequent reliance on action at a distance, copious use of if/else blocks with intimate knowledge of objects of a type unrelated to the module at hand, and a dependency graph which looks like a social network. This, I felt, was bad, but could be refactored.</p>

<p>Test coverage is spotty. This is, of course, fixable, and needs to be fixed before the refactor. Of course, in a system like that, tests need absurd amounts of scaffolding, which makes improving the test coverage more arduous, but still, it's hardly impossible.</p>

<p>And so I'd planned to spend a lot of time slowly bringing some order to the chaos. Hard, but doable, I thought, and the system does work well enough for business purposes, despite all it's issues, so it must be doing something right. And ""everyone knows"" rewriting something like this is a recipe for disaster.</p>

<p>But recently, I discovered that some of the most vital and poorly written parts of the system have deeply seated and serious design errors that go all the way into the data schema. The entire methodology has major problems (this is consensus among those who have worked on it, not just me) and the workarounds for that probably constitute half the code in that part, though it's so poorly written that there's no hope of telling them apart from business logic. The code is too convoluted for myself (I've only been working on it for a few months) or the prior primary maintainer (of several years) to understand fully. It also has less than 10% test coverage. </p>

<p>No one is confident that they can completely and correctly describe what that part accomplishes, much less how. Getting good test coverage for this part is all but impossible when the code is indecipherable and the requirements it meets aren't well understood. Refactoring without test coverage isn't right, nor is it remotely practical in a system of this size, complexity, with such pervasive problems (and dynamically typed makes automated discovery of the impacts of a change impossible).</p>

<p>Leaving this and dark corners untouched is not an option due to constantly changing business requirements.</p>

<p>The only practical way out of this that I can see starts with re-defining the system requirements on a business level and making a commitment to meeting that spec and risking any breakage that no-one anticipated. I know it's a bad strategy but I don't see alternative. If that is chosen as the path forward, it seems much of the benefit of refactoring goes out the window, which leaves me seriously questioning the virtue of even attempting to refactor this. </p>

<p>This leads me to the specific question: Is refactoring a bad strategy in this case? Answers backed with actual experiences are strongly preferred as I think the theoretical aspects are well established here and elsewhere.</p>
","<perl><refactoring>","11","187","2012-01-01 00:12:18"
"8705144","IDE with refactoring support for Ruby on Rails","<p>I am a java developer and use the Eclipse IDE for developing java code. I use the built-in refactoring features a lot, since good refactoring support from the IDE helps to speed up and leads to higher code quality. I would not like to miss it and use a simple text editor instead. Now I am looking for an IDE for Ruby on Rails with good refactoring capabilities.</p>

<h2>Basic refactorings</h2>

<p>Wanted basic refactoring methods include:</p>

<ul>
<li>Extract method</li>
<li>Extract variable</li>
<li>Rename (class, method, variable etc.)</li>
</ul>

<p>and so on.</p>

<h2>Aptana Studio 3, RadRails 2, RubyMine 3 and Netbeans 7</h2>

<p>So far I've tried <a href=""http://aptana.org/products/studio3"" rel=""nofollow"">Aptana Studio 3</a> and was quite disappointed regarding its refactoring capabilities. Aptana RadRails 2 seemed much better for refactoring ruby code, but it lacks other nice features that the newer Aptana Studio 3 offers. Since Aptana Studio 3 seems to be RadRails' successor I would expect that it has at least the same refactorings as the older RadRails 2, but it does not. Using an old unmaintained IDE does not seem a good option. Receiving updates for the IDE should still be possible.</p>

<p>I've read that <a href=""http://www.jetbrains.com/ruby/index.html"" rel=""nofollow"">Jetbrains RubyMine 3</a> has decent ruby refactoring capabilities, but it costs money. I am rather looking for a free one. Netbeans 7 seems not to support Ruby on Rails anymore.</p>

<h2>Are there good IDEs with refactoring support?</h2>

<p>That confuses me, it seems like modern IDEs drop (refactoring) support for Ruby on Rails.
What are nowadays (Jan 2012) the most powerful IDEs for refactoring Ruby on Rails code? </p>

<h2>Update: Netbeans 7</h2>

<p>As suggested by <a href=""http://stackoverflow.com/a/8707648/689801"">Jörg W Mittag</a> I've tried Netbeans 7 with the ruby plugin provided by the community. I have to say that this combination is much better than Aptana RadRails 2 or Aptana Studio 3 for developing Ruby on Rails apps. The integration of css and html for views is well done and the integration of rails tests into the JUnit Netbeans view comes in handy.</p>

<p>However, the refactoring support seems to be too basic. It supports rename, move, copy and safely delete of methods. It does not support to select lines of code and extract a method out of it nor the similar behaviour for extracting variables.</p>

<h2>Update: RubyMine 3</h2>

<p>dynex <a href=""http://stackoverflow.com/a/8705347/689801"">suggested</a> to use RubyMine. I've just played around with it and think its suitability as an Ruby on Rails IDE is at least as good as Netbeans'. The refactor capabilities are by far the best I've seen in a Ruby on Rails IDE so far. </p>

<p>From what I've discovered it features renaming, moving, copying, safe deletion, method extractation, variable introduction, constant introduction, field introduction, parameter introduction, inlining, pulling members up, pushing members doen, module extraction and superclass extraction.</p>

<p>My conclusion is that from the set of IDEs I tested RubyMine was the only one with decent refactoring capabilities. RubyMine costs money, but it seems worth it. The free ones cannot compete regarding refactorings.</p>

<p>Thanks for all answers and comments.</p>
","<ruby-on-rails><ruby><ide><tools><refactoring>","4","568","2012-01-02 20:42:38"
"8702366","Refactoring legacy code","<p>I'm working on a quite large legacy Rails app. Most of the code is downright horrible, and I'm trying to make it better as I go through it.</p>

<p>The problem is, <strong>there are no tests</strong>, and <strong>almost everything is wrong</strong>. So far I've went through the code and made a lot of handwritten notes on stuff that needs to be refactored, so that I can later do it when I get to adding tests.</p>

<p>But there are things that are just so simple and scream for quick refactoring. For example:</p>

<pre><code>def isValid(valid)
    name = Long::AndUglyModule::UglyClass.getvalid(valid)
    return name
end
</code></pre>

<p>the whole class looks like this, which makes me wanna just rewrite it to</p>

<pre><code>include Long::AndUglyModule

def is_valid(valid)
  UglyClass.getvalid(valid)
end
</code></pre>

<p>the problem is, that I'm afraid of introducing some subtle mistakes. On the other hand, working with code that looks like this gives me loads of headaches.</p>

<p><strong>Is it better to just do simple refactorings instantly, or leave the code as it is until I actually have to work with it or change it directly?</strong></p>
","<ruby-on-rails><refactoring><legacy>","2","86","2012-01-02 15:09:40"
"8719293","What is the quickest way to determine what code will be affected by a refactoring?","<p>I'm using Eclipse and Java, but the answer doesn't need to be specific to those.  I'm sure platform specific answers will get plenty of upvotes if they're far quicker than non-platform specific ones.</p>

<p>Right now I'm using</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;<code>grep ""classname"" <code>find . -regex .*\.java</code> > uses_classname.txt</code></p>

<p>to find code that might be affected by a change to the class.  If there are only a few lines returned by this, I can look at it manually as it is.  Otherwise, I can grep again to find the specific methods I'm modifying.  Is there a better way to do this?</p>
","<refactoring><methodology><procedure>","1","72","2012-01-03 22:05:42"
"8724406","How to remove duplication in this simple code?","<p>There is a function <code>AppendLastSlashIfNotExist</code> I made.<br>
Today, I've decided to make another function <code>AppendLastBackSlashIfNotExist</code>  </p>

<pre><code>wstring AppendLastSlashIfNotExist(__in const wstring&amp; path)
{
    if (path == L""/"")
    {
        return path;
    }

    if (path.size() == 0 || path[path.size() - 1] != L'/')
    {
        return path + L""/"";
    }
    return path;
}

wstring AppendLastBackSlashIfNotExist(__in const wstring&amp; path)
{
    if (path == L""\\"")
    {
        return path;
    }

    if (path.size() == 0 || path[path.size() - 1] != L'\\')
    {
        return path + L""\\"";
    }
    return path;
}
</code></pre>

<p>Yes, it sucks. Only <strong>Slash</strong> -> <strong>BackSlash</strong> is the change. I wanted to remove duplications.</p>

<pre><code>wstring AppendLastSlashIfNotExist(__in const wstring&amp; path, bool backSlash)
{
    if (path == (backSlash ? L""\\"" : L""/""))
    {
        return path;
    }

    if (path.size() == 0 || path[path.size() - 1] != (backSlash ? L'\\' : L'/'))
    {
        return path + (backSlash ? L""\\"" : L""/"");
    }
    return path;
}
</code></pre>

<p>I integrated them. Duplication removed. But an additional parameter came. I still feel uncomfortable.
Isn't there other ways to remove duplication? For example, using by high-order function.<br>
Any idea please.</p>
","<c++><design-patterns><refactoring><code-duplication>","2","131","2012-01-04 09:14:30"
"8734702","Code Analysis for CSS","<p>I'm looking for automated tools to help me refactor a bunch of CSS files, for example:</p>

<ol>
<li>Remove unnecessary selectors (e.g. not used inside the page)</li>
<li>detect repeatable rules inside several selectors and suggest a merge</li>
</ol>

<p>Are there any such tools?</p>

<p>Thanks!</p>
","<css><refactoring><less><scss>","0","52","2012-01-04 22:02:16"
"8737155","Refactoring duplicate code when the only difference is the type of one variable?","<p>I have to be able to connect to two different versions of the an API (1.4 and 1.5), lets call it the Foo API. And my code that connects to the API and processes the results is substantially duplicated - the only difference is the data types returned from the two APIs.  How can I refactor this to remove duplication? </p>

<p>In Foo14Connector.cs (my own class that calls the 1.4 API)</p>

<pre><code>public class Foo14Connector
{
    public void GetAllCustomers() 
    {
        var _foo = new Foo14WebReference.FooService();
        Foo14WebReference.customerEntity[] customers = _foo.getCustomerList;
        foreach (Foo14WebReference.customerEntity customer in customers)
        {
            GetSingleCustomer(customer);
        }
    }
    public void GetSingleCustomer(Foo14WebReference.customerEntity customer)
    {
        var id = customer.foo_id;
        // etc 
    }
}
</code></pre>

<p>And in the almost exact duplicate class Foo15Connector.cs (my own class that calls the 1.5 API)</p>

<pre><code>public class Foo15Connector
{
    public void GetAllCustomers() 
    {
        var _foo = new Foo15WebReference.FooService();
        Foo15WebReference.customerEntity[] customers = _foo.getCustomerList;
        foreach (Foo15WebReference.customerEntity customer in customers)
        {
            GetSingleCustomer(customer);
        }
    }
    public void GetSingleCustomer(Foo15WebReference.customerEntity customer)
    {
        var id = customer.foo_id;
        // etc 
    }
}
</code></pre>

<p>Note that I have to have two different connectors because one single method call (out of hundreds) on the API has a new parameter in 1.5.  </p>

<p>Both classes Foo14WebReference.customerEntity and Foo15WebReference.customerEntity have identical properties.</p>
","<c#><api><refactoring><code-duplication>","4","169","2012-01-05 03:15:14"
"8746766","Refactoring Large Codebehinds - Repository pattern and Extension methods","<p>I was hoping someone could help clarify my options regarding refactoring methods from code-behinds from ASP.NET webforms pages.</p>

<p>As background, we have spent some time recently implementing the repository pattern in both a generic and non generic sense, which has enabled us to move a lot of the DAL methods out of the codebehinds, which is great.</p>

<p>What I'm struggling to finalise, is a sensible approach to moving application logic methods out of the codebehinds which specific focus on the repository/DAL and how best to structure the BL classes.</p>

<p>Here are the two options I am considering at present:</p>

<p>1.Create a Business Logic class per codebehind and from this, expose
        methods like <code>getProject(int id)</code> which would behind the scenes,
        access a repository instance of <code>repo.GetById(int id)</code></p>

<p>The benefit of this as far as I can see would be the following:</p>

<ul>
<li>seperate app logic from the codebehinds, allowing them to be simple</li>
<li>allowing testable methods at the BLL (with some tweaking), kind of synonymous with controller classes in MVC (this is still webforms though)</li>
<li>Doesn't expose the repository directly</li>
</ul>

<p>The downside would be:</p>

<ul>
<li>A lot of wrapper methods in the BLL which don't really do anything
besides hide the repository methods</li>
</ul>

<p>2.Write extension methods on my entity types, e.g. <code>Project.getUsers()</code> which would access a repository instance method  allowing BL to be stored without the need for a specific BLL class, thereby reducing the duplication of the wrapper methods in each BL class. </p>

<p>The benefit of this would be:</p>

<ul>
<li>No need to have a BL as such, storing methods with their entity type</li>
<li>Less wrapper methods, as there wouldn't be a need for <code>ProjectBL.getUsers(projectid)</code> and <code>UserBL.getUsers(projectid)</code> which both call <code>repo.getProjectUsers(projectid)</code> behind the scenes, simple <code>Project.getUsers()</code> from both codebehinds</li>
</ul>

<p>The downside of this as far as I can tell:</p>

<ul>
<li>If I introduce new types in the future, e.g. 'SubProject' <code>getUsers()</code> needs to be re-implimented</li>
<li>I'm not too keen on extension methods in general and not sure if this is the right place to use them!</li>
</ul>

<p>I'm a little unsure which is 'better' practice, or if I've missed a better option all together. It may be worth knowing that initially the repository was being instantiated in the codebehind and accessed directly, but as I understand things, this is not ideal as we risk returning things like IQueryable from the repository and making DAL methods which can be manipulated in codebehind to produce inconsistent results.</p>
","<c#><asp.net><refactoring><repository-pattern>","2","171","2012-01-05 17:21:43"
"8755915","How this class should be modified in order to follow DIP (Dependency Injection Principle)","<p>How I can modify this class to follow DIP (Dependency Inversion Principle) in order to remove the two ArrayList dependencies in the constructor ? How the interfaces should be ? </p>

<p>One thing that confuses me is that the new references points to an <code>ArrayList&lt;type&gt;</code> not just the constructor of a class. And I don't know how to handle that situation...</p>

<pre><code>package mvc.controllers;

import java.util.ArrayList;
import mvc.models.AbstractModel;
import mvc.views.AbstractViewPanel;

public abstract class AbstractController {

    private ArrayList&lt;AbstractViewPanel&gt; registeredViews;
    private ArrayList&lt;AbstractModel&gt; registeredModels;

    public AbstractController() {
        registeredViews = new ArrayList&lt;AbstractViewPanel&gt;();
        registeredModels = new ArrayList&lt;AbstractModel&gt;();
    }

    public void addModel(AbstractModel model) {
        registeredModels.add(model);
        model.addPropertyChangeListener(this);
    }

    public void removeModel(AbstractModel model) {
        registeredModels.remove(model);
        model.removePropertyChangeListener(this);
    }

    public void addView(AbstractViewPanel view) {
        registeredViews.add(view);
    }

    public void removeView(AbstractViewPanel view) {
        registeredViews.remove(view);
    }
    ...
}
</code></pre>
","<java><mvc><dependency-injection><refactoring><dip>","0","84","2012-01-06 09:42:01"
"8759045","Refactoring near identical linq queries where the where clause is different","<p>I have two methods that are almost identical. The only  dffernece is the where clause (and method name). I have just included a simplified linq query.</p>

<pre><code>from tableA in db.tableA
join tableB in db.tableB on tableA.id equals tableB.id
where tableB.ref == ""blah""
select tableA
</code></pre>

<p>and</p>

<pre><code>from tableA in db.tableA
join tableB in db.tableB on tableA.id equals tableB.id
where tableB.refb == ""blah""
select tableA
</code></pre>

<p>Is there a way I can make the where change? I know I could remove there where  from the query then after the results are returned use .notation to filter. (May need to do some other stuff to make sure the field I need from tableB is returned).</p>

<p>Is there a better way? Does it matter that I have two linq queries that are almost identical apart from the where?</p>
","<linq><refactoring><dry>","1","44","2012-01-06 14:06:56"
"8777784","Finding the method in ASP.NET back-end","<p>I'm refactoring some piece of... code, part of huge, complex .Net project. There is a piece of code like</p>

<pre><code>&lt;asp:Button ID=""btnSave"" runat=""server"" CommandName=""Update"" ... /&gt;
</code></pre>

<p>Notice the command name, <em>genius</em>, who wrote the code called it simply <strong>Update</strong>. As the project is huge, you can imagine how many ""Update"" methods are there. I need to find that method very badly, is there any way I can get a call stack or something?</p>
","<c#><asp.net><.net><refactoring>","1","67","2012-01-08 13:08:28"
"8781975","VIM refactoring","<p>Of course the fact that you can refactor on IDEs is priceless for many, I hardly ever do it when I am coding but I may try to do it when editing some one else's source. How do you accomplish such a trivial task across multiple files in VIM?</p>

<p>I found the following plugin:
<a href=""https://github.com/ecomba/vim-ruby-refactoring"" rel=""nofollow"">https://github.com/ecomba/vim-ruby-refactoring</a></p>

<p>But how about ""any"" language?</p>
","<vim><refactoring>","0","377","2012-01-08 22:35:09"
"8779501","Refactoring shared code across multiple solutions","<p>I have several Visual Studio solutions which shares a common project.</p>

<p>Example:</p>

<pre><code>Solution of the common project
  - Common project

Solution A
  - Common project
  - Custom project A

Solution B
  - Common project 
  - Custom project B

And so on...
</code></pre>

<p>Each solution has its own SVN repository for developers to be able to work only on a particular solution. </p>

<p>There will be about 50-60 different solutions and I need to be able to build them separately.</p>

<p>When I will be, for example, renaming a method in the common project that is used in other projects, is there a way to apply the changes to every solutions?</p>

<p>Like this solution suggested here (<a href=""http://stackoverflow.com/questions/2243232/is-there-a-refactoring-tool-that-works-across-solutions-files"">Is there a refactoring tool that works across solutions files?</a>), I could create a master solution which contains all the projects and refactor from there, but I will have to checkout and update every repository to be able to do this.</p>

<p>Should I change the structure of my repositories? </p>

<p>Is there a better way to do this or avoid this problem?</p>
","<.net><visual-studio><refactoring><reference><shared-libraries>","3","77","2012-01-08 17:15:28"
"8791762","Resharper Rename Fields","<p>I've been tasked with making some significant modifications to a legacy codebase that was not written using our current code style conventions.  The changes are extensive enough that I'm doing some cleanup and refactoring (there was quite a bit of dead code) before getting started.  One of the things that's bugging me is that the fields are following the m_FieldName naming convention whereas we now use _fieldName.</p>

<p>Is there some way with Resharper to automatically rename all fields in the project to follow the new convention?  Are there other tools that can readily do this?  It's not too difficult to remove the prefixing 'm' with even a simple search/replace, but I haven't found an automated way to change the case of the starting letter.</p>
","<c#><.net><refactoring><resharper>","4","112","2012-01-09 16:33:00"
"8794127","correctly making use of inheritance in Android","<p>I have a <em>""Header""</em> at the top of 3 lists, which contains simple Create Read Update &amp; Delete buttons for editing the list.</p>

<p>How should I go about subclassing the Header so I can overwrite the listener in TaskHeader, ProjectHeader, ClientsHeader (Subclasses)</p>

<p>seeing as the layout, button creation, assignment etc.. can all be done in the same implementaion and just assigning the listener can be delegated to the specific sub-class.</p>

<p><em>Updated with suggested solution</em></p>

<p><strong>Interface</strong></p>

<pre><code>import android.view.View.OnClickListener;

public interface AttachClickListeners {

void attachCreateListener(OnClickListener l);
void attachReadListener(OnClickListener l);
void attachUpdateListener(OnClickListener l);
void attachDeleteListener(OnClickListener l);
</code></pre>

<p>}</p>

<p><strong>Header</strong></p>

<pre><code>public class Header extends LinearLayout implements AttachClickListeners {
/* removed for shortness */
public void attachCreateListener(OnClickListener listener) {
    insertBtn.setOnClickListener(listener);
}

public void attachReadListener(OnClickListener listener) {
    selectBtn.setOnClickListener(listener);
}

public void attachUpdateListener(OnClickListener listener) {
    updateBtn.setOnClickListener(listener);
}

public void attachDeleteListener(OnClickListener listener) {
    deleteBtn.setOnClickListener(listener);
}
</code></pre>

<p>then each time I create a header I just pass a different listener object as suggested by @elijah</p>
","<android><design-patterns><refactoring>","2","99","2012-01-09 19:38:33"
"8796573","How to refactor across multiple projects in VS2008?","<p>I have a master solution with many projects inside, mostly class libraries for my other applications to use. Early in the project I needed to change a class name inside one of my libraries but VS would not let me refactor the name over all the projects, just the original library project. Is there a add-in that can help me do this or will i just have to use the rename command and change it from project to project?</p>
","<c#><visual-studio-2008><refactoring><add-in>","0","52","2012-01-09 23:19:27"
"8800429","Refactoring code in Java, alternatives to large if statement","<p>I'm refactoring some code in a project I'm working on and I ran into a large if/else if statement that follows the format:</p>

<pre><code>if (changer instanceof AppleChanger)
{
   panel = new ApplePanel();
}
else if (changer instanceof OrangeChanger)
{
   panel = new OrangePanel();
} 
</code></pre>

<p>Now my first impulse was to refactor it using polymorphism to have it appear like</p>

<pre><code>panel = changer.getChangerPanel();
</code></pre>

<p>However unfortunately the class package doesn't have access to the panel package.</p>

<p>My next impulse was to create a PanelChooser class with an overloaded method:</p>

<pre><code>PanelChooser.getPanel(changer);

//Overloaded Method
public Panel getPanel(OrangeChanger changer)
{
   Panel orangePanel = new OrangePanel();
   return orangePanel;
}
public Panel getPanel(AppleChanger changer)
{
   Panel applePanel = new ApplePanel();
   return applePanel;
}
</code></pre>

<p>Is this a good solution or is there a better way to solve this?</p>
","<java><refactoring>","8","351","2012-01-10 08:34:43"
"8797454","Tool for 'Flattening' (simplifying) C# Source","<p>I need to provide a copy of the source code to a third party, but given it's a nifty extensible framework that could be easily repurposed, I'd rather provide a less OO version (a 'procedural' version for want of a better term) that would allow minor tweaks to values etc but not reimplementation using the full flexibility of how it is currently structured.</p>

<p>The code makes use of the usual stuff: classes, constructors, etc.  Is there a tool or method for 'simplifying' this into what is still the 'source' but using only plain variables etc.  </p>

<p>For example, if I had a class instance 'myclass' which initialised this.blah  in the constructor, the same could be done with a variable called myclass_blah which would then be manipulated in a more 'flat' way.  I realise some things like polymorphism would probably not be possible in such a situation.  Perhaps an obfuscator, set to a 'super mild' setting would achieve it?</p>

<p>Thanks</p>
","<c#><refactoring><obfuscation><code-conversion>","1","117","2012-01-10 01:18:38"
"8801711","Refactoring of web service project","<p>I'm trying to refactor an old web service project using new structure (with Maven) and best practices that weren't applied before. The project is composed of two parts: The first part is the implementation part (relevant only for the server), it contains the web service implementation and some utility classes for the server. The second part is shared by the server and the client, and contains the web service interface and the classes used for transferring the data with SOAP. So, we get a WAR for the first part, and a JAR for the second part. A client would need only the JAR to access the web service. </p>

<p>What are the issues with this structure?</p>

<p>I thought about defining the types used to transfer data between client and server using an XSD. Then, to generate a WSDL from the web service implementation classes. The WSDL would reference the XSD and a tool would generate automatically the transfer classes from the XSD.
What do you think about this solution? Are there issues with it? What do you recommend?</p>

<p>Thanks</p>
","<java><web-services><refactoring>","0","47","2012-01-10 10:24:02"
"8809189","Building structure (MVC?) into an existing messy javascript / jQuery web application","<p>I am building a very javascript-heavy application without using any object-oriented patterns, and I need some guidance on how to refactor / restructure my code.</p>

<p>The single-page application currently consists of a series of .js files full of functions and variables in global scope, with jQuery <code>$(document).ready(function() { });</code> enclosures at the top of each.  It began as a mockup of some simple drag-and-drop functionality and has grown and grown into a spaghetti of event listeners and DOM-dependent logic that is in serious need of structure and separation of concerns.</p>

<p>I've looked into frameworks like <a href=""http://documentcloud.github.com/backbone/"" rel=""nofollow"">backbone.js</a> and <a href=""http://spinejs.com/"" rel=""nofollow"">spine.js</a>, but I really can't afford to start over and I'm not sure where to begin integrating something like this to clean up my existing code.  I should mention that this project does not require compatability with HTML/CSS prior to HTML5/CSS3, and that we're open to a framework that doesn't necessarily focus on compatability with older browsers.</p>

<p>Can anyone here point me in the right direction?  If I left out any important contextual details, ask away and I'll edit my question.</p>
","<javascript><jquery><mvc><refactoring><advice>","0","91","2012-01-10 19:19:52"
"8820072","How to avoid string repetition in Zend redirect methods?","<p>I have a Zend project with a lot of controllers and actions using the method</p>

<pre><code>$this-&gt;_redirect('/controller_name/action_name');
</code></pre>

<p>for redirecting to other actions after data processing. I've observed that this creates a lot of ""magic strings"" that hurts the DRY principle: if I change a controller or action name I'd have to change this redirection code in all actions that use it. I'd like to know if there is a better way in Zend to avoid this. I've thought about creating constants for all controllers and action names, like this:</p>

<pre><code>$this-&gt;_redirect(HOME_CONTROLLER_INDEX);
</code></pre>

<p>But I think this approach isn't very good. Is there a better solution?</p>
","<php><zend-framework><refactoring>","0","225","2012-01-11 13:27:36"
"8820111","Refactoring C# applicaton tool","<p>I have a question regarding refactoring I did.
I want to check whether after the change the state of the system and objects are the same.
Because of the system type I can't create the same 2 objects at the same time, but one after the other. The objects are big ones.</p>

<p>I thought about serialize them into a file and compare them.</p>

<ol>
<li>Is there another way to do the comparing ?  </li>
<li>Do I need not to go over all my objects and add attribute [Serializable] ?  </li>
<li>What will happen to objects that are COM and don't have that attribute ?  </li>
<li>If an object consists of another objects will it Serializable it to ?</li>
</ol>

<p>Thanks</p>
","<c#><serialization><refactoring>","0","75","2012-01-11 13:31:07"
"8820609","SQL Database refactoring tool","<p>Does anyone know of a tool that exists to refactor SQL database tables?</p>

<p>I want a tool which will allow me to alter a table (add,remove columns or change datatype etc) without dropping the table. I also want to be able to keep the existing data in the table and maybe add defaults to any new columns (in the case of NOT NULL columns).</p>

<p>Is there anything out there that would help with refactoring tables?</p>
","<sql><database><tools><refactoring>","2","83","2012-01-11 14:05:33"
"8817013","(svn) merging back the refactorings but not the whole branch, possible ?","<p>I noticed a(n) (anti-)pattern in my team:</p>

<p>We decide to implement a feature so we (svn) branch.
While implementing the feature, we do refactorings that would benefit everyone if they could be merged back to the trunk right away.
We wait until we are done with the branch, then reintegrate it with the trunk and everyone gets the feature + the refactorings.</p>

<p>Now the funny thing is very often the refactorings are of much higher (and immediate) value than the feature that set them in motion, so it would be very nice if somehow I could get them in the trunk immediately and don't wait till the branch is done with and gets reintegrated.</p>

<p>As far as I know you are not supposed to ""merge"" a branch with the trunk, but you do the other way around (merge the trunk with the branch frequently) until the branch is done and then you ""reintegrate"" the branch back with the trunk. If you do it the wrong way (merge a branch with trunk) then you mess things up (mergeinfo and stuff) and when the time comes, you get into all sorts of evil and you can't reintegrate smoothly.</p>

<p>Ideas ?</p>
","<svn><merge><refactoring><branch><trunk>","1","49","2012-01-11 09:36:17"
"8829613","Zend Action Controller - refactoring strategy","<p>I've built a first-run web service on Zend Framework (1.10), and now I'm looking at ways to refactor some of the logic in my Action Controllers so that it will be easier for me and the rest of my team to expand and maintain the service.</p>

<p>I can see where there are opportunities for refactoring, but I'm not clear on the best strategies on how. The best documentation and tutorials on controllers only talk about small scale applications, and don't really discuss how to abstract the more repetitive code that creeps into larger scales.</p>

<p>The basic structure for our action controllers are:</p>

<ol>
<li>Extract XML message from the request body - This includes validation against an action-specific relaxNG schema</li>
<li>Prepare the XML response</li>
<li>Validate the data in the request message (invalid data throws an exception - a message is added to the response which is sent immediately)</li>
<li>Perform database action (select/insert/update/delete)</li>
<li>Return success or failure of action, with required information</li>
</ol>

<p>A simple example is this action which returns a list of vendors based on a flexible set of criteria:</p>

<pre><code>class Api_VendorController extends Lib_Controller_Action
{  
    public function getDetailsAction()
    {
        try {
            $request = new Lib_XML_Request('1.0');
            $request-&gt;load($this-&gt;getRequest()-&gt;getRawBody(), dirname(__FILE__) . '/../resources/xml/relaxng/vendor/getDetails.xml');
        } catch (Lib_XML_Request_Exception $e) {
            // Log exception, if logger available
            if ($log = $this-&gt;getLog()) {
                $log-&gt;warn('API/Vendor/getDetails: Error validating incoming request message', $e);
            }

            // Elevate as general error
            throw new Zend_Controller_Action_Exception($e-&gt;getMessage(), 400);
        }

        $response = new Lib_XML_Response('API/vendor/getDetails');

        try {
            $criteria = array();
            $fields = $request-&gt;getElementsByTagName('field');
            for ($i = 0; $i &lt; $fields-&gt;length; $i++) {
                $name = trim($fields-&gt;item($i)-&gt;attributes-&gt;getNamedItem('name')-&gt;nodeValue);
                if (!isset($criteria[$name])) {
                    $criteria[$name] = array();
                }
                $criteria[$name][] = trim($fields-&gt;item($i)-&gt;childNodes-&gt;item(0)-&gt;nodeValue);
            }

            $vendors = $this-&gt;_mappers['vendor']-&gt;find($criteria);
            if (count($vendors) &lt; 1) {
                throw new Api_VendorController_Exception('Could not find any vendors matching your criteria');
            }

            $response-&gt;append('success');
            foreach ($vendors as $vendor) {
                $v = $vendor-&gt;toArray();
                $response-&gt;append('vendor', $v);
            }

        } catch (Api_VendorController_Exception $e) {
            // Send failure message
            $error = $response-&gt;append('error');
            $response-&gt;appendChild($error, 'message', $e-&gt;getMessage());

            // Log exception, if logger available
            if ($log = $this-&gt;getLog()) {
                $log-&gt;warn('API/Account/GetDetails: ' . $e-&gt;getMessage(), $e);
            }
        }

        echo $response-&gt;save();
    }
}
</code></pre>

<p>So - knowing where the commonalities are in my controllers, what's the best strategy for refactoring while keeping it Zend-like and also testable with PHPUnit? </p>

<p>I did think about abstracting more of the controller logic into a parent class (Lib_Controller_Action), but this makes unit testing more complicated in a way that seems to me to be wrong.</p>
","<php><mvc><zend-framework><refactoring>","6","154","2012-01-12 03:05:40"
"8835737","PHP: refactoring rendering of dynamic template","<p>I want to render dynamic template and use for this</p>

<pre><code>$this-&gt;twig-&gt;render($this-&gt;_v(__METHOD__), $data);
</code></pre>

<p>Code above runs in controller of CodeIgniter.
Code of _v():</p>

<pre><code>function _v($method, $subview = ''){
    $view = strtolower(
        str_replace('::', '/',
            str_replace('::_','/',
                $method)));
    $view .= ($subview ? '/'.$subview : '');

    return $view;
}
</code></pre>

<p>Code of render():</p>

<pre><code>function render($template, $data = array()) {
    echo $this-&gt;_render($template.'.twig', $data);
}
</code></pre>

<p>In best variant I want to use</p>

<pre><code>$this-&gt;twig-&gt;render($data);
</code></pre>
","<php><methods><refactoring><codeigniter-2>","0","81","2012-01-12 13:20:56"
"8841812","Refactor to iOS5 ARC using XCode 4.2","<p>I am trying to refactor my project (Edit/Refactor/Convert to Objective-C ARC).
In the precheck stage I got a lot of problems with Google gtm OAuth. I want to disable ARC for those projects, so I went to targets/Build phases/Compile Sources and set the compiler flags of Google GTM Oauth files to -fno-objc-arc. </p>

<p>But when I run the refactor precheck it detects the same problems in google gtm. In build phases it even cleared the flags (I can't see the -fno-objc-arc flag setted for the files anymore).</p>

<p>Any help?</p>

<p>Thanks</p>
","<objective-c><ios5><refactoring><xcode4.2><automatic-ref-counting>","1","246","2012-01-12 20:27:47"
"8847644","Re-factoring Controller's Action  in asp.net mvc3","<p>I am writing this Action code (within same controller) more than 10 times for different <code>Models</code>. Is there any way i can reduce this code or how can i create a generic action.</p>

<pre><code>    [HttpPost]
    public ActionResult SavePerson(Person p)
    {
        if (ModelState.IsValid)
        {
            //do something
            return Redirect(""/Main"");
        }
        else
        {
            return View();
        }
    }


    [HttpPost]
    public ActionResult SaveCategory(Category c)
    {
        if (ModelState.IsValid)
        {
            //do something
            return Redirect(""/Main"");
        }
        else
        {
            return View();
        }
    }
</code></pre>
","<c#><asp.net-mvc><asp.net-mvc-3><refactoring>","2","105","2012-01-13 08:15:23"
"8846572","php code improvement refactor","<p>Hi staskoverflow community. </p>

<p>How can i improve next structure of PHP 5 code.
A list of models $months (more than 12) 
$month->days (more than 31)</p>

<p>$day->clients a list of clients
$day->someActions a list of actions for $clients</p>

<p>i need to invoke every $action for every $client. So my construction is:</p>

<pre><code>&lt;?php
foreach($monthes as $month) {
    foreach($month-&gt;days as $day) {
        foreach($day-&gt;clients as $client) {
            foreach($day-&gt;actions as $action) {
                $action-&gt;run($client);
            }
        }
    }
} ?&gt;
</code></pre>

<p>So there are four foreach loops, can i improve this code ?</p>
","<php><refactoring><refactor-my-code>","-1","77","2012-01-13 06:00:14"
"8850076","Best Way To Dynamically Achieve Offset and Limit Without Multiple Queries To The Database?","<p>I originally had a lightbox that once opened simply fetched all brands from a database which were in a list. The problem is that this list can be quite long so I split the brands out into lists of 10 and floated them left so that they filled the lightbox horizontally rather than vertically since there are around 40 brands.</p>

<p>The initial problem with my code is that it won't cover if suddenly, another 10 brands are added to the database since my code doesn't account for them.</p>

<p>The other problems are that I feel disgusted with myself having used multiple queries so I was wondering if anyone could offer any pointers about how to achieve the below with a bit more elegance and efficiency:</p>

<pre><code>$sql2 = ""SELECT page_id, name, url
             FROM "" . DBTABLE_SITEMAP .""
             WHERE parent_id=$frames
             AND isActive=1
             AND isDeleted=0
             ORDER BY position ASC
             LIMIT 10"";

$result2 = mysql_query($sql2, $db_conn);

if (mysql_num_rows($result2) &gt; 0) {
    echo '&lt;ol class=""subnav-glasses""&gt;';

    while ($myrow2 = mysql_fetch_array($result2)) {
        $this_sub_page_id   = $myrow2[""page_id""];
        $this_sub_name      = htmlentities($myrow2[""name""]);
        $this_sub_url       = $myrow2[""url""];


        echo ""\n&lt;li&gt;&lt;a href=\""$this_sub_url\"" title=\""$this_sub_name\""&gt;$this_sub_name&lt;/a&gt;"";                                
        echo '&lt;/li&gt;';
    }
    echo ""&lt;/ol&gt;"";
}


$sql3 = ""SELECT page_id, name, url
             FROM "" . DBTABLE_SITEMAP .""
             WHERE parent_id=$sitemap_designer_frames
             AND isActive=1
             AND isDeleted=0
             ORDER BY position ASC
             LIMIT 10
             OFFSET 10"";

$result3 = mysql_query($sql3, $db_conn);

if (mysql_num_rows($result3) &gt; 0) {
    echo '&lt;ol class=""subnav-glasses""&gt;';

    while ($myrow3 = mysql_fetch_array($result3)) {
        $this_sub_page_id   = $myrow3[""page_id""];
        $this_sub_name      = htmlentities($myrow3[""name""]);
        $this_sub_url       = $myrow3[""url""];


        echo ""\n&lt;li&gt;&lt;a href=\""$this_sub_url\"" title=\""$this_sub_name\""&gt;$this_sub_name&lt;/a&gt;"";                                
        echo '&lt;/li&gt;';
    }
    echo ""&lt;/ol&gt;"";
}


$sql4 = ""SELECT page_id, name, url
             FROM "" . DBTABLE_SITEMAP .""
             WHERE parent_id=$sitemap_designer_frames
             AND isActive=1
             AND isDeleted=0
             ORDER BY position ASC
             LIMIT 10
             OFFSET 20"";

$result4 = mysql_query($sql4, $db_conn);

if (mysql_num_rows($result4) &gt; 0) {
    echo '&lt;ol class=""subnav-glasses""&gt;';

    while ($myrow4 = mysql_fetch_array($result4)) {
        $this_sub_page_id   = $myrow4[""page_id""];
        $this_sub_name      = htmlentities($myrow4[""name""]);
        $this_sub_url       = $myrow4[""url""];


        echo ""\n&lt;li&gt;&lt;a href=\""$this_sub_url\"" title=\""$this_sub_name\""&gt;$this_sub_name&lt;/a&gt;"";                                
        echo '&lt;/li&gt;';
    }
    echo ""&lt;/ol&gt;"";
}


    $sql5 = ""SELECT page_id, name, url
             FROM "" . DBTABLE_SITEMAP .""
             WHERE parent_id=$sitemap_designer_frames
             AND isActive=1
             AND isDeleted=0
             ORDER BY position ASC
             LIMIT 10
             OFFSET 30"";

$result5 = mysql_query($sql5, $db_conn);

if (mysql_num_rows($result5) &gt; 0) {
    echo '&lt;ol class=""subnav-glasses""&gt;';

    while ($myrow5 = mysql_fetch_array($result5)) {
        $this_sub_page_id   = $myrow5[""page_id""];
        $this_sub_name      = htmlentities($myrow5[""name""]);
        $this_sub_url       = $myrow5[""url""];


        echo ""\n&lt;li&gt;&lt;a href=\""$this_sub_url\"" title=\""$this_sub_name\""&gt;$this_sub_name&lt;/a&gt;"";                                
        echo '&lt;/li&gt;';
    }
    echo ""&lt;/ol&gt;"";
}
</code></pre>
","<php><mysql><refactoring><refactor-my-code>","0","45","2012-01-13 11:46:03"
"8852236","Refactoring a method with too many bool in it","<p>I have this method in c#, and I wish to refactor it. There are just too many bools and lines. What would be the best refactoring. Making a new class seems a bit overkill, and cutting simply in two seems hard. Any insight or pointer would be appreciated.</p>

<p>method to refactor</p>

<pre class=""lang-cs prettyprint-override""><code>    private DialogResult CheckForSireRestrictionInSubGroup(bool deletingGroup,string currentId)
    {
        DialogResult result = DialogResult.No;
        if (!searchAllSireList)
        {
            DataAccessDialog dlg = BeginWaitMessage();
            bool isClose = false;
            try
            {
                ArrayList deletedSire = new ArrayList();
                ISireGroupBE sireGroupBE = sireController.FindSireGroupSearch();

                if (sireGroupBE != null)
                {
                    //if the current group is in fact the seach group before saving
                    bool currentGroupIsSeachGroup = sireGroupBE.TheSireGroup.id == currentId; 

                    //if we have setting this group as search group
                    bool selectedAsSearchGroup = this.chkBoxSelectedSireGroup.Checked;

                    //if the group we currently are in is not longer the seach group(chk box was unchecked)
                    bool wasSearchGroup = currentGroupIsSeachGroup &amp;&amp; !selectedAsSearchGroup;

                    //if the group is becoming the search group
                    bool becomesSearchGroup = !currentGroupIsSeachGroup &amp;&amp; selectedAsSearchGroup;

                    //if the group being deleted is in fact the search group
                    bool deletingSearchGroup = deletingGroup &amp;&amp; currentGroupIsSeachGroup;

                    //if the user checked the checkbox but he's deleting it, not a so common case, but
                    //we shouldn't even consider to delete sire in this case
                    bool deletingTemporarySearchGroup = deletingGroup &amp;&amp; !currentGroupIsSeachGroup;         

                    //if we are not deleting a temporary search group and it's either
                    //becoming one (without deleting it) or we already are the search group
                    bool canDeleteSires = !deletingTemporarySearchGroup &amp;&amp; 
                                          (becomesSearchGroup || currentGroupIsSeachGroup);
                    //we only delete sires if we are in search group
                    if (canDeleteSires)
                    {   
                        if (deletingSearchGroup || wasSearchGroup)
                        {
                            // If we deleted all sires
                            deletedSire = new ArrayList();
                            deletedSire.AddRange( sireGroupBE.SireList);
                        }
                        else
                        {
                            //if we delete a few sire from the change of search group
                            deletedSire = GetDeleteSire(sireGroupBE.SireList);
                        }
                    }

                    EndWaitMessage(dlg);
                    isClose = true;
                    result =  ShowSubGroupAffected(deletedSire);
                }
            }
            finally
            {
                if (!isClose)
                {
                    EndWaitMessage(dlg);
                }
            }
        }

        return result;
    }
</code></pre>
","<c#><methods><refactoring>","5","135","2012-01-13 14:42:57"
"8852502","Tool to parse C++ source and move in-header inline methods to the .cpp source file?","<p>The source code of our application is hundreds of thousands of line, thousands of files, and in places very old - the app was first written in 1995 or 1996.  Over the past few years my team has greatly improved the quality of the source, but one issue remains that particularly bugs me: a lot of classes have a lot of methods fully defined in their header file.</p>

<p>I have no problem with methods declared inline in a header in some cases - a struct's constructor, a simple method where inlining <em>measurably</em> makes it faster (we have some math functions like this), etc.  But the liberal use of inlined methods for no apparent reason is:</p>

<ul>
<li>Messy</li>
<li>Makes it hard to find the implementation of a method (especially searching through a tree of classes for a virtual function, only to find one class had its version declared in the header...)</li>
<li>Probably increases the compiled code size</li>
<li>Probably causes issues for our linker, which is <a href=""http://www.google.com/search?client=safari&amp;rls=en&amp;q=c%2B%2Bbuilder+linker+fatal+error+out+of+memory&amp;ie=UTF-8&amp;oe=UTF-8"">notoriously flaky for large codebases</a>.  To be fair, it has got much better in the past few years, but it's not perfect.</li>
</ul>

<p>That last reason may now be causing problems for us and it's a good reason to go through the codebase and move most definitions to the source file.</p>

<p>Our codebase is huge.  <strong>Is there an automated tool that can do (most of) this for us?</strong></p>

<p>Notes:</p>

<ul>
<li>We use Embarcadero RAD Studio 2010.  In other words, the dialect of C++ includes <a href=""http://docwiki.embarcadero.com/RADStudio/en/C%2B%2B_Keyword_Extensions"">VCL and other extensions</a>, etc.</li>
<li>A few headers are standalone, but most are paired with a corresponding .cpp file, as you normally would.  Apart from the extension the filename is the same, i.e., if there are methods defined in X.h, they can be moved to X.cpp.  This also means the tool doesn't have to handle parsing the whole project - it could probably just parse individual pairs of .cpp/.h files, ignore the includes, etc, so long as it could reliably recognise a method with a body defined in a class declaration and move it.</li>
</ul>
","<c++><refactoring><inline><c++builder><automated-refactoring>","10","303","2012-01-13 15:00:52"
"8854812","Refactor ruby on rails model","<p>Given the following code, </p>

<p>How would you refactor this so that the method search_word has access to issueid?</p>

<p>I would say that changing the function search_word so it accepts 3 arguments or making issueid an instance variable (@issueid) could be considered as an example of bad practices, but honestly I cannot find any other solution. If there's no solution aside from this, would you mind explaining the reason why there's no other solution? </p>

<p>Please bear in mind that it is a Ruby on Rails model.</p>

<pre><code>def search_type_of_relation_in_text(issueid, type_of_causality)
    relation_ocurrences = Array.new
    keywords_list = { 
        :C =&gt; ['cause', 'causes'],
        :I =&gt; ['prevent', 'inhibitors'],
        :P =&gt; ['type','supersets'],
        :E =&gt; ['effect', 'effects'],
        :R =&gt; ['reduce', 'inhibited'],
        :S =&gt; ['example', 'subsets'] 
    }[type_of_causality.to_sym]  

    for keyword in keywords_list
        relation_ocurrences + search_word(keyword, relation_type)
    end        

    return relation_ocurrences
end


def search_word(keyword, relation_type)
relation_ocurrences = Array.new

@buffer.search('//p[text()*= ""'+keyword+'""]/a').each { |relation|

    relation_suggestion_url   = 'http://en.wikipedia.org'+relation.attributes['href']
    relation_suggestion_title = URI.unescape(relation.attributes['href'].gsub(""_"" , "" "").gsub(/[\w\W]*\/wiki\//, """"))

    if not @current_suggested[relation_type].include?(relation_suggestion_url)
        if @accepted[relation_type].include?(relation_suggestion_url)
            relation_ocurrences &lt;&lt; {:title =&gt; relation_suggestion_title, :wiki_url =&gt; relation_suggestion_url, :causality =&gt; type_of_causality, :status =&gt; ""A"", :issue_id =&gt; issueid}
        else
            relation_ocurrences &lt;&lt; {:title =&gt; relation_suggestion_title, :wiki_url =&gt; relation_suggestion_url, :causality =&gt; type_of_causality, :status =&gt; ""N"", :issue_id =&gt; issueid}
        end

    end
} 

end
</code></pre>
","<ruby><ruby-on-rails-3><model><refactoring>","0","67","2012-01-13 17:39:24"
"8860268","How to DRY (these) RSpec tests using custom matcher","<p>I currently have the following tests, which look like good candidates for a little DRY treatment:</p>

<pre><code>describe League do

  context 'attributes validation' do
    before(:each) do
      @league = League.new
    end

    it 'should be invalid without a short_name' do
      @league.attributes = valid_league_attributes.except(:short_name)
      @league.should_not be_valid
      @league.should have(1).error_on(:short_name)
      @league.errors[:short_name].should == [""can't be blank""]
      @league.short_name = 'NFL'
      @league.should be_valid
    end

    it 'should be invalid without a long_name' do
      @league.attributes = valid_league_attributes.except(:long_name)
      @league.should_not be_valid
      @league.should have(2).error_on(:long_name)
      @league.errors[:long_name].should == [""can't be blank"", 'is not included in the list']
      @league.long_name = 'National Football League'
      @league.should be_valid
    end
  end

end
</code></pre>

<p>Is it possible to make this more DRY using Custom Matchers or some other utility?</p>
","<ruby-on-rails-3><refactoring><rspec2><dry>","1","78","2012-01-14 05:00:45"
"8855921","Java Structural change with Facade pattern","<p>I'm trying to restructure some specific GUI code in a Java project, let's call it Project A, by removing dependencies from the project and moving the code to an existing API.  I have another project which requires basically the same features/interface, and I'd like to reuse these capabilities in that other project.  </p>

<p>I have read about the Facade Design Pattern in the Design Patterns book by the GoF, and thought that it may be applicable here.  </p>

<p>Before reading about the Facade pattern, I attempted to write an interface called IMessagePasser, which simply replaces any project specific code with interface methods, as a contract to be implemented by each client, for example with ProjectAMessagePasser.  This seems to deal with half of the Facade, allowing the GUI code to be moved to the API. </p>

<p>I suppose the next step is to do the same with the Project A, replacing the GUI dependencies by adding more methods inside the ProjectAMessagePasser, in order to figure out basically the necessary communications between the ProjectBMessagePasser and the GUI code.   </p>

<p>I don't have a lot of experience with large scale restructuring of code, but does this all seem reasonable?  It is hard to tell without making all the changes first, and I don't want to waste a lot of time doing it one way if there is a better way to do this.  </p>
","<java><design-patterns><refactoring><facade-pattern>","1","106","2012-01-13 19:13:30"
"8865954","Refactoring Switching On Types Code Smell When Adding Method to Type Seems Inappropriate","<p>Let's say I have the following method that, given a PaymentType, sends an appropriate payment request to each facility from which the payment needs to be withdrawn:</p>

<pre><code>        public void SendRequestToPaymentFacility(PaymentType payment) {

    if(payment is CreditCard) {
      SendRequestToCreditCardProcessingCenter();
    } else if(payment is BankAccount) {
      SendRequestToBank();
    } else if(payment is PawnTicket) {
      SendRequestToPawnShop();
}

}
</code></pre>

<p>Obviously this is a code smell, but when looking for an appropriate refactoring, <strong>the only examples I have seen involve cases where the code executed within the conditionals are clearly the responsibility of the class itself</strong>, e.g. with the standard example given:</p>

<pre><code>public double GetArea(Shape shape) {
  if(shape is Circle) {
    Circle circle = shape As Circle;

    return circle.PI * (circle.radius * circle.radius);
  } else if(shape is Square) {
    Square square = shape as Square;    

    return square.length * square.width;
  }
}
</code></pre>

<p><code>GetArea()</code> seems like a pretty reasonable responsibility for each Shape subclass, and can of course be refactored nicely:</p>

<pre><code>public class Shape
{
  /* ... */
  public abstract double GetArea();
}

public class Circle
{

  public override double GetArea()
  {
    return PI * (radius * radius);
  }

}
</code></pre>

<p>However, <strong><code>SendRequestToPaymentFacility()</code> does not seem like an appropriate responsibility for a <code>PaymentType</code> to have.</strong> (and would seem to violate the Single Responsibility Principle). And yet I need to send a request to an appropriate <code>PaymentFacility</code> based on the type of <code>PaymentType</code> - what is the best way to do this?</p>
","<oop><refactoring><polymorphism><code-smell>","1","60","2012-01-14 22:42:48"
"8869221","How to extract anonymous function to named function?","<p>Are there any tools that allows you to do simple refactoring? </p>

<p>For example extract anonymous function to named functions?</p>
","<javascript><asp.net><eclipse><refactoring><aptana>","0","73","2012-01-15 11:08:44"
"8877832","Emacs 24, Rope rename: ""calculating rename changes"", then becomes unresponsive","<p>When I use Rope to refactor Python, rename a class name, the minibuffer says ""calculating rename changes..."", and the machine becomes slow, even not response.</p>

<p>Did I miss any configs, or is it a bug of Emacs 24/Rope?</p>

<p>My configs:</p>

<pre><code>(require 'pymacs)
(autoload 'pymacs-apply ""pymacs"")
(autoload 'pymacs-call ""pymacs"")
(autoload 'pymacs-eval ""pymacs"" nil t)
(autoload 'pymacs-exec ""pymacs"" nil t)
(autoload 'pymacs-load ""pymacs"" nil t)
(pymacs-load ""ropemacs"" ""rope-"")
;;(pymacs-load ""pysmell.emacshelper"" ""pysmell-"")
(setq ropemacs-enable-autoimport t)
</code></pre>
","<python><emacs><refactoring><ropemacs>","1","121","2012-01-16 09:19:39"
"8882259","Refactoring into sub classes","<pre><code>public class ScheduleRatesController
    {
        protected CoreDataManager dataManager;

        public ScheduleRatesController()
        {
            dataManager = new CoreDataManager();
        }

        // testing
        public ScheduleRatesController(CoreDataManager manager)
        {
            dataManager = manager;
        }

        public virtual void GetTranQuotesToFillRatesAndPayments(ref List&lt;int&gt; ids)
        {
            ids.AddRange(new List&lt;int&gt;());
        }
    }
</code></pre>

<p>So to give you guys some background, we're splitting one DB query into a bunch of different ones, and we want subclasses to basically each take on a DB call for their <code>GetTranQuotesToFillRatesAndPayments()</code> method that represents it's specific query.</p>

<p>What you see above is the base class I have. I made those two methods <code>virtual</code> as I plan on having subclasses override them to perform their own stuff. So one could be like:</p>

<pre><code>public override void GetTranQuotesToFillRatesAndPayments(ref List&lt;int&gt; ids)
        {
            ids.AddRange(dataManager.GetLoanTranQuotes());
        }
</code></pre>

<p>and etc. My question is, is this the best/cleanest way to perform a pattern like this?</p>

<p>The code that calls this is going to contain a huge list of filtered id's, that it's going to need to fill by calling each classes call to <code>GetTranQuotesToFillRatesAndPayments()</code>. Let me know if this doesn't make sense. I'm kind of getting turned off by the fact that I'm going to need to call the same method like 6 times, each on a different class. I think that might be messy in itself even though the goal of it was to make it clean. I don't want to have something like this on the calling side:</p>

<pre><code>List&lt;int&gt; ids = new List&lt;int&gt;();
ScheduleRatesController controller = new LoanController();
controller.GetTranQuotesToFillRatesAndPayments(ref ids);

controller = new TradeController();
controller.GetTranQuotesToFillRatesAndPayments(ref ids);
</code></pre>

<p>etc.</p>

<p>Let me know if you need any more background or info.</p>

<p>Thanks.</p>
","<c#><design-patterns><inheritance><refactoring><subclass>","2","83","2012-01-16 15:34:26"
"8887662","Can I Undo Netbeans Refactoring (Rename Variable) Function?","<p>So I wasn't paying careful attention when using the the Refactor->Rename function in Netbeans a few times this morning and now I'm afraid Netbeans may have automatically changed the names of some variables I didn't intend to change. Is there any way to go back and check a log or something to see what variables Netbeans affected?</p>
","<netbeans><ide><logging><automated-refactoring>","0","50","2012-01-16 23:18:25"
"8895467","Java IDE for a C# developer?","<p>I have several years of professional development using C#, Visual Studio 2003-2010 and Resharper.
Now I would like to get some practice with Java. What IDEs (maybe with some plug-ins) would you suggest, so I would not suffer to much from the differences (or at least have similar power to what I'm used to)?
In my current work I heavily rely on Resharper for code navigation, search of usages, refactoring, etc.
A benefit would be for such IDE to have optional support for dynamic languages like Python or Ruby, they are next on my list, to try.</p>
","<c#><java><ide><refactoring>","0","139","2012-01-17 13:30:57"
"8895806","How to implement polymorphic associations in an existing database","<p>Polymorphic assiociations (PA's) is quite a mouthful for a relatively simple database requirement: let various tables have child records in one shared table. The classic example is a single table with comment records that apply to different not necessarily kindred entities.</p>

<p>In <a href=""http://stackoverflow.com/questions/7000283/what-is-the-best-way-to-implement-polymorphic-association-in-sql-server"">this question</a> Mark did an excellent job showing three common approaches to implement PA's. I want to use the base table approach, which is described in more detail in an equally excellent <a href=""http://stackoverflow.com/a/2003042/861716"">answer by Bill Karwin</a>.</p>

<p>A concrete example would look like this:</p>

<p><img src=""http://i.stack.imgur.com/ncoeV.png"" alt=""enter image description here""></p>

<p>The primary keys of the entities refer to identical key values in the base table and the Comment table refers to to the base table, so referential integrity is observed. The crucial part here is that the primary keys of the entity tables have <em>distinct</em> domains. They are generated by creating a new record in the base table and copying its generated key to the entity's primary key.</p>

<p>Now my question: <strong>what if I want to introduce PA's with referential integrity in an existing database having entities that generate their own, mutually overlapping primary keys?</strong></p>

<p>So far, I see two options:</p>

<p><strong>Option 1:</strong></p>

<p><img src=""http://i.stack.imgur.com/z1XLF.png"" alt=""Option 1""></p>

<p>Each entity keeps its own primary key but also gets an alternate key.</p>

<p>Like:</p>

<ul>
<li>Close to the recommended approach.</li>
<li>Base table is stable.</li>
</ul>

<p>Dislike:</p>

<ul>
<li>Existing entities must be modified.</li>
<li>Hard to find the owning entity of a comment.</li>
</ul>

<p><strong>Option 2:</strong></p>

<p><img src=""http://i.stack.imgur.com/YQn9r.png"" alt=""Option 2""></p>

<p>Each entity has its own foreign key column in the base table. This looks like Mark's multiple column approach.</p>

<p>Like:</p>

<ul>
<li>Existing entities not affected.</li>
<li>Easy to find the owning entity of a comment.</li>
</ul>

<p>Dislike:</p>

<ul>
<li>Sparse columns</li>
<li>Base table not stable: needs modification when a new entity with PA is introduced</li>
</ul>

<p>I lean to option 1, possibly with a field ""EntityName"" in the Base table for bidirectional lookup. <strong>Which option would be better. Or is another, even better, approach?</strong></p>
","<sql-server-2008><database-design><refactoring><polymorphic-associations>","0","206","2012-01-17 13:55:47"
"8893490","Hardware support from a web application","<p>I have a web application running with support for some specific pieces of hardware.  This is achieved in the following steps:</p>

<ol>
<li>User runs a small installer that places java files (and a couple
others) on the client machine. The main piece is a jar called ""hardwareManager""</li>
<li>User visits web app. The web app runs a java applet which, due to
a .java.policy file placed during the install, has permission to
interact with the client machine outside the browser sandbox.</li>
<li>The applet checks to make sure the hardwareManager is running,
and if not runs a command to start it.</li>
<li>User interacts with the web app which sends commands to the applet via
javascript.  The applet then writes commands to a text file
on the client machine.  The text file is constantly monitored by the
hardwareManager which runs any commands it reads in.</li>
</ol>

<p>This works, but seems clunky.  I have a couple ideas on how to improve it, but I don't know which, if any, are even worth trying.</p>

<p>Would it be better to set up the hardwareManager as a socketServer and have the applet connect directly to it, rather than going through text files?  Is that even possible? </p>

<p>Is there a way to eliminate the applet altogether and have the javascript talk directly to the hardwareManager?  Maybe by writing the hardwareManager to be a local http server?  What port should it run on? Do javascript xss limitations fit in here somewhere?</p>
","<java><javascript><refactoring><applet>","5","145","2012-01-17 11:02:00"
"8905116","How to use of KeyDown Event Validation in a better way?","<p>I have several TextBoxes which need to allow only numeric inputs. The problem is I have to copy &amp; paste the code below for another TextBox that allows only numeric values. Is there any simpler way to implement? such as using functions or inheritance?</p>

<pre><code>private void txtCheckVoucher_Amount_KeyDown(object sender, KeyEventArgs e)
{
     if (Control.ModifierKeys == Keys.Shift)
     {
           e.SuppressKeyPress = true;
           return;
     }

     if (((e.KeyCode &gt;= Keys.D0 &amp;&amp; e.KeyCode &lt;= Keys.D9) ||
             (e.KeyCode &gt;= Keys.NumPad0 &amp;&amp; e.KeyCode &lt;= Keys.NumPad9) ||
              e.KeyCode == Keys.Decimal || e.KeyCode == Keys.OemPeriod ||
              e.KeyCode == Keys.Back || e.KeyCode == Keys.Tab ||
              e.KeyCode == Keys.Left || e.KeyCode == Keys.Right ||
              e.KeyCode == Keys.End || e.KeyCode == Keys.Home ||
              e.KeyCode == Keys.ShiftKey || e.KeyCode == Keys.Delete))
     {

     }
     else if (e.KeyCode &gt;= Keys.A || e.KeyCode &lt;= Keys.Z)
              e.SuppressKeyPress = true;
}
</code></pre>
","<c#><forms><events><textbox><refactoring>","1","167","2012-01-18 04:16:50"
"8913489","Hibernate and how to avoid name change of modals","<p>I am using Hibernate for a few years but am not sure about the usage of Query and Criteria.</p>

<p>I understood, that one of Hibernate strengths are to control the field name in one place.
If I have the following code:</p>

<pre><code>List cats = sess.createCriteria(Cat.class)
.add( Restrictions.like(""name"", ""Fritz%"") )
.add( Restrictions.between(""weight"", minWeight, maxWeight) )
.list();
</code></pre>

<p>What if I change ""name"" of the Cat in the java object?</p>

<p>Even when using refactor replace (like in Elipse) it will not detect the element as something that needs to be changed!</p>

<p>If so , how do you maintain the field names in Java?</p>
","<java><hibernate><refactoring>","6","70","2012-01-18 16:15:47"
"8917696","library for transforming a node tree","<p>I'd like to be able to express a general transformation of one tree into another without writing a bunch of repetitive spaghetti code. Are there any libraries to help with this problem? My target language is Python, but I'll look at other languages as long as it's feasible to port to Python.</p>

<p>Example: I'd like to transform this node tree: (please excuse the <a href=""http://en.wikipedia.org/wiki/S-expression"" rel=""nofollow"">S-expressions</a>)</p>

<pre><code>(A (B) (C) (D))
</code></pre>

<p>Into this one:</p>

<pre><code>(C (B) (D))
</code></pre>

<p>As long as the parent is A and the second ancestor is C, regardless of context (there may be more parents or ancestors). I'd like to express this transformation in a simple, concise, and re-usable way. Of course this example is very specific. Please try to address the general case.</p>

<p>Edit: <a href=""http://kenai.com/projects/refactoringng/pages/Tutorial"" rel=""nofollow"">RefactoringNG</a> is the kind of thing I'm looking for, although it introduces an entirely new grammar to solve the problem, which i'd like to avoid.  I'm still looking for more and/or better examples.</p>

<hr>

<p>Background:</p>

<p>I'm able to convert python and cheetah (don't ask!) files into tokenized tree representations, and in turn convert those into <a href=""http://lxml.de/"" rel=""nofollow"">lxml</a> trees. I plan to then re-organize the tree and write-out the results in order to implement automated refactoring. XSLT seems to be the standard tool to rewrite XML, but the syntax is terrible (in my opinion, obviously) and nobody at our shop would understand it.</p>

<p>I could write some functions which simply use the lxml methods (.xpath and such) to implement my refactorings, but I'm worried that I will wind up with a bunch of purpose-built spaghetti code which can't be re-used.</p>
","<python><refactoring><tree><expression-trees><nodes>","1","62","2012-01-18 21:28:28"
"8922996","Determining which class to use at runtime","<p>I'm working on legacy code that looks very similar to this:</p>

<pre><code>public class BaseParser
{
    public BaseParser(Stream stream) 
    {
        // Do something with stream
    }
}

public class JsonParser : BaseParser
{
    public JsonParser(Stream stream) 
        : base(stream)
    {
        // Do something
    }
}

public class XmlParser : BaseParser
{
    public XmlParser(Stream stream, string someOtherParam) 
        : base(stream)
    {
        // Do something
    }
}
</code></pre>

<p>We have an application that parses incoming files using a particular parser. To determine which type we need to instantiate, there's a large IF/ELSE block in a factory method:</p>

<pre><code>public static BaseParser Create(string type)
{
    if (type == ""xml"")
        return new XmlParser(new FileStream(""path"", FileMode.Open), ""test"");

    if (type == ""json"")
        return new JsonParser(new FileStream(""path"", FileMode.Open));

    // more...

    return null;
}
</code></pre>

<p>Since there are a large number of parsers that reside in a single assembly (lets call it <code>Demo.dll</code>), I'd like to split each of these parsers into their own assembly.  The ""core"" classes such as the <code>BaseParser</code> will remain in <code>Demo.dll</code>, but the other parsers and any dependencies will live in <code>Demo.Json.dll</code>, <code>Demo.Xml.dll</code>, etc....  </p>

<p>The ""core"" library will load these assemblies at runtime.</p>

<pre><code>string[] paths = Directory.GetFiles(Environment.CurrentDirectory, ""Demo.*.dll"");

foreach (string path in paths)
    Assembly.LoadFrom(path);

List&lt;BaseParser&gt; parsers = AppDomain.CurrentDomain
    .GetAssemblies()
    .SelectMany(x =&gt; x.GetTypes())
    .Where(x =&gt; x.IsSubclassOf(typeof(BaseParser)))
    .Select(x =&gt; (BaseParser) Activator.CreateInstance(x))
    .ToList();
</code></pre>

<p>The problem starts here.  The code above will not work since each of the legacy parsers do not have a parameterless constructor.  Also, I can't think of a good way to replace the IF/ELSE block and let each parser determine which file it can handle.  I was thinking about possibly adding a virtual method on the base parser:</p>

<pre><code>public virtual bool ShouldHandle(string type)
{
    return false;
}
</code></pre>

<p>... and each derived parser will override this virtual method.  However, there's two problems:</p>

<ol>
<li><p>No parameterless constructor and each class's constructor can have a different number of parameters.  This isn't something I can change since these legacy classes are used everywhere.</p></li>
<li><p>I have to instantiate the class before I can call the <code>ShouldHandle</code> method.  This poses a problem for classes that read from the stream in the constructor.</p></li>
</ol>

<p>Is there an alternative route I can take to split these parsers into their own assemblies?</p>

<p><strong>EDIT:</strong></p>

<p>This is a .NET 3.5 application.  No MEF unfortunately.</p>
","<c#><design-patterns><refactoring>","4","124","2012-01-19 08:25:22"
"8921926","Refactoring: How can I contain long names in a code area of 120 spaces?","<p>I am using Ruby on Rails 3.1.0 and I am refactoring/reordering my source code so to make that more readable. I am using a code area with a ""right margin"" of 120 spaces (that is, I have 120 characters of space to write the code).</p>

<p>The following image should make it clear what I mean:</p>

<p><img src=""http://i.stack.imgur.com/aO4Up.png"" alt=""enter image description here"">
<em>Note</em>: the image is from the NetBeans IDE software.</p>

<p>Now, in my source code I have long constant and method names that come out from that limit of 120 spaces. For example:</p>

<pre><code>a_my_very_long_variable_name_stated_just_for_testing_purposes = A_MY_VERY_LONG_CONSTANT_NAME_STATED_JUST_FOR_TESTING_PURPOSES

a_my_very_long_method_name_stated_just_for_testing_purposes(a_my_very_long_parameter_name_stated_just_for_testing_purposes_1, a_my_very_long_parameter_name_stated_just_for_testing_purposes_2)
</code></pre>

<p><strong>How should I refactor above codes? That is, how can I contain those in 120 spaces? What are best Ruby practices for these issues?</strong></p>

<p><em>P.S.</em>: I have considered the possibility of shortening constant and method names but at the moment is not applicable.</p>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring><reordering>","0","66","2012-01-19 06:29:16"
"8928145","Refactoring, nested method calls","<p>I'm refactoring a program that has a lot of nested calls such as </p>

<pre><code>ServiceManagement.getGlobalizationService()
                    .createExportConfiguration(
                            exportConfiguration,
                            getAdminWebClientSession().getUser().getToken()
                                    .getTokenValue());
</code></pre>

<p>I would love some advice as to what sort of refactoring would be appropriate here as well as the best and simplest place to start said refactoring, right now I find that to be an overly complicated and unclear block. </p>
","<java><refactoring>","0","62","2012-01-19 14:54:34"
"8934924","How can a view use a model that uses generics?","<p>In MVC 3, I've been refactoring my controllers to remove some duplicate code by using generics which I was successful in doing, but now I'm trying to refactor my views, but I can't seem to adjust the model that the view uses to use generics.</p>

<p>Here is the relevant portion of my refactored abstract base controller:</p>

<pre><code>public abstract class CrudController&lt;TEntity&gt; : Controller where TEntity : Entity, INamedEntity, IOrderedEntity, IHasMembers, new()
{
  private readonly IUnitOfWork _unitOfWork;
  protected readonly IRepository&lt;TEntity&gt; Repository;

  protected CrudController(IUnitOfWork unitOfWork)
  {
    _unitOfWork = unitOfWork;
    Repository = _unitOfWork.RepositoryFor&lt;TEntity&gt;();
  }

  public ActionResult Edit(int id)
  {
    return PartialView(Repository.FindById(id));
  }

  // More actions here...
}
</code></pre>

<p>Here are my actual controllers (they are really basic since the refactoring):</p>

<pre><code>public class StatusController : CrudController&lt;MemberStatus&gt;
{
  public StatusController(IUnitOfWork unitOfWork) : base(unitOfWork)
  {
  }
}

public class PositionController : CrudController&lt;MemberPosition&gt;
{
  public PositionController(IUnitOfWork unitOfWork) : base(unitOfWork)
  {
  }
}
</code></pre>

<p>Note that both <strong>MemberStatus</strong> and <strong>MemberPosition</strong> implement 'Entity, INamedEntity, IOrderedEntity, IHasMembers'</p>

<p>Now here are my <strong>Edit</strong> views for those two controllers which I want to refactor:</p>

<pre><code>@model MyApp.Domain.Entities.MemberStatus
@using (Html.BeginForm(""Save"", @ViewContext.RouteData.Values[""Controller""].ToString(), FormMethod.Post, new { id = ""EntityForm"" }))
{
  @Html.Hidden(""Id"")
  &lt;label class=""Name""&gt;
    &lt;span&gt;New Name:&lt;/span&gt;&lt;br /&gt;
    @Html.EditorFor(x =&gt; x.Name)
  &lt;/label&gt;
}

@model MyApp.Domain.Entities.MemberPositions
@using (Html.BeginForm(""Save"", @ViewContext.RouteData.Values[""Controller""].ToString(), FormMethod.Post, new { id = ""EntityForm"" }))
{
  @Html.Hidden(""Id"")
  &lt;label class=""Name""&gt;
    &lt;span&gt;New Name:&lt;/span&gt;&lt;br /&gt;
    @Html.EditorFor(x =&gt; x.Name)
  &lt;/label&gt;
}
</code></pre>

<p>You can see that the views are almost identical, with the exception of the first line which declares the model.  I want to find out how to pass in a generic parameter like I did with the controllers, which I thought (in my naivete) would look something like the following, but this obviously doesn't work.</p>

<pre><code>@model &lt;TEntity&gt; where TEntity : Entity, INamedEntity, IOrderedEntity, IHasMembers, new()
</code></pre>

<p>How can I refactor these two views (by putting a generic view in the Shared folder) that would implement a non-concrete model in the view?  Any suggestions are appreciated.</p>

<p>FYI - I <em>think</em> (though I haven't tried) that I could use a ViewModel, but I would prefer not to have to do that in this case (as I would have to implement the mapping from the entities to the ViewModel for each entity which somewhat defets the purpose of this refactoring).</p>
","<c#><asp.net-mvc><asp.net-mvc-3><generics><refactoring>","1","128","2012-01-19 23:31:27"
"8938320","Parallel Inheritance Hierarchy Refactoring","<p>I'm dealing with a Parallel Inheritance Hierarchy and I have an idea for a step by step refactoring and would like opinions on whether it will work or whether there is a better way to do it.</p>

<ol>
<li><p>Create a Handler class with children that implement the specific behavior required e.g <code>CarHandler</code> with children <code>vwHandler</code>, <code>fordHandler</code>, <code>bmwHandler</code></p></li>
<li><p>Add calls to all the components and restructure it so that the children return the objects neccessary. e.g. Call <code>vwHandler.getDrive</code> will return the result of <code>vwDrive.drive</code>, call <code>vwHandler.getSeat</code> returns <code>vwSeat.seat</code>)</p></li>
<li><p>Refactor the other classes so that they provide general functionality rather than specific e.g. Call <code>vwHandler.getDrive</code> will return <code>drive(vwSpec1, vwSpec2)</code></p></li>
</ol>

<p>Example of Handler</p>

<pre><code>public abstract class CarHandler
{
   private Car car;

   public Car getCar()
   {
       return car;
   }
   public Car setCar()
   {
       car = car;
   }

   public CarHandler(Car car)
   {
       this.car = car;
   }

   public Car getCar()
   {
       return car;
   }

   public void setCar(Car car)
   {
       this.car = car;
   }

   public void updateCar()
   {
       Globalizer.updateOnServer(car);
   }

   public abstract Drive getNewDrive();
   public abstract Seat getNewSeat();    
}
</code></pre>
","<java><refactoring>","0","136","2012-01-20 07:58:32"
"8950122","How do I apply the Law of Demeter to this?","<p>I have an admittedly ugly query to do, to find a particular role related to the current role.  This line produces the correct result:</p>

<pre><code>@person_event_role.event_role.event.event_roles.
  joins(:mission_role).where(:mission_roles =&gt; {:title =&gt; 'Boss'}).
  first.person_event_roles.first.person
</code></pre>

<p>(You can infer the associations from the plurality of those calls)</p>

<p>The only way to get this information requires a ton of knowledge of the structure of the database, but to remove the coupling... It would require filling in a bunch of helper functions in each step of that chain to give back the needed info... </p>
","<ruby-on-rails><refactoring><law-of-demeter>","0","79","2012-01-21 02:14:56"
"8957767","Shortcut key for refactoring menu (rename, ""using"", etc.) in Visual Studio 2008?","<p>Is there any way to bind a keyboard shortcut to first option in the refactoring menu that appears automatically while you're coding in Visual Studio 2008?</p>

<p><img src=""http://i.stack.imgur.com/McA49.png"" alt=""""></p>
","<c#><visual-studio><refactoring><keyboard-shortcuts><shortcut-key>","3","79","2012-01-21 23:50:36"
"8962394","refactor ""render format"" in multiple controllers","<p>so i've got a view method in multiple controllers which mostly looks exactly the same:</p>

<pre><code>  def show
    show! do |format|
      format.json do
        if @text.activated?
          @text.log
          render_for_api :texts_all, :json =&gt; @text
        else
          render :nothing =&gt; true
        end
      end
      format.pdf do
        pdf = QrPdf.new(@text)
        send_data pdf.render, filename: ""text_#{@text.id}.pdf"", type: ""application/pdf""
      end
    end
  end
</code></pre>

<p>the models for this are different, but they all have the same attributes that are used in this method (<code>activated</code>, <code>log</code>, <code>id</code>). i also could change the <code>render_for_api</code> given hash from which is currently <code>texts_all</code>, <code>documents_all</code> etc to a hash that its everywhere the same.</p>

<p>is there a way to use this code in multiple models without having this enormous duplication?</p>

<p>i'm thankful for every hint!
especially i find it hard to deal with the <code>do |format|</code> block. but also i'm not sure where to put the code and how to use it with different types of models. </p>

<p>thank you.</p>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring><controller>","2","83","2012-01-22 16:00:59"
"8963752","How can i factor out this code to avoid code duplication in C#?","<p>I have the following code:</p>

<pre><code>private int AllFeb(Forecast f, IRepository repository)
{
    return All(f, repository, f.Feb);
}

private int AllJan(Forecast f, IRepository repository)
{
    return All(f, repository, f.Jan);
}

private int All(Forecast f, IRepository repository, int callBk)
{
    var otherForecasts = repository.Query&lt;Forecast&gt;().Where(r =&gt; r.PersonId == f.PersonId);
    if (otherForecasts.Any())
    {
        return otherForecasts.Sum(r =&gt; r.Feb) + callBk;
    }
    return 0;
}
</code></pre>

<p>As you can see, I am trying to come up with a shared function that can be reused for every 
month. The issue is that I need the following line in the <code>All</code> method:</p>

<pre><code>otherForecasts.Sum(r =&gt; r.Feb)
</code></pre>

<p>to be generic but I need the callback inside the <code>Sum</code> method to be passed from outside (since I don't want it to be hardcoded as <code>r.Feb</code>.</p>

<p>Is there any way to avoid having code duplication here?</p>
","<c#><refactoring><code-duplication><duplication>","0","77","2012-01-22 19:05:38"
"8981097","refactoring of the java code","<p>I have a code which was not refactored at all. I refactored it to some extent..but stuck at a point where I cannot think of anything further.</p>

<p>Tractor.java:</p>

<pre><code>   package com.farm;

public class Tractor implements MethodsInterface{

private int[] position;

private int[] field;

private String orientation;

public Tractor(){
    position  = new int[]{0,0};
    field = new int[]{5,5};
    orientation = ""N"";
}

public void move(String command) {
if(command==""F""){
moveForwards();
}else if(command==""T""){
turnClockwise();
}

}

private void moveForwards() {
if(orientation==""N""){
position = new int[]{position[0], position[1]+1}; }else if(orientation == ""E""){ position = new int[]{position[0]+1, position[1]}; }else if(orientation == ""S""){ position = new int[]{position[0], position[1]-1}; }else if(orientation == ""W""){ position = new int[]{position[0]-1, position[1]}; } if(position[0]&gt;field[0]||position[1]&gt;field[1]){

try {
    throw new TractorInDitchException();
} catch (TractorInDitchException e) {
    e.printStackTrace();
}

}

}

private void turnClockwise() {
if(orientation==""N""){
orientation = ""E"";
}else if(orientation == ""E""){
orientation = ""S"";
}else if(orientation == ""S""){
orientation = ""W"";
}else if(orientation == ""W""){
orientation = ""N"";
}
}


public int getPositionX() {
return position[0];
}

public int getPositionY() {
return position[1];
}

public String getOrientation() {
return orientation;
}
}
</code></pre>

<p>TractorInDitchException.java</p>

<pre><code>package com.farm;

public class TractorInDitchException extends Exception{

}
</code></pre>

<p>MethodsInterface.java</p>

<pre><code>package com.farm;

public interface MethodsInterface {

    public int getPositionX();
    public int getPositionY();
    public String getOrientation();
}
</code></pre>

<p>What else could be refactored...any suggestions please?</p>
","<java><oop><refactoring><refactor-my-code><ooad>","0","85","2012-01-24 01:40:57"
"8998891","Want to DRY this code but have trouble","<p>I have two methods that do similar things. I am a noob and want to know how I might be able to make these combine into one method:</p>

<pre><code>#test if the current selected language is the one that was clicked in the menu
def link_to_without_class_unless_current_language(language)
  if language_selected?(language)
    content_tag(:li, content_tag(:span, content_tag(:em, language)), :class =&gt; ""current"")
  else
    content_tag :li, link_to(content_tag(:span, language), :locale =&gt; language.prefix)
  end
end


#tests if the current page is the same as that for the link
def link_to_without_class_unless_current(name, options)
  if current_page?(options[:url])
    content_tag(:li, content_tag(:span, content_tag(:em, name)), 
                :class =&gt; options[:class] ||= ""current"")
  else
    content_tag :li, link_to(content_tag(:span, name), options[:url])
  end
end
</code></pre>

<p>In the View:</p>

<pre><code>&lt;%= link_to_without_class_unless_current_language 'English'  %&gt; |
&lt;%= link_to_without_class_unless_current_language 'Français' %&gt;

&lt;%= link_to_without_class_unless_current t('application.menu_links.home'), 
                                         { :url =&gt; root_url } %&gt;
</code></pre>
","<ruby-on-rails><ruby-on-rails-3><refactoring><dry><refactor-my-code>","1","63","2012-01-25 06:53:59"
"9002171","Structural replace to delete an exception","<p>I want to delete an exception that should have never existed. I can not find the pattern that allows the deletion in the method declarations.</p>

<p>This code :</p>

<pre><code>public void method1(String param) throws ShouldHaveNeverExisted{
   System.out.println(""Yo"");
   //... 
}

public void method2WithoutParam() throws ShouldHaveNeverExisted{
   System.out.println(""Yo"");
   //... 
}
</code></pre>

<p>Should be transform in : </p>

<pre><code>public void method1(String param){
   System.out.println(""Yo"");
   //... 
}

public void method2WithoutParam(){
   System.out.println(""Yo"");
   //... 
}
</code></pre>

<p>The following pattern retrieve what I want but I can't find the correct replacement pattern.</p>

<pre><code>class $Class$ { 
   $ReturnType$ $MethodName$($ParameterType$ $Parameter$) throws ShouldHaveNeverExisted;
}
</code></pre>
","<java><refactoring><intellij-idea><search-and-replace><structural-search>","2","59","2012-01-25 11:45:43"
"9008851","Tool helping split a huge class into two","<p>Is there a good aid/tool for helping me split a huge class into parts?
The code does its job well, but having a class over 500 lines is not comfortable. I am sure it could be split up into smaller pieces.</p>

<p>This time I am interested in a tool for python, but I am sure it does not count.</p>
","<python><refactoring><developer-tools>","1","71","2012-01-25 17:33:19"
"9009420","Refactoring tools for View Engines? (I don't have a full version of Visual Studio)","<p>Are there refactoring tools for View Engines? (I don't have a full version of Visual Studio 2010) This might be a reason for me to buy a full version.  From what I understand, there is intellisense for templates (even for helpers and partials??).</p>

<p>It seems though that if there is intellisense then there might also be refactoring tools that work on view engine templates.  Of course, the only one that ""might"" support this would be Razor templates (if it exists at all).</p>
","<visual-studio-2010><refactoring><template-engine>","0","15","2012-01-25 20:00:56"
"9019419","Refactor EL expressions in JSPs","<p>I have many JSP files with EL expressions of the form <code>${foo.bar.baz.phleem1}</code>, <code>${foo.bar.baz.phleem2}</code> etc. (the first two or three segments are equal). To reduce EL lookups I am in the process of refactoring these pages:</p>

<p>Source:</p>

<pre><code>&lt;c:out value=""${foo.bar.baz.phleem1}"" /&gt;
&lt;c:out value=""${foo.bar.baz.phleem2}"" /&gt;
&lt;c:out value=""${foo.bar.baz.phleem3}"" /&gt;
</code></pre>

<p>After refactoring:</p>

<pre><code>&lt;c:set var=""baz"" value=""${foo.bar.baz}"" /&gt;
&lt;c:out value=""${baz.phleem1}"" /&gt;
&lt;c:out value=""${baz.phleem2}"" /&gt;
&lt;c:out value=""${baz.phleem3}"" /&gt;
</code></pre>

<p>I know I can do most of this with searching / replacing, but it feels unsafe as it ignores code structure.</p>

<p>Is there any support for this type of refactoring in either Eclipse or IntelliJ Idea?</p>
","<java><eclipse><jsp><refactoring><intellij-idea>","5","117","2012-01-26 14:17:39"
"9027151","How can I refactor a conditional statement that happens twice?","<p>Can I remove the second conditional to check if a course is full <em>and</em> improve readability?</p>

<pre><code>...    
if (course.isFull()) {
  attemptStudentCapacityIncrease(course);
  if (course.isFull()) {
    // could not increase course student capacity
    return;
  }
}
// course is not full
...
</code></pre>
","<java><refactoring>","0","49","2012-01-26 23:42:58"
"9047420","Using Partial Classes to manage code, good solution?","<p>Books usually say that if the classes get too big to manage, rethink the implementation because it is quite possible that the design needs correction since classes have not been defined properly.</p>

<p>But in situations where classes are indeed big, for example when a class is being extended to implement the functionality of a control (Canvas for example), and there are many different things like hit-testing, drawing, managing the drawn items etc. Is it a good solution to use partial classes in such cases to separate 'different' things of a bigger container (such as a custom control)?</p>

<p>Secondly, as a more general and broader solution, what should be considered before moving to Partial classes?</p>
","<c#><coding-style><refactoring><partial-classes><code-cleanup>","1","128","2012-01-28 17:42:15"
"9052347","Refactoring Legacy Code for Unit Testing - Please Critique","<p>I'm trying to refactor some code for Unit Testing and was hoping you could critique it.</p>

<p>This is the original method.</p>

<pre><code>public class MyNonRefactoredClass
{
   public List&lt;MyClass&gt; DoSomething()
  {
  List&lt;MyClass&gt; data = GetData();

  if (data.Count == 0)
    return new List&lt;MyClass&gt;();

  data = GetFormattedData(data);

  if (data.Count == 0)
    return new List&lt;MyClass&gt;();

  //Do some more stuff

  return data;
   }

  public List&lt;MyClass&gt; GetData()
  {
  //Do db query and return data
  }

  public List&lt;MyClass&gt; GetFormattedData(List&lt;MyClass&gt; Data)
  {
  //Do some logic on Data variable. Might return empty if data is not what I like
  }

}
</code></pre>

<p>Here is my new approach. I have done it like this as I believe I need an entry point to try and access methods that I want to test.</p>

<pre><code>public class MyRefactoredClass
{  
  public List&lt;MyClass&gt; DoSomething()
  {
    //Dependency Injection needs to work somehow here
    MySeparateClass newClass = new MySeperateClass(new DataProvider());
    List&lt;MyClass&gt; dbData = newClass.GetData();
    if (db.Data.Count == 0)
      return new List&lt;MyClass&gt;();
    dbData = newClass.GetFormattedData();
    if (db.Data.Count == 0)
      return new List&lt;MyClass&gt;();
    //Continue method doing other things...
    }
}

public class MySeparateClass
{
  private IDataProvider dbProvider;

  public MySeparateClass(IDataProvider DataProvider)
  {
    dbProvider = DataProvider;
  }

  public List&lt;MyClass&gt; GetData()
  {
    //Do DB stuff
    return dbProvider.GetData();
  }

  public List&lt;MyClass&gt; GetFormattedData(List&lt;MyClass&gt; Data)
  {
    //Format
  }
}

[Test]
public DoSomething_DBReturnsNoData_ReturnEmptyList()
{
  //Setup mock of IDataProvider
  //Tell mock to not return data from GetData
  //Assert that result.count == 0
}

[Test]
public DoSomething_FormattedReturnsNoData_ReturnsEmptyList()
{
  //Setup mock of IDataProvider
  //Tell mock to return some data from GetData
  //Setup mock of MySeparateClass
  //Tell mock to return no data from GetFormattedData
  //Assert that result.Count == 0
}
</code></pre>
","<c#><.net><unit-testing><refactoring><tdd>","0","90","2012-01-29 10:04:44"
"9056073","too many public methods with @ModelAttribute","<p>I have a controller that is 1600 lines long. This is mostly populated with a bunch of public methods with the <code>@ModelAttribute</code> annotation.  It also has a few <code>@RequestMapping</code> methods.  </p>

<p>I would like to bring down the line count and break-up this class. How do you handle multiple public methods with <code>@ModelAttribute</code> annotation?  Aren't they all invoked whenever a request is processed?  </p>
","<spring><spring-mvc><controller><refactoring><public-method>","3","113","2012-01-29 19:30:35"
"9082695","How to unit test method which uses static classes, without Moles or Isolator?","<p>I have a method</p>

<pre><code>     public int GetHighestPriorityPriceRecordIndex(SearchAndExtractReply_2 priceInfoReply)
    {
        int index = 0;

        var priceExposableColumn = GetPriceColumn(priceInfoReply, ""LPCIsPriceExposable"");

        var pricingSourceIDColumn = GetPriceColumn(priceInfoReply, ""LPCPricingSourceID"");

        var priceExposablePriority = new Dictionary&lt;string, int&gt; { { ""Y"", 2 }, { ""N"", 1 } };

        var pricingSourcePriority = new Dictionary&lt;string, int&gt; { { ""USA"", 5 }, { ""EME"", 4 }, { ""ASI"", 3 }, { ""DER"", 2 }, { ""NUS"", 1 } };

        if (priceExposableColumn.Value != null)
            for (int i = 1; i &lt; priceExposableColumn.Value.Length; i++)
                if (priceExposablePriority[priceExposableColumn.Value[i]] &gt; priceExposablePriority[priceExposableColumn.Value[index]]
                    &amp;&amp; pricingSourcePriority[pricingSourceIDColumn.Value[i]] &gt; pricingSourcePriority[pricingSourceIDColumn.Value[index]])
                    index = i;

        return index;
    }

    private static StringColumn GetPriceColumn(SearchAndExtractReply_2 priceInfoReply, string columnName)
    {
        return (StringColumn)SearchAndExtractReply_2_Extension.GetColumn(priceInfoReply, columnName);
    }
</code></pre>

<p>I want to unit test the class that has this method, this method uses static classes and method
SearchAndExtractReply_2_Extension.GetColumn.
How better way to refactor this code in the way that I can test this method without Moles or Isolator? Or better to use Moles to isolate the code?
Thanks in advance.</p>
","<c#><unit-testing><refactoring>","1","112","2012-01-31 16:01:19"
"9085195","split a string into a unique list - refactor this","<p>Ok, this looks ugly :) What is a good way to refactor this block of code?</p>

<p><code>Users</code> is data which is entered on the screen, and for this example we want distinct result in the <code>_someDTOObject.Users</code></p>

<pre><code>string[] userNames = Users.Split(new char[] { ',' });
string tempUserStr = """";
foreach (string user in userNames)
{
    tempUserStr += user.Trim().ToUpper() + "","";
}

userNames = tempUserStr.Split(new char[] { ',' });
var uniqueUsers = userNames.Distinct().ToList();

foreach (string user in uniqueUsers)
{
    if (!string.IsNullOrEmpty(user))
    {
        _someDTOObject.Users += user + "","";
    }   
}
</code></pre>
","<c#><string><refactoring>","2","116","2012-01-31 18:54:47"
"9086559","Naming convention for filter class?","<p>I wonder how could this be named better. </p>

<p>I've have class <code>Filter</code> (it happens to be in Ruby, but the language isn't all that important), which filters objects just like this:</p>

<pre><code>class Filter
    def initialize(items)
        @items = items
    end

    def filter
        #returns filtered items
    end
end
</code></pre>

<p>In use it looks like this:</p>

<pre><code>items = Filter.filter
</code></pre>

<p>I don't like it. Does anyone have any other <em>better</em> construction for this?</p>
","<refactoring><naming-conventions>","0","45","2012-01-31 20:35:46"
"9105357","R language aware code reformatting/refactoring tools?","<p>Recently I've found myself working with R code that is all over the map in terms of coding style - multiple authors and individual authors who aren't rigorous about sticking to a single structure. There are certain tasks that I'd like to automate better than I currently do.</p>

<p>I'm looking for a tool (or tools) that manage the following tasks - listed in increasing order of desire but also somewhat in increasing order of skepticism of existence. </p>

<ul>
<li><p>Basic formatting. Things like converting ""if( foo )"" to ""if (foo)"" and achieving uniformity in terms of brace location and that sort of thing.</p></li>
<li><p>Converting ""foo$blah"" to ""foo[[""blah""]]"" for list access. Ideally it'd be able to at least make a guess if an object was really a list and not a data.frame and only convert lists.</p></li>
<li><p>Converting '=' to '&lt;-'. Yes, this is a simple search and replace - but not really. The tool (or regexp) needs to be language aware such that it knows to convert ""x = 5"" but not ""foo(x=5)"". It'd also be really nice to not simply replace the symbol but also to ensure a single whitespace on both sides of the assignment operator.</p></li>
<li><p>Variable renaming, particularly across functions &amp; files. For instance, suppose a list has an element ""foo"", I'd love to be able to change it to ""foobar"" once and not have to track down every usage of that list throughout the entire code flow. I'd imagine this would require the tool to be able the entire flow of control in order to identify things such as that list existing as another name in a different function.</p></li>
<li><p>Naming conventions. I'd love to be able to define some standard naming convention (e.g. <a href=""http://google-styleguide.googlecode.com/svn/trunk/google-r-style.html"">Google's</a> or whatever) and have it identify all of the functions, variables, etc and convert them. Note that this ties in with the previous entry for things like list elements.</p></li>
</ul>

<p>Feel free to list basic unix processing commands (e.g. sed) as long as it'll really be smart enough to at least usually not screw things up (e.g. converting ""foo(x=5)"" to ""foo(x&lt;-5)"").</p>

<p>I'm guessing that if such a tool already existed in a perfect state that I'd have heard of it by now, and I'm also realizing that with a language like R it's difficult to do some of these sorts of changes automagically, but one can dream, right? Does anyone have pointers on some/all of these?</p>
","<r><refactoring><automated-refactoring>","14","237","2012-02-02 00:12:23"
"9108990","refactoring 2 similar if statement in ruby","<p>I am quite new in Ruby so would like to know and learn how to DRY. I have 2 if statement that's very similar, is there anyway to refactor it? </p>

<pre><code>msg1,msg2 = msg.split('.')

if !msg1.nil?
   items = msg1.split(',')
   items.each do |item|
     item.strip!
   end
   somefunction(items)
end

if !msg2.nil?
   items = msg2.split(',')
   items.each do |item|
     item.strip!
   end
   somefunction(items)
end 
</code></pre>
","<ruby><refactoring>","0","70","2012-02-02 08:10:57"
"9116673","User Control refactoring","<p>This is a performance issue and also a refactoring problem.</p>

<p>I have a .NET user control (UCA.ascx)... which in turn uses 5 other User Controls internally.
Each of these user controls run into greater than 2000 lines of code.</p>

<p>The web page loads UCA.ascx first ... then the other 5 user controls are loaded dynamically based on actions in UCA.ascx.
The code-behind of of these user controls use DTOs and have business logic in them.</p>

<p>The main problem is to resolve the long loading time and delayed operational time (due to postbacks). To resolve this issue, I would need to make sense of the code first.</p>

<ul>
<li><p>So, is there guidance on what should be and what should NOT be in the
user-control code-behind codebase? </p></li>
<li><p>Is there a tool-driven or easier way to refactor large, unwieldy user controls?</p></li>
</ul>
","<c#><.net><refactoring><ascx><layering>","3","70","2012-02-02 17:10:35"
"9121475","How do you manage PhoneGap and webapp Code?","<p>As far as I see every time I make a change, for example the value of a configuration variable, I have to</p>

<ul>
<li>Make a copy of the change in each project (webapp, Android, IPhone, etc.)</li>
<li>Build each project</li>
<li>Distribute each project (besides the webapp)</li>
</ul>

<p>I have found <a href=""https://build.phonegap.com/"" rel=""nofollow"">PhoneGap build</a> which seems to be a great solution for the mobile part. But it's still beta and it doesn't solve everything. I still have webapp's code, which is not exactly the same.</p>

<p>Do you know techniques, tools or tricks, which help to improve this process?</p>

<p>Thanks in advance.</p>
","<optimization><mobile><configuration><phonegap><refactoring>","1","152","2012-02-02 23:16:45"
"9129689","Is there any eclipse refactoring API that I can call programmatically?","<p>I need to refactor code in a wide term. I know that from inside the Eclipse IDE I can refactor my classes. But is there any API that I can use in a java project so that I can refactor projects dynamically through code?</p>

<hr>

<p>I need some idea on how to achieve the following: a program that calls all the eclipse refactorings for renaming and moving in a loop to refactoring the entire project in one shot!</p>

<hr>

<p>I don't want to introduce new refactoring types by extending the refactoring classes. I just want to call them programmatically.</p>

<hr>

<p>Thanks again to Paul Webster, Leif Frenzer, Mohsen Vakilian, and Arno for their great articles and help!</p>
","<java><eclipse><refactoring>","3","305","2012-02-03 13:53:52"
"9120568","Rename and Refactor Class in Eclipse, and Keep SVN History","<p>When I rename a class in Eclipse (using Ctl-Shft-R on the class name), it also renames the class file, which is helpful. Unfortunately, with my Subclipse plugin for SVN, it commits this as an add of the new class file and a remove of the old class file, and subsequent use of that new file's history will not show the history of the original file.</p>

<p>This is a documented problem with Subclipse, and it will be fixed LATER (meaning possibly never). See: <a href=""https://bugs.eclipse.org/bugs/show_bug.cgi?id=213991"" rel=""nofollow"">https://bugs.eclipse.org/bugs/show_bug.cgi?id=213991</a> .</p>

<p>I used to do a little song and dance with Tortoise SVN and Eclipse, but I don't like doing it (even though I like Tortoise).</p>

<p>How can I do this without using two applications? How can I do this with as little fuss as possible?</p>

<p>Cheers!</p>
","<java><eclipse><svn><refactoring><history>","2","157","2012-02-02 21:53:35"
"9120614","How to reuse code that reopens connection?","<p>Our production server kills inactive connections, so our API needs to restore them when they are needed. The following code works, but it is very repetitive:</p>

<pre><code>   private const int MaxRetryCount = 3;

    public static SqlDataReader RestoreConnectionAndExecuteReader(SqlCommand command)
    {
        int retryCount = 0;

        while (retryCount++ &lt; MaxRetryCount)
        {
            try
            {
                if (command.Connection.State == ConnectionState.Closed)
                    command.Connection.Open();
                return command.ExecuteReader();
            }
            catch(Exception e)
            {
                if(!e.Message.ToLower().Contains(""transport-level error has occurred""))
                {
                    throw;
                }
            }
        }
        throw new Exception(""Failed to restore connection for command:""+command.CommandText);
    }

    public static void RestoreConnectionAndExecuteNonQuery(SqlCommand command)
    {
        var retryCount = 0;
        while(retryCount++ &lt; MaxRetryCount)
        {
            try
            {
                if (command.Connection.State == ConnectionState.Closed)
                    command.Connection.Open();
                command.ExecuteNonQuery();
                return;
            }
            catch(Exception e)
            {
                if (!e.Message.ToLower().Contains(""transport-level error has occurred""))
                {
                    throw;
                }
            }
        }
        throw new Exception(""Failed to restore connection for command:"" + command.CommandText);
    }
</code></pre>

<p>How could I refactor my code and eliminate duplication? I need to keep the signatures of these methods, as they are used all over the system.</p>
","<c#><c#-4.0><ado.net><refactoring>","1","116","2012-02-02 21:57:05"
"9147541","Simplifying this Objective-C code for readability","<p>I wrote this following Objective-C code as part of Stanford's iTunes U course on iOS programming. Are there any ways to simplify this code? The requirement is that this method return nil if the set is empty, not an empty NSSet. It's also required to take an (id), not an NSArray, and that the method doesn't crash no matter what values are passed into it.</p>

<pre><code>+ (NSSet *)variablesUsedInProgram:(id)program {
    NSMutableArray *stack;
    id variables;
    NSMutableSet *setOfVariables;
    if ([program isKindOfClass:[NSArray class]]) {
        stack = [program mutableCopy];
        int i = stack.count;
        while (i--) {
            if ([[stack objectAtIndex:i] isKindOfClass:[NSString class]]) {
                if ([self isOperation:[stack objectAtIndex:i]]) {
                    [setOfVariables addObject:[stack objectAtIndex:i]];
                }
            }
        }
    }
    if (setOfVariables.count &gt; 0) {
        variables = setOfVariables;
    }
    return variables;
}
</code></pre>
","<objective-c><refactoring>","2","161","2012-02-05 07:02:01"
"9148984","Best way to build XML from XElements where many elements are shared?","<p><em>Note: I've read <a href=""http://stackoverflow.com/q/284324/449156"">this</a> and its not quite what I'm looking for:</em></p>

<p>I have an app that builds up XML from an input file and creates one of two outputs, depending upon the file chosen.  It was a ""quick n dirty"" app to get round an immediate problem, but I know it's going to find further use and want to pre-empt this by refactoring.</p>

<p>At the moment I have a ""builder"" class that takes the input (in its ctor) and exposes a property which is the required XElement.  However, many of the XElements are identical, except for the content, for both of my XML outputs. (Oh, please ignore the validation part which I'll refactor separately)</p>

<p>So I'm looking at a sensible way of DRYing my app:</p>

<p>At the moment I have something like this.</p>

<pre><code>public FirstBuilder(string line, int lineNumber, bool output, string subjectType, string inquiryCode)
{
    var split = Regex.Split(line, @""\|"");
    if (split.Count() != SPLIT_COUNT)
        throw new Exception(""This does not appear to be a valid First Type input file."");

    _lineNumber = lineNumber;
    _reportId = output ? TXT_REPORT_ID : XML_REPORT_ID;
    _subjectType = subjectType;
    _responseType = output ? TXT_RESPONSE_TYPE : XML_REPONSE_TYPE;
    _inquiryCode = inquiryCode;

    _product = split[0];
    _number = split[1];
    _amount = split[2];
    _currency = split[3];
    _name = split[4];
    _nationalId = split[5];
    _gender = split[6];
    _dateOfBirth = split[7];
    _nationality = split[8];
}

public XElement RequestElement
{
    get
    {
        return new XElement(""REQUEST"",
            new XAttribute(""REQUEST_ID"", _lineNumber),
            RequestParametersElement,
            SearchParametersElement);
    }
}

private XElement RequestParametersElement
{
    get
    {
        return new XElement(""REQUEST_PARAMETERS"",
            ReportParametersElement,
            InquiryPurposeElement,
            ApplicationElement);
    }
}

private XElement ReportParametersElement
{
    get
    {
        return new XElement(""REPORT_PARAMETERS"",
            new XAttribute(""REPORT_ID"", _reportId),
            new XAttribute(""SUBJECT_TYPE"", _subjectType),
            new XAttribute(""RESPONSE_TYPE"", _responseType));
    }
}

etc. etc...

//used by
var x = new FirstBuilder(x,y,z,etc.).RequestElement();
</code></pre>

<p>This all works and is very fast...but <code>SecondBuilder</code> also uses these same elements, along with some different ones.</p>

<p>So I'm looking at the ""best"" way to refactor these out:
Shared Abstract class with inheritance?
Shared ""Helper"" classes?
Extension methods to return ""built"" elements?
Classes per element that extend XElement?</p>

<p>My suspicion is that this will balloon from the two examples as a quick solution to around 30 in then next month!</p>

<p>THX.</p>
","<c#><refactoring><xelement>","0","97","2012-02-05 11:49:51"
"9173812","Refactoring in SpringSource Tool Suite produces non-working code","<p>If I rename classes with Refactor->Rename in STS, class references are automatically updated (like in a normal Eclipse Java project), <em>but not</em> in special Spring files like the XML configuration files (e.g. <code>root-context.xml</code>) which specify things like dependency injections. This results in non-working code. </p>

<p>Anybody knows how this problem is supposed to be handled?</p>
","<spring><refactoring><sts-springsourcetoolsuite>","0","50","2012-02-07 09:30:34"
"9178971","C# project naming conventions","<p>I'm refactoring a C# application to pull the logic out to a class library so a GUI and a CLI can sit on top of it, I just can't think of what to name the projects themselves. (Note: This is about the projects themselves, not the folders inside of a project like what <a href=""http://stackoverflow.com/questions/1389458/c-sharp-project-folder-naming-conventions"">this article</a> references)</p>
","<c#><refactoring><naming-conventions>","1","128","2012-02-07 15:29:28"
"9176256","C# best partial interface implementation in base/abstract class","<p>.net does not allow partial interface implementation in base classes. As a mitigation I've come to 3 alternate solutions. Please help me decide which is more universal in terms of refactoring, compile/run time errors, readability.
But first a couple of comments. </p>

<ul>
<li>Of course you may always cast object to IFoo and call any method without any compiler warning. But it's not logical, you wouldn't do that normally. This construct wouldn't occur as a result of refactoring.</li>
<li>I want maximum separation. Direct class contract (public methods and properties) should be separated with interface implementations. I use interfaces a lot to separate object interations.</li>
</ul>

<p>My comparison:</p>

<ol>
<li>BaseClass1/MyClass1: 
<ul>
<li>con: Have to create virtual abstract in BaseClass1 for each not implemented method of IFoo. </li>
<li>con: Additional method wrap - slight productivity impact at runtime.</li>
</ul></li>
<li>BaseClass2/MyClass2: 
<ul>
<li>con: no compiler warning if no implementation of Method2 in MyClass2. Runtime exception instead. Refactoring with poor unit test coverage may potentially destabilize code.</li>
<li>con: has to put additional obsolete construct to prevent direct method call from child classes.</li>
<li>con: Method2 is public for BaseClass1 so it's part of class contract now. Have to put ""Obsolete"" construct to prevent direct call, not via IFoo.</li>
</ul></li>
<li>BaseClass3/MyClass3:
<ul>
<li>pro: (Compared to #2). More readable. You see that MyClass2.Method2 is IFoo implementation, not just some overriden method.</li>
</ul></li>
</ol>

<pre class=""lang-cs prettyprint-override""><code>public interface IFoo
{
    void Method1();
    void Method2();
}
</code></pre>

<pre class=""lang-cs prettyprint-override""><code>public abstract class BaseClass1 : IFoo
{
    void IFoo.Method1()
    { 
        //some implementation
    }

    void IFoo.Method2()
    {
        IFooMethod2();
    }

    protected abstract void IFooMethod2();
}

public class MyClass1 : BaseClass1
{
    [Obsolete(""Prohibited direct call from child classes. only inteface implementation"")]
    protected override void IFooMethod2()
    {
        //some implementation
    }
}
</code></pre>

<pre class=""lang-cs prettyprint-override""><code>public abstract class BaseClass2 : IFoo
{
    void IFoo.Method1()
    {
        //some implementation
    }

    [Obsolete(""Prohibited direct call from child classes. only inteface implementation"")]
    public virtual void Method2()
    {
        throw new NotSupportedException();
    }
}

public abstract class MyClass2 : BaseClass2
{
    public override void Method2()
    {
        //some implementation
    }
}
</code></pre>

<pre class=""lang-cs prettyprint-override""><code>public abstract class BaseClass3 : IFoo
{
    void IFoo.Method1()
    {
        //some implementation
    }

    void IFoo.Method2()
    {
        throw new NotSupportedException();
    }
}

public abstract class MyClass3 : BaseClass3, IFoo
{
    void IFoo.Method2()
    {
        //some implementation
    }
}
</code></pre>
","<c#><interface><refactoring><abstract-class>","0","263","2012-02-07 12:26:45"
"9179187","Advice to improve the quality of the code module in Python","<p>Recently I had the idea to write a module for the transformation of the dictionary into valid <code>CSS</code> code. And I would like to hear your comments on my code. 
License MIT, BSD etc.</p>

<p>The code is very simple:</p>

<pre><code>#pss.py

__version__ = '1.0'

class PSS:
    def __init__(self, obj):
        self.obj = obj
        self.__data = {}
        self.__parse(obj)

    def __repr__(self):
        return self.__build(self.obj)

    def __build(self, obj, string = ''):
        for key, value in sorted(self.__data.items()):
            if self.__data[key]:
                string += key[1:] + ' {\n' + ''.join(value) + '}\n\n'

        return string

    def __parse(self, obj, selector = ''):
        for key, value in obj.items():
            if hasattr(value, 'items'):
                rule = selector + ' ' + key
                self.__data[rule] = []
                self.__parse(value, rule)

            else:
                prop = self.__data[selector]
                prop.append('\t%s: %s;\n' % (key, value))
</code></pre>

<p>import module:</p>

<pre><code>#test.py

from pss import *

css = PSS({
    'html': {
        'body': {
            'color': 'red',
            'div': {
                'color': 'green',
                'border': '1px'
            }
        }
    }
})

print(css)
</code></pre>

<p>Result:</p>

<pre><code>html body {
        color: red;
}

html body div {
        color: green;
        border: 1px;
}
</code></pre>

<p>So I need your advice to improve the quality of the code</p>
","<python><css><refactoring>","0","68","2012-02-07 15:42:21"
"9179951","Migrate from Google App Engine Model to Pure Django System","<p>How can I rewrite this AppEngine specific code for pure Django Model system 
(without google api)</p>

<pre><code>class A(db.Model):
    name = db.StringProperty(multiline=True)
    description = db.TextProperty()
    isAdvanced = db.BooleanProperty()
    foos = db.ListProperty(db.Key)    
    bar = db.IntegerProperty()

    def get_foos(self):
        return db.get(self.foos)
</code></pre>
","<python><django><google-app-engine><refactoring>","0","118","2012-02-07 16:29:05"
"9180265","Mocking a class that inherits from another class","<p>So here is the scenario, I am refactoring some spaghetti code. My first problem was a chain of classes that newed up other classes, I fixed this by making the ctor of the class I want to test (Search.cs) take the class it needs as a dependency, it looks like this now. </p>

<pre><code> public Search(XmlAccess xmlFile, SearchDatabaseConnect searchDatabaseConnection)
    {
        this.xmlFile = xmlFile;
        FsdcConnection = searchDatabaseConnection;
        Clear();
    }
</code></pre>

<p>I'm newing it up further up the chain. That is all good but I have a little problem. </p>

<p>The class that I am ctor injecting inherits from another class, I have Resharper and I have extracted interfaces but the problem is the dependency class inherits from another concrete class - see what I mean? </p>

<pre><code> public class SearchDatabaseConnect : DatabaseConnect, ISearchDatabaseConnect 
{ // }
</code></pre>

<p>I don't know what to do about the inheritance on DatabaseConnect? How do I mock that? Obviously if that wasn't there I would be all set I could mock an ISearchDatabaseConnect and away we go but I am stuck on the inheritance of a concrete class. I am sure people have run into this before my googl'ing was a failure when it came to finding examples about this. </p>

<p>Thanks in advance for any useful suggestions. </p>
","<c#><testing><refactoring>","5","65","2012-02-07 16:47:47"
"9185034","Eclipse: refactoring functionality in Struts 2 app. Possible?","<p>in <code>struts.xml</code> I have a list of action's.</p>

<p>In <code>.jsp</code> pages I have a links on actions, that described in <code>struts.xml</code>.</p>

<p>So, for example, I changed name for one action, on the next step - I must fix all links on all pages, I must set correct new action name. </p>

<p>If I have many pages - it is really hard and mmmm... stupid? job.</p>

<p>As IDE I use <code>Eclipse</code>.</p>

<p>How solution for this situation?</p>
","<java><eclipse><struts2><refactoring>","0","58","2012-02-07 22:32:10"
"9202663","Passing a multi-method object to another class","<p>As part of a personal project I am working on I took a small codebase written by another programmer and was trying to refactor it to my own purposes. Long story short, they had this huge section of code that was an incoming command parser. I moved the code to it's own class file and moved several code bits to their own methods in that class. The problem I'm encountering is that I can't pass two needed objects from the original block of code to the new parser class. The orginal code section uses an mutliple-method object called AllSockets. I can't seem to figure out how to pass this object to the new class method without getting the error </p>

<blockquote>
  <p>Error 2   Argument 2: cannot convert from 'method group' to 'object'  </p>
</blockquote>

<p>The invoking line of code:</p>

<pre><code>bool wasValidCommand = (commandParser.CheckForCommands(thisConnection, AllSockets, characterPath, helpFilePath));
</code></pre>

<p>The method invoked: </p>

<pre><code>public bool CheckForCommands(ConnectionInfo _connected, object _AllSockets, string characterPath, string helpFilePath)
</code></pre>

<p>I've posted the hosting Server.cs class here: <a href=""http://codepad.org/1kRHA1nk"" rel=""nofollow"">http://codepad.org/1kRHA1nk</a></p>

<p>The new class I am trying to pass the object to is here: <a href=""http://codepad.org/oONRaEtt"" rel=""nofollow"">http://codepad.org/oONRaEtt</a></p>

<p>Warning: The code is really hacked together right now and variable naming is a nightmare. I can paste the specific sections if that would be easier to read. Any help would be appreciated.</p>
","<c#><object><methods><refactoring><wrapper>","0","105","2012-02-08 22:43:15"
"9196796","Group a collection and return a Dictionary","<p>I've written a method that takes a collection of items (price items - each item has an amount and a code) and groups them by code then returns an IDictionary where the key is the code of the item and the value is the group of items with that code (Hope that makes sense!)</p>

<p>Here's the implementation of the method:</p>

<pre><code>public IDictionary&lt;string, IEnumerable&lt;PriceDetail&gt;&gt; GetGroupedPriceDetails(IEnumerable&lt;PriceDetail&gt; priceDetails)
{
    // create a dictionary to return
    var groupedPriceDetails = new Dictionary&lt;string, IEnumerable&lt;PriceDetail&gt;&gt;();

    // group the price details by code
    var grouping = priceDetails.GroupBy(priceDetail =&gt; priceDetail.Code);

    // foreach grouping, add the code as key and collection as value to the dictionary
    foreach (var group in grouping)
    {
        groupedPriceDetails.Add(group.Key, group);
    }

    // return the collection
    return groupedPriceDetails;
}
</code></pre>

<p>I then tried to refactor this to use ToDictionary like so:</p>

<pre><code>// group the price details by code and return
return priceDetails.GroupBy(priceDetail =&gt; priceDetail.Code)
                   .ToDictionary(group =&gt; group.Key, group =&gt; group);
</code></pre>

<p>I get an error when I try to compile which says I can't convert from a dictionary of <code>string, IGrouping&lt;string, PriceDetail&gt;</code> into a dictionary of <code>string, IEnumerable&lt;PriceDetail&gt;</code>.</p>

<p><strong>Can someone tell me how to correctly refactor my first attempt at this method?  I feel that there's a more concise way of writting it but can't figure it out!</strong></p>
","<c#><.net><linq><refactoring>","2","72","2012-02-08 15:56:37"
"9225898","Chaining multiple jQuery ajax requests","<p>I have the following code:</p>

<pre><code>$.when(loadProjects())
    .then(function() {

        $.when.apply($, buildRequests(projects))
        .then(function(data) {

            $.when.apply($, vcsRequests(buildTypes))
            .then(function(data) {

                $.when.apply($, vcsDetailRequests(vcsRoots))
                .then(function(data) {
                    alert('done');
                });

            });

        });

    });
</code></pre>

<p>Each of the functions passed into when.apply() return arrays of requests. I cannot perform the buildRequests calls until the calls from loadProjects() has finished as they rely on information returned from those calls. Each call depends on information returned by the previous call, so they must be in this order. I need to know when all the calls have finished so I can process the data returned.</p>

<p>Is there a cleaner way to approach this?</p>
","<javascript><jquery-ajax><refactoring>","4","130","2012-02-10 09:56:08"
"9227489","Django: Detect unused templates","<p>Is there a way to detect unused templates in a Django project?</p>

<p>Before Django 1.3, that would have been possible with a simple string-matching function like <a href=""https://github.com/AMeng/django-unused-templates"" rel=""nofollow"">this one</a>. But since 1.3, there are generic class based views that automatically generate a <code>template_name</code>, if you don't override it (e.g. DetailView).</p>

<p>Also, if you override 3rd party module templates, those templates aren't used anywhere directly in your views.</p>

<p>Maybe it could be done by crawling all URL definitions, loading the corresponding views and getting the <code>template_name</code> from them?</p>
","<python><django><refactoring><code-cleanup>","0","84","2012-02-10 12:06:29"
"9228553","Conditionally optional parameters to remove overloads","<p>I have the following C# methods:</p>

<pre><code>public Vector2 GetVectorToTile(int x, int y)
    {
        return new Vector2(x * TileWidth, y * TileHeight);
    }
public Vector2 GetVectorToTile(Point start)
    {
        return GetVectorToTile(start.X, start.Y);
    }
</code></pre>

<p>The second method overloads the first in a very simple manner. However, I don't really like such an ""input sanitizer overload""- I feel that there shouldn't be a separate method for converting each possible input type.</p>

<p>Now if the input of the first method was a single <code>Vector2</code> instead of two numbers, I could use conditional arguments such that if the argument is <code>Point</code> instead of <code>Vector2</code>, it should first convert from <code>Point</code> to <code>Vector2</code> and then proceed as usual.</p>

<p>However, that is not the case.</p>

<p>So my question is, how can I tell the method to accept ""EITHER two integers OR a single point"", and then convert the latter into the former before computing a result?</p>

<p>I can do this in a contrived manner in Matlab, but it looks completely unrelated to C#:</p>

<pre><code>function result = VectorToTile(varargin)
    x = 0;
    y = 0;

    if size(varargin{1}) == [1, 1]
        disp('Assuming Vector input!');
        x = varargin{1}{1}.x; % Assuming the ""Vector2"" equivalent is a struct with .x and .y
        y = varargin{1}{1}.y;
    else
        disp('Assuming integer pair input!');
        x = varargin{1}{1};
        y = varargin{1}{2};
    end

    result.x = x * 32; % An example value for TileWidth
    result.y = y * 32; % An example value for TileHeight
end
</code></pre>

<p>This will work with the following two inputs:</p>

<pre><code>ints{1} = 25;
ints{2} = 125;
VectorToTile(ints);

vect{1}.x = 25;
vect{1}.y = 125;
VectorToTile(vect);
</code></pre>

<p>It illustrates what I want to do, but unfortunately there isn't really a <code>varargin</code> in C#, nor is everything treated as a matrix.</p>
","<c#><refactoring><overloading>","1","101","2012-02-10 13:31:48"
"9259386","Must Read Books on Java?","<p>Just wanted to know if anyone has a reading list of the books that all java programmers must read for both refactoring and Design of applications? Any inputs on the same would be of real help.</p>

<p>TIA</p>
","<java><oop><design><design-patterns><refactoring>","-3","150","2012-02-13 11:04:39"
"9269057","Refactoring code into subdirectories","<p>I have two classes called <em>Person</em> and <em>Animal</em> that have a lot of methods in them. I have a need to export some data from these classes to CSV. I also want to refactor the CSV specific code out of the class files themselves (and move it to modules). So, I created directories called <em>person/</em> and <em>animal/</em>, and put a csv_export.rb file in each (with a CSVExport Module).</p>

<pre><code>person.rb
person/csv_export.rb
animal.rb  
animal/csv_export.rb
</code></pre>

<p>CSV exported data is different enough for the two classes that I can't just have one common csv_export.rb file (for now).</p>

<p>Example of person.rb:</p>

<pre><code>class Person
  include CSVExport

  # numerous methods...
end
</code></pre>

<p>Example of csv_export.rb:</p>

<pre><code>module CSVExport
  def to_csv
    # some logic
  end
end
</code></pre>

<p>My question is what's the correct way to namespace these two modules so they load properly? And what is the proper way to require them within <em>Person/Animal</em> (assuming the files aren't loaded by something like Rails)?</p>
","<ruby><refactoring><gem>","0","48","2012-02-13 22:34:30"
"9270004","SQL - How do I simplify this easy query?","<p>I am using SQL Server 2005. </p>

<p>How could I refactor this query?</p>

<pre><code>SELECT Total, Installs, Service, tot.ls_chg_dte_ojb
  FROM (SELECT COUNT(*) [Total], ls_chg_dte_ojb
         FROM [COMPL_INST_SVC]
         GROUP BY ls_chg_dte_ojb) tot

  JOIN (SELECT COUNT(*) [Service], ls_chg_dte_ojb
         FROM [COMPL_INST_SVC]
         WHERE job_class_ojb = 'S' 
         GROUP BY ls_chg_dte_ojb) svc on svc.ls_chg_dte_ojb = tot.ls_chg_dte_ojb

  JOIN (SELECT COUNT(*) [Installs], ls_chg_dte_ojb
         FROM [COMPL_INST_SVC]
         WHERE job_class_ojb in ('C', 'R') 
         GROUP BY ls_chg_dte_ojb) ins on ins.ls_chg_dte_ojb = tot.ls_chg_dte_ojb
</code></pre>
","<sql><sql-server><sql-server-2005><refactoring>","1","94","2012-02-14 00:13:03"
"9277378","How to deal with method rename when using Osherove's convention for unit tests?","<p>I like the unit tests naming convention recommended by Roy Osherove where unit tests look like this:</p>

<p><strong>SomeMethod_Scenario_ExpectedResults</strong></p>

<p>For <code>SomeMethod</code>, there will usually be more test methods that follow this convention and the question is how to deal with <code>SomeMethod</code> rename. I quite don't like the idea of going through all of the unit tests manually and renaming them one by one.</p>

<p>Is there a tool to help with this? Or maybe this is a weakness of Osherove's convention and I should go with something like this <a href=""http://haacked.com/archive/2012/01/02/structuring-unit-tests.aspx"" rel=""nofollow"">nested classes approach</a>?</p>
","<c#><unit-testing><refactoring>","0","60","2012-02-14 13:06:50"
"9280132","Parse/Refactor C# via C# code","<p>Is there any libraries from Microsoft or from Mono project that allow you to do sweeping changes on a C# code base via code? Anything in Cecil for this? I think Cecil would only allow you to work at the bytecode level - anything to work on the language level?</p>

<p>I have already identified the issues I'd like to correct. Just could use some help with the Search/Replace in a C# syntax-aware fashion.</p>
","<c#><.net><refactoring><mono.cecil>","1","106","2012-02-14 16:04:44"
"9282718","Refactoring EAV modelled data with dynamic tables","<p>I have been tasked with refactoring a project that currently uses an <a href=""http://en.wikipedia.org/wiki/Entity%E2%80%93attribute%E2%80%93value_model"" rel=""nofollow"">EAV model</a> for data storage.</p>

<p>In some implementations, the main table holds <strong>several million</strong> rows. As you can imagine, I consider this an abomination.</p>

<p>The refactor is driven by a need to do spatial searches, which don't really work when your lat and long are stored as comma separated text in a VARCHAR field... but I digress.</p>

<hr>

<p>The nature of the project means that producing a static set of normalised tables in advance, is out of the question. Think of it as a kind of a dynamic form builder, where the number of fields in a new form is unknown, the number of options for a dropdown is unknown, etc.</p>

<p>I'm toying with the idea of creating a ""DynamicTable"" class, that would maintain a dictionary of fields, and manage a dynamically created set of tables. Caching is already very well implemented (using memcached) so the dictionary would only need to be queried when the schema is changed (rare after initial commit) and on reboot (even more rare).</p>

<hr>

<p>My initial attempts at fleshing out even something basic are making me realise the full scale of what I want to do, and my searches for similar projects have been pretty fruitless.</p>

<p>Can anyone:</p>

<ul>
<li>Commend mycurrent approach and wish me luck.</li>
<li>Recommend an alternative approach that is better, even if it isn't necessarily easier.</li>
<li>Recommend any projects I can look at that achieve a similar goal (my searching yields nothing!)</li>
</ul>

<p>Cheers guys!</p>
","<php><mysql><database><refactoring>","1","57","2012-02-14 19:10:35"
"9294947","Eclipse support for refactoring train wrecks","<p>Can eclipse do this refacotring?</p>

<p>Say I have a class that has a List: </p>

<pre><code>class DomainObject {
    private List list;
    public List getList() { return list; }
}
</code></pre>

<p>Then some code that uses the class needs to do this:</p>

<pre><code>domainObject.getList().get(23);
</code></pre>

<p>I'd like to refactor to this (and have all other references do the same):</p>

<pre><code>domainObject.get(23);
</code></pre>

<p>I've tried a few options but can't seem to find a way of doing this (other than manually)</p>
","<java><eclipse><refactoring>","1","102","2012-02-15 14:13:33"
"9291505","Tool to refactor ""with"" blocks","<p>Is there a refactoring tool to remove ""with"" blocks? For example convert</p>

<pre><code>with Form1 do
begin
  Height := Blah;
  Blubb := Name;
end;
</code></pre>

<p>to</p>

<pre><code>Form1.Height := Blah;
Blubb := Form1.Name;
</code></pre>

<p>where Form1 is a VCL TForm. Optimally it should work with Delphi 2007.</p>
","<delphi><refactoring><delphi-2007><with-statement>","6","204","2012-02-15 10:19:12"
"9302452","Turning three similar methods into one method","<p>I want to turn these three methods into one, but am unable to wrap my brain around it at this moment. Complicated by the fact that 1/3 requires a slightly different call. They're all similar enough, and I know there is a better way, but beyond my skill level right now. With one extra variable passed in (fetch, check, or process) I could turn it into one, how to do this eludes me.</p>

<p>If you were to refactor these into one method, how would you do it? </p>

<pre><code>def fetch(subjects = current_subjects, queues = QUEUES)
  subjects.each do |s|
    queues.each { |x| fetch_results(x, s) } unless queue.nil?
  end
end

def check(subjects = current_subjects, queues = QUEUES)
  subjects.each do |s|
    queues.each { |x| check_results(s[""#{x}_recent""]) } unless queue.nil?
  end
end

def process(subjects = current_subjects, queues = QUEUES)
  subjects.each do |s|
    queues.each { |x| process_results(s[""#{x}_recent""]) } unless queue.nil?
  end
end
</code></pre>

<p>EDIT: One solution is close to what I was thinking earlier, but I didn't make it clear that I want to pass in the <code>what</code> as a smallish array, that might be expandable and can used to indicate whether to fetch, check, or process or any combination of those. So, essentially, I'm trying to loop through three things with one method:</p>

<ul>
<li>an action what: I.E., fetch, check, or process.</li>
<li>any number of subjects.</li>
<li>any number of queues, which is a constant at the moment.</li>
</ul>

<p>Also, other solutions here:</p>

<p><a href=""http://refactormycode.com/codes/2002-three-into-one"" rel=""nofollow"">http://refactormycode.com/codes/2002-three-into-one</a></p>
","<ruby><refactoring><refactor-my-code>","2","49","2012-02-15 22:24:45"
"9308395","Django tables names","<p>I am refactoring a Django application. Specifically, I have an application with a big <code>models.py</code> file and I am trying to split it into a bunch of small files, like</p>

<pre><code>myapp/
    models/
        __init__.py
        somemodels.py
        someothers.py
        somemore.py
        ...
</code></pre>

<p>and in <code>models/__init__.py</code> I import all models from all other files so that I do not have to change client code.</p>

<p>The problem is that Django now complains about table names. Table for model <code>Foo</code> used to be <code>myapp_foo</code>, but it seems that Django now looks for a table <code>myapp.models_foo</code>. That is, it seems that it uses as prefix the package where the models are defined instead of their application (of course <code>myapp.models</code> is not registered as a Django application).</p>

<blockquote>
  <p>I know I could manually set the table name for each and every models, but is there a way to avoid this and tell Django that these models are actually part of <code>myapp</code>?</p>
</blockquote>
","<python><django><django-models><refactoring>","0","63","2012-02-16 09:15:01"
"9312099","How can I refactor javascript using arrays?","<p>How can i told once: <code>spanlist.addClass(text)</code> and so over, once in code, so that it would work? </p>

<p>I have such code:</p>

<pre><code>$(document).ready(function(){    
  if ($.browser.msie || $.browser.webkit &amp;&amp; jQuery.browser.version.substr(0,1)&lt;='6' &amp;&amp; readCookie('already_submit')!=1) { 

    var iemessage = document.createElement(""div"");
      $(iemessage).addClass(""ie-message"");
      $('body').append(iemessage);   
      var frame = document.createElement(""iframe"");
        $(frame).addClass(""nsframe"");
        $(iemessage).append(frame);  

      var alerterror = document.createElement(""div"");
          $(alerterror).addClass(""alert error"");
          $(iemessage).append(alerterror);

      var close = document.createElement(""div"");
          $(close).addClass(""close-text"");
          $(alerterror).append(close);
          var textclose = document.createElement(""div"");
              $(textclose).addClass(""text-img"");
              $(textclose).text(""close"");
              $(close).append(textclose);

      var h2 = document.createElement(""h2"");
          $(h2).text(""Sorry, your web-browser is outdated..."");
          $(alerterror).append(h2);

      var h3 = document.createElement(""h3"");
          $(h3).text(""Our site could be displayed not correctly in your browser."");
          $(alerterror).append(h3);

      var p = document.createElement(""p"");
          $(p).text(""We recommend you install new version of web-browser:"");
          $(alerterror).append(p);

      var spanlist = [spanchrome, spanfirefox, spanopera, spansafari, spanexplorer];
      var classlist =[""browser-button chrome"", ""browser-button firefox"", ""browser-button opera"", ""browser-button safari"", ""browser-button ie""];
      var text = [""Google Chrome"", ""Mozilla Firefox"", ""Opera"", ""Apple Safari"", ""Internet Explorer""];
      var browserslist = document.createElement(""div"");
          $(browserslist).addClass(""browsers-list"");
          $(iemessage).append(browserslist);          

          var achrome = document.createElement(""a"");
              $(achrome).attr(""href"", ""http://www.google.com/chrome"");
              var spanchrome = document.createElement(""span"");
                  $(spanchrome).addClass(""browser-button chrome"");
                  $(spanchrome).text(""Google Chrome"");
                  $(achrome).append(spanchrome);

          var afirefox = document.createElement(""a"");
              $(afirefox).attr(""href"", ""http://www.mozilla.com/firefox/"");
              var spanfirefox = document.createElement(""span"");
                  $(spanfirefox).addClass(""browser-button firefox"");
                  $(spanfirefox).text(""Mozilla Firefox"");
                  $(afirefox).append(spanfirefox);

          var aopera = document.createElement(""a"");
              $(aopera).attr(""href"", ""http://www.opera.com/download/"");
              var spanopera = document.createElement(""span"");
                  $(spanopera).addClass(""browser-button opera"");
                  $(spanopera).text(""Opera"");
                  $(aopera).append(spanopera);

          var asafari = document.createElement(""a"");
              $(asafari).attr(""href"", ""http://www.apple.com/safari/download/"");
              var spansafari = document.createElement(""span"");
                  $(spansafari).addClass(""browser-button safari"");
                  $(spansafari).text(""Apple Safari"");
                  $(asafari).append(spansafari);

          var aexplorer = document.createElement(""a"");
              $(aexplorer).attr(""href"", ""http://www.microsoft.com/windows/Internet-explorer/default.aspx"");
              var spanexplorer = document.createElement(""span"");
                  $(spanexplorer).addClass(""browser-button ie"");
                  $(spanexplorer).text(""Internet Explorer"");
                  $(aexplorer).append(spanexplorer);           
      var links = [achrome, afirefox, aopera, asafari, aexplorer];      
          links.sort(function(){ 
            return Math.round(Math.random())-0.5; //so we get the right +/- combo
           }).slice(0,4);
          $(browserslist).append(links);

    $(iemessage).toggle();
    $('.close-text').mouseover(function() {
        $('.close-text').css({""border-bottom"":""1px solid #000""});
        $('.close-text').css({""color"":""#959595""});
        $('.close-text').css({""background"":""url(/assets/browsers/button-close-hover.png) 100% 100% no-repeat""});
    });  
    $('.close-text').mouseleave(function() {
        $('.close-text').css({""border-bottom"":""none""});
        $('.close-text').css({""color"":""#4e4e4e""});
        $('.close-text').css({""background"":""url(/assets/browsers/button-close.png) 100% 100% no-repeat""});
    });   
    $('.close-text').click(function() {
        $('.ie-message').hide();
        createCookie('already_submit', 1, 0);
    });          
  }

  function createCookie(name,value,days) {
    if (days) {
        var date = new Date();
        date.setTime(date.getTime()+(days*24*60*60*1000));
        var expires = ""; expires=""+date.toGMTString();
    }
    else var expires = """";
    document.cookie = name+""=""+value+expires+""; path=/"";
  }

  function readCookie(name) {
    var nameEQ = name + ""="";
    var ca = document.cookie.split(';');
    for(var i=0;i &lt; ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
  }

  function eraseCookie(name) {
    createCookie(name,"""",-1);
  }
});
</code></pre>

<p>as you see I want to refactor such partitions: </p>

<pre><code>$(spanchrome).addClass(""browser-button chrome"");
                  $(spanchrome).text(""Google Chrome"");
</code></pre>

<p>How can I told once: <code>spanlist.addClass(text)</code> and so over, once in code, so that it would work?</p>
","<javascript><jquery><refactoring>","0","109","2012-02-16 13:26:45"
"9315479","Heat Map for Code Repository Check-ins","<p>Is there a good tool for looking through a code repository and finding the places that have the most changes per checkin?</p>

<p>It may be useful for finding bugs, or places to refactor code.</p>

<p>Currently I use SVN, but any other solutions would be considered.  Thanks!</p>
","<svn><refactoring><repository><heatmap>","5","121","2012-02-16 16:55:58"
"9309513","how to get a list of methods from a class in java?","<p>I want to enter the path of the java class as input and in output it should give me the list of methods in that class.how do i proceed ? can anyone guide me.pls.</p>
","<java><refactoring>","0","71","2012-02-16 10:21:45"
"9332770","How to refactor a large xib file using Xcode 4?","<p>We have a large application that has 21 view controllers - all in a single xib. We'd like to refactor this into individual xib files - one per view controller. I don't see any obvious way to do this in Xcode 4. Is this possible or do I have to start from scratch?</p>

<p>(Answering my own question here...)</p>

<p>Ahah! (Eureka)</p>

<p>If I open a second xcode  window (File->New->Window) and create an empty .xib file, I can drag objects from the xib in the main xcode window into the empty xib in my new xcode window!</p>
","<xcode4><refactoring><xib>","1","60","2012-02-17 17:30:32"
"9328061","Split array into size limited CSV strings","<p>I am looking for an efficient way to convert a large int[] into a string[] of csv strings where each csv is limited to a maximum of 4000 characters. The values in the array could be anything between 1 and int.MaxValue.</p>

<p>Here is my final code:</p>

<pre><code>public static string[] GetCSVsFromArray(int[] array, int csvLimit)
{
    List&lt;string&gt; parts = new List&lt;string&gt;();
    StringBuilder sb = new StringBuilder();
    foreach(int id in array)
    {
        string intId = id.ToString();
        if (sb.Length + intId.Length &lt; csvLimit)
            sb.Append(intId).Append("","");
        else
        {
            if (sb.Length &gt; 0)
                sb.Length--;
            parts.Add(sb.ToString());
            sb.Length = 0;
        }
    }
    if(sb.Length&gt;0)
       parts.Add(sb.ToString());
    return parts.ToArray();
}
</code></pre>

<p>Is there a more efficient way to do this?</p>

<p>So here is what I am now using (I was able to change the return parameter to the List type to save the ToArray() call at the end):</p>

<pre><code>public static List&lt;string&gt; GetCSVsFromArray(int[] array, int csvLimit)
{
    List&lt;string&gt; parts = new List&lt;string&gt;();
    StringBuilder sb = new StringBuilder();
    foreach(int id in array)
    {
        string intId = id.ToString();
        if (sb.Length + intId.Length &lt; csvLimit)
            sb.Append(intId).Append("","");
        else
        {
            if (sb.Length &gt; 0)
                sb.Length--;
            parts.Add(sb.ToString());
            sb.Length = 0;
        }
    }
    if(sb.Length&gt;0)
       parts.Add(sb.ToString());
    return parts;
}
</code></pre>

<p>Performance results:</p>

<p>10,000,000 items csv Limit of 4000 characters</p>

<ul>
<li>Original: 2,887.488ms</li>
<li>GetIntegerDigitCount: 3105.355ms</li>
<li>Final: 2883.587ms</li>
</ul>

<p>Whilst I only saved 4ms removing the ToArray() call on my developer machine this seems to make a significant difference on a much slower machine (saved over 200ms on a DELL D620)</p>
","<c#><.net-3.5><refactoring>","2","152","2012-02-17 12:18:38"
"9328926","Automatically change public to private (Java)","<p>I am doing a refactoring and I have a lot of methods that aren't private but are just called in the same class that they are declared, so I need to make them private. But I have a lot of classes and I guess if there is something that can help me to do it semi-automatically.</p>

<p>Do you know if I can look for these methods to make them private fastly? I am using Eclipse.</p>

<p>Thank you</p>
","<java><eclipse><refactoring><private>","5","127","2012-02-17 13:16:42"
"9346251","converting legacy data to json format","<p>I am working with some legacy code where I am using a column value and its earlier history to make some comparisons and highlight the differences. However, the column is stored in an arbitary delimited fashion and the code around comparison is well, very hard to understand.</p>

<p>My initial thought was to refactor the code - but when I later thought about it, I thought why not fix the original source of the issue which is the data in this case. I have some limitations around the table structure and hence converting this from a single column into multiple column data is not an option. </p>

<p>With that, I thought if its worth to convert this arbitary delimited data into a standardized format like json. My approach would be to export this data to some file and apply some regular expressions and convert this data to json format and then re-import it back. </p>

<p>I wanted to check with this group if I am approaching this problem the right way and if there are other ideas that I should consider. Is JSON the right format in the first place? I'd like to know how you approached a similar problem. Thanks! </p>
","<java><refactoring><legacy-code>","0","57","2012-02-19 02:50:44"
"9350014","Code optimization: bandwidth monitor in c# issues","<p>my question is mainly about code optimization(at the moment)
I have created a network monitor that monitors different connections on the PC, what i had done is I'm sniffing packets at the 3rd level of the stack(the network level), after capturing the packet, i am supposed to create an object on the UI for each connection, what i am doing at the moment is looking at the overall consumed bandwidth and total data sent every second the program is run. here is that part of the code:</p>

<pre><code>    temp= packet_rtxt.TextLength;
        tempdr = temp / 1024;
        dr_txt.Text=tempdr.ToString();
        totaldata = totaldata + temp;
        totaldatadisp = totaldata;
        packet_rtxt.Text = """";
        //unit
        if (totaldata &lt; 10485760)
        {
            if (totaldata &lt; 10240)
                unit.Text = ""bytes"";
            else
            {
                totaldatadisp = totaldatadisp / 1024;
                unit.Text = ""KBs"";
            }
        }
        else
        {
            totaldata = totaldatadisp / 1048576;
            unit.Text = ""MBs"";
        }
        test.Text = totaldatadisp.ToString();
        tds.Enabled = true;
    }
</code></pre>

<p>so what im doing so far is writing out the captured packets into a rich text box, taking the length of that rtxt and adding it to a counter for the total data, taking the length and using it as the data rate, then clearing the rtxt for the next bits of data.
the total data recieved part is working fine, however the BPs section works fine for low amounts of data, then it goes crazy if the data rate is over 10kbps(on my pc)
should i try optimizing the whole code, or is there some other method(keep in mind i need to monitor every single connection), or do i need to use different UI controls?
should I focus on optimization or using new ways?</p>

<p>thanks in advance</p>
","<c#><refactoring><optimization><bandwidth-throttling>","0","123","2012-02-19 14:25:38"
"9350104","How to serialize a dictionary to an XML file?","<p>I'm trying to maintain a dictionary of configurations.</p>

<p>Here is my abstract class.</p>

<pre><code>[Serializable]
public abstract class Configuration
{
}
</code></pre>

<p>And here is a concrete class (for the moment, I just have only this class).</p>

<pre><code>[Serializable]
public class BinaryProblemConfiguration : Configuration
{
    [XmlAttribute]
    public decimal MinValue { get; set; }
    [XmlAttribute]
    public decimal MaxValue { get; set; }
}
</code></pre>

<p>I've got a class which contains a <code>Dictionary</code> of configuration levels.</p>

<ul>
<li>The first parameter is the name of the configuration. When <code>name=""""</code> means default configuration. </li>
<li>Level means the difficulty. There are three levels: Easy, Medium and Hard.</li>
<li>And the third one is the configuration.</li>
</ul>



<pre><code>/// &lt;summary&gt;
/// The abstract level configuration allows descendent classes to configure themselves
/// &lt;/summary&gt;
public abstract class LevelConfiguration
{
    private Dictionary&lt;string, Dictionary&lt;Levels, Configuration&gt;&gt; _configurableLevels = new Dictionary&lt;string, Dictionary&lt;Levels, Configuration&gt;&gt;();

    /// &lt;summary&gt;
    /// Adds a configurable level.
    /// &lt;/summary&gt;
    /// &lt;param name=""level""&gt;The level to add.&lt;/param&gt;
    /// &lt;param name=""problemConfiguration""&gt;The problem configuration.&lt;/param&gt;
    protected void AddConfigurableLevel(string name, Levels level, Configuration problemConfiguration)
    {
        if (!_configurableLevels.ContainsKey(name))
        {
            _configurableLevels.Add(name, new Dictionary&lt;Levels, Configuration&gt;());
        }

        _configurableLevels[name].Add(level, problemConfiguration);
    }

    /// &lt;summary&gt;
    /// Returns all the configurable levels.
    /// &lt;/summary&gt;
    /// &lt;param name=""level""&gt;&lt;/param&gt;
    protected void RemoveConfigurableLevel(string name, Levels level)
    {
        _configurableLevels[name].Remove(level);
    }

    /// &lt;summary&gt;
    /// Returns all the configurable names.
    /// &lt;/summary&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public IEnumerable&lt;string&gt; GetConfigurationNames()
    {
        return _configurableLevels.Keys;
    }

    /// &lt;summary&gt;
    /// Returns all the configurable levels.
    /// &lt;/summary&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public IEnumerable&lt;Levels&gt; GetConfigurationLevels(string name)
    {
        return _configurableLevels[name].Keys;
    }

    /// &lt;summary&gt;
    /// Gets the problem configuration for the specified level
    /// &lt;/summary&gt;
    /// &lt;param name=""level""&gt;The level.&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public Configuration GetProblemConfiguration(string name, Levels level)
    {
        return _configurableLevels[name][level];
    }
}
</code></pre>

<p>This is the class which create some configurations. I'm creating three default configs and two customs.</p>

<pre><code>public class AdditionLevelConfiguration : LevelConfiguration
{
    public AdditionLevelConfiguration()
    {
        AddConfigurableLevel("""", Levels.Easy, GetEasyLevelConfiguration());
        AddConfigurableLevel("""", Levels.Medium, GetMediumLevelConfiguration());
        AddConfigurableLevel("""", Levels.Hard, GetHardLevelConfiguration());

        AddConfigurableLevel(""config2"", Levels.Easy, GetEasyLevelConfiguration());
        AddConfigurableLevel(""config2"", Levels.Medium, GetMediumLevelConfiguration());

        var configs = this.GetProblemConfiguration(""config2"", Levels.Medium);
        var configs2 = this.GetProblemConfiguration("""", Levels.Easy);
    }

    protected Configuration GetHardLevelConfiguration()
    {
        return new BinaryProblemConfiguration
        {
            MinValue = 100,
            MaxValue = 1000,
        };
    }

    protected Configuration GetMediumLevelConfiguration()
    {
        return new BinaryProblemConfiguration
        {
            MinValue = 10,
            MaxValue = 100,
        };
    }

    protected Configuration GetEasyLevelConfiguration()
    {
        return new BinaryProblemConfiguration
        {
            MinValue = 1,
            MaxValue = 10,
        };
    }
}
</code></pre>

<p>I plan to write these configurations in a XML file. I was thinking of serialize them, but it throws me an error. What should I do?</p>
","<c#><refactoring><design>","0","86","2012-02-18 20:50:19"
"9352471","Refactoring Dilemma: User Account Functionality in PHP","<p>I'm writing a user account system in PHP, with an emphasis on security, but I'm stuck on refactoring it into something cleaner and more usable.</p>

<p>The problem is trying to group the user account functionality together, but in separate classes. The way I'm doing it now is, there are a bunch of classes with public static methods that all take $username as the first parameter, and they use other static methods, passing the same $username as the first parameter as well. Obviously, OOP is a better way to go, especially since each method must strtolower the username in order to make DB queries, and must handle the case where the username provided doesn't exist at all.</p>

<p>The problem with putting everything in a ""User"" class is that it would be huge, and there would be a lot of completely unrelated code in the same file. For example, the Change Password code doesn't need to call methods related to validating the user's email or changing the user's (unrelated) settings.</p>

<p>I could have two classes: User and AuthenticatedUser, where AuthenticatedUser inherits User. User would implement all the functionality that is possible without the user being logged in, and AuthenticatedUser would be all the functionality that requires a login -- such as accessing the user's encrypted data. Maintenance code could use objects of User, and GUI code would get an AuthenticatedUser object after the user has logged in. But I don't want to cram all of the functionality into User.</p>

<p>Here's the list of some of operations that are related to a user account, just to show why they won't all fit in one class:</p>

<ul>
<li>Login</li>
<li>Lockout user if >=X attempts in past Y minutes (includes methods for determining whether a user is locked out, adding a tick to the attempt count, etc).</li>
<li>Bypass the lockout with an email loop</li>
<li>Change password</li>
<li>Administrator change password (force)</li>
<li>Password reset (email loop) (incl. methods for initiating the reset, validating the email token, etc)</li>
<li>Set/get user data stored in plaintext</li>
<li>Set/get encrypted user data</li>
<li>Set/get account settings (password reset is allowed?, lock out the account on password failures?, is bypassing lockout with email loop allowed?, etc) Ideally these settings should be set/got near the code whose behavior depends on them.</li>
<li>Get the user's username in the proper case (as they specified it when creating account)</li>
<li>Email validation</li>
<li>A lot of functionality only used by specific code. E.g. get user ""salt"" used for key derivation. </li>
<li>A bunch more...</li>
</ul>

<p>I was thinking I could do something like have a PasswordChanger class that inherits User, and implements the password changing functionality. So it would look like:</p>

<pre><code>$proper = $user-&gt;getProperName();
...
$passChanger = $user-&gt;getPasswordChanger();
$result = $passChanger-&gt;changePassword($oldPass, $newPass);
...
$userLockout = $user-&gt;getUserLockout();
$result = $userLockout-&gt;isUserLockedOut();
...
$userEV = $user-&gt;getEmailValidation();
$result = $userEV-&gt;tryValidateEmail($token);
...
</code></pre>

<p>That's the best solution I've come up with so far. It lets me split up related functionality into it's own file, and saves from having to pass around the username. But it seems really weird -- I've never seen code like that before. It forces the superclass to know about all of its subclasses, which is bad design. Any ideas?</p>

<p><strong>Edit:</strong> An alternative avoiding inheritance would be to have a PasswordChanger that <em>has a</em> a User. Like:</p>

<pre><code>$passChanger = new PasswordChanger($user);
$passChanger-&gt;changePassword($old, $new); // uses $user-&gt;getUsername() 
...
$emailValidator = new EmailValdiator($user);
$emailValidator-&gt;tryValidate($token);
</code></pre>

<p>""PasswordChanger <em>has a</em> User"" vs. ""PasswordChanger <em>is a</em> User."" The former actually makes sense, so I like this way a little better.</p>
","<php><oop><class><refactoring><account>","4","79","2012-02-19 19:30:49"
"9372898","How to batch fix Java package in Eclipse","<p>I have downloaded some Java source code from a book.
It contains many directories and many <code>.java</code> files in each of them.
How can I quickly fix the warning:</p>

<pre><code>the declared package does not match the expected package ""16.16-2""?
</code></pre>
","<java><eclipse><refactoring><packages>","0","73","2012-02-21 05:58:21"
"9374471","What can be a better way to modify this code[refactoring]","<p>Is there a better way to present this code?</p>

<pre><code>while (vIter.hasNext()) {
    Long actId = (Long) vIter.next();
    if (actId == -1) 
        vRetActIds.put(actId,""N"");
    else
        vRetActIds.put(actId,""N"");
}
</code></pre>

<p>Here I feel the <code>if else</code> can be made redundant. In the iterator list there is a value <code>-1</code> which if exists should be made <code>""N""</code>.</p>
","<java><refactoring>","2","58","2012-02-21 08:43:51"
"9387737","Refactoring to Partial Classes - Guidance","<p>I am dealing with a huge codebehind of a an ASP.NET user control. I am taking the approach of refactoring the huge class into a number of partial clasees separted by UI intent.</p>

<p>Is there guidance on: </p>

<ul>
<li><p>Number of partial classes I am must constrain myself to.   </p></li>
<li><p>Naming or names to be given toof the partial class files.</p></li>
</ul>
","<c#><asp.net><refactoring><naming-conventions><partial-classes>","1","60","2012-02-22 01:00:43"
"9387955","instanceof considered harmful?","<p>I am looking over some code that has heavy use of Java's <code>instanceof</code> operator.  I will fight the temptation to go into details, since this is a general question.  <code>instanceof</code> reminds me of of c++'s dynamic cast, and the advice I read about it, long ago, that if you think you need it, probably your model is off. Is this still the conventional wisdom?  Does it apply to Java's <code>instanceof</code>? </p>
","<java><oop><architecture><refactoring>","2","150","2012-02-22 01:32:58"
"9391392","Partitioning big base class for Spring/Wicket based unit tests into smaller","<p>Our unit tests extend something like ApplicationContextAwareBaseTest which during the past several years has bloated with lots and lots of mocks and an Spring ApplicationContext which is filled with these mocked DAOs and Services.</p>

<p>I understand that this has been a convenient way to do tests and not care about what exactly is always needed for the plumbing to get a new test running. But this also feels like a death march as most tests only use a small part of the provided stuff and tests are getting slower. I'd like to refactor this to something healthier.</p>

<p>How would you go about this?</p>

<p>Basically I'm thinking about stripping the base class to a lot smaller version and then new base classes that extend this that have more specific stuff for certain area of tests.</p>

<p>But is there some way to help this process. The code base is considerably large and I'm left wondering if there's a suitable dependency analyzer for this task or if some scripting would help me in finding suitable subsets.</p>

<p>I'm also thinking if the current baseclass could somehow make the mocking lazy. Like writing an aspect that fires when a mock is touched and only then initializes it. But this is problematic as the mocks get added to the ApplicationContext so the aspect would always be fired.</p>

<p>How would you go about partitioning a big test set with the above described scenario? I'm guessing this is somewhat typical problem with big codebases. </p>
","<spring><unit-testing><refactoring><mocking><dependency-analysis>","0","50","2012-02-22 08:28:28"
"9399007","jQuery Animate multiple selectors","<p>I'm not even sure how to phrase this question. The code below has the desired effect I want, but it's completely redundant and ugly, and I'm not sure how to make it a little more elegant. I've tried a while loop without success. Maybe a recursive function or is there a better way to do this?</p>

<pre><code>function next() {

$('#scroll_wrapper li:first-child').animate({
  'top' : -elemHeight-offSet
}, {duration: 1000, queue: false, complete: nextDone});


$('#scroll_wrapper li:nth-child(2)').animate({
  'top' : offSet
}, { duration: 1000, queue: false });

$('#scroll_wrapper li:nth-child(3)').animate({
  'top' : offSet2
}, { duration: 1000, queue: false });

function nextDone() {
  var d = $(this).detach();
  d.appendTo('#scroll_wrapper ul').css({'top' : elemHeight+100});
}


}
</code></pre>
","<jquery><refactoring><refactor-my-code>","0","43","2012-02-22 16:37:48"
"9401254","Code refactoring tools for C, usable on GNU/Linux? FOSS preferable","<p>Variations of this question have been asked, but not specific to GNU/Linux and C.  I use Komodo Edit as my usual Editor, but I'd actually prefer something that can be used from CLI.
I don't need C++ support; it's fine if the tool can only handle plain C.</p>

<p>I really appreciate any direction, as I was unable to find anything.
I hope I'm not forced to 'roll' something myself.</p>

<p>NOTE: Please refrain from mention <code>vim</code>; I know it exists and what its capabilities are.  I purposefully choose to avoid <code>vim</code>, which is why I use Komodo (or nano on the servers).</p>
","<c><linux><refactoring><gnu>","6","174","2012-02-22 19:01:53"
"9405719","Creating a generic base","<p>I'm trying to pull my genric functionalities to a base class, however the diverse data type is stopping me from doing this. Please see:</p>

<pre><code>public class OutWriter
{
    private readonly IEnumerable&lt;long&gt; series1;
        private readonly IEnumerable&lt;long&gt; series2
        private readonly IEnumerable&lt;long&gt; series3
        private readonly IEnumerable&lt;double&gt; series4
        private readonly double sum;

public OutWriter()
{
  series1 = PopulateS1()
  series2 = PopulateS2()
  series3 = PopulateS3()
  series4 = PopulateS4()

sum = series4.Aggregate((x,y)=&gt;x+y);
}
}

public class PaperWriter
{
    private readonly IEnumerable&lt;BigInteger&gt; series1;
        private readonly IEnumerable&lt;BigInteger&gt; series2
        private readonly IEnumerable&lt;BigInteger&gt; series3
        private readonly IEnumerable&lt;BigInteger&gt; series4
        private readonly BigInteger sum;

public PaperWriter()
{
  series1 = PopulateS1()
  series2 = PopulateS2()
  series3 = PopulateS3()
  series4 = PopulateS4()

sum = series4.Aggregate((x,y)=&gt;x+y);
}
}

public class Base&lt;T&gt;()
{
    ????
}
</code></pre>

<p>I'm trying to pull up the similarities, however there is <code>long</code>, <code>double</code> and <code>BigInteger</code> involved.  Also the aggregate throws out a compile time error due to the + operation. Can you please tell me how to do it appropriately?</p>

<p>Thanks,
-Mike</p>
","<c#><c#-4.0><refactoring>","2","77","2012-02-23 01:08:37"
"9406871","jQuery refactored function","<p>I like to keep my code as DRY as possible and would like to know if the following is possible.
I'll need to reuse the code below many times with the only difference being what I do in the following function.</p>

<pre><code>.on(""click"", ""a"", function(e) {})
</code></pre>

<p>I could just duplicate the addToBooking function, give it a different name, make the slight change in the click handler but that feels wasteful and repetitive.</p>

<p>Can I perhaps pass a code block to the addToBooking function?
Or maybe there's another cool, efficient way I'm not aware of.</p>

<p>The full code block</p>

<pre><code>var addToBooking = function(that, event) {
  var left, top;

  event.stopPropagation(); 

  //Turn off all calendar tracking
  $("".track"").off(); 

  //Get proper sticky positioning (Checks to make sure it wont display off screen)
  left = getPosition("".add_to_booking"", ""left"");
  top = getPosition("".add_to_booking"", ""top"");

  //Position sticky, display and listen for click event to see what to do next
  $("".add_to_booking"").css({top: top, left: left})
                      .fadeIn('fast')
                      .on(""click"", function(e) { e.stopPropagation(); })
                      .on(""click"", ""a"", function(e) {
                        if($(this).text() === ""YES"") {
                          //Close dialog
                          closeTT();

                          //Open new add to booking box
                          addBooking(that, event);

                        } else {
                          closeTT();
                        }
                      });
}
</code></pre>
","<javascript><jquery><refactoring><dry>","0","40","2012-02-23 03:46:20"
"9410262","Programming languages with refactoring tools","<p>What programming languages you know that have such good refactoring tools as Java? It has nice refactoring support from Netbeans and Eclipse or IntellJ. Any more languages? Is there such tools available for C++ or maybe PHp?</p>
","<java><c++><refactoring>","-3","85","2012-02-23 09:31:23"
"9417075","Oracle - Refactor subquery with max()","<p>I have the query below.  SOFTWARE_DEVELOPMENT_CYCLE has multiple rows, but I'm interested in the latest.</p>

<p>I would like to rewrite the query so that I don't use a subquery.  I have attempted it with DENSE_RANK LAST ORDERY BY, but to no avail.</p>

<p>Could somebody advise?  Thank you.</p>

<pre><code>SELECT SOF.VENDOR, 
       SOF.NAME, 
       LAN.LANGUAGE, 
       SOF.VERSION, 
       SDC.STATUS, 
       SDC.SOF_DC_ID
  FROM SOFTWARE SOF
  JOIN SOFTWARE_LANGUAGES SL 
    ON (SL.SOF_SOF_ID = SOF.SOF_ID)
  JOIN LANGUAGES LAN 
    ON (SL.LAN_LAN_ID = LAN.LAN_ID)
  JOIN SOFTWARE_DEVELOPMENT_CYCLE SDC 
    ON (SDC.SOF_LAN_SOF_LAN_ID = SL.SOF_LAN_ID)
 WHERE SDC.SOF_DC_ID IN (SELECT MAX(SDC2.SOF_DC_ID)
                           FROM SOFTWARE_DEVELOPMENT_CYCLE SDC2
                          WHERE SDC2.SOF_LAN_SOF_LAN_ID = SL.SOF_LAN_ID)
 ORDER BY SOF.VENDOR, 
          SOF.NAME, 
          LAN.LANGUAGE, 
          SOF.VERSION;
</code></pre>
","<sql><oracle><refactoring><subquery><analytic-functions>","0","91","2012-02-23 16:30:00"
"9424189","Python Refactoring Tools For Renaming/Moving","<p>I am looking for a python tool that will allow me to specifically rename and move modules.</p>

<p>When I program, I do a LOT of reorganizing things, moving items from package to package, adding new packages, and renaming files. I come from Java, where this is unreasonably easy to do in an IDE.</p>

<p>Right now I'm using aptana, and its refactoring support is decent for renaming a class method or variable, but when it comes to moving a module from one package to another, I see no way around trying a find/replace on your own.</p>

<p>Does anybody know of a reasonable tool to move/rename modules. I've heard of rope, but have not fully investigated yet.</p>
","<python><refactoring>","2","115","2012-02-24 01:40:23"
"9433298","When refactoring classes and methods why JDT doesn't change referenced resources?","<p>When refactoring classes and methods JDT doesn't change referenced resources, while it does when refactoring packages. I use the following code:</p>

<pre><code>RefactoringContribution contrib = RefactoringCore.getRefactoringContribution(IJavaRefactorings.RENAME_COMPILATION_UNIT);
RenameJavaElementDescriptor desc =  (RenameJavaElementDescriptor)contrib.createDescriptor();
desc.setUpdateReferences(true);
desc.setJavaElement(classToRename);
desc.setNewName(newName);
Refactoring ref = desc.createRefactoring(new RefactoringStatus());
IProgressMonitor monitor = new NullProgressMonitor();
Change change = refactoring.createChange(monitor);
change.perform(monitor); 
</code></pre>

<p>an advice will help:</p>
","<java><eclipse><refactoring><jdt>","0","57","2012-02-24 15:27:44"
"9440066","How to add extra attribute in model to move calculation out of view?","<p>For the following RubyOnRails code, is there a way to move the ""profit"" calculation out of the View and into the Model.. so there's maybe an attribute called <strong>total_income</strong> and <strong>total_expense</strong>?</p>

<p><strong>Model - transaction.rb</strong></p>

<pre><code>class Transaction &lt; ActiveRecord::Base
  attr_accessible :name, :amount, :category
  scope :incomes,  :conditions =&gt; { :category =&gt; 'Income'  }
  scope :expenses, :conditions =&gt; { :category =&gt; 'Expense' }
end
</code></pre>

<p><strong>Controller - transactions_controller.rb</strong></p>

<pre><code>class TransactionsController &lt; ApplicationController

  def index
    @incomes  = Transaction.incomes
    @expenses = Transaction.expenses
    @transaction = Transaction.new
  end
</code></pre>

<p><strong>View - index.html.erb</strong></p>

<pre><code>&lt;pre&gt;
&lt;strong&gt;Income&lt;/strong&gt;
  &lt;% @incomes.each do |income| %&gt;
  &lt;%= income.name %&gt;  -  &lt;%= number_to_currency((income.amount.nil? ? 0 : income.amount)) %&gt;
  &lt;% end %&gt;
  &lt;strong&gt;Subtotal:&lt;/strong&gt; &lt;%= number_to_currency(@income_total = @incomes.sum(:amount)) %&gt;

&lt;strong&gt;Expenses&lt;/strong&gt;
  &lt;% @expenses.each do |expense| %&gt;
  &lt;%= expense.name %&gt;  -  &lt;%= number_to_currency((expense.amount.nil? ? 0 : expense.amount)) %&gt;
  &lt;% end %&gt;
  &lt;strong&gt;Subtotal:&lt;/strong&gt; &lt;%= number_to_currency(@expenses_total = @expenses.sum(:amount)) %&gt;

&lt;strong&gt;Profit: &lt;%= number_to_currency(@income_total - @expenses_total) %&gt;&lt;/strong&gt;
&lt;/pre&gt;
</code></pre>
","<ruby-on-rails><mvc><refactoring>","0","69","2012-02-25 00:40:32"
"9444518","Eclipse refactoring like ""change method signature"" for generic parameter lists?","<p>Is there an Eclipse refactoring equivalent to the ""change method signature"" refactoring that would allow you to modify the ""signature"" of a class, enum, or interfaces's generic parameters?  </p>

<p>For instance, if I wanted to remove, reorder, or introduce additional generic parameters to a type, it would change the references to the type accordingly and add default values, etc.</p>
","<java><eclipse><generics><types><refactoring>","3","118","2012-02-25 13:45:18"
"9445912","Tools to suggest improved OO and design pattern approaches?","<p>I'm working on a PHP OO application and I am wondering whether the inheritance I've implemented is optimal (specifically, I'm wondering if I've enough of it). It occurs to me that there may be lexical tools available that scan a codebase and create a network analysis of what-method-calls-what, and suggest potential refactorings based on tried-and-tested design patterns.</p>

<p>That said, I wonder if I am asking too much of software here - just because code might be simplified by having one class inherit from another doesn't mean it is conceptually appropriate, of course.</p>

<p>Side note, for interest: I see from SO that there <em>are</em> tools to <a href=""http://stackoverflow.com/questions/2053319/what-tools-are-there-for-suggesting-potential-refactorings"">detect copy and paste code</a>.</p>
","<oop><tools><refactoring>","0","38","2012-02-25 16:46:12"
"9469828","How to define further commonparameters for powershell functions defined within a bespoke module?","<p>I'm writing a powershell module to interact with AWS.  Most of the functions need to take parameters that are the credentials to use - <code>awsAccessKeyId</code>, <code>awsSecretKey</code> and <code>credentialsFile</code>.</p>

<p>It's getting dull copy/pasting those parameters to each function in the module.  </p>

<p><strong>Is there a way to declare that these are <code>CommonParameters</code> for the set of functions that the module exports?</strong></p>

<p><strong>Also, is there a way to extract the common (ie, duplicated) parameter-set handling switch-statement so it can be called by all the functions that need it?</strong></p>

<p>Here's an example function:</p>

<pre><code>function New-S3Client {
    [CmdletBinding(DefaultParametersetName=""credentialsFile"")]
    param
    (
        [parameter(Mandatory=$true, ParameterSetName=""specifyKey"")] [string]$accessKey,
        [parameter(Mandatory=$true, ParameterSetName=""specifyKey"")] [string]$secretKey,
        [parameter(ParameterSetName=""credentialsFile"")] [string]$credentialsFile = ""$env:USERPROFILE\.aws\credentials""
    )
    switch($PsCmdlet.ParameterSetName)
    {
        ""specifyKey"" {
            $env:awsAccessKeyId = $accessKey
            $env:awsSecretKey = $secretKey
            break
        }
        ""credentialsFile"" {
            $env:awsAccessKeyId = Read-ValueForKeyFromFile -from $credentialsFile -field AWSAccessKeyId
            $env:awsSecretKey = Read-ValueForKeyFromFile -from $credentialsFile -field AWSSecretKey
            break
        }
    }
    $config = New-Object Amazon.S3.AmazonS3Config
    $config.WithServiceURL(""https://s3.eu-west-1.amazonaws.com"")
    $client = New-Object Amazon.S3.AmazonS3Client($env:awsAccessKeyId, $env:awsSecretKey, $config)
    return $client
}
</code></pre>

<p>I would like to extract parameters 2-4 inclusive to <code>CommonParameters</code>, and then the switch block to some common function.</p>
","<powershell><refactoring><powershell-v2.0><powershell-module>","0","108","2012-02-27 18:00:40"
"9484849","Replace Conditional with Polymorphism - How to handle when your type changes?","<p>For a personal project, I'm working on a small web-based game. </p>

<p>I have a <code>Card</code> class that has a <code>Status</code> property, and there are case statements all over the place. I thought, hey, this is a great oppurtunity for <a href=""http://martinfowler.com/refactoring/catalog/replaceConditionalWithPolymorphism.html"" rel=""nofollow"">Replace Conditional with Polymorphism</a>!</p>

<p>The problem is, I have a couple methods that do stuff like this:</p>

<pre><code>public class Card
{
    public void ChangeStatus()
    {
      switch (Status)
      {
        case MyStatusEnum.Normal:
          Status = MyStatusEnum.Underwater;
          break;
        case MyStatusEnum.Underwater:
          Status = MyStatusEnum.Dead;
          break;
        // etc...
      }
    }
}
</code></pre>

<p>When refactoring it in the new <code>NormalCard</code> class, I'm overriding the <code>ChangeStatus</code> method like this:</p>

<pre><code>public override void ChangeStatus()
{
    base.Status = MyStatusEnum.Underwater;
}
</code></pre>

<p>The problem is this object of <code>NormalCard</code> has a status of <code>Underwater</code>.  I can't reassign the type of <code>this</code>, and I don't really want to change the return of the methods from <code>void</code> to <code>CardBase</code>.  What options do I have?  Is there a standard way of doing this?</p>

<p><strong>Edit</strong> Tormod set me straight.  I want the <a href=""http://en.wikibooks.org/wiki/Computer_Science_Design_Patterns/State"" rel=""nofollow"">State Pattern</a>. Thanks all!</p>
","<c#><refactoring><polymorphism>","2","131","2012-02-28 15:34:54"
"9485536","Unit testing: private methods and how to refactor","<p>I like unit testing, it is proving its worth immensely for the last year and a half or so ive used it. However I always have a problem or rather a niggle with private methods (and protected).</p>

<p>I don't want to make them public or use internals visible to attribute. I want a clean and crisp solution - that is testable and i'd be proud to let someone else look at.</p>

<p>I am coming to the conclusion that if a private method <em>really</em> needs testing independantly then maybe it should be moved out onto another interface and use association to expose the functionality to the calling method. I believe this in essence to be the Facade pattern.</p>

<p>Is this really the best way to go about this?
Or more objectively ... are there any other approaches I have totally overlooked?</p>

<p>Edit: Are we talking about a specific language?
I am working in C#. I had kept code out of the question as i was looking for something abstract. Coming back to it today i realise that is perhaps folly due to languages really being that different.</p>

<p>So some code:</p>

<pre><code>public class CopmlexClass
{
    public void SomeMethod()
    { }

    private void workerMethod()
    { }
}
</code></pre>

<p>would get re factored into</p>

<pre><code>public class CopmlexClass
{
    public void SomeMethod()
    { }

    public IComplexClassWorker Worker { get; set; }

}

public interface IComplexClassWorker
{
    void WorkerMethod();        
}
</code></pre>

<p>In fact id probably prefer to use constructor injection and not even expose the property</p>

<p>My question is: is that the best way? what are the alternatives bar reflection / internals visible to attribute?</p>
","<unit-testing><design-patterns><refactoring>","1","93","2012-02-28 16:12:48"
"9489685","Extract just the required functions from  a C code project?","<p>How can I extract just the required functions from a pile of C source files? Is there a tool which can be used on GNU/Linux?  </p>

<p>Preferably FOSS, but the GNU/Linux is a hard requirement.  </p>

<p>Basically I got about 10 <code>.h</code> files; I'd like to grab part of the code and get the required variables from the header files. Then I can make a single small <code>.h</code> file corresponding to the code I'm using in another project. </p>

<p>My terms might not be 100% correct. </p>
","<c><linux><refactoring>","1","145","2012-02-28 21:04:45"
"9491516","refactor calls to a bunch of constructors that all take the same args","<p>How would I refactor this:</p>

<pre><code>if (cond1) {
    return new Class1(arg1, arg2, arg3);
}
else if (cond2) {
    return new Class2(arg1, arg2, arg3);
}
else if (cond3) {
    return new Class3(arg1, arg2, arg3);
}
...
</code></pre>

<p>I'm particularly interested in avoiding repeating <code>arg1, arg2, arg3</code></p>
","<c#><constructor><refactoring>","1","45","2012-02-28 23:38:23"
"9493938","I want to do refactoring on my bad smell code using polymorphism. it's a removing 'if' statements issue","<p>I'm an iOS app developer.
I got stuck on some refactoring issue while removing bad smells on my code.
it's like this.</p>

<p>My project uses a XML data,</p>

<pre><code>&lt;resource&gt;
   &lt;item type='textbox' ... /&gt;
   &lt;item type='checkbox' ... /&gt;
   &lt;item type='selectbox' ... /&gt;
&lt;/resource&gt;
</code></pre>

<p>and I use it by this code.</p>

<pre><code>Item *item = nil;
for (Element *itemElement in resourceChilds)
{
   ...
   if ([[itemElement valueForAttributeNamed:@""type""] isEqualToString:@""textbox""])
   {
      item = [[Textbox alloc] initWithProperty:itemAttributes];
      ...
   }
   else if ([[itemElement valueForAttributeNamed:@""type""] isEqualToString:@""checkbox""])
   {
      item = [[Checkbox alloc] initWithProperty:itemAttributes];
      ...
   }
   else if ([[itemElement valueForAttributeNamed:@""type""] isEqualToString:@""selectbox""])
   {
      item = [[Selectbox alloc] initWithProperty:itemAttributes];
      ...
   }
   ...
}
</code></pre>

<p>'Item' class is the super class of 'Textbox', 'Checkbox' and 'Selectbox' classes.</p>

<p>And 'itemAttributes' object is an instance of NSDictionary. </p>

<p>As you can see above through 'initWithProperty:itemAttributes' I already gave the 'type' attribute value into an 'Item' instance. I think it's possible to use this information in the 'Item' instance to specialize it to Textbox or Checkbox or Selectbox.</p>

<p>Is there any way to remove these 'if' statements and refactoring this?
Any suggestion are welcome.
And I really appreciate it sharing your time for this.</p>

<p>Thanks,</p>

<p>MK</p>
","<iphone><objective-c><ios><refactoring><polymorphism>","0","123","2012-02-29 05:17:33"
"9496943","Tomcat hangs during webapp startup","<p><strong>My <em>web project</em> was working perfectly, it includes: <em>spring3</em> and <em>hibernate3</em>. After renaming some packages in <em>eclipse</em> by the help of <em>eclipse refactoring</em>, <em>tomcat</em> could't start anymore. It hangs on these logs below:</strong></p>

<pre><code>......
......
......

2012-02-29 08:57:04,552 INFO [org.springframework.orm.hibernate3.LocalSessionFactoryBean] [buildSessionFactory] - &lt;Building new Hibernate SessionFactory&gt;
2012-02-29 08:57:04,567 INFO [org.hibernate.connection.ConnectionProviderFactory] [newConnectionProvider] - &lt;Initializing connection provider: org.springframework.orm.hibernate3.LocalDataSourceConnectionProvider&gt;
2012-02-29 08:57:10,698 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;RDBMS: MySQL, version: 5.0.77&gt;
2012-02-29 08:57:10,698 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JDBC driver: MySQL-AB JDBC Driver, version: mysql-connector-java-5.1.15 ( Revision: ${bzr.revision-id} )&gt;
2012-02-29 08:57:10,729 INFO [org.hibernate.dialect.Dialect] [&lt;init&gt;] - &lt;Using dialect: org.hibernate.dialect.MySQLDialect&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.transaction.TransactionFactoryFactory] [buildTransactionFactory] - &lt;Transaction strategy: org.springframework.orm.hibernate3.SpringTransactionFactory&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.transaction.TransactionManagerLookupFactory] [getTransactionManagerLookup] - &lt;No TransactionManagerLookup configured (in JTA environment, use of read-write or transactional second-level cache is not recommended)&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Automatic flush during beforeCompletion(): disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Automatic session close at end of transaction: disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JDBC batch size: 15&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JDBC batch updates for versioned data: disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Scrollable result sets: enabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JDBC3 getGeneratedKeys(): enabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Connection release mode: auto&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Maximum outer join fetch depth: 2&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Default batch fetch size: 1&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Generate SQL with comments: disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Order SQL updates by primary key: disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Order SQL inserts for batching: disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [createQueryTranslatorFactory] - &lt;Query translator: org.hibernate.hql.ast.ASTQueryTranslatorFactory&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.hql.ast.ASTQueryTranslatorFactory] [&lt;init&gt;] - &lt;Using ASTQueryTranslatorFactory&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Query language substitutions: {}&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JPA-QL strict compliance: disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Second-level cache: enabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Query cache: disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [createRegionFactory] - &lt;Cache region factory : org.hibernate.cache.impl.NoCachingRegionFactory&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Optimize cache for minimal puts: disabled&gt;
2012-02-29 08:57:10,745 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Structured second-level cache entries: disabled&gt;
2012-02-29 08:57:10,761 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Statistics: disabled&gt;
2012-02-29 08:57:10,761 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Deleted entity synthetic identifier rollback: disabled&gt;
2012-02-29 08:57:10,761 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Default entity-mode: pojo&gt;
2012-02-29 08:57:10,761 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Named query checking : enabled&gt;
2012-02-29 08:57:10,792 INFO [org.hibernate.impl.SessionFactoryImpl] [&lt;init&gt;] - &lt;building session factory&gt;
2012-02-29 08:57:11,244 INFO [org.hibernate.impl.SessionFactoryObjectFactory] [addInstance] - &lt;Not binding factory to JNDI, no JNDI name configured&gt;
2012-02-29 08:57:11,307 INFO [org.springframework.orm.hibernate3.HibernateTransactionManager] [afterPropertiesSet] - &lt;Using DataSource [org.apache.commons.dbcp.BasicDataSource@1aac07d] of Hibernate SessionFactory for HibernateTransactionManager&gt;
</code></pre>

<p><strong>It hangs here, and when <em>tomcat's</em> ""start timeout"" reaches <em>tomcat</em> stops. I increased the timeout to 100 seconds, but it was useless, where the <em>app</em> still hanged on the longest times!
The strangest thing is that there is no error whatsoever, it just hangs. I tried a lot of times cleaning/deleting the server and cleaning/building the project, but with no result.</strong></p>

<p><strong>EDIT:</strong></p>

<p><em>Before refactoring the log continued like this below:</em></p>

<pre><code>2012-02-29 07:52:39,822 INFO [org.springframework.ws.soap.saaj.SaajSoapMessageFactory] [afterPropertiesSet] - &lt;Creating SAAJ 1.3 MessageFactory with SOAP 1.1 Protocol&gt;
2012-02-29 07:52:39,853 INFO [org.springframework.oxm.jaxb.Jaxb2Marshaller] [createJaxbContextFromContextPath] - &lt;Creating JAXBContext with context path [aheeva.webService.oxm]&gt;
2012-02-29 07:52:40,571 INFO [org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping] [registerHandler] - &lt;Mapped URL path [
.......
.......
.......
</code></pre>

<p><strong>EDIT:</strong></p>

<p><em>I got a thread dump with the following output:</em></p>

<pre><code>""main"" prio=5 tid=0x001f9dc8 nid=0xf8c runnable [0x000bf000..0x000cfc00]
        at java.lang.String.equals(String.java:858)
        at java.util.HashMap.eq(HashMap.java:277)
        at java.util.HashMap.getEntry(HashMap.java:363)
        at java.util.LinkedHashMap.get(LinkedHashMap.java:273)
        at org.springframework.beans.CachedIntrospectionResults.getPropertyDescr
iptor(CachedIntrospectionResults.java:275)
        at org.springframework.beans.BeanWrapperImpl.getPropertyDescriptorIntern
al(BeanWrapperImpl.java:335)
        at org.springframework.beans.BeanWrapperImpl.isWritableProperty(BeanWrap
perImpl.java:407)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1327)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.populateBean(AbstractAutowireCapableBeanFactory.java:1086)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.doCreateBean(AbstractAutowireCapableBeanFactory.java:517)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.createBean(AbstractAutowireCapableBeanFactory.java:456)
        at org.springframework.beans.factory.support.AbstractBeanFactory$1.getOb
ject(AbstractBeanFactory.java:291)
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistr
y.getSingleton(DefaultSingletonBeanRegistry.java:222)
        - locked &lt;0x24682be0&gt; (a java.util.concurrent.ConcurrentHashMap)
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBe
an(AbstractBeanFactory.java:288)
        at org.springframework.beans.factory.support.AbstractBeanFactory.getType
ForFactoryBean(AbstractBeanFactory.java:1343)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.getTypeForFactoryBean(AbstractAutowireCapableBeanFactory.java:678)
        at org.springframework.beans.factory.support.AbstractBeanFactory.isTypeM
atch(AbstractBeanFactory.java:507)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.
getBeanNamesForType(DefaultListableBeanFactory.java:317)
        at org.springframework.beans.factory.BeanFactoryUtils.beanNamesForTypeIn
cludingAncestors(BeanFactoryUtils.java:185)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.
findAutowireCandidates(DefaultListableBeanFactory.java:829)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.
doResolveDependency(DefaultListableBeanFactory.java:786)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.
resolveDependency(DefaultListableBeanFactory.java:703)
        at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanP
ostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.j
ava:474)
.......
.......
.......
</code></pre>

<p><em>I can conclude the following:</em></p>

<p>It's always the same <em>spring</em> hashmap in a <em>singleton</em> mode trying to fetch a bean and isn't able to find it for that reason the thread is <em>locked</em> ...very very strange! mustn't there be a <em>throw</em> for an <em>exception</em> or a timeout? weird <em>Spring</em> architecture! </p>
","<java><spring><hibernate><soap><refactoring>","2","389","2012-02-29 09:56:43"
"9500375","How can I add an interface with delegate implementations to a class?","<p>What is the fastest way in Eclipse to implement a new interface and generate delegate implementations to an existing class?</p>

<p>For instance given an existing class <code>Foo</code>, suppose I want it to implement <code>Iterator&lt;Integer&gt;</code> using a delegate <code>Iterator&lt;Integer&gt;</code>.</p>
","<java><eclipse><interface><delegates><refactoring>","0","55","2012-02-29 13:52:29"
"9513863","How do I find a set of certain classes and rename them?","<p>In my program I have a part which is called Sales Orders, it has GUIs, DAOs, property files and more and more.</p>

<p>I somehow want to find out all these classes and create new same functionality classes from them with a different name. </p>

<p>Actually it is like renaming all of them. I am using <code>IDEA IntelliJ</code>, but I can use some other IDEs also.</p>

<p>What is the fastest way to do this?</p>
","<java><refactoring><intellij-idea><rename>","0","54","2012-03-01 09:45:23"
"9515979","Refactoring/Restructuring tool for Java","<p>I have a large monolithic webapplication that I whish to break apart into smaller modules. As a first step I'd like to change the package hierarchy which currently looks like:</p>

<pre><code> - com.companyname.project
  - dao
     - bean
         - booking // possibly containing more sub packages
         - core   
         ... etc etc (there are a bunch of others as well)
     - service
         - booking // possibly containing more sub packages
         - core   
         ... etc etc  
  - logic
     - bean
         - booking // possibly containing more sub packages
         - core   
         ... etc etc
     - service
         - booking
         - core   
         ... etc etc
  - web
     - bean  // same substructure as above...
     - service  // same substructure as above...
     - taglib  // same substructure as above...
     - util
</code></pre>

<p>I would like it if the package structure used for instance <code>booking</code> as the package name below <code>com.companyname.project</code></p>

<p>Now I am wondering if there is a tool that could for instance use a simple regex to do the restructuring for me.  </p>

<p>E.g.<br>
<code>com.companyname.project.dao.bean.booking</code><br>
would become:<br>
<code>com.companyname.project.booking.dao.bean</code></p>

<p>and</p>

<p><code>com.companyname.project.dao.service.booking</code><br>
would become:<br>
<code>com.companyname.project.booking.dao.service</code></p>

<p>I could use Eclipse and drag and drop the packages, but I am looking for something that could do this with a minimal of my involvment, since it will be very repetetive. </p>
","<java><refactoring><automated-refactoring>","4","123","2012-03-01 12:10:24"
"9518728","Convert #defines to const variables","<p>There are quite a number files C++ header files with <code>#define</code> values, such as:</p>

<pre><code>#define INT_DEFINE 0
#define FLOAT_DEFINE ((float) 10.0f)
#define OTHER_INT_DEFINE (20)
#define STRING_DEFINE ""string value""
</code></pre>

<p>contained in them. I'd like these converted into <code>const</code> variable. I'm looking for a way to automate (at least the bulk of) this task. Searching SO and the internet has not turned up anything relevant (one promising Google result was <a href=""http://bytes.com/topic/c/answers/811544-converting-define-value-variable"" rel=""nofollow"">this</a> which seems relevant, but is not). I've also taken a look at <a href=""http://www.klocwork.com/products/insight/refactoring/index.php"" rel=""nofollow"">Klocwork</a> and <a href=""http://www.wholetomato.com/products/featureRefactoring.asp"" rel=""nofollow"">Visual Assist</a>, both don't seem to have the functionality that I'm looking for. Is there an existing tool/script that does what I want? </p>

<p>In case there are no ready available tools/scripts to tackle this, I plan to proceed using one of two approaches:</p>

<ol>
<li>Using regular expressions like: <code>\#define(:b)*{:i}(:b)*{:z}$</code> and replacing the matches with <code>const int \1 = \2;</code> to tackle this. (this the is regex that I plan to use for <code>INT_DEFINE</code> and similar kind of items and is written in Visual Studio's regex <a href=""http://msdn.microsoft.com/en-us/library/2k3te2cs%28v=vs.80%29.aspx"" rel=""nofollow"">syntax</a>)</li>
<li>Write <code>vim</code> macros/functions to get this done.</li>
</ol>

<p>Which among the two would be better/faster? Would be glad to receive some advice in this regard based on past experiences. Personally, I'd lean towards regular expressions as I'm more familiar with them and can get it done within Visual Studio. </p>

<p>I understand that someone would still have to go over the results of the tool/script to ensure that the ""conversion"" has happened correctly and there are no errors due to things like wrong cast and wrongly generated datatypes for the variables, but this would still help cut down a lot of effort and manual work.</p>
","<c++><visual-c++><refactoring><automated-refactoring>","0","102","2012-03-01 15:16:06"
"9520383","Can Eclipse automatically analyze the ""add only clause to use statement""?","<p>I'm trying to sort out the flows of variables using an application Eclipse.</p>

<p>Since there are so many use statements in programs, it will be great if the Eclipse can automatically analyze the ""add only clause to use statement.""</p>

<p>Right now, I just manually double click the module name and then go to Refactor --> Use Statement --> Add Only Clause To Use Statement. I have to repeat these procedure one use statement by one statement. I have so many of these statement to go through.</p>

<p>If you have solutions for this, please let me know.</p>

<p>Thanks,
Michael </p>
","<eclipse><refactoring><statement><use>","0","22","2012-03-01 16:47:22"
"9525067","Add entire project to namespace in XE2","<p>We have a <strong>C++ Builder</strong> application that has lived through many versions of <strong>Embarcadero RAD Studio</strong>. Now I was trying to get it to compile in <strong>XE2</strong> and ran into a problem where a class called <strong>TGroup</strong> became ambiguos with the <strong>TGroup</strong> class of <strong>Winsock</strong>.</p>

<p>To my anger I found that the initial architects of the system didn't use any namespaces, which would have solved this problem. I decided to add all the project code to a single namespace to start with. But pretty soon it dawned on me that I would have to go through about <strong>1400 .h and .cpp files</strong>.</p>

<p>Please, <strong><em>for the love of god</em></strong>... Is there a good tool out there to quickly encapsulate an entire project within a namespace?</p>

<p>Most of the files differ a bit in layout. Some have defines after the includes and some do not etc. But to just insert the namespace declaration after the includes should probably work ok to start with and then close it just before the last <strong>#endif</strong>, which is the inclusion guard <strong>#define</strong>.</p>
","<namespaces><refactoring><automated-refactoring><c++builder-xe2>","0","38","2012-03-01 22:17:55"
"9544735","Showing sql server data to 16 textblock","<p>Hello and good day to all. I have an issue on coding, i have long line of codes just to show 16 items from sql server to 16 textblocks, there is no error but i want to maintain the short line of codes. Here is 2 textblocks(out of 16) example codes: </p>

<pre><code>            orgDa.SelectCommand = conn.CreateCommand();
            orgDa.SelectCommand.CommandText = ""select OrganizationName from Organizationtbl where OrgID=1"";
            orgDa.SelectCommand.CommandType = CommandType.Text;
            orgDa.Fill(ds, ""Organizationtbl"");

            deptDa.SelectCommand = conn.CreateCommand();
            deptDa.SelectCommand.CommandText = ""select DepartmentName from Departmenttbl where DeptID=1"";
            deptDa.SelectCommand.CommandType = CommandType.Text;
            deptDa.Fill(ds, ""Departmenttbl"");

            if (ds.Tables[""Organizationtbl""].Rows.Count == 1)
            {
                foreach (DataRow orgItem in ds.Tables[""Organizationtbl""].Rows)
                {
                    if (orgItem.IsNull(""OrganizationName""))
                    {
                        foreach (DataRow deptItem in ds.Tables[""Departmenttbl""].Rows)
                        {
                            textblock_EventTitle0.Text = deptItem[""DepartmentName""].ToString();
                        }
                    }
                    else
                    {
                        textblock_EventTitle0.Text = orgItem[""OrganizationName""].ToString();
                    }
                }
            }
            else
            {
                foreach (DataRow deptItem in ds.Tables[""Departmenttbl""].Rows)
                {
                    if (deptItem.IsNull(""DepartmentName""))
                    {
                        foreach (DataRow orgItem in ds.Tables[""Organizationtbl""].Rows)
                        {
                            textblock_EventTitle0.Text = orgItem[""OrganizationName""].ToString();
                        }
                    }
                    else
                    {
                        textblock_EventTitle0.Text = deptItem[""DepartmentName""].ToString();
                    }
                }
            }

            orgDa.SelectCommand = conn.CreateCommand();
            orgDa.SelectCommand.CommandText = ""select OrganizationName from Organizationtbl where OrgID=2"";
            orgDa.SelectCommand.CommandType = CommandType.Text;
            orgDa.Fill(ds, ""Organizationtbl"");

            deptDa.SelectCommand = conn.CreateCommand();
            deptDa.SelectCommand.CommandText = ""select DepartmentName from Departmenttbl where DeptID=2"";
            deptDa.SelectCommand.CommandType = CommandType.Text;
            deptDa.Fill(ds, ""Departmenttbl"");

            if (ds.Tables[""Organizationtbl""].Rows.Count == 1)
            {
                foreach (DataRow orgItem in ds.Tables[""Organizationtbl""].Rows)
                {
                    if (orgItem.IsNull(""OrganizationName""))
                    {
                        foreach (DataRow deptItem in ds.Tables[""Departmenttbl""].Rows)
                        {
                            textblock_EventTitle1.Text = deptItem[""DepartmentName""].ToString();
                        }
                    }
                    else
                    {
                        textblock_EventTitle1.Text = orgItem[""OrganizationName""].ToString();
                    }
                }
            }
            else
            {
                foreach (DataRow deptItem in ds.Tables[""Departmenttbl""].Rows)
                {
                    if (deptItem.IsNull(""DepartmentName""))
                    {
                        foreach (DataRow orgItem in ds.Tables[""Organizationtbl""].Rows)
                        {
                            textblock_EventTitle1.Text = orgItem[""OrganizationName""].ToString();
                        }
                    }
                    else
                    {
                        textblock_EventTitle1.Text = deptItem[""DepartmentName""].ToString();
                    }
                }
            }
</code></pre>

<p>How can i show 16 items from sql to 16 textblocks in just one loop? i need your help. Thank you in advance.</p>
","<c#><sql><refactoring>","0","43","2012-03-03 08:45:28"
"9559103","Programmatically push down ""safe"" methods in Smalltalk","<p>I want to collect which methods can be safely pushed down from a superclass to a subclass, specifically, when you have only one subclass and there is no reason to maintain the method in the superclass. </p>

<p>It could be a matter of dinamically discover these methods (during execution) to check which ones are executed in a superclass AND they could be pushed down given that there is only one subclass? 
Someone had done this? Is there a tool maybe?</p>
","<inheritance><refactoring><smalltalk><pharo><class-hierarchy>","2","51","2012-03-04 21:45:20"
"9569426","Move method to new file and keep it in the same class(make it partial)","<p>I have a lot of classes with several methods.
And i need to separate each method of the class in its own file, but kept they in the same class( make it partial).</p>

<p>Exploring the R# 6.1 options i haven't found linear possibility. May be there are hidden options?</p>

<p>Thanks</p>

<p>Added:</p>

<p>This refactoring is not usual because this code is UI tests, that grouped in class by the part of functionality. 
We need to separate them to be able to work on them separately from source control.</p>
","<c#><visual-studio-2010><refactoring><resharper>","1","88","2012-03-05 15:38:01"
"9587771","How to refactor Events in WPF?","<p>I have multiple textboxes with TextChanged events bound to the same handler</p>

<pre><code>&lt;TextBox TextChanged=""TextBox_TextChanged"" /&gt;
&lt;TextBox TextChanged=""TextBox_TextChanged"" /&gt;
&lt;TextBox TextChanged=""TextBox_TextChanged"" /&gt;
&lt;TextBox TextChanged=""TextBox_TextChanged"" /&gt;
</code></pre>

<p>Is there any way to do something like this?</p>

<pre><code>&lt;StackPanel&gt;
    &lt;StackPanel.Resources&gt;
        &lt;Style TargetType=""TextBox""&gt;
            &lt;Setter Property=""TextChanged"" Value=""TextBox_TextChanged"" /&gt;
         &lt;/Style&gt;
    &lt;/StackPanel.Resources&gt;
    &lt;TextBox /&gt;
    &lt;TextBox /&gt;
    &lt;TextBox /&gt;
    &lt;TextBox /&gt;
&lt;/StackPanel&gt;
</code></pre>

<p>I know the code above is invalid, but it is something similar to what I want to achieve</p>
","<wpf><events><xaml><resources><refactoring>","1","40","2012-03-06 16:27:50"
"9588860","how can I refactor a container to use a predicate method directly?","<p>The snippet below works.  However, it's a bit ugly because it uses a static method to wrap a method call to a predicate.</p>

<p>In other words, I would like to replace:</p>

<pre><code>c.remove_if_true( Value::IsOdd );   // static method
</code></pre>

<p>with something like</p>

<pre><code>c.remove_if_true( Value::isOdd );   // member method
</code></pre>

<p>There should be one fewer level of indirection and hopefully, the resultant code would be clearer.</p>

<p><strong>How do I refactor my code to call <code>isOdd()</code> directly without having to go through a static method wrapper?</strong></p>

<p>However, if this implementation is as clear as I can make this code, also let me know.  TIA.</p>

<pre><code>#include &lt;vector&gt;
#include &lt;functional&gt;

template&lt; typename T &gt;
class MyContainer
{
public:
    typedef std::function&lt;bool(const T&amp; t)&gt;   PREDICATE;

public:
    void remove_if_true( PREDICATE predicate )
    {
        // NOTE: use implementation from KennyTM's answer below
    }
private:
    std::vector&lt; T &gt;  m_vec;
};

class Value
{
public:
    Value( int i ) : m_i( i ) { }
    bool isOdd() const { return m_i%2==1; }
    static bool IsOdd( const Value&amp; v ) { return v.isOdd(); }
private:
    int m_i;
};


int main()
{
    MyContainer&lt;Value&gt; c;

    c.remove_if_true( Value::IsOdd );  // would like to replace with Value::isOdd here
}
</code></pre>

<h2>Solution using KennyTM's Answer</h2>

<p><strong>ataylor's suggestion <code>std::mem_fun_ref()</code> required with gcc 4.6.1 and other compilers not completely up-to-date with latest standards</strong></p>

<pre><code>#include &lt;vector&gt;
#include &lt;algorithm&gt;
#include &lt;functional&gt;

template&lt; typename T &gt;
class MyContainer
{
public:
    typedef std::const_mem_fun_ref_t&lt;bool, T&gt;  PREDICATE;

public:
    void remove_if( PREDICATE predicate )
    {
        auto old_end = m_vec.end();
        auto new_end = std::remove_if(m_vec.begin(), old_end, predicate);
        m_vec.erase(new_end, old_end);
    }
private:
    std::vector&lt; T &gt;  m_vec;
};

class Value
{
public:
    Value( int i ) : m_i( i ) { }
    bool isOdd() const { return m_i%2==1; }
private:
    int m_i;
};


int main()
{
    MyContainer&lt;Value&gt; c;

    c.remove_if( std::mem_fun_ref( &amp;Value::isOdd ));
}
</code></pre>
","<c++><templates><functional-programming><refactoring><c++11>","0","121","2012-03-06 17:32:22"
"9597896","Refactoring code for drawing game components","<p>How can I refractor the following, to move my drawing functions from the h-file into a GraphicsManager class?</p>

<pre><code>//drawingFunctions.h
void drawTexturedQuad( Texture texture, Vector2 pos, Vector2 dim) {
    // bind texture...
    glBegin(...);    // draw  
    //...
    glEnd(...);
}

//class file
#include ""drawingFunctions.h""
class Player { 
    void drawPlayer(){ drawTexturedQuad( texture, pos, dim) } 
};
class Enemy { 
    void drawEnemy(){ drawTexturedQuad( texture, pos, dim) } 
};
class Item { 
    void drawItem(){ drawTexturedQuad( texture, pos, dim) } 
};
// and so on for the other components

//gameloop file
// instantiate components objects
while (true) {
    // input, logic
    Player.drawPlayer();
    Enemy.drawEnemy();
    Item.drawItem();
    // and so on
}
</code></pre>

<p>(The code is obviously simplified, I am just asking about the drawing here)</p>

<p>Should I...</p>

<ul>
<li>pass a pointer to the GraphicsManager to every call of drawPlayer, drawEnemy etc from within the gameloop</li>
<li>have Player, Enemy etc have a pointer to GraphicsManger as a data member</li>
<li>have Player, Enemy etc extend a drawableGameComponent class that has a pointer to GraphicsManager as a data member</li>
<li>something else?</li>
</ul>
","<c++><game-development><architecture><refactoring>","0","98","2012-03-07 08:15:42"
"9621241","Can I refactor class constructor to use a a new class, using Visual Studio?","<p>I have the following class, that has too many parameters in the constructor, and I want to refactor the class to receive only one object that encapsulate all the parameters.</p>

<pre><code>public class MyClass
{
    public MyClass(
       string param1,
       string param2,
       string param3,
       string param4,
       string param5)
    {
       ...
    }
}
</code></pre>

<p>Is it possible to use Visual Studio refactor utility to encapsulate all the constructor parameters in a new class?</p>

<pre><code>public class MyClass
{
    public MyClass(MyClassParameters parameters)
    {
       ...
    }
}

public class MyClassParameters
{
    public string Param1 { get; set; }
    public string Param2 { get; set; }
    public string Param3 { get; set; }
    public string Param4 { get; set; }
    public string Param5 { get; set; }
}
</code></pre>

<p>So my questions are</p>

<ul>
<li>Can I do this using Visual Studio, so I don't have to manually update all the refereces to class <code>MyClass</code>? </li>
<li>Are there other refactor tools that support this functionality, such as <a href=""http://www.jetbrains.com/resharper/"" rel=""nofollow"">Resharper</a>, or others?</li>
</ul>

<p>It is a hard work, since I have thousands of references to this class in my unit testing suite.</p>
","<c#><.net><visual-studio><refactoring><automated-refactoring>","0","66","2012-03-08 16:34:19"
"9623378","Xcode 4.3 & 4.3.1 Breaks Refactoring?","<p>Since installing Xcode 4.3, and continuing now with 4.3.1, Xcode is no longer able to perform Refactor->Extract... operations.  This worked fine in previous builds. When you would select a block of code in an obj-c method, it would calculate the arguments and return type suited to your needs, let you select the method signature, show you a preview, then alter the code.</p>

<p>Now, it lets you select the method signature, but on the preview step, an error pops up with the text ""Can’t extract method from code not already in a method.""</p>

<p>Does anyone know a way around this, or have they really broken extraction in these builds?</p>
","<ios><xcode><xcode4><refactoring><xcode4.3>","2","282","2012-03-08 19:08:23"
"9632347","C++ code dependency / call-graph ""viewer""?","<p>is there such a thing as a (free) tool that would display a graph of all functions call in a given function?
For instance, if I use it on a complex function fun() I'm trying to understand, it would show me all the functions called by fun() in order, then I would have the possibility to see the same thing for the function called by fun(), and so on.
I'm looking for this for C++ code.
Does such a thing even exist?</p>

<p>edit : I am using VS 2008 if that helps, but I was thinking that such a software would work on the source files anyway</p>
","<c++><tools><refactoring>","6","523","2012-03-09 10:16:50"
"9636028","Would anyone refactor a URL change better than the way I do?","<p>Not sure if this is inapropriate albeit it working fine.</p>

<p>In order to move to a new location and retain the root URL, I do examples like this :</p>

<pre><code>window.location = window.location.href.split('/oldbar')[0] + '/foobar/' + $value

window.location = window.location.href.split(/oldbar/)[0] + 'foobar';

window.location = window.location.href.split('/oldbar')[0] + '/foobar/'
</code></pre>

<p>Would you do it differently? If so how / why?</p>
","<javascript><jquery><url><refactoring>","0","46","2012-03-09 14:49:59"
"9639085","Improve my routes join/disjoin","<p>I have a lot of join/disjoin routes, how could I improve the way I wrote this ?
Or could I make it RESTful ?</p>

<pre><code>  match 'events/:id/join' =&gt; 'events#join', :as =&gt; 'join_event'
  match 'events/:id/disjoin' =&gt; 'events#disjoin', :as =&gt; 'disjoin_event'

  match 'assos/:id/join' =&gt; 'assos#join', :as =&gt; 'join_asso'
  match 'assos/:id/disjoin' =&gt; 'assos#disjoin', :as =&gt; 'disjoin_asso'

  match 'projects/:id/join' =&gt; 'projects#join', :as =&gt; 'join_project'
  match 'projects/:id/disjoin' =&gt; 'projects#disjoin', :as =&gt; 'disjoin_project'

  match 'roles/:id/join' =&gt; 'roles#join', :as =&gt; 'join_role'
  match 'roles/:id/disjoin/:user_id' =&gt; 'roles#disjoin', :as =&gt; 'disjoin_role'

  match 'groups/:id/join' =&gt; 'groups#join', :as =&gt; 'join_group'
  match 'groups/:id/disjoin/:user_id' =&gt; 'groups#disjoin', :as =&gt; 'disjoin_group'
</code></pre>
","<ruby-on-rails><rest><refactoring><routes>","0","20","2012-03-09 18:25:36"
"9639721","Am I using the rails form properly?","<p>I feel like I have no idea what I'm doing.. I have a vague Idea. I'm hoping I did this all right so far.</p>

<p>Any way you can see to refactor this would be greatly appreciated.</p>

<p>One thing I noticed it does wrong is it won't load the proper options that were previously submitted if there is an error and it posts to the same URL. The text inputs seem to load the previous value but the select and the radio buttons reset to the default every submit.</p>

<p>ResourcesController#new</p>

<pre><code> def new
    @resource = Resource.new
    @title = ""Submit Resource""
    @categories = Category.all
 end
</code></pre>

<p>ResourcesController#create (notice I have @categories = Category.all in both... according to DRY im not sure where else it should go, or it only works on the first form submit. </p>

<pre><code>  def create
    @title = ""Submit Resource""
    @categories = Category.all

    @resource = Resource.new(params[:resource])

    category_ids = @categories.map { |c| c[1] }

    if @resource.valid? and category_ids.include? params[:category_id]
      @resource.cost = params[:cost]
      @resource.category_id = params[:category_id]
      @resource.save
      redirect_to root_url
    else
      render :action =&gt; :new
    end 
  end
</code></pre>

<p>Resource.rb (model)</p>

<pre><code># == Schema Information
#
# Table name: resources
#
#  id          :integer         not null, primary key
#  upvotes     :integer         default(0)
#  downvotes   :integer         default(0)
#  url         :string(255)
#  title       :string(255)
#  cost        :integer         default(0)
#  description :text
#  flags       :integer
#  category_id :integer
#  user_id     :integer
#  created_at  :datetime        not null
#  updated_at  :datetime        not null
#

class Resource &lt; ActiveRecord::Base

  belongs_to :category
  belongs_to :user
  has_many :favorites
  has_many :resource_tags
  has_many :tags, :through =&gt; :resource_tags

  attr_accessible :url, :title, :cost, :description, :category_id, :user_id

  # Pseudo-Enum
  COST = [:free, :paid, :both]

  url_regex = /^(?:http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}(:[0-9]{1,5})?(\/.*)?$/ix

  validates :url,         :presence =&gt; true,
                          :format   =&gt; { :with =&gt; url_regex, 
                                         :message  =&gt; ""must be valid""},
                          :uniqueness =&gt; { :case_sensitive =&gt; false,
                                           :message =&gt; ""has already been submitted""}
  validates :title,       :presence =&gt; true,
                          :length   =&gt; { :within =&gt; 6..75 }
  validates :cost,        :presence =&gt; true
  validates :description, :presence =&gt; true,
                          :length   =&gt; { :within =&gt; 25..200 }
  validates :category_id, :presence =&gt; true,
                          :format   =&gt; { :with =&gt; /\d+/ }
  validates :user_id,     :presence =&gt; true,
                          :format   =&gt; { :with =&gt; /\d+/ }

  def cost
    COST[read_attribute(:cost)]
  end

  def cost=(value)
    write_attribute(:cost, COST.index(value.downcase.to_sym))
  end

  def category_id
    read_attribute(:category_id).to_i
  end

  def category_id=(value)
    write_attribute(:category_id, value.to_i)
  end

end
</code></pre>

<p>My view file for the Resource#new form</p>

<pre><code>  &lt;div class=""field""&gt;
    &lt;%= f.label :category %&gt;
    &lt;%= select_tag(:category_id, options_for_select(@categories.map {|c|[c.name, c.id]})) %&gt; 
  &lt;/div&gt;
</code></pre>

<p>Last Q: i havent worked with the user_id field yet. This is going to be pulled from devise and will associate a User with a submitted resource. But how do I assign this without making some sort of input, like a hidden input. Would this go on behind the scenes in the controller?</p>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring>","1","57","2012-03-09 19:17:00"
"9629989","How Textstream Read/Write methods work in VB 6?","<p>VB application is re-engineered to java.
There is a ZIP file which is read using TextStream.Read(file.size) method in the VB application and this is stored in the DB(coloumn having IMAGE as its data type in Sql).
How can we read this from java and write to a file so that the ZIP file is valid.
Is there any particular way of writing/handling these files in java ? </p>

<p>I have found that Textstream.Read method returns a string, but then what is the encoding thats used here and should some characters be removed from the string like newline characters ?</p>

<p>Just to add i am using hibernate , mapped as binary type to retrieve this coloumn.</p>
","<java><file><vb6><refactoring>","0","129","2012-03-09 06:42:47"
"9646912","In Eclipse, how can I move project files without dependencies on a library to a more abstract project?","<p>I have two Eclipse projects: one that depends upon a certain library (android.jar) and one that is more abstract and doesn't contain that dependency.</p>

<p>I am in the process of migrating all classes that have <strong>no dependencies</strong> on the package, in my case <code>android.*</code>, to the more abstract project.  Is there a Eclipse feature that can help automate the move?  </p>

<p>Ideally, there would be feature that directly lets you automatically search for and move files that can be relocated to a new project.  It would find files that that are:</p>

<ul>
<li>independent of a specified package (with wildcards) </li>
<li>independent of other files within the same project that are dependent on the same package (in other words, no indirect dependencies on the package)</li>
</ul>
","<eclipse><refactoring><dependencies><dependency-management><dependency-analysis>","0","59","2012-03-10 13:43:59"
"9647147","process or steps to refactor god class in a c++ legacy application?","<p>This application was written without any knowledge of design principles (SOLID) by the previous developer. The most critical issue of the app is that it has god class with lots and lots of switch statements. This ill-advised structure makes it hard to maintain the app. Of course, there is no unit testing at all.</p>

<p>First on switch statements, I found there are two main potential classes that varies over the application. So I will try to first construct those two classes and move the corresponding code to the classes from the god class. Is this a right way? What is a good process to attack this issue?</p>

<p>BYW, I have the book ""Working Effectively with Legacy Code"". So you can suggest which part of the book I have to read for this too :-)</p>
","<c++><refactoring>","4","120","2012-03-10 14:19:40"
"9657849","How do I test a method was called within a class under test?","<p>I'll start by saying I am pretty new to unit testing and I'd like to start using a TDD approach, but for now am writing unit tests for some existing classes to verify their functionality in all cases.</p>

<p>I've been able to test the majority of my code using NUnit and Rhino mocks without much trouble. However, I've been wondering about unit testing functions that end up calling a lot of other methods within the same class. I can't do something like </p>

<pre><code>classUnderTest.AssertWasCalled(cut =&gt; cut.SomeMethod(someArgs))
</code></pre>

<p>because the class under test isn't a fake. Furthermore, if a method I'm testing calls other methods in the class under test that in turn also call methods in the same class, I'm going to need to fake a ton of values just to test the ""top level"" method. Since I'm also unit testing all of these ""sub methods"", I should be able to assume that ""SomeMethod"" works as expected if it passes the unit test and not need to worry about the details of those lower-level methods.</p>

<p>Here is some example code I've been working with to help illustrate my point (I've written a class to manage import/export of Excel files using NPOI):</p>

<pre><code>    public DataSet ExportExcelDocToDataSet(bool headerRowProvided)
    {
        DataSet ds = new DataSet();

        for (int i = 0; i &lt; currentWorkbook.NumberOfSheets; i++)
        {               
            ISheet tmpSheet = currentWorkbook.GetSheetAt(i);

            if (tmpSheet.PhysicalNumberOfRows == 0) { continue; }
            DataTable dt = GetDataTableFromExcelSheet(headerRowProvided, ds, tmpSheet);

            if (dt.Rows.Count &gt; 0)
            {
                AddNonEmptyTableToDataSet(ds, dt);
            }
        }

        return ds;
    }

    public DataTable GetDataTableFromExcelSheet(bool headerRowProvided, DataSet ds, ISheet tmpSheet)
    {
        DataTable dt = new DataTable();
        for (int sheetRowIndex = 0; sheetRowIndex &lt;= tmpSheet.LastRowNum; sheetRowIndex++)
        {
            DataRow dataRow = GetDataRowFromExcelRow(dt, tmpSheet, headerRowProvided, sheetRowIndex);
            if (dataRow != null &amp;&amp; dataRow.ItemArray.Count&lt;object&gt;(obj =&gt; obj != DBNull.Value) &gt; 0)
            {
                dt.Rows.Add(dataRow);
            }
        }

        return dt;
    }

...
</code></pre>

<p>You can see that <strong>ExportExcelDocToDataSet</strong> (my ""top-level"" method in this case) calls <strong>GetDataTableFromExcelSheet</strong> which calls <strong>GetDataRowFromExcelRow</strong>, which calls a couple of other methods that are defined within this same class.</p>

<p>So what is the recommended strategy for refactoring this code to make it more unit testable without having to stub values called by submethods? Is there a way to fake method calls within the class under test?</p>

<p>Thanks in advance for any help or advice!</p>
","<c#><unit-testing><refactoring><nunit><rhino-mocks>","1","152","2012-03-11 18:48:10"
"9661502","Elegant parsing of query string in C","<p>I'm trying to parse a URL query string in C and I don't see how to do it elegantly. Any hints or suggestions would be greatly appreciated:</p>

<pre><code>static void readParams(char * string, char * param, char * value) {
    char arg[100] = {0};  // Not elegant, brittle
    char value2[1024] = {0};

    sscanf(string, ""%[^=]=%s"", arg, value2);
    strcpy(param, arg);
    strcpy(value, value2);
}
char * contents = ""username=ted&amp;age=25"";
char * splitted = strtok (contents,""&amp;"");
char * username;
char * age;

while (splitted != NULL)
{
    char param[100]; // Not elegant, brittle
    char value[100];
    char * t_str = strdup(splitted);
    readParams(t_str, param, value);
    if (strcmp(param, ""username"") == 0) {
        username = strdup(value);
    }
    if (strcmp(param, ""age"") == 0) {
        age = strdup(value); // This is a string, can do atoi
    }
   splitted = strtok (NULL, ""&amp;"");
 }
</code></pre>

<p>The problem I kept on having is that because of the <code>strtok</code> function anything that was seemed more intelligent to do before the last <code>strtok</code> function seemed to break the while loop.  </p>
","<c><refactoring><c99>","3","129","2012-03-12 03:45:31"
"9662549","How to refactor code with try-catch-finally","<p>I have to create a bunch of methods that look like this.  The things that change will be the method name, the return type and the lines marked in the middle - the rest will be the same.  Is there a <strong>clean</strong> way to refactor this so that I don't repeat myself?</p>

<pre><code>private bool CanPerform(WindowsIdentity identity, string applicationName, int operation)
{
    IAzApplication3 application = null;
    IAzClientContext3 context = null;
    try
    {
        application = this.store.OpenApplication(applicationName, null) as IAzApplication3;

        ulong token = (ulong)identity.Token.ToInt64();
        context = application.InitializeClientContextFromToken(token, null) as IAzClientContext3;

        // lines that change go here
    }
    catch (COMException e)
    {
        throw new SecurityException(string.Format(""Unable to check operation '{0}'"", operation), e);
    }
    finally
    {
        Marshal.FinalReleaseComObject(context);
        Marshal.FinalReleaseComObject(application);
    }
}
</code></pre>

<p>I realise this is probably basic stuff but I work alone so there's no one else to ask.</p>
","<c#><refactoring><refactor-my-code>","2","123","2012-03-12 06:20:46"
"9673729","Always avoid in-out parameters in Java?","<p>There's no doubt that in-out parameters leads to confused code since they may increase unexpected/unpredictabled side-effects.</p>

<p>So, many good programmers say : </p>

<blockquote>
  <p>Avoid in-out parameters for changing mutable method parameters. Prefer to keep parameters unchanged.</p>
</blockquote>

<p>For a perfectionist programmer who expects his code to be the most clean and understandable, does this ""rule"" must be applied in all case ?</p>

<p>For instance, suppose a basic method for adding elements to a simple list, there's two ways :</p>

<p><strong>First way (with in-out parameter):</strong> </p>

<pre><code>private void addElementsToExistingList(List&lt;String&gt; myList){
  myList.add(""Foo"");
  myList.add(""Bar"");
}
</code></pre>

<p>and the caller being : </p>

<pre><code>List&lt;String&gt; myList = new ArrayList&lt;String&gt;();
//.......Several Instructions (or not) .....
addElementsToExistingList(myList);
</code></pre>

<p><strong>Second way without out parameter :</strong> </p>

<pre><code>private List&lt;String&gt; addElementsToExistingList(List&lt;String&gt; originalList){
      List&lt;String&gt; filledList = new ArrayList&lt;String&gt;(originalList); //add existing elements
      filledList.add(""Foo"");
      filledList.add(""Bar"");
      return filledList; 
    }
</code></pre>

<p>and the caller being : </p>

<pre><code>List&lt;String&gt; myList = new ArrayList&lt;String&gt;();
//.......Several Instructions (or not) .....
myList.addAll(addElementsToExistingList(myList));
</code></pre>

<p>Pros of second way : </p>

<p>Parameter are not modified => no risk of unexpected side-effects for a new code reader.</p>

<p>Cons of second way : </p>

<p>Very verbose and very less readable ...</p>

<p>Of course, you would tell me that for a code as simple as this one, first way is really more convenient. </p>

<p>But, if we don't consider the difficulty of any concept/code, I juge the second way more logical and obvious for any readers (beginners or not).</p>

<p><strong>However, it violates the CQS principle that consider ""command"" methods having void return with potential (but allowed since it's the convention) side-effects and ""query"" methods having a return type and without side-effects.</strong></p>

<p>So, what should a motivate programmer adopt ? Mix of two accorging to the code case ? Or keep the ""law"" expecting to always avoid in-out parameters... </p>

<p>(Of course, method for adding Element is named for expliciting the example, and would be a bad name choice in real code).</p>
","<java><refactoring><parameter-passing><practice>","2","158","2012-03-12 19:43:24"
"9676932","Refactor this block of routes?","<p>I have to manually redirect a set of URLs, but seems like there's got to be a more efficient way (in terms of # of lines) than what I've currently go.</p>

<pre><code>match ""/articles/care"" =&gt; redirect(""/articles/category/care"")
match ""/articles/food-diet"" =&gt; redirect(""/articles/category/food-diet"")
match ""/articles/basics"" =&gt; redirect(""/articles/category/basics"")
match ""/articles/training"" =&gt; redirect(""/articles/category/training"")
match ""/articles/recipes"" =&gt; redirect(""/articles/category/recipes"")
match ""/articles/life"" =&gt; redirect(""/articles/category/life"")
</code></pre>
","<ruby-on-rails><ruby-on-rails-3><refactoring><routes>","0","36","2012-03-13 00:55:39"
"9683766","What is the best way of replacing a system in a very complex program?","<p>I have a task to replace a library of classes all associated with the same thing. However this thing permeates into the rest of the code to a huge degree. I have been trying to simply comment it all out, but it is taking forever!</p>

<p>Is there a better way? The new system is somewhat similar but not nearly similar enough to just replace the old one.</p>

<p>What's the best plan of attack?</p>

<p><strong>edit</strong> - My main concern is this - </p>

<p>what if I comment every reference to the old code, and then find that because of the complexity of the system, it still doesn't run. have I then wasted all that time?</p>
","<c++><refactoring>","0","79","2012-03-13 12:11:29"
"9688486","Refactoring methods that use the same code but different types","<p>I have several methods that do the same thing yet, when interfacing with the MySQL database, save or load a different type of parameter. Currently, I have a different method for each type. How can I combine these methods so that they support different types?</p>

<p>Below is an example of two methods that are very similar yet use different types:</p>

<pre><code>public static void saveLongArray(Connection con, int playerID, String tableName, String fieldName, long[] array, long[] originalArray) {
    try {
        for (int i = 0; i &lt; array.length; i++) {
            // Check for change before running query
            if (array[i] != originalArray[i]) {
                if (array[i] != 0 &amp;&amp; array[i] != -1) {
                    PreparedStatement updateQuery = con.prepareStatement(""REPLACE INTO `"" + tableName + ""` (`player_id`, `index`, `"" + fieldName + ""`) VALUES(?, ?, ?)"");
                    updateQuery.setInt(1, playerID);
                    updateQuery.setInt(2, i);
                    updateQuery.setLong(3, array[i]);
                    updateQuery.execute();
                } else {
                    PreparedStatement deleteQuery = con.prepareStatement(""DELETE FROM `"" + tableName + ""` WHERE `player_id` = ? AND `index` = ?"");
                    deleteQuery.setInt(1, playerID);
                    deleteQuery.setInt(2, i);
                    deleteQuery.execute();
                }

                originalArray[i] = array[i];
            }
        }
    } catch (SQLException ex) {
        Logger.getLogger(PlayerSaveHandler.class.getName()).log(Level.SEVERE, ""SQL Exception while saving a long array!"", ex);
    }
}

public static void saveIntArray(Connection con, int playerID, String tableName, String fieldName, int[] array, int[] originalArray) {
    try {
        for (int i = 0; i &lt; array.length; i++) {
            // Check for change before running query
            if (array[i] != originalArray[i]) {
                if (array[i] != 0 &amp;&amp; array[i] != -1) {
                    PreparedStatement updateQuery = con.prepareStatement(""REPLACE INTO `"" + tableName + ""` (`player_id`, `index`, `"" + fieldName + ""`) VALUES(?, ?, ?)"");
                    updateQuery.setInt(1, playerID);
                    updateQuery.setInt(2, i);
                    updateQuery.setInt(3, array[i]);
                    updateQuery.execute();
                } else {
                    PreparedStatement deleteQuery = con.prepareStatement(""DELETE FROM `"" + tableName + ""` WHERE `player_id` = ? AND `index` = ?"");
                    deleteQuery.setInt(1, playerID);
                    deleteQuery.setInt(2, i);
                    deleteQuery.execute();
                }

                originalArray[i] = array[i];
            }
        }
    } catch (SQLException ex) {
        Logger.getLogger(PlayerSaveHandler.class.getName()).log(Level.SEVERE, ""SQL Exception while saving an int array!"", ex);
    }
}
</code></pre>

<p>Note in that example the types are both numerical. In a case where types are completely different (e.g. int and String), what could I do to avoid have near-duplicate methods?</p>
","<java><refactoring>","1","100","2012-03-13 16:55:35"
"9694407","Mitigating the effects of refactoring code within a git repo","<p>I've been using git for a while on a project, and its time to clean up. </p>

<p>I have a few source code files that have become to large and should be split up into multiple files. I also want to move some functions from one file to a more appropriate one.</p>

<p>Since git tracks all my changes, will this effectively double the size of my git repo? Is there a way to avoid this? Or is it a better practice to keep a history of these changes? (in case for some reason I want to go back to the messy state I'm currently in)</p>

<p>Thoughts, opinions and solutions welcome!
Thanks.</p>
","<git><refactoring>","2","68","2012-03-14 00:44:49"
"9686567","Dependency Injection - What to do when you have a lot of dependencies?","<p>I have a class A that depends on 10 other classes. According to Dependency Injection pattern, i should pass all dependencies of A by its constructor. </p>

<p>So lets assume this constructor (of course this is not a working or real code, since I am not allowed to post the real code here)</p>

<pre><code>public ClassA(ClassB b, ClassC c, ClassD d, ClassE e, ClassF f, ClassG g, ClassH h, ClassI i) {
  this.b = b;
  this.c = c;
  this.d = d;
  this.e = e;
  this.f = f;
  this.g = g;
  this.h = h;
  this.i = i;
}
</code></pre>

<p>I have read on Martin Fowler's book about refactoring that having a method with a lot of parameters is a code smell and should not happen.</p>

<p>My question is: is this OK when we are talking about DI? Is there a better way of inject dependencies without breaking Martin Fowler's rules?</p>

<p>I know I could pass the dependencies through properties, but that may cause errors since no one is really sure what should be pass in order that the class works.</p>

<p><strong>EDIT</strong></p>

<p>Thanks for all your answers. I will try now to demonstrate some of class A dependencies:</p>

<p>1 - A class to access a DB<br>
2 - Another class to access another DB (yes, i need to perform operations on two databases)<br>
3 - A class to send error notifications by email<br>
4 - A class to load configurations<br>
5 - A class that will act as timer for some operations (maybe this one can be avoided)<br>
6 - A class with business logic  </p>

<p>There any many others that i am trying to get rid of, but those are really necessary and I dont see any ways of avoiding them.</p>

<p><strong>EDIT</strong></p>

<p>After some refactoring now i have 7 dependencies (down from 10). But I have 4 <code>DAO</code> objects:</p>

<p>CustomerDAO<br>
ProcessDAO<br>
ProductsDAO<br>
CatalogDAO  </p>

<p>Is it correct do create another class called MyProjectDAO and inject those DAOS onto it? This way I will have only one DAO class that aggregates all DAO objects of my project. I dont think this is a good idea because it violates the Single Responsibility Principle. Am I right?</p>
","<c#><design-patterns><dependency-injection><refactoring>","3","201","2012-03-13 14:59:24"
"9696974","Rails module vs gem vs helper methods","<p>I have an application where I want to allow my users to be able to upload and crop images. I have based this functionality around <a href=""http://railscasts.com/episodes/182-cropping-images"" rel=""nofollow"">http://railscasts.com/episodes/182-cropping-images</a></p>

<p>It is working fine, however the code is quite messy and repetitive.</p>

<p>If you look at my crop view file you can easily see what I am talking about:</p>

<pre><code>&lt;% content_for (:head) do %&gt;
    &lt;%= javascript_include_tag ""jquery.Jcrop.min"" %&gt;
    &lt;script type=""text/javascript""&gt;
    $(function() {
        $('#cropbox').Jcrop({
            onChange: update_crop,
            onSelect: update_crop,
            &lt;% if params[:website] &amp;&amp; params[:website][:footer_image].present? %&gt;
            aspectRatio: &lt;%= @website.footer_image_aspect_ratio %&gt;
            &lt;% elsif params[:website] &amp;&amp; params[:website][:logo].present?  %&gt;
            aspectRatio: &lt;%= @website.logo_aspect_ratio %&gt;
            &lt;% elsif params[:page][:theme_image].present?  %&gt;
            aspectRatio: &lt;%= @page.supported_page.theme_image_aspect_ratio %&gt;
            &lt;% end %&gt;
        });
    });

    function update_crop(coords) {
        &lt;% if params[:website] &amp;&amp; params[:website][:footer_image].present? %&gt;
        var ratio = &lt;%= @website.footer_image_geometry(:original).width %&gt; / &lt;%= @website.footer_image_geometry(:large).width %&gt;; 
        &lt;% elsif params[:website] &amp;&amp; params[:website][:logo].present?  %&gt;
        var ratio = &lt;%= @website.logo_geometry(:original).width %&gt; / &lt;%= @website.logo_geometry(:large).width %&gt;; 
        &lt;% elsif params[:page][:theme_image].present?  %&gt;
        var ratio = &lt;%= @page.theme_image_geometry(:original).width %&gt; / &lt;%= @page.theme_image_geometry(:large).width %&gt;; 
        &lt;% end %&gt;
        $('#crop_x').val(Math.floor(coords.x * ratio));
        $('#crop_y').val(Math.floor(coords.y * ratio));
        $('#crop_w').val(Math.floor(coords.w * ratio));
        $('#crop_h').val(Math.floor(coords.h * ratio));
    }
    &lt;/script&gt;
&lt;% end %&gt;

&lt;% if params[:website] &amp;&amp; params[:website][:footer_image].present? %&gt;
    &lt;%= image_tag @website.footer_image.url(:large), :id =&gt; ""cropbox"" %&gt;
&lt;% elsif params[:website] &amp;&amp; params[:website][:logo].present?  %&gt;
    &lt;%= image_tag @website.logo.url(:large), :id =&gt; ""cropbox"" %&gt;
&lt;% elsif params[:page][:theme_image].present?  %&gt;
    &lt;%= image_tag @page.theme_image.url(:large), :id =&gt; ""cropbox"" %&gt;
&lt;% end %&gt;

&lt;% @model = (@website) ? @website : @page %&gt;
&lt;%= form_for @model, :method =&gt; ""put"" do |form| %&gt;
    &lt;%= form.text_field :cropped_image_name %&gt;
  &lt;% for attribute in [:crop_x, :crop_y, :crop_w, :crop_h] %&gt;
    &lt;%= form.text_field attribute, :id =&gt; attribute %&gt;
  &lt;% end %&gt;
  &lt;p&gt;&lt;%= form.submit ""Crop"" %&gt;&lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>As you can see this view file isnt very nice to look at. Furthermore as you can probably tell I now have quite a few methods placed throughout my models that are very similar to each other such as:</p>

<pre><code>@website.footer_image_aspect_ratio
@website.logo_aspect_ratio
@page.supported_page.theme_image_aspect_ratio
</code></pre>

<p>Whats the best way of cleaning up this mess? The images (and therefore the mess) is spread over multiple models. Should I attack this with the use of modules or create a gem or can I get around it by just using helper methods?</p>

<p>It would be great to have a simple way to tell which image has been uploaded, I guess this can be done by simply moving the convoluted if statements into a helper method. However this seems a bit messy, and too add another croppable image one you would have to update the helper method.</p>

<p>Another option is to be able to define on the models which images are croppable so you could have something like:</p>

<pre><code>has_attached_file :logo, :styles =&gt; etc etc
has_attached_file :footer_image, :styles =&gt; etc etc

croppable :logo, footer_image
</code></pre>

<p>As they are now explicitly defined you could now easily write a function to work out which image they are currently trying to crop. To be able to define something like ""croppable"" do you need to create a gem? It would also be nice to have something like:   </p>

<pre><code>@image.aspect_ratio
@image.geometry(:original)
</code></pre>

<p>But, there is no image model.. Is this a time to create an CroppableImage class or what?</p>

<p>I am a bit confused about how best to refactor this in a general way so that I can use this functionality over multiple models without it bloating my codebase.</p>

<p>If anyone could give me some tips or suggest some articles to look at that would be hugely appreciated!</p>
","<ruby-on-rails><ruby-on-rails-3><refactoring><railscasts>","0","78","2012-03-14 06:29:39"
"9712053","Case statement refactor, basic ruby","<p>I have a method that takes a condition and item, from an array of conditions and array of items, where any number of conditions are checked against any number of items. Conditions and Items are Hashes Basically, for the condition and item fed to the method, find out what attribute of the item the condition needs to check against. The list is actually longer, and looking into making this better (seems like this could be more concise and perhaps more rubyesque) nothing else has worked(yet), so I'd like some input on how you might refactor this:</p>

<pre><code>  def check_condition(condition, item)
    case condition.attribute
    when :author
      i = item.author.name;
    when :title
      i = item.title
    when :body
      i = item.body
    when :domain
      i = URI(item.url).host
    when :account_age
      i = item.author.author_age
    end
    @logger.info ""#{i} to be checked if #{condition.query} #{condition.attribute}""
    test_condition(condition, item, i)
  end
</code></pre>

<p>EDIT:</p>

<p>Just to make clearer, items and conditions are Hashes (Hashie::Mash to be exact) where conditions are in general constructed from a config file that might be something like:</p>

<pre><code>[submitted_link, account_age, is_less_than, 30, remove]
</code></pre>

<p>that ends up something like:</p>

<pre><code>{subject: submitted_link, attribute: account_age, query: is_less_than, what: 30 action:remove}
</code></pre>

<p>And you can see what is going on as a whole here if you are so inclined: <a href=""https://github.com/blueblank/reddit_modbot/blob/master/lib/modbot/modbot_check.rb"" rel=""nofollow"">https://github.com/blueblank/reddit_modbot/blob/master/lib/modbot/modbot_check.rb</a></p>

<p>EDIT2:</p>

<p>The reality of the solution was to somewhat regularize my variable terminology for condition and item so this could be reduced to 1 line</p>

<pre><code> i = item.send(condition.attribute)
</code></pre>

<p>no mess, minimal impact</p>
","<ruby><refactoring><case>","0","73","2012-03-14 23:46:44"
"9718368","Refactoring ASP.NET control names","<p>I have an ASP.NET page with a code-behind file (<code>.ascx</code> file in the solution explorer, with <code>.ascx.cs</code> and <code>.ascx.designer.cs</code> files under it) I need to rename lots of controls on the page. If I change the ID in the properties pane in the designer window, it doesn't change it in the code file, and all references to the control are marked as an unrecognized name. If I change it in the code file (using the built-in refactoring), it changes it all over the code file, but not in the designer.</p>

<p>How can I refactor it across the whole project?</p>
","<asp.net><visual-studio-2010><refactoring>","2","73","2012-03-15 11:02:19"
"9723769","Tomcat hangs during webapp start up","<p>My <em>web project</em> was working perfectly, it includes: <em>spring3</em> and <em>hibernate3</em>. After renaming some fields in <em>eclipse</em> by the help of <em>eclipse refactoring</em>, <em>tomcat</em> could't start anymore. It hangs on these logs below:</p>

<pre><code>    ......
    ......
    ......

2012-03-15 15:55:48,131 INFO [org.hibernate.connection.ConnectionProviderFactory] [newConnectionProvider] - &lt;Initializing connection provider: org.springframework.orm.hibernate3.LocalDataSourceConnectionProvider&gt;
2012-03-15 15:55:53,763 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;RDBMS: MySQL, version: 5.0.77&gt;
2012-03-15 15:55:53,778 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JDBC driver: MySQL-AB JDBC Driver, version: mysql-connector-java-5.1.15 ( Revision: ${bzr.revision-id} )&gt;
2012-03-15 15:55:53,825 INFO [org.hibernate.dialect.Dialect] [&lt;init&gt;] - &lt;Using dialect: org.hibernate.dialect.MySQLDialect&gt;
2012-03-15 15:55:53,825 INFO [org.hibernate.transaction.TransactionFactoryFactory] [buildTransactionFactory] - &lt;Transaction strategy: org.springframework.orm.hibernate3.SpringTransactionFactory&gt;
2012-03-15 15:55:53,841 INFO [org.hibernate.transaction.TransactionManagerLookupFactory] [getTransactionManagerLookup] - &lt;No TransactionManagerLookup configured (in JTA environment, use of read-write or transactional second-level cache is not recommended)&gt;
2012-03-15 15:55:53,841 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Automatic flush during beforeCompletion(): disabled&gt;
2012-03-15 15:55:53,841 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Automatic session close at end of transaction: disabled&gt;
2012-03-15 15:55:53,841 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JDBC batch size: 15&gt;
2012-03-15 15:55:53,841 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JDBC batch updates for versioned data: disabled&gt;
2012-03-15 15:55:53,856 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Scrollable result sets: enabled&gt;
2012-03-15 15:55:53,856 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JDBC3 getGeneratedKeys(): enabled&gt;
2012-03-15 15:55:53,856 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Connection release mode: auto&gt;
2012-03-15 15:55:53,856 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Maximum outer join fetch depth: 2&gt;
2012-03-15 15:55:53,872 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Default batch fetch size: 1&gt;
2012-03-15 15:55:53,872 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Generate SQL with comments: disabled&gt;
2012-03-15 15:55:53,872 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Order SQL updates by primary key: disabled&gt;
2012-03-15 15:55:53,872 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Order SQL inserts for batching: disabled&gt;
2012-03-15 15:55:53,872 INFO [org.hibernate.cfg.SettingsFactory] [createQueryTranslatorFactory] - &lt;Query translator: org.hibernate.hql.ast.ASTQueryTranslatorFactory&gt;
2012-03-15 15:55:53,887 INFO [org.hibernate.hql.ast.ASTQueryTranslatorFactory] [&lt;init&gt;] - &lt;Using ASTQueryTranslatorFactory&gt;
2012-03-15 15:55:53,887 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Query language substitutions: {}&gt;
2012-03-15 15:55:53,887 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;JPA-QL strict compliance: disabled&gt;
2012-03-15 15:55:53,887 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Second-level cache: enabled&gt;
2012-03-15 15:55:53,903 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Query cache: disabled&gt;
2012-03-15 15:55:53,903 INFO [org.hibernate.cfg.SettingsFactory] [createRegionFactory] - &lt;Cache region factory : org.hibernate.cache.impl.NoCachingRegionFactory&gt;
2012-03-15 15:55:53,903 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Optimize cache for minimal puts: disabled&gt;
2012-03-15 15:55:53,903 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Structured second-level cache entries: disabled&gt;
2012-03-15 15:55:53,919 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Statistics: disabled&gt;
2012-03-15 15:55:53,919 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Deleted entity synthetic identifier rollback: disabled&gt;
2012-03-15 15:55:53,919 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Default entity-mode: pojo&gt;
2012-03-15 15:55:53,919 INFO [org.hibernate.cfg.SettingsFactory] [buildSettings] - &lt;Named query checking : enabled&gt;
2012-03-15 15:55:54,090 INFO [org.hibernate.impl.SessionFactoryImpl] [&lt;init&gt;] - &lt;building session factory&gt;
2012-03-15 15:55:54,714 INFO [org.hibernate.impl.SessionFactoryObjectFactory] [addInstance] - &lt;Not binding factory to JNDI, no JNDI name configured&gt;
2012-03-15 15:55:54,933 INFO [org.springframework.orm.hibernate3.HibernateTransactionManager] [afterPropertiesSet] - &lt;Using DataSource [org.apache.commons.dbcp.BasicDataSource@d99277] of Hibernate SessionFactory for HibernateTransactionManager&gt;
</code></pre>

<p><em>Before refactoring the log continued like this below:</em></p>

<pre><code>2012-02-29 07:52:39,822 INFO [org.springframework.ws.soap.saaj.SaajSoapMessageFactory] [afterPropertiesSet] - &lt;Creating SAAJ 1.3 MessageFactory with SOAP 1.1 Protocol&gt;
2012-02-29 07:52:39,853 INFO [org.springframework.oxm.jaxb.Jaxb2Marshaller] [createJaxbContextFromContextPath] - &lt;Creating JAXBContext with context path [aheeva.webService.oxm]&gt;
2012-02-29 07:52:40,571 INFO [org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping] [registerHandler] - &lt;Mapped URL path [
.......
.......
.......
</code></pre>

<p>There are no errors anywhere strange!
Does Spring have any bugs? Why doesn't it tell if the scans or any other processes are faulty, I can't get it. Everything in Eclipse seems fine, nevertheless Tomcat hangs, this is really absurd!</p>
","<java><spring><hibernate><tomcat><refactoring>","-2","300","2012-03-15 16:17:04"
"9735307","Find unused code in a Rails app","<p>How do I find what code is and isn't being run <strong>in production</strong> ? </p>

<p>The app is well-tested, but there's a lot of tests that test <em>unused</em> code. Hence they get coverage when running tests... I'd like to refactor and clean up this mess, it keeps wasting my time. 
I have a lot of background jobs, this is why I'd like the production env to guide me. Running at heroku I can spin up dynos to compensate any performance impacts from the profiler.</p>

<p>Related question <a href=""http://stackoverflow.com/q/2958443/252799"">How can I find unused methods in a Ruby app?</a> not helpful. </p>

<p>Bonus: metrics to show how often a line of code is run. Don't know why I want it, but I do! :)</p>
","<ruby-on-rails><ruby><refactoring><code-coverage><unused>","21","465","2012-03-16 10:11:01"
"9748183","Refactor hardcoded variable across multiple classes into one global variable?","<p>(First time please be gentle etc. etc.)</p>

<p>Let's say I was lazy/unthinking/pressed for time and hardcoded a string instead of making a global variable. And I repeated this mistake over hundreds of classes and test cases that I wrote. Now, I want to fix this, since I found out I'll eventually need to update that string. Is there some refactoring method in Eclipse or elsewhere that will let me replace all instances of that specific string with a global variable?</p>

<p>I can think of a programmatic solution, to run through all those files and replace the string, but I'd prefer not to go down that route unless absolutely necessary.</p>

<p>Thanks a lot!</p>
","<java><eclipse><refactoring><hardcoded>","1","99","2012-03-17 07:29:56"
"9758486","Essential Perl utility modules?","<p>I'm currently cleaning up an older Perl project. Large parts of it were written by myself some time ago when I barely knew Perl. I did probably reinvent the wheel several times.</p>

<p>Now is the time where I want to throw out any duplicated code and, if possible, replace everything which is already available in high-quality CPAN modules by those.</p>

<p><strong>Which essential Perl utility modules do you know of that every Perl developer should be aware of?</strong></p>

<p>This question is similar to the question <a href=""http://stackoverflow.com/questions/101719/useful-perl-modules"">Useful Perl modules</a>, however I'm not concered about the <em>big</em> modules listed there (e.g. DBI, Template, et. al.).</p>
","<perl><refactoring><cpan>","3","125","2012-03-18 12:58:04"
"9790800","making code change that affects the method name.","<p>I need to make a code change where the change I am making will affect the meaning of the method name. </p>

<p>What would be the best practice to handle such changes? Keeping the old name and and make the changes inside? Or rename the method? Or any other best practice? </p>

<p>Note, we use sub version. </p>

<p>Thanks for your help.</p>
","<svn><version-control><refactoring>","0","25","2012-03-20 16:24:23"
"9802183","Refactoring exercises in Java","<p>I have just been through the following paper and I found it extremely useful:
<a href=""http://www.objectmentor.com/resources/articles/Clean_Code_Args.pdf"" rel=""nofollow"">http://www.objectmentor.com/resources/articles/Clean_Code_Args.pdf</a></p>

<p>I am looking for similar papers/books/tutorials/etc. that provide step-by-step practice on refactoring and/or correct class design. I have read Fowler's “Refactoring”, but I was looking for more substantial examples.</p>
","<java><refactoring><code-cleanup>","2","177","2012-03-21 09:56:24"
"9814483","How to properly validate a user before displaying page in Rails","<p>In my application, I store the user's ID in session[]. At the beginning of every controller action, I'm calling a method defined in the ApplicationController called current_user:</p>

<pre><code>  def current_user
    @current_user ||= session[:current_user_id] &amp;&amp; 
    User.find_by_id(session[:current_user_id])
  end
</code></pre>

<p>At the beginning of my controllers' methods, I have the following:</p>

<pre><code>  @current_user = current_user
  if @current_user == nil     
    redirect_to :home         
    return                    
  end                         
</code></pre>

<p>This is obviously repetitive code and should be a method somewhere. I read the answer <a href=""http://stackoverflow.com/questions/7056599/rails-3-code-shared-between-multiple-controllers-where-to-put-it"">for this question</a>, and tried putting my method into a parent class that my controller classes now descend from, however it seems like I can't redirect from that method now.</p>

<p>In my parent class, I have:</p>

<pre><code>  def verify_user
    user = current_user
    if user == nil
      redirect_to ""/""
      return
    end
    return user
  end
</code></pre>

<p>And now I've changed my controller methods to this:</p>

<pre><code>  @current_user = verify_user
</code></pre>

<p>This doesn't work, and I think I know why. For one, I can't simply call return in my verify_user method, as that obviously will just return to the controller. The redirect doesn't seem to have any affect, probably because format.html is being called after the redirect call, which was the reason for the return in the original code.</p>

<p>So, what am I doing wrong here, and what suggestion do you have to solve it? Is this the wrong approach? My main goal is to keep the entire ""check if user is logged in otherwise redirect"" to one line of code per controller method.</p>
","<ruby-on-rails><redirect><refactoring><controller><authorization>","0","48","2012-03-21 23:42:50"
"9820765","Tricky if statement","<p>Is it possible to convert this if statement into a one line statement ? </p>

<pre><code>        if (value != DBNull.Value)
        {
            dic.Add(columnName);
        }
        else if (!skipNullValues)
        {
            dic.Add(columnName);    
        }
</code></pre>
","<c#><if-statement><refactoring>","1","94","2012-03-22 10:48:33"
"9825974","Is there a more efficient approach than C# Action delegates for avoiding this code duplication?","<p>As much as possible I want to avoid unnecessary duplication of code. In my scenario described below I have used <code>Action</code> delegates to avoid code duplication. However, when using the <code>Action</code> delegate approach, the code becomes approximately 50%-80% slower. </p>

<p>Is there a more efficient approach from a performance perspective than <code>Action</code> delegates to avoid code duplication in the scenario described below?</p>

<p>I have two methods that are equivalent except for the innermost statement of a lengthy loop:</p>

<pre><code>public T[] MethodA&lt;T&gt;(T[] from)
{
  ...
  for (var i = 0; i &lt; len; ++i)
  {
    var j = GetIndex(i);
    to[j] = from[i];    // This statement differs in MethodA and MethodB
  }
  ...
  return to;
}

public T[] MethodB&lt;T&gt;(T[] from)
{
  ...
  for (var i = 0; i &lt; len; ++i)
  {
    var j = GetIndex(i);
    to[i] = from[j];    // This statement differs in MethodA and MethodB
  }
  ...
  return to;
}
</code></pre>

<p>To avoid code duplication I have implemented a helper method that takes an <code>Action</code> delegate.  Invocation of the delegate replaces the variable statement, like this:</p>

<pre><code>private T[] HelperMethod&lt;T&gt;(T[], Action&lt;T[], T[], int, int&gt; action)
{
  ...
  for (var i = 0; i &lt; len; ++i)
  {
    var j = GetIndex(i);
    action(from, to, i, j);    // Invoke the Action delegate
  }
  ...
  return to;
}
</code></pre>

<p>Then I can reduce <code>MethodA</code> and <code>MethodB</code> as follows:</p>

<pre><code>public T[] MethodA&lt;T&gt;(T[] from)
{
  return HelperMethod(from, (src, dest, src_idx, dest_idx) =&gt; dest[dest_idx] = src[src_idx]);
}

public T[] MethodB&lt;T&gt;(T[] from)
{
  return HelperMethod(from, (src, dest, dest_idx, src_idx) =&gt; dest[dest_idx] = src[src_idx]);
}
</code></pre>

<p>Note that the only difference between the refactored <code>MethodA</code> and <code>MethodB</code> is the order of the <code>src_idx</code> and <code>dest_idx</code> in the <code>Action</code> signatures of the <code>HelperMethod</code> calls.</p>
","<c#><delegates><refactoring><code-duplication>","3","85","2012-03-22 15:57:04"
"9828096","Design Pattern To Refactor and Handle Non-Exceptional Errors in MVC Controller","<p>In my MVC3 application, I have a ""queries"" class specific to each controller that performs conversions between domain entities and converts them to view models.  I do this to keep my controllers clean and it's easier to unit test the controllers and queries seperately.  </p>

<p>There are cases, though, when the query method needs to pass <strong>non-exceptional error messages</strong> to the view (e.g. the entity was not found).  However, since my controller is only receiving a ViewModel from the query method and not any type of return code, the only two options that I have found to pass this error are as follows:</p>

<ol>
<li><p>Throw an Exception from the query method and use a Try/Catch block to catch the exception in the controller.  </p></li>
<li><p>Add a property to the View Model called ""ErrorMessage"" which is populated by the query method that the view uses to perform logic of what needs displayed.</p></li>
</ol>

<p>Because these aren't exceptional cases, and I know I shouldn't use Try/Catch to control program flow, I have choosen to use the second method. Though this works for now, it feels ""dirty"" to me for the following reasons:</p>

<ul>
<li>The controller has to receive a whole View Model when an error occurs just to get the ErrorMessage property.</li>
<li>The view has to have hard-coded logic and two sections to display either the error or the normal content</li>
<li>Though I could put the <code>if (Model.ErrorMessage != null)</code> logic in my controller to determine which view to pass, it's still not feeling like a ""clean"" solution.</li>
</ul>

<p>Are there any design patterns that I could use that could help me refactor this code and make it cleaner?</p>

<p><strong>Example View Model:</strong></p>

<pre><code>public class ApplicationViewModel
{
  public string ErrorMessage { get; set; }
  public int Id { get; set; }
  public string Name { get; set; }
  // Other properties here...
}
</code></pre>

<p><strong>Example Controller Method:</strong></p>

<pre><code>public ActionResult Retrieve(Guid guid)
{
  return View(""Application"", _applicationQueries.GetApplicationViewModel(guid));
}
</code></pre>

<p><strong>Example ApplicationQueries Method:</strong></p>

<pre><code>public ApplicationViewModel GetApplicationViewModel(Guid guid)
{
  var applicationViewModel = new applicationViewModel();

  if (!_applicationServices.Exists(guid))
  {
    applicationViewModel.ErrorMessage = ""The requested application does not exist."";
    return applicationViewModel;
  }

  // More code here that checks things which might set the ErrorMessage property...

  var application = _applicationServices.GetApplicationByGuid((Guid)guid);
  Mapper.Map(grantApplication, grantApplicationViewModel);
  return grantApplicationViewModel;
}
</code></pre>

<p><strong>Snippit from Application.cshtml View for Error Handling:</strong></p>

<pre><code>@model MyApp.Web.Areas.Application.Models.ApplicationViewModel
if (Model.ErrorMessage != null)
{
  &lt;div&gt;@Model.ErrorMessage&lt;/div&gt;
}
else
{
  &lt;!-- Display ""normal"" content here //&gt;
}
</code></pre>
","<asp.net-mvc><design-patterns><error-handling><refactoring><controller>","1","64","2012-03-22 18:13:31"
"9831549","What anti/pattern involves repeatedly passing around the same parameters?","<p>So let's say I have some code...</p>

<pre><code>House = function () { /* constructor */ }

House.childPlay  (childId) { ... }
House.childLearn (childId) { ... }
House.childEat   (childId) { ... }
</code></pre>

<p>So, implicitly, this House object ""has"" children, but it doesn't necessarily have Child objects, yet. Which is what I'm wondering. That constant passing around of childId seems fishy. Should House just <strong>Have</strong> a collection of Child objects?</p>

<pre><code>House.Child.play  () { ... }
House.Child.learn () { ... }
House.Child.eat   () { ... }
</code></pre>

<p>My only concern is that some of the operations sit in between the House and Child, like they interact. So, the Child object would need some sort of awareness of the parent object.</p>

<pre><code>House.Child.clean () {
    self._cleaningStrategy( self.house._provideMop() );
}
</code></pre>

<p>I see there's a design pattern called the Parameter Object. Is that this? I think it would be if I was passing a tuple's worth of parameters, but here I'm only passing around one.</p>
","<oop><design-patterns><language-agnostic><parameters><refactoring>","0","98","2012-03-22 22:32:50"
"9841345","How can I remove shared variables from legacy code","<p>In the system there is a singleton for currently logged user (our own user not windows user) containing a shared instance. </p>

<p>In a few hundred data access class files this is used to set CreatebyID and EditbyID for each request sent to the database. Nearly all the classes inherit a single base although at the moment the two values are set in each class.</p>

<p>This all worked fine for the companies desktop applications for many years however when the same data access classes were used in a new web application the currently logged user was shared across all users sessions and could not be changed without causing issues.</p>

<p>How can I refactor the code without significantly re-writing the whole DAL and without passing in a current user (or User ID) into every instance or setting an EditbyID property on each class for every save.</p>
","<c#><.net><refactoring><data-access-layer><legacy-code>","3","70","2012-03-23 14:52:36"
"9841602","How to refactor test code together with production code?","<p>Suppose you start with an auto-generated method</p>

<pre><code>public void setKey(Key key) {
    this.key = key;
}
</code></pre>

<p>And write a test for it</p>

<pre><code>@Test
public void testSetKey() 
</code></pre>

<p>Then 3 month from now you decide that a more appropriate name for the method would be  <code>changeKeyTo</code>. You refactor your production code and end up with:</p>

<pre><code>public void changeKeyTo(Key key) {
    this.key = key;
}
</code></pre>

<p>Life is good, however, your test name remained unchanged</p>

<pre><code>@Test
public void testSetKey() 
</code></pre>

<p><strong>How do you deal with something like this? Can you refactor test code automatically with your production code? Does eclipse allow this?</strong></p>
","<java><eclipse><junit><refactoring>","4","61","2012-03-23 15:08:07"
"9843922","Layout refactoring","<p>I can't help but thing there is a better way of coding the below in a Rails layout. Any suggestions?</p>

<pre><code>&lt;% if remove_ads_from_page? %&gt;
   &lt;div class=""main-content without-ads""&gt;
    &lt;%= yield %&gt;    
   &lt;/div&gt;
&lt;% else %&gt;
   &lt;div class=""main-content with-ads""&gt;
    &lt;%= yield %&gt;
   &lt;/div&gt;
&lt;% end %&gt;
</code></pre>
","<ruby-on-rails><ruby-on-rails-3><layout><refactoring>","2","26","2012-03-23 17:37:23"
"9853010","Invoke Eclipse's Move Class Refactoring in java","<p>I'm developing an eclipse plug-in.</p>

<p>I have to move a class from its package to another package, I would like to use the ""move class"" functionality built-in eclipse. </p>

<p>How can I invoke through java code? Which library and which methods?</p>

<p>Thanks!</p>
","<java><eclipse><class><refactoring><move>","0","66","2012-03-24 15:42:51"
"9854313","How can I avoid duplicate GUI code","<p>I have a Java application that will contain many plugins all with some similar GUI but I'm finding it difficult to figure out how to create a general GUI for all the plugins to avoid code duplication.</p>

<p>All plugin will have dialogs for adding new item, import and export items, but the dialogs will have different label text and gui component for each plugin.</p>

<p>How can I solve this?</p>
","<java><gui><refactoring>","0","62","2012-03-24 18:27:56"
"9868030","Is there any elegant way to prevent a class from holding private data?","<p>In a recent code refactor, I'm fulfilling an idea that isolates data handling from data itself. It's something like Chain-of-responsibility - processing units providing the ability to handle the data within a particular business scope while data object being passed on through the whole processing chain.</p>

<p>A further optimization is done by ""singletonizing"" the processing chain instance. Considering potential concurrence problem, eliminating any private data reference in these processing units is desired.</p>

<p>So, I wonder if there is some programming paradigm which can suggest other programmers conform this pattern while they are doing modification in the future.</p>

<p>Thanks in advance~</p>
","<design-patterns><architecture><refactoring><programming-paradigms>","0","53","2012-03-26 07:13:13"
"9869723","Java - Is calling the get method of an object slower than using a local object?","<p>I have a variable that I'm using many times in a class and as speed is important I would like to use the fastest method.</p>

<p>Is there a difference in speed between using:</p>

<pre><code>modifyValue(User.getSession().getSessionValue());
</code></pre>

<p>and setting the info to a local value such as</p>

<pre><code>private String sessionValue;
sessionValue = User.getSession().getSessionValue();
modifyValue(sessionValue);
</code></pre>

<p>when using the variable in several different places?  Which is better style, or clearer to understand?  If the above example is currently being used in existing code is it worth the time to refactor?</p>
","<java><refactoring>","2","88","2012-03-26 09:34:19"
"9889442","MoveResourceDescriptor updateReferences","<p>I must move a resource (ICompilationUnit) in other package, I use MoveResourceDescriptor in this way:</p>

<pre><code>MoveResourcesDescriptor descriptor = new MoveResourcesDescriptor();
descriptor.setUpdateReferences(true);
descriptor.setDestination(container);
descriptor.setResourcesToMove(resources);
descriptor.setResourcePathsToMove(pathResource);
descriptor.setDestinationPath(pathDestination);

Refactoring refactoring = descriptor.createRefactoring(new RefactoringStatus());
refactoring.checkAllConditions(pm);
Change change = refactoring.createChange(pm);
change.perform(pm);
</code></pre>

<p>This code move resource, but not update references!! Why?</p>
","<java><eclipse><resources><refactoring><move>","0","15","2012-03-27 12:21:03"
"9905263","Asp.Net4 Javascript/jquery Minification Error","<p>I realize this might be stupid, and its probably caused by my lack of javascript/jquery knowledge (in terms of re-factoring etc..)</p>

<p><strong>I'm rendering a JQGrid component on my page like this.</strong></p>

<pre><code>&lt;script src=""@System.Web.Optimization.BundleTable.Bundles.ResolveBundleUrl(""~/JQGrid"")"" type=""text/javascript""&gt;&lt;/script&gt;
&lt;script type=""text/javascript""&gt;

    var colNames = ['S ID', 'Shift Description'];
    var colModel = [
            { name: 'S_ID', index: 'S_ID', key: true, width: 55, editable: false, hidden: true, search: false },
            { name: 'Shift_Description', index: 'Shift_Description', width: 100, align: ""right"", editable: true, editrules: { required: true }, formoptions: { rowpos: 1, colpos: 1}}];

    RenderJQGrid(""#theGrid"", '#pager', '@ViewBag.Title', 600, colNames, colModel, 'S_ID', null, null, null, '@Url.Action(""GridData"")', '@Url.Action(""Add"")', '@Url.Action(""Edit"")', '@Url.Action(""Delete"")', '@Url.Action(""ExportToExcel"")');

&lt;/script&gt;
</code></pre>

<p><strong>Inside my .js file, I only have this. (it's also the only file in the bundle)</strong></p>

<pre><code>function RenderJQGrid(GridID, PagerID, Title, ModalWidth, ColNames, ColModel, InitSortCol, OnLoadComplete, EditBeforeShowOptions, AddBeforeShowOptions, URL_get, URL_add, URL_edit, URL_delete, URL_excel) {

   ... Logic
}
</code></pre>

<p><strong>I'm receiving this error in fiddler though.</strong></p>

<blockquote>
  <p>/* Minification failed. Returning unminified contents. </p>
  
  <p>(1,10): run-time error CSS1031: Expected selector, found
  'RenderJQGrid('</p>
  
  <p>(1,10): run-time error CSS1025: Expected comma or open brace, found
  'RenderJQGrid('  </p>
  
  <p>*/</p>
</blockquote>

<p>what am i doing wrong/missing? the code seemed fine when it was embedded inside my html page?</p>
","<javascript><jquery><refactoring><asp.net-mvc-4>","1","109","2012-03-28 10:06:12"
"9907699","What risks/issues have you encountered when refactoring Winforms to an MVP pattern?","<p>I recently joined a team that inherited a Winforms app that was coded like a VB6 app (if you've seen it you know what I mean.)  I have been asked to improve the codebase to bring it inline with general principles of engineering - testable, separation of concerns, patterns, basic stuff.  The application is absolutely mission critical, under active ehancement, but is not unit-testable and is going to need a large amount refactoring, and currently QA testing is all manual and is not comprehensive.  Further, the team are more SQL engineers than C#, so there is the added wrinkle of needing to teach basic C# practices.</p>

<p>Since I'm sure I'm not the first person to encounter this, I am interested in real world lessons.  When you did it, what was the one thing do you feel you did exactly right, or alternatively what was the one thing you looked back and said ""If I had only known...""?  </p>
","<c#><refactoring>","0","31","2012-03-28 12:40:35"
"9913994","Sort and remove (unused) using statements Roslyn script/code?","<p>Sort and remove (unused) using statements Roslyn script/code?  I'm looking for some .NET/Roslyn (compiler as service) code that can run through a project and sort and remove unused using statements.  I believe this is possible with Roslyn?  Can anyone point me to code that could do this rewrite?</p>
","<compiler><refactoring><roslyn>","1","75","2012-03-28 19:00:54"
"9914408","When to use a new variable vs string interpolation?","<p>I wrote a script that I decided to refactor so I could add functionality to it as my coworkers think of it. I only saved four lines in the effort, but the main change is I removed both methods and reduced the number of called variables in favor of string interpolation/manipulation. Is there a preference for this? Is it better to declare a new variable just to use once, or is it more DRY to just make minor tweaks to the string when you need to use it? For example here is the original code:</p>

<pre><code>def validate_directory(dir)
    puts ""Enter the full directory path of the flv files."" unless dir
    input =  dir || gets.chomp
    input.gsub!('\\', '/')
    input += '/' unless input[-1..-1] == '/'
    until File.directory?(input) &amp;&amp; Dir.glob(""#{input}*.flv"") != []
        puts ""That directory either doesn't exist or contains no .flv files. \nEnter the full directory path of the flv files.""
        input = $stdin.gets.chomp
        input.gsub!('\\', '/')
        input += '/' unless input[-1..-1] == '/'
    end
    dir = input
end

def output(flv, location)
    title = flv.dup.gsub!("".flv"", "".html"")
    vid = flv.dup
    vid.slice!(0..6)
    body = $EMBED.gsub(""sample.flv"", vid) 
    htmlOutput = File.open(title, ""w"")
        htmlOutput.write(body)
    htmlOutput.close
    linkList = File.open(""#{location}List of Links.txt"", ""a"")
        linkList.write($BASE + vid.gsub("".flv"", "".html"") + ""\n"")
    linkList.close
    puts ""Files created successfully.""
end

dir = ARGV[0].dup unless ARGV.empty?        
folder = validate_directory(dir)            
files = folder.clone + ""*.flv""              
flvs = Dir.glob(""#{files}"") 
File.delete(""#{folder}List of Links.txt"") if File.exists?(""#{folder}List of Links.txt"")
flvs.each { |flv| output(flv, folder) }
</code></pre>

<p>And the new stuff:</p>

<pre><code>flash_folder = ARGV[0].dup unless ARGV.empty?

if !flash_folder
  puts ""Enter the full directory path of the flv files.""
  flash_folder = gets.chomp
end

flash_folder.gsub!('\\', '/')
flash_folder += '/' unless flash_folder[-1..-1] == '/'
until File.directory?(flash_folder) &amp;&amp; Dir.glob(""#{flash_folder}*.flv"") != []
  puts ""That directory either doesn't exist or contains no .flv files. \nEnter the full directory path of the flv files.""
  flash_folder = $stdin.gets.chomp
  flash_folder.gsub!('\\', '/')
  flash_folder += '/' unless flash_folder[-1..-1] == '/'
end

flash_files = Dir.glob(""#{flash_folder}*.flv"")

File.delete(""#{flash_folder}List of Links.txt"") if File.exists?(""#{flash_folder}List of Links.txt"")

flash_files.each do |flv|
  html_output = File.open(""#{flv.gsub("".flv"", "".html"")}"", ""w"")
    html_output.write(""#{embed_code.gsub(""sample.flv"", flv.slice(7..flv.length))}"")
  html_output.close
  link_list = File.open(""#{flash_folder}List of Links.txt"", ""a"")
    link_list.write(""#{flash_url}#{flv.slice(2..flv.length).gsub("".flv"", "".html"")}\n"")
  link_list.close
end

puts ""Finished.""
</code></pre>
","<ruby><coding-style><refactoring><dry><refactor-my-code>","0","61","2012-03-28 19:32:24"
"9915013","Automated ""fix"" for Java codebase with only generic `catch (Exception e)`","<p>I have a large codebase which has many, many instances of the </p>

<pre><code>try {
   // attempt to do something important
} catch (Exception e) {
   // do something lame
}
</code></pre>

<p>antipattern.  Roughly 700 instances.  I'm wondering if there is a tool (e.g., an IDE or something) that could magically, and in mass, replace all of these things with the next tier of specialized catch blocks.  Something that would apply mass-refactoring similar to IntelliJ's or Eclipse's <a href=""http://stackoverflow.com/questions/2583983/wrap-with-try-catch-in-intellij"">""wrap with try/catch""</a> in the manner shown below.   NOTE:  I'm not saying all 700 are known <code>IOException</code>s; this is just an example assuming the only exception type thrown in the specific case was an <code>IOException</code>). </p>

<p>The refactoring I'm seeking is something that does the same semantic analysis of the <code>try{}</code> block that IntelliJ/Eclipse does to provide that ""wrap with catch"" or ""add to throws clause"" quick-fixes:</p>

<pre><code>try {
   // attempt to do something important
   // where an IOException is thrown
} catch (IOException e) {
   // still do something lame
}
</code></pre>

<p>I understand that this doesn't ""fix"" the problem, but it saves a step-by-step manual bit of archaeology.</p>

<p>Ideas?</p>

<p>Related question on <a href=""http://stackoverflow.com/questions/2666057/is-there-a-way-to-make-eclipse-report-a-general-catch-exception-e-as-an-erro"">detecting general exception catch antipattern</a>.</p>
","<java><exception-handling><automated-refactoring>","1","116","2012-03-28 20:16:33"
"9924144","How to refactor a big function with many if constructs?","<p>We have App A as main app. Now we build from it App B which uses a subset of App A's functionality.</p>

<p>App A stays like it is whereas app B only uses a subset of A</p>

<p>So I want to refactor the function without or with as little dublication as possible and with maximum readability. </p>

<p>So the function looks like this (it is actually longer, this is an excerpt):</p>

<pre><code>  class SomeClass {

    Data prepareData() {

     if (this.bothId==1 || this.appAid=2 /*or only relevant for appA*/) {       
        if(this.data==null) { /*appA*/
            appAdoSmth(); /*appA*/
        }
        boolean merge=false; /*appA*/
        if (this.data==null) { /*appA*/
          merge=appAanalyze(data); /*appA*/
        }
        bothPrepare(merge); 
    } else if (bothIsRelevant()) {
      if(appArelevant()) { /*appA*/
        data=appAprepare(); /*appA*/
      } else {
        data=prepareBoth(); 
      }     
      bothUpdateSomeValue();
    }

  }
</code></pre>

<p>How would you do it?</p>
","<java><if-statement><refactoring><dry>","1","76","2012-03-29 11:08:22"
"9936569","Code Quality - prefer quantitative measures over qualitative guidelines?","<p>Over the years in many code reviews, I opted for the quantitative code quality measures over qualitative guidelines. For example, rewrite the code if Cyclomatic complexity <a href=""http://en.wikipedia.org/wiki/Cyclomatic_complexity"" rel=""nofollow"">cc</a> is greater than 50 measured via VS2010 / Analyze / Calculate Code Matrix. </p>

<p>I am including a list of some top 7 measures  – wondering if I can get feedback on this approach and suggestions on other practical code quality measures used in the distributed development environment </p>

<ol>
<li><p>Measure Cyclomatic complexity</p>

<p>a.If CC >50 : rewrite the code 
   b.CC between 20 and 50 – refactor </p></li>
<li><p>Measure  COB [class coupling] - COB > 14 : refactor</p></li>
<li><p>Depth of Inheritance &lt; 4 is acceptable, above 4 – review and if required refactor</p></li>
<li><p>Maintainability score should be between 20 and 100. Between 10 and 20 –refactor and less than      10 –rewrite the code</p></li>
<li><p>Limit a class to 10 public / protected methods and 250-300 lines of code [average]</p></li>
<li><p>Restrict each method to 150-180 lines max and 5 input parameters at max</p></li>
<li><p>Prefer internal refactoring [rearranging the code] over external refactoring [breaking a class /method into multiple] wherever possible</p></li>
</ol>

<p>Please note that I have excluded topics like unit testing, test automation, continuous integration, agile from this post to maintain the focus [although these best practices are integral part of the quality code initiative]</p>

<p>Reference:
 <a href=""http://en.wikipedia.org/wiki/Cyclomatic_complexity"" rel=""nofollow"">Cyclomatic Complexity</a>
 <a href=""http://msdn.microsoft.com/en-us/library/bb385914.aspx"" rel=""nofollow"">MSDN :Code Metrics Values</a></p>
","<refactoring><code-quality><maintainability><cyclomatic-complexity>","4","90","2012-03-30 03:19:43"
"9941761","Debugger: no symbols have been loaded after renaming namespace","<p>I've got a Silverlight application with one Silverlight project and a host web project.</p>

<p>I renamed the namespace of the Silverlight application where the App.xaml is in. I did this via a refactoring tool. Afterwards the debugger just ignored the breakpoints. It's popping out the error shown in the title of this thread.</p>

<p>So I thought that maybe the refactoring tool fails, so I recovered the project with the old namespace in and renamed everything by hand (find in files). The app works, still, but I get the same error.</p>

<p>What the heck is this?</p>
","<c#><silverlight><refactoring>","0","69","2012-03-30 11:06:23"
"9944524","How to best follow a function to understand what it is doing?","<p>This question is general but I am going to give a specific example.</p>

<p>The specific problem that needs to be solved is explained <a href=""http://codeforces.com/contest/156/problem/A"" rel=""nofollow"">here</a>. The description is long so I will not cut and paste but the basic idea is for input strings S and T (as they are called in the code below), find the minimum number of changes that needs to be done to S to produce T. One change can be :</p>

<ul>
<li>Insert one letter to any end of the string.</li>
<li>Delete one letter from any end of the string.</li>
<li>Change one letter into any other one.</li>
</ul>

<p>Below is a solution I am trying to track. What I am looking for are tips on how to best grok the solution. What are some methods I can use to read and understand the code (let's discard stepping through a debugger).</p>

<pre><code>#include&lt;iostream&gt;
#include&lt;cstring&gt;
#include&lt;stdio.h&gt;
using namespace std;
char S[2010];
char T[2010];
int lens,lent;
int main()
{
    int i,j,ma,p;

    while(scanf(""%s%s"",S,T)!=EOF)
    {
        lens=strlen(S);
        lent=strlen(T);
        ma=0;p=0;
        for(i=0;i&lt;lens;i++)
        {
            p=0;
            for(j=0;j&lt;lent;j++)
            {
                if(i+j&gt;=lens)
                    break;
                if(S[i+j]==T[j]){p++;}
            }
            if(ma&lt;p)
                ma=p;
            if(ma==lent)
                break;
        }
        for(i=0;i&lt;lent;i++)
        {
            p=0;
            for(j=0;j&lt;lens;j++)
            {
                if(i+j&gt;=lent)
                    break;
                if(T[i+j]==S[j]){p++;}
            }
            if(ma&lt;p)
                ma=p;
            if(ma==lent)
                break;
        }
        printf(""%d\n"",lent-ma);
    }
    return 0;
}
</code></pre>
","<c++><algorithm><refactoring><pseudocode>","2","105","2012-03-30 14:04:43"
"9949406","Best way to do this generic abstract class in c#?","<p>I know I'm not doing this right, but I also know there is a way to do this. I'm trying to be as generic and abstract as possible, otherwise my code is going to get real messy. So I'm using strategy pattern here as hell which is the GetAggregateClient() method.</p>

<p>I want to have an abstract class called AbstractAggregate, so that it uses generics. The type that will be used are a series of data classes which are BlogItem, ResourceItem, and AskItem. These data classes all inherit from ListItem.</p>

<p>So that's the background info. The problem here is that I want GetAbstractAggregate() to return an instance of one of the client classes that implements AbstractAggregate with the type of item specified depending on the enum passed in. However, I cannot return an ""AbstractAggregate"". Compiler won't let me and that makes sense since since the AbstractAggregateFactory class is not a generic.</p>

<p>Does anyone have the best way to do this?</p>

<p>Thanks a lot.</p>

<pre><code>public static class AggregateHelper
{
    public enum AggregateTypes { TankTruckBlog, AskTankTruck, Resources }
}

public static class AbstractAggregateFactory
{
    public static AbstractAggregate&lt;T&gt; GetAggregateClient(AggregateHelper.AggregateTypes type)
    {
        switch (type)
        {
            case AggregateHelper.AggregateTypes.AskTankTruck:
                return new AskTankTruckAggregate&lt;AskItem&gt;();
            case AggregateHelper.AggregateTypes.TankTruckBlog:
                return new TankTruckBlogAggregate&lt;BlogItem&gt;();
            case AggregateHelper.AggregateTypes.Resources:
                return new ResourcesAggregate&lt;ResourceItem&gt;();
            default:
                throw new AggregateDoesNotExistException();
        }
    }
}

public abstract class AbstractAggregate&lt;T&gt;
{
    public abstract List&lt;T&gt; GetAggregate(Guid[] resourcetypes);

    public abstract T GetSingle(string friendlyname);


}

public class AskTankTruckAggregate&lt;T&gt; : AbstractAggregate&lt;T&gt;
{
    //not implemented yet
}

public class TankTruckBlogAggregate&lt;T&gt; : AbstractAggregate&lt;T&gt;
{
    //not implemented yet
}

public class ResourcesAggregate&lt;T&gt; : AbstractAggregate&lt;T&gt;
{
    //not implemented yet
}
</code></pre>
","<c#><generics><refactoring><abstract-class><strategy-pattern>","4","217","2012-03-30 19:36:58"
"9959018","How to identify where an identifier is defined to refactor in delphi 7?","<p>I am trying to refactor some delphi 7 code. One of the procedures I'd like to move uses a data type called TLVColumn (appears to be a TListView column header). However, if I move the method, I get an undeclared identifier error, presumedly because I didn't copy the import which defines TLVColumn to the new unit. The unit I'm moving this method from has over 7000 lines of code and over 50 uses classes listed. Is there any more efficient way than trial and error of copying random imports to identify which import is required for a particular class? (especially imports that are from Delphi libraries and not from my own codebase...)</p>
","<delphi><refactoring><delphi-7>","3","78","2012-03-31 19:33:50"
"9963358","Refactor Objective C property access from . syntax to [ ] syntax","<p>Is there a way to refactor property access code from <code>.</code> syntax to <code>[ ]</code> syntax in XCode 4? </p>

<p>For example:</p>

<pre><code>myController.someProperty = someObject;
</code></pre>

<p>to</p>

<pre><code>[myController setSomeProperty: someObject];
</code></pre>
","<objective-c><xcode><refactoring>","2","84","2012-04-01 09:32:31"
"9966932","Refactoring RSpec code","<p>I am using Ruby on Rails 3.2.2 and rspec-rails-2.8.1. I am testing a view file and I would like to refactoring the following code but I don't know how to make that.</p>

<pre><code>module UserExampleHelpers
  def build_css_scope(user)
    ""div#user_#{user.id}""
  end
end

shared_examples_for ""any user view"" do
  it 'has the user CSS id' do
    rendered.should have_css(css_scope)
  end
end


describe 'users/show.html.erb' do
  include UserExampleHelpers

  context 'Context name 1' do
    let(:css_scope) {build_css_scope(@user)}

    it_should_behave_like ""any user view""

    it ""..."" do
      ...
    end
  end

  context 'Context name 2' do
    let(:css_scope) {build_css_scope(@user)}

    it_should_behave_like ""any user view""

    it ""..."" do
      ...
    end
  end
end
</code></pre>

<p><strong>How can I refactor the above code? Can you give me some help?</strong></p>

<p><em>Note</em>: Known issues are</p>

<ul>
<li>I know that my approach of running the <code>let(:css_scope)</code> in order to state a CSS <code>id</code> value used throughout all the spec file is not made the right way, but I don't know how to proceed so to properly make that.</li>
<li>Maybe I should pass the CSS <code>id</code> value to the <code>shared_examples_for ""any user view""</code> method using something like <code>it_should_behave_like ""any user view"", css_scope</code>. Anyway, If I use that code I get the error: ""<code>... undefined method</code>build_css_scope' for # (NoMethodError)`"".</li>
</ul>
","<ruby-on-rails><ruby><ruby-on-rails-3><rspec><refactoring>","1","71","2012-04-01 18:15:36"
"9978067","How can I quickly create a class in the right place when following TDD using Visual Studio/ReSharper?","<p>Suppose I'm following TDD and using VS/ReSharper. I start out writing a test like this:</p>

<pre><code>[TestFixture]
class FooFixture
{
    [Test]
    public void ShouldDoSomething()
    {
        var foo = new Foo();
    } 
}
</code></pre>

<p>At this point, <code>Foo</code> doesn't exist. ReSharper suggests the option of creating the class, but it puts it right next to my test class in my test project, not in my real project. So I have it create the class, then move it to a new file, then move the file to the right place, and finally fix the namespace. This seems like a lot of work. </p>

<p>Is there a more efficient way to quickly create the <code>Foo</code> class and put it in the right place? It seems like the 'right place' could be guessed from the namespace of my test project. </p>
","<visual-studio><refactoring><tdd><resharper>","4","56","2012-04-02 14:13:35"
"9978099","PHP Depend code metrics analysis","<p>I am trying to compare two PHP projects using PHP Depend (http://pdepend.org). One is a page-based PHP application written by a group of students a year ago and the second is mine that I have worked on for the past year. The objective is  to provide some quantitative statistics that might help validate that refactoring the project (introducing a MVC architecture and lots of refactoring to better apply OO principles) has led to lower complexity and coupling, among others. </p>

<p>The problem I am facing is that when analyzing the older project, PHP depend ignores the files that were written in a procedural programming style. It only picks up those files that have classes defined. I am not sure why the previous students chose to have this hybrid style of writing code but they did. </p>

<p>Is this how PHP Depend works or is there some setting I can use so that it analyzes all files. The site offers little help. If PHP Depend can only analyze files with defined classes and methods, how can I generate some code metrics to validate my project?</p>
","<php><refactoring><code-metrics><pdepend>","0","83","2012-04-02 14:15:18"
"10008696","Refactor sql query from source code","<p>I have a method which contains a very big sql query directly in the .CS file. What would the recommended refactoring method be? </p>
","<c#><.net><sql><refactoring>","0","64","2012-04-04 09:47:13"
"10017703","Avoiding use of 'instanceof'","<p>I'm struggling with how I might avoid using instanceof() in some of my code.  This contrived example somewhat captures the problem.</p>

<pre><code>Class Meat extends Food;

Class Plant extends Food;

Class Animal;

Class Herbivore extends Animal
{
    void eat( Plant food);
}

Class Carnivore extends Animal
{
    void eat( Meat food);
}

Class Omnivore extends Animal
{
    void eat(Food food);
}

Class Zoo
{
    List&lt;Animals&gt; animals;

    void receiveFood( Food food)
    {
        // only feed Plants to Herbivores and Meat to Carnivores
        // feed either to Omnivores
    }
}
</code></pre>

<p>Herbivores are only interested in Plants, Carnivores only in Meat and Omnivores both.  When the Zoo receives Food it only makes sense to try to feed food to animals that eat that type of food.  </p>

<p>I've thought of a few solutions, but all seem to depend on the use of <code>instanceof()</code> somewhere and my various refactorings just seem to move it around.</p>

<p>(1) I could implement <code>eat( Food food)</code> in Animal and each subclass could choose to ignore food that it doesn't eat, but that is inefficient and would require that each Animal subclass use <code>instanceof()</code> to test the type of food.</p>

<p>(2) I could keep three collections of animals in the Zoo based on the type of food they eat, but would still have to use <code>instanceOf()</code> to test the type of food to see which collection to feed it to.  At least this would be more efficient as I wouldn't be feeding food to Animals that won't eat it.</p>

<p>I've thought of some other approaches, but again, they just seem to pass the <code>instanceof()</code> buck.</p>

<p>Any suggestions?  Or would this (2, at least) be an acceptable use of <code>instanceof()</code>?</p>
","<java><oop><design-patterns><refactoring><polymorphism>","9","273","2012-04-04 19:11:20"
"10019100","Adding and removing multiple references across projects in Visual Studio","<p>I have a huge project with over 50 or 60 csproj files. I need to remove 6 or 7 references exiting references and add 10 or 15 new references across all these projects. Is there a  mechansim to bulk add references and remove references?</p>

<p>Or if there is a way to say, replace reference X with Y across all projects, that would be very helpful too. Let me add that Nuget is not an option.</p>
","<visual-studio><visual-studio-2010><refactoring><resharper>","1","26","2012-04-04 20:55:29"
"10025673","Move refactoring programmatically","<p>I have to do an eclipse plug-in.
I need to recall eclipse's move class refactoring and eclipse's move method refactoring programmatically.
Can someone help me?
Thanks </p>
","<java><eclipse><eclipse-plugin><refactoring><eclipse-plugin-dev>","0","52","2012-04-05 09:03:34"
"10028701","Visual Studio Refactoring: Changing the workspace hierarchy","<p>Working in Visual Studio 2010, I often end up with needing to move a namespace (and classes) ""up a level"" or ""down a level"", for example:</p>

<p>I want all classes within:
    namespace MyProject.Models.ViewModels.Forms </p>

<p>to move to
    namespace MyProject.ViewModels.Forms</p>

<p>effectively moving the ViewModels namespace up to the top level.  </p>

<p>This occurs in many different variations, due to constant project reorganization and improvement.  However, every time I do this I am faced with a long manual task of finding/replacing all the namespace references, including the various <code>using...</code> clauses, direct references etc.</p>

<p>Is there any tool within Visual Studio or a plugin available that will do this work for you?</p>
","<c#><visual-studio-2010><refactoring>","0","50","2012-04-05 12:35:07"
"10024625","Javascript countdown settimeout","<p>im trying to make a simple javascript countdown timer which changes the value from 3 to 1 in the button every one second interval. I got the code working but it uses many functions. I was wondering if i could make it using less. ive tried to put the countdown in a for loop which displays the i value but it doesn't seem to work properly.</p>

<p>Heres my code:</p>

<pre><code> function launch( )
{
  document.getElementById(""blast"").value = ""Preparing to launch..."";
  setTimeout ( ""countdown3()"", 1000 );
}
function countdown3()
{
    document.getElementById(""blast"").value = ""3"";
    setTimeout(""countdown2()"", 1000);
}
function countdown2()
{
    document.getElementById(""blast"").value = ""2"";
    setTimeout(""countdown1()"", 1000);
}

function countdown1()
{
document.getElementById(""blast"").value = ""1"";
setTimeout(""GO()"", 1000 );
}
function GO()
{
    document.getElementById(""blast"").value = ""BLAST OFF"";
    move();
}
</code></pre>
","<javascript><refactoring><settimeout>","2","148","2012-04-05 07:49:34"
"10030480","How do I refactor a class with lots of operations which all require its internal data?","<h2>My Problem</h2>

<p>I have a class with just a few fields but which represents a relatively complicated data structure. This class is central in my program and over time I found myself adding more and more functionality into it, making things a mess. Since (almost) all of its methods rely on its internal fields, I could not think of a way to move some of the methods elsewhere, even though most methods are independent of each other. <strong>How can I refactor this class to make it simpler and reduce the number of methods which are directly implemented in it?</strong></p>

<h2>More Information</h2>

<p>The class in question represents a sort of automaton. It supports a ton of operations such as retrieving information about it, performing various binary operations between it and other automata, querying for specific information stored inside it, saving it to file, etc. Almost all of these operations depend on the precise implementation of the class - in my specific case I maintain an edge-set-based implementation, but other implementations were also used in the past and might be used again in the future.</p>

<p>Except for a narrow set of basic helper methods which are commonly used, most methods are independent of each other.</p>

<p>The language I am using is Java, but I'm hoping for general answers which could be applied to any statically-typed, object-oriented language.</p>

<h2>What I've Tried</h2>

<p>I tried refactoring it somehow to multiple types, but each of its operations require access to most of its fields, and I'm hesitant about migrating these operations elsewhere because I can't think of a way to do that without exposing the class's implementation.</p>

<p>I'm also not sure <em>where</em> I should migrate the operations to, assuming they are indeed independent of the implementation. An external utility class? An abstract base type? Will appreciate any input about this.</p>
","<oop><refactoring>","1","30","2012-04-05 14:24:55"
"10035796","C# refactor if-else statement code","<p>Please check out my following code...</p>

<pre><code>public enum LogType
{
    Debug,
    Info,
    Warn,
    Error,
    Fatal
}

private static readonly ILog log = 
log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);

public void LogError(LogType logtype, string message)
{
    XmlConfigurator.Configure();
    if (logtype == LogType.Debug)
        log.Debug(message);
    else if (logtype == LogType.Error)
        log.Error(message);
}
</code></pre>

<p>I do not like all the above if-else statements and believe that there is a cleaner way to write this. How could I refactor it? log class has different methods for Debug, Error etc. etc. </p>

<p>I would like to make a single call to a method have it automatically take care of it. </p>

<pre><code>LogMyError(LogType.Debug, ""I am just logging here"");
</code></pre>

<p>How can I do such a thing? I prefer to stay away from switch statement. I am looking for a clean object oriented approach.</p>
","<c#><refactoring>","5","456","2012-04-05 20:48:39"
"10033259","Use jQuery Mobile 1.0.1 with jQuery 1.7.2","<p>I'm on the process of refactoring a web application developed in jQuery Mobile. The task consists  in divide a single html file that contains several <code>data-role=""page""</code> to multiple html files. </p>

<p>The pages will be loaded to <code>data-role=""content""</code> through AJAX. The problem is that all attached events will now have to be <code>live()</code> / <code>delegate()</code> / <code>on()</code> instead of <code>bind()</code>. </p>

<p>The stable version of jQueryMobile is 1.0.1 and the  jQuery core recomended the for this version is 1.6.4, which means that <code>on()</code> is not available.</p>

<p>My question is: how safe is to use jQuery Mobile 1.0.1 along with jQuery 1.7.2?</p>
","<javascript><jquery><ajax><jquery-mobile><refactoring>","0","211","2012-04-05 17:37:12"
"10039210","C++ refactoring to add a namespace to all classes and functions?","<p>I have a C++ project with hundreds of files, and I need to enclose all its classes and functions in an additional namespace. Is there a tool that can do that automatically? </p>

<p>(There was a <a href=""http://stackoverflow.com/questions/3883380/namespace-refactoring-tool-for-eclipse"">similar question</a> before, but it was about Eclipse specifically and it's a year old, so maybe there are some additional answers now?)</p>
","<c++><ide><refactoring>","0","71","2012-04-06 04:43:50"
"10044993","Proguard custom naming for classes, members and parameters obfuscation","<p>Is there a simple description of how the dictionary file in Proguard should be structured?</p>

<p>I've read about <code>-?obfuscationdictionary</code>, but I couldn't find anything about the files themselves.</p>

<p>Besides, I'd like to change the naming scheme to something more complex, and not just <code>a</code>, <code>b</code> etc. and <code>paramX</code>, <code>paramY</code>... I'd like a random series of characters, if possible.</p>

<p>And yes, I know it's just a visual difference that can be remodeled (refactored?) to something easier to read. Still, just asking...</p>

<p>Thanks</p>
","<java><dictionary><refactoring><obfuscation><proguard>","3","103","2012-04-06 14:38:10"
"10046674","Eclipse svn move/rename doesn't work on all-lowercase filenames?","<p>I am renaming a series of .js files using Refactor -> Rename.</p>

<p>They all work except when I rename a file to an all-lowercase name (i.e. rename <code>Calendar.js</code> to <code>calendar.js</code>). I get this error:</p>

<pre><code>move C:/Users/JohnDeer/workspace/MyApp/WebContent/scripts/ui/Calendar.js C:/Users/JohnDeer/workspace/MyApp/WebContent/scripts/ui/calendar.js
    Path is not a working copy directory
svn: Path 'C:\Users\JohnDeer\workspace\MyApp\WebContent\scripts\ui\calendar.js' is not a directory
</code></pre>

<p>I checked the ui folder and there is a .svn folder in it. Can anyone give some advice here? Thanks</p>
","<eclipse><svn><refactoring><move>","0","72","2012-04-06 17:04:17"
"10046334","How to factor out main method of Scala objects into a shared location?","<p>In several Scala objects I have defined a main method that invokes runTests which is an abstract method in Test. Is there a way for the main method to be factored out into a common location (Trait or other solution) so that I can still run the test in Eclipse by keying <kbd>ctrl</kbd>-<kbd>F11</kbd>?</p>

<p>This is what I have at present,</p>

<p><a href=""https://github.com/janekdb/stair-chess/blob/master/src/chess/model/BoardModelTest.scala"" rel=""nofollow"">https://github.com/janekdb/stair-chess/blob/master/src/chess/model/BoardModelTest.scala</a></p>

<pre><code>object BoardModelTest extends Test with TestUtils {

  def main(args: Array[String]) {
    runTests
  }

  def runTests {
  ...
</code></pre>

<p><a href=""https://github.com/janekdb/stair-chess/blob/master/src/test/Test.scala"" rel=""nofollow"">https://github.com/janekdb/stair-chess/blob/master/src/test/Test.scala</a></p>

<pre><code>trait Test {

  def runTests: Unit
  ...
</code></pre>
","<scala><refactoring><main>","3","85","2012-04-06 16:32:29"
"10049972","C++ : array of coordinates?","<p>I have a problem with my code. Actually it works, but I want to clean it to make it more proper.</p>

<p>So I have a class Coord which contains a float x and a float y.</p>

<p>The constructor is :</p>

<pre><code>void Coord::Coord (float x,float y)
{
this-&gt;x = x;
this-&gt;y = y;
}
</code></pre>

<p>I create all the points that I need in that way :</p>

<pre><code>Coord pt1(0,1);
Coord pt2(20,0);
...
Coord pt61(12,14); .... `
</code></pre>

<p>After I have to make an array of some points , for exemple
the fifth five points will be assigned in an array, 4 other points in another array, 2 other points in another one...</p>

<pre><code>Coord pts_weakhealth[3] = {pt1,pt2,pt3};
</code></pre>

<p>This array, I'll have to give as arguments for the constructor of a class
for example:</p>

<pre><code>Sef health(pts_weakhealth,3);
Sef strength(pts_weak,4);`
</code></pre>

<p>I'll create some Sef in the same way and then make an array of them</p>

<pre><code>Sef spec[2] = {health,strength};
</code></pre>

<p>and a class universe will contains some sef :</p>

<pre><code>Universe hlth(spec);
</code></pre>

<p>You can imagine that when I have a lot of points, a lot of sef, it's a lot of dirty code...</p>

<p>How can I improve that? to make my code better...</p>
","<c++><arrays><refactoring><code-cleanup>","0","138","2012-04-06 22:30:02"
"10050146","refactor this javascript code","<p>I have two click-events, that are nearly similar, but not quite. I am wondering how to refactor them best:</p>

<pre><code>  $('.remove_fields.dynamic').live('click', function(e) {
    var $this = $(this);
    var after_removal_trigger_node = $this.closest("".nested-fields"").parent();
    trigger_removal_callback($this);
    e.preventDefault();
    $this.closest("".nested-fields"").remove();
    trigger_after_removal_callback(after_removal_trigger_node);
  });

  $('.remove_fields.existing').live('click', function(e) {
    var $this = $(this);
    var after_removal_trigger_node = $this.closest("".nested-fields"").parent();
    trigger_removal_callback($this);
    e.preventDefault();
    $this.prev(""input[type=hidden]"").val(""1"");
    $this.closest("".nested-fields"").hide();
    trigger_after_removal_callback(after_removal_trigger_node);
  });
</code></pre>

<p>As you can tell there is a fair bit of overlap. I am wondering what the best/nicest way would be to refactor this code.</p>
","<javascript><refactoring>","1","75","2012-04-06 22:54:42"
"10064455","clojure: idiomatic way of removing duplication in an ""if""?","<p>I'm very new to clojure, and I haven't done a ton of lisp previously. I have a function that contains the following:</p>

<pre><code>(defn chord 
    ([scale degree num_voices]
    (if 
        (keyword? degree)  
            (take num_voices (take-nth 2 (cycle (invert scale (.indexOf scale degree)))))
            (take num_voices (take-nth 2 (cycle (invert scale degree))))))
</code></pre>

<p>Obviously, this code is poor because having two almost-identical function calls here is suboptimal, where the only difference is <code>(.indexOf scale degree)</code> vs <code>degree</code>.</p>

<p>What's the Clojure/Lisp Way of removing this code duplication? I feel like it should involve a let, but I'm not positive. Any other general pointers related to this code block are also appreciated.</p>

<p><strong>Edit:</strong> I have re-factored the code according to andrew cooke's suggestion, the function now reads:</p>

<pre><code>(defn chord
    ([scale degree num_voices]
        (let [degree (if (keyword? degree) (.indexOf scale degree) degree)]
            (take num_voices (take-nth 2 (cycle (invert scale degree))))
        )
    )
</code></pre>

<p>Thanks to everyone who answered so quickly.</p>
","<clojure><refactoring><lisp>","4","142","2012-04-08 16:39:38"
"10079633","Using Naturalsorter gem at model in Rails","<p>I'm using the ""naturalsorter"" gem to sort an array of Items (ActiveRecord Objects) by code</p>

<p>On the controller: </p>

<pre><code>@items = Item.all
@items = Naturalsorter::Sorter.sort_version_by_method(@items, :code)
</code></pre>

<p>but i need to refactor this and put the sorting method on the model</p>

<p>Hi! I've tried:</p>

<pre><code>class Item &lt; ActiveRecord::Base 
   def self.by_code
      Naturalsorter::Sorter.sort_version_by_method(self, 'code')
   end 
end
</code></pre>

<p>But I'm sure this is not the way... So i get </p>

<pre><code>undefined method `sort_by_code' for #&lt;Array:0x007ff0b4c431d0&gt;
</code></pre>

<p>Some idea? Thanks!</p>
","<ruby-on-rails><ruby><arrays><refactoring>","0","24","2012-04-09 20:46:24"
"10084867","How can i improve the readablility of nested if and for statements","<p>I have got a very nasty piece of code i would like to refactor but i've because its getting totaly unreadable.</p>

<pre><code> for region in feed['config']['regions']:
            if region['region'] == region_name:
                for instance_type in region['instanceTypes']:
                    if instance_type['type'] == instance_type_name:
                        for instance_size in instance_type['sizes']:
                            if instance_size['size'] == instance_size_name:
                                for platform in instance_size['valueColumns']:
                                    if platform['name'] == platform_name:
                                        prices = platform['prices']
                                        assert prices.keys() == ['USD']
                                        return decimal.Decimal(prices['USD'])
        assert False, ""Failed to determine price for instance with region=%r, type=%r, size=%r, platform=%r"" % \
                (region_name, instance_type_name, instance_size_name, platform_name)
</code></pre>

<p>I've tought about using functions with each loop or if statement but that will give me a load of functions. 
Are there beter solutions?</p>
","<python><for-loop><refactoring>","0","101","2012-04-10 07:34:12"
"10102610","C++ refactoring: conditional expansion and block elimination","<p>I'm in the process of refactoring a very large amount of code, mostly C++, to remove a number of temporary configuration checks which have become permanantly set to given values. So for example, I would have the following code:</p>

<pre><code>#include &lt;value1.h&gt;
#include &lt;value2.h&gt;
#include &lt;value3.h&gt;

...

if ( value1() )
{
    // do something
}

bool b = value2();

if ( b &amp;&amp; anotherCondition )
{
    // do more stuff
}

if ( value3() &lt; 10 )
{
    // more stuff again
}
</code></pre>

<p>where the calls to value return either a bool or an int. Since I know the values that these calls always return, I've done some regex substitution to expand the calls to their normal values:</p>

<pre><code>// where:
//   value1() == true
//   value2() == false
//   value3() == 4

// TODO: Remove expanded config (value1)
if ( true )
{
    // do something
}

// TODO: Remove expanded config (value2)
bool b = false;

if ( b &amp;&amp; anotherCondition )
{
    // do more stuff
}

// TODO: Remove expanded config (value3)
if ( 4 &lt; 10 )
{
    // more stuff again
}
</code></pre>

<p>Note that although the values are fixed, they are not set at compile time but are read from shared memory so the compiler is not currently optimising anything away behind the scenes.</p>

<p>Although the resultant code looks a bit goofy, this regex approach achieves a lot of what I want since it's simple to apply and removes dependence on the calls, while not changing the behaviour of the code and it's also likely that the compiler may then optimise a lot of it out knowing that a block can never be called or a check will always return true. It also makes it reasonably easy (especially when diffing against version control) to see what has changed and take the final step of cleaning it up so the code above code eventually looks as follows:</p>

<pre><code>// do something

// DONT do more stuff (b being false always prevented this)

// more stuff again
</code></pre>

<p>The trouble is that I have hundreds (possibly thousands) of changes to make to get from the second, correct but goofy, stage to get to the final cleaned code.</p>

<p>I wondered if anyone knew of a refactoring tool which might handle this or of any techniques I could apply. The main problem is that the C++ syntax makes full expansion or elimination quite difficult to achieve and there are many permutations to the code above. I feel I almost need a compiler to deal with the variation of syntax that I would need to cover.</p>

<p>I know there have been similar questions but I can't find any requirement quite like this and also wondered if any tools or procedures had emerged since they were asked?</p>
","<c++><refactoring><automated-refactoring>","4","127","2012-04-11 08:41:08"
"10121374","Referencing callee when refactoring in eclipse","<p>Let there be a method like this:</p>

<pre><code>public int a() {
   return 1 + b();
}
</code></pre>

<p>Is it possible to apply the ""Introduce parameter"" refactoring in eclipse on the expression <code>b()</code> such that the caller actually calls the method b on the callee? Like this:</p>

<pre><code>o.a()         // old
o.a( o.b() )  // new
</code></pre>

<p>When I do it, it basically copy&amp;pastes the string ""b()"" into the call which doesn't make sense of cause because this method is on the callee, not the caller. But maybe you know a trick?</p>

<p>Or, alternatively, is it possible to use the ""Change Method Signature"" refactoring and use an expression in the default value which references the callee? So that I could create a new parameter on <code>a()</code> and let it have a default value of something like <code>${this}.b()</code>?</p>
","<eclipse><refactoring>","1","31","2012-04-12 09:59:58"
"10122510","Factoring a logical expression containing bitwise operators AND and SHIFT","<p>I have a logical expression like this: (A &lt;&lt; k) &amp; (A &lt;&lt; l) where A is a variable and k, l are integers. I want to factorize this expression so that one part contains only A and the other part is anything without A. In other words:</p>

<p>(A &lt;&lt; k) &amp; (A &lt;&lt; l) = A op1 (anything not containing A)</p>

<p>Can anyone tell what is the operator op1 and the ""(anything not containing A)""? Or whether this is possible or not?</p>
","<refactoring><operators><logic><bitwise-operators>","1","20","2012-04-12 11:19:58"
"10127501","jQuery code refactoring of basic toggle functionality","<p>I'm very new to jQuery and this is my first post to Stack Overflow. </p>

<p>I'm writing up a Toggle script where if several (but not all) of the table cells are clicked, the script will toggle the visibility of the tr below it and perform a change class on a div within one of the cells to show a plus/minus icon. I'm hoping to simplify my script and HTML or get general pointers on how to make this better.</p>

<p>The jQuery is as follows:</p>

<pre><code>$(function() {

/************************************************************/
// Show/Hide functionality

   $('.showDetails', '#summaryTable').hide();

   $('#summaryTable').on('click', '.toggleIt', function(e){

   var $this = $(this).parents(""tr"");

   $this.next().toggle(0, function() {
        var rowExpand = $('.rowExpand', $this);
        rowExpand.toggleClass('rowContract');
     });
  });

/************************************************************/

});
</code></pre>

<p>The HTML is as follows:</p>

<pre><code>&lt;table id=""summaryTable""&gt;

&lt;thead&gt;
&lt;tr&gt;
...
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;

&lt;tr&gt;
&lt;td class=""toggleIt""&gt;&lt;div class=""rowExpand""&gt;Expand/Contract details&lt;/div&gt;&lt;/td&gt;
&lt;td class=""toggleIt""&gt;Content&lt;/td&gt;
&lt;td class=""toggleIt""&gt;Content&lt;/td&gt;
&lt;td&gt;*input field*&lt;/td&gt;
&lt;td class=""toggleIt""&gt;Content&lt;/td&gt;
&lt;td class=""toggleIt""&gt;Content&lt;/td&gt;
&lt;td&gt;*Trash can icon*&lt;/td&gt;
&lt;/tr&gt;

&lt;tr class=""showDetails""&gt;
&lt;td colspan=""7"" class=""expand""&gt;

   &lt;div&gt;
     Content to be shown when toggled...
   &lt;/div&gt;

&lt;/td&gt;
&lt;/tr&gt;

&lt;!-- Rinse and repeat --&gt;

&lt;/tbody&gt;

&lt;/table&gt;
</code></pre>

<p>Notice all those toggleIt classes on the cells where it's OK to click and have the tr expand? Seems like I should be able to instead place a class on only the table cells where I don't want the table to expand should the click. (The input field and trash can cells.)</p>

<p>Any thoughts or suggestions are welcome.
Thank you!</p>
","<jquery><refactoring><toggle>","2","43","2012-04-12 16:10:45"
"10124959","How do I join and display first_name with last_name?","<p>I am using devise and cancan with rails 3.2.1 and I'm having an unusual problem that I know can be refactored and simplified, but after much searching, I'm stuck.</p>

<p>I have first_name and last_name fields in the user model and have successfully displayed the full name of the user in the users/show.html.erb view using this code:</p>

<pre><code>&lt;%= @user.first_name + "" "" + @user.last_name %&gt;
</code></pre>

<p>And I was successfully displaying a link to the user's show page in the header using:</p>

<pre><code>&lt;% if user_signed_in? %&gt;
  &lt;li&gt;&lt;%= link_to @user.first_name + "" "" + @user.last_name, current_user %&gt;&lt;/li&gt;
&lt;% end %&gt;
</code></pre>

<p>But, and I can't figure this one out, after working on another part of the app, the header started giving me an undefined method error message...</p>

<p>In any case, I know there is a much better way to define and work with user names and I have tried some things out, such as adding a name method to the user model, but as you can clearly tell from this post, I am a beginner and have not been able to make that work.</p>

<p>Please let me know if you have any ideas on how to best work with users names in an application like this.</p>
","<ruby-on-rails-3><methods><refactoring><devise>","0","35","2012-04-12 13:50:23"
"10138684","Refactoring for-loop Linq query into a single query","<p>I have a set of data that requires some processing but I want to split the work available  threads. How can I change this into a single instruction, preferably removing the for-loop?</p>

<pre><code>string[] keysForThread;
IEnumerable&lt;string&gt; allData;
List&lt;string&gt; dataForSingleThreadToProcess;

for (int i = 0; i &lt; keys.length; i++)
    dataForSingleThreadToProcess.AddRange(allData.Where(x =&gt; x.StartsWith(keys[i])));
</code></pre>

<p>I don't mind changing the string[] keysForThread into a List and/or the List dataForSingleThreadToProcessinto an IEnumerable.</p>
","<linq><for-loop><refactoring>","0","52","2012-04-13 09:50:31"
"10149468","How to implement my code in a hierarchy method?","<p>I am making a game, and I started working everything in one Class. But now I want to separate out in different classes. I am having one problem with the following code. I have made a JFrame in the GameView class, and half of the code its code i want to copy it to a different class and it cannot find variable frame because its in the GameView? Below is my code:</p>

<p>GameView Class:</p>

<pre><code>public void gui()
    {
        BorderLayout borderlayout = new BorderLayout();      

        //Creates the frame, set the visibility to true, sets the size and exit on close
        JFrame frame = new JFrame(""Games"");
        frame.setVisible(true);
        frame.setSize(600,400);
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        //Creates the Throw Dice button
        Panel p = new Panel();
        p.setLayout(new GridLayout());
        p.add(new Button(""Throw Dice""));
        p.add(new Label(""Dice Draw"")); 
        p.setBackground(new Color(156, 93, 82));
        frame.add(p, BorderLayout.SOUTH);
</code></pre>

<p>Dice Class:</p>

<p>//Creates the Throw Dice button //MOVED FROM THE GameView CLASS</p>

<pre><code>Panel p = new Panel();
p.setLayout(new GridLayout());
p.add(new Button(""Throw Dice""));
p.add(new Label(""Dice Draw"")); 
p.setBackground(new Color(156, 93, 82));
frame.add(p, BorderLayout.SOUTH);// cannot find variable frame when i put this section into a different class
</code></pre>

<p>So I want the frame window to be in GameView class, and the dice part in a Dice class. But then its giving an error cannot find variable frame because its in the GameView class. How can I implement it?</p>
","<java><swing><refactoring><jframe>","0","60","2012-04-13 23:16:12"
"10175805","How to avoid a lot of if else conditions","<p>I have read a lot of topics about code refactoring and avoiding of if else statements.
Actually, I have a class where I am using a lot of if - else conditions.</p>

<p>More details: I am using the pull parser and on each line of my soap response, I will check if there is a tag I am interested on, if not, check another tag etc:</p>

<pre><code> if(eventType == XmlPullParser.START_TAG) {
            soapResponse= xpp.getName().toString();

            if (soapResponse.equals(""EditorialOffice"")){  
                eventType = xpp.next();
                if (xpp.getText()!=null){
                editorialOffice += xpp.getText();
                }
            }   
            else if (soapResponse.equals(""EditorialBoard"")){  
                eventType = xpp.next();
                if (xpp.getText()!=null){
                editorialBoard += xpp.getText();
                }
            }
            else if (soapResponse.equals(""AdvisoryBoard"")){  
                eventType = xpp.next();
                if (xpp.getText()!=null){
                advisoryBoard += xpp.getText();
                }
            }   
        }
        eventType = xpp.next();
     }
</code></pre>

<p>Now, I would like to use somethimg else, instead of those if else conditions, but I don't know what.</p>

<p>Can you please give me an example or a good tutorial page?</p>

<p>Thank you.</p>
","<java><if-statement><refactoring>","6","247","2012-04-16 14:14:18"
"10184290","refactoring code in rails controller","<p>i have two actions in my controller</p>

<pre><code>def up_vote
    lesson = Lesson.find(params[:id])
    current_user.up_vote!(lesson)
    flash[:message] = 'Thanks for voting!'
    redirect_to lesson_path(lesson)
end

def down_vote
    lesson = Lesson.find(params[:id])
    current_user.down_vote!(lesson)
    flash[:message] = 'Thanks for voting!'
    redirect_to lesson_path(lesson)
end
</code></pre>

<p>i was wondering what would be a good way to refactor this (keeping DRY in mind)? i read online that i shouldn't be trying to abuse the before_filter. what else could i use then? thanks!</p>
","<ruby-on-rails><controller><refactoring>","1","37","2012-04-17 02:28:17"
"10180220","How to recover from legacy stuff in large system step by step?","<p>Our team has been given a legacy system for further maintenance and development.
As this this is true ""legacy"" stuff, there is really, really small number of tests, and most of them are crap. This is an app with web interface, so there are both container-managed components as well as plain java classes (not tied to any framework etc.) which are ""new-ed"" here and there, whenever you want to.</p>

<p>As we work with this system, every time we touch given part we try to break all that stuff into smaller pieces, discover and refactor dependencies, push dependencies instead of pulling them in code.</p>

<p>My question is how to work with such system, to break dependecies, make code more testable etc? When to stop and how to deal with this?</p>

<p>Let me show you an example:</p>

<pre><code>public class BillingSettingsAction {

    private TelSystemConfigurator configurator;
    private OperatorIdDao dao;

    public BillingSettingsAction(String zoneId) {
        configurator = TelSystemConfiguratorFactory.instance().getConfigurator(zoneId);
        dao = IdDaoFactory.getDao();
        ...
    }

    // methods using configurator and dao
}
</code></pre>

<p>This constructor definitely does too much. Also to test this for further refactoring it requires doing magic with PowerMock etc. What I'd do is to change it into:</p>

<pre><code>public BillingSettingsAction(String zone, TelSystemConfigurator configurator, OperatorIdDao dao) {
    this.configurator = configurator;
    this.dao = dao;
    this.zone = zone;
}
</code></pre>

<p>or provide constructor setting zone only with setters for dependencies.</p>

<p>The problem I see is that if I provide dependencies in constructor, I still need to provide them somewhere. So it is just moving problem one level up. I know I can create factory for wiring all the dependencies, but touching different part of app will cause having different factories for each. I obviously can't refactor all the app at once and introduce e.g. Spring  there.</p>

<p>Exposing setters (maybe with default implementations provided) is similar, moreover it is like adding code for tests only.</p>

<p>So my question is how you deal with that? How to make dependencies between objects better, more readable, testable without doing it in one go?</p>
","<java><dependency-injection><refactoring><legacy-code><code-cleanup>","1","70","2012-04-16 19:15:33"
"10192285","How to find the new path of a renamed file whose original name is known?","<p>Consider following usecase:</p>

<p>I'm working on my local branch while refactoring has been done on the main branch. Now some files (classes) have been renamed and/or moved to new locations. When merging i get lots and lots of import-errors due to missing classes.</p>

<pre><code>--A--B--C--D--E-- (master)
   \           \
    F--G--H--I--J  (topic)
</code></pre>

<p>In <code>A</code> there are the old names wich i used in <code>F--G--H--I</code>.</p>

<p>In <code>B--C--D--E</code> the files are refactored resulting in new file names in <code>E</code>. This includes chained renames like</p>

<pre><code>B: path/to/File.java              -&gt; path/to/BetterName.java
C: path/to/BetterName.java        -&gt; better/package/BetterName.java
D: better/package/BetterName.java -&gt; final/package/FinalName.java
</code></pre>

<p>Now merging results in <code>J</code> with many (compilation) errors due to the missing refactorings on my branch. ( Because i still refer to <code>path.to.File</code> instead of <code>final.package.FinalName</code></p>

<p>In order to fix the broken build, i need to know the new names for the old classes.</p>

<p>Is there a easy git command to get all the renames?</p>
","<git><refactoring><git-bash>","2","79","2012-04-17 13:34:02"
"10191178","Refactoring -where to start","<p>I have been assigned the task of identifying refactoring items. The purpose is to look at the presentation layer code and identify if there is any business logic coded there . Then identify what needs to be moved to Service / Business layer and what remains in presentation. 
The code at which I am looking at by design does not seem to use any of the design patterns; there are monolithic blocks of code with hardly any or useless comments. Are there any suggestions on how I can go about this task - approaches which work?</p>

<p>Currently I am trying to reverse engineer and understand which seems to be the hard way of achieving this task.
The purpose of this activity is to reuse the business logic .</p>
","<refactoring>","0","46","2012-04-17 12:22:44"
"10200419","Unix recursive find / replaced based on dynamic pattern?","<p>So, I inherited some really bad code and am currently just trying to refactor it to the point of functionality before completely overhauling it.  One of the problems is that the original programmer set posts and sessions like this:</p>

<pre><code>$_SESSION[somename]  
$_POST[somevar]
</code></pre>

<p>instead of:</p>

<pre><code>$_SESSION['somename']
$_POST['somevar']
</code></pre>

<p>It seems to be causing problems throughout the site.  Is there a fast way that I can recursively find and replace these types of variables? I'm using a unix box, so not sure if there's a way to do that from the command line or if I should write a php script? They're everywhere and obviously are named different, so I would need to find any variable that does not have the quotes and replace it with the same string that does?</p>
","<php><unix><refactoring><find-and-replace>","-1","70","2012-04-17 22:59:35"
"10210096","GraphicsDeviceManager","<p>Can anyone please help. Im following a tutorial on drawing primitives from the MSDN found <a href=""http://msdn.microsoft.com/en-us/library/bb203926%28v=xnagamestudio.10%29.aspx"" rel=""nofollow"">here</a>.</p>

<p>I am trying to re-factor the code a small bit and to that end I have created a class called MyPrimitives in which I have placed all of the code from the tutorial. Then from e.g. Game11 Initialize() I can just call myPrimitive.Initialize() etc.</p>

<p>But I get a NullReferenceException at this line of code in MyPrimitives CreateVertexBuffer() method:</p>

<pre><code>vertexBuffer = new VertexBuffer(
            graphics.GraphicsDevice,
            vertexDeclaration,
            number_of_vertices,
            BufferUsage.None
            );
</code></pre>

<p>And CreateVertexBuffer() is called from MyPrimitives Initialize() method like so:</p>

<pre><code>public void Initialize()
    {
        CreateVertexBuffer();
    }
</code></pre>

<p>And THIS Initialize() is called from Game1 Initialize() like so:</p>

<pre><code>protected override void Initialize()
    {
        myPrimitiveDrawer = new MyPrimitiveDrawer();

        myPrimitiveDrawer.Initialize();

        base.Initialize();
    }
</code></pre>

<p>I know the problem is cause I have not set my graphis [GraphicsDeviceManager graphics] to an instance of an object, but how do I actually do this?
I have tried:</p>

<pre><code>public void Initialize()
    {
        graphics = new GraphicsDeviceManager(this);  // Tried this
        CreateVertexBuffer();
    }
</code></pre>

<p>But that just gives an error of invalid arguments.</p>

<p>Does anyone have any suggestion please?</p>
","<graphics><xna><refactoring>","1","36","2012-04-18 13:11:13"
"10233930","What makes virtual functions so slow? C++","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/449827/virtual-functions-and-performance-c"">Virtual functions and performance - C++</a>  </p>
</blockquote>



<p>I'm trying to refactor my code, and everywhere people say that using virtual functions is a huuuuge nono performance-wise, why? and is there another way that I can inherit a class and redefine functions that are defined in the base class?</p>
","<c++><function><refactoring><virtual>","0","118","2012-04-19 17:55:39"
"10234794","In XCode 4.3.2, when I run the ARC conversion refactor tool, all of my property options that were ""retain"" are NOT being changed into ""strong""","<p>In XCode 4.3.2, when I run the ARC conversion refactor tool, all of my property options that were ""retain"" are NOT being changed into ""strong"".  Is ""strong"" implied now or is this just a problem with XCode 4.3.2?</p>

<p>Example:</p>

<p>Before</p>

<pre><code>@property (nonatomic, retain) NSString * someString;
</code></pre>

<p>After</p>

<pre><code>@property (nonatomic) NSString * someString;
</code></pre>
","<objective-c><xcode><refactoring><automatic-ref-counting>","7","312","2012-04-19 18:49:10"
"10247308","Reducing duplication of code within two classes that have differing nested classes","<p>I have two classes (this is C#) that are very similar except they each contain their own nested class and enum.</p>

<p>I would like to refactor them to both inherit from a single abstract class, but I'm running into a problem because the methods are all tightly coupled to the nested class types.</p>

<p>My first plan was to pull out the ItemDetails Class, but it is linked to the ItemType, which is an enum that is specific to each view item class.  Further, I can't just use System.Enum as the type since I need to be able to serialize the details to an xml file.</p>

<p>How could I reduce the duplication within these classes?</p>

<pre><code>public class FirstViewItem
{
    [Serializable]
    public class ItemDetails
    {
        public ItemType Type;
        public int Width;
        public string Text;
        public int DisplayOrder;
    }

    public enum ItemType
    {
        None = 0,
        A,
        B,
        C
    }

    public FirstViewItem()
    {
        // ...
    }

    public List&lt;ItemDetails&gt;()
    {
        // code here ...
    }
}

public class SecondViewItem
{
    [Serializable]
    public class ItemDetails
    {
        public ItemType Type;
        public int Width;
        public string Text;
        public int DisplayOrder;
    }

    public enum ItemType
    {
        None = 0,
        X,
        Y,
        X
    }

    public SecondViewItem()
    {
        // ...
    }

    public List&lt;ItemDetails&gt;()
    {
        // code here ...
    }
}
</code></pre>
","<c#><enums><refactoring><xml-serialization>","4","55","2012-04-20 13:33:34"
"10254365","Refactoring - Chapter 11, Exercise 3 Rails Tutorial 2nd Edition","<p>Anyone else working through <a href=""http://ruby.railstutorial.org/chapters/following-users?version=3.2#sec%3afollowing_exercises"" rel=""nofollow"">Chapter 11 Exercises for Michael Hartl's Rails Tutorial 2nd Edition</a>?</p>

<p>Chapter 11, Exercise 3 asks:
Refactor Listing 11.31 by adding partials for the code common to the following/followers pages, the Home page, and the user show page.</p>

<p>I'm not seeing anything worth refactoring in the homepage, user show page, or the show_follow page</p>

<p>If anyone came up with something worthwhile for this exercise, would love to know. </p>

<p>Thanks!</p>
","<ruby-on-rails-3><refactoring><railstutorial.org>","1","61","2012-04-20 22:28:42"
"10259760","Change the path / class name of a serialized Java object after refactoring","<p>I've launched an app that saves its state with serialized object myfirstpath.UserState.</p>

<p>Now for I want to change the path of this object to mycleanpath.UserState (same object, only the path changes). This will work for new users installing the app for the first time but for users updating the app, they will lose their state. </p>

<p>Is there a way to load the serialized obect myfirstpath.UserState into mycleanpath.UserState ? (without keeping myfirstpath.UserState in my source code of course).</p>
","<java><android><serialization><refactoring><deserialization>","1","92","2012-04-21 14:25:51"
"10266012","How to refactor test application?","<p>I have a test application, with a class TestSeq and a method Go(), which consist of such blocks:</p>

<pre><code>            _writer.WriteLine(""Doing foo action..."");
            var stopwatch = Stopwatch.StartNew();
            // foo - some work here
            stopwatch.Stop();
            _writer.WriteDone(""Results of foo action."", stopwatch.Elapsed);
</code></pre>

<p>In ""some work"" I have different calls to WCF client (CRUD actions, filters, etc.).</p>

<p>So, a lot of code repeating, and obviously some refactor should be done here. I think about creating a class TestAction, but I dont know what is the best way to put that ""some work"" part in it.</p>

<p>It's seems to me that this is quite simple problem, but I just don't know what keywords should I search for. So, I'd be glad to see answers with just a keyword (pattern name or something) or link.</p>
","<c#><design><testing><refactoring>","3","47","2012-04-22 07:21:44"
"10277525","Applying a design pattern for a certain behavior","<p>I was wondering if anyone could provide a design pattern or better implementation solution for this function:</p>

<pre><code>  public function refundAcceptedDisputes() {            
        $this-&gt;getRequestedEbayOrdersFromDB(); //get all disputes requested on ebay
        foreach ($this-&gt;orders as $order) { /* $order is a Doctrine Entity */
            try {
                if ($this-&gt;isDisputeAccepted($order)) {
                    $order-&gt;setStatus('accepted');
                    $order-&gt;refund(); //refunds the order on ebay and internally in my system
                    $this-&gt;insertRecordInOrderHistoryTable($order,'refunded');                        
                } else if ($this-&gt;isDisputeCancelled($order)) {
                    $order-&gt;setStatus('cancelled');
                    $this-&gt;insertRecordInOrderHistory($order,'cancelled');
                    $order-&gt;rollBackRefund(); //cancels the refund on ebay and internally in my system
                } else if ($this-&gt;isDisputeOlderThan7Days($order)) {
                    $order-&gt;closeDispute(); //closes the dispute on ebay
                    $this-&gt;insertRecordInOrderHistoryTable($order,'refunded');
                    $order-&gt;refund(); //refunds the order on ebay and internally in my system
                }
            } catch (Exception $e) {
                $order-&gt;setStatus('failed');
                $order-&gt;setErrorMessage($e-&gt;getMessage());
                $this-&gt;addLog();//log error
            }
            $order-&gt;setUpdatedAt(time());
            $order-&gt;save();
        }
    }
</code></pre>

<p><strong>function purpose:</strong></p>

<ul>
<li>I am selling games on ebay.</li>
<li>If a customers wishes to cancel his order and gets his money back
(i.e. a Refund) I must open a ""Dispute"" on ebay first.</li>
<li>Once a dispute is opened I must wait for the customer to confirm that
he agrees to the refund (silly as he's the one who told me to refund,
but that's how it works on ebay).</li>
<li>This functions gets all disputes opened by me and checks their statuses periodically to see if the customer has replied to the dispute or not.</li>
<li>The customer may agree (then I refund) or refuse (then I rollback) or may not respond for 7 days (I close the dispute myself then refund).</li>
</ul>

<p><strong>Problem</strong></p>

<ol>
<li>As you can see the code is build on a <code>if/else</code> structure which means a new status (a customer closes his account for example) will mean that I need to add a <code>else if</code> statement which is a violation for the <em>Open Closed Principle</em>.</li>
<li>I get a feeling that the function has different layers of abstraction. <code>getRequestedEbayOrdersFromDB()</code> is very abstract while the rest of the code has many details.</li>
<li>Some of the functions are repeated <code>insertRecordInOrderHistoryTable()</code> which just adds a new record to the history Entity table.</li>
</ol>

<p><strong>Solution</strong></p>

<p>I thought about converting the multiple <code>if/else</code> to a factory pattern, but I only used factory to create objects not alter behaviors.</p>

<p>Next I thought about using a strategy pattern, but failed to build a good solution.</p>

<p>Any help in appreciated.
Thanks.</p>
","<php><design-patterns><refactoring>","2","80","2012-04-23 08:58:01"
"10279346","Static code analysis in Python?","<p>Which helpful static code analysis can you recommend for Python. I believe they are useful for refactoring code.
I know</p>

<ul>
<li>snakefood for module dependencies</li>
<li>pycallgraph for dynamic call graphs</li>
<li>pylint for bugs</li>
</ul>

<p>Are there static call analyzers? If I wanted to program a custom one, which would be the easiest way?</p>

<p>What other type of static code checks can you think of? Or maybe even some Python magic like ABCs?</p>
","<python><debugging><refactoring><static-code-analysis>","3","136","2012-04-23 11:06:37"
"10285490","How could one refactor code involved in nested usings?","<p>I've got some code that has an awful lot of duplication.  The problem comes from the fact that I'm dealing with nested <code>IDisposable</code> types.  Today I have something that looks like:</p>

<pre><code>public void UpdateFromXml(Guid innerId, XDocument someXml)
{
    using (var a = SomeFactory.GetA(_uri))
    using (var b = a.GetB(_id))
    using (var c = b.GetC(innerId))
    {
        var cWrapper = new SomeWrapper(c);
        cWrapper.Update(someXml);
    }
}

public bool GetSomeValueById(Guid innerId)
{
    using (var a = SomeFactory.GetA(_uri))
    using (var b = a.GetB(_id))
    using (var c = b.GetC(innerId))
    {
        return c.GetSomeValue();
    }
}
</code></pre>

<p>The whole nested <code>using</code> block is the same for each of these methods (two are shown, but there are about ten of them).  The only thing that is different is what happens when you get to the inner level of the <code>using</code> blocks.</p>

<p>One way I was thinking would be to do something along the lines of:</p>

<pre><code>public void UpdateFromXml(Guid innerId, XDocument someXml)
{
    ActOnC(innerId, c =&gt;
    { 
        var cWrapper = new SomeWrapper(c);
        cWrapper.Update(someXml);
    });
}

public bool GetSomeValueById(Guid innerId)
{
    var result = null;

    ActOnC(innerId, c =&gt; { result = c.GetSomeValue(); });

    return result;
}

private void ActOnC(Guid innerId, Action&lt;TheCType&gt; action)
{
    using (var a = SomeFactory.GetA(_uri))
    using (var b = a.GetB(_id))
    using (var c = b.GetC(innerId))
    {
        action(c);
    }        
}
</code></pre>

<p>This works, it's just kind of clunky to parse (as a human).  <em>Does anyone have any other suggestions on how one could reduce the code duplication around nested <code>using</code> blocks like this?</em>  If they weren't <code>IDisposable</code> then one would likely just create a method to return the results of <code>b.GetC(innerId)</code> ... but that isn't the case here.</p>
","<c#><refactoring><using-statement><code-duplication>","8","91","2012-04-23 17:43:04"
"10285825","JQuery validation - Highlight and message refactor","<p>I have the folliwng code working, however I feel that there is a cleaner way of writing it.</p>

<pre><code>&lt;script type=""text/javascript""&gt;     
    $(document).ready(function () {        
        $(""#formRequest"").validate({
            highlight: function (element, errorClass) {
                $(element).addClass(""rfvTB"");
            },
            unhighlight: function (element, errorClass) {
                $(element).removeClass(""rfvTB"");
            } 
        });

        $.validator.messages.required = '  *';
    }); 
&lt;/script&gt;
</code></pre>

<p>the validation message seems like it belongs within the validate function. Is there a way of writing this cleaner?</p>
","<jquery><refactoring><jquery-validate>","1","48","2012-04-23 18:05:32"
"10282025","Automatically add parentheses to arithmetic operations using Language specification C#","<p>I have been doing a lot of refactoring of legacy code recently, good times :)...</p>

<p>We use the StyleCop tool in our office and one rule in particular has cropped up a lot. <a href=""http://stylecop.soyuz5.com/SA1407.html"" rel=""nofollow"">http://stylecop.soyuz5.com/SA1407.html</a> which says that basically there a not enough brackets for the code to be easy to read. So for one of the smaller lines like:</p>

<pre><code>double scaling = Math.Sqrt(parameters.InitialVar * Math.Exp(-ExtrapolationHorizon * parameters.ReversionSpeed) + (1 - Math.Exp(-ExtrapolationHorizon * parameters.ReversionSpeed)) * parameters.ReversionLevel);
</code></pre>

<p>We need to add brackets like so:</p>

<pre><code>double scaling = Math.Sqrt((parameters.InitialVar * Math.Exp(-ExtrapolationHorizon * parameters.ReversionSpeed)) + ((1 - Math.Exp(-ExtrapolationHorizon * parameters.ReversionSpeed)) * parameters.ReversionLevel));
</code></pre>

<p>Easy enough to do by eye but believe me there are much worse ones in this code.</p>

<p>So I know that its easy enough to write a tool to do this for me using the highschool BEDMAS rules, but to expand that to take into accound things like Math.Sqrt and Math.Exp etc seems like it might take longer than its worth.</p>

<p>Does anyone know any tools which will do this kind of thing for me? perhaps a VS addin?</p>

<p>or is there so obvious way of doing it that I have missed.</p>

<p>Cheers all.</p>
","<c#><refactoring><stylecop><arithmetic-expressions>","0","58","2012-04-23 14:00:00"
"10306402","Eclipse: How to change attr from public to private by using refactoring tools","<p>for example:</p>

<pre><code> public class Person {

    public final int age;
   }
</code></pre>

<p>Is there a way in eclipse to perform the following automatic\semi automatic (by using refactoring tools)</p>

<p>1) change the visibility of age from public to private.</p>

<p>2) add getter for age</p>

<p>3) everywhere in the code change *.age to *.get_age()  (* = instance of person class)  </p>

<p>And iam not looking for find\replace solutions ... :)</p>
","<java><eclipse><refactoring>","0","42","2012-04-24 21:39:56"
"10312002","refactor constructors into setters in java","<p>I have refactored my method using ""Introduce a parameter"" as it was accepting a lot of variables. but now all the callers have inline cosntructor as </p>

<pre><code>this.somemethod(new MyParam(""a"", ""b"",""c"",""d""); 
</code></pre>

<p>i would like to refactor it by replacing constructor with setters like</p>

<pre><code>MyParam myParam= new MyParam();
myParam.setA(""a"");........
.
.
this.somemethod(myParam);
</code></pre>

<p>Is there someway to do this ?? </p>

<p>there was a similar bug reported on eclipse <a href=""https://bugs.eclipse.org/bugs/show_bug.cgi?id=105324"" rel=""nofollow"">https://bugs.eclipse.org/bugs/show_bug.cgi?id=105324</a></p>
","<java><eclipse><refactoring>","0","54","2012-04-25 08:27:09"
"10316943","Refactor C# code (help improve)","<p>I need help to refactor some parts of this code example from where <code>if (_obj is Application)</code> so this will be generic.</p>

<pre><code>public override void Body(object _obj, object _objInPreviousState)
        {

            if (_obj != null)
            {
                string Message = """";
                string Subject = """";
                if (_objInPreviousState == null)
                {
                    var emailParams = this.Param as Dictionary&lt;string, string&gt;;
                    if (emailParams != null)
                    {
                        Message = emailParams[""Message""];
                        Subject = emailParams[""Subject""];
                    }
                }
                var emails = userRepository().GetForRoles(""RM"").Select(c =&gt; c.Email);
                if (_obj is Application)
                {
                    var app = (Application)_obj;
                    var appInPreviousState = _objInPreviousState as Application;
                    if (appInPreviousState == null)
                    {
                        emailService().SendEmails(""aps@somedomain.com"", emails.ToArray(), Message, Subject);
                    }
                    else if (app.ApplicationStatus != appInPreviousState.ApplicationStatus)
                    {
                        emailService().SendEmails(""aps@somedomain.com"", emails.ToArray(), ""Application: "" + app.ID + "" changed decision status: "" + Enum.GetName(typeof(AppStatus), app.ApplicationStatus), ""Check following application: "" + app.ID);
                    }
                }
                else if (_obj is Product)
                {
                    var product = (Product)_obj;
                    var prodInPreviousState = _objInPreviousState as Product;
                    if (prodInPreviousState == null)
                    {
                        emailService().SendEmails(""aps@somedomain.com"", emails.ToArray(), Message, Subject);
                    }
                    else if (product.ProductStatusType != prodInPreviousState.ProductStatusType)
                    {
                        emailService().SendEmails(""aps@somedomain.com"", emails.ToArray(), ""Product: "" + product.ID + "" for application "" + product.ApplicationID + "" changed decision status: "" + Enum.GetName(typeof(AppStatus), product.ProductStatusType), ""Check following application: "" + product.ApplicationID);
                    }
                }

                else if (_obj is CES)
                {
                    var ces = (CES)_obj;
                    var cesInPreviousState = _objInPreviousState as CES;
                    if (cesInPreviousState == null)
                    {
                        emailService().SendEmails(""aps@somedomain.com"", emails.ToArray(), Message, Subject);
                    }
                    else if (ces.Status != cesInPreviousState.Status)
                    {
                        emailService().SendEmails(""aps@somedomain.com"", emails.ToArray(), ""CES for application "" + ces.ApplicationID + "" changed decision status: "" + Enum.GetName(typeof(CesStatuses), ces.Status), ""Check following application: "" + ces.ApplicationID);
                    }
                }
                else if (_obj is Comment)
                {
                    var comment = (Comment)_obj;
                    emailService().SendEmails(""aps@somedomain.com"", emails.ToArray(), ""Comment for the following application: "" + comment.ApplicationID + "" with message: "" + comment.Message + "" on date: "" + comment.CreatedDate, ""Comment for the following application: "" + comment.ApplicationID);
                }
                mLog.InfoLine(""Sendet Email"");
            }

        }
</code></pre>
","<c#><refactoring>","0","98","2012-04-25 13:41:08"
"10325289","How to factorize an operator?","<p>This may be very simple, but it's late in the night... I have two methods:</p>

<pre><code>public IQueryable&lt;Post&gt; GetNotSticky()
{
   return Get().Where(p =&gt; p.Type != PostType.Sticky);
}
</code></pre>

<p>And the inverse</p>

<pre><code>public IQueryable&lt;Post&gt; GetSticky()
{
   return Get().Where(p =&gt; p.Type == PostType.Sticky);
}
</code></pre>

<p>As you can see, the operator is the only difference. How to factorize this DRY violation into a nice common method? It feels simple, but right now the solution eludes me.</p>
","<c#><refactoring><operators>","0","40","2012-04-25 23:35:50"
"10326898","Javascript - Replace lots of if statements","<p>I have a a couple of different radio buttons which return an ethnicity and a gender. The script runs inside an internal application so rather than returning ""boy"", ""girl"" or ""both"" I get back 7707330, 7707333, and 7707336. Similar from the ethnicity radio button. </p>

<p>I then need to validate data based on the combonation of ethnicity and gender. This was a pretty simple task but I have ended up with 15 if statements! It all works as it should, but there must be a cleaner solution? </p>

<pre><code>function test(radioResults) {
    var1 = radioResults[0].toString();
    var2 = radioResults[1].toString();

    var roll = parseFloat(parent.roll);

    if (var2 == '7707330') {
        gender = 'boy';
    }
    if (var2 == '7707333') {
        gender = 'girl';
    }
    if (var2 == '7707336') {
        gender = 'both';
    }

    if (var1 == '7707341') {
        maori(gender);
    }
    if (var1 == '7707344') {
        pasifika(gender);
    }
    if (var1 == '7707347') {
        all(gender);
    }
}

function maori(gender) {
    //Maori 
    if (gender == 'boy') {
        ethnicity = parseFloat(parent.getMBoys);
        validation(ethnicity);
    }
    if (gender == 'girl') {
        ethnicity = parseFloat(parent.getMGirls);
        validation(ethnicity);
    }
    if (gender == 'both') {
        ethnicity = parseFloat(parent.getTotalM);
        validation(ethnicity);
    }
}

function pasifika(gender) {
    //Pasifika
    if (gender == 'boy') {
        ethnicity = parseFloat(parent.getPBoys);
        validation(ethnicity);
    }
    if (gender == 'girl') {
        ethnicity = parseFloat(parent.getPGirls);
        validation(ethnicity);
    }
    if (gender == 'both') {
        ethnicity = parseFloat(parent.getTotalP);
        validation(ethnicity);
    }
}

function all(gender) {
    //All
    if (gender == 'boy') {
        ethnicity = parseFloat(parent.getBoys);
        validation(ethnicity);
    }
    if (gender == 'girl') {
        ethnicity = parseFloat(parent.getGirls);
        validation(ethnicity);
    }
    if (gender == 'both') {
        ethnicity = parseFloat(parent.getTotalRoll);
        validation(ethnicity);
    }
}

function validation(ethnicity) {

    percent = ethnicity * 5 / 100;

    if (ethnicity - percent &gt; roll || (ethnicity + percent &lt; roll)) {
        parent.document.getElementById('CF_7784443').value = ""FAIL"";
    } else {
        parent.document.getElementById('CF_7784443').value = ""PASS"";
    }
}
</code></pre>

<p>How would I go about cleaning this up? </p>
","<javascript><if-statement><refactoring><code-cleanup>","0","70","2012-04-26 03:40:37"
"10338415","Where can I find the source code to Move Type To New File refactoring?","<p>Please could someone tell me where I can find the source code to the <strong>Move Type To New File</strong> refactoring in Eclipse.</p>

<p>I need the code for a inverse engineering project and I can't find it...</p>

<p>There must be a realization of the <em>Refactoring</em> abstract class that checks preconditions and so, but it must be named in a different way.</p>

<p>Could anyone help me?</p>

<p>I've tried Google and GrepCode, but had no luck so far.</p>
","<java><eclipse><refactoring><source>","0","21","2012-04-26 17:28:35"
"10348313","Refactoring in order to write ""pretty"" JUnit tests","<p>I want to clarify refactoring in scope of TDD.</p>

<p>Before:</p>

<pre><code>class Somclass{
      public void sendMessage(){    
       WebServiceStub stub = new WebServiceStub();     
      ...
      stub.sendMsg();        
      }
    }
</code></pre>

<p>After:</p>

<pre><code>class Somclass{
private WebServiceStub stub;

  public void sendMessage(){
    ...
  if(stub == null){
   stub = new WebServiceStub();
  }
  ...
  stub.sendMsg();        
  }
}
</code></pre>

<p>So I want to verify sendMsg() method and make some asserts with result. To have posibility to mock this stub i move this stub local variable to instance variable. So that I can set mocked stub to class and do verivyings and asserts in test class. For example:</p>

<pre><code>@Test
public void testSMth(){
  wsProvider.setStub(stubMock);
  verify(stubMock).sendMsg();
  ...asserts
}
</code></pre>

<p>This approach is not thread safety and I should do some concurrency modification. This modification may cause mistakes. So in local variable approce there is thread safty.</p>

<p>Also i could create Factory that will return an instance of WebServiceStub. But this approache will produce new classes because this situation is frequent.</p>

<p>There is a question: how test this cases and does  goot test cost modification that may cause mistakes?</p>
","<java><refactoring><mocking><tdd><mockito>","3","113","2012-04-27 09:39:13"
"10366419","Refactoring session check","<p>I have this repetitive code in all the controllers:</p>

<pre><code>        var user = Session[""_User""] as User;

        if (user== null)
        {
            return RedirectToAction(""Index"");
        }
</code></pre>

<p>How can I refactor this? should i add this to an attribute or make a Session Wrapper?</p>

<p>What would be the best approach?</p>
","<c#><asp.net-mvc-3><refactoring>","1","55","2012-04-28 18:36:03"
"10369491","Parsing match operator and refactoring switch cases","<p>I need a function that will take operands/operators as parameters and provide the evaluation result.
The problem that I am facing is how to elegantly parse an operator.</p>

<p>Sample code is as below</p>

<pre><code>internal static bool Evaluator(double operand1, double operand2, string operation)
{
    bool evaluation = false;
    switch (operation)
    {
        case ""&lt;"":
            evaluation = operand1 &lt; operand2;
            break;

        case ""&gt;"":
            evaluation = operand1 &gt; operand2;
            break;

        case ""&lt;="":
            evaluation = operand1 &lt;= operand2;
            break;

        default:
            break;
    }

    return evaluation;
}
</code></pre>

<p>I can put operators in enum (or extendable enum) and use strategy pattern to remove the switch case.
The issue remains, I cannot parse operators. 
example</p>

<pre><code>     op1=""&lt;"";
     var operation = Operation.Parse(op1);
     var result = operand1 &lt;--  operation should come here --&gt; operand2.
</code></pre>

<p>Please suggest how to refactor above code (Evaluator function) elegantly.</p>
","<.net><design-patterns><refactoring><switch-statement><strategy-pattern>","0","36","2012-04-29 03:35:52"
"10379036","Refactoring an arrow head anti-pattern","<p>I have some data that I'm querying in a single method. 
It's gotten to the point where it's become the arrowhead anti-pattern. 
It looks something like this:</p>

<pre><code>void queryData()
{
    int masterIndex = getMasterIndex();
    if (masterIndex != -1)
    {
        byte[] pageData = getMasterPage(masterIndex);
        if (pageData) != null)
        {
            Item1 i1 = getItem1(pageData);
            Item2 i2 = getItem2(pageData);

            if (i1 != null &amp;&amp; i2 != null)
            {
                showResults(i1, i2);
            }
        }
    }
}
</code></pre>

<p>Imagine the above but larger. More if statements and each method that is called has a decent amount of logic in it. </p>

<p>Now what I can do is refactor the above method so all if statements are positive and early return if true. </p>

<p>I feel it would be cleaner to break each query and validity check into their own class though. 
Each action would inherit/implement an interface like the following: </p>

<pre><code>public interface Action
{
    public void run();
    public boolean wasSuccessful();
}
</code></pre>

<p>I would create a list of the actions required and run through them one at a time. 
This way it is obvious to see what logic belongs with each action. </p>

<p>Is this over architected? Is the above an existing pattern I don't know of yet? </p>

<p>Thanks in advance. </p>
","<java><refactoring>","1","65","2012-04-30 05:48:52"
"10373963","Ruby 'First and Rest' Logic","<p>My app is reaching a point where I must begin optimizing for performance. I've posted some code from my view that I feel can be improved. </p>

<p>In the view, I am treating the first item in the index a certain way and the rest of the items another way. Each time a new item is iterated over, it is being checked (Ruby asks itself.. does this item have an index of 0?) </p>

<p>I feel like performance can be improved if I can stop that behavior by treating the first item special with <code>index.first?</code> and treating the other items another way (without even checking whether they have an index of zero) How can this be done? </p>

<pre><code>  &lt;% @links.each_with_index do |link, index| %&gt;
    &lt;% if link.points == 0 then @points = ""?"" else @points = link.points %&gt;
    &lt;% end %&gt;
    &lt;% if index == 0 then %&gt;
      &lt;h1&gt; First Item &lt;/h1&gt;
    &lt;% else %&gt;
      &lt;h1&gt; Everything else &lt;/h1&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;
</code></pre>
","<ruby><performance><refactoring>","2","80","2012-04-29 16:50:20"
"10387527","rails and refactoring, suggested tools and techniques specific to vim users?","<p>Being a fairly new rails developer, I had my first taste of refactoring last week where I had to rename a controller and model to better reflect the domain we were working with. I used .NET for many years and took tools like Resharper for granted where it is simple to rename classes. I'm wondering how folks in the rails world mitigate the problem of refactoring? I'm mostly interested in those that mostly use vim (or anything other than an IDE). </p>

<p>I'm mostly interested in:</p>

<ul>
<li>effective vim plugins that are specific to rails that may help with process</li>
<li>inbuilt vim tools that may also help with the process </li>
</ul>

<p>I spent close to two hours doing the refactor and would like to be efficient, so any advice from rails experts would be great. 
Cheers.</p>

<p>Note, I realize that this question is similar to
<a href=""http://stackoverflow.com/questions/7794178/what-tools-are-available-for-ruby-refactoring"">What tools are available for Ruby refactoring?</a>
but I'm already aware of IDE's like ruby mine, I'm mostly interested in how people who use vim with this kind of task.</p>
","<ruby-on-rails><ruby><vim><refactoring>","7","109","2012-04-30 16:58:55"
"10394809","Can anybody think of a way to refactor this to avoid repetitive code?","<p>I have two search loops for performing different operations, but I'm unhappy with how repetitive this looks.</p>

<p>The first method used to remove an item is as follows:</p>

<pre><code>public void RemovePlayer(int theID){
    boolean matchFound = false;

    if (playerObjects.size() != 0){
        for (int i = 0; i &lt; playerObjects.size(); i++){
            Person playerToRemove = (Person) playerObjects.get(i);
            if (playerToRemove.getID() == theID){
                playerObjects.remove(i);
                System.out.println(""Player with ID # "" + theID + "" removed"");
                matchFound = true;
                // As ID is unique, once a player is found it is unnecessary to continue looping
                break;
            }

            // If matchFound is never set to true then show appropriate error
            if (matchFound == false) {
                System.out.println(""Player with ID # "" + theID + "" not found"");
            }
        }
    }
    else {
        System.out.println(""No players have been added."");    
    }
}
</code></pre>

<p>And the second method, which is essentially the same code, but performs a different action if a match is found is as follows:</p>

<pre><code>public void RetrievePlayer(int theID){
    boolean matchFound = false;

    if (playerObjects.size() != 0){
        for (int i = 0; i &lt; playerObjects.size(); i++){
            Person playerToRetrieve = (Person) playerObjects.get(i);
            if (playerToRetrieve.getID() == theID){
                System.out.println(""PLAYER FOUND:"");
                playerToRetrieve.GetDetails();
                matchFound = true;
                break;
            }

            // If matchFound is never set to true then show appropriate error
            if (matchFound == false) {
                System.out.println(""Player with ID # "" + theID + "" not found"");
            }
        }
    } else {
        System.out.println(""No players have been added."");    
    }
}
</code></pre>

<p>How can I refactor this? </p>
","<java><search><refactoring>","0","58","2012-05-01 07:28:36"
"10401475","Is there an easy way to Extract Interface in Visual Studio Express 2010 Edition?","<p>I have a large class from which I want to extract interface.</p>

<p>I only found ""Extract Method"" under Refactor Option, so I am wondering if there is any free tool available that does that, so I do not have to create the interface by hand?</p>
","<.net><visual-studio-express><automated-refactoring>","1","52","2012-05-01 17:15:31"
"10393413","When I try to refactor in Xcode, a warning to add the file to the build phase of the target in this workspace appears","<p>I am seeing this message, too often when I try to refactor my code by renaming:</p>

<p><code>***.h is not part of the build phase of any targets in this workspace and so can’t be refactored.
Add the file to the build phase of a target in this workspace, or make a selection in another file.</code></p>

<p>Sometimes, refactoring works only right after relaunching Xcode and reopen the project. But it's not working afterwards.</p>
","<ios><xcode><refactoring>","1","82","2012-05-01 04:07:55"
"10410729","Reducing if-else statements in Java","<p>I have the following code:</p>

<pre><code>void f(String t)
{
  if(t.equals(""a""))
  {
    someObject.setType(ObjectType.TYPE_A);
  }
 else if(t.equals(""b""))
  {
    someObject.setType(ObjectType.TYPE_B);
  }

// 50 more similar code

}
</code></pre>

<p>Is there any simple way to rewrite the if-else condition so as not to have that much code?</p>
","<java><if-statement><refactoring><condition>","14","599","2012-05-02 09:08:48"
"10415114","Builder::XmlMarkup use","<p>I'm using ::Builder::XmlMarkup like this: </p>

<pre><code> # This is a class method in /lib, run ascynchronously using delayed_job. 
 # Bunch of file io / header stuff, then... 
 books.each do |book|
        xml.Product do
          xml.RecordReference ""com.domain-#{book.id}""
          xml.NotificationType book.notification unless book.notification.blank?
          xml.ProductIdentifier do
            xml.ProductIDType ""15""
            xml.IDValue book.isbn unless book.isbn.blank?
          end
          book.productcodes.each do |productcode|
            unless productcode.idtype == ""15""
              xml.ProductIdentifier do
                xml.ProductIDType productcode.idtype unless productcode.idtype.blank?
                xml.IDValue productcode.idvalue unless productcode.idvalue.blank?
              end
            end
          end
          xml.ProductForm book.format unless book.format.blank?
          xml.ProductFormDetail book.format_detail unless book.format_detail.blank?
          xml.ProductFormDescription book.format_description unless book.format_description.blank?
</code></pre>

<p>etc. Trouble is, it goes on for another 250 lines. Is this how you're meant to build XML files full of bitty elements? It doesn't seem very Rubyish. </p>
","<ruby-on-rails><ruby><xml><refactoring>","1","52","2012-05-02 13:49:32"
"10415487","How to extract the common logic including return statement in Javascript?","<p>Here is my code:</p>

<pre><code>function function1() {
    var ids = GetIds(); // predefined function
    if (ids.length === 0) {
        alert(""Please select at least one item to procees."");
        return;
    }

    ...
}

function function2() {
    var ids = GetIds(); // predefined function
    if (ids.length === 0) {
        alert(""Please select at least one item to procees."");
        return;
    }

    ...
}

function function3() {
    var ids = GetIds(); // predefined function
    if (ids.length === 0) {
        alert(""Please select at least one item to procees."");
        return;
    }

    ...
}
</code></pre>

<p>How to extract the common part out? How to re-factor the code? The return statement is very hard to deal with. Is there any pattern relating to re-factor this code?</p>

<p>Thanks in advance!</p>

<pre><code>    if (ids.length === 0) {
        alert(""Please select at least one item to procees."");
        return;
    }
</code></pre>
","<javascript><refactoring>","0","27","2012-05-02 14:10:56"
"10418888","Open sourcing a large codebase: Process to split into individual projects on Github/Bitbucket?","<p>I have built a fairly substantial machine learning application for a particular market and would like to open source the ""backend"" components that are reuseable. They don't make much sense to release as a single library because the components range from data persistence to pattern detection to GUI development. There will still be a closed-sourced component for the end-user product which is built on top of the backend components. Also, some of the backend components depend on others (e.g. they all depend on a custom unit testing framework).</p>

<p>I'm planning on moving to GitHub/Git or BitBucket/Mercurial (from Subversion) to make the initial open source releases. I'm having trouble envisioning the structure of the SCM repositories and how those will then be laid out in a directory structure on my dev machines. I expect to be able to work on all the components at any time and rebuild the entire suite form source across repositories. </p>

<p>Does Git or Hg have tools to deal with such a situation? Do the hosts BitBucket or GitHub help with this situation? Is there a good way to break off one component at a time from the master codebase and turn it into it's own repo?</p>
","<github><refactoring><bitbucket><foss>","0","26","2012-05-02 17:38:22"
"10425127","Using Double data type to transport Money values","<p>I understand that using Double data type for Money calculations is <a href=""http://stackoverflow.com/questions/274296/money-type"">asking</a> <a href=""http://stackoverflow.com/questions/1165761/decimal-vs-double-which-one-should-i-use-and-when"">for</a> <a href=""http://stackoverflow.com/questions/316727/is-a-double-really-unsuitable-for-money"">trouble</a> so Decimal should be used instead.</p>

<p>I feel stupid asking this, but could there be potential problems in using the Double data type to just store or transport a Money value, so long as it is converted to a Decimal when doing calculations?</p>

<p>I ask this because I have an old application on my hands to maintain, and it is using Double everywhere.  To save work, I would like to only refactor the parts that actually do calculations, to use Decimal instead of Double.  I would like to leave the rest of it alone where it is only plumbing code for data-transfer, serialization and such.</p>
","<c#><refactoring><money>","2","92","2012-05-03 04:26:20"
"10436478","C# dealing with derived types, refactoring","<p>I am using a third-part .NET library that has the following classes.</p>

<p>Shape (the abstract base class)</p>

<p>(all the below classes derived from him)</p>

<p>Rectangle</p>

<p>Circle</p>

<p>Triangle</p>

<p>all of these classes has a property called Area</p>

<p>I am going through an array of Shape(s), and set the area</p>

<p>P.S: Area is not a property of the Shape, instead it is a property of each class.</p>

<p>so my code looks like this:</p>

<pre><code>if (shapeVar is Reactangle)
{
   (shapeVar as Rectangle).area = value;
}

if (shapeVar is Circle)
{
   (shapeVar as Circle).area = value;
}

if (shapeVar is Triangle)
{
   (shapeVar as Triangle).area = value;
}
</code></pre>

<p>Is there a better way to do this?
I feel like it is stupid, but I didn't find other way to do it</p>

<p>I am using .NET 4</p>
","<c#-4.0><refactoring><refactor-my-code>","0","23","2012-05-03 17:32:05"
"10429799","Any advanced tool to compress a JS file?","<p>I'm looking for a tool to compress my JS files.</p>

<p>What I want is not just simply remove unneccessary characters;
I prefer to tool to be able to reduce the lengths of 
local variables in functions also.</p>

<p>Even better I the tool can reduce the lengths of all other
stuff like global variables, function names, etc. This is to protect the code from being used by web viewers without our consent.</p>

<p>For example, the tool should rename a variable or function name from ""some_variable"", ""some_function"" to ""sv"", ""sf"", etc. And then refactoring all related references.</p>

<p>I've tried to dig the net but couldn't find something similar.</p>
","<javascript><refactoring><web><minification>","1","49","2012-05-03 10:45:53"
"10442785","How to refactor a class hierarchy of singletons where each class has a getInstance() method?","<p>I have inherited a particular class hierarchy of singletons whose declarations are summarized below (there are more implementations -- I'm just showing the minimal set to demonstrate the problem).  It smells to high heaven to me, foremost because singletons are being inherited from,  as well as the way <code>instance</code> in the base class has its value overwritten in the static initializers of the subclasses.</p>

<p>If all the implementations were in the <code>foo.common</code> parent package I would consider just dropping the <code>instance</code> member and <code>getInstance()</code> methods from them, making the classes and their constructors package-local, and having some public factory class in <code>foo.common</code> create a single instance of each, hold onto that single instance of each internally (partitioned by whether it was an implementation of <code>IReadOnly</code> or <code>IReadWrite</code>) and provide a couple of public lookup methods where based on some enum it would return the asked-for implementation as the interface type.</p>

<p>But implementations can be outside of <code>foo.common</code> and <code>foo.common</code> isn't allowed to depend on such ""more specific"" packages, since <code>foo.common</code> is intended for stuff common to a bunch of apps. So something that simple can't be done.  What then?</p>

<p>First interface:</p>

<pre><code>package foo.common.config;
public interface IReadOnly
{
    void load();
    String getVal(String key);
}
</code></pre>

<p>Second interface:</p>

<pre><code>package foo.common.config;
public interface IReadWrite extends IReadOnly
{
    void save();
    void setVal(String key, String value);
}
</code></pre>

<p>First implementation:</p>

<pre><code>package foo.common.config;
public class ReadOnlyImpl implements IReadOnly
{
    protected static IReadOnly instance;

    static {
        instance = new ReadOnlyImpl();
    }

    public static IReadOnly getInstance() {
        return instance;
    }

    protected ReadOnlyImpl() {}

    // implement methods in IReadOnly
}
</code></pre>

<p>Second implementation</p>

<pre><code>package foo.common.config;
public class ReadWriteImpl extends ReadOnlyImpl implements IReadWrite
{
    static {
        instance = new ReadWriteImpl();
    }

    public static IReadWrite getInstance() {
        return (IReadWrite) instance;
    }

    protected ReadWriteImpl() {
        super();
    }

    // Implement methods in IReadWrite
}
</code></pre>

<p>Third implementation:</p>

<pre><code>// While things in this package can depend
// on things in foo.common, nothing in 
// foo.common is allowed to depend on this package.
package foo.apps.someapp;
public class MoreSpecificReadWriteImpl extends ReadWriteImpl
{
    static {
        instance = new MoreSpecificReadWriteImpl();
    }

    public static IReadWrite getInstance() {
        return (IReadWrite) instance;
    }

    protected MoreSpecificReadWrite() {
        super();
    }

    // Override superclass methods to do something specific
}
</code></pre>
","<java><inheritance><refactoring><singleton>","0","39","2012-05-04 04:37:47"
"10452394","Is there a more efficient way of creating a list based on an existing list and a lookup list?","<p>I have the following method that takes an extremely long time to run and would love some help to make it run faster and or be more efficient.</p>

<p>The main responsibility of the method is to take a list of data points created from a CSV file, map the <code>Name</code> property of the file datapoints to the to the <code>HistorianTagname</code> property in a list of tagnames by the <code>DataLoggerTagname</code> property and create a resulting list from the mapping.  If the mapping does not exist, the file datapoint is ignored.</p>

<p>I know it that was long-winded, but I hope it makes sense.  It may be easier just to look at the method:</p>

<pre><code>    private IEnumerable&lt;DataPoint&gt; GetHistorianDatapoints(IEnumerable&lt;DataPoint&gt; fileDatapoints, IEnumerable&lt;Tagname&gt; historianTagnames)
    {
        /**
         ** REFACTOR THIS 
         **/

        foreach (var fileDatapoint in fileDatapoints)
        {
            var historianTagname = historianTagnames.FirstOrDefault(x =&gt; x.DataLoggerTagname.Equals(fileDatapoint.Name, StringComparison.OrdinalIgnoreCase));
            if (historianTagname != null)
            {
                var historianDatapoint = new DataPoint();

                historianDatapoint.Name = historianTagname.HistorianTagname;
                historianDatapoint.Date = fileDatapoint.Date;
                historianDatapoint.Value = fileDatapoint.Value;

                yield return historianDatapoint;
            }
        }
    }
</code></pre>

<p>Notes:
I have complete control of classes and methods of mapping, so if I am doing something fundamentally wrong.  I would love to know!  </p>

<p>Thanks!</p>
","<c#><refactoring>","1","57","2012-05-04 16:08:24"
"10457209","Preserve Whole Object VS Don't Look For Things","<p>I was reading Fowler's Refactoring Book and saw <a href=""http://martinfowler.com/refactoring/catalog/preserveWholeObject.html"" rel=""nofollow"">Preserve Whole Object</a>. A different, newer opinion says that this refactoring is the exact opposite of what you should do: <a href=""http://www.youtube.com/watch?v=RlfLCWKxHJ0"" rel=""nofollow"">The Clean Code Talks - Don't Look For Things!</a>.</p>

<p>Fowler does mention that you should look to see if the method can just be moved to the class which uses the large list of arguments. I think that would be the only reasonable alternative. This refactoring seems like a band-aid for a poorly defined method.</p>

<p>The Fowler source material is a bit dated. Is the prevailing wisdom to let this technique go the way of the dodo or is there actually a case when you'd want to do this kind of refactoring? Or have I misunderstood the test-driven style because those examples deal with object construction, not message sending?</p>
","<oop><design><refactoring>","1","82","2012-05-04 23:06:59"
"10458758","Is there a refactoring tool to split a large function into small functions automatically?","<p>I want to use some C codes from a function, however, the function has 300+ lines of code and 20 variables, which make me really headache to deal with.</p>

<p>I'm just wondering whether there's such a tool that can separate(refactor) small functions from a large function automatically. Then it will save me a lot of time to deal with long functions like that.</p>

<p>(I don't think it's a very hard thing because this tool only need to analysis the position where a Variable was defined first time, and the position where a Variable was used at last, then give me some suggestion about where to split..)</p>
","<c><function><ide><refactoring>","1","84","2012-05-05 04:08:34"
"10470526","only writing ""return false"" once to handle clicking on many links","<p>Instead of writing <code>return false;</code> many times is there a way to set a collection of links such that if any of them are clicked the click function would <code>return false;</code>? I'd still like to have most links <code>return true</code> so showing code that would <code>return true</code> vs. <code>return false</code> would be particularly appreciated. </p>

<p>The goal is writing less code. I'd also like to know if this is a bad idea for reason I can't understand. </p>
","<javascript><refactoring><return>","0","40","2012-05-06 12:34:46"
"10476815","How to make two programs to use only one auto-completion function in bash?","<p>I followed this <a href=""http://www.debian-administration.org/articles/317"" rel=""nofollow"">tutorial</a> to setup auto-completion functions for <code>figlet</code>/<code>toilet</code>.</p>

<pre><code># bash completion for figlet/toilet

have figlet &amp;&amp;
_figlet()
{
    local prev cur opts
    _get_comp_words_by_ref cur prev
    opts=""-f""

    COMPREPLY=()

    case $prev in
        -f)
            local running=$(find /usr/share/figlet -name '*.flf' -printf '%P\n' | sed 's/\.flf$//')
            COMPREPLY=( $(compgen -W ""${running}"" -- ${cur}) )
            return 0
            ;;
        *)
            ;;
    esac

    COMPREPLY=( $( compgen -W ""$opts"" -- ""$cur"" ) )

    return 0
} &amp;&amp;
complete -F _figlet figlet

###################################################################################################

have toilet &amp;&amp;
_toilet()
{
    local prev cur opts
    _get_comp_words_by_ref cur prev
    opts=""-f""

    COMPREPLY=()

    case $prev in
        -f)
            local running=$(find /usr/share/figlet -name '*.[tf]lf' -printf '%P\n' | sed 's/\.[tf]lf$//')
            COMPREPLY=( $(compgen -W ""${running}"" -- ${cur}) )
            return 0
            ;;
        *)
            ;;
    esac

    COMPREPLY=( $( compgen -W ""$opts"" -- ""$cur"" ) )

    return 0
} &amp;&amp;
complete -F _toilet toilet
</code></pre>

<p><code>_figlet</code> and <code>_toilet</code> are almost identical except the pattern in <code>find</code>/<code>sed</code> commands.<br>
How to extract a function called <code>_figlet_toilet</code> which takes a pattern as argument?</p>
","<bash><script><autocomplete><refactoring>","0","36","2012-05-07 04:50:22"
"10479641","How to make a large array usable within a function with good performance","<p>I have a peace of precedural code which is executed in a loop. This peace of code requires one large array, but only for reading and not manipulating purposes. I generate this array once before the loop.</p>

<p>Now I would like to move this code into a function in order to use it again is some other script, but I don't know how to that in a clean way, but still having a good performance:</p>

<ul>
<li>Generating this large array every time in the function itself would be bad, since it is always the same array and creates unnecessary overhead.</li>
<li>I dont want to use a global array, since this is bad practise</li>
<li>I guess therefore it would be the best to pass it as a paremeter every time I call the function.</li>
</ul>

<p>I don't like that last option too much either, because it clutters the argument list and I am not sure about the overhead caused through this. As I understand it the array would be copied every time - would it be a good idea to pass it by reference therefore (by using the &amp; operator)?</p>
","<php><performance><refactoring>","1","74","2012-05-07 09:26:03"
"10482994","How separate method calls with eclipse?","<p>I use IDE Eclipse to wite java code. I have a class structure like this:</p>

<pre><code>class Item
{
    private ItemId id;
    public ItemId getId()
    {
        return this.id;
    }
}

class ItemId {/*just some class*/}
</code></pre>

<p>I also have an utily method with restore Item by it ItemId, method has following signature:</p>

<pre><code>UtilityClass.utilityMethod(ItemId id);
</code></pre>

<p>So, there is a lot of calls like this:</p>

<pre><code>Item unpredictableItemName = ...
UtilityClass.utilityMethod(unpredictableItemName.getId());
</code></pre>

<p>or</p>

<pre><code>ItemId unpredictableIdName = ...
UtilityClass.utilityMethod(unpredictableIdName);
</code></pre>

<p>I want to write new method, that will use already constructed Item object:</p>

<pre><code>UtilityClass.utilityMethod(Item item);
</code></pre>

<p>So the question is:
<strong>How to move calls from</strong></p>

<pre><code>UtilityClass.utilityMethod(unpredictableItemName.getId())
</code></pre>

<p><strong>to</strong></p>

<pre><code>UtilityClass.utilityMethod(unpredictableIdName)?
</code></pre>
","<java><eclipse><plugins><methods><refactoring>","0","61","2012-05-07 13:31:38"
"10488575","Would replacing the parameter to a public method be considered refactoring, or is that going too far?","<p>Let's say that I have a method with the signature:</p>

<pre><code>public static bool ValidDateToSend(DateTime date, string frequency)
</code></pre>

<p>Inside of the method is a switch on frequency.</p>

<p>Would changing the frequency from a string to a public enum, be considered a refactor, or is that going too far?  Since this is a public method, there could potentially be many references outside of this code.  The strict definition of refactoring (and what I believe is meant by fearless refactoring) is </p>

<blockquote>
  <p>disciplined technique for restructuring an existing body of code,
  altering its internal structure without changing its external behavior</p>
</blockquote>

<p>It seems to me that changing a method parameter to using a non-compatible type would indeed constitute ""changing its external behavior"".</p>
","<api><enums><refactoring>","0","21","2012-05-07 20:22:01"
"10507125","Refactoring code to use Boost shared pointers","<p>I wrote a project using normal pointers and now I'm fed up with manual memory management. </p>

<p>What are the issues that one could anticipate during refactoring?</p>

<p>Until now, I already spent an hour replacing <code>X*</code> with <code>shared_ptr&lt;X&gt;</code> for types I want to automatically manage memory. Then I changed <code>dynamic_cast</code> to <code>dynamic_pointer_cast</code>. I still see many more errors (comparing with <code>NULL</code>, passing <code>this</code> to a function). </p>

<p>I know the question is a bit vague and subjective, but I think I can benefit from experience of someone who has already done this. </p>

<p>Are there some pitfalls? </p>
","<c++><refactoring><shared-ptr><smart-pointers>","3","114","2012-05-08 21:53:37"
"10512040","refactor nested switch to objects","<p>I'd like some advice on refactoring the following method:</p>

<pre><code>public boolean makeDecision(String group, int level, int primaryAmount, int secondaryAmount)
{
    if (group.equals(""A""))
    {
        switch (level)
        {
            case 0 : return primaryAmount &gt; 10000;break;
            case 1 : return primaryAmount &gt; 20000;break;
            default : return secondaryAmount &gt; 30000; break;
        }
    }
    else if (group.equals(""B""))
    {
         switch (level)
         {
              case 0 : return primaryAmount &gt; 40000;break;
              case 1 : return primaryAmount &gt; 50000;break;
              default : return secondaryAmount &gt; 60000; break;
         }

    }
    else if (group.equals(""C""))
    {
        switch(level)
        {
            case 0 : return primaryAmount &gt; 70000;break;
            case 1 : return primaryAmount &gt; 80000;break;
            default : return secondaryAmount &gt; 90000; break;
        }

    }
    return false;
} 
</code></pre>

<p>What I'd like to achieve:</p>

<ul>
<li>Allow the code to follow the open/closed principle as there will be more groups / levels in time. </li>
<li>Remove the duplication in the 'level' switch statement. </li>
<li>Ideally remove the 'group' top level switch statement.</li>
</ul>
","<java><design-patterns><refactoring>","2","51","2012-05-09 07:57:46"
"10513291","renaming classes in iOS","<p>I am working on Xcode 4.3.2 i wanted to rename my classes so i used <strong>refactor>rename</strong>, but after that i changed my mind and decided to go back to the older name. But when i do the same thing i've done before again, a warning dialog appears saying: </p>

<p><strong>yourclass.h is not part of the build phase of any targets in this workspace and so can't be refactored. add the file to the build phase of a target in this workspace, or make a selection in another file.</strong></p>

<p>what's the build phase? how can i solve this problem?</p>

<p>Thank you very much</p>
","<ios><xcode><refactoring><rename><file-rename>","0","77","2012-05-09 09:27:11"
"10527982","Changing the name of a protocol.h file breaks the code","<p>When I change the name of a protocol file, the project does not regocnize it any more. Is that normal behavior? Further more, when I refactor the protocol name from the .h file, it changes everything fine (in the code), but not the actual file name..</p>

<p>How can I solve this?</p>

<p>thanks everyone!</p>
","<ios><xcode><refactoring><protocols>","0","31","2012-05-10 05:26:42"
"10532818","Is there any sense in such kind of refactoring?","<p>Given web service method:</p>

<pre><code>public void FindSomeEntities(int? Id, string param1, int? param2, ...)
</code></pre>

<p>Refactored:</p>

<pre><code>public void FindSomeEntities(SelectionParameters selectionParameters)

class SelectionParameters
{
    public int? Id;
    public string param1;
    public int? param2
    ...
}
</code></pre>

<p>Pros:</p>

<ol>
<li>too many parameters in original web service method reduced to the
only one</li>
<li>if there is need to change we won't have to change the
interface of the method - only the definition of SelectionParameters</li>
</ol>

<p>Cons:</p>

<ol>
<li>class SelectionParameters hasn't any business value - it's used only
as helper class and it's used in a single method. As a result we'll
have many methods with 1 parameters and plenty of one-off classes</li>
<li>Actually the interface IS changed, we just push these changes a bit
deeper.</li>
</ol>
","<c#><web-services><refactoring>","0","48","2012-05-10 11:12:56"
"10540016","figuring out/refactoring this if/else for a voting system","<p>I'm having difficulty conceptualizing how to do this in the best way possible without having an enormous if/else structure. I know i could do it that way but I'm trying to abstract it into methods and I'm lost.</p>

<pre><code>upvote = 1
no vote = 0
downvote = -1
</code></pre>

<p>Basically, a person can hit an upvote or a downvote button.</p>

<p>If they click upvote and their current vote is upvote, it 'unvotes' the post and sets it to zero</p>

<p>if they click downvote and their current vote is upvote, it switches it to downvote</p>

<p>if their vote is zero, and they click upvote, it sets the vote to 1</p>

<p>The inverse is true for downvote</p>

<p>This is what i have so far but it doesnt account for clicking upvote after you already clicked upvote.. instead of setting it to 0 it sets it to -1.</p>

<p>I get the problem, im just having difficulty figuring out how to write it</p>

<pre><code>  def update_vote(upvote_or_downvote)
    self.active_vote? ? self.value = 0 : self.alternate_vote
  end

  def active_vote?
    self.value != 0
  end

  def alternate_vote
    self.value *= -1
  end
</code></pre>
","<ruby-on-rails><ruby><ruby-on-rails-3><ruby-on-rails-3.1><refactoring>","1","54","2012-05-10 18:23:03"
"10546898","Remove the duplicated form code by refactoring with Rails","<pre><code>Finished in 15.53 seconds
←[31m86 examples, 4 failures←[0m
</code></pre>

<p>Failed examples:</p>

<pre><code>←[31mrspec ./spec/requests/user_pages_spec.rb:95←[0m ←[36m# User pages signup wi
th valid information should create a user←[0m
←[31mrspec ./spec/requests/user_pages_spec.rb:104←[0m ←[36m# User pages signup w
ith valid information after saving the user ←[0m
←[31mrspec ./spec/requests/user_pages_spec.rb:105←[0m ←[36m# User pages signup w
ith valid information after saving the user ←[0m
←[31mrspec ./spec/requests/user_pages_spec.rb:106←[0m ←[36m# User pages signup w
ith valid information after saving the user ←[0m
</code></pre>

<p>don't understand why im getting this error. i followed instructions at the ruby guides, Problem 5.. <a href=""http://ruby.railstutorial.org/chapters/updating-showing-and-deleting-users?version=3.2#sec:updating_deleting_exercises"" rel=""nofollow"">http://ruby.railstutorial.org/chapters/updating-showing-and-deleting-users?version=3.2#sec:updating_deleting_exercises</a>      </p>

<p>app/views/users/new.html.erb</p>

<pre><code>&lt;%= provide(:title, 'Sign up') %&gt;
&lt;h1&gt;Sign up&lt;/h1&gt;

&lt;div class=""row""&gt;
&lt;div class=""span6 offset3""&gt;
&lt;%= form_for(@user) do |f| %&gt;
&lt;%= render 'fields', f: f %&gt;
&lt;%= f.submit ""Create my account"", class: ""btn btn-large btn-primary"" %&gt;
&lt;% end %&gt;
&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>app/views/users/edit.html.erb</p>

<pre><code>&lt;%= provide(:title, 'Edit user') %&gt;
&lt;h1&gt;Update your profile&lt;/h1&gt;

&lt;div class=""row""&gt;
&lt;div class=""span6 offset3""&gt;
&lt;%= form_for(@user) do |f| %&gt;
&lt;%= render 'fields', f: f %&gt;
&lt;%= f.submit ""Save changes"", class: ""btn btn-large btn-primary"" %&gt;
&lt;% end %&gt;

&lt;%= gravatar_for @user %&gt;
&lt;%= link_to ""change"", ""http://gravatar.com/emails"", :target =&gt; ""_new""%&gt;

&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>app/views/users/_fields.html.erb</p>

<pre><code>&lt;%= render 'shared/error_messages' %&gt;

&lt;%= f.label :name %&gt;
&lt;%= f.text_field :name %&gt;

&lt;%= f.label :email %&gt;
&lt;%= f.text_field :email %&gt;

&lt;%= f.label :password %&gt;
&lt;%= f.password_field :password %&gt;

&lt;%= f.label :password_confirmation, ""Confirm Password"" %&gt;
&lt;%= f.password_field :password_confirmation %&gt;
</code></pre>

<p>when i don't try to settle for refactoring this code, and leaving it duplicated i get no errors.. so i'm thinking <b> /spec/requests/user_pages_spec.rb </b> doesn't really have a problem.. Any suggestions would be appreciated.</p>

<p>and it's weird cause the app doesn't seem to have any problems (or so it seems to have none) but yeah it works perfectly fine.. its just that error that's bugging me.</p>

<p>-Marc</p>
","<ruby-on-rails><ruby-on-rails-3><refactoring><ruby-on-rails-3.2><code-duplication>","0","39","2012-05-11 07:03:04"
"10550568","Rails 3 refactoring ActiveRecord query","<p>I have the following query which looks up an organisation belonging to the current signed in user and then finds any events belonging to that organisation.</p>

<pre><code>def update
    @organisation = current_user.organisations.find(params[:organisation_id])
    @event = @organisation.events.find(params[:id])
    if @event.update_attributes(params[:event])
        # Handle a successful update.
        flash[:success] = ""Event updated""
        redirect_to organisation_event_path
    else
        render 'edit'
    end
end
</code></pre>

<p>This currently results in 2 queries to the database, which whilst not necessarily a problem, I feel should be able to be achieved in one query. Is that possible or does it need to be 2? If the former, how should I go about achieving it?</p>
","<ruby-on-rails-3><query><activerecord><refactoring>","0","32","2012-05-11 11:34:43"
"10564212","What is type code?","<p>I'm reading <a href=""http://rads.stackoverflow.com/amzn/click/0201485672"" rel=""nofollow"">""Refactoring""</a> by <a href=""http://martinfowler.com/books.html"" rel=""nofollow"">Martin Fowler</a>.</p>

<p>There is a term ""type code"" that I've never seen that before.</p>

<p>What is a type code?</p>
","<refactoring><terminology>","0","56","2012-05-12 13:33:24"
"10577202","Refactoring type code override","<p>There's a piece of code I'm currently looking like which serialises/deserialises data. </p>

<p>The class structure looks something like this:</p>

<pre><code>public class Field
{
    public abstract void writeField(DataOutputStream out);

    public abstract int getFieldID();

    ...

    protected static final int INT_FIELD = 1;
    protected static final int BOOL_FIELD = 2;

    ...

    public void write(DataOutputStream out)
    {
        out.writeInt(getFieldID());
        writeField(out);
    }

    ...
}

public class IntField extends Field
{
    public int v;

    public void writeField(DataOutputStream out)
    {
        out.writeInt(v);
    }

    public int getFieldID()
    {
        return Field.INT_FIELD;
    }
}
</code></pre>

<p>I feel like the way getFieldID is implemented is not the best. </p>

<p>Writing an abstract method to return a unique identifier for that class feels like a bad smell. </p>

<p>Is there better ways to go about implementing this? </p>
","<java><refactoring><hierarchy>","1","48","2012-05-14 03:26:52"
"10587238","Refactoring XSDs and/or generating java code","<p>I have been given a legacy set of XSDs for services my app is providing that are in DIRE need of refactoring. As some of the consumer apps have no development team, I cannot change the resultand schema. I can, however, do whatever I want to the actual files.</p>

<p>Here is my directory setup:</p>

<ul>
<li>root<br>
<ul>
<li>subdir1
<ul>
<li>common</li>
<li>development</li>
</ul></li>
<li>subdir2
<ul>
<li>common</li>
<li>development</li>
</ul></li>
</ul></li>
</ul>

<p>Assume, for simplicity, that an increment in version between files adds an element to a complexType, so that a previous version can reapply be considered like a base/super class.</p>

<p>Now, in subdir1/common, I can have Include_v01.xsd and Include_v02.xsd. 
In subdir1/development, I can have svc1_v01.xsd which uses Include_v01.xsd, and svc1_v02.xsd which uses Include_v02.xsd</p>

<p>In Subdir2/common, I can have Include_v02.xsd and Include_v03.xsd
In subdir2/developmen, I can have svc2_v01.xsd which uses Include_v02.xsd, and svc2_v02.xsd which uses include_v03.xsd</p>

<p>I have ~20 such subdirs. I have about 1500 or so XSD files in those directories. Each xsd can have several includes, which can themselves have multiple includes, which can themselves have multiple includes, etc.</p>

<p>Ultimately, I'd like to refactor these to their most simple form, where I'd have only one copy of Include_v02.xsd, for example, and where Include_v02.xsd actually builds off of Include_v01.xsd instead of is a fully seperate copy. Yes, some jerk just copied the file, renamed it, and added one field. Then he copied it to every subdir it would be used in.</p>

<p>More important even than that, is to be able to generate java classes in a similar structure. </p>

<p>Right now, the best I can do is run xjc on the directories, and compile each service's schema into a different package, so I now have tons of copies of the Include_v02 object, in various java packages. I have to do it this way because the schema was not versioned or remaned between versions. The same idiot just copide the file, renamed it, and added a new element, keeping the root element the same and no other distinguishing characteristics.</p>

<p>It's a tall order, and I would settle for some way to easily copy/merge the java objects, or even to simply copy between to identical java objects in different packages.</p>

<p>Episode files, like refered to <a href=""http://stackoverflow.com/questions/9683907/compile-several-xsds-containing-duplicate-definitions-of-the-same-element-with"">here</a>, doesn't seem like it would be any better than the script I use to generate things now, as I'd have to very deliberately figure out each root element, given the multi-layered nesting that is used.</p>

<p>EDIT=============================
If I had, in Include_v01.xsd, the following:</p>

<pre><code>&lt;complexType name=""cmplxtp""&gt;
    &lt;complexContent&gt;&lt;sequence&gt;
         &lt;element name=""st1"" type=""string""/&gt;
     &lt;/complexContent&gt;&lt;/sequence&gt;
&lt;/complexType&gt;
</code></pre>

<p>and, in Include_v02.xsd, I had something like</p>

<pre><code>&lt;complexType name=""cmplxtp""&gt;
    &lt;complexContent&gt;&lt;sequence&gt;
         &lt;element name=""st1"" type=""string""/&gt;
         &lt;element name=""st2"" type=""string""/&gt;
     &lt;/complexContent&gt;&lt;/sequence&gt;
&lt;/complexType&gt;
</code></pre>

<p>I would love some combination of </p>

<p>either the XSD refactored to be</p>

<p>Include_v01.xsd the same
Include_v02.xsd
    
        
             
         
    </p>

<p>OR</p>

<p>All the individual elements (complex, or simple) left in Include_v01.xsd
Include_v02 to include Include_v01.xsd, with only the new elements added</p>

<p>OR</p>

<p>two java classes</p>

<pre><code>package pack1;
class cmplxtp {
    public String st1;
}
</code></pre>

<p>and</p>

<pre><code>package pack2;
class cmplxtp extends pack1.cmplxtp  {
    public String st2;
}
</code></pre>

<p>The java classes are the most important to me, but anything that helps to get there would be outstanding.</p>

<p>If none of that is at all possible, simple, or worth it, I'd also be more than grateful for some simple way of copying identical objects from one to another if they exist in different packages. I just really want to simplify my codebase, I have 160 or so services, with many versions each, and each versoin can include the SAME EXACT file. This means in my gen'd code, I can have maybe 300 or more definitions of the same class, but in different packages because of the copied includes.</p>
","<java><xsd><jaxb><xjc><automated-refactoring>","1","69","2012-05-14 16:20:33"
"10588470","How to avoid duplicate code when operating on DOM in ""up"" and ""down"" direction?","<p>I'm writing a JS webapp client. User can edit list/tree of text items (say, a todo list or notes). I manipulate DOM with jQuery a lot.</p>

<p>User can navigate the list up and down using keyboard (similar to J/K keys in GMail), and perform several other operations. Many of these operations have mirror ""up"" / ""down"" functionality, e.g.</p>

<pre><code>$.fn.moveItemUp = function() {
    var prev = this.getPreviousItem();
    prev &amp;&amp; this.insertBefore(prev);
    // there's a bit more code in here, but the idea is pretty simple,
    // i.e. move the item up if there's a previous item in the list
}

$.fn.moveItemDown = function() {
    var next = this.getNextItem();
    next &amp;&amp; this.insertAfter(next);
    // ....
}
</code></pre>

<p>Now this pattern of having two almost identical functions is repeated in several places in my code because there are many operations on the list/tree of items that are pretty much symmetrical.</p>

<p><strong>QUESTION:</strong> How do I refactor this elegantly to avoid code duplication?</p>

<p>The trivial way I came up with so far is to use .apply()...</p>

<pre><code>$.fn.moveItem = function(direction) {
        var up = direction === 'up',
            sibling = up ? this.getPreviousItem() : this.getNextItem(), 
            func = up ? $.fn.insertBefore : $.fn.insertAfter;

        // ...

        if (! sibling) { return false; }

        func.apply(this, [ sibling ]);

        // ...
    };
</code></pre>

<p>The benefit is easier maintenance when structure of other elements of the code requires changing moveUp/moveDown. I've already needed to slightly change the code multiple times, and I always need to keep in mind that I need to do it in two places...</p>

<p>But I'm not happy with the ""unified"" version, because:</p>

<ul>
<li>Implementation is more complicated than simple moveUp/moveDown, hence in the future it may NOT be so easy to maintain afterall. I like simple code. All these parameters, ternary operations, .apply() tricks in every function that's supposed to go ""up"" and ""down""...</li>
<li>Not sure if it's safe to refer to jQuery.fn.* functions explicitly (after all they're supposed to be used by applying them to jQuery object $('...').*)</li>
</ul>

<p>How do you solve those ""almost identical code"" situations when working with DOM or similar structure?</p>
","<javascript><jquery><refactoring><code-duplication>","6","71","2012-05-14 17:50:12"
"10604651","Rails 3 - Validating Multiple Instances of a Model Against Each Other","<p>I'm working on an app that handles employee timecards, and I'm trying to create a form that allows employees to edit all of their punches in a given block of time. I used <a href=""http://railscasts.com/episodes/198-edit-multiple-individually"" rel=""nofollow"">this RailsCast</a> as the foundation for the form, and was able to get things up and running with no trouble:</p>

<pre><code>class BlocksController &lt; ApplicationController

def update
    @block = Block.find_by_id(params[:id])
    @punches = @block.punches

    keys = params[:punches].keys
    values = keys.map { |k| params[:punches][k] }
    @punches = Punch.update(keys, values).reject { |p| p.errors.empty? }
    if @punches.empty?
      flash[:notice] = ""Punches updated""
      redirect_to employee_timecard_path(current_user, @block.timecard)
    else
      render :action =&gt; ""edit""
    end
  end
</code></pre>

<p>The problem, though, is that I need to be able to validate that the user didn't edit their punches in a way that doesn't make sense (e.g. changing their clock-in punch to be later than the clock-out punch, or vice versa). </p>

<p>I tried doing this through a custom model validation, but the individual models passing through the validation have no knowledge of the other values being updated, so the first punch in the batch is comparing its new value against the pre-update values of the others. </p>

<p>The only other approach I could think of was to loop through the <code>params[:punches]</code> being sent to the update method in the controller, but this seems to run contrary to the convention of ""fat model, skinny controller"". </p>

<p>Is there any way I can have my cake and eat it too? Any suggestions would be much appreciated.</p>
","<ruby-on-rails><forms><validation><architecture><refactoring>","0","63","2012-05-15 16:04:57"
"10628010","To generalize a function that accesses multiple types of object (via function & array)","<p>I now have 2 functions to construct <code>html</code> to display, depending on data source; 1 is from <code>database</code>, the other is from <code>form</code> <code>post</code>.</p>

<pre><code>function buildForm_newUser($user){
     $html_username = 'Username = ' . $_POST['username'];
     $html_location = 'location = ' . $_POST['location'];
     : // similar rows follow more than 20 times 
}

function buildForm_exsitingUser($user){
     $html_username = 'Username = ' . $user-&gt;get_property('username');
     $html_location = 'location = ' . $user-&gt;get_property('location');
     :
}
</code></pre>

<p>Is it possible to achieve these with only 1 function?</p>

<p>I tried to switch source object (i.e. <code>$user</code> and <code>$_POST</code> above) but then got stuck since the latter function uses function of the designated object, whereas the former doesn't. Also, because there are many rows that have to access either object, I like to declare newly generated variables ($html_* variables in the example above) at <strong>only one location</strong>. That said, I want something like this:</p>

<pre><code>function buildForm($user){ // Number and type of argument can vary

     // Do something here to specify object type

     $html_username = 'Username = ' . // following here, either $_POST or $user-&gt;get_property to get 'username'
     $html_location = 'location = ' . // following here, either $_POST or $user-&gt;get_property to get 'location'
     :
}
</code></pre>

<p>Thanks.</p>

<p>(Also appreciate suggestion for better title...)</p>
","<php><refactoring>","-1","34","2012-05-16 23:16:04"
"10639486","System Error 33 when generating an audio sine wave in C#","<p>I have been working on making this sine wave portion of my code for about 3 days now. With the help of others I finally got the program to produce a sine wave and output it directly to speakers. Since my program is rather large it might just be easier for you to navigate through my code and read it directly. I have it uploaded on Google Code here:</p>

<p><a href=""http://code.google.com/p/adli/source/browse/#svn%2Ftrunk%2FAspects"" rel=""nofollow"">http://code.google.com/p/adli/source/browse/#svn%2Ftrunk%2FAspects</a></p>

<p>the files of interest are:</p>

<ul>
<li>\Tests\UnitTests.cs : TestSoundOut()</li>
<li>\Custom\Audio\WaveOut\WaveOut.cs</li>
<li>\Custom\Audio\WaveOut\WaveOutBuffer.cs</li>
<li>\Custom\Audio\WaveBase\WaveBuffer.cs</li>
<li>\Custom\Audio\WaveProvider\SineWaveProvider.cs</li>
</ul>

<p>you of course can use subversion to download the whole bit and run it for yourself.</p>

<p>Any who, so in TestSoundOut i basically setup a for loop from 100-7000 (i wanted 10k) i have my frequency set to the iterator, play the sound for 100ms stop the sound then loop. Problem is it constantly crashes with Error 33 (ERROR_LOCK_VIOLATION 33 (0x21) ). I understand the error code. And although I copied my code from a couple of different sources (NAudio and another open source project called SoundViewer). In SoundViewer the person used Lock(<strong>some object</strong>) and then did different things. I didn't care for the structure of his program as I felt it could benefit from abstraction of the buffer. I think this is were I messed up as I don't think the code looks as good as it could. I was hoping to get a better understanding of the code and then refactor it yet again. (I don't care for that approach but as I learn how to program better from a few books I'm reading it seems inevitable that i feel that i have to change) so sorry about the mess.....but I'm off topic.</p>

<p>Also another problem i am having is that there is a definite noise problem instead of a nice clean sound wave. I'm thinking what is happening is that the buffer is not getting emptied before it gets another one. I think that i might be trying to achieve to much by having my sample rate at 44.1k. I don't seem to get as many problems at 16k sample rate though. I just don't get how NAudio can achieve 44.1k sampling and I can't. The code isn't all that much different. If anything because my program uses less resources it shouldn't be as laggy. And I'm assuming that the lagging is causing the noise and the lock violations. So can I get some help in understanding why my code is failing? I just don't know were to pin point my problem but i think it is in the buffer file..but i just don't know.</p>
","<c#><audio><refactoring><naudio>","0","29","2012-05-17 16:16:33"
"10664398","Self related model refactoring and url's","<p>I am working on building a photo gallery on my personal website and all it's data is pulled from Flickr via it's API.</p>

<p>I have had Albums and Photos displaying on the site for a while now. Those are all good.</p>

<p>I then registered for a premium Flickr account and gained access to use Collections to organise my Albums.</p>

<p>I then used it's API to add a Collection model and pulled all it's collections over and assigned each album a parent_id to point to it's owner collection.</p>

<p>Each collection can have child collections but not child collections AND child albums.</p>

<p>I have got everything working using this set of relationships:</p>

<p>Collection.rb:</p>

<pre><code>has_many :children, class_name: ""Collection"", foreign_key: ""parent_id""
belongs_to :parent, class_name: ""Collection"", foreign_key: ""parent_id""
has_many :albums
</code></pre>

<p>Album.rb:</p>

<pre><code>has_many :photos, :dependent =&gt; :destroy
belongs_to :collection
</code></pre>

<p>On my Collection index action I display all the top level collections and then on each collection name I link to the same index action but pass a collection_id so when the page reloads it can use that id to find collections that have that as a parent. and so on.</p>

<p>If a collection is entered that doesn't have child collections, it checks for albums and if they exists then it displays them.</p>

<p>What I would like to know is how I can alter my URL to make then more user friendly. Currently IF i go to my collection index and drill down to a second level collection the URL looks similar to this:</p>

<pre><code>http://localhost:3000/collections?collection=114
</code></pre>

<p>Is this correct?, how would you guys do it?</p>

<p>I just would like some thoughts and suggestions. Also, if albums are found for a collection it redirects to the albums index action and passes the collection id and the URL looks like:</p>

<pre><code>http://localhost:3000/albums?collection=113
</code></pre>

<p>To me, something does not seem right and I am sure there is a better solution.</p>
","<ruby-on-rails><model><refactoring><routes><relationship>","0","29","2012-05-19 10:34:58"
"10675103","How do I refactor my CSS?","<blockquote>
  <p><strong>Possible Duplicate:</strong><br>
  <a href=""http://stackoverflow.com/questions/2253110/how-to-manage-css-explosion"">How to Manage CSS Explosion</a>  </p>
</blockquote>



<p>I intended to build my web site with consistent styles and a coherent CSS scheme.  But styles have crept out of control as I fine-tune individual pages (especially the main search form).  </p>

<p>I've already gone through the process one time of breaking down the styles and rebuilding almost from scratch, and now it looks like time to do that again.  How can I be efficient about this?  I'm looking for a methodology, not a software utility (though I'm open to suggestions there...unless they cost money...).  </p>

<p><strong>Added note:</strong>  I'm using a CSS framework and it's difficult to keep <code>padding</code> and <code>margin</code> coordinated.  </p>

<p><strong>Added note 2:</strong>  The initial responses to this post are about best practices for CSS.  Let's assume I already tried to follow best practices (in fact, I did).  Now it's the clean-up procedure I'm looking for.</p>

<p><strong>Added note 3:</strong>  As of 14 June, combining <a href=""http://stackoverflow.com/questions/3720174/how-to-remove-css-spaghetti-in-legacy-web-app?rq=1"">this response</a> (which I just found) with my post below is possibly a comprehensive answer.  </p>

<p><strong>Closure notes:</strong>  </p>

<p>I learned my question is too general, and for that reason I wish I hadn't posted it.  (Maybe that's why it got a down-vote ... I'll never know without a comment to explain the reason.)  On the other hand I got just what I needed, so I'm happy I did post it.  </p>

<p>I'm surprised I didn't get an up-vote for my answer -- even with the priceless input by others, I think it stands up pretty well.  </p>

<p>My acceptance is going to be based largely on the usability of the answer, from my point of view -- a point of view that is sadly unable to digest some of the more exciting and comprehensive responses.  </p>

<p><strong>Closed as an Exact Duplicate</strong></p>

<p>I just tried posting this again (subject, body, tags) to see if SO would suggest the post ""How to Manage CSS Explosion"".  Interestingly, it did not.  I added the tag <code>refactoring</code> to that post.</p>
","<css><refactoring>","10","483","2012-05-20 16:19:50"
"10692447","Can a database be refactored in SQL Server?","<p>We have a relatively new database project that we have been writing views and stored procedures for over the last 6 months or so.</p>

<ul>
<li>The database works</li>
<li>The views work</li>
<li>The stored procedures work</li>
</ul>

<p>However, the general scope of the project has grown considerably since this project was started, and now some of the table names and field names are a little off base.</p>

<p>For example, the main table in the database is called <code>SheetMetalRequest</code>, but the project has grown to where an actual Sheet Metal Request is now but one of the enumerable types of requests. So, the name on this table is misleading to people coming into the project.</p>

<p>In addition to this main table, there are various columns in other tables that need to be changed as well (think <code>SheetMetalRequestID</code>, for example).</p>

<p>The problem with making this change are the 10 different Views and 30 Stored Procedures that are now a part of this database. Naturally, if something gets changed and not everything is changed with it, our working <em>pre production</em> database could take several man hours to get back to a running state.</p>

<p>It would be <strong>GREAT</strong> if there were a <em>Refactor</em> ability somehow like what exists in Visual Studio.</p>

<pre><code>SELECT SERVERPROPERTY('productversion'), SERVERPROPERTY('productlevel'), SERVERPROPERTY('edition')

productversion | productlevel | edition
10.0.1600.22   | RTM          | Standard Edition (64-bit)
</code></pre>
","<visual-studio-2010><sql-server-2008><refactoring>","3","74","2012-05-21 20:51:12"
"10692955","better ruby - possible to not repeat parts of a function?","<p>I have a little sinatra api that I'm trying to beautify. Most of my routes are simple db operations but a few involve calling an external service before doing db operations. In all cases most of the code is the same except for how I respond to the service response. Is there any slick functional programming approach?</p>

<p>Here's an example of one of these routes:</p>

<pre><code>  get '/update_x' do
    validateParams(params,:x)
    xid = params[:x]
    xName = getNameFromId(xid)

    if xName
      # Make request to proxy service
      rid = generateRandomHexNumber(16) # generate requestId
      params['m'] = 'set'
      params['rid'] = rid

      json = ""{}""      
      begin
        response = @resource[""/""+""?rid=#{rid}&amp;id=#{xid}&amp;json=#{json}""].get
        status = response.code
        body = response.body

        parsed_json = JSON(body)
        if parsed_json['response'] and parsed_json['response']['success'] and parsed_json['response']['success']=='false'
          msg = {:success =&gt; ""false"", :response =&gt; ""unknown error""}
          if parsed_json['response']['response']
            msg = {:success =&gt; ""false"", :response =&gt; parsed_json['response']['response']}
          end
          content_type :json
          msg.to_json
        else

         #### Here is stuff specific to this api call

          updateDBHelper(xid,buildUpdateOptions(params))

          params['ss_status'] = status
          content_type :json
          params.to_json

          #### End specific to api call
        end 
      rescue Exception=&gt;e
        params['ss_status'] = status
        params['exception'] = e
        content_type :json
        params.to_json
      end
    else
      msg = {:success =&gt; ""false"", :response =&gt; ""Not found""}
      content_type :json
      msg.to_json
    end
  end
</code></pre>
","<ruby><functional-programming><refactoring><sinatra>","2","59","2012-05-21 21:33:49"
"10705141","How to perform effort estimation?","<p>I have been tasked to perform code refactoring / code reviews on quite a number of classes. </p>

<p>How do I systematically calculate the effort require over 3000+ files? Google has CodePro AnalytiX which compute the Average Cyclomatic Complexity metric for each files. </p>

<p>What are the metric / tools I can use to give a baseline estimation? </p>
","<testing><refactoring><project-management><code-review>","1","61","2012-05-22 15:27:40"
"10708321","Rails code refactoring tool for Mac","<p>I am looking for a refactoring tool for rails application in Mac. After researching for whole week I am kind of surprised that there is no good tool available to refactor namespace/controller/model/view/routes in one go. I am bit new to Mac paradigm so may be I am missing something.</p>

<p>I can see few couple of gems developed for Rails which can do some rename/replace but still it requires ""manual adjustments"" after refactor.</p>

<p>To provide my requirement, here is standard Rails projects </p>

<pre><code># routes
map.namespace :admin do |admin|
  admin.resources :items
end
match ""/admin/items/:id/enable"" =&gt; ""admin/items#enable""

# model
/app/models/items.rb
class item &lt; ActiveRecord::Base

end

# views
/app/views/admin/items/
/app/views/admin/items/index.html.erb
/app/views/admin/items/show.html.erb
/app/views/admin/items/new.html.erb
/app/views/admin/items/edit.html.erb


# controller
/app/controllers/admin/items_controller.rb

class Admin::ItemsController &lt; ApplicationController
  def index
    #
  end

  def show
    #
  end

  def enable
    #
  end
end
</code></pre>

<p>My requirement for this tool is very basic:</p>

<p>Refactoring: ""item"" to ""product"" - with case match</p>

<ol>
<li>Tool should rename any file contains ""item"" to ""product""</li>
<li>Tool should rename any folder contains ""item"" to ""product""</li>
<li>Tool should find and replace ""item"" and to ""product"" in all files in current or sub directory.</li>
</ol>

<p>With above feature:</p>

<p>I can simply reactor whole project by:</p>

<pre><code>&gt; refactor ""item"" ""product""
&gt; refactor ""Item"" ""Product""
&gt; refactor ""admin"" ""shop""
&gt; refactor ""Admin"" ""Shop""
</code></pre>

<p>Greatly appreciate if you can help me to provide link of any Mac tool or any script which can fulfill my above requirement.</p>
","<ruby-on-rails-3><osx><refactoring>","2","106","2012-05-22 18:59:26"
"10708380","What is the best way to break a very big C function with around 50 local variables into smaller functions?","<p>I have a 3500 lines long C function written by someone else that i need to break it apart without causing any regression. Since it is in C, the main problem i face is maintaining the state of the variables. For example if i break a small part of the code into another function, i will need to pass 10 arguments. Some of them will actually change inside the code of the new function. So effectively i will need to pass a pointer to them. It becomes very messy. Is there is better way of dealing with such refactoring? Any ""best practice""?</p>
","<c><variables><refactoring><local>","0","72","2012-05-22 19:03:20"
"10717489","pattern: passing unchecked objects as ruby method default parameter","<p>I'm refactoring some code, and i found something like</p>

<p><strong>EDIT</strong>: </p>

<p>Setting is a Hash stored in my database. So imagine a key-> value structured stored in a database. So if its not accessible, it will generate an exception</p>

<pre><code>def MyClass

 def my_method(foo = Settings[:foobar]
   foo
 end

 def your_method
   my_method
 end
</code></pre>

<p>end</p>

<p>I don't think it safe, because, there is no checking if the Settings[:foobar] exists. My question is:</p>

<p>would it be safer to write it like:</p>

<pre><code>def MyClass
   def my_method(foo)
     foo unless foo.nil?
   end
   def your_method
       my_var = Settings[:foobar] rescue ""default value""
       my_method my_var
   end
end
</code></pre>

<p>and if not, any other good alternative?</p>
","<ruby><refactoring>","0","19","2012-05-23 09:52:32"
"10729164","Systematically replace namespaces","<p>SO I have a HUGE C#/ASP.NET application that is now getting re-appropriated for other projects. I would like to change our project specific namespaces to something more generic. </p>

<p>Using the right-click refactor on the namespace name only globally changes imports for that specific file. This will be a huge ordeal by hand. Is there a better way to do it than just carefully done find and replace?</p>

<p>Also, we use codebehinds so front-facing aspx pages will also have to change their imported namespaces.</p>

<pre><code>&lt;%@ Page Language=""C#"" AutoEventWireup=""true"" CodeBehind=""Read.aspx.cs"" Inherits=""ProjectSpecificNamespace.Read"" %&gt;
</code></pre>

<p>and of course the cs file imports and any references in inline code pages will also have to change.</p>
","<c#><.net><namespaces><refactoring>","1","47","2012-05-23 23:14:48"
"10738692","How can I refactor this unfortunate partial class?","<p>I've started working with a Linq2Sql data access layer and it has a ""God Class"" partial class, the other partial of which is a generated EntitySet. This partial class does all kinds of things, like serialize itself to Json, make database calls and various utility functions, as well as define a host of convenience properties and methods for interacting with the model it ""partials"" with.</p>

<p>As a side effect of this, it's impossible to serialize, and all the other problems with the ""God Class"" antipattern.</p>

<p>What's a good design pattern for splitting these classes up to get better separation of concerns? I'd like to place an emphasis on ease-of-refactoring, as this class is sprinkled throughout the application.</p>
","<design-patterns><refactoring><partial-classes>","1","36","2012-05-24 13:42:41"
"10741419","Are function aliases bad?","<p>Did you ever write a function Foo, use it in your program, then eventually decided to refactor your code and rewrite another function Bar, that is better than Foo, and decided ""Oh well, we'll use Bar instead of Foo from now on"". But instead of just deleting Foo and replacing every occurence of Foo in the code, you decided to declare Foo as an alias of function Bar ? </p>

<p>Some of you may say : why didn't you just rewrite function Foo and keep its name as Foo, so you don't have to replace every occurence of Foo with Bar ? well, because of the refactoring, Foo isn't an appropriate name anymore, because it does not reflect what the function does, so I decided to not keep its name. </p>

<p>Is this some kind of retrocompatibility ?</p>

<p>EDIT : Suppose </p>

<ol>
<li>Foo was written by one of you coworkers</li>
<li>said coworkers are used to Foo</li>
<li>you're the moron in the story who thinks is smarter than the others and wrote Bar</li>
</ol>
","<function><refactoring><alias>","0","29","2012-05-24 16:19:53"
"10747497","Refactoring jQuery slider code suggestions","<p>I needed to build a slider, and this is my first attempt. I'm trying to make it as dynamic as possible. My code works, but I'm wondering if there is a better way and if anyone has any suggestions. I'll be making the width calculated as well. I just have it hardcoded for testing.</p>

<p>Also, I need to make pagination for this. I'm not sure where to start with the way I have things set up. Any hints as to where to start would be much appreciated.</p>

<p>Here is the link to the working slider: <a href=""http://wss.manage-website.com/stg/4406"" rel=""nofollow"">http://wss.manage-website.com/stg/4406</a></p>

<p>Javascript:</p>

<pre><code>jQuery.noConflict();
  jQuery(document).ready(function ($) {
    function doAnimation() {
      count = $('.slider img').length;
      $('.slider img').each(function(index) {
        // calculate and asign z-index to the images. First image in the stack recieves highest.
        var zindex = count - index;
        $(this).css('z-index', zindex);
        $(this).delay(3000*index).animate({
          left: '495px'
        }, 500, function() {
          $('.slider img').each(function(index) {
            // convert z-index to an integer
            var zindex = parseInt($(this).css('z-index'));
            // calculate z-index of images to retain order in the stack. Send this one to the back, push the rest up one.
            if (zindex &lt; count) {
              $(this).css('z-index', zindex + 1);
            } else {
              $(this).css('z-index', zindex - (count-1));
            }
          });
          $(this).animate({
            left: '0'
          }, 500, function() {
            // if we're at the end, repeat.
            if (index == count - 1) {
              setTimeout(doAnimation,1500);
            }
          });
        });
      });
    }
    doAnimation();
  });
</code></pre>
","<javascript><jquery><refactoring>","0","24","2012-05-25 01:45:39"
"10749946","Java: using command pattern in the following code","<p>I have code similar to following:</p>

<pre><code>void processObjectRecursively(Object obj)
{
    Field[] fields = obj.getClass().getDeclaredFields();

    for(Field field : fields)
    {
        FieldType type = FieldUtils.getType(field); // FieldType is enum
        Object value = field.get(obj);

        switch(type)
        {
            case A:
            processObjectRecursively(value);
            continue;

            case LIST:
            processList((List&lt;?&gt;)value);
            continue;

            case B:
            processB(value);
            continue;

            case C:
            processC(value);
            continue;
        }
    }
}

void processList(List&lt;?&gt; list)
{
    for(Object obj : list)
    {
        processObjectRecursively(obj);
    }
}

void processB(Object obj)
{
    // do something
}

void processC(Object obj)
{
    // do something
}
</code></pre>

<p>Now. I don't like this long switch case. So I'm thinking of creating commands and populating a Map with them where the type is the key and the value is its corresponding command object. With this, the method would look something like:</p>

<pre><code>void processObjectRecursively(Object obj)
{
    Field[] fields = obj.getClass().getDeclaredFields();

    for(Field field : fields)
    {
        FieldType type = FieldUtils.getType(field); // FieldType is enum
        Object value = field.get(obj);
        Command command = commandMap.get(type);
        command.execute(value, this); // 'this' needed for calling processObjectRecursively()
    }
}
</code></pre>

<p>But for this I will need to create one interface and four more classes. So is this approach okay or is it over-engineered? Can you suggest any other simpler approach to achieve the same effect?</p>
","<java><design-patterns><refactoring>","0","96","2012-05-25 07:03:30"
"10754268","Managing debugging code","<p>Using IDE's debugging becomes very long in some projects, specially when working with graphics, so sometimes I use debugging code, which prints out values, depending on the environment, sometimes on the project itself and sometimes on the console. But when the project is done, it becomes difficult to find the debugging code, and remove it, and when an unwanted thing pops, it appears odd. I am still a student so its better to learn now then later, how to manage it?</p>

<p>I couldn't find the proper answer upon searching, but I have a few things in mind:</p>

<ol>
<li><p>Remove the code as soon as a module is tested, so there is less to find. It works but when the modules have to be tested later (at a higher level) it has top be added again, not to the extent of what was removed but still.</p></li>
<li><p>Surround it with <code>if</code> to make sure it only runs when <code>debugging</code> flag is true, and keep it in the final version of the project.</p></li>
<li><p>Plan the debugging code with the project, keep the methods and classes separate (where possible)  and erase the calls and objects and when things are done.</p></li>
</ol>

<p>What is the proper way of managing it?</p>
","<debugging><language-agnostic><refactoring><project-management>","0","31","2012-05-25 12:16:00"
"10769841","Ruby code refactoring","<p>I have n-times similar statements</p>

<pre><code>    if trigger_data.tt_closed
      unless trouble_ticket.changes.key?(:status)
        @run = 0
        break
      end
      unless trouble_ticket.changes[:status][1] == ""Closed""
        @run = 0
        break
      end
    end

    if trigger_data.tt_assignee
      unless trouble_ticket.changes.key?(:assigned_to)
        @run = 0
        break
      end
      unless trouble_ticket.changes[:assigned_to][1] == trigger_data.tt_assignee
        @run
        break
      end
    end
</code></pre>

<p>How to refactoring that code? Maybe dynamic statement build with pass some hash to input. I'm newbie in metaprogramming. Give me advise please</p>
","<ruby><refactoring>","0","63","2012-05-26 21:15:55"
"10775534","Refactoring a static class to separate its interface from implementation","<p>I am working on a .NET based application, where some of the core application classes were designed with only <em>static</em> methods.</p>

<p>Example usage:</p>

<pre><code>// static access.
Parameters.GetValue(""DefaultTimeout"");

// static access.
Logger.Log(""This is an important message!"");
</code></pre>

<p>There's already code out there that uses these static methods, so this ""interface"" cannot be changed.</p>

<p>These classes currently implement no interface. I would like to be able to separate the actual implementation of these classes from their interface.</p>

<p>The reason for this refactoring is that these objects will be used across AppDomain boundaries. I would like to be able to inject a ""proxy"" object that on non main-appdomains will invoke some other implementation instead of the default one.</p>

<p>To sum up, my questions are:</p>

<ol>
<li><p>How can i easily transform objects with static-only access to an interface based design, such that their implementation may be replaced when needed (but keeping static access).</p></li>
<li><p>Once refactored, how/WHEN is the actual injection of the non-default implementation should occur?</p></li>
</ol>
","<c#><.net><oop><design><refactoring>","3","121","2012-05-27 16:32:38"
"10781050","Java: code duplication in classes and their Junit test cases","<p>I've been writing code that processes certain fields of an object by modifying their values. To test it, I first wrote a JUnit test case that recursively traverses fields of an object and makes sure they're correctly modified. The CUT (Class Under Test) does something vary similar: it recursively traverses fields of an object and modifies them as required.</p>

<p>So the code to recursively traverse the fields remains the same in test case and CUT, and is currently duplicated, which is against DRY. So I have two questions:</p>

<p>1) have you come across such situations in your project? If yes, did you apply DRY, or let such duplication remain as is?</p>

<p>2) if I put this common code in a util method, I will need to write a test case to test that, which would again involve traversing fields recursively. So how can this be solved without adding any duplication?</p>
","<java><junit><refactoring>","1","44","2012-05-28 07:44:16"
"10809549","How to make ropemacs faster in emacs?","<p>I'm using ropemacs and company-mode for code completion in emacs.</p>

<p>However, I oftern found ropemacs slow, for example, when I type in</p>

<pre><code>import os
os.
</code></pre>

<p>Then ropemacs will try to do the completion for the methods under os modular, which will make the emacs stuck for 5~6 seconds.</p>

<p>Is there a way to avoid this situation?</p>
","<python><emacs><refactoring><rope>","3","67","2012-05-30 03:15:36"
"10820156","JavaScript - refactor getElementById","<p>I use alot of getElementById and I have a question about what is the best way to refactor it.</p>

<p>As many already did, I use this code to make it simpler, easier and to reduce the file size:</p>

<pre><code>    function $(id){
return document.getElementById(id);
}
</code></pre>

<p>But over to what I need help with: is it better to add a variable with the <code>document.getElementById</code> and just change them in every function I need it? Or, should I just stick to what I already have (the usage of <code>$(id)</code>)</p>
","<javascript><refactoring><getelementbyid>","1","74","2012-05-30 16:14:57"
"10820260","design pattern: refactor the code like these","<p>I plan to to refactor my code below</p>

<pre><code>1.Class A_Builder to build A_Model

Class A_Builder{
public A_Model build(arg1){
//build A_Model
}
}


2.Class B_Builder to build B_Model

Class B_Builder{
public B_Model build(arg2,arg3){
//build B_Model
}
}

3.Class C_Builder to build C_Model
Class C_Builder{
public C_Model build(arg4){
//build C_Model
}
}

4.Class D_Builder...
</code></pre>

<p>One builder to build a model,so I plan to use command pattern to refactor them,make build method as a command,but how to handle the different variable number like A is (arg1) and B is (arg2,arg3)</p>

<p>or any idea to refactor the code like these?thanks in advance.</p>
","<java><oop><design-patterns><java-ee><refactoring>","0","86","2012-05-30 16:20:30"
"10830825","Consistent renaming of fields in eclipse","<p>When refactoring a field, the default behaviour in eclipse is to rename just the field, leaving accessor methods with inconsistent names.</p>

<p>Pressing <code>Alt+Shift+R</code> twice shows a ""Renaming dialog"" where I can select if accessors should be renamed as well (as two separate options). This eases the pain of manually renaming the accessors, but is still quite suboptimal, involving pressing 3 more shortcuts than with the in-place renaming, plus my usual forgetfulness... :) </p>

<p>I cannot think of a reason why I would NOT like my refactoring to be consistent, so is there a way to make accessor renaming the default behaviour? I'm OK with tweaking cryptic settings and setting obscure flags as long as it works.</p>

<p>Thank you</p>
","<java><eclipse><refactoring>","7","79","2012-05-31 09:25:27"
"10832219","private final composition mapping generation macro in Intellij Idea or Eclipse","<p><em>I find that I need to frequently favor composition over inheritance and consequently a lot of the lines of code I need to produce are made of the mappings between the <code>private final Contract implementation</code> and the <code>Contract</code> interface methods.</em></p>

<h3>(Predictable) Mapping Example</h3>

<pre><code>public abstract class Sloth&lt;T&gt; extends BaseAnimal implements Valuator&lt;T&gt; {

    private final Valuator&lt;T&gt; valuator = new GenericValuator&lt;T&gt;();

    @Override
    public void setValue(T value) {
        valuator.setValue(value);
    }

    @Override
    public void clearValue() {
        valuator.clearValue();
    }

    @Override
    public T getDefault() {
        return valuator.getDefault();
    }

    @Override
    public T getValue() {
        return valuator.getValue();
    }

    @Override
    public void addStorageBidListeners(OnStorageBid&lt;T&gt;... onStorageBid) {
        valuator.addStorageBidListeners(onStorageBid);
    }

}
</code></pre>

<hr>

<p>Is there any way to <strong>auto-generate</strong> this mapping:</p>

<ul>
<li>In principle it should suffice to just supply the interface and the implementation?</li>
<li>At the moment I'm manually writing out all the <code>valuator.</code> mappings, Im hoping there is a shortcut to such automatic refactoring?</li>
</ul>
","<java><eclipse><ide><refactoring><intellij-idea>","1","24","2012-05-31 10:55:21"
"10835102","How can I refactor this C# code to make it easier to read?","<p>This is an action within a Controller of mine - I have similar large methods in my Controllers throughout my project.</p>

<p>I am trying to learn where to put these things and how to clean things up.  I am new at doing this, if I saw a good example at how to change some of my own code, it would likely teach me how to do it to large amounts of my code.</p>

<p>Here is my action:</p>

<pre><code>public ActionResult Index(string sortOrder, string currentFilter, string searchString, int? page)
{
    ViewBag.CurrentSort = sortOrder;
    ViewBag.TitleSortParm = String.IsNullOrEmpty(sortOrder) ? ""Title desc"" : """";
    ViewBag.CreditsSortParm = sortOrder == ""Credits"" ? ""Credits desc"" : ""Credits"";
    ViewBag.ElectiveSortParm = sortOrder == ""Elective"" ? ""Elective desc"" : ""Elective"";
    ViewBag.InstructorSortParm = sortOrder == ""Instructor"" ? ""Instructor desc"" : ""Instructor"";
    ViewBag.YearSortParm = sortOrder == ""Year"" ? ""Year desc"" : ""Year"";
    ViewBag.AttendingDaysSortParm = sortOrder == ""AttendingDays"" ? ""AttendingDays desc"" : ""AttendingDays"";
    ViewBag.AttendanceCapSortParm = sortOrder == ""AttendanceCap"" ? ""AttendanceCap desc"" : ""AttendanceCap"";
    ViewBag.StartDateSortParm = sortOrder == ""StartDate"" ? ""StartDate desc"" : ""StartDate"";
    ViewBag.LocationSortParm = sortOrder == ""Location"" ? ""Location desc"" : ""Location"";
    ViewBag.ParishSortParm = sortOrder == ""Parish"" ? ""Parish desc"" : ""Parish"";
    ViewBag.DescriptionSortParm = sortOrder == ""Description"" ? ""Description desc"" : ""Description"";
    ViewBag.ApprovedSortPArm = sortOrder == ""Approved"" ? ""Approved desc"" : ""Approved"";
    ViewBag.CompletedSortPArm = sortOrder == ""Completed"" ? ""Completed desc"" : ""Completed"";
    ViewBag.ArchivedSortPArm = sortOrder == ""Archived"" ? ""Archived desc"" : ""Archived"";

    if (Request.HttpMethod == ""GET"")
    {
        searchString = currentFilter;
    }
    else
    {
        page = 1;
    }
    ViewBag.CurrentFilter = searchString;

    var courses = from s in db.Courses
                    select s;
    if (!String.IsNullOrEmpty(searchString))
    {
        courses = courses.Where(s =&gt; s.Title.ToUpper().Contains(searchString.ToUpper()));
    }
    switch (sortOrder)
    {
        case ""Title desc"":
            courses = courses.OrderByDescending(s =&gt; s.Title);
            break;
        case ""Credits"":
            courses = courses.OrderBy(s =&gt; s.Credits);
            break;
        case ""Credits desc"":
            courses = courses.OrderByDescending(s =&gt; s.Credits);
            break;
        case ""Elective"":
            courses = courses.OrderBy(s =&gt; s.Credits);
            break;
        case ""Elective desc"":
            courses = courses.OrderByDescending(s =&gt; s.Credits);
            break;
        case ""Instructor"":
            courses = courses.OrderBy(s =&gt; s.Instructor.LastName);
            break;
        case ""Instructor desc"":
            courses = courses.OrderByDescending(s =&gt; s.Instructor.LastName);
            break;
        case ""Year"":
            courses = courses.OrderBy(s =&gt; s.Year);
            break;
        case ""Year desc"":
            courses = courses.OrderByDescending(s =&gt; s.Year);
            break;
        case ""AttendingDays"":
            courses = courses.OrderBy(s =&gt; s.AttendingDays);
            break;
        case ""AttendingDays desc"":
            courses = courses.OrderByDescending(s =&gt; s.AttendingDays);
            break;
        case ""AttendanceCap"":
            courses = courses.OrderBy(s =&gt; s.AttendanceCap);
            break;
        case ""AttendanceCap desc"":
            courses = courses.OrderByDescending(s =&gt; s.AttendanceCap);
            break;
        case ""StartDate"":
            courses = courses.OrderBy(s =&gt; s.StartDate);
            break;
        case ""StartDate desc"":
            courses = courses.OrderByDescending(s =&gt; s.StartDate);
            break;
        case ""Location"":
            courses = courses.OrderBy(s =&gt; s.Location);
            break;
        case ""Location desc"":
            courses = courses.OrderByDescending(s =&gt; s.Location);
            break;
        case ""Parish"":
            courses = courses.OrderBy(s =&gt; s.Parish);
            break;
        case ""Parish desc"":
            courses = courses.OrderByDescending(s =&gt; s.Parish);
            break;
        case ""Description"":
            courses = courses.OrderBy(s =&gt; s.Description);
            break;
        case ""Description desc"":
            courses = courses.OrderByDescending(s =&gt; s.Description);
            break;
        case ""Approved"":
            courses = courses.OrderBy(s =&gt; s.Approved);
            break;
        case ""Approved desc"":
            courses = courses.OrderByDescending(s =&gt; s.Approved);
            break;
        case ""Completed"":
            courses = courses.OrderBy(s =&gt; s.Completed);
            break;
        case ""Completed desc"":
            courses = courses.OrderByDescending(s =&gt; s.Completed);
            break;
        case ""Archived"":
            courses = courses.OrderBy(s =&gt; s.Archived);
            break;
        case ""Archived desc"":
            courses = courses.OrderByDescending(s =&gt; s.Archived);
            break;
        default:
            courses = courses.OrderBy(s =&gt; s.Title);
            break;
    }
    int pageSize = 4;
    int pageNumber = (page ?? 1);
    return View(courses.ToPagedList(pageNumber, pageSize));
}
</code></pre>

<p>What should I do to the above code to make it more readable?  Do I simply move parts of it out as separate methods and move them to the bottom of the Controller?  Do I put the methods in another file somewhere and reference it here?</p>

<p>Please remember I am learning and clarity is enjoyed.</p>
","<c#><asp.net-mvc-3><refactoring>","3","194","2012-05-31 13:58:11"
"10850037","How to handle initialization of variables under specified circumstances","<p>I have a class whose constructor looks something like below:</p>

<pre><code>abstract class BasePanel extends JPanel {
  public BasePanel(A a) {
    // initializing fields from values passed to ctor
    this.a = a;
    // initializing gui components
    initializeComponents();
    setupPanels();
    concludeUiSetup();
  }

  // stuff
}
</code></pre>

<p>In the constructor, first the fields that are to be initialized with values passed to constructor are initialized. Then other methods required for UI setup are called in order. Two of these methods need to be overridden in subclass for UI setup specific to them.</p>

<p>Now consider a class <code>FooPanel</code> that extends <code>BasePanel</code>. It requires a few more initialization parameters in its constructor.</p>

<pre><code>class FooPanel extends BasePanel {
  public FooPanel(A a, B b) {
    super(a);
    this.b = b;
  }

  @Override
  public void initializeComponents() {
    super.initializeComponents();
    // I require b here, but oops, b is not initialized at this point, and so 
    // this will throw NPE.
    someTextField.setText(b.get());
  }

  // stuff
} 
</code></pre>

<p><code>initializeComponents</code> method here requires <code>b</code>, which unfortunately is not initialized at that point. </p>

<p>What would be the appropriate way to restructure this code so that:</p>

<ul>
<li>the fields required are set before they're needed. </li>
<li>the code that uses <code>FooPanel</code> (and other panels) isn't cluttered to much by this change.</li>
</ul>

<p>Any help greatly appreciated. Thanks.</p>
","<java><swing><oop><refactoring><initialization>","1","96","2012-06-01 12:12:26"
"10864611","How to determine if a type is a type of collection?","<p>I am trying to determine if a runtime type is some sort of collection type. What I have below works, but it seems strange that I have to name the types that I believe to be collection types in an array like I have done.</p>

<p>In the code below, the reason for the generic logic is because, in my app, I expect all collections to be generic.</p>

<pre><code>bool IsCollectionType(Type type)
{
    if (!type.GetGenericArguments().Any())
        return false;

    Type genericTypeDefinition = type.GetGenericTypeDefinition();
    var collectionTypes = new[] { typeof(IEnumerable&lt;&gt;), typeof(ICollection&lt;&gt;), typeof(IList&lt;&gt;), typeof(List&lt;&gt;) };
    return collectionTypes.Any(x =&gt; x.IsAssignableFrom(genericTypeDefinition));
}
</code></pre>

<p>How would I refactor this code to be smarter or simpler?</p>
","<c#><collections><types><refactoring>","3","73","2012-06-02 17:50:33"
"10867353","php/mysql switch from mysql to mysqli or pdo, possible to do gradually","<p>I have a web app that uses a lot of mysql_query calls--mainly because I found these in tutorials and the other places I learned how to run queries. Many people keep suggesting I switch to mysqli as mysql will disappear at some point, however, I've read that making this switch is a lot harder than adding an i at the end and requires rewriting all your code.  </p>

<p>If I ask is the switch worth it, I imagine almost everyone will say yes since sticking with mysql seems to be a minority point of view.  So my my question is, is it possible to switch to mysqli incrementally, ie gradually update calls or pages as they are written, or is it better to freeze the old site and redo the whole thing as an all mysqli or pdo site.  When I say better, I taking into consideration all the work and costs involved in redoing the whole site.  Obviously, there is an attraction to allocating resources to new features and things on the site, rather than redoing things that work fine using the old mysql.</p>

<p>Thanks!</p>
","<php><mysql><refactoring><pdo><mysqli>","1","60","2012-06-03 01:57:41"
"10872049","Refactoring code/consolidating functions (e.g. nested for-loop order)","<p>Just a little background: I'm making a program where a user inputs a skeleton text, two numbers (lower and upper limit), and a list of words. The outputs are a series of modifications on the skeleton text.</p>

<p>Sample inputs:</p>

<pre><code>text = ""Player # likes @."" (replace # with inputted integers and @ with words in list)
lower = 1
upper = 3
list = ""apples, bananas, oranges""
</code></pre>

<p>The user can choose to iterate over numbers first:</p>

<pre><code>Player 1 likes apples.
Player 2 likes apples.
Player 3 likes apples.
</code></pre>

<p>Or words first:</p>

<pre><code>Player 1 likes apples.
Player 1 likes bananas.
Player 1 likes oranges.
</code></pre>

<p>I chose to split these two methods of outputs by creating a different type of dictionary based on either number keys (integers inputted by the user) or word keys (from words in the inputted list) and then later iterating over the values in the dictionary.</p>

<p>Here are the two types of dictionary creation:</p>

<pre><code>def numkey(dict): # {1: ['Player 1 likes apples', 'Player 1 likes...' ] }

    text, lower, upper, list = input_sort(dict)
    d = {}

    for num in range(lower,upper+1):
        l = []
        for i in list:
            l.append(text.replace('#', str(num)).replace('@', i))
        d[num] = l
    return d

def wordkey(dict): # {'apples': ['Player 1 likes apples', 'Player 2 likes apples'..] }

    text, lower, upper, list = input_sort(dict)
    d = {}

    for i in list:
        l = []
        for num in range(lower,upper+1):
            l.append(text.replace('#', str(num)).replace('@', i))
        d[i] = l
    return d
</code></pre>

<p>It's fine that I have two separate functions for creating different types of dictionaries but I see a lot of repetition between the two. Is there any way I could make one dictionary function and pass in different values to it that would change the order of the nested for loops to create the specific {key : value} pairs I'm looking for?</p>

<p>I'm not sure how this would be done. Is there anything related to functional programming or other paradigms that might help with this? The question is a little abstract and more stylistic/design-oriented than anything.</p>
","<python><design><for-loop><refactoring><dry>","2","76","2012-06-03 16:36:09"
"10878091","Eclipse - record and apply move and rename refactorings to another workspace","<p>I'm currently working in a big java project with quite a few submodules that are worked on by different teams. Some of these teams are building the ""framework"", others are building the ""application"" based on the framework.</p>

<p>When the framework guys move or rename a class, the applications guys get compile errors wherever they are using a refactored framework class. Is there a way in <strong>Eclipse</strong> (<strong>Galileo Release</strong>) to record the change and update the references in another workspace?</p>

<p>What I've tried so far is creating a refactoring script during the rename refactoring, but when I try to apply that script to another workspace, it fails with <code>The refactoring 'Rename Type' (org.eclipse.jdt.ui.rename.type) cannot be performed, since its input 'xxx.TestClass"" does not exists</code>. Well, it does not exist (anymore) alright, but what I want is for all references for <code>xxx.TestClass</code> in my project to be changed to <code>xxx.MyRenamedTestClass</code>. Is there a way in Eclipse to do this with built-in functionality or an existing plugin or do I have to write one myself?</p>

<p>Thanks for your help!</p>

<p>EDIT: By now I found out that the ""Migrate JAR""-Plugin provides the functionality I am looking for, although we build our JARs with Maven, not Eclipse. I'm going through the source code now to find out what parts I can reuse.</p>
","<java><eclipse><refactoring><automated-refactoring>","3","44","2012-06-04 08:01:05"
"10878887","Refactoring of Case Statement and Dynamic Operator","<p>I have a case statement which compares data by getting parameter such as ""eq,ne,gt,..."" and so on. Actually this method will filter data by getting filter parameter and filter value. How can I refactor below code? Thanks.</p>

<pre><code>                      For iRow As Integer = 1 To ......
                                       .......
                                      columnData = rowData(HeaderIndex)

                                       Case ""eq""
                                            If Not (columnData = filterData) Then
                                                arrayDel(iRow) = True
                                                droppedRows += 1
                                            End If

                                        Case ""ne""
                                            If Not (columnData &lt;&gt; filterData) Then
                                                arrayDel(iRow) = True
                                                droppedRows += 1
                                            End If

                                        Case ""gt""
                                            If Not (columnData &gt; filterData) Then
                                                arrayDel(iRow) = True
                                                droppedRows += 1
                                            End If

                                        Case ""ge""
                                            If Not (columnData &gt;= filterData) Then
                                                arrayDel(iRow) = True
                                                droppedRows += 1
                                            End If
</code></pre>
","<vb.net><refactoring>","0","28","2012-06-04 09:14:10"
"10883342","Dependency injection through method with Resharper or DevExpress","<p>I want to inject a dependency in one of my class and I don't know if there is a refactor in tools like Resharper or DevExpress to do that.</p>

<p>Here is my class:</p>

<pre><code>   public class ClassWithInjections
   {
      private Dependency _fieldInjected;
   }

   public class Dependency
   {

   }
</code></pre>

<p>And the final result I want it to look like: (Note that the field can now be initialized by the method 'Initialize')</p>

<pre><code>   public class ClassWithInjections
   {
      private Dependency _fieldInjected;

      public void Initialize(Dependency fieldInjected)
      {
         _fieldInjected = fieldInjected;
      }
   }
</code></pre>

<p>I want to be able to just activate a refactor option while specifying my field with the mouse cursor and then the tool that could suggest me if I want to inject the dependency with method, property or constructor.</p>

<p>With Resharper, you can do that with 'Encapsulate field' (Ctrl+Shift+R) or creating a constructor with the code generation tool (Alt-Insert) but <strong>I don't found any option to inject my dependency with the 'method' technique</strong>.</p>

<p>Anybody have the solution?</p>

<p>Thank you.</p>
","<c#><dependency-injection><refactoring><devexpress><resharper-6.0>","1","93","2012-06-04 14:51:29"
"10884621","C# way to write Func with void return","<p>I have the following two functions, that are nearly identical, the only difference is that one uses <code>func</code>, the other <code>action</code>.  And I'd like to combine them into one function if it is possible.</p>

<pre><code>    private static void TryCatch(Action action)
    {
        try
        {
            action();
        }
        catch (Exception x)
        {
            Emailer.LogError(x);
            throw;
        }
    }

    private static TResult TryCatch&lt;TResult&gt;(Func&lt;TResult&gt; func)
    {
        try
        {
            return func();
        }
        catch (Exception x)
        {
            Emailer.LogError(x);
            throw;
        }
    }
</code></pre>
","<c#-4.0><delegates><refactoring><action><func>","3","38","2012-06-04 16:21:52"
"10886642","intellij have introduce constant be private not public","<p>In Intellij IDEA 11.1.2, when using the refactor shortcut to Introduce a Constant, it always makes <strong>public static final</strong> constant, whereas I generally prefer to default to <strong>private</strong>. 
In older versions of Intellij, I'm pretty sure that I had the option of setting <strong>private</strong> as the default. 
Does anyone know if there still exists an option to default to <strong>private</strong> for the Introduce Constant refactor option rather than having to afterwards go to the declaration and edit the <strong>public</strong> to <strong>private</strong>?
Thanks</p>
","<java><refactoring><intellij-idea><shortcuts>","1","30","2012-06-04 18:54:06"
"10887827","Method which does nothing or throw Exception","<p>I have a big method, part of which checks the state of an object and throws an exception if the state is invalid. Should I extract a method? The new method 'CheckState' will do nothing or throw an exception.</p>
","<c#><oop><refactoring>","1","63","2012-06-04 20:23:17"
"10890234","How can I refactor these methods and remove the dependency checks on the first lines","<p>I'm essentially making a form that pre-calculates most of its fields.
So, I have a bunch of methods that rely on previous methods, or should return nil. At the moment I'm doing a series of checks, and I'd like to remove them. </p>

<p>(Ignore the calculations, they are just examples) </p>

<pre><code>def age
  return unless dob  # Not so bad... 
  Date.today - dob
end

def age_at_start
  return unless dob &amp;&amp; start_date  # Getting worse
  start_date - dob
end

def compensation
  return unless age_at_start &amp;&amp; time_worked &amp;&amp; salary &amp;&amp; staff_rating  # Shoot me now
  some_calculation(age_at_start, time_worked, salary, staff_rating)
end
</code></pre>
","<ruby><refactoring><dependencies><calculation>","0","37","2012-06-05 00:45:11"
"10899972","How to DRY scope methods used in two different classes?","<p>I am using Ruby on Rails 3.2.2 and I would like to retrieve / scope associated objects by ""specifying"" / ""filtering on"" an attribute value on those associated objects. That is, at this time I am using the following code:</p>

<pre><code>class Article &lt; ActiveRecord::Base
  def self.search_by_title(search)
    where('articles.title LIKE ?', ""%#{search}%"")
  end
end

class ArticleAssociation &lt; ActiveRecord::Base
  def self.search_by_article_title(search)
    joins(:article).where('articles.title LIKE ?', ""%#{search}%"")
  end
end
</code></pre>

<p>In the above code the <code>where('articles.title LIKE ?', ""%#{search}%"")</code> clause is repeated twice and so I thought that it may be improved with the DRY principle: <em>is it possible to use the</em> <code>Article.search_by_title</code> <em>method directly in the</em> <code>ArticleAssociation.search_by_article_title</code> <em>method?</em></p>

<hr>

<p>Typical use cases are:</p>

<ul>
<li><code>ArticleAssociation.search_by_article_title(""Sample string"")</code></li>
<li><code>Article.search_by_title(""Sample string"")</code></li>
</ul>
","<ruby-on-rails><ruby><ruby-on-rails-3><refactoring><dry>","5","65","2012-06-05 15:12:53"
"10902591","What to use to refactor the javascript / jQuery of a web application to use require.js and jasmine","<p>I hope this question is not too general, but i haven't found any good tutorial on how to do the transition from standard javascript / jQuery code to modular / tested code.
Mmy new task is the complete refactoring of the javascript of our wordpress plugin. 
Our current code is standard jQuery code, thrown all into a file, with checks on the existance of dom elements to understand on what page we are in and attach the correct event handlers. 
My goal is simply to write more manteinable and clear code, and introduce tests in the process.
My approach would be:</p>

<ul>
<li>Try to modularize code in separate files (one file for each page) and use require.js to load  only the required code.</li>
<li>write some tests with jasmine/sinon and try to adapt the esisting code so that the tests pass</li>
</ul>

<p>Have you got any other suggestions/best practice?
Can you share some example on how you approached similar tasks?<br>
I was thinking about bringing in an mvc framework but if i can stick to standard jQuery code i think it's easier for the development team because it doesn't add complexity</p>
","<javascript><jquery><refactoring><requirejs>","2","51","2012-06-05 18:14:32"
"10904604","Rails 3.2 Helpers or Scopes","<p>I'm still wading through Rails, picking up as much as I can.</p>

<p>I have the following associations set up:</p>

<pre><code>Outlet **has_many** Monitorings  
Monitoring **belongs_to** Outlets
</code></pre>

<p>If I was in a <strong>dashboard_controller.rb</strong>, and I had the following loop:</p>

<pre><code>@revoked_outlet = Outlet.where(:revoked =&gt; true)
</code></pre>

<p>And then in the view, I'm looping through each outlet.
However, in the same loop I want to grab the most recent monitoring where <strong>:was_revoked => true</strong>.</p>

<p>How would I do this according to conventions?</p>
","<ruby-on-rails><postgresql><refactoring><associations>","0","39","2012-06-05 20:42:03"
"10907644","How could I refactor this method?","<p>Given the following helper method.</p>

<pre><code>def link_tags(collection)
  tags = collection.split(',')

  tags.map.each do |tag|
    if tag == tags.last
      content_tag(:a, tag, href: tags_filter_post_path(tag) )
    else
      content_tag(:a, tag, href: tags_filter_post_path(tag) ) + ', '
    end        
  end.reduce(:&lt;&lt;)
end
</code></pre>

<p>How could I do a little refactor on this?</p>

<p>EDIT: The final code after the refactoring suggested.</p>

<pre><code>def link_tags(collection)  
  collection.split(',').collect do |tag| 
    link = """"
    link += link_to tag, tags_filter_post_path(tag)
  end.join(', ').html_safe
end
</code></pre>
","<ruby-on-rails><ruby><refactoring>","0","70","2012-06-06 03:02:18"
"10908408","Xcode refactor doesn't rename setter and getter when I rename property name","<p>Renaming property works only property name, but doesn't rename its getter and setter method.<br>
<br>
For example, in the following code, when I rename propertyA to propertyB, <code>self.propertyA = @""ccc""</code> and <code>return propertyA</code> is renamed. But <code>-(void)setPropertyA:</code> and <code>-(NSString *)propertyA</code> is not renamed.</p>

<pre><code>@property(nonatomic, strong) NSString *propertyA;

-(void)setPropertyA:(NSString *)propertyA
{
    self.propertyA = @""ccc"";
}

-(NSString *)propertyA
{
    return propertyA;
}
</code></pre>

<p>It's very dangerous if I forget to manually rename getter and setter.</p>

<p>How to make Xcode rename getter and setter when I rename property?<br></p>
","<iphone><xcode><refactoring><getter-setter><iso>","0","35","2012-06-06 05:03:10"
"10908759","How to create a file and its parent directories in one method call?","<p>I want to create a file that is in specific directory.
For example: C:\x\y\z\a.txt</p>

<p>For this operation, I have to  create the directory to create file.</p>

<pre><code>Directory.Createdirectory(""C:\x\y\z\"");
File.Create(""C:\x\y\z\a.txt"");
</code></pre>

<p>But I really wonder that I can do this operation in single line of code.</p>

<p>Any help and idea will be greately appreciated.</p>
","<c#><file-io><refactoring>","0","76","2012-06-06 05:47:07"
"10915672","Ratio of time required to refactor existing code versus new development","<p>This may be a follow-up to <a href=""http://stackoverflow.com/questions/1433741/what-is-a-good-ratio-of-refactoring-time-versus-development-time"">What is a good ratio of refactoring time versus development time?</a> - we are trying to determine the ratio of time needed to refactor existing code to the time needed for new development (of that same code). I know this is a high level swag and there are many unknowns or variables from team to team and time to time that go into it. </p>

<p>We do have reasonably good stats on the time/effort spent developing the existing code,  have run the code thru multiple software metrics measurement and analysis tools and have an idea of what are all the areas we want to attack and refactor (the confluence of packages/subsystems generating defects higher than their proportional size, those way above nominal [nominal itself can be argued but please play along :-]metrics values such as methods with high complexity, depth of nesting and highly coupled to other methods (this is OO so coupling was not supposed to be here but it is). </p>

<p>So having said that and realizing that refactoring will focus on the most complex and ""algorithm and logic-heavy"" part of the code whereas our stats are on all the code without regard to the highly varying intellectual rigor required by each area, does refactoring say, 100 lines of code, take the same amount of time as writing those 100 lines of code? Is it more or less? Unit testing is required of both activities so that is not a determinant. Requirements are as good or as vague as before so that is also a non-determinant. The delta is understanding the code (documentation is poor / around 3% comment to code ratio), and formulating a new approach and breaking up methods or classes as well as de-coupling and changing the ""other side of calls and APIs"" due to decoupling. </p>

<p>Sounds like re-factoring takes 200-500% more time above and beyond new development (i.e. 10 minutes of new-code-development would be equivalent to 20-50 minutes of re-factoring)... thoughts? </p>
","<refactoring>","0","14","2012-06-06 13:55:18"
"10916564","C#/LINQ/Select Case: Is this a code smell?","<p>I have the following code -> something like <code>Select case using LINQ</code> -
This is not the actual code [picked from internet]. 
Just trying to show the Select Case concept using LINQ. 
In my code, based on the <em>conditions</em> I am creating new List objects</p>

<pre><code>Int32[] numbers = new Int32[] { 1, 2, 1, 3, 1, 5, 3, 1 };

var numberText =
(
    from n in numbers
    where n &gt; 0
    select new
    {
        Number = n,
        Text = 
        (
            n == 1 ? ""One"" :
            n == 2 ? ""Two"" :
            n == 3 ? ""Three"" : ""Unknown""
        )
    }
);
</code></pre>

<p>But, the page <a href=""http://www.refactoring.com/catalog/replaceConditionalWithPolymorphism.html"" rel=""nofollow"">here</a> says - ""Replace condition with polymorphism"". </p>

<p>So, the question is whether such kind of implementation is a code smell and should it  <strong><em>always</em></strong> be strictly avoided ? LINQ seems like an obvious choice while looping through collections and creating new objects conditionally. May be its wrong ?</p>
","<c#><linq><refactoring>","1","147","2012-06-06 14:43:57"
"10928773","Rename Java file but keep history in IBM Rational Synergy 7.1","<p>In the very big Java project I'm currently participating in, we use IBM Rational Synergy 7.1 as SCM. Now, a huge amount of rename and move refactorings are coming up due to changes in the architecture. </p>

<p>We would prefer to have Eclipse as the leading side in the refactoring, with (roughly) the following workflow:</p>

<ol>
<li>Apply the refactoring using the JDT tools</li>
<li>Move the files in Synergy in order to keep the history of the file (if possible automated with Synergy CLI)</li>
</ol>

<p>If we just do the refactoring and sync, the old file will be marked as deleted and the new file will have version 1. This is obviously not desired.</p>

<p>Is there a way to achieve step 2 with the Synergy CLI considering the old version with the old name is the one that is currently on the server while the new version only exists in the work area for the time being? You may assume that I have all the necessary information about the old file in the database (instance, name, version etc) available, I reckon I have to gather that beforehand.</p>

<p>Thanks :)</p>
","<java><refactoring><cm-synergy>","0","14","2012-06-07 09:03:22"
"10943032","Tips on refactoring an Android prototype","<p>I have an Android project I've inherited from another developer. </p>

<p>The original code was hacked together using a single View and a single Activity. The view class has a State variable that is switched on during input and rendering. </p>

<p>Each ""screen"" is a single bitmap rendered directly onto the screen. There are no layouts used at all. To make things even worse each variable in both the View and Activity classes were all declared public static and would access each other frequently. </p>

<p>I've reworked the code so it is now somewhat manageable, but it's still in those original two classes. This is my first decently sized Android app so I'm not completely sure where to go next. </p>

<p>From the looks of things, each ""screen"" should have its own View and Activity. Is this the general practice? </p>

<p>If so I need some way to share data between the separate Activities. I've read suggestions to use a Singleton class that holds generic data. Is there any other ways that are more built into the Android framework? </p>

<p>Thanks in advance. </p>
","<android><refactoring><prototype>","0","22","2012-06-08 04:21:51"
"10947464","In java, can ""public static void main"" be renamed or refactored?","<p>I do not want to change the <code>public static void</code> ... <code>String[] args</code> part of the signature, but is it possible to ""rename"" this function (eg. just for fun)? </p>

<p>So the entry point for execution would be a function with another name.</p>

<p>Rename it to, like, <code>boot</code> (what would better reflect, if not being historical, the actual use for it in my particular case).</p>

<hr>

<p><strong>related</strong></p>

<p>I'm interested in doing something different, but these questions are still interesting:</p>

<p><a href=""http://stackoverflow.com/questions/10028589/public-static-void-mainstring-arg-in-java-is-it-fixed"">public static void main(String arg[ ] ) in java is it fixed?</a></p>

<p><a href=""http://stackoverflow.com/questions/1688338/why-the-name-main-for-function-main"">Why the name main for function main()</a></p>
","<java><refactoring><main>","3","98","2012-06-08 10:53:00"
"10957288","How to refactor repeating of similar getters and setters in rails model?","<p>In my rails model I have something like</p>

<p>def price
      Money.new(price_cents, currency)
    end</p>

<pre><code>def price=(val)
  price_cents = val.to_money.cents
end

def value
  Money.new(value_cents, currency)
end

def value=(val)
  value_cents = val.to_money.cents
end

def budget
  Money.new(budget_cents, currency)
end

def budget=(val)
  budget_cents = val.to_money.cents
end

def used
  Money.new(used_cents, currency)
end

def used=(val)
  used_cents = val.to_money.cents
end
</code></pre>

<p>This is obviously not very DRY. How could I refactor this?</p>
","<ruby-on-rails><refactoring><dry>","1","33","2012-06-08 23:57:20"
"10980599","Android Library Projects: Refactoring and Navigation","<p>Currently (it changed quite a bit over time) Android Library projects become jar files in the referencing project. There are some issues with this approach: namely refactoring and navigation through code.</p>

<p>Is there any way to refactor the library that considers to change the dependent projects (e.g. rename)? Right now renames in the library project won't be propagated to dependent project. For each project I currently have to adjust them manually. (Workaround: remove the library reference from the dependent projects and add the library project as a plain Java Project reference.)</p>

<p>Also, navigating from dependent project to the library brings me to decompiled classes inside the library project jar, but not to the source. Is my Eclipse setup messed or is it just the current Android Library way?</p>
","<android><jar><refactoring><library-project>","2","56","2012-06-11 13:00:45"
"10993732","How to share code among several OCUnit test cases?","<p>Is there any way to share code among several OCUnit test cases? Maybe I'm missing something obvious, but I haven't been able to do it...</p>

<p>I have tried to put the common code in another class, but it seems you can only use STAssertxxx macros inside instance methods of classes inheriting from SenTestCase. Taking this into account, I put this common code in a singleton inheriting from SentTestCase with no test methods but this seems to break some internal assumption of OCUnit, as I'm not getting any errors from failed tests in the shared code.</p>

<p>My current code (not working) goes like this:</p>

<pre><code>@interface TestHelper : SenTestCase
+ (TestHelper *)sharedHelper;
- (void)assertSomething:(id)object;
@end

@implementation TestHelper
+ (TestHelper *)sharedHelper
{
    // Typical singleton magic
}

- (void)assertSomething:(id)object
{
    STAssertWhateverOnObject(object, ...);
}
@end



@interface RealTestCase : SenTestCase
- (void)testWhatever;
- (void)testAnotherThing;
@end

@implementation RealTestCase
- (void)testWhatever
{
    [[TestHelper sharedHelper] assertSomething:someObject];
    STAssertOtherThings(someObject, ...);
}

- (void)testAnotherThing
{
    [[TestHelper sharedHelper] assertSomething:someSimilarObject];
    STAssertSomeOtherThings(someSimilarObject, ...);
}
@end
</code></pre>

<p>Please, note that this is a simple example. In this case I could put all the code in the RealTestCase class, but I would like a generic solution to share code among several test cases, not only among methods in the same test case.</p>

<p>By the way, I have a similar problem using Kiwi.</p>
","<ios><unit-testing><testing><refactoring><ocunit>","0","41","2012-06-12 09:20:45"
"11005438","Good tutorials on refactoring Javascript into a JavaScript MVC frameworks?","<p>I'm looking for tutorial(s) on how to refactor JavaScript application into a JavaScript application using one of the existing JS MVC frameworks. Anyone got any?</p>
","<javascript><mvc><refactoring>","0","61","2012-06-12 21:53:17"
"11033691","How to find the broken javadoc image links in my project?","<p>During development classes are often moved to other packages. We use a lot of images to document the appearance of gui classes and the usual place for them is a folder named <em>""doc-files""</em> inside the package so they are referenced by <code>&lt;img src=""doc-files/GUIClassName.png""&gt;</code> in the javadoc. </p>

<p>The problem is, <strong>Eclipse</strong> seems not to update the links pointing to these images during refactoring, so now there are dozens of classes that have their images in some other package. </p>

<p>Is there any way to check which of the links inside javadoc are not valid? </p>
","<java><eclipse><refactoring><javadoc><broken-links>","-1","24","2012-06-14 13:06:01"
"11051548","Can this jQuery code be refactored","<p>I am trying to improve my jQuery skill and I have this bit of code. It's basic purpose is to size and resize a background to keep it at the same height as a responsive slider, so matching the size of the window; and tracking that if it's resized by the user. </p>

<p>Could it be refactored better or is it good as it is.</p>

<pre><code>$(window).load(function() {
var height = $('#display-area').css('height');
$('.skin-background')
    .css('display', 'block')
    .css('height', height);
});
$(window).resize(function() {
var height = $('#display-area').css('height');
$('.skin-background')
    .css('height', height);
});
</code></pre>
","<jquery><refactoring><readability><refactor-my-code><code-readability>","1","47","2012-06-15 13:25:21"
"11067370","c++: What is a good refactor for a duplicate member field in the subclass of a multiply-inherited class?","<p>Title edits that reflect a better summary of the question are welcome.</p>

<p>I'd like to refactor these three classes somehow to remove the duplicate field represented in <code>class C</code> (see hierarchy). I thought about pulling the field up into a parent class, but the issue is that A and B are not similar enough to be considered ""is-a"", C is considered <em>both</em>, and it is literally only <em>one</em> member field so creating a class just to hold ONE THING seems a bit overkill.</p>

<p>Hierarchy:</p>

<pre><code>(abstract data type)
class A : public O {
    public:
    //...
    std::string GetName();
    std::string GetName() const;
    void SetName(std::string name);
    //...
    protected:
    //...
    std::string _name;
    //...
};

//Methods and fields shown here represent the exact same representative data as in A but the classes are so dissimilar as to not be considered ""is-a"" relationship.
(abstract data type)
class B {
    public:
    //...
    std::string GetName();
    std::string GetName() const;
    void SetName(std::string name);
    //...
    protected:
    //...
    std::string _name;
    //...
};

(concrete)
class C : public A, public B {
    public:
    //...
    C(/*..Other parameters..*/, std::string name, /*....*/)
    : A(name, /*...*/), B(name, /*...*/) {
        /*...*/
    }
    //...
    private:
    //...        
};
</code></pre>
","<c++><refactoring><multiple-inheritance>","3","67","2012-06-16 22:01:58"
"11083051","Insert C# code into (.js)javascript file","<p>In the asp.net mvc 3 application I have two views which have the same set of javascript functions. Javascript is identical so I want to reorganize this code and extract all the javascript code into .js file in order to include it in both chtml files. </p>

<p>The problem is that one of the javascript functions uses C# code in order to get some data from model. How can I insert C# code into the javascript(.js) file or how can I extract all this code into a separate chtml file and include it in both of the previous?</p>
","<c#><javascript><refactoring><extract>","0","86","2012-06-18 12:37:04"
"11092398","Rename Tool for SQL Server","<p>I have a database that had 15 years of cruft stuffed into it by multiple teams and people in multiple languages.  I am looking to rename tables/columns/constraints to match some type of a standard.</p>

<p>The problem is that a column may be referenced in a ton of stored procs and there is no way to find other than search each sproc with a tool like SQL Digger.  The problem is that I want to rename a massive amount of entities and doing it manually for each sounds painful.</p>

<p>I've been looking for a tool that helps in name refactoring and can't find anything.  Some tools [here] vaguely claim to do that, but don't really (I haven't looked at all the ones listed to be fair).</p>

<p>Has anyone had experience with such a tool?</p>
","<sql><sql-server><refactoring>","0","43","2012-06-18 23:16:06"
"11093112","local variable cannot be defined as final due to catching exception while initializing it","<p>I usually like to declare my local variables as final but I see repeating patterns where I cannot do this when I have to handle an exception during its initialization.</p>

<p>For ex I have this code:</p>

<pre><code>final Client myClient = library.getClient(""service"");
//do a bunch of steps with myClient
</code></pre>

<p>But I end up modifying it very often like this:</p>

<pre><code>Client myClient = null;
try {
    myClient = library.getClient(""service"");
} catch (someException ex) {
    // handle
    throw ex;
}
// do stuff with myClient
</code></pre>

<p>I do not want to add the catch after I do all the stuff as it becomes a bit unreadable as it is towards the end. So is there a better way to do this?</p>
","<java><exception-handling><refactoring><final>","2","42","2012-06-19 01:05:05"
"11093964","How to turn a set of amended commits (stored in reflog) into real commits","<p>I was doing a refactoring, and just kept amending every time I made any decent progress. It has gone very well, and I realized it would be nice to be able to show people how I handled such a huge refactoring (lots of tiny steps, just nudging code around, with a green test suite at every point).</p>

<p>The commits are all in my <a href=""https://gist.github.com/2952094"" rel=""nofollow"">reflog</a>. Is there a way to turn each of those amended commits into its own real commit (sorry, don't know the terminology) so that users can see each step rather than just the aggregated ones on lines 81 and 57? I don't need unique messages for the commits or anything, just that they are captured in the history.</p>

<p>This is all still in my local repo.</p>
","<git><refactoring><commit><reflog>","2","33","2012-06-19 03:22:41"
"11097572","Refactoring Ruby on Rails i18n YAML files using dictionaries","<p><a href=""http://stackoverflow.com/q/10282857/567863"">This</a> StackOverflow question gave me food for thought on what is a good structure for Rails i18n files, so I thought I'd share another structure for refactoring Rails i18n yml files for your consideration/criticism.  </p>

<p>Given that I would like to</p>

<ol>
<li>keep the default app structure so I can use shorthand ""lazy"" lookups like <code>t('.some_translation')</code> in my views, as well as have an idea where translations are used in the app,</li>
<li>avoid as much string repetition as possible, in particular with words that are not just the same, but also have identical contexts/meanings,</li>
<li>only have to change a key once to have it reflected everywhere it's referenced,</li>
</ol>

<p>for a <strong>config/locales/en.yml</strong> file that looks something like this:</p>

<pre><code>activerecord:
  attributes:
    user:
      email: Email
      name: Name
      password: Password
      password_confirmation: Confirmation
  models:
    user: User
users:
  fields:
    email: Email
    name: Name
    password: Password
    confirmation: Confirmation
sessions:
  new:
    email: Email
    password: Password
</code></pre>

<p>I can see that there is significant repetition, and that the context of words like ""Email"" and ""Password"" are unambiguous and have the same meaning in their respective views.  It would be a bit annoying to have to go and change them all if I decide to change ""Email"" to ""e-mail"", so I'd like to refactor the strings to reference a dictionary of some sort.  So, how about adding a dictionary hash to the top of the file with some <code>&amp;</code> anchors like this:</p>

<pre><code>dictionary:
  email: &amp;email Email
  name: &amp;name Name
  password: &amp;password Password
  confirmation: &amp;confirmation Confirmation

activerecord:
  attributes:
    user:
      email: *email
      name: *name
      password: *password
      password_confirmation: *confirmation
  models:
    user: User
users:
  fields:  
    email: *email
    name: *name
    password: *password
    confirmation: *confirmation
sessions:
  new:
    email: *email
    password: *password
</code></pre>

<p>You could still continue to use static strings (eg ""User"" above), but whenever you get more than one instance of exactly the same word/phrase in your views, you could refactor it out to the dictionary.  If the dictionary translation of a key in the base language doesn't make sense for a target language, then just change out the referenced value in the target language to a static string or add it as an extra entry to the target language's dictionary.  I'm sure each language's dictionary could be refactored out into another file if they get too big and unwieldy (as long as it then gets reimported at the top of the translation file so the references work).</p>

<p>This way of structuring i18n yaml files seems to work well with some local test apps I tried it on.  I'm hoping the wonderful <a href=""http://www.localeapp.com/"" rel=""nofollow"">Localeapp</a> will provide support for this kind of anchoring/referencing in the future.  But anyway, all this dictionary talk can't possibly be an original idea, so are there other issues with anchor referencing in YAML, or maybe just with the whole ""dictionary"" concept in general?  Or is it just better to just rip out the default backend entirely and replace it with <a href=""http://redis.io/"" rel=""nofollow"">Redis</a> or something if you have needs beyond Rails default i18n conventions?</p>

<p><strong>Edit</strong>:</p>

<p>I wanted to try and address tigrish's workflow example mentioned in a comment below up here, rather than as another comment below his answer.  Please excuse me if I don't seem to be getting the points being made or if I'm just naive:</p>

<p><strong>Point 1</strong>: you have a general ""name"" attribute for ActiveRecord models, and they all just point to the generic dictionary for name:</p>

<pre><code>dictionary:
  name: &amp;name Name

activerecord:
  attributes:
    name: *name
    user:
      name: *name
    product:
      name: *name
</code></pre>

<p><strong>Point 2</strong>: Name for User model only needs to be changed.  Other names stay the same.</p>

<p><em>Option 1</em>: Keep the model field names the same on the backend and just change the front end translation it points to.</p>

<pre><code>dictionary:
  name: &amp;name Name
  full_name: &amp;full_name Full Name

activerecord:
  attributes:
    name: *name
    user:
      name: *full_name
    product:
      name: *name
</code></pre>

<p><em>Option 2</em>: Change the User model field name as well.  This would require changing any references to this key in the code, and a <code>change_table</code>/<code>rename_column</code> migration.</p>

<pre><code>dictionary:
  name: &amp;name Name
  full_name: &amp;full_name Full Name

activerecord:
  attributes:
    name: *name
    user:
      full_name: *full_name
    product:
      name: *name
</code></pre>

<p><em>Option 3</em>: If you want to be very thorough, refactor the information contained in a ""name"" out in to separate database/Activemodel fields, which would need new dictionary entries and a migration.  You can decide on your views how you would want a ""full name"" to display:</p>

<pre><code>dictionary:
  name: &amp;name Name
  name_prefix: &amp;name_prefix Prefix
  first_name: &amp;first_name First
  middle_name: &amp;middle_name Middle
  last_name: &amp;last_name Last
  name_suffix: &amp;name_suffix Suffix

activerecord:
  attributes:
    name: *name
    user:
      name_prefix: *name_prefix
      first_name: *first_name
      middle_name: *middle_name
      last_name: *last_name
      name_suffix: *name_suffix
    product:
      name: *name
</code></pre>

<p><strong>Point 3</strong>: Anyone for any reason needs a translation change, Marketing in this case.  I'll follow on from Point 2 Option 1's example</p>

<p><em>Option 1</em>: Model field names same, just change the front end translation.</p>

<pre><code>dictionary:
  name: &amp;name Name
  full_name: &amp;full_name Full Name
  funky_name: &amp;funky_name Ur Phunky Phresh Naym

activerecord:
  attributes:
    name: *name
    user:
      name: *full_name
    product:
      name: *name
sessions: # Sign up page keys
  new:
    name: *funky_name
</code></pre>

<p><em>Option 2</em>: ""Funky name"" desperately needs to be saved to the database, too, for some reason.  Let's call it a <code>username</code> if no one objects (or <code>funky_name</code> if for some reason Marketing insists).</p>

<pre><code>dictionary:
  name: &amp;name Name
  full_name: &amp;full_name Full Name
  funky_name: &amp;funky_name Ur Phunky Phresh Naym

activerecord:
  attributes:
    name: *name
    user:
      name: *full_name
      username: *funky_name
    product:
      name: *name
sessions: # Sign up page keys
  new:
    name: *name
    funky_name: *funky_name
</code></pre>

<p>Right, so I admit that I have little idea what I'm doing, however, I'm willing to be shot down publicly in order to understand why this way of working with i18n in Haml is a bad idea in a Rails app.  Difficult to read?  Maintenance nightmare?  Is it really considered 'hacking the file format' if I use (what I think is) a feature of the language?</p>

<p>Thanks again to tigrish for driving me to get all this out.</p>
","<ruby-on-rails><internationalization><refactoring><structure><yaml>","1","36","2012-06-19 08:50:49"
"11098756","Eclipse plugin to prepare list of classes to refactor / code review","<p>I need to prepare list of classes which will be refactored. Usually I create separate list in notepad and manually add refactored class to the bottom of this file to follow my progress. </p>

<p>The same when I need demonstrate few classes on a code review. But It is very slow I'd prefer some plugin/solution in the Eclipse.</p>

<p>Is there any plugin or functionality in Eclipse which you can recommend to do this?</p>
","<java><eclipse><refactoring><code-review>","1","28","2012-06-19 10:04:59"
"11110555","Is there any tool or add-in for Delphi that I can use to help refactor code that is Not Object Oriented?","<p>I have a large codebase which I am working with which has units like this:</p>

<pre><code>unit myformunit;

interface
type
  TMyForm = class(Form)
  end;

  procedure not_a_method1;

  procedure not_a_method2;

  var
     global1,global2,global3:Integer;
  ...
</code></pre>

<p>In short, the authors of the code did not write methods, they wrote global procedures. There are tens of thousands of them. Inside these procedures, they reference a single instance of <code>MyForm:TMyForm</code>.</p>

<p>I am considering writing a parser/rewriter utility that will turn this code into ""at least minimally object oriented code"".  The strategy is to move the interface and implementation section globals into the form, as a start.  I realize that's hardly elegant OOP. But it's a step forward from globals.</p>

<p>If I could do this on one unit at a time, I might be able to repair the breakage in the rest of the project, if I only did it on one form at a time.  But I'd like to reduce the amount of time it takes to rewrite the units, instead of doing it by hand.  Some forms have 500+ procedures and 500+ interface and implementation global variables which are in fact, specific to the state of a single instance of the form that they are in the same unit with. </p>

<p>Basically,  what I will do if nothing like this exists is write a parser based on the Castalia Delphi parser.  I'm hoping that perhaps ModelMakerCodeExplorer, or castalia, or some other similar tool has something that would at least do part of what I need for me, so I don't have to build this utility myself.  Even if I do have to build it myself, I estimate it might automate about a thousand to two thousand hours of grunt-work for me.  I can at least run it, and then see how much breaks, and then revert or commit after I've decided on a level of effort to refactor this code.</p>

<p>Alternative strategies that accomplish the same goal (go from zero encapsulation and zero OOP, to more encapsulation, and slightly more than zero OOP, in an incremental way, on a large, unstructured delphi codebase that only used objects when it was unavoidable, and never had any idea about real OOP) are welcomed.</p>
","<delphi><oop><refactoring><encapsulation>","10","136","2012-06-19 22:44:44"
"11115543","My php app directory structure is a labyrinth","<p>I'm working on an old php web application.  </p>

<p>The problem is the organization of all the files is more or less random.  My favorite is at one level there is both an 'include' folder and an 'includes' folder.</p>

<p>The main obstacle to rearranging all the files is that most of the require and include statements are raw string file paths, and some are variables.</p>

<p>My current plan looks like this:</p>

<ol>
<li><p>Create a super_require($path) function that checks if path is where it should be, and if not, search the whole code tree for the ending filename until it's found. </p></li>
<li><p>Search-replace all requires and includes with super_require().</p></li>
<li><p>Rearrange all the files to my hearts content.</p></li>
<li><p>Wonder how it worked, since this plan seems crazy error prone.</p></li>
</ol>

<p>So I guess my question is, does anyone know of a better plan in this situation?</p>
","<php><refactoring><directory-structure>","0","31","2012-06-20 08:25:13"
"11129667","Writing an random access iterator over parallel arrays","<p><strong>Background</strong><br>
Large application with a bundle of code, I can't change the storage mechanism.</p>

<p>I would like to create an iterator over a set of multi-dimensional data stored in parallel arrays so we can start using std algorithms &amp; containers.</p>

<p>Any ideas on how to make this work correctly?</p>

<pre><code>#include &lt;boost/iterator/iterator_facade.hpp&gt;

#include &lt;iostream&gt;
#include &lt;algorithm&gt;

class curve_point_iterator;

const int curve_size = 10;

class curve
{
public:
  curve()
  {
    std::fill( x, &amp;x[curve_size], 0.0 );
    std::fill( y, &amp;y[curve_size], 0.0 );
  }

  double x[curve_size];
  double y[curve_size];

  curve_point_iterator begin();
  curve_point_iterator end();
};

class point_reference
{
public:
  point_reference( double&amp; x_, double&amp; y_ )
    : x( x_ )
    , y( y_ )
  {
  }

  point_reference&amp; operator = ( point_reference&amp; other )
  {
    x = other.x;
    y = other.y;

    return *this;
  }

  double &amp; x;
  double &amp; y;
};

class curve_point_iterator 
  : public boost::iterator_facade&lt; 
          curve_point_iterator
        , point_reference
        , boost::random_access_traversal_tag &gt;
{
public:
  curve_point_iterator()
    : index(0)
    , curve_(nullptr)
  {}

  explicit curve_point_iterator( curve* curve_in, size_t index_ = 0 )
    : index( index_ )
    , curve_( curve_in )
  {}

private:
  friend class boost::iterator_core_access;

  void increment()
  {
    ++index;
  }

  void decrement()
  {
    --index;
  }

  void advance( size_t n )
  {
    index += n;
  }

  difference_type distance_to( curve_point_iterator const&amp; other ) const
  {
    return other.index - this-&gt;index;
  }

  bool equal(curve_point_iterator const&amp; other) const
  {
      return this-&gt;index == other.index &amp;&amp; this-&gt;curve_ == other.curve_;
  }

  point_reference&amp; dereference() const
  {
    auto pt_ref = new( point_reference_buffer ) point_reference(  curve_-&gt;x[index]
                                                                , curve_-&gt;y[index] );
    return *pt_ref;
  }

  size_t index;
  mutable char point_reference_buffer[sizeof(point_reference)];
  curve* curve_;
};


curve_point_iterator curve::begin()
{
  return curve_point_iterator( this );
}

curve_point_iterator curve::end()
{
  return curve_point_iterator( this, curve_size+1 );
}


int main(int argc, char* argv[])
{
  curve crv;

  crv.x[1] = 20;
  crv.x[2] = 10;

  std::sort( crv.begin(), crv.end(), []( point_reference const&amp; a, point_reference const&amp; b )
  {
    return a.x &lt; b.x;
  });

  for( auto i = 0; i &lt; curve_size; ++i )
  {
    std::cout &lt;&lt; crv.x[i] &lt;&lt; std::endl;
  }

  return 0;
}
</code></pre>

<p><strong>Output</strong><br>
    0<br>
    20<br>
    20<br>
    20<br>
    20<br>
    20<br>
    20<br>
    20<br>
    20<br>
    20   </p>

<p>After changing to</p>

<pre><code>class point_reference
{
  ... ( all the other stuff )
  double x; // no longer reference
  double y; // no longer reference
};
</code></pre>

<p><strong>Output</strong><br>
    0<br>
    20<br>
    10<br>
    0<br>
    0<br>
    0<br>
    0<br>
    0<br>
    0   </p>
","<c++><boost><refactoring><c++11><boost-iterators>","0","98","2012-06-20 23:35:28"
"11130924","How to cascade optional parameter?","<p>I have a worker method with an optional parameter</p>

<pre><code>Work(string input = DefaultInput)
{
    //do stuff
}
</code></pre>

<p>And I have a wrapper around this, which also take the string <code>input</code>, but this can also be optional...</p>

<pre><code>WorkWrapper(int someParameter, string input = DefaultInput)
{
    //do initialization
    Work(input);

}
</code></pre>

<p>The problem here is I duplicate reference to DefaultInput, if, say, I change the default input of work to <code>NewDefaultInput</code>, I will need to update the workWrapper as well, otherwise it will still use the old default.</p>

<p>Is there a way so that the default input do not need to be declared twice? Possibly without having two overloads for workwrapper..</p>
","<c#><refactoring><optional-parameters>","2","33","2012-06-21 02:52:23"
"11146473","Can I make gcc/g++ print the number of lines it compiled?","<p>I'm working on an interesting refactor, and I want to have some sort of metric to see how quickly I'm ejecting lines from the codebase. Is there any sort of way to have gcc/g++ emit information about the number of lines it compiled? Ideally, this information would be collected throughout my work and turned into a pretty graph or something.</p>
","<gcc><refactoring><g++>","1","16","2012-06-21 20:46:24"
"11155937","Clean code and refactoring. Extra local variable","<p>We had big discussion about small peace of code in our team.</p>

<p><strong>Example 1</strong> developer added extra local variable to make code more readable. In local variable he saved value from constant.</p>

<p><strong>Example 2</strong> same code without extra variable, but less readable from our developer point of view.</p>

<p>What do you think is more readable? 
Better from refactoring point of view?</p>

<p><strong>1.</strong></p>

<pre><code>var tolerance = Constants.DateTypeGeneratorTolerance;

var dayType = DateTypeGenerator.GenerateDateType(
                courseTripValidity,
                tolerance,
                symbols,
                startDate,
                endDate);
</code></pre>

<p><strong>2.</strong></p>

<pre><code>var dayType = DateTypeGenerator.GenerateDateType(
                courseTripValidity,
                Constants.DateTypeGeneratorTolerance,
                symbols,
                startDate,
                endDate);
</code></pre>
","<.net><coding-style><refactoring>","2","44","2012-06-22 12:13:47"
"11164414","IDEs that can rename JS functions that have the same name as functions on other classes","<p>I'm wondering if anyone knows of an IDE that has refactoring tools such as ""rename function"" or ""find all references"" that are not confused by two functions with the same name on different classes.</p>

<p>That is, if you had a class Foo with Foo.prototype.myFunc and a class Bar with Bar.prototype.myFunc I'd want to be able to right-click on a call like</p>

<pre><code>var b = new Bar();
b.myFunc();
</code></pre>

<p>and have it provide refactoring tools that would only apply to Bar.myFunc() and not Foo.myFunc().</p>
","<javascript><ide><refactoring>","2","39","2012-06-22 21:31:55"
"11179229","Transitioning a project from Cocos2d v1.x to v2.x and then to ARC","<p>I might sound lazy but I am slightly confused on how to proceed on this subject. I have followed <a href=""http://www.learn-cocos2d.com/2012/04/enabling-arc-cocos2d-project-howto-stepbystep-tutorialguide/"" rel=""nofollow"">this guide</a> which is very well done.</p>

<p>My goal is to convert the Cocos2d v1.x game project to Cocos2d v2.x and then refactor the project code to ARC.</p>

<p>To get started I created an empty HelloWorld Cocos2d v2.x project and created the v2.x static library (as from Steffen's guide). I then rafactored the code to ARC and the HelloWorld worked smoothly.</p>

<p>The issue is when I try to add to the same project the classes I had already written that don't complain to ARC (assuming that there will be not many Cocos2d v2.x vs v1.x problems - e.g. use of deprecated methods and classes like TouchJSON - my project doesn't at least as far I can see). So, I added a couple of Game classes that don't depend from the rest of the game (to reduce the number of potential Cocos2d v2. Vs v1 issues) to the project to see if the ARC covnersion worked for those as a proof of concept. After adding them I choosed: EDIT->Refactor option from XCode.</p>

<p>But now the compiler gives me some ARC warning messages like ""ARC forbids explicit message send of autorelease"" in the following method:</p>

<pre><code>return [[[self alloc] init] autorelease];
</code></pre>

<p>Or similar problems with the dealloc method already written.</p>

<p>I was assuming that EDIT->Refactor would have changed the added code but it appears to work only once. Any hint on this? <strong>should I add all my code to the new project template before refactoring the code?</strong> </p>

<p>EDIT:To verify whether it was an XCode bug I created an empty iOS project with no Cocos2d libraries and then converted it to ARC. Then created a new empty sublcass of NSObject and added a dealloc method and run the conversion again, it did work! So I might have not followed correctly some of the steps to create and link to the static library.. </p>

<p>In addition to this there are some other small issues (not XCode related, but Cocos2d v2.x related), like the fact that the <strong>CDXPropertyModifierAction</strong> is not automatically included to the CocosDenshion folder and I had to add it to the project after creating the static library (when I noticed the issue).. but I guess this is more template creation related.</p>

<p>Thanks for reading!</p>
","<ios><xcode><cocos2d-iphone><refactoring><automatic-ref-counting>","1","25","2012-06-24 16:39:01"
"11184235","How to count number of functions in a C++ projects?","<p>Is there any tool that analyse and reports number of functions (including member functions) in a C++ project?</p>

<p>I need to replace a global variable with a class member in a VC++ project. Then I need to introduce a local reference that points to new class member in fuctions that uses the global variable, so that the project compiles successfully. For that I need to calculate number of functions in that project. Then I can rougly calculate the time taken to do the change.</p>
","<c++><refactoring><code-analysis><static-analysis>","2","90","2012-06-25 06:13:38"
"11184366","automatically split (refactor) .h into header and implementation (h+cpp)","<p>When writing c++ code, I often start by writing full 'implementation' code in my header files, then later need to refactor the implementation into a cpp file. </p>

<p>This is great, but I find this process laborious, but otherwise pretty easy, so I wondered about whether is there any automated way to do this?</p>

<p>Specifically, I want to convert all class and function definitions in the <code>.h</code> to declarations, and have them declared in a new <code>.cpp</code> file.</p>

<p>I'm using xcode, but I am open to any solutions.</p>
","<c++><refactoring><header-files><automated-refactoring>","3","65","2012-06-25 06:28:37"
"11188773","Refactoring: Finding a Common Abstraction","<p>I've got this piece of legacy code which I'm trying to refactor at the moment:</p>

<pre><code>    public class FileManger
    {
        private IFileReader _fileReader;
        private IFileWriter _fileWriter;

        public enum Mode { Read = 1, Write = 2 };

        public void Open( Mode mode)
        {
            if (mode == Mode.Read)
            {
                _fileReader = new FileReader();
            }
            else if (mode == Mode.Write)
            {
                _fileWriter = new FileWriter();
            }
        }
    }
</code></pre>

<p>I need to be able to replace this piece of code with a factory method and assign the returned to a common filed.</p>

<p><strong>so.. I'm trying to make it look like:</strong> </p>

<pre><code>public class FileManger
{
    private IFileHandler _fileHandler;

    public enum Mode { Read = 1, Write = 2 };

    public void Open(string fileName, Mode mode)
    {
        _fileHandler = Factory.CreateFileHandler(mode);
    }
 }
</code></pre>

<p>The problem I have is the two original interfaces IFileReader and IFileWriter, though they are quite closer in shape to each other, they have two completely different methods  string ReadLine(); and void WriteLine(string line); for which I could not find a common abstration.</p>

<p>Basically my refactoring goal is to make the IFileReader and IFileWriter interfaces look the same and use a common interface instead of two.</p>

<p>currently these interfaces look like this:</p>

<pre><code> public interface IFileReader : IDisposable
    {
        void OpenFileStream(string fileName);
        void Close();

        string ReadLine();
    }
</code></pre>

<p>and</p>

<pre><code>public interface IFileWriter : IDisposable
    {

        void OpenFileStream(string fileName);
        void Close();

        void WriteLine(string line);
    }
</code></pre>

<p>could someone give me some suggestions on how I could go around achieving this?</p>

<p>Please let me know if you need any further clarifications, if I made it unclear to understand.</p>
","<oop><refactoring><good-design><refactor-my-code>","1","30","2012-06-25 11:46:59"
"11200416","Best practices for refactoring a database in production?","<p>I'm currently working on a project where our product at the current version is deployed at more than one client site. More often that not we test and scrap (a.k.a. refactor :) the DB design in our dev/test environment. It's not possible to keep track of every incremental change to the DB to create the corresponding 'migration files'. And now when we are satisfied with a DB design (relatively stable) we need to update the production DBs to the current state.</p>

<p>Our system in production can't just be issued a <code>DROP/CREATE SCHEMA</code> command to update the schema (think of the jobs that would be lost, mine included :) So we land up either writing MySQL dumps or application wrappers to backup the data and re-enter it into the DB. Quite cumbersome, especially when multiple 'clients' are NOT at the same DB version. It's quite cumbersome to write one for every version that the clients have.</p>

<p>So what are some of the best practices that you employ to refactor databases in production especially when you CAN'T just delete that data but need to re-enter it and have the system seamlessly continue after some 'downtime'?</p>

<p>If it's of any use the backend is Java/Restlet and MySQL</p>
","<database><refactoring><production-environment>","1","16","2012-06-26 03:30:38"
"11205238","Why avoid dot operator chaining","<p>There are two code snippets:</p>

<pre><code>someObject.getBla1().getBla2().performBlah();
</code></pre>

<p>And the second one:</p>

<pre><code>bla1=someObject.getBla1();
bla2=bla1.getBla2();
bla2.performBlah();
</code></pre>

<p>I am always told to avoid the first one, and use the second one, where as I feel that The second one is just a pain.</p>

<p>What's the benefit in the second one?</p>
","<coding-style><refactoring>","1","19","2012-06-26 10:21:01"
"11207553","Partial Software Rewrite using Framework","<p>I have been given the task to fix up the very poorly written code that my company uses. The first thing I need to do is propose how I will go about this. There are multiple possibilities. The first is to refactor the existing code, making it readable and fixing the many bugs that exist. A second possibility is to implement a framework and largely rewrite the code. </p>

<p>The problem with the second option is that the product is part of a suite, and rewriting the entire suite is not currently on the table. There are too many different departments using it, and the initiative that I am on is limited to my department.</p>

<p>Idealy, I would like to take the portion that I am tasked with working on and rewrite it using something like Spring MVC. I thought that if I could come up with some sort of interface layer between the new Spring code and the old Java / JSP code. Such an interface layer will allow for the suite to become more modular, which is a good thing, but it will also mean there are two very different frameworks being used (Spring and the old busted internal framework).</p>

<p>Does anyone have any experience with a similar situation? I believe option two will provide a better quality product, but will integrating it into an existing code base be worth it? I realize there are many factors here that are specific to this situation, but if anyone has had to make a similar decision, I would be interested in hearing what you learned from it.</p>
","<java><spring><jsp><refactoring>","0","26","2012-06-26 12:40:40"
"11218539","Is there command-line tool to extract C/C++ typedef, structure, enumeration, variable, function from a C file?","<p>I am desiring a command-line tool to <em>extract</em> a C/C++ definition or declaration (typedef, structure, enumeration, variable, or function) from a C/C++ file. Also a way to <em>replace</em> an existing definition/declaration would be handy (after transforming the extracted definition by a user-submitted script). Is there such generic tool available, or is some resonably close approximation of such a tool?</p>

<p>Scriptability and ability to hook-up with user created scripts or programs is of importance here, although I am academically curious of GUI programs too.</p>

<p><strong>Sample Use Cases</strong> (extra - for the curious mind):</p>

<ol>
<li>Given deeply nested <code>struct</code>s and variable (array) initializations of these types, suppose there is a need to change a struct definition by adding or reordering fields or rewriting the variable/array definitions in more readable format without introducing errors resulting from manual labor. This would work by extracting the old initializations, then using a script/program to write the new initializations to replace the old ones.</li>
<li>For implementing a code browsing tool - extract a definition.</li>
<li>Decorative code generation (e.g. logging function entries / returns).</li>
<li>Scripted code structuring (e.g. extract this and that thing and put in different place without change - version control commit comment could document the command to perform this operation to make it evident and verifiable that nothing changed).</li>
</ol>
","<c><tools><refactoring><automation><code-generation>","0","6","2012-06-27 02:20:00"